var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},ConvertKit;!function(a){var b=function(){function a(a){this._SecretKey=a}return Object.defineProperty(a.prototype,"_BaseUrl",{get:function(){return"https://api.convertkit.com/v3/"},enumerable:!0,configurable:!0}),a.prototype.BuildRequestHeaders=function(a,b){void 0===b&&(b={});var c=_.extend({"Content-Type":a,Accept:"application/json"},b);return c},a.prototype.CreateRequest=function(a,b,c){var d=reqwest({url:this._BaseUrl+b+"?api_secret="+this._SecretKey,method:a,data:c&&JSON.stringify(c)||null,headers:this.BuildRequestHeaders("application/json"),contentType:"application/json"});return d},a.prototype.FinishRequest=function(a,b,c,d){void 0===d&&(d=null),a.fail(c),a.then(function(e){return a.request.status>205||a.request.status<200?void c("Response for request did not indicate success. Status code: "+a.request.status+"."):d?void d(e):void b(e)})},a}(),c=function(a){function b(b){var c=this;a.call(this,b),this.GetAsync=function(a){return void 0===a&&(a=1),new WinJS.Promise(function(a,b){var d=c.CreateRequest("GET","subscribers");c.FinishRequest(d,a,b)})}}return __extends(b,a),b}(b);a.SubscriberService=c;var d=function(a){function b(b){var c=this;a.call(this,b),this.GetAsync=function(a){return void 0===a&&(a=1),new WinJS.Promise(function(a,b){var d=c.CreateRequest("GET","forms");c.FinishRequest(d,a,b)})}}return __extends(b,a),b}(b);a.FormService=d}(ConvertKit||(ConvertKit={}));var ConvertKit;!function(a){var b=function(){function b(){var b=this;this.IsLoading=ko.observable(!1),this.SecretKey=ko.observable(""),this.HandleLoginEvent=function(c,d){if(!b.SecretKey())return void Utils.ShowDialog("Error","You must enter a valid API key or access token to continue.");b.IsLoading(!0),b.Service=new a.SubscriberService(b.SecretKey());var e=b.Service.GetAsync(),f=function(c){Utils.LocalStorage.Save(a.Strings.SecretKeyId,b.SecretKey());var d={SubscriberList:c};a.Main.HandleNavigateToSubscribers(b,d)},g=function(a){console.log("Failed to get subscribers. Reason: ",a),Utils.ShowDialog("Error","It looks like your secret key or access token is invalid. Please try again."),b.IsLoading(!1)};e.done(f,g)},this.RegisterKnockoutSubscriptions()}return b.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(b,"PageId",{get:function(){return"Login"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"login/login.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=new b;a.Main.CurrentPage(b.PageId),WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading LoginController.")}})},b}();a.LoginController=b}(ConvertKit||(ConvertKit={}));var ConvertKit;!function(a){var b=function(){function b(b){var c=this;return this.Service=new a.FormService(Utils.LocalStorage.Retrieve(a.Strings.SecretKeyId)),this.Forms=ko.observableArray([]),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(a){c.Forms([]),c.Forms.push.apply(c.Forms,a.forms),c.IsLoading(!1)},this.HandleLoadFailure=function(a){c.IsLoading(!1),Utils.ShowDialog("Error","Failed to retrieve list of forms.")},this.HandleRefreshEvent=function(a,b){c.IsLoading()||(c.IsLoading(!0),c.Service.GetAsync().done(c.HandleLoadSuccess,c.HandleLoadFailure))},this.RegisterKnockoutSubscriptions(),b&&b.FormsResponse?void this.HandleLoadSuccess(b.FormsResponse):void this.HandleRefreshEvent()}return b.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(a){var b=document.getElementById("subscriber-container");WinJS.UI.Animation.enterContent(b)})},Object.defineProperty(b,"PageId",{get:function(){return"FormsController"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"forms/forms.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Main.State.FormsController||new b(d);a.Main.CurrentPage(b.PageId),a.Main.State.FormsController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading FormsController.")}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();a.FormsController=b}(ConvertKit||(ConvertKit={}));var ConvertKit;!function(a){var b=function(){function b(b){var c=this;return this.Service=new a.SubscriberService(Utils.LocalStorage.Retrieve(a.Strings.SecretKeyId)),this.SubscriberList=ko.observable({}),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(a){_.isEqual(c.SubscriberList(),a)===!1&&c.SubscriberList(a),c.IsLoading(!1)},this.HandleLoadFailure=function(a){c.IsLoading(!1),Utils.ShowDialog("Error","Failed to retrieve list of subscribers.")},this.GravatarHash=function(a){return md5(a.toLowerCase().trim())},this.HandleAppBarUpdate=function(a,b){setTimeout(function(){b.style.display=null,b.winControl.forceLayout(),WinJS.UI.Animation.slideUp(b)},900)},this.HandleRefreshEvent=function(a,b){c.IsLoading()||(c.IsLoading(!0),c.Service.GetAsync().done(c.HandleLoadSuccess,c.HandleLoadFailure))},this.RegisterKnockoutSubscriptions(),b&&b.SubscriberList?void this.HandleLoadSuccess(b.SubscriberList):void this.HandleRefreshEvent()}return b.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(a){var b=document.getElementById("subscriber-container");WinJS.UI.Animation.enterContent(b)})},Object.defineProperty(b,"PageId",{get:function(){return"HomeController"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"home/home.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Main.State.HomeController||new b(d);a.Main.CurrentPage(b.PageId),a.Main.State.HomeController=e,window.client=e,ko.applyBindings(e,c)},error:function(a){alert("Error loading HomeController.")}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();a.HomeController=b}(ConvertKit||(ConvertKit={}));var ConvertKit;!function(a){var b=function(){function b(){this.IsLoading=ko.observable(!1),this.Notifications={Enabled:ko.observable(!0),Timer:ko.observable(15)},this.HandleSignoutEvent=function(b,c){Utils.ShowDialog("Are you sure you want to sign out?","Signing out will erase your secret key from this app's local storage. You'll need to enter it again to use the app.","Sign out",function(b){"primary"===b.detail.result&&(Utils.LocalStorage.Delete(a.Strings.SecretKeyId),WinJS.Navigation.navigate(a.LoginController.PageUrl).done(function(){WinJS.Navigation.history=[],a.Main.State.FormsController=null,a.Main.State.HomeController=null,a.Main.State.SettingsController=null}))},!0)},this.RegisterKnockoutSubscriptions()}return b.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(b,"PageId",{get:function(){return"Settings"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"settings/settings.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Main.State.SettingsController||new b;a.Main.CurrentPage(b.PageId),a.Main.State.SettingsController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading SettingsController.")}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();a.SettingsController=b}(ConvertKit||(ConvertKit={}));var ConvertKit;!function(a){var b;!function(a){a.SecretKeyId="ConvertKit-Secret-Key"}(b=a.Strings||(a.Strings={}));var c=function(){function c(){}return c.State={},c.Start=function(){var d=WinJS.Application;console.log("Started"),d.onactivated=function(e){if(_.forOwn(a,function(a,b){_.has(a,"DefinePage")&&a.DefinePage()}),"Windows.Launch"===e.detail.kind){console.log("On Windows.Launch");var f=WinJS.UI.processAll().then(null,function(a){console.log("Error processing winjs ui.",a)});try{ko.applyBindings(this)}catch(g){console.log("Failed to apply ko bindings.",g)}d.sessionState.Main=d.sessionState.Main||{},c.State=JSON.parse(d.sessionState.Main.StateJSON||"{}"),c.CurrentPage(d.sessionState.Main.LastPage),_.forOwn(c.State,function(b,d){try{_.has(a[d],"MergeAndRestore")&&(c.State[d]=a[d].MergeAndRestore(b))}catch(e){c.State[d]=null}}),f=f.then(function(){return Utils.LocalStorage.Retrieve(b.SecretKeyId)?WinJS.Navigation.navigate(c.CurrentPage()?a[c.CurrentPage()].PageUrl:a.HomeController.PageUrl,WinJS.Navigation.state):WinJS.Navigation.navigate(a.LoginController.PageUrl,WinJS.Navigation.state)}).then(null,function(a){console.log("Error loading page",a)}),f.done(function(){var a=function(){window.applicationCache.swapCache(),Utils.ShowDialog("Update available.","An update has been installed for ConvertKit. Tap 'Activate' below to switch to the new version.","Activate",function(a){window.location.reload(!0)})};window.applicationCache.addEventListener("updateready",a),window.applicationCache.update()},function(a){console.log("Error loading page 2",a)})}},d.oncheckpoint=function(a){},d.start()},c.CurrentPage=ko.observable(),c.HandleNavigateToSubscribers=function(b,d){c.CurrentPage()!==a.HomeController.PageId&&(WinJS.Navigation.navigate(a.HomeController.PageUrl,d),c.CloseSplitviewPane())},c.HandleNavigateToForms=function(b,d){c.CurrentPage()!==a.FormsController.PageId&&(WinJS.Navigation.navigate(a.FormsController.PageUrl),c.CloseSplitviewPane())},c.HandleRefreshEvent=function(a,b){var c=window.client;c&&c.HandleRefreshEvent&&c.HandleRefreshEvent(a,b)},c.HandleNavigateToSettings=function(b,d){c.CurrentPage()!==a.SettingsController.PageId&&(WinJS.Navigation.navigate(a.SettingsController.PageUrl),c.CloseSplitviewPane())},c.CloseSplitviewPane=function(){var a=document.getElementById("splitview").winControl;a.closePane()},c}();a.Main=c}(ConvertKit||(ConvertKit={})),ConvertKit.Main.Start();
//# sourceMappingURL=app.min.js.map