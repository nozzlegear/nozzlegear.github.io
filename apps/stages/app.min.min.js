var __extends,Stages,Utils;(function(n){var t=function(){function t(){}return t.State={},t.Start=function(){var i=WinJS.Application;i.onactivated=function(r){if(_.forOwn(n,function(n){_.has(n,"DefinePage")&&n.DefinePage()}),r.detail.kind==="Windows.Launch"){var u=WinJS.UI.processAll();ko.applyBindings(this);i.sessionState.Main=i.sessionState.Main||{};t.State=JSON.parse(i.sessionState.Main.StateJSON||"{}");t.CurrentPage(i.sessionState.Main.LastPage);_.forOwn(t.State,function(i,r){try{_.has(n[r],"MergeAndRestore")&&(t.State[r]=n[r].MergeAndRestore(i))}catch(u){t.State[r]=null}});u=u.then(function(){return Utils.LocalStorage.Retrieve("X-Stages-API-Key")?WinJS.Navigation.navigate(t.CurrentPage()?n[t.CurrentPage()].PageUrl:n.SubscriberController.PageUrl,WinJS.Navigation.state):WinJS.Navigation.navigate(n.LoginController.PageUrl,WinJS.Navigation.state)}).then(null,function(n){console.log("Error loading page",n)});u.done(function(){console.log("Done")},function(n){console.log("Error loading page 2",n)})}};i.oncheckpoint=function(){};i.start()},t.CurrentPage=ko.observable(),t.HandleNavigateToSubscribers=function(i,r){t.CurrentPage()!==n.SubscriberController.PageId&&(WinJS.Navigation.navigate(n.SubscriberController.PageUrl,r),t.CloseSplitviewPane())},t.HandleNavigateToFinancials=function(){t.CurrentPage()!==n.FinancialController.PageId&&(WinJS.Navigation.navigate(n.FinancialController.PageUrl),t.CloseSplitviewPane())},t.HandleRefreshEvent=function(n,t){var i=window.client;i&&i.HandleRefreshEvent&&i.HandleRefreshEvent(n,t)},t.HandleNavigateToSettings=function(){t.CurrentPage()!==n.SettingsController.PageId&&(WinJS.Navigation.navigate(n.SettingsController.PageUrl),t.CloseSplitviewPane())},t.CloseSplitviewPane=function(){var n=document.getElementById("splitview").winControl;n.closePane()},t}();n.Main=t})(Stages||(Stages={}));Stages.Main.Start(),function(n){var t=function(){function t(t){var i=this;if(this.Service=new n.AdminSubscriberService(Utils.LocalStorage.Retrieve("X-Stages-API-Key")),this.SubscribedAccounts=ko.observableArray(),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(n){i.SubscribedAccounts(n);i.IsLoading(!1)},this.HandleLoadFailure=function(){i.IsLoading(!1);Utils.ShowDialog("Error","Failed to retrieve subscriber data.")},this.GravatarHash=function(n){var t=md5(n.toLowerCase().trim());return"https://www.gravatar.com/avatar/{hash}?s=100"},this.GetNextChargeDate=function(n){return n.NextChargeDate?"Charge: "+moment(n.NextChargeDate).format("MMMM Do, YYYY"):"(Failed to get charge data)"},this.HandleAppBarUpdate=function(n,t){setTimeout(function(){t.style.display=null;t.winControl.forceLayout();WinJS.UI.Animation.slideUp(t)},900)},this.HandleRefreshEvent=function(){if(!i.IsLoading()){if(i.IsLoading(!0),!window.navigator.onLine){Utils.ShowDialog("No internet connection","It looks like your device does not have an active internet connection. Please try again.");i.IsLoading(!1);return}i.Service.GetAsync("subscribed").done(i.HandleLoadSuccess,i.HandleLoadFailure)}},this.RegisterKnockoutSubscriptions(),t&&t.Accounts){this.HandleLoadSuccess(t.Accounts);return}this.HandleRefreshEvent()}return t.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(){var n=document.getElementById("data-container");WinJS.UI.Animation.enterContent(n)})},Object.defineProperty(t,"PageId",{get:function(){return"Subscribers"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PageUrl",{get:function(){return"subscribers/subscribers.html"},enumerable:!0,configurable:!0}),t.DefinePage=function(){WinJS.UI.Pages.define(t.PageUrl,{init:function(){},processed:function(){},ready:function(i,r){var u=n.Main.State.SubscriberController||new t(r);n.Main.CurrentPage(t.PageId);n.Main.State.SubscriberController=u;WinJS.Namespace.define("client",u);ko.applyBindings(u,i)},error:function(n){Utils.ShowDialog("Error","Failed to load SubscriberController");console.log("Error loading SubscriberController",n)}})},t.MergeAndRestore=function(n){var i=new t;return _.forOwn(n,function(n,t){var r=i[t];if(ko.isObservable(r)){r(n);return}i[t]=n}),i},t}();n.SubscriberController=t}(Stages||(Stages={})),function(n){var t=function(){function t(){this.IsLoading=ko.observable(!1);this.Notifications={Enabled:ko.observable(!0),Timer:ko.observable(15)};this.RegisterKnockoutSubscriptions()}return t.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(t,"PageId",{get:function(){return"Settings"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PageUrl",{get:function(){return"settings/settings.html"},enumerable:!0,configurable:!0}),t.DefinePage=function(){WinJS.UI.Pages.define(t.PageUrl,{init:function(){},processed:function(){},ready:function(i){var r=n.Main.State.SettingsController||new t;n.Main.CurrentPage(t.PageId);n.Main.State.SettingsController=r;WinJS.Namespace.define("client",r);ko.applyBindings(r,i)},error:function(){alert("Error loading SettingsController.")}})},t.MergeAndRestore=function(n){var i=new t;return _.forOwn(n,function(n,t){var r=i[t];if(ko.isObservable(r)){r(n);return}i[t]=n}),i},t}();n.SettingsController=t}(Stages||(Stages={})),function(n){var t=function(){function t(){var t=this;this.IsLoading=ko.observable(!1);this.SecretKey=ko.observable("");this.HandleLoginEvent=function(){if(!t.SecretKey()){Utils.ShowDialog("Error","You must enter a valid API key or access token to continue.");return}t.IsLoading(!0);t.Service=new n.AdminSubscriberService(t.SecretKey());var i=t.Service.GetAsync("subscribed"),r=function(i){Utils.LocalStorage.Save("X-Stages-API-Key",t.SecretKey());var r={Accounts:i};n.Main.HandleNavigateToSubscribers(t,r)},u=function(n){console.log("Failed to get subscribers. Reason: ",n);Utils.ShowDialog("Error","It looks like your secret key or access token is invalid. Please try again.");t.IsLoading(!1)};i.done(r,u)};this.RegisterKnockoutSubscriptions()}return t.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(t,"PageId",{get:function(){return"Login"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PageUrl",{get:function(){return"login/login.html"},enumerable:!0,configurable:!0}),t.DefinePage=function(){WinJS.UI.Pages.define(t.PageUrl,{init:function(){},processed:function(){},ready:function(i){var r=new t;n.Main.CurrentPage(t.PageId);WinJS.Namespace.define("client",r);ko.applyBindings(r,i)},error:function(){alert("Error loading LoginController.")}})},t}();n.LoginController=t}(Stages||(Stages={})),function(n){var t=function(){function t(t){var i=this;if(this.Service=new n.AdminFinancialService(Utils.LocalStorage.Retrieve("X-Stages-API-Key")),this.SubscribedPlans=ko.observableArray(),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(n){i.SubscribedPlans(n);i.IsLoading(!1)},this.HandleLoadFailure=function(){i.IsLoading(!1);Utils.ShowDialog("Error","Failed to retrieve subscriber data.")},this.HandleAppBarUpdate=function(n,t){setTimeout(function(){t.style.display=null;t.winControl.forceLayout();WinJS.UI.Animation.slideUp(t)},900)},this.HandleRefreshEvent=function(){if(!i.IsLoading()){if(i.IsLoading(!0),!window.navigator.onLine){Utils.ShowDialog("No internet connection","It looks like your device does not have an active internet connection. Please try again.");i.IsLoading(!1);return}i.Service.GetAsync().done(i.HandleLoadSuccess,i.HandleLoadFailure)}},this.RegisterKnockoutSubscriptions(),t&&t.Plans){this.HandleLoadSuccess(t.Plans);return}this.HandleRefreshEvent()}return t.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(){var n=document.getElementById("data-container");WinJS.UI.Animation.enterContent(n)})},Object.defineProperty(t,"PageId",{get:function(){return"Financials"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PageUrl",{get:function(){return"financials/financials.html"},enumerable:!0,configurable:!0}),t.DefinePage=function(){WinJS.UI.Pages.define(t.PageUrl,{init:function(){},processed:function(){},ready:function(i,r){var u=n.Main.State.FinancialController||new t(r);n.Main.CurrentPage(t.PageId);n.Main.State.FinancialController=u;WinJS.Namespace.define("client",u);ko.applyBindings(u,i)},error:function(){alert("Error loading FinancialController.")}})},t.MergeAndRestore=function(n){var i=new t;return _.forOwn(n,function(n,t){var r=i[t];if(ko.isObservable(r)){r(n);return}i[t]=n}),i},t}();n.FinancialController=t}(Stages||(Stages={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t=function(){function n(n){this._AccessToken=n}return Object.defineProperty(n.prototype,"_BaseUrl",{get:function(){return"https://getstages.com/api/"},enumerable:!0,configurable:!0}),n.prototype.BuildRequestHeaders=function(n,t){t===void 0&&(t={});return _.extend({"Content-Type":n,"X-Stages-Access-Token":this._AccessToken,"X-Stages-API-Version":"1",Accept:"application/json"},t)},n.prototype.CreateRequest=function(n,t,i){return reqwest({url:this._BaseUrl+t,method:n,data:i&&JSON.stringify(i)||null,headers:this.BuildRequestHeaders("application/json"),contentType:"application/json"})},n.prototype.FinishRequest=function(n,t,i,r){r===void 0&&(r=null);n.fail(i);n.then(function(u){if(n.request.status>205||n.request.status<200){i("Response for request did not indicate success. Status code: "+n.request.status+".");return}if(!r){t(u);return}r(u)})},n}(),r=function(n){function t(t){var i=this;n.call(this,t);this.GetAsync=function(n){return n===void 0&&(n="all"),new WinJS.Promise(function(t,r){var u=i.CreateRequest("GET","admin/subscribers?status="+n);i.FinishRequest(u,t,r)})};this.CountAsync=function(n){return n===void 0&&(n="all"),new WinJS.Promise(function(t,r){var u=i.CreateRequest("GET","admin/subscribers/count?status="+n);i.FinishRequest(u,t,r,function(n){t(n.count)})})}}return __extends(t,n),t}(t),i;n.AdminSubscriberService=r;i=function(n){function t(t){var i=this;n.call(this,t);this.GetAsync=function(){return new WinJS.Promise(function(n,t){var r=i.CreateRequest("GET","admin/financials");i.FinishRequest(r,n,t)})}}return __extends(t,n),t}(t);n.AdminFinancialService=i}(Stages||(Stages={})),function(n){function r(n,t,i,r,u){var o,s,e,f;i===void 0&&(i="Okay");u===void 0&&(u=!1);o=document.createElement("div");s=document.createElement("p");s.textContent=t;o.appendChild(s);e={title:n,primaryCommandText:i,secondaryCommandDisabled:!0};u&&(e.secondaryCommandText="Cancel",e.secondaryCommandDisabled=!1);f=new WinJS.UI.ContentDialog(o,e);f.onafterhide=function(n){f.dispose();r&&r(n)};document.body.appendChild(f.element);f.show()}var t,i;(function(n){function t(n,t){localStorage.setItem(n,t)}function i(n){return localStorage.getItem(n)}function r(n){localStorage.removeItem(n)}n.Save=t;n.Retrieve=i;n.Delete=r})(t=n.LocalStorage||(n.LocalStorage={})),function(n){function t(n,t){sessionStorage.setItem(n,t)}function i(n){return sessionStorage.getItem(n)}function r(n){sessionStorage.removeItem(n)}n.Save=t;n.Retrieve=i;n.Delete=r}(i=n.SessionStorage||(n.SessionStorage={}));n.ShowDialog=r}(Utils||(Utils={}));ko.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}};ko.virtualElements.allowedBindings.stopBinding=!0;