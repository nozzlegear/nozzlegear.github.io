var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Stages;!function(a){var b=function(){function a(a){this._AccessToken=a}return Object.defineProperty(a.prototype,"_BaseUrl",{get:function(){return"https://getstages.com/api/"},enumerable:!0,configurable:!0}),a.prototype.BuildRequestHeaders=function(a,b){void 0===b&&(b={});var c=_.extend({"Content-Type":a,"X-Stages-Access-Token":this._AccessToken,"X-Stages-API-Version":"1",Accept:"application/json"},b);return c},a.prototype.CreateRequest=function(a,b,c){var d=reqwest({url:this._BaseUrl+b,method:a,data:c&&JSON.stringify(c)||null,headers:this.BuildRequestHeaders("application/json"),contentType:"application/json"});return d},a.prototype.FinishRequest=function(a,b,c,d){void 0===d&&(d=null),a.fail(c),a.then(function(e){return a.request.status>205||a.request.status<200?void c("Response for request did not indicate success. Status code: "+a.request.status+"."):d?void d(e):void b(e)})},a}(),c=function(a){function b(b){var c=this;a.call(this,b),this.GetAsync=function(a){return void 0===a&&(a="all"),new WinJS.Promise(function(b,d){var e=c.CreateRequest("GET","admin/subscribers?status="+a);c.FinishRequest(e,b,d)})},this.CountAsync=function(a){return void 0===a&&(a="all"),new WinJS.Promise(function(b,d){var e=c.CreateRequest("GET","admin/subscribers/count?status="+a);c.FinishRequest(e,b,d,function(a){b(a.count)})})}}return __extends(b,a),b}(b);a.AdminSubscriberService=c;var d=function(a){function b(b){var c=this;a.call(this,b),this.GetAsync=function(){return new WinJS.Promise(function(a,b){var d=c.CreateRequest("GET","admin/financials");c.FinishRequest(d,a,b)})}}return __extends(b,a),b}(b);a.AdminFinancialService=d}(Stages||(Stages={}));var Stages;!function(a){var b=function(){function b(){var b=this;this.IsLoading=ko.observable(!1),this.SecretKey=ko.observable(""),this.HandleLoginEvent=function(c,d){if(!b.SecretKey())return void Utils.ShowDialog("Error","You must enter a valid API key or access token to continue.");b.IsLoading(!0),b.Service=new a.AdminSubscriberService(b.SecretKey());var e=b.Service.GetAsync("subscribed"),f=function(c){Utils.LocalStorage.Save("X-Stages-API-Key",b.SecretKey());var d={Accounts:c};a.Main.HandleNavigateToSubscribers(b,d)},g=function(a){console.log("Failed to get subscribers. Reason: ",a),Utils.ShowDialog("Error","It looks like your secret key or access token is invalid. Please try again."),b.IsLoading(!1)};e.done(f,g)},this.RegisterKnockoutSubscriptions()}return b.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(b,"PageId",{get:function(){return"Login"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"login/login.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=new b;a.Main.CurrentPage(b.PageId),WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading LoginController.")}})},b}();a.LoginController=b}(Stages||(Stages={}));var Stages;!function(a){var b=function(){function b(b){var c=this;return this.Service=new a.AdminFinancialService(Utils.LocalStorage.Retrieve("X-Stages-API-Key")),this.SubscribedPlans=ko.observableArray(),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(a){c.SubscribedPlans(a),c.IsLoading(!1)},this.HandleLoadFailure=function(a){c.IsLoading(!1),Utils.ShowDialog("Error","Failed to retrieve subscriber data.")},this.HandleAppBarUpdate=function(a,b){setTimeout(function(){b.style.display=null,b.winControl.forceLayout(),WinJS.UI.Animation.slideUp(b)},900)},this.HandleRefreshEvent=function(a,b){if(!c.IsLoading()){if(c.IsLoading(!0),!window.navigator.onLine)return Utils.ShowDialog("No internet connection","It looks like your device does not have an active internet connection. Please try again."),void c.IsLoading(!1);c.Service.GetAsync().done(c.HandleLoadSuccess,c.HandleLoadFailure)}},this.RegisterKnockoutSubscriptions(),b&&b.Plans?void this.HandleLoadSuccess(b.Plans):void this.HandleRefreshEvent()}return b.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(a){var b=document.getElementById("data-container");WinJS.UI.Animation.enterContent(b)})},Object.defineProperty(b,"PageId",{get:function(){return"Financials"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"financials/financials.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Main.State.FinancialController||new b(d);a.Main.CurrentPage(b.PageId),a.Main.State.FinancialController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading FinancialController.")}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();a.FinancialController=b}(Stages||(Stages={}));var Stages;!function(a){var b=function(){function b(b){var c=this;return this.Service=new a.AdminSubscriberService(Utils.LocalStorage.Retrieve("X-Stages-API-Key")),this.SubscribedAccounts=ko.observableArray(),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(a){c.SubscribedAccounts(a),c.IsLoading(!1)},this.HandleLoadFailure=function(a){c.IsLoading(!1),Utils.ShowDialog("Error","Failed to retrieve subscriber data.")},this.GravatarHash=function(a){md5(a.toLowerCase().trim());return"https://www.gravatar.com/avatar/{hash}?s=100"},this.HandleAppBarUpdate=function(a,b){setTimeout(function(){b.style.display=null,b.winControl.forceLayout(),WinJS.UI.Animation.slideUp(b)},900)},this.HandleRefreshEvent=function(a,b){if(!c.IsLoading()){if(c.IsLoading(!0),!window.navigator.onLine)return Utils.ShowDialog("No internet connection","It looks like your device does not have an active internet connection. Please try again."),void c.IsLoading(!1);c.Service.GetAsync("subscribed").done(c.HandleLoadSuccess,c.HandleLoadFailure)}},this.RegisterKnockoutSubscriptions(),b&&b.Accounts?void this.HandleLoadSuccess(b.Accounts):void this.HandleRefreshEvent()}return b.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(a){var b=document.getElementById("data-container");WinJS.UI.Animation.enterContent(b)})},Object.defineProperty(b,"PageId",{get:function(){return"Subscribers"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"subscribers/subscribers.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Main.State.SubscriberController||new b(d);a.Main.CurrentPage(b.PageId),a.Main.State.SubscriberController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){Utils.ShowDialog("Error","Failed to load SubscriberController"),console.log("Error loading SubscriberController",a)}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();a.SubscriberController=b}(Stages||(Stages={}));var Stages;!function(a){var b=function(){function b(){this.IsLoading=ko.observable(!1),this.Notifications={Enabled:ko.observable(!0),Timer:ko.observable(15)},this.RegisterKnockoutSubscriptions()}return b.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(b,"PageId",{get:function(){return"Settings"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"settings/settings.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Main.State.SettingsController||new b;a.Main.CurrentPage(b.PageId),a.Main.State.SettingsController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading SettingsController.")}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();a.SettingsController=b}(Stages||(Stages={}));var Stages;!function(a){var b=function(){function b(){}return b.State={},b.Start=function(){var c=WinJS.Application;c.onactivated=function(d){if(_.forOwn(a,function(a,b){_.has(a,"DefinePage")&&a.DefinePage()}),"Windows.Launch"===d.detail.kind){var e=WinJS.UI.processAll();ko.applyBindings(this),c.sessionState.Main=c.sessionState.Main||{},b.State=JSON.parse(c.sessionState.Main.StateJSON||"{}"),b.CurrentPage(c.sessionState.Main.LastPage),_.forOwn(b.State,function(c,d){try{_.has(a[d],"MergeAndRestore")&&(b.State[d]=a[d].MergeAndRestore(c))}catch(e){b.State[d]=null}}),e=e.then(function(){return Utils.LocalStorage.Retrieve("X-Stages-API-Key")?WinJS.Navigation.navigate(b.CurrentPage()?a[b.CurrentPage()].PageUrl:a.SubscriberController.PageUrl,WinJS.Navigation.state):WinJS.Navigation.navigate(a.LoginController.PageUrl,WinJS.Navigation.state)}).then(null,function(a){console.log("Error loading page",a)}),e.done(function(){console.log("Done")},function(a){console.log("Error loading page 2",a)})}},c.oncheckpoint=function(a){},c.start()},b.CurrentPage=ko.observable(),b.HandleNavigateToSubscribers=function(c,d){b.CurrentPage()!==a.SubscriberController.PageId&&(WinJS.Navigation.navigate(a.SubscriberController.PageUrl,d),b.CloseSplitviewPane())},b.HandleNavigateToFinancials=function(c,d){b.CurrentPage()!==a.FinancialController.PageId&&(WinJS.Navigation.navigate(a.FinancialController.PageUrl),b.CloseSplitviewPane())},b.HandleRefreshEvent=function(a,b){var c=window.client;c&&c.HandleRefreshEvent&&c.HandleRefreshEvent(a,b)},b.HandleNavigateToSettings=function(c,d){b.CurrentPage()!==a.SettingsController.PageId&&(WinJS.Navigation.navigate(a.SettingsController.PageUrl),b.CloseSplitviewPane())},b.CloseSplitviewPane=function(){var a=document.getElementById("splitview").winControl;a.closePane()},b}();a.Main=b}(Stages||(Stages={})),Stages.Main.Start();
//# sourceMappingURL=app.min.js.map