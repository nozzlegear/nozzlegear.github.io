var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){var b;!function(a){var b=function(){function a(a){this._AccessToken=a}return Object.defineProperty(a.prototype,"_BaseUrl",{get:function(){return"https://getstages.com/api/"},enumerable:!0,configurable:!0}),a.prototype.BuildRequestHeaders=function(a,b){void 0===b&&(b={});var c=_.extend({"Content-Type":a,"X-Stages-Access-Token":this._AccessToken,"X-Stages-API-Version":"1",Accept:"application/json"},b);return c},a.prototype.CreateRequest=function(a,b,c){var d=reqwest({url:this._BaseUrl+b,method:a,data:c&&JSON.stringify(c)||null,headers:this.BuildRequestHeaders("application/json"),contentType:"application/json"});return d},a.prototype.FinishRequest=function(a,b,c,d){void 0===d&&(d=null),a.fail(c),a.then(function(e){return a.request.status>205||a.request.status<200?void c("Response for request did not indicate success. Status code: "+a.request.status+"."):d?void d(e):void b(e)})},a}(),c=function(a){function b(b){var c=this;a.call(this,b),this.GetAsync=function(a){return void 0===a&&(a="all"),new WinJS.Promise(function(b,d){var e=c.CreateRequest("GET","admin/subscribers?status="+a);c.FinishRequest(e,b,d)})},this.CountAsync=function(a){return void 0===a&&(a="all"),new WinJS.Promise(function(b,d){var e=c.CreateRequest("GET","admin/subscribers/count?status="+a);c.FinishRequest(e,b,d,function(a){b(a.count)})})}}return __extends(b,a),b}(b);a.AdminSubscriberService=c;var d=function(a){function b(b){var c=this;a.call(this,b),this.GetAsync=function(){return new WinJS.Promise(function(a,b){var d=c.CreateRequest("GET","admin/financials");c.FinishRequest(d,a,b)})}}return __extends(b,a),b}(b);a.AdminFinancialService=d}(b=a.Stages||(a.Stages={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c=function(){function c(){var c=this;this.IsLoading=ko.observable(!1),this.SecretKey=ko.observable(""),this.HandleLoginEvent=function(d,e){if(!c.SecretKey())return void a.Utils.ShowDialog("Error","You must enter a valid API key or access token to continue.");c.IsLoading(!0),c.Service=new b.AdminSubscriberService(c.SecretKey());var f=c.Service.GetAsync("subscribed"),g=function(d){a.Utils.LocalStorage.Save("X-Stages-API-Key",c.SecretKey());var e={Accounts:d};b.Main.HandleNavigateToSubscribers(c,e)},h=function(b){console.log("Failed to get subscribers. Reason: ",b),a.Utils.ShowDialog("Error","It looks like your secret key or access token is invalid. Please try again."),c.IsLoading(!1)};f.done(g,h)},this.RegisterKnockoutSubscriptions()}return c.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(c,"PageId",{get:function(){return"Login"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PageUrl",{get:function(){return"login/login.html"},enumerable:!0,configurable:!0}),c.DefinePage=function(){WinJS.UI.Pages.define(c.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(a,d){var e=new c;b.Main.CurrentPage(c.PageId),WinJS.Namespace.define("client",e),ko.applyBindings(e,a)},error:function(a){alert("Error loading LoginController.")}})},c}();b.LoginController=c}(b=a.Stages||(a.Stages={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;return this.Service=new b.AdminFinancialService(a.Utils.LocalStorage.Retrieve("X-Stages-API-Key")),this.SubscribedPlans=ko.observableArray(),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(a){d.SubscribedPlans(a),d.IsLoading(!1)},this.HandleLoadFailure=function(b){d.IsLoading(!1),a.Utils.ShowDialog("Error","Failed to retrieve subscriber data.")},this.HandleAppBarUpdate=function(a,b){setTimeout(function(){b.style.display=null,b.winControl.forceLayout(),WinJS.UI.Animation.slideUp(b)},900)},this.HandleRefreshEvent=function(b,c){if(!d.IsLoading()){if(d.IsLoading(!0),!window.navigator.onLine)return a.Utils.ShowDialog("No internet connection","It looks like your device does not have an active internet connection. Please try again."),void d.IsLoading(!1);d.Service.GetAsync().done(d.HandleLoadSuccess,d.HandleLoadFailure)}},this.RegisterKnockoutSubscriptions(),c&&c.Plans?void this.HandleLoadSuccess(c.Plans):void this.HandleRefreshEvent()}return c.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(a){var b=document.getElementById("data-container");WinJS.UI.Animation.enterContent(b)})},Object.defineProperty(c,"PageId",{get:function(){return"Financials"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PageUrl",{get:function(){return"financials/financials.html"},enumerable:!0,configurable:!0}),c.DefinePage=function(){WinJS.UI.Pages.define(c.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(b,d){var e=a.Stages.Main.State.FinancialController||new c(d);a.Stages.Main.CurrentPage(c.PageId),a.Stages.Main.State.FinancialController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,b)},error:function(a){alert("Error loading FinancialController.")}})},c.MergeAndRestore=function(a){var b=new c;return _.forOwn(a,function(a,c){var d=b[c];return ko.isObservable(d)?void d(a):void(b[c]=a)}),b},c}();b.FinancialController=c}(b=a.Stages||(a.Stages={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;return this.Service=new b.AdminSubscriberService(a.Utils.LocalStorage.Retrieve("X-Stages-API-Key")),this.SubscribedAccounts=ko.observableArray(),this.IsLoading=ko.observable(!1),this.HandleLoadSuccess=function(a){d.SubscribedAccounts(a),d.IsLoading(!1)},this.HandleLoadFailure=function(b){d.IsLoading(!1),a.Utils.ShowDialog("Error","Failed to retrieve subscriber data.")},this.GravatarHash=function(a){md5(a.toLowerCase().trim());return"https://www.gravatar.com/avatar/{hash}?s=100"},this.HandleAppBarUpdate=function(a,b){setTimeout(function(){b.style.display=null,b.winControl.forceLayout(),WinJS.UI.Animation.slideUp(b)},900)},this.HandleRefreshEvent=function(b,c){if(!d.IsLoading()){if(d.IsLoading(!0),!window.navigator.onLine)return a.Utils.ShowDialog("No internet connection","It looks like your device does not have an active internet connection. Please try again."),void d.IsLoading(!1);d.Service.GetAsync("subscribed").done(d.HandleLoadSuccess,d.HandleLoadFailure)}},this.RegisterKnockoutSubscriptions(),c&&c.Accounts?void this.HandleLoadSuccess(c.Accounts):void this.HandleRefreshEvent()}return c.prototype.RegisterKnockoutSubscriptions=function(){this.IsLoading.subscribe(function(a){var b=document.getElementById("data-container");WinJS.UI.Animation.enterContent(b)})},Object.defineProperty(c,"PageId",{get:function(){return"Subscribers"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PageUrl",{get:function(){return"subscribers/subscribers.html"},enumerable:!0,configurable:!0}),c.DefinePage=function(){WinJS.UI.Pages.define(c.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(b,d){var e=a.Stages.Main.State.SubscriberController||new c(d);a.Stages.Main.CurrentPage(c.PageId),a.Stages.Main.State.SubscriberController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,b)},error:function(b){a.Utils.ShowDialog("Error","Failed to load SubscriberController"),console.log("Error loading SubscriberController",b)}})},c.MergeAndRestore=function(a){var b=new c;return _.forOwn(a,function(a,c){var d=b[c];return ko.isObservable(d)?void d(a):void(b[c]=a)}),b},c}();b.SubscriberController=c}(b=a.Stages||(a.Stages={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c=function(){function b(){this.IsLoading=ko.observable(!1),this.Notifications={Enabled:ko.observable(!0),Timer:ko.observable(15)},this.RegisterKnockoutSubscriptions()}return b.prototype.RegisterKnockoutSubscriptions=function(){},Object.defineProperty(b,"PageId",{get:function(){return"Settings"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PageUrl",{get:function(){return"settings/settings.html"},enumerable:!0,configurable:!0}),b.DefinePage=function(){WinJS.UI.Pages.define(b.PageUrl,{init:function(a,b){},processed:function(a,b){},ready:function(c,d){var e=a.Stages.Main.State.SettingsController||new b;a.Stages.Main.CurrentPage(b.PageId),a.Stages.Main.State.SettingsController=e,WinJS.Namespace.define("client",e),ko.applyBindings(e,c)},error:function(a){alert("Error loading SettingsController.")}})},b.MergeAndRestore=function(a){var c=new b;return _.forOwn(a,function(a,b){var d=c[b];return ko.isObservable(d)?void d(a):void(c[b]=a)}),c},b}();b.SettingsController=c}(b=a.Stages||(a.Stages={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c=function(){function c(){}return c.State={},c.Start=function(){var d=WinJS.Application;d.onactivated=function(e){if(_.forOwn(a.Stages,function(a,b){_.has(a,"DefinePage")&&a.DefinePage()}),"Windows.Launch"===e.detail.kind){var f=WinJS.UI.processAll();ko.applyBindings(this),d.sessionState.Main=d.sessionState.Main||{},c.State=JSON.parse(d.sessionState.Main.StateJSON||"{}"),c.CurrentPage(d.sessionState.Main.LastPage),_.forOwn(c.State,function(b,d){try{_.has(a.Stages[d],"MergeAndRestore")&&(c.State[d]=a.Stages[d].MergeAndRestore(b))}catch(e){c.State[d]=null}}),f=f.then(function(){return a.Utils.LocalStorage.Retrieve("X-Stages-API-Key")?WinJS.Navigation.navigate(c.CurrentPage()?a.Stages[c.CurrentPage()].PageUrl:b.SubscriberController.PageUrl,WinJS.Navigation.state):WinJS.Navigation.navigate(b.LoginController.PageUrl,WinJS.Navigation.state)}).then(null,function(a){console.log("Error loading page",a)}),f.done(function(){console.log("Done")},function(a){console.log("Error loading page 2",a)})}},d.oncheckpoint=function(a){},d.start()},c.CurrentPage=ko.observable(),c.HandleNavigateToSubscribers=function(a,d){c.CurrentPage()!==b.SubscriberController.PageId&&(WinJS.Navigation.navigate(b.SubscriberController.PageUrl,d),c.CloseSplitviewPane())},c.HandleNavigateToFinancials=function(a,d){c.CurrentPage()!==b.FinancialController.PageId&&(WinJS.Navigation.navigate(b.FinancialController.PageUrl),c.CloseSplitviewPane())},c.HandleRefreshEvent=function(a,b){var c=window.client;c&&c.HandleRefreshEvent&&c.HandleRefreshEvent(a,b)},c.HandleNavigateToSettings=function(a,d){c.CurrentPage()!==b.SettingsController.PageId&&(WinJS.Navigation.navigate(b.SettingsController.PageUrl),c.CloseSplitviewPane())},c.CloseSplitviewPane=function(){var a=document.getElementById("splitview").winControl;a.closePane()},c}();b.Main=c}(b=a.Stages||(a.Stages={}))}(App||(App={})),App.Stages.Main.Start();
//# sourceMappingURL=app.min.js.map