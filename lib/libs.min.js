!function($){"use strict";function safe_add(x,y){var lsw=(65535&x)+(65535&y),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|65535&lsw}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function binl_md5(x,len){x[len>>5]|=128<<len%32,x[(len+64>>>9<<4)+14]=len;var i,olda,oldb,oldc,oldd,a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(i=0;i<x.length;i+=16)olda=a,oldb=b,oldc=c,oldd=d,a=md5_ff(a,b,c,d,x[i],7,-680876936),d=md5_ff(d,a,b,c,x[i+1],12,-389564586),c=md5_ff(c,d,a,b,x[i+2],17,606105819),b=md5_ff(b,c,d,a,x[i+3],22,-1044525330),a=md5_ff(a,b,c,d,x[i+4],7,-176418897),d=md5_ff(d,a,b,c,x[i+5],12,1200080426),c=md5_ff(c,d,a,b,x[i+6],17,-1473231341),b=md5_ff(b,c,d,a,x[i+7],22,-45705983),a=md5_ff(a,b,c,d,x[i+8],7,1770035416),d=md5_ff(d,a,b,c,x[i+9],12,-1958414417),c=md5_ff(c,d,a,b,x[i+10],17,-42063),b=md5_ff(b,c,d,a,x[i+11],22,-1990404162),a=md5_ff(a,b,c,d,x[i+12],7,1804603682),d=md5_ff(d,a,b,c,x[i+13],12,-40341101),c=md5_ff(c,d,a,b,x[i+14],17,-1502002290),b=md5_ff(b,c,d,a,x[i+15],22,1236535329),a=md5_gg(a,b,c,d,x[i+1],5,-165796510),d=md5_gg(d,a,b,c,x[i+6],9,-1069501632),c=md5_gg(c,d,a,b,x[i+11],14,643717713),b=md5_gg(b,c,d,a,x[i],20,-373897302),a=md5_gg(a,b,c,d,x[i+5],5,-701558691),d=md5_gg(d,a,b,c,x[i+10],9,38016083),c=md5_gg(c,d,a,b,x[i+15],14,-660478335),b=md5_gg(b,c,d,a,x[i+4],20,-405537848),a=md5_gg(a,b,c,d,x[i+9],5,568446438),d=md5_gg(d,a,b,c,x[i+14],9,-1019803690),c=md5_gg(c,d,a,b,x[i+3],14,-187363961),b=md5_gg(b,c,d,a,x[i+8],20,1163531501),a=md5_gg(a,b,c,d,x[i+13],5,-1444681467),d=md5_gg(d,a,b,c,x[i+2],9,-51403784),c=md5_gg(c,d,a,b,x[i+7],14,1735328473),b=md5_gg(b,c,d,a,x[i+12],20,-1926607734),a=md5_hh(a,b,c,d,x[i+5],4,-378558),d=md5_hh(d,a,b,c,x[i+8],11,-2022574463),c=md5_hh(c,d,a,b,x[i+11],16,1839030562),b=md5_hh(b,c,d,a,x[i+14],23,-35309556),a=md5_hh(a,b,c,d,x[i+1],4,-1530992060),d=md5_hh(d,a,b,c,x[i+4],11,1272893353),c=md5_hh(c,d,a,b,x[i+7],16,-155497632),b=md5_hh(b,c,d,a,x[i+10],23,-1094730640),a=md5_hh(a,b,c,d,x[i+13],4,681279174),d=md5_hh(d,a,b,c,x[i],11,-358537222),c=md5_hh(c,d,a,b,x[i+3],16,-722521979),b=md5_hh(b,c,d,a,x[i+6],23,76029189),a=md5_hh(a,b,c,d,x[i+9],4,-640364487),d=md5_hh(d,a,b,c,x[i+12],11,-421815835),c=md5_hh(c,d,a,b,x[i+15],16,530742520),b=md5_hh(b,c,d,a,x[i+2],23,-995338651),a=md5_ii(a,b,c,d,x[i],6,-198630844),d=md5_ii(d,a,b,c,x[i+7],10,1126891415),c=md5_ii(c,d,a,b,x[i+14],15,-1416354905),b=md5_ii(b,c,d,a,x[i+5],21,-57434055),a=md5_ii(a,b,c,d,x[i+12],6,1700485571),d=md5_ii(d,a,b,c,x[i+3],10,-1894986606),c=md5_ii(c,d,a,b,x[i+10],15,-1051523),b=md5_ii(b,c,d,a,x[i+1],21,-2054922799),a=md5_ii(a,b,c,d,x[i+8],6,1873313359),d=md5_ii(d,a,b,c,x[i+15],10,-30611744),c=md5_ii(c,d,a,b,x[i+6],15,-1560198380),b=md5_ii(b,c,d,a,x[i+13],21,1309151649),a=md5_ii(a,b,c,d,x[i+4],6,-145523070),d=md5_ii(d,a,b,c,x[i+11],10,-1120210379),c=md5_ii(c,d,a,b,x[i+2],15,718787259),b=md5_ii(b,c,d,a,x[i+9],21,-343485551),a=safe_add(a,olda),b=safe_add(b,oldb),c=safe_add(c,oldc),d=safe_add(d,oldd);return[a,b,c,d]}function binl2rstr(input){var i,output="";for(i=0;i<32*input.length;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}function rstr2binl(input){var i,output=[];for(output[(input.length>>2)-1]=void 0,i=0;i<output.length;i+=1)output[i]=0;for(i=0;i<8*input.length;i+=8)output[i>>5]|=(255&input.charCodeAt(i/8))<<i%32;return output}function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),8*s.length))}function rstr_hmac_md5(key,data){var i,hash,bkey=rstr2binl(key),ipad=[],opad=[];for(ipad[15]=opad[15]=void 0,bkey.length>16&&(bkey=binl_md5(bkey,8*key.length)),i=0;16>i;i+=1)ipad[i]=909522486^bkey[i],opad[i]=1549556828^bkey[i];return hash=binl_md5(ipad.concat(rstr2binl(data)),512+8*data.length),binl2rstr(binl_md5(opad.concat(hash),640))}function rstr2hex(input){var x,i,hex_tab="0123456789abcdef",output="";for(i=0;i<input.length;i+=1)x=input.charCodeAt(i),output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(15&x);return output}function str2rstr_utf8(input){return unescape(encodeURIComponent(input))}function raw_md5(s){return rstr_md5(str2rstr_utf8(s))}function hex_md5(s){return rstr2hex(raw_md5(s))}function raw_hmac_md5(k,d){return rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d))}function hex_hmac_md5(k,d){return rstr2hex(raw_hmac_md5(k,d))}function md5(string,key,raw){return key?raw?raw_hmac_md5(key,string):hex_hmac_md5(key,string):raw?raw_md5(string):hex_md5(string)}"function"==typeof define&&define.amd?define(function(){return md5}):$.md5=md5}(this),function(){function baseCompareAscending(value,other){if(value!==other){var valIsNull=null===value,valIsUndef=value===undefined,valIsReflexive=value===value,othIsNull=null===other,othIsUndef=other===undefined,othIsReflexive=other===other;if(value>other&&!othIsNull||!valIsReflexive||valIsNull&&!othIsUndef&&othIsReflexive||valIsUndef&&othIsReflexive)return 1;if(other>value&&!valIsNull||!othIsReflexive||othIsNull&&!valIsUndef&&valIsReflexive||othIsUndef&&valIsReflexive)return-1}return 0}function baseFindIndex(array,predicate,fromRight){for(var length=array.length,index=fromRight?length:-1;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){if(value!==value)return indexOfNaN(array,fromIndex);for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}function baseIsFunction(value){return"function"==typeof value||!1}function baseToString(value){return null==value?"":value+""}function charsLeftIndex(string,chars){for(var index=-1,length=string.length;++index<length&&chars.indexOf(string.charAt(index))>-1;);return index}function charsRightIndex(string,chars){for(var index=string.length;index--&&chars.indexOf(string.charAt(index))>-1;);return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}function compareMultiple(object,other,orders){for(var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;++index<length;){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength)return result;var order=orders[index];return result*("asc"===order||order===!0?1:-1)}}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeRegExpChar(chr,leadingChar,whitespaceChar){return leadingChar?chr=regexpEscapes[chr]:whitespaceChar&&(chr=stringEscapes[chr]),"\\"+chr}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?0:-1);fromRight?index--:++index<length;){var other=array[index];if(other!==other)return index}return-1}function isObjectLike(value){return!!value&&"object"==typeof value}function isSpace(charCode){return 160>=charCode&&charCode>=9&&13>=charCode||32==charCode||160==charCode||5760==charCode||6158==charCode||charCode>=8192&&(8202>=charCode||8232==charCode||8233==charCode||8239==charCode||8287==charCode||12288==charCode||65279==charCode)}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;)array[index]===placeholder&&(array[index]=PLACEHOLDER,result[++resIndex]=index);return result}function sortedUniq(array,iteratee){for(var seen,index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;index&&seen===computed||(seen=computed,result[++resIndex]=value)}return result}function trimmedLeftIndex(string){for(var index=-1,length=string.length;++index<length&&isSpace(string.charCodeAt(index)););return index}function trimmedRightIndex(string){for(var index=string.length;index--&&isSpace(string.charCodeAt(index)););return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value,this.__actions__=actions||[],this.__chain__=!!chainAll}function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=POSITIVE_INFINITY,this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=arrayCopy(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=arrayCopy(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=arrayCopy(this.__views__),result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else result=this.clone(),result.__dir__*=-1;return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=0>dir,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||LARGE_ARRAY_SIZE>arrLength||arrLength==length&&takeCount==length)return baseWrapperValue(array,this.__actions__);var result=[];outer:for(;length--&&takeCount>resIndex;){index+=dir;for(var iterIndex=-1,value=array[index];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG)value=computed;else if(!computed){if(type==LAZY_FILTER_FLAG)continue outer;break outer}}result[resIndex++]=value}return result}function MapCache(){this.__data__={}}function mapDelete(key){return this.has(key)&&delete this.__data__[key]}function mapGet(key){return"__proto__"==key?undefined:this.__data__[key]}function mapHas(key){return"__proto__"!=key&&hasOwnProperty.call(this.__data__,key)}function mapSet(key,value){return"__proto__"!=key&&(this.__data__[key]=value),this}function SetCache(values){var length=values?values.length:0;for(this.data={hash:nativeCreate(null),set:new Set};length--;)this.push(values[length])}function cacheIndexOf(cache,value){var data=cache.data,result="string"==typeof value||isObject(value)?data.set.has(value):data.hash[value];return result?0:-1}function cachePush(value){var data=this.data;"string"==typeof value||isObject(value)?data.set.add(value):data.hash[value]=!0}function arrayConcat(array,other){for(var index=-1,length=array.length,othIndex=-1,othLength=other.length,result=Array(length+othLength);++index<length;)result[index]=array[index];for(;++othIndex<othLength;)result[index++]=other[othIndex];return result}function arrayCopy(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&iteratee(array[index],index,array)!==!1;);return array}function arrayEachRight(array,iteratee){for(var length=array.length;length--&&iteratee(array[length],length,array)!==!1;);return array}function arrayEvery(array,predicate){for(var index=-1,length=array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayExtremum(array,iteratee,comparator,exValue){for(var index=-1,length=array.length,computed=exValue,result=computed;++index<length;){var value=array[index],current=+iteratee(value);comparator(current,computed)&&(computed=current,result=value)}return result}function arrayFilter(array,predicate){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[++resIndex]=value)}return result}function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;for(initFromArray&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initFromArray){var length=array.length;for(initFromArray&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function arraySum(array,iteratee){for(var length=array.length,result=0;length--;)result+=+iteratee(array[length])||0;return result}function assignDefaults(objectValue,sourceValue){return objectValue===undefined?sourceValue:objectValue}function assignOwnDefaults(objectValue,sourceValue,key,object){return objectValue!==undefined&&hasOwnProperty.call(object,key)?objectValue:sourceValue}function assignWith(object,source,customizer){for(var index=-1,props=keys(source),length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result===result?result===value:value!==value)&&(value!==undefined||key in object)||(object[key]=result)}return object}function baseAssign(object,source){return null==source?object:baseCopy(source,keys(source),object)}function baseAt(collection,props){for(var index=-1,isNil=null==collection,isArr=!isNil&&isArrayLike(collection),length=isArr?collection.length:0,propsLength=props.length,result=Array(propsLength);++index<propsLength;){var key=props[index];isArr?result[index]=isIndex(key,length)?collection[key]:undefined:result[index]=isNil?undefined:collection[key]}return result}function baseCopy(source,props,object){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;return"function"==type?thisArg===undefined?func:bindCallback(func,thisArg,argCount):null==func?identity:"object"==type?baseMatches(func):thisArg===undefined?property(func):baseMatchesProperty(func,thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer&&(result=object?customizer(value,key,object):customizer(value)),result!==undefined)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return arrayCopy(value,result)}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag!=objectTag&&tag!=argsTag&&(!isFunc||object))return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{};if(result=initCloneObject(isFunc?{}:value),!isDeep)return baseAssign(result,value)}stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==value)return stackB[length];return stackA.push(value),stackB.push(result),(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)}),result}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length)return result;var index=-1,indexOf=getIndexOf(),isCommon=indexOf===baseIndexOf,cache=isCommon&&values.length>=LARGE_ARRAY_SIZE?createCache(values):null,valuesLength=values.length;cache&&(indexOf=cacheIndexOf,isCommon=!1,values=cache);outer:for(;++index<length;){var value=array[index];if(isCommon&&value===value){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===value)continue outer;result.push(value)}else indexOf(values,value,0)<0&&result.push(value)}return result}function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}function baseExtremum(collection,iteratee,comparator,exValue){var computed=exValue,result=computed;return baseEach(collection,function(value,index,collection){var current=+iteratee(value,index,collection);(comparator(current,computed)||current===exValue&&current===result)&&(computed=current,result=value)}),result}function baseFill(array,value,start,end){var length=array.length;for(start=null==start?0:+start||0,0>start&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:+end||0,0>end&&(end+=length),length=start>end?0:end>>>0,start>>>=0;length>start;)array[start++]=value;return array}function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}function baseFind(collection,predicate,eachFunc,retKey){var result;return eachFunc(collection,function(value,key,collection){return predicate(value,key,collection)?(result=retKey?key:value,!1):void 0}),result}function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);for(var index=-1,length=array.length;++index<length;){var value=array[index];isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))?isDeep?baseFlatten(value,isDeep,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){for(var index=-1,length=props.length,resIndex=-1,result=[];++index<length;){var key=props[index];isFunction(object[key])&&(result[++resIndex]=key)}return result}function baseGet(object,path,pathKey){if(null!=object){pathKey!==undefined&&pathKey in toObject(object)&&(path=[pathKey]);for(var index=0,length=path.length;null!=object&&length>index;)object=object[path[index++]];return index&&index==length?object:undefined}}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){return value===other?!0:null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||(objTag=objToString.call(object),objTag==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))),othIsArr||(othTag=objToString.call(other),othTag==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other)));var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag);if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}if(!isSameTag)return!1;stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==object)return stackB[length]==other;stackA.push(object),stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);return stackA.pop(),stackB.pop(),result}function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=toObject(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object))return!1}else{var result=customizer?customizer(objValue,srcValue,key):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,!0):result))return!1}}return!0}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}function baseMatches(source){var matchData=getMatchData(source);if(1==matchData.length&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){return null==object?!1:object[key]===value&&(value!==undefined||key in toObject(object))}}return function(object){return baseIsMatch(object,matchData)}}function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";return path=toPath(path),function(object){if(null==object)return!1;var key=pathKey;if(object=toObject(object),(isArr||!isCommon)&&!(key in object)){if(object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),null==object)return!1;key=last(path),object=toObject(object)}return object[key]===srcValue?srcValue!==undefined||key in object:baseIsEqual(srcValue,object[key],undefined,!0)}}function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object))return object;var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?undefined:keys(source);return arrayEach(props||source,function(srcValue,key){if(props&&(key=srcValue,srcValue=source[key]),isObjectLike(srcValue))stackA||(stackA=[]),stackB||(stackB=[]),baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;isCommon&&(result=srcValue),result===undefined&&(!isSrcArr||key in object)||!isCommon&&(result===result?result===value:value!==value)||(object[key]=result)}}),object}function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){for(var length=stackA.length,srcValue=source[key];length--;)if(stackA[length]==srcValue)return void(object[key]=stackB[length]);var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;isCommon&&(result=srcValue,isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))?result=isArray(value)?value:isArrayLike(value)?arrayCopy(value):[]:isPlainObject(srcValue)||isArguments(srcValue)?result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}:isCommon=!1),stackA.push(srcValue),stackB.push(result),isCommon?object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB):(result===result?result!==value:value===value)&&(object[key]=result)}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePropertyDeep(path){var pathKey=path+"";return path=toPath(path),function(object){return baseGet(object,path,pathKey)}}function basePullAt(array,indexes){for(var length=array?indexes.length:0;length--;){var index=indexes[length];if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return array}function baseRandom(min,max){return min+nativeFloor(nativeRandom()*(max-min+1))}function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}function baseSlice(array,start,end){var index=-1,length=array.length;start=null==start?0:+start||0,0>start&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:+end||0,0>end&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return result=predicate(value,index,collection),!result}),!!result}function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}function baseSortByOrder(collection,iteratees,orders){var callback=getCallback(),index=-1;iteratees=arrayMap(iteratees,function(iteratee){return callback(iteratee)});var result=baseMap(collection,function(value){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function baseSum(collection,iteratee){var result=0;return baseEach(collection,function(value,index,collection){result+=+iteratee(value,index,collection)||0}),result}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf===baseIndexOf,isLarge=isCommon&&length>=LARGE_ARRAY_SIZE,seen=isLarge?createCache():null,result=[];seen?(indexOf=cacheIndexOf,isCommon=!1):(isLarge=!1,seen=iteratee?[]:result);outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else indexOf(seen,computed,0)<0&&((iteratee||isLarge)&&seen.push(computed),result.push(value))}return result}function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;result instanceof LazyWrapper&&(result=result.value());for(var index=-1,length=actions.length;++index<length;){var action=actions[index];result=action.func.apply(action.thisArg,arrayPush([result],action.args))}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if("number"==typeof value&&value===value&&HALF_MAX_ARRAY_LENGTH>=high){for(;high>low;){var mid=low+high>>>1,computed=array[mid];(retHighest?value>=computed:value>computed)&&null!==computed?low=mid+1:high=mid}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsNull=null===value,valIsUndef=value===undefined;high>low;){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),isDef=computed!==undefined,isReflexive=computed===computed;if(valIsNaN)var setLow=isReflexive||retHighest;else setLow=valIsNull?isReflexive&&isDef&&(retHighest||null!=computed):valIsUndef?isReflexive&&(retHighest||isDef):null==computed?!1:retHighest?value>=computed:value>computed;setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if(thisArg===undefined)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){var result=new ArrayBuffer(buffer.byteLength),view=new Uint8Array(result);return view.set(new Uint8Array(buffer)),result}function composeArgs(args,partials,holders){for(var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)result[holders[argsIndex]]=args[argsIndex];for(;argsLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders){for(var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);++argsIndex<argsLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)result[offset+holders[holdersIndex]]=args[argsIndex++];return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};if(iteratee=getCallback(iteratee,thisArg,3),isArray(collection))for(var index=-1,length=collection.length;++index<length;){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}else baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)});return result}}function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=null==object?0:sources.length,customizer=length>2?sources[length-2]:undefined,guard=length>2?sources[2]:undefined,thisArg=length>1?sources[length-1]:undefined;for("function"==typeof customizer?(customizer=bindCallback(customizer,thisArg,5),length-=2):(customizer="function"==typeof thisArg?thisArg:undefined,length-=customizer?1:0),guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=3>length?undefined:customizer,length=1);++index<length;){var source=sources[index];source&&assigner(object,source,customizer)}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length))return eachFunc(collection,iteratee);for(var index=fromRight?length:-1,iterable=toObject(collection);(fromRight?index--:++index<length)&&iteratee(iterable[index],index,iterable)!==!1;);return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;fromRight?index--:++index<length;){var key=props[index];if(iteratee(iterable[key],key,iterable)===!1)break}return object}}function createBindWrapper(func,thisArg){function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(thisArg,arguments)}var Ctor=createCtorWrapper(func);return wrapper}function createCache(values){return nativeCreate&&Set?new SetCache(values):null}function createCompounder(callback){return function(string){for(var index=-1,array=words(deburr(string)),length=array.length,result="";++index<length;)result=callback(result,array[index],index);return result}}function createCtorWrapper(Ctor){return function(){
var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(flag){function curryFunc(func,arity,guard){guard&&isIterateeCall(func,arity,guard)&&(arity=undefined);var result=createWrapper(func,flag,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=curryFunc.placeholder,result}return curryFunc}function createDefaults(assigner,customizer){return restParam(function(args){var object=args[0];return null==object?object:(args.push(customizer),assigner.apply(undefined,args))})}function createExtremum(comparator,exValue){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=undefined),iteratee=getCallback(iteratee,thisArg,3),1==iteratee.length){collection=isArray(collection)?collection:toIterable(collection);var result=arrayExtremum(collection,iteratee,comparator,exValue);if(!collection.length||result!==exValue)return result}return baseExtremum(collection,iteratee,comparator,exValue)}}function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){if(predicate=getCallback(predicate,thisArg,3),isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return index>-1?collection[index]:undefined}return baseFind(collection,predicate,eachFunc)}}function createFindIndex(fromRight){return function(array,predicate,thisArg){return array&&array.length?(predicate=getCallback(predicate,thisArg,3),baseFindIndex(array,predicate,fromRight)):-1}}function createFindKey(objectFunc){return function(object,predicate,thisArg){return predicate=getCallback(predicate,thisArg,3),baseFind(object,predicate,objectFunc,!0)}}function createFlow(fromRight){return function(){for(var wrapper,length=arguments.length,index=fromRight?length:-1,leftIndex=0,funcs=Array(length);fromRight?index--:++index<length;){var func=funcs[leftIndex++]=arguments[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);!wrapper&&LodashWrapper.prototype.thru&&"wrapper"==getFuncName(func)&&(wrapper=new LodashWrapper([],!0))}for(index=wrapper?-1:length;++index<length;){func=funcs[index];var funcName=getFuncName(func),data="wrapper"==funcName?getData(func):undefined;wrapper=data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE)return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}}}function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return"function"==typeof iteratee&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}function createForIn(objectFunc){return function(object,iteratee,thisArg){return("function"!=typeof iteratee||thisArg!==undefined)&&(iteratee=bindCallback(iteratee,thisArg,3)),objectFunc(object,iteratee,keysIn)}}function createForOwn(objectFunc){return function(object,iteratee,thisArg){return("function"!=typeof iteratee||thisArg!==undefined)&&(iteratee=bindCallback(iteratee,thisArg,3)),objectFunc(object,iteratee)}}function createObjectMapper(isMapKeys){return function(object,iteratee,thisArg){var result={};return iteratee=getCallback(iteratee,thisArg,3),baseForOwn(object,function(value,key,object){var mapped=iteratee(value,key,object);key=isMapKeys?mapped:key,value=isMapKeys?value:mapped,result[key]=value}),result}}function createPadDir(fromRight){return function(string,length,chars){return string=baseToString(string),(fromRight?string:"")+createPadding(string,length,chars)+(fromRight?"":string)}}function createPartial(flag){var partialFunc=restParam(function(func,partials){var holders=replaceHolders(partials,partialFunc.placeholder);return createWrapper(func,flag,undefined,partials,holders)});return partialFunc}function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return"function"==typeof iteratee&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee,accumulator,initFromArray):baseReduce(collection,getCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){function wrapper(){for(var length=arguments.length,index=length,args=Array(length);index--;)args[index]=arguments[index];if(partials&&(args=composeArgs(args,partials,holders)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight)),isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);if(length-=argsHolders.length,arity>length){var newArgPos=argPos?arrayCopy(argPos):undefined,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:undefined,newHoldersRight=isCurry?undefined:argsHolders,newPartials=isCurry?args:undefined,newPartialsRight=isCurry?undefined:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG,bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG),isCurryBound||(bitmask&=~(BIND_FLAG|BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity],result=createHybridWrapper.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,result}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return argPos&&(args=reorder(args,argPos)),isAry&&ary<args.length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtorWrapper(func)),fn.apply(thisBinding,args)}var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);return wrapper}function createPadding(string,length,chars){var strLength=string.length;if(length=+length,strLength>=length||!nativeIsFinite(length))return"";var padLength=length-strLength;return chars=null==chars?" ":chars+"",repeat(chars,nativeCeil(padLength/chars.length)).slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength);++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,args)}var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return wrapper}function createRound(methodName){var func=Math[methodName];return function(number,precision){return precision=precision===undefined?0:+precision||0,precision?(precision=pow(10,precision),func(number*precision)/precision):func(number)}}function createSortedIndex(retHighest){return function(array,value,iteratee,thisArg){var callback=getCallback(iteratee);return null==iteratee&&callback===baseCallback?binaryIndex(array,value,retHighest):binaryIndexBy(array,value,callback(iteratee,thisArg,1),retHighest)}}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG),partials=holders=undefined),length-=holders?holders.length:0,bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&(mergeData(newData,data),bitmask=newData[1],arity=newData[9]),newData[9]=null==arity?isBindKey?0:func.length:nativeMax(arity-length,0)||0,bitmask==BIND_FLAG)var result=createBindWrapper(newData[0],newData[2]);else result=bitmask!=PARTIAL_FLAG&&bitmask!=(BIND_FLAG|PARTIAL_FLAG)||newData[4].length?createHybridWrapper.apply(undefined,newData):createPartialWrapper.apply(undefined,newData);var setter=data?baseSetData:setData;return setter(result,newData)}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength))return!1;for(;++index<arrLength;){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result)continue;return!1}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)}))return!1}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))return!1}return!0}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return!1}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key)))return!1}for(var skipCtor=isLoose;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result))return!1;skipCtor||(skipCtor="constructor"==key)}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor))return!1}return!0}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;return result=result===callback?baseCallback:result,argCount?result(func,thisArg,argCount):result}function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=array?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;return result=result===indexOf?baseIndexOf:result,collection?result(collection,target,fromIndex):result}function getMatchData(object){for(var result=pairs(object),length=result.length;length--;)result[length][2]=isStrictComparable(result[length][1]);return result}function getNative(object,key){var value=null==object?undefined:object[key];return isNative(value)?value:undefined}function getView(start,end,transforms){for(var index=-1,length=transforms.length;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}function initCloneObject(object){var Ctor=object.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor||(Ctor=Object),new Ctor}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}function invokePath(object,path,args){null==object||isKey(path,object)||(path=toPath(path),object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),path=last(path));var func=null==object?object:object[path];return null==func?undefined:func.apply(object,args)}function isArrayLike(value){return null!=value&&isLength(getLength(value))}function isIndex(value,length){return value="number"==typeof value||reIsUint.test(value)?+value:-1,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&length>value}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object){var other=object[index];return value===value?value===other:other!==other}return!1}function isKey(value,object){var type=typeof value;if("string"==type&&reIsPlainProp.test(value)||"number"==type)return!0;if(isArray(value))return!1;var result=!reIsDeepProp.test(value);return result||null!=object&&value in toObject(object)}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&MAX_SAFE_INTEGER>=value}function isStrictComparable(value){return value===value&&!isObject(value)}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=ARY_FLAG>newBitmask,isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value),data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value),data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])),value=source[7],value&&(data[7]=arrayCopy(value)),srcBitmask&ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}function mergeDefaults(objectValue,sourceValue){return objectValue===undefined?sourceValue:merge(objectValue,sourceValue,mergeDefaults)}function pickByArray(object,props){object=toObject(object);for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}function pickByCallback(object,predicate){var result={};return baseForIn(object,function(value,key,object){predicate(value,key,object)&&(result[key]=value)}),result}function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}function toIterable(value){return null==value?[]:isArrayLike(value)?isObject(value)?value:Object(value):values(value)}function toObject(value){return isObject(value)?value:Object(value)}function toPath(value){if(isArray(value))return value;var result=[];return baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}function chunk(array,size,guard){size=(guard?isIterateeCall(array,size,guard):null==size)?1:nativeMax(nativeFloor(size)||1,1);for(var index=0,length=array?array.length:0,resIndex=-1,result=Array(nativeCeil(length/size));length>index;)result[++resIndex]=baseSlice(array,index,index+=size);return result}function compact(array){for(var index=-1,length=array?array.length:0,resIndex=-1,result=[];++index<length;){var value=array[index];value&&(result[++resIndex]=value)}return result}function drop(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,0>n?0:n)):[]}function dropRight(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),n=length-(+n||0),baseSlice(array,0,0>n?0:n)):[]}function dropRightWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!0,!0):[]}function dropWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!0):[]}function fill(array,value,start,end){var length=array?array.length:0;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),baseFill(array,value,start,end)):[]}function first(array){return array?array[0]:undefined}function flatten(array,isDeep,guard){var length=array?array.length:0;return guard&&isIterateeCall(array,isDeep,guard)&&(isDeep=!1),length?baseFlatten(array,isDeep):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,!0):[]}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;if("number"==typeof fromIndex)fromIndex=0>fromIndex?nativeMax(length+fromIndex,0):fromIndex;else if(fromIndex){var index=binaryIndex(array,value);return length>index&&(value===value?value===array[index]:array[index]!==array[index])?index:-1}return baseIndexOf(array,value,fromIndex||0)}function initial(array){return dropRight(array,1)}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;var index=length;if("number"==typeof fromIndex)index=(0>fromIndex?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1;else if(fromIndex){index=binaryIndex(array,value,!0)-1;var other=array[index];return(value===value?value===other:other!==other)?index:-1}if(value!==value)return indexOfNaN(array,index,!0);for(;index--;)if(array[index]===value)return index;return-1}function pull(){var args=arguments,array=args[0];if(!array||!array.length)return array;for(var index=0,indexOf=getIndexOf(),length=args.length;++index<length;)for(var fromIndex=0,value=args[index];(fromIndex=indexOf(array,value,fromIndex))>-1;)splice.call(array,fromIndex,1);return array}function remove(array,predicate,thisArg){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getCallback(predicate,thisArg,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result}function rest(array){return drop(array,1)}function slice(array,start,end){var length=array?array.length:0;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)&&(start=0,end=length),baseSlice(array,start,end)):[]}function take(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,0,0>n?0:n)):[]}function takeRight(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),n=length-(+n||0),baseSlice(array,0>n?0:n)):[]}function takeRightWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!1,!0):[]}function takeWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3)):[]}function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length)return[];null!=isSorted&&"boolean"!=typeof isSorted&&(thisArg=iteratee,iteratee=isIterateeCall(array,isSorted,thisArg)?undefined:isSorted,isSorted=!1);var callback=getCallback();return(null!=iteratee||callback!==baseCallback)&&(iteratee=callback(iteratee,thisArg,3)),isSorted&&getIndexOf()===baseIndexOf?sortedUniq(array,iteratee):baseUniq(array,iteratee)}function unzip(array){if(!array||!array.length)return[];var index=-1,length=0;array=arrayFilter(array,function(group){return isArrayLike(group)?(length=nativeMax(group.length,length),!0):void 0});for(var result=Array(length);++index<length;)result[index]=arrayMap(array,baseProperty(index));return result}function unzipWith(array,iteratee,thisArg){var length=array?array.length:0;if(!length)return[];var result=unzip(array);return null==iteratee?result:(iteratee=bindCallback(iteratee,thisArg,4),arrayMap(result,function(group){return arrayReduce(group,iteratee,undefined,!0)}))}function xor(){for(var index=-1,length=arguments.length;++index<length;){var array=arguments[index];if(isArrayLike(array))var result=result?arrayPush(baseDifference(result,array),baseDifference(array,result)):array}return result?baseUniq(result):[]}function zipObject(props,values){var index=-1,length=props?props.length:0,result={};for(!length||values||isArray(props[0])||(values=[]);++index<length;){var key=props[index];values?result[key]=values[index]:key&&(result[key[0]]=key[1])}return result}function chain(value){var result=lodash(value);return result.__chain__=!0,result}function tap(value,interceptor,thisArg){return interceptor.call(thisArg,value),value}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperPlant(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result}function wrapperReverse(){var value=this.__wrapped__,interceptor=function(value){return value.reverse()};if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),wrapped=wrapped.reverse(),wrapped.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(interceptor)}function wrapperToString(){return this.value()+""}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=undefined),("function"!=typeof predicate||thisArg!==undefined)&&(predicate=getCallback(predicate,thisArg,3)),func(collection,predicate)}function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=getCallback(predicate,thisArg,3),func(collection,predicate)}function findWhere(collection,source){return find(collection,baseMatches(source))}function includes(collection,target,fromIndex,guard){var length=collection?getLength(collection):0;return isLength(length)||(collection=values(collection),length=collection.length),fromIndex="number"!=typeof fromIndex||guard&&isIterateeCall(target,fromIndex,guard)?0:0>fromIndex?nativeMax(length+fromIndex,0):fromIndex||0,"string"==typeof collection||!isArray(collection)&&isString(collection)?length>=fromIndex&&collection.indexOf(target,fromIndex)>-1:!!length&&getIndexOf(collection,target,fromIndex)>-1}function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;return iteratee=getCallback(iteratee,thisArg,3),func(collection,iteratee)}function pluck(collection,path){return map(collection,property(path))}function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=getCallback(predicate,thisArg,3),func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):null==n){collection=toIterable(collection);var length=collection.length;return length>0?collection[baseRandom(0,length-1)]:undefined}var index=-1,result=toArray(collection),length=result.length,lastIndex=length-1;for(n=nativeMin(0>n?0:+n||0,length);++index<n;){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index],result[index]=value}return result.length=n,result}function shuffle(collection){return sample(collection,POSITIVE_INFINITY)}function size(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=undefined),("function"!=typeof predicate||thisArg!==undefined)&&(predicate=getCallback(predicate,thisArg,3)),func(collection,predicate)}function sortBy(collection,iteratee,thisArg){if(null==collection)return[];thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=undefined);var index=-1;iteratee=getCallback(iteratee,thisArg,3);var result=baseMap(collection,function(value,key,collection){return{criteria:iteratee(value,key,collection),index:++index,value:value}});return baseSortBy(result,compareAscending)}function sortByOrder(collection,iteratees,orders,guard){return null==collection?[]:(guard&&isIterateeCall(iteratees,orders,guard)&&(orders=undefined),isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),isArray(orders)||(orders=null==orders?[]:[orders]),baseSortByOrder(collection,iteratees,orders))}function where(collection,source){return filter(collection,baseMatches(source))}function after(n,func){if("function"!=typeof func){if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);var temp=n;n=func,func=temp}return n=nativeIsFinite(n=+n)?n:0,function(){return--n<1?func.apply(this,arguments):void 0}}function ary(func,n,guard){return guard&&isIterateeCall(func,n,guard)&&(n=undefined),n=func&&null==n?func.length:nativeMax(+n||0,0),createWrapper(func,ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if("function"!=typeof func){if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);var temp=n;n=func,func=temp}return function(){return--n>0&&(result=func.apply(this,arguments)),1>=n&&(func=undefined),result}}function debounce(func,wait,options){function cancel(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId&&clearTimeout(maxTimeoutId),lastCalled=0,maxTimeoutId=timeoutId=trailingCall=undefined}function complete(isCalled,id){id&&clearTimeout(id),maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=undefined))}function delayed(){var remaining=wait-(now()-stamp);0>=remaining||remaining>wait?complete(trailingCall,maxTimeoutId):timeoutId=setTimeout(delayed,remaining)}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=0>=remaining||remaining>maxWait;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=undefined),result}var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(wait=0>wait?0:+wait||0,options===!0){var leading=!0;trailing=!1}else isObject(options)&&(leading=!!options.leading,maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait),trailing="trailing"in options?!!options.trailing:trailing);return debounced.cancel=cancel,debounced}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new memoize.Cache,memoized}function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){return!predicate.apply(this,arguments)}}function once(func){return before(2,func)}function restParam(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=nativeMax(start===undefined?func.length-1:+start||0,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);++index<length;)rest[index]=args[start+index];switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);for(index=-1;++index<start;)otherArgs[index]=args[index];return otherArgs[start]=rest,func.apply(this,otherArgs)}}function spread(func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return function(array){return func.apply(this,array)}}function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return options===!1?leading=!1:isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:+wait,trailing:trailing})}function wrap(value,wrapper){return wrapper=null==wrapper?identity:wrapper,createWrapper(wrapper,PARTIAL_FLAG,undefined,[value],[])}function clone(value,isDeep,customizer,thisArg){return isDeep&&"boolean"!=typeof isDeep&&isIterateeCall(value,isDeep,customizer)?isDeep=!1:"function"==typeof isDeep&&(thisArg=customizer,customizer=isDeep,isDeep=!1),"function"==typeof customizer?baseClone(value,isDeep,bindCallback(customizer,thisArg,3)):baseClone(value,isDeep)}function cloneDeep(value,customizer,thisArg){
return"function"==typeof customizer?baseClone(value,!0,bindCallback(customizer,thisArg,3)):baseClone(value,!0)}function gt(value,other){return value>other}function gte(value,other){return value>=other}function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}function isBoolean(value){return value===!0||value===!1||isObjectLike(value)&&objToString.call(value)==boolTag}function isDate(value){return isObjectLike(value)&&objToString.call(value)==dateTag}function isElement(value){return!!value&&1===value.nodeType&&isObjectLike(value)&&!isPlainObject(value)}function isEmpty(value){return null==value?!0:isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))?!value.length:!keys(value).length}function isEqual(value,other,customizer,thisArg){customizer="function"==typeof customizer?bindCallback(customizer,thisArg,3):undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&"string"==typeof value.message&&objToString.call(value)==errorTag}function isFinite(value){return"number"==typeof value&&nativeIsFinite(value)}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isMatch(object,source,customizer,thisArg){return customizer="function"==typeof customizer?bindCallback(customizer,thisArg,3):undefined,baseIsMatch(object,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){return null==value?!1:isFunction(value)?reIsNative.test(fnToString.call(value)):isObjectLike(value)&&reIsHostCtor.test(value)}function isNull(value){return null===value}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objToString.call(value)==numberTag}function isPlainObject(value){var Ctor;if(!isObjectLike(value)||objToString.call(value)!=objectTag||isArguments(value)||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,"function"==typeof Ctor&&!(Ctor instanceof Ctor)))return!1;var result;return baseForIn(value,function(subValue,key){result=key}),result===undefined||hasOwnProperty.call(value,result)}function isRegExp(value){return isObject(value)&&objToString.call(value)==regexpTag}function isString(value){return"string"==typeof value||isObjectLike(value)&&objToString.call(value)==stringTag}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}function isUndefined(value){return value===undefined}function lt(value,other){return other>value}function lte(value,other){return other>=value}function toArray(value){var length=value?getLength(value):0;return isLength(length)?length?arrayCopy(value):[]:values(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}function create(prototype,properties,guard){var result=baseCreate(prototype);return guard&&isIterateeCall(prototype,properties,guard)&&(properties=undefined),properties?baseAssign(result,properties):result}function functions(object){return baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=null==object?undefined:baseGet(object,toPath(path),path+"");return result===undefined?defaultValue:result}function has(object,path){if(null==object)return!1;var result=hasOwnProperty.call(object,path);if(!result&&!isKey(path)){if(path=toPath(path),object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),null==object)return!1;path=last(path),result=hasOwnProperty.call(object,path)}return result||isLength(object.length)&&isIndex(path,object.length)&&(isArray(object)||isArguments(object))}function invert(object,multiValue,guard){guard&&isIterateeCall(object,multiValue,guard)&&(multiValue=undefined);for(var index=-1,props=keys(object),length=props.length,result={};++index<length;){var key=props[index],value=object[key];multiValue?hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]:result[value]=key}return result}function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,isProto="function"==typeof Ctor&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;++index<length;)result[index]=index+"";for(var key in object)skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);return result}function pairs(object){object=toObject(object);for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}function result(object,path,defaultValue){var result=null==object?undefined:object[path];return result===undefined&&(null==object||isKey(path,object)||(path=toPath(path),object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),result=null==object?undefined:object[last(path)]),result=result===undefined?defaultValue:result),isFunction(result)?result.call(object):result}function set(object,path,value){if(null==object)return object;var pathKey=path+"";path=null!=object[pathKey]||isKey(path,object)?[pathKey]:toPath(path);for(var index=-1,length=path.length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=path[index];isObject(nested)&&(index==lastIndex?nested[key]=value:null==nested[key]&&(nested[key]=isIndex(path[index+1])?[]:{})),nested=nested[key]}return object}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);if(iteratee=getCallback(iteratee,thisArg,4),null==accumulator)if(isArr||isObject(object)){var Ctor=object.constructor;accumulator=isArr?isArray(object)?new Ctor:[]:baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}else accumulator={};return(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}function values(object){return baseValues(object,keys(object))}function valuesIn(object){return baseValues(object,keysIn(object))}function inRange(value,start,end){return start=+start||0,end===undefined?(end=start,start=0):end=+end||0,value>=nativeMin(start,end)&&value<nativeMax(start,end)}function random(min,max,floating){floating&&isIterateeCall(min,max,floating)&&(max=floating=undefined);var noMin=null==min,noMax=null==max;if(null==floating&&(noMax&&"boolean"==typeof min?(floating=min,min=1):"boolean"==typeof max&&(floating=max,noMax=!0)),noMin&&noMax&&(max=1,noMax=!1),min=+min||0,noMax?(max=min,min=0):max=+max||0,floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)}return baseRandom(min,max)}function capitalize(string){return string=baseToString(string),string&&string.charAt(0).toUpperCase()+string.slice(1)}function deburr(string){return string=baseToString(string),string&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=baseToString(string),target+="";var length=string.length;return position=position===undefined?length:nativeMin(0>position?0:+position||0,length),position-=target.length,position>=0&&string.indexOf(target,position)==position}function escape(string){return string=baseToString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){return string=baseToString(string),string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,escapeRegExpChar):string||"(?:)"}function pad(string,length,chars){string=baseToString(string),length=+length;var strLength=string.length;if(strLength>=length||!nativeIsFinite(length))return string;var mid=(length-strLength)/2,leftLength=nativeFloor(mid),rightLength=nativeCeil(mid);return chars=createPadding("",rightLength,chars),chars.slice(0,leftLength)+string+chars}function parseInt(string,radix,guard){return(guard?isIterateeCall(string,radix,guard):null==radix)?radix=0:radix&&(radix=+radix),string=trim(string),nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))}function repeat(string,n){var result="";if(string=baseToString(string),n=+n,1>n||!string||!nativeIsFinite(n))return result;do n%2&&(result+=string),n=nativeFloor(n/2),string+=string;while(n);return result}function startsWith(string,target,position){return string=baseToString(string),position=null==position?0:nativeMin(0>position?0:+position||0,string.length),string.lastIndexOf(target,position)==position}function template(string,options,otherOptions){var settings=lodash.templateSettings;otherOptions&&isIterateeCall(string,options,otherOptions)&&(options=otherOptions=undefined),string=baseToString(string),options=assignWith(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var isEscaping,isEvaluating,imports=assignWith(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result}function trim(string,chars,guard){var value=string;return(string=baseToString(string))?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1):(chars+="",string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)):string}function trimLeft(string,chars,guard){var value=string;return string=baseToString(string),string?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string)):string.slice(charsLeftIndex(string,chars+"")):string}function trimRight(string,chars,guard){var value=string;return string=baseToString(string),string?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(0,trimmedRightIndex(string)+1):string.slice(0,charsRightIndex(string,chars+"")+1):string}function trunc(string,options,guard){guard&&isIterateeCall(string,options,guard)&&(options=undefined);var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(null!=options)if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length,omission="omission"in options?baseToString(options.omission):omission}else length=+options||0;if(string=baseToString(string),length>=string.length)return string;var end=length-omission.length;if(1>end)return omission;var result=string.slice(0,end);if(null==separator)return result+omission;if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);for(separator.global||(separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")),separator.lastIndex=0;match=separator.exec(substring);)newEnd=match.index;result=result.slice(0,null==newEnd?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission}function unescape(string){return string=baseToString(string),string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){return guard&&isIterateeCall(string,pattern,guard)&&(pattern=undefined),string=baseToString(string),string.match(pattern||reWords)||[]}function callback(func,thisArg,guard){return guard&&isIterateeCall(func,thisArg,guard)&&(thisArg=undefined),isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function constant(value){return function(){return value}}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,!0))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,!0))}function mixin(object,source,options){if(null==options){var isObj=isObject(source),props=isObj?keys(source):undefined,methodNames=props&&props.length?baseFunctions(source,props):undefined;(methodNames?methodNames.length:isObj)||(methodNames=!1,options=source,source=object,object=this)}methodNames||(methodNames=baseFunctions(source,keys(source)));var chain=!0,index=-1,isFunc=isFunction(object),length=methodNames.length;options===!1?chain=!1:isObject(options)&&"chain"in options&&(chain=options.chain);for(;++index<length;){var methodName=methodNames[index],func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=arrayCopy(this.__actions__);return actions.push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))}}(func))}return object}function noConflict(){return root._=oldDash,this}function noop(){}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}function propertyOf(object){return function(path){return baseGet(object,toPath(path),path+"")}}function range(start,end,step){step&&isIterateeCall(start,end,step)&&(end=step=undefined),start=+start||0,step=null==step?1:+step||0,null==end?(end=start,start=0):end=+end||0;for(var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);++index<length;)result[index]=start,start+=step;return result}function times(n,iteratee,thisArg){if(n=nativeFloor(n),1>n||!nativeIsFinite(n))return[];var index=-1,result=Array(nativeMin(n,MAX_ARRAY_LENGTH));for(iteratee=bindCallback(iteratee,thisArg,1);++index<n;)MAX_ARRAY_LENGTH>index?result[index]=iteratee(index):iteratee(index);return result}function uniqueId(prefix){var id=++idCounter;return baseToString(prefix)+id}function add(augend,addend){return(+augend||0)+(+addend||0)}function sum(collection,iteratee,thisArg){return thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=undefined),iteratee=getCallback(iteratee,thisArg,3),1==iteratee.length?arraySum(isArray(collection)?collection:toIterable(collection),iteratee):baseSum(collection,iteratee)}context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,objToString=objectProto.toString,oldDash=root._,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ArrayBuffer=context.ArrayBuffer,clearTimeout=context.clearTimeout,parseFloat=context.parseFloat,pow=Math.pow,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=getNative(context,"Set"),setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=context.Uint8Array,WeakMap=getNative(context,"WeakMap"),nativeCeil=Math.ceil,nativeCreate=getNative(Object,"create"),nativeFloor=Math.floor,nativeIsArray=getNative(Array,"isArray"),nativeIsFinite=context.isFinite,nativeKeys=getNative(Object,"keys"),nativeMax=Math.max,nativeMin=Math.min,nativeNow=getNative(Date,"now"),nativeParseInt=context.parseInt,nativeRandom=Math.random,NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY,MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1,MAX_SAFE_INTEGER=9007199254740991,metaMap=WeakMap&&new WeakMap,realNames={};lodash.support={};lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};var baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined}return result||{}}}(),baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0),baseFor=createBaseFor(),baseForRight=createBaseFor(!0),baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity,getData=metaMap?function(func){return metaMap.get(func)}:noop,getLength=baseProperty("length"),setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=HOT_COUNT)return key}else count=0;return baseSetData(key,value)}}(),difference=restParam(function(array,values){return isObjectLike(array)&&isArrayLike(array)?baseDifference(array,baseFlatten(values,!1,!0)):[]}),findIndex=createFindIndex(),findLastIndex=createFindIndex(!0),intersection=restParam(function(arrays){for(var othLength=arrays.length,othIndex=othLength,caches=Array(length),indexOf=getIndexOf(),isCommon=indexOf===baseIndexOf,result=[];othIndex--;){var value=arrays[othIndex]=isArrayLike(value=arrays[othIndex])?value:[];caches[othIndex]=isCommon&&value.length>=120?createCache(othIndex&&value):null}var array=arrays[0],index=-1,length=array?array.length:0,seen=caches[0];outer:for(;++index<length;)if(value=array[index],(seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){for(var othIndex=othLength;--othIndex;){var cache=caches[othIndex];if((cache?cacheIndexOf(cache,value):indexOf(arrays[othIndex],value,0))<0)continue outer}seen&&seen.push(value),result.push(value)}return result}),pullAt=restParam(function(array,indexes){indexes=baseFlatten(indexes);var result=baseAt(array,indexes);return basePullAt(array,indexes.sort(baseCompareAscending)),result}),sortedIndex=createSortedIndex(),sortedLastIndex=createSortedIndex(!0),union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,!1,!0))}),without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[]}),zip=restParam(unzip),zipWith=restParam(function(arrays){var length=arrays.length,iteratee=length>2?arrays[length-2]:undefined,thisArg=length>1?arrays[length-1]:undefined;return length>2&&"function"==typeof iteratee?length-=2:(iteratee=length>1&&"function"==typeof thisArg?(--length,thisArg):undefined,thisArg=undefined),arrays.length=length,unzipWith(arrays,iteratee,thisArg)}),wrapperConcat=restParam(function(values){return values=baseFlatten(values),this.thru(function(array){return arrayConcat(isArray(array)?array:[toObject(array)],values)})}),at=restParam(function(collection,props){return baseAt(collection,baseFlatten(props))}),countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1}),find=createFind(baseEach),findLast=createFind(baseEachRight,!0),forEach=createForEach(arrayEach,baseEach),forEachRight=createForEach(arrayEachRight,baseEachRight),groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]}),indexBy=createAggregator(function(result,value,key){result[key]=value}),invoke=restParam(function(collection,path,args){var index=-1,isFunc="function"==typeof path,isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value){var func=isFunc?path:isProp&&null!=value?value[path]:undefined;result[++index]=func?func.apply(value,args):invokePath(value,path,args)}),result}),partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]}),reduce=createReduce(arrayReduce,baseEach),reduceRight=createReduce(arrayReduceRight,baseEachRight),sortByAll=restParam(function(collection,iteratees){if(null==collection)return[];var guard=iteratees[2];return guard&&isIterateeCall(iteratees[0],iteratees[1],guard)&&(iteratees.length=1),baseSortByOrder(collection,baseFlatten(iteratees),[])}),now=nativeNow||function(){return(new Date).getTime()},bind=restParam(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}),bindAll=restParam(function(object,methodNames){methodNames=methodNames.length?baseFlatten(methodNames):functions(object);for(var index=-1,length=methodNames.length;++index<length;){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object}),bindKey=restParam(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}),curry=createCurry(CURRY_FLAG),curryRight=createCurry(CURRY_RIGHT_FLAG),defer=restParam(function(func,args){return baseDelay(func,1,args)}),delay=restParam(function(func,wait,args){return baseDelay(func,wait,args)}),flow=createFlow(),flowRight=createFlow(!0),modArgs=restParam(function(func,transforms){if(transforms=baseFlatten(transforms),"function"!=typeof func||!arrayEvery(transforms,baseIsFunction))throw new TypeError(FUNC_ERROR_TEXT);var length=transforms.length;return restParam(function(args){for(var index=nativeMin(args.length,length);index--;)args[index]=transforms[index](args[index]);return func.apply(this,args)})}),partial=createPartial(PARTIAL_FLAG),partialRight=createPartial(PARTIAL_RIGHT_FLAG),rearg=restParam(function(func,indexes){return createWrapper(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes))}),isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag},merge=createAssigner(baseMerge),assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)}),defaults=createDefaults(assign,assignDefaults),defaultsDeep=createDefaults(merge,mergeDefaults),findKey=createFindKey(baseForOwn),findLastKey=createFindKey(baseForOwnRight),forIn=createForIn(baseFor),forInRight=createForIn(baseForRight),forOwn=createForOwn(baseForOwn),forOwnRight=createForOwn(baseForOwnRight),keys=nativeKeys?function(object){var Ctor=null==object?undefined:object.constructor;return"function"==typeof Ctor&&Ctor.prototype===object||"function"!=typeof object&&isArrayLike(object)?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys,mapKeys=createObjectMapper(!0),mapValues=createObjectMapper(),omit=restParam(function(object,props){if(null==object)return{};if("function"!=typeof props[0]){var props=arrayMap(baseFlatten(props),String);return pickByArray(object,baseDifference(keysIn(object),props))}var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})}),pick=restParam(function(object,props){return null==object?{}:"function"==typeof props[0]?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props))}),camelCase=createCompounder(function(result,word,index){return word=word.toLowerCase(),result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)}),kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()}),padLeft=createPadDir(),padRight=createPadDir(!0),snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}),startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))}),attempt=restParam(function(func,args){try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}}),method=restParam(function(path,args){return function(object){return invokePath(object,path,args)}}),methodOf=restParam(function(object,args){return function(path){return invokePath(object,path,args)}}),ceil=createRound("ceil"),floor=createRound("floor"),max=createExtremum(gt,NEGATIVE_INFINITY),min=createExtremum(lt,POSITIVE_INFINITY),round=createRound("round");return lodash.prototype=baseLodash.prototype,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,MapCache.prototype["delete"]=mapDelete,MapCache.prototype.get=mapGet,MapCache.prototype.has=mapHas,MapCache.prototype.set=mapSet,SetCache.prototype.push=cachePush,memoize.Cache=MapCache,lodash.after=after,lodash.ary=ary,lodash.assign=assign,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.callback=callback,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.constant=constant,lodash.countBy=countBy,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flow=flow,lodash.flowRight=flowRight,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.functions=functions,lodash.groupBy=groupBy,lodash.indexBy=indexBy,lodash.initial=initial,lodash.intersection=intersection,lodash.invert=invert,lodash.invoke=invoke,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=merge,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.modArgs=modArgs,lodash.negate=negate,lodash.omit=omit,lodash.once=once,lodash.pairs=pairs,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pluck=pluck,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=pull,lodash.pullAt=pullAt,lodash.range=range,lodash.rearg=rearg,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.restParam=restParam,lodash.set=set,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sortBy,lodash.sortByAll=sortByAll,lodash.sortByOrder=sortByOrder,lodash.spread=spread,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.times=times,lodash.toArray=toArray,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.union=union,lodash.uniq=uniq,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.where=where,lodash.without=without,lodash.wrap=wrap,lodash.xor=xor,lodash.zip=zip,lodash.zipObject=zipObject,lodash.zipWith=zipWith,lodash.backflow=flowRight,lodash.collect=map,lodash.compose=flowRight,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.extend=assign,lodash.iteratee=callback,lodash.methods=functions,lodash.object=zipObject,lodash.select=filter,lodash.tail=rest,lodash.unique=uniq,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.ceil=ceil,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.deburr=deburr,lodash.endsWith=endsWith,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.findWhere=findWhere,lodash.first=first,lodash.floor=floor,lodash.get=get,lodash.gt=gt,lodash.gte=gte,lodash.has=has,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isBoolean=isBoolean,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isMatch=isMatch,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.isTypedArray=isTypedArray,lodash.isUndefined=isUndefined,lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lt=lt,lodash.lte=lte,lodash.max=max,lodash.min=min,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=now,lodash.pad=pad,lodash.padLeft=padLeft,lodash.padRight=padRight,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.result=result,lodash.round=round,lodash.runInContext=runInContext,lodash.size=size,lodash.snakeCase=snakeCase,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedLastIndex=sortedLastIndex,lodash.startCase=startCase,lodash.startsWith=startsWith,lodash.sum=sum,lodash.template=template,lodash.trim=trim,lodash.trimLeft=trimLeft,lodash.trimRight=trimRight,lodash.trunc=trunc,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.words=words,lodash.all=every,lodash.any=some,lodash.contains=includes,lodash.eq=isEqual,lodash.detect=find,lodash.foldl=reduce,lodash.foldr=reduceRight,lodash.head=first,lodash.include=includes,lodash.inject=reduce,mixin(lodash,function(){var source={};return baseForOwn(lodash,function(func,methodName){lodash.prototype[methodName]||(source[methodName]=func)}),source}(),!1),lodash.sample=sample,lodash.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(value){return sample(value,n)}):sample(this.value())},lodash.VERSION=VERSION,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash}),arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index)return new LazyWrapper(this);n=null==n?1:nativeMax(nativeFloor(n)||0,0);var result=this.clone();return filtered?result.__takeCount__=nativeMin(result.__takeCount__,n):result.__views__.push({size:n,
type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}}),arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type!=LAZY_MAP_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var result=this.clone();return result.__iteratees__.push({iteratee:getCallback(iteratee,thisArg,1),type:type}),result.__filtered__=result.__filtered__||isFilter,result}}),arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}}),arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}}),arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:property;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.reject=function(predicate,thisArg){return predicate=getCallback(predicate,thisArg,1),this.filter(function(value){return!predicate(value)})},LazyWrapper.prototype.slice=function(start,end){start=null==start?0:+start||0;var result=this;return result.__filtered__&&(start>0||0>end)?new LazyWrapper(result):(0>start?result=result.takeRight(-start):start&&(result=result.drop(start)),end!==undefined&&(end=+end||0,result=0>end?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate,thisArg){return this.reverse().takeWhile(predicate,thisArg).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(POSITIVE_INFINITY)},baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName),lodashFunc=lodash[retUnwrapped?"take"+("last"==methodName?"Right":""):methodName];lodashFunc&&(lodash.prototype[methodName]=function(){var args=retUnwrapped?[1]:arguments,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var interceptor=function(value){return retUnwrapped&&chainAll?lodashFunc(value,1)[0]:lodashFunc.apply(undefined,arrayPush([value],args))},action={func:thru,args:[interceptor],thisArg:undefined},onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll)return onlyLazy?(value=value.clone(),value.__actions__.push(action),func.call(value)):lodashFunc.call(undefined,this.value())[0];if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push(action),new LodashWrapper(result,chainAll)}return this.thru(interceptor)})}),arrayEach(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;return retUnwrapped&&!this.__chain__?func.apply(this.value(),args):this[chainName](function(value){return func.apply(value,args)})}}),baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}}),realNames[createHybridWrapper(undefined,BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.concat=wrapperConcat,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toString=wrapperToString,lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.collect=lodash.prototype.map,lodash.prototype.head=lodash.prototype.first,lodash.prototype.select=lodash.prototype.filter,lodash.prototype.tail=lodash.prototype.rest,lodash}var undefined,VERSION="3.10.1",BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",HOT_COUNT=150,HOT_SPAN=16,LARGE_ARRAY_SIZE=200,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,FUNC_ERROR_TEXT="Expected a function",PLACEHOLDER="__lodash_placeholder__",argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,reRegExpChars=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,reHasRegExpChars=RegExp(reRegExpChars.source),reComboMark=/[\u0300-\u036f\ufe20-\ufe23]/g,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reHasHexPrefix=/^0[xX]/,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^\d+$/,reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,reWords=function(){var upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")}(),contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=!1;var deburredLetters={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},objectTypes={"function":!0,object:!0},regexpEscapes={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global&&global.Object&&global,freeSelf=objectTypes[typeof self]&&self&&self.Object&&self,freeWindow=objectTypes[typeof window]&&window&&window.Object&&window,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,root=freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||freeSelf||this,_=runInContext();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=_,define(function(){return _})):freeExports&&freeModule?moduleExports?(freeModule.exports=_)._=_:freeExports._=_:root._=_}.call(this),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.moment=factory()}(this,function(){"use strict";function utils_hooks__hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return input instanceof Date||"[object Date]"===Object.prototype.toString.call(input)}function map(arr,fn){var i,res=[];for(i=0;i<arr.length;++i)res.push(fn(arr[i],i));return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b)hasOwnProp(b,i)&&(a[i]=b[i]);return hasOwnProp(b,"toString")&&(a.toString=b.toString),hasOwnProp(b,"valueOf")&&(a.valueOf=b.valueOf),a}function create_utc__createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!0).utc()}function defaultParsingFlags(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function getParsingFlags(m){return null==m._pf&&(m._pf=defaultParsingFlags()),m._pf}function valid__isValid(m){if(null==m._isValid){var flags=getParsingFlags(m);m._isValid=!(isNaN(m._d.getTime())||!(flags.overflow<0)||flags.empty||flags.invalidMonth||flags.invalidWeekday||flags.nullInput||flags.invalidFormat||flags.userInvalidated),m._strict&&(m._isValid=m._isValid&&0===flags.charsLeftOver&&0===flags.unusedTokens.length&&void 0===flags.bigHour)}return m._isValid}function valid__createInvalid(flags){var m=create_utc__createUTC(NaN);return null!=flags?extend(getParsingFlags(m),flags):getParsingFlags(m).userInvalidated=!0,m}function copyConfig(to,from){var i,prop,val;if("undefined"!=typeof from._isAMomentObject&&(to._isAMomentObject=from._isAMomentObject),"undefined"!=typeof from._i&&(to._i=from._i),"undefined"!=typeof from._f&&(to._f=from._f),"undefined"!=typeof from._l&&(to._l=from._l),"undefined"!=typeof from._strict&&(to._strict=from._strict),"undefined"!=typeof from._tzm&&(to._tzm=from._tzm),"undefined"!=typeof from._isUTC&&(to._isUTC=from._isUTC),"undefined"!=typeof from._offset&&(to._offset=from._offset),"undefined"!=typeof from._pf&&(to._pf=getParsingFlags(from)),"undefined"!=typeof from._locale&&(to._locale=from._locale),momentProperties.length>0)for(i in momentProperties)prop=momentProperties[i],val=from[prop],"undefined"!=typeof val&&(to[prop]=val);return to}function Moment(config){copyConfig(this,config),this._d=new Date(null!=config._d?config._d.getTime():NaN),updateInProgress===!1&&(updateInProgress=!0,utils_hooks__hooks.updateOffset(this),updateInProgress=!1)}function isMoment(obj){return obj instanceof Moment||null!=obj&&null!=obj._isAMomentObject}function absFloor(number){return 0>number?Math.ceil(number):Math.floor(number)}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=absFloor(coercedNumber)),value}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;len>i;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function Locale(){}function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){for(var j,next,locale,split,i=0;i<names.length;){for(split=normalizeLocale(names[i]).split("-"),j=split.length,next=normalizeLocale(names[i+1]),next=next?next.split("-"):null;j>0;){if(locale=loadLocale(split.slice(0,j).join("-")))return locale;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&"undefined"!=typeof module&&module&&module.exports)try{oldLocale=globalLocale._abbr,require("./locale/"+name),locale_locales__getSetGlobalLocale(oldLocale)}catch(e){}return locales[name]}function locale_locales__getSetGlobalLocale(key,values){var data;return key&&(data="undefined"==typeof values?locale_locales__getLocale(key):defineLocale(key,values),data&&(globalLocale=data)),globalLocale._abbr}function defineLocale(name,values){return null!==values?(values.abbr=name,locales[name]=locales[name]||new Locale,locales[name].set(values),locale_locales__getSetGlobalLocale(name),locales[name]):(delete locales[name],null)}function locale_locales__getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr&&(key=key._locale._abbr),!key)return globalLocale;if(!isArray(key)){if(locale=loadLocale(key))return locale;key=[key]}return chooseLocale(key)}function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return"string"==typeof units?aliases[units]||aliases[units.toLowerCase()]:void 0}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)hasOwnProp(inputObject,prop)&&(normalizedProp=normalizeUnits(prop),normalizedProp&&(normalizedInput[normalizedProp]=inputObject[prop]));return normalizedInput}function makeGetSet(unit,keepTime){return function(value){return null!=value?(get_set__set(this,unit,value),utils_hooks__hooks.updateOffset(this,keepTime),this):get_set__get(this,unit)}}function get_set__get(mom,unit){return mom._d["get"+(mom._isUTC?"UTC":"")+unit]()}function get_set__set(mom,unit,value){return mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}function getSet(units,value){var unit;if("object"==typeof units)for(unit in units)this.set(unit,units[unit]);else if(units=normalizeUnits(units),"function"==typeof this[units])return this[units](value);return this}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}function addFormatToken(token,padded,ordinal,callback){var func=callback;"string"==typeof callback&&(func=function(){return this[callback]()}),token&&(formatTokenFunctions[token]=func),padded&&(formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}),ordinal&&(formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)})}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;length>i;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;length>i;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.localeData()),formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format),formatFunctions[format](m)):m.localeData().invalidDate()}function expandFormat(format,locale){function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}function isFunction(sth){return"function"==typeof sth&&"[object Function]"===Object.prototype.toString.call(sth)}function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){return hasOwnProp(regexes,token)?regexes[token](config._strict,config._locale):new RegExp(unescapeFormat(token))}function unescapeFormat(s){return s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function addParseToken(token,callback){var i,func=callback;for("string"==typeof token&&(token=[token]),"number"==typeof callback&&(func=function(input,array){array[callback]=toInt(input)}),i=0;i<token.length;i++)tokens[token[i]]=func}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{},callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){null!=input&&hasOwnProp(tokens,token)&&tokens[token](input,config._a,config,token)}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function localeMonths(m){return this._months[m.month()]}function localeMonthsShort(m){return this._monthsShort[m.month()]}function localeMonthsParse(monthName,format,strict){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;12>i;i++){if(mom=create_utc__createUTC([2e3,i]),strict&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")),strict||this._monthsParse[i]||(regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"MMMM"===format&&this._longMonthsParse[i].test(monthName))return i;if(strict&&"MMM"===format&&this._shortMonthsParse[i].test(monthName))return i;if(!strict&&this._monthsParse[i].test(monthName))return i}}function setMonth(mom,value){var dayOfMonth;return"string"==typeof value&&(value=mom.localeData().monthsParse(value),"number"!=typeof value)?mom:(dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value)),mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth),mom)}function getSetMonth(value){return null!=value?(setMonth(this,value),utils_hooks__hooks.updateOffset(this,!0),this):get_set__get(this,"Month")}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}function checkOverflow(m){var overflow,a=m._a;return a&&-2===getParsingFlags(m).overflow&&(overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||24===a[HOUR]&&(0!==a[MINUTE]||0!==a[SECOND]||0!==a[MILLISECOND])?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1,getParsingFlags(m)._overflowDayOfYear&&(YEAR>overflow||overflow>DATE)&&(overflow=DATE),getParsingFlags(m).overflow=overflow),m}function warn(msg){utils_hooks__hooks.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+msg)}function deprecate(msg,fn){var firstTime=!0;return extend(function(){return firstTime&&(warn(msg+"\n"+(new Error).stack),firstTime=!1),fn.apply(this,arguments)},fn)}function deprecateSimple(name,msg){deprecations[name]||(warn(msg),deprecations[name]=!0)}function configFromISO(config){var i,l,string=config._i,match=from_string__isoRegex.exec(string);if(match){for(getParsingFlags(config).iso=!0,i=0,l=isoDates.length;l>i;i++)if(isoDates[i][1].exec(string)){config._f=isoDates[i][0];break}for(i=0,l=isoTimes.length;l>i;i++)if(isoTimes[i][1].exec(string)){config._f+=(match[6]||" ")+isoTimes[i][0];break}string.match(matchOffset)&&(config._f+="Z"),configFromStringAndFormat(config)}else config._isValid=!1}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);return null!==matched?void(config._d=new Date(+matched[1])):(configFromISO(config),void(config._isValid===!1&&(delete config._isValid,utils_hooks__hooks.createFromInputFallback(config))))}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return 1970>y&&date.setFullYear(y),date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return 1970>y&&date.setUTCFullYear(y),date}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}function getIsLeapYear(){return isLeapYear(this.year())}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();return daysToDayOfWeek>end&&(daysToDayOfWeek-=7),end-7>daysToDayOfWeek&&(daysToDayOfWeek+=7),adjustedMoment=local__createLocal(mom).add(daysToDayOfWeek,"d"),{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return null==input?week:this.add(7*(input-week),"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add(7*(input-week),"d")}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var dayOfYear,week1Jan=6+firstDayOfWeek-firstDayOfWeekOfYear,janX=createUTCDate(year,0,1+week1Jan),d=janX.getUTCDay();return firstDayOfWeek>d&&(d+=7),weekday=null!=weekday?1*weekday:firstDayOfWeek,dayOfYear=1+week1Jan+7*(week-1)-d+weekday,{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add(input-dayOfYear,"d")}function defaults(a,b,c){return null!=a?a:null!=b?b:c}function currentDateArray(config){var now=new Date;return config._useUTC?[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]:[now.getFullYear(),now.getMonth(),now.getDate()]}function configFromArray(config){var i,date,currentDate,yearToUse,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&dayOfYearFromWeekInfo(config),config._dayOfYear&&(yearToUse=defaults(config._a[YEAR],currentDate[YEAR]),config._dayOfYear>daysInYear(yearToUse)&&(getParsingFlags(config)._overflowDayOfYear=!0),date=createUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;3>i&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;7>i;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];24===config._a[HOUR]&&0===config._a[MINUTE]&&0===config._a[SECOND]&&0===config._a[MILLISECOND]&&(config._nextDay=!0,config._a[HOUR]=0),config._d=(config._useUTC?createUTCDate:createDate).apply(null,input),null!=config._tzm&&config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm),config._nextDay&&(config._a[HOUR]=24)}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp;w=config._w,null!=w.GG||null!=w.W||null!=w.E?(dow=1,doy=4,weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(local__createLocal(),1,4).year),week=defaults(w.W,1),weekday=defaults(w.E,1)):(dow=config._locale._week.dow,doy=config._locale._week.doy,weekYear=defaults(w.gg,config._a[YEAR],weekOfYear(local__createLocal(),dow,doy).year),week=defaults(w.w,1),null!=w.d?(weekday=w.d,dow>weekday&&++week):weekday=null!=w.e?w.e+dow:dow),temp=dayOfYearFromWeeks(weekYear,week,weekday,doy,dow),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear}function configFromStringAndFormat(config){if(config._f===utils_hooks__hooks.ISO_8601)return void configFromISO(config);config._a=[],getParsingFlags(config).empty=!0;var i,parsedInput,tokens,token,skipped,string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0],parsedInput&&(skipped=string.substr(0,string.indexOf(parsedInput)),skipped.length>0&&getParsingFlags(config).unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?getParsingFlags(config).empty=!1:getParsingFlags(config).unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&getParsingFlags(config).unusedTokens.push(token);getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&getParsingFlags(config).unusedInput.push(string),getParsingFlags(config).bigHour===!0&&config._a[HOUR]<=12&&config._a[HOUR]>0&&(getParsingFlags(config).bigHour=void 0),config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem),configFromArray(config),checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;return null==meridiem?hour:null!=locale.meridiemHour?locale.meridiemHour(hour,meridiem):null!=locale.isPM?(isPm=locale.isPM(meridiem),isPm&&12>hour&&(hour+=12),isPm||12!==hour||(hour=0),hour):hour}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return getParsingFlags(config).invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=copyConfig({},config),null!=config._useUTC&&(tempConfig._useUTC=config._useUTC),tempConfig._f=config._f[i],configFromStringAndFormat(tempConfig),valid__isValid(tempConfig)&&(currentScore+=getParsingFlags(tempConfig).charsLeftOver,currentScore+=10*getParsingFlags(tempConfig).unusedTokens.length,getParsingFlags(tempConfig).score=currentScore,(null==scoreToBeat||scoreToBeat>currentScore)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function configFromObject(config){if(!config._d){var i=normalizeObjectUnits(config._i);config._a=[i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],configFromArray(config)}}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));return res._nextDay&&(res.add(1,"d"),res._nextDay=void 0),res}function prepareConfig(config){var input=config._i,format=config._f;return config._locale=config._locale||locale_locales__getLocale(config._l),null===input||void 0===format&&""===input?valid__createInvalid({nullInput:!0}):("string"==typeof input&&(config._i=input=config._locale.preparse(input)),isMoment(input)?new Moment(checkOverflow(input)):(isArray(format)?configFromStringAndArray(config):format?configFromStringAndFormat(config):isDate(input)?config._d=input:configFromInput(config),config))}function configFromInput(config){var input=config._i;void 0===input?config._d=new Date:isDate(input)?config._d=new Date(+input):"string"==typeof input?configFromString(config):isArray(input)?(config._a=map(input.slice(0),function(obj){return parseInt(obj,10)}),configFromArray(config)):"object"==typeof input?configFromObject(config):"number"==typeof input?config._d=new Date(input):utils_hooks__hooks.createFromInputFallback(config)}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};return"boolean"==typeof locale&&(strict=locale,locale=void 0),c._isAMomentObject=!0,c._useUTC=c._isUTC=isUTC,c._l=locale,c._i=input,c._f=format,c._strict=strict,createFromConfig(c)}function local__createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!1)}function pickBy(fn,moments){var res,i;if(1===moments.length&&isArray(moments[0])&&(moments=moments[0]),!moments.length)return local__createLocal();for(res=moments[0],i=1;i<moments.length;++i)(!moments[i].isValid()||moments[i][fn](res))&&(res=moments[i]);return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+3*quarters+12*years,this._data={},this._locale=locale_locales__getLocale(),this._bubble()}function isDuration(obj){return obj instanceof Duration}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset(),sign="+";return 0>offset&&(offset=-offset,sign="-"),sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}function offsetFromString(string){var matches=(string||"").match(matchOffset)||[],chunk=matches[matches.length-1]||[],parts=(chunk+"").match(chunkOffset)||["-",0,0],minutes=+(60*parts[1])+toInt(parts[2]);return"+"===parts[0]?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;return model._isUTC?(res=model.clone(),diff=(isMoment(input)||isDate(input)?+input:+local__createLocal(input))-+res,res._d.setTime(+res._d+diff),utils_hooks__hooks.updateOffset(res,!1),res):local__createLocal(input).local()}function getDateOffset(m){return 15*-Math.round(m._d.getTimezoneOffset()/15)}function getSetOffset(input,keepLocalTime){var localAdjust,offset=this._offset||0;return null!=input?("string"==typeof input&&(input=offsetFromString(input)),Math.abs(input)<16&&(input=60*input),!this._isUTC&&keepLocalTime&&(localAdjust=getDateOffset(this)),this._offset=input,this._isUTC=!0,null!=localAdjust&&this.add(localAdjust,"m"),offset!==input&&(!keepLocalTime||this._changeInProgress?add_subtract__addSubtract(this,create__createDuration(input-offset,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,
utils_hooks__hooks.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?offset:getDateOffset(this)}function getSetZone(input,keepLocalTime){return null!=input?("string"!=typeof input&&(input=-input),this.utcOffset(input,keepLocalTime),this):-this.utcOffset()}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){return this._isUTC&&(this.utcOffset(0,keepLocalTime),this._isUTC=!1,keepLocalTime&&this.subtract(getDateOffset(this),"m")),this}function setOffsetToParsedOffset(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(offsetFromString(this._i)),this}function hasAlignedHourOffset(input){return input=input?local__createLocal(input).utcOffset():0,(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var c={};if(copyConfig(c,this),c=prepareConfig(c),c._a){var other=c._isUTC?create_utc__createUTC(c._a):local__createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function isLocal(){return!this._isUTC}function isUtcOffset(){return this._isUTC}function isUtc(){return this._isUTC&&0===this._offset}function create__createDuration(input,key){var sign,ret,diffRes,duration=input,match=null;return isDuration(input)?duration={ms:input._milliseconds,d:input._days,M:input._months}:"number"==typeof input?(duration={},key?duration[key]=input:duration.milliseconds=input):(match=aspNetRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=create__isoRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),d:parseIso(match[4],sign),h:parseIso(match[5],sign),m:parseIso(match[6],sign),s:parseIso(match[7],sign),w:parseIso(match[8],sign)}):null==duration?duration={}:"object"==typeof duration&&("from"in duration||"to"in duration)&&(diffRes=momentsDifference(local__createLocal(duration.from),local__createLocal(duration.to)),duration={},duration.ms=diffRes.milliseconds,duration.M=diffRes.months),ret=new Duration(duration),isDuration(input)&&hasOwnProp(input,"_locale")&&(ret._locale=input._locale),ret}function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};return res.months=other.month()-base.month()+12*(other.year()-base.year()),base.clone().add(res.months,"M").isAfter(other)&&--res.months,res.milliseconds=+other-+base.clone().add(res.months,"M"),res}function momentsDifference(base,other){var res;return other=cloneWithOffset(other,base),base.isBefore(other)?res=positiveMomentsDifference(base,other):(res=positiveMomentsDifference(other,base),res.milliseconds=-res.milliseconds,res.months=-res.months),res}function createAdder(direction,name){return function(val,period){var dur,tmp;return null===period||isNaN(+period)||(deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period)."),tmp=val,val=period,period=tmp),val="string"==typeof val?+val:val,dur=create__createDuration(val,period),add_subtract__addSubtract(this,dur,direction),this}}function add_subtract__addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=duration._days,months=duration._months;updateOffset=null==updateOffset?!0:updateOffset,milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),days&&get_set__set(mom,"Date",get_set__get(mom,"Date")+days*isAdding),months&&setMonth(mom,get_set__get(mom,"Month")+months*isAdding),updateOffset&&utils_hooks__hooks.updateOffset(mom,days||months)}function moment_calendar__calendar(time,formats){var now=time||local__createLocal(),sod=cloneWithOffset(now,this).startOf("day"),diff=this.diff(sod,"days",!0),format=-6>diff?"sameElse":-1>diff?"lastWeek":0>diff?"lastDay":1>diff?"sameDay":2>diff?"nextDay":7>diff?"nextWeek":"sameElse";return this.format(formats&&formats[format]||this.localeData().calendar(format,this,local__createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var inputMs;return units=normalizeUnits("undefined"!=typeof units?units:"millisecond"),"millisecond"===units?(input=isMoment(input)?input:local__createLocal(input),+this>+input):(inputMs=isMoment(input)?+input:+local__createLocal(input),inputMs<+this.clone().startOf(units))}function isBefore(input,units){var inputMs;return units=normalizeUnits("undefined"!=typeof units?units:"millisecond"),"millisecond"===units?(input=isMoment(input)?input:local__createLocal(input),+input>+this):(inputMs=isMoment(input)?+input:+local__createLocal(input),+this.clone().endOf(units)<inputMs)}function isBetween(from,to,units){return this.isAfter(from,units)&&this.isBefore(to,units)}function isSame(input,units){var inputMs;return units=normalizeUnits(units||"millisecond"),"millisecond"===units?(input=isMoment(input)?input:local__createLocal(input),+this===+input):(inputMs=+local__createLocal(input),+this.clone().startOf(units)<=inputMs&&inputMs<=+this.clone().endOf(units))}function diff(input,units,asFloat){var delta,output,that=cloneWithOffset(input,this),zoneDelta=6e4*(that.utcOffset()-this.utcOffset());return units=normalizeUnits(units),"year"===units||"month"===units||"quarter"===units?(output=monthDiff(this,that),"quarter"===units?output/=3:"year"===units&&(output/=12)):(delta=this-that,output="second"===units?delta/1e3:"minute"===units?delta/6e4:"hour"===units?delta/36e5:"day"===units?(delta-zoneDelta)/864e5:"week"===units?(delta-zoneDelta)/6048e5:delta),asFloat?output:absFloor(output)}function monthDiff(a,b){var anchor2,adjust,wholeMonthDiff=12*(b.year()-a.year())+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months");return 0>b-anchor?(anchor2=a.clone().add(wholeMonthDiff-1,"months"),adjust=(b-anchor)/(anchor-anchor2)):(anchor2=a.clone().add(wholeMonthDiff+1,"months"),adjust=(b-anchor)/(anchor2-anchor)),-(wholeMonthDiff+adjust)}function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function moment_format__toISOString(){var m=this.clone().utc();return 0<m.year()&&m.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function format(inputString){var output=formatMoment(this,inputString||utils_hooks__hooks.defaultFormat);return this.localeData().postformat(output)}function from(time,withoutSuffix){return this.isValid()?create__createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()}function fromNow(withoutSuffix){return this.from(local__createLocal(),withoutSuffix)}function to(time,withoutSuffix){return this.isValid()?create__createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()}function toNow(withoutSuffix){return this.to(local__createLocal(),withoutSuffix)}function locale(key){var newLocaleData;return void 0===key?this._locale._abbr:(newLocaleData=locale_locales__getLocale(key),null!=newLocaleData&&(this._locale=newLocaleData),this)}function localeData(){return this._locale}function startOf(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units&&this.weekday(0),"isoWeek"===units&&this.isoWeekday(1),"quarter"===units&&this.month(3*Math.floor(this.month()/3)),this}function endOf(units){return units=normalizeUnits(units),void 0===units||"millisecond"===units?this:this.startOf(units).add(1,"isoWeek"===units?"week":units).subtract(1,"ms")}function to_type__valueOf(){return+this._d-6e4*(this._offset||0)}function unix(){return Math.floor(+this/1e3)}function toDate(){return this._offset?new Date(+this):this._d}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function moment_valid__isValid(){return valid__isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}function weeksInYear(year,dow,doy){return weekOfYear(local__createLocal([year,11,31+dow-doy]),dow,doy).week}function getSetWeekYear(input){var year=weekOfYear(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==input?year:this.add(input-year,"y")}function getSetISOWeekYear(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add(input-year,"y")}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetQuarter(input){return null==input?Math.ceil((this.month()+1)/3):this.month(3*(input-1)+this.month()%3)}function parseWeekday(input,locale){return"string"!=typeof input?input:isNaN(input)?(input=locale.weekdaysParse(input),"number"==typeof input?input:null):parseInt(input,10)}function localeWeekdays(m){return this._weekdays[m.day()]}function localeWeekdaysShort(m){return this._weekdaysShort[m.day()]}function localeWeekdaysMin(m){return this._weekdaysMin[m.day()]}function localeWeekdaysParse(weekdayName){var i,mom,regex;for(this._weekdaysParse=this._weekdaysParse||[],i=0;7>i;i++)if(this._weekdaysParse[i]||(mom=local__createLocal([2e3,1]).day(i),regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),this._weekdaysParse[i].test(weekdayName))return i}function getSetDayOfWeek(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.localeData()),this.add(input-day,"d")):day}function getSetLocaleDayOfWeek(input){var weekday=(this.day()+7-this.localeData()._week.dow)%7;return null==input?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){return null==input?this.day()||7:this.day(this.day()%7?input:input-7)}function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}function matchMeridiem(isStrict,locale){return locale._meridiemParse}function localeIsPM(input){return"p"===(input+"").toLowerCase().charAt(0)}function localeMeridiem(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"}function parseMs(input,array){array[MILLISECOND]=toInt(1e3*("0."+input))}function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}function moment__createUnix(input){return local__createLocal(1e3*input)}function moment__createInZone(){return local__createLocal.apply(null,arguments).parseZone()}function locale_calendar__calendar(key,mom,now){var output=this._calendar[key];return"function"==typeof output?output.call(mom,now):output}function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];return format||!formatUpper?format:(this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key])}function invalidDate(){return this._invalidDate}function ordinal(number){return this._ordinal.replace("%d",number)}function preParsePostFormat(string){return string}function relative__relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)}function locale_set__set(config){var prop,i;for(i in config)prop=config[i],"function"==typeof prop?this[i]=prop:this["_"+i]=prop;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function lists__get(format,index,field,setter){var locale=locale_locales__getLocale(),utc=create_utc__createUTC().set(setter,index);return locale[field](utc,format)}function list(format,index,field,count,setter){if("number"==typeof format&&(index=format,format=void 0),format=format||"",null!=index)return lists__get(format,index,field,setter);var i,out=[];for(i=0;count>i;i++)out[i]=lists__get(format,i,field,setter);return out}function lists__listMonths(format,index){return list(format,index,"months",12,"month")}function lists__listMonthsShort(format,index){return list(format,index,"monthsShort",12,"month")}function lists__listWeekdays(format,index){return list(format,index,"weekdays",7,"day")}function lists__listWeekdaysShort(format,index){return list(format,index,"weekdaysShort",7,"day")}function lists__listWeekdaysMin(format,index){return list(format,index,"weekdaysMin",7,"day")}function duration_abs__abs(){var data=this._data;return this._milliseconds=mathAbs(this._milliseconds),this._days=mathAbs(this._days),this._months=mathAbs(this._months),data.milliseconds=mathAbs(data.milliseconds),data.seconds=mathAbs(data.seconds),data.minutes=mathAbs(data.minutes),data.hours=mathAbs(data.hours),data.months=mathAbs(data.months),data.years=mathAbs(data.years),this}function duration_add_subtract__addSubtract(duration,input,value,direction){var other=create__createDuration(input,value);return duration._milliseconds+=direction*other._milliseconds,duration._days+=direction*other._days,duration._months+=direction*other._months,duration._bubble()}function duration_add_subtract__add(input,value){return duration_add_subtract__addSubtract(this,input,value,1)}function duration_add_subtract__subtract(input,value){return duration_add_subtract__addSubtract(this,input,value,-1)}function absCeil(number){return 0>number?Math.floor(number):Math.ceil(number)}function bubble(){var seconds,minutes,hours,years,monthsFromDays,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data;return milliseconds>=0&&days>=0&&months>=0||0>=milliseconds&&0>=days&&0>=months||(milliseconds+=864e5*absCeil(monthsToDays(months)+days),days=0,months=0),data.milliseconds=milliseconds%1e3,seconds=absFloor(milliseconds/1e3),data.seconds=seconds%60,minutes=absFloor(seconds/60),data.minutes=minutes%60,hours=absFloor(minutes/60),data.hours=hours%24,days+=absFloor(hours/24),monthsFromDays=absFloor(daysToMonths(days)),months+=monthsFromDays,days-=absCeil(monthsToDays(monthsFromDays)),years=absFloor(months/12),months%=12,data.days=days,data.months=months,data.years=years,this}function daysToMonths(days){return 4800*days/146097}function monthsToDays(months){return 146097*months/4800}function as(units){var days,months,milliseconds=this._milliseconds;if(units=normalizeUnits(units),"month"===units||"year"===units)return days=this._days+milliseconds/864e5,months=this._months+daysToMonths(days),"month"===units?months:months/12;switch(days=this._days+Math.round(monthsToDays(this._months)),units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return 24*days+milliseconds/36e5;case"minute":return 1440*days+milliseconds/6e4;case"second":return 86400*days+milliseconds/1e3;case"millisecond":return Math.floor(864e5*days)+milliseconds;default:throw new Error("Unknown unit "+units)}}function duration_as__valueOf(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)}function makeAs(alias){return function(){return this.as(alias)}}function duration_get__get(units){return units=normalizeUnits(units),this[units+"s"]()}function makeGetter(name){return function(){return this._data[name]}}function weeks(){return absFloor(this.days()/7)}function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function duration_humanize__relativeTime(posNegDuration,withoutSuffix,locale){var duration=create__createDuration(posNegDuration).abs(),seconds=round(duration.as("s")),minutes=round(duration.as("m")),hours=round(duration.as("h")),days=round(duration.as("d")),months=round(duration.as("M")),years=round(duration.as("y")),a=seconds<thresholds.s&&["s",seconds]||1===minutes&&["m"]||minutes<thresholds.m&&["mm",minutes]||1===hours&&["h"]||hours<thresholds.h&&["hh",hours]||1===days&&["d"]||days<thresholds.d&&["dd",days]||1===months&&["M"]||months<thresholds.M&&["MM",months]||1===years&&["y"]||["yy",years];return a[2]=withoutSuffix,a[3]=+posNegDuration>0,a[4]=locale,substituteTimeAgo.apply(null,a)}function duration_humanize__getSetRelativeTimeThreshold(threshold,limit){return void 0===thresholds[threshold]?!1:void 0===limit?thresholds[threshold]:(thresholds[threshold]=limit,!0)}function humanize(withSuffix){var locale=this.localeData(),output=duration_humanize__relativeTime(this,!withSuffix,locale);return withSuffix&&(output=locale.pastFuture(+this,output)),locale.postformat(output)}function iso_string__toISOString(){var minutes,hours,years,seconds=iso_string__abs(this._milliseconds)/1e3,days=iso_string__abs(this._days),months=iso_string__abs(this._months);minutes=absFloor(seconds/60),hours=absFloor(minutes/60),seconds%=60,minutes%=60,years=absFloor(months/12),months%=12;var Y=years,M=months,D=days,h=hours,m=minutes,s=seconds,total=this.asSeconds();return total?(0>total?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":""):"P0D"}var hookCallback,globalLocale,momentProperties=utils_hooks__hooks.momentProperties=[],updateInProgress=!1,locales={},aliases={},formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,formatFunctions={},formatTokenFunctions={},match1=/\d/,match2=/\d\d/,match3=/\d{3}/,match4=/\d{4}/,match6=/[+-]?\d{6}/,match1to2=/\d\d?/,match1to3=/\d{1,3}/,match1to4=/\d{1,4}/,match1to6=/[+-]?\d{1,6}/,matchUnsigned=/\d+/,matchSigned=/[+-]?\d+/,matchOffset=/Z|[+-]\d\d:?\d\d/gi,matchTimestamp=/[+-]?\d+(\.\d{1,3})?/,matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,regexes={},tokens={},YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6;addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1}),addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)}),addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)}),addUnitAlias("month","M"),addRegexToken("M",match1to2),addRegexToken("MM",match1to2,match2),addRegexToken("MMM",matchWord),addRegexToken("MMMM",matchWord),addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1}),addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);null!=month?array[MONTH]=month:getParsingFlags(config).invalidMonth=input});var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),deprecations={};utils_hooks__hooks.suppressDeprecationWarnings=!1;var from_string__isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;utils_hooks__hooks.createFromInputFallback=deprecate("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))}),addFormatToken(0,["YY",2],0,function(){return this.year()%100}),addFormatToken(0,["YYYY",4],0,"year"),addFormatToken(0,["YYYYY",5],0,"year"),addFormatToken(0,["YYYYYY",6,!0],0,"year"),addUnitAlias("year","y"),addRegexToken("Y",matchSigned),addRegexToken("YY",match1to2,match2),addRegexToken("YYYY",match1to4,match4),addRegexToken("YYYYY",match1to6,match6),addRegexToken("YYYYYY",match1to6,match6),addParseToken(["YYYYY","YYYYYY"],YEAR),addParseToken("YYYY",function(input,array){array[YEAR]=2===input.length?utils_hooks__hooks.parseTwoDigitYear(input):toInt(input)}),addParseToken("YY",function(input,array){array[YEAR]=utils_hooks__hooks.parseTwoDigitYear(input)}),utils_hooks__hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",!1);addFormatToken("w",["ww",2],"wo","week"),addFormatToken("W",["WW",2],"Wo","isoWeek"),addUnitAlias("week","w"),addUnitAlias("isoWeek","W"),addRegexToken("w",match1to2),addRegexToken("ww",match1to2,match2),addRegexToken("W",match1to2),addRegexToken("WW",match1to2,match2),addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});var defaultLocaleWeek={dow:0,doy:6};addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear"),addUnitAlias("dayOfYear","DDD"),addRegexToken("DDD",match1to3),addRegexToken("DDDD",match3),addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)}),utils_hooks__hooks.ISO_8601=function(){};var prototypeMin=deprecate("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return this>other?this:other}),prototypeMax=deprecate("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return other>this?this:other});offset("Z",":"),offset("ZZ",""),addRegexToken("Z",matchOffset),addRegexToken("ZZ",matchOffset),addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=!0,config._tzm=offsetFromString(input)});var chunkOffset=/([\+\-]|\d\d)/gi;utils_hooks__hooks.updateOffset=function(){};var aspNetRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,create__isoRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;create__createDuration.fn=Duration.prototype;var add_subtract__add=createAdder(1,"add"),add_subtract__subtract=createAdder(-1,"subtract");utils_hooks__hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){return void 0===key?this.localeData():this.locale(key)});addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100}),addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100}),addWeekYearFormatToken("gggg","weekYear"),addWeekYearFormatToken("ggggg","weekYear"),addWeekYearFormatToken("GGGG","isoWeekYear"),addWeekYearFormatToken("GGGGG","isoWeekYear"),addUnitAlias("weekYear","gg"),addUnitAlias("isoWeekYear","GG"),addRegexToken("G",matchSigned),addRegexToken("g",matchSigned),addRegexToken("GG",match1to2,match2),addRegexToken("gg",match1to2,match2),addRegexToken("GGGG",match1to4,match4),addRegexToken("gggg",match1to4,match4),addRegexToken("GGGGG",match1to6,match6),addRegexToken("ggggg",match1to6,match6),addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)}),addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=utils_hooks__hooks.parseTwoDigitYear(input)}),addFormatToken("Q",0,0,"quarter"),addUnitAlias("quarter","Q"),addRegexToken("Q",match1),addParseToken("Q",function(input,array){array[MONTH]=3*(toInt(input)-1)}),addFormatToken("D",["DD",2],"Do","date"),addUnitAlias("date","D"),addRegexToken("D",match1to2),addRegexToken("DD",match1to2,match2),addRegexToken("Do",function(isStrict,locale){return isStrict?locale._ordinalParse:locale._ordinalParseLenient}),addParseToken(["D","DD"],DATE),addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",!0);addFormatToken("d",0,"do","day"),addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)}),addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)}),addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)}),addFormatToken("e",0,0,"weekday"),addFormatToken("E",0,0,"isoWeekday"),addUnitAlias("day","d"),addUnitAlias("weekday","e"),addUnitAlias("isoWeekday","E"),addRegexToken("d",match1to2),addRegexToken("e",match1to2),addRegexToken("E",match1to2),addRegexToken("dd",matchWord),addRegexToken("ddd",matchWord),addRegexToken("dddd",matchWord),addWeekParseToken(["dd","ddd","dddd"],function(input,week,config){var weekday=config._locale.weekdaysParse(input);null!=weekday?week.d=weekday:getParsingFlags(config).invalidWeekday=input}),addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");addFormatToken("H",["HH",2],0,"hour"),addFormatToken("h",["hh",2],0,function(){return this.hours()%12||12}),meridiem("a",!0),meridiem("A",!1),addUnitAlias("hour","h"),addRegexToken("a",matchMeridiem),addRegexToken("A",matchMeridiem),addRegexToken("H",match1to2),addRegexToken("h",match1to2),addRegexToken("HH",match1to2,match2),addRegexToken("hh",match1to2,match2),addParseToken(["H","HH"],HOUR),addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input),config._meridiem=input}),addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input),getParsingFlags(config).bigHour=!0});var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i,getSetHour=makeGetSet("Hours",!0);addFormatToken("m",["mm",2],0,"minute"),addUnitAlias("minute","m"),addRegexToken("m",match1to2),addRegexToken("mm",match1to2,match2),addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second"),addUnitAlias("second","s"),addRegexToken("s",match1to2),addRegexToken("ss",match1to2,match2),addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",!1);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)}),addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),addFormatToken(0,["SSS",3],0,"millisecond"),addFormatToken(0,["SSSS",4],0,function(){return 10*this.millisecond()}),addFormatToken(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),addFormatToken(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),addFormatToken(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),addFormatToken(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),addFormatToken(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),addUnitAlias("millisecond","ms"),addRegexToken("S",match1to3,match1),addRegexToken("SS",match1to3,match2),addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S")addRegexToken(token,matchUnsigned);for(token="S";token.length<=9;token+="S")addParseToken(token,parseMs);var getSetMillisecond=makeGetSet("Milliseconds",!1);addFormatToken("z",0,0,"zoneAbbr"),addFormatToken("zz",0,0,"zoneName");var momentPrototype__proto=Moment.prototype;momentPrototype__proto.add=add_subtract__add,momentPrototype__proto.calendar=moment_calendar__calendar,momentPrototype__proto.clone=clone,momentPrototype__proto.diff=diff,momentPrototype__proto.endOf=endOf,momentPrototype__proto.format=format,momentPrototype__proto.from=from,momentPrototype__proto.fromNow=fromNow,momentPrototype__proto.to=to,momentPrototype__proto.toNow=toNow,momentPrototype__proto.get=getSet,momentPrototype__proto.invalidAt=invalidAt,momentPrototype__proto.isAfter=isAfter,momentPrototype__proto.isBefore=isBefore,momentPrototype__proto.isBetween=isBetween,momentPrototype__proto.isSame=isSame,momentPrototype__proto.isValid=moment_valid__isValid,momentPrototype__proto.lang=lang,momentPrototype__proto.locale=locale,momentPrototype__proto.localeData=localeData,momentPrototype__proto.max=prototypeMax,momentPrototype__proto.min=prototypeMin,momentPrototype__proto.parsingFlags=parsingFlags,momentPrototype__proto.set=getSet,momentPrototype__proto.startOf=startOf,momentPrototype__proto.subtract=add_subtract__subtract,momentPrototype__proto.toArray=toArray,momentPrototype__proto.toObject=toObject,momentPrototype__proto.toDate=toDate,momentPrototype__proto.toISOString=moment_format__toISOString,momentPrototype__proto.toJSON=moment_format__toISOString,momentPrototype__proto.toString=toString,momentPrototype__proto.unix=unix,momentPrototype__proto.valueOf=to_type__valueOf,momentPrototype__proto.year=getSetYear,momentPrototype__proto.isLeapYear=getIsLeapYear,momentPrototype__proto.weekYear=getSetWeekYear,momentPrototype__proto.isoWeekYear=getSetISOWeekYear,momentPrototype__proto.quarter=momentPrototype__proto.quarters=getSetQuarter,momentPrototype__proto.month=getSetMonth,momentPrototype__proto.daysInMonth=getDaysInMonth,momentPrototype__proto.week=momentPrototype__proto.weeks=getSetWeek,momentPrototype__proto.isoWeek=momentPrototype__proto.isoWeeks=getSetISOWeek,momentPrototype__proto.weeksInYear=getWeeksInYear,momentPrototype__proto.isoWeeksInYear=getISOWeeksInYear,momentPrototype__proto.date=getSetDayOfMonth,momentPrototype__proto.day=momentPrototype__proto.days=getSetDayOfWeek,momentPrototype__proto.weekday=getSetLocaleDayOfWeek,momentPrototype__proto.isoWeekday=getSetISODayOfWeek,momentPrototype__proto.dayOfYear=getSetDayOfYear,momentPrototype__proto.hour=momentPrototype__proto.hours=getSetHour,momentPrototype__proto.minute=momentPrototype__proto.minutes=getSetMinute,momentPrototype__proto.second=momentPrototype__proto.seconds=getSetSecond,momentPrototype__proto.millisecond=momentPrototype__proto.milliseconds=getSetMillisecond,momentPrototype__proto.utcOffset=getSetOffset,momentPrototype__proto.utc=setOffsetToUTC,momentPrototype__proto.local=setOffsetToLocal,momentPrototype__proto.parseZone=setOffsetToParsedOffset,momentPrototype__proto.hasAlignedHourOffset=hasAlignedHourOffset,momentPrototype__proto.isDST=isDaylightSavingTime,momentPrototype__proto.isDSTShifted=isDaylightSavingTimeShifted,momentPrototype__proto.isLocal=isLocal,momentPrototype__proto.isUtcOffset=isUtcOffset,momentPrototype__proto.isUtc=isUtc,momentPrototype__proto.isUTC=isUtc,momentPrototype__proto.zoneAbbr=getZoneAbbr,momentPrototype__proto.zoneName=getZoneName,momentPrototype__proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth),momentPrototype__proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth),
momentPrototype__proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear),momentPrototype__proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",getSetZone);var momentPrototype=momentPrototype__proto,defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},defaultInvalidDate="Invalid date",defaultOrdinal="%d",defaultOrdinalParse=/\d{1,2}/,defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},prototype__proto=Locale.prototype;prototype__proto._calendar=defaultCalendar,prototype__proto.calendar=locale_calendar__calendar,prototype__proto._longDateFormat=defaultLongDateFormat,prototype__proto.longDateFormat=longDateFormat,prototype__proto._invalidDate=defaultInvalidDate,prototype__proto.invalidDate=invalidDate,prototype__proto._ordinal=defaultOrdinal,prototype__proto.ordinal=ordinal,prototype__proto._ordinalParse=defaultOrdinalParse,prototype__proto.preparse=preParsePostFormat,prototype__proto.postformat=preParsePostFormat,prototype__proto._relativeTime=defaultRelativeTime,prototype__proto.relativeTime=relative__relativeTime,prototype__proto.pastFuture=pastFuture,prototype__proto.set=locale_set__set,prototype__proto.months=localeMonths,prototype__proto._months=defaultLocaleMonths,prototype__proto.monthsShort=localeMonthsShort,prototype__proto._monthsShort=defaultLocaleMonthsShort,prototype__proto.monthsParse=localeMonthsParse,prototype__proto.week=localeWeek,prototype__proto._week=defaultLocaleWeek,prototype__proto.firstDayOfYear=localeFirstDayOfYear,prototype__proto.firstDayOfWeek=localeFirstDayOfWeek,prototype__proto.weekdays=localeWeekdays,prototype__proto._weekdays=defaultLocaleWeekdays,prototype__proto.weekdaysMin=localeWeekdaysMin,prototype__proto._weekdaysMin=defaultLocaleWeekdaysMin,prototype__proto.weekdaysShort=localeWeekdaysShort,prototype__proto._weekdaysShort=defaultLocaleWeekdaysShort,prototype__proto.weekdaysParse=localeWeekdaysParse,prototype__proto.isPM=localeIsPM,prototype__proto._meridiemParse=defaultLocaleMeridiemParse,prototype__proto.meridiem=localeMeridiem,locale_locales__getSetGlobalLocale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}}),utils_hooks__hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",locale_locales__getSetGlobalLocale),utils_hooks__hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",locale_locales__getLocale);var mathAbs=Math.abs,asMilliseconds=makeAs("ms"),asSeconds=makeAs("s"),asMinutes=makeAs("m"),asHours=makeAs("h"),asDays=makeAs("d"),asWeeks=makeAs("w"),asMonths=makeAs("M"),asYears=makeAs("y"),milliseconds=makeGetter("milliseconds"),seconds=makeGetter("seconds"),minutes=makeGetter("minutes"),hours=makeGetter("hours"),days=makeGetter("days"),months=makeGetter("months"),years=makeGetter("years"),round=Math.round,thresholds={s:45,m:45,h:22,d:26,M:11},iso_string__abs=Math.abs,duration_prototype__proto=Duration.prototype;duration_prototype__proto.abs=duration_abs__abs,duration_prototype__proto.add=duration_add_subtract__add,duration_prototype__proto.subtract=duration_add_subtract__subtract,duration_prototype__proto.as=as,duration_prototype__proto.asMilliseconds=asMilliseconds,duration_prototype__proto.asSeconds=asSeconds,duration_prototype__proto.asMinutes=asMinutes,duration_prototype__proto.asHours=asHours,duration_prototype__proto.asDays=asDays,duration_prototype__proto.asWeeks=asWeeks,duration_prototype__proto.asMonths=asMonths,duration_prototype__proto.asYears=asYears,duration_prototype__proto.valueOf=duration_as__valueOf,duration_prototype__proto._bubble=bubble,duration_prototype__proto.get=duration_get__get,duration_prototype__proto.milliseconds=milliseconds,duration_prototype__proto.seconds=seconds,duration_prototype__proto.minutes=minutes,duration_prototype__proto.hours=hours,duration_prototype__proto.days=days,duration_prototype__proto.weeks=weeks,duration_prototype__proto.months=months,duration_prototype__proto.years=years,duration_prototype__proto.humanize=humanize,duration_prototype__proto.toISOString=iso_string__toISOString,duration_prototype__proto.toString=iso_string__toISOString,duration_prototype__proto.toJSON=iso_string__toISOString,duration_prototype__proto.locale=locale,duration_prototype__proto.localeData=localeData,duration_prototype__proto.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",iso_string__toISOString),duration_prototype__proto.lang=lang,addFormatToken("X",0,0,"unix"),addFormatToken("x",0,0,"valueOf"),addRegexToken("x",matchSigned),addRegexToken("X",matchTimestamp),addParseToken("X",function(input,array,config){config._d=new Date(1e3*parseFloat(input,10))}),addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))}),utils_hooks__hooks.version="2.10.6",setHookCallback(local__createLocal),utils_hooks__hooks.fn=momentPrototype,utils_hooks__hooks.min=min,utils_hooks__hooks.max=max,utils_hooks__hooks.utc=create_utc__createUTC,utils_hooks__hooks.unix=moment__createUnix,utils_hooks__hooks.months=lists__listMonths,utils_hooks__hooks.isDate=isDate,utils_hooks__hooks.locale=locale_locales__getSetGlobalLocale,utils_hooks__hooks.invalid=valid__createInvalid,utils_hooks__hooks.duration=create__createDuration,utils_hooks__hooks.isMoment=isMoment,utils_hooks__hooks.weekdays=lists__listWeekdays,utils_hooks__hooks.parseZone=moment__createInZone,utils_hooks__hooks.localeData=locale_locales__getLocale,utils_hooks__hooks.isDuration=isDuration,utils_hooks__hooks.monthsShort=lists__listMonthsShort,utils_hooks__hooks.weekdaysMin=lists__listWeekdaysMin,utils_hooks__hooks.defineLocale=defineLocale,utils_hooks__hooks.weekdaysShort=lists__listWeekdaysShort,utils_hooks__hooks.normalizeUnits=normalizeUnits,utils_hooks__hooks.relativeTimeThreshold=duration_humanize__getSetRelativeTimeThreshold;var _moment=utils_hooks__hooks;return _moment}),!function(name,context,definition){"undefined"!=typeof module&&module.exports?module.exports=definition():"function"==typeof define&&define.amd?define(definition):context[name]=definition()}("reqwest",this,function(){function succeed(r){var protocol=protocolRe.exec(r.url);return protocol=protocol&&protocol[1]||context.location.protocol,httpsRe.test(protocol)?twoHundo.test(r.request.status):!!r.request.response}function handleReadyState(r,success,error){return function(){return r._aborted?error(r.request):r._timedOut?error(r.request,"Request is aborted: timeout"):void(r.request&&4==r.request[readyState]&&(r.request.onreadystatechange=noop,succeed(r)?success(r.request):error(r.request)))}}function setHeaders(http,o){var h,headers=o.headers||{};headers.Accept=headers.Accept||defaultHeaders.accept[o.type]||defaultHeaders.accept["*"];var isAFormData="undefined"!=typeof FormData&&o.data instanceof FormData;o.crossOrigin||headers[requestedWith]||(headers[requestedWith]=defaultHeaders.requestedWith),headers[contentType]||isAFormData||(headers[contentType]=o.contentType||defaultHeaders.contentType);for(h in headers)headers.hasOwnProperty(h)&&"setRequestHeader"in http&&http.setRequestHeader(h,headers[h])}function setCredentials(http,o){"undefined"!=typeof o.withCredentials&&"undefined"!=typeof http.withCredentials&&(http.withCredentials=!!o.withCredentials)}function generalCallback(data){lastValue=data}function urlappend(url,s){return url+(/\?/.test(url)?"&":"?")+s}function handleJsonp(o,fn,err,url){var reqId=uniqid++,cbkey=o.jsonpCallback||"callback",cbval=o.jsonpCallbackName||reqwest.getcallbackPrefix(reqId),cbreg=new RegExp("((^|\\?|&)"+cbkey+")=([^&]+)"),match=url.match(cbreg),script=doc.createElement("script"),loaded=0,isIE10=-1!==navigator.userAgent.indexOf("MSIE 10.0");return match?"?"===match[3]?url=url.replace(cbreg,"$1="+cbval):cbval=match[3]:url=urlappend(url,cbkey+"="+cbval),context[cbval]=generalCallback,script.type="text/javascript",script.src=url,script.async=!0,"undefined"==typeof script.onreadystatechange||isIE10||(script.htmlFor=script.id="_reqwest_"+reqId),script.onload=script.onreadystatechange=function(){return script[readyState]&&"complete"!==script[readyState]&&"loaded"!==script[readyState]||loaded?!1:(script.onload=script.onreadystatechange=null,script.onclick&&script.onclick(),fn(lastValue),lastValue=void 0,head.removeChild(script),void(loaded=1))},head.appendChild(script),{abort:function(){script.onload=script.onreadystatechange=null,err({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(script),loaded=1}}}function getRequest(fn,err){var http,o=this.o,method=(o.method||"GET").toUpperCase(),url="string"==typeof o?o:o.url,data=o.processData!==!1&&o.data&&"string"!=typeof o.data?reqwest.toQueryString(o.data):o.data||null,sendWait=!1;return"jsonp"!=o.type&&"GET"!=method||!data||(url=urlappend(url,data),data=null),"jsonp"==o.type?handleJsonp(o,fn,err,url):(http=o.xhr&&o.xhr(o)||xhr(o),http.open(method,url,o.async===!1?!1:!0),setHeaders(http,o),setCredentials(http,o),context[xDomainRequest]&&http instanceof context[xDomainRequest]?(http.onload=fn,http.onerror=err,http.onprogress=function(){},sendWait=!0):http.onreadystatechange=handleReadyState(this,fn,err),o.before&&o.before(http),sendWait?setTimeout(function(){http.send(data)},200):http.send(data),http)}function Reqwest(o,fn){this.o=o,this.fn=fn,init.apply(this,arguments)}function setType(header){return null!==header?header.match("json")?"json":header.match("javascript")?"js":header.match("text")?"html":header.match("xml")?"xml":void 0:void 0}function init(o,fn){function complete(resp){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(resp)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(resp,msg,t){for(resp=self.request,self._responseArgs.resp=resp,self._responseArgs.msg=msg,self._responseArgs.t=t,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(resp,msg,t);complete(resp)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(o,fn){return new Reqwest(o,fn)}function normalize(s){return s?s.replace(/\r?\n/g,"\r\n"):""}function serial(el,cb){var ch,ra,val,i,n=el.name,t=el.tagName.toLowerCase(),optCb=function(o){o&&!o.disabled&&cb(n,normalize(o.attributes.value&&o.attributes.value.specified?o.value:o.text))};if(!el.disabled&&n)switch(t){case"input":/reset|button|image|file/i.test(el.type)||(ch=/checkbox/i.test(el.type),ra=/radio/i.test(el.type),val=el.value,(!(ch||ra)||el.checked)&&cb(n,normalize(ch&&""===val?"on":val)));break;case"textarea":cb(n,normalize(el.value));break;case"select":if("select-one"===el.type.toLowerCase())optCb(el.selectedIndex>=0?el.options[el.selectedIndex]:null);else for(i=0;el.length&&i<el.length;i++)el.options[i].selected&&optCb(el.options[i])}}function eachFormElement(){var e,i,cb=this,serializeSubtags=function(e,tags){var i,j,fa;for(i=0;i<tags.length;i++)for(fa=e[byTag](tags[i]),j=0;j<fa.length;j++)serial(fa[j],cb)};for(i=0;i<arguments.length;i++)e=arguments[i],/input|select|textarea/i.test(e.tagName)&&serial(e,cb),serializeSubtags(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var hash={};return eachFormElement.apply(function(name,value){name in hash?(hash[name]&&!isArray(hash[name])&&(hash[name]=[hash[name]]),hash[name].push(value)):hash[name]=value},arguments),hash}function buildParams(prefix,obj,traditional,add){var name,i,v,rbracket=/\[\]$/;if(isArray(obj))for(i=0;obj&&i<obj.length;i++)v=obj[i],traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add);else if(obj&&"[object Object]"===obj.toString())for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(o){if(o.crossOrigin===!0){var xhr=context[xmlHttpRequest]?new XMLHttpRequest:null;if(xhr&&"withCredentials"in xhr)return xhr;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(data){return data}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(success,fail){return success=success||function(){},fail=fail||function(){},this._fulfilled?this._responseArgs.resp=success(this._responseArgs.resp):this._erred?fail(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(success),this._errorHandlers.push(fail)),this},always:function(fn){return this._fulfilled||this._erred?fn(this._responseArgs.resp):this._completeHandlers.push(fn),this},fail:function(fn){return this._erred?fn(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(fn),this},"catch":function(fn){return this.fail(fn)}},reqwest.serializeArray=function(){var arr=[];return eachFormElement.apply(function(name,value){arr.push({name:name,value:value})},arguments),arr},reqwest.serialize=function(){if(0===arguments.length)return"";var opt,fn,args=Array.prototype.slice.call(arguments,0);return opt=args.pop(),opt&&opt.nodeType&&args.push(opt)&&(opt=null),opt&&(opt=opt.type),fn="map"==opt?serializeHash:"array"==opt?reqwest.serializeArray:serializeQueryString,fn.apply(null,args)},reqwest.toQueryString=function(o,trad){var prefix,i,traditional=trad||!1,s=[],enc=encodeURIComponent,add=function(key,value){value="function"==typeof value?value():null==value?"":value,s[s.length]=enc(key)+"="+enc(value)};if(isArray(o))for(i=0;o&&i<o.length;i++)add(o[i].name,o[i].value);else for(prefix in o)o.hasOwnProperty(prefix)&&buildParams(prefix,o[prefix],traditional,add);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(o,fn){return o&&(o.type&&(o.method=o.type)&&delete o.type,o.dataType&&(o.type=o.dataType),o.jsonpCallback&&(o.jsonpCallbackName=o.jsonpCallback)&&delete o.jsonpCallback,o.jsonp&&(o.jsonpCallback=o.jsonp)),new Reqwest(o,fn)},reqwest.ajaxSetup=function(options){options=options||{};for(var k in options)globalSetupOptions[k]=options[k]},reqwest}),function(){var globalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};!function(factory){"function"==typeof define&&define.amd?define([],factory):(globalObject.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.3 4.3.1.winjs.2015.9.29 base.js,StartTM"),"object"==typeof exports&&"string"!=typeof exports.nodeName?factory():factory(globalObject.WinJS),globalObject.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.3 4.3.1.winjs.2015.9.29 base.js,StopTM"))}(function(WinJS){var require,define;return function(){"use strict";function normalize(id,dependencies){id=id||"";var parent=id.split("/");return parent.pop(),dependencies.map(function(dep){if("."===dep[0]){var parts=dep.split("/"),current=parent.slice(0);return parts.forEach(function(part){".."===part?current.pop():"."!==part&&current.push(part)}),current.join("/")}return dep})}function resolve(dependencies,parent,exports){return dependencies.map(function(depName){if("exports"===depName)return exports;if("require"===depName)return function(dependencies,factory){require(normalize(parent,dependencies),factory)};var dep=defined[depName];if(!dep)throw new Error("Undefined dependency: "+depName);return dep.resolved||(dep.resolved=load(dep.dependencies,dep.factory,depName,dep.exports),"undefined"==typeof dep.resolved&&(dep.resolved=dep.exports)),dep.resolved})}function load(dependencies,factory,parent,exports){var deps=resolve(dependencies,parent,exports);return factory&&factory.apply?factory.apply(null,deps):factory}var defined={};define=function(id,dependencies,factory){Array.isArray(dependencies)||(factory=dependencies,dependencies=[]);var mod={dependencies:normalize(id,dependencies),factory:factory};-1!==dependencies.indexOf("exports")&&(mod.exports={}),defined[id]=mod},require=function(dependencies,factory){Array.isArray(dependencies)||(dependencies=[dependencies]),load(dependencies,factory)}}(),define("amd",function(){}),define("WinJS/Core/_WinJS",{}),define("WinJS/Core/_Global",[],function(){"use strict";var globalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};return globalObject}),define("WinJS/Core/_BaseCoreUtils",["./_Global"],function(_Global){"use strict";function markSupportedForProcessing(func){return func.supportedForProcessing=!0,func}var hasWinRT=!!_Global.Windows;return{hasWinRT:hasWinRT,markSupportedForProcessing:markSupportedForProcessing,_setImmediate:_Global.setImmediate?_Global.setImmediate.bind(_Global):function(handler){_Global.setTimeout(handler,0)}}}),define("WinJS/Core/_WriteProfilerMark",["./_Global"],function(_Global){"use strict";return _Global.msWriteProfilerMark||function(){}}),define("WinJS/Core/_Base",["./_WinJS","./_Global","./_BaseCoreUtils","./_WriteProfilerMark"],function(_WinJS,_Global,_BaseCoreUtils,_WriteProfilerMark){"use strict";function initializeProperties(target,members,prefix){var properties,i,len,keys=Object.keys(members),isArray=Array.isArray(target);for(i=0,len=keys.length;len>i;i++){var key=keys[i],enumerable=95!==key.charCodeAt(0),member=members[key];!member||"object"!=typeof member||void 0===member.value&&"function"!=typeof member.get&&"function"!=typeof member.set?enumerable?isArray?target.forEach(function(target){target[key]=member}):target[key]=member:(properties=properties||{},properties[key]={value:member,enumerable:enumerable,configurable:!0,writable:!0}):(void 0===member.enumerable&&(member.enumerable=enumerable),prefix&&member.setName&&"function"==typeof member.setName&&member.setName(prefix+"."+key),properties=properties||{},properties[key]=member)}properties&&(isArray?target.forEach(function(target){Object.defineProperties(target,properties)}):Object.defineProperties(target,properties))}return function(){function createNamespace(parentNamespace,name){var currentNamespace=parentNamespace||{};if(name){var namespaceFragments=name.split(".");currentNamespace===_Global&&"WinJS"===namespaceFragments[0]&&(currentNamespace=_WinJS,namespaceFragments.splice(0,1));for(var i=0,len=namespaceFragments.length;len>i;i++){var namespaceName=namespaceFragments[i];currentNamespace[namespaceName]||Object.defineProperty(currentNamespace,namespaceName,{value:{},writable:!1,enumerable:!0,configurable:!0}),currentNamespace=currentNamespace[namespaceName]}}return currentNamespace}function defineWithParent(parentNamespace,name,members){var currentNamespace=createNamespace(parentNamespace,name);return members&&initializeProperties(currentNamespace,members,name||"<ANONYMOUS>"),currentNamespace}function define(name,members){return defineWithParent(_Global,name,members)}function lazy(f){var name,result,state=LazyStates.uninitialized;return{setName:function(value){name=value},get:function(){switch(state){case LazyStates.initialized:return result;case LazyStates.uninitialized:state=LazyStates.working;try{_WriteProfilerMark("WinJS.Namespace._lazy:"+name+",StartTM"),result=f()}finally{_WriteProfilerMark("WinJS.Namespace._lazy:"+name+",StopTM"),state=LazyStates.uninitialized}return f=null,state=LazyStates.initialized,result;case LazyStates.working:throw"Illegal: reentrancy on initialization";default:throw"Illegal"}},set:function(value){switch(state){case LazyStates.working:throw"Illegal: reentrancy on initialization";default:state=LazyStates.initialized,result=value}},enumerable:!0,configurable:!0}}function moduleDefine(exports,name,members){var target=[exports],publicNS=null;return name&&(publicNS=createNamespace(_Global,name),target.push(publicNS)),initializeProperties(target,members,name||"<ANONYMOUS>"),publicNS}var _rootNamespace=_WinJS;_rootNamespace.Namespace||(_rootNamespace.Namespace=Object.create(Object.prototype));var LazyStates={uninitialized:1,working:2,initialized:3};Object.defineProperties(_rootNamespace.Namespace,{defineWithParent:{value:defineWithParent,writable:!0,enumerable:!0,configurable:!0},define:{value:define,writable:!0,enumerable:!0,configurable:!0},_lazy:{value:lazy,writable:!0,enumerable:!0,configurable:!0},_moduleDefine:{value:moduleDefine,writable:!0,enumerable:!0,configurable:!0}})}(),function(){function define(constructor,instanceMembers,staticMembers){return constructor=constructor||function(){},_BaseCoreUtils.markSupportedForProcessing(constructor),instanceMembers&&initializeProperties(constructor.prototype,instanceMembers),staticMembers&&initializeProperties(constructor,staticMembers),constructor}function derive(baseClass,constructor,instanceMembers,staticMembers){if(baseClass){constructor=constructor||function(){};var basePrototype=baseClass.prototype;return constructor.prototype=Object.create(basePrototype),_BaseCoreUtils.markSupportedForProcessing(constructor),Object.defineProperty(constructor.prototype,"constructor",{value:constructor,writable:!0,configurable:!0,enumerable:!0}),instanceMembers&&initializeProperties(constructor.prototype,instanceMembers),staticMembers&&initializeProperties(constructor,staticMembers),constructor}return define(constructor,instanceMembers,staticMembers)}function mix(constructor){constructor=constructor||function(){};var i,len;for(i=1,len=arguments.length;len>i;i++)initializeProperties(constructor.prototype,arguments[i]);return constructor}_WinJS.Namespace.define("WinJS.Class",{define:define,derive:derive,mix:mix})}(),{Namespace:_WinJS.Namespace,Class:_WinJS.Class}}),define("WinJS/Core/_ErrorFromName",["./_Base"],function(_Base){"use strict";var ErrorFromName=_Base.Class.derive(Error,function(name,message){this.name=name,this.message=message||name},{},{supportedForProcessing:!1});return _Base.Namespace.define("WinJS",{ErrorFromName:ErrorFromName}),ErrorFromName}),define("WinJS/Core/_WinRT",["exports","./_Global","./_Base"],function(exports,_Global,_Base){"use strict";exports.msGetWeakWinRTProperty=_Global.msGetWeakWinRTProperty,exports.msSetWeakWinRTProperty=_Global.msSetWeakWinRTProperty;var APIs=["Windows.ApplicationModel.DesignMode.designModeEnabled","Windows.ApplicationModel.Resources.Core.ResourceContext","Windows.ApplicationModel.Resources.Core.ResourceManager","Windows.ApplicationModel.Search.SearchQueryLinguisticDetails","Windows.Data.Text.SemanticTextQuery","Windows.Foundation.Collections.CollectionChange","Windows.Foundation.Diagnostics","Windows.Foundation.Uri","Windows.Globalization.ApplicationLanguages","Windows.Globalization.Calendar","Windows.Globalization.DateTimeFormatting","Windows.Globalization.Language","Windows.Phone.UI.Input.HardwareButtons","Windows.Storage.ApplicationData","Windows.Storage.CreationCollisionOption","Windows.Storage.BulkAccess.FileInformationFactory","Windows.Storage.FileIO","Windows.Storage.FileProperties.ThumbnailType","Windows.Storage.FileProperties.ThumbnailMode","Windows.Storage.FileProperties.ThumbnailOptions","Windows.Storage.KnownFolders","Windows.Storage.Search.FolderDepth","Windows.Storage.Search.IndexerOption","Windows.Storage.Streams.RandomAccessStreamReference","Windows.UI.ApplicationSettings.SettingsEdgeLocation","Windows.UI.ApplicationSettings.SettingsCommand","Windows.UI.ApplicationSettings.SettingsPane","Windows.UI.Core.AnimationMetrics","Windows.UI.Core.SystemNavigationManager","Windows.UI.Input.EdgeGesture","Windows.UI.Input.EdgeGestureKind","Windows.UI.Input.PointerPoint","Windows.UI.ViewManagement.HandPreference","Windows.UI.ViewManagement.InputPane","Windows.UI.ViewManagement.UIColorType","Windows.UI.ViewManagement.UISettings","Windows.UI.WebUI.Core.WebUICommandBar","Windows.UI.WebUI.Core.WebUICommandBarBitmapIcon","Windows.UI.WebUI.Core.WebUICommandBarClosedDisplayMode","Windows.UI.WebUI.Core.WebUICommandBarIconButton","Windows.UI.WebUI.Core.WebUICommandBarSymbolIcon","Windows.UI.WebUI.WebUIApplication"],isCoreWindowAvailable=!1;try{_Global.Windows.UI.ViewManagement.InputPane.getForCurrentView(),isCoreWindowAvailable=!0}catch(e){}APIs.forEach(function(api){var parts=api.split("."),leaf={};leaf[parts[parts.length-1]]={get:function(){return isCoreWindowAvailable?parts.reduce(function(current,part){return current?current[part]:null},_Global):null}},_Base.Namespace.defineWithParent(exports,parts.slice(0,-1).join("."),leaf)})}),define("WinJS/Core/_Events",["exports","./_Base"],function(exports,_Base){"use strict";function createEventProperty(name){var eventPropStateName="_on"+name+"state";return{get:function(){var state=this[eventPropStateName];return state&&state.userHandler},set:function(handler){var state=this[eventPropStateName];handler?(state||(state={wrapper:function(evt){return state.userHandler(evt)},userHandler:handler},Object.defineProperty(this,eventPropStateName,{value:state,enumerable:!1,writable:!0,configurable:!0}),this.addEventListener(name,state.wrapper,!1)),state.userHandler=handler):state&&(this.removeEventListener(name,state.wrapper,!1),this[eventPropStateName]=null)},enumerable:!0}}function createEventProperties(){for(var props={},i=0,len=arguments.length;len>i;i++){var name=arguments[i];props["on"+name]=createEventProperty(name)}return props}var EventMixinEvent=_Base.Class.define(function(type,detail,target){this.detail=detail,this.target=target,this.timeStamp=Date.now(),this.type=type},{bubbles:{value:!1,writable:!1},cancelable:{value:!1,writable:!1},currentTarget:{get:function(){return this.target}},defaultPrevented:{get:function(){return this._preventDefaultCalled}},trusted:{value:!1,writable:!1},eventPhase:{value:0,writable:!1},target:null,timeStamp:null,type:null,preventDefault:function(){this._preventDefaultCalled=!0},stopImmediatePropagation:function(){this._stopImmediatePropagationCalled=!0},stopPropagation:function(){}},{supportedForProcessing:!1}),eventMixin={_listeners:null,addEventListener:function(type,listener,useCapture){useCapture=useCapture||!1,this._listeners=this._listeners||{};for(var eventListeners=this._listeners[type]=this._listeners[type]||[],i=0,len=eventListeners.length;len>i;i++){var l=eventListeners[i];if(l.useCapture===useCapture&&l.listener===listener)return}eventListeners.push({listener:listener,useCapture:useCapture})},dispatchEvent:function(type,details){var listeners=this._listeners&&this._listeners[type];if(listeners){var eventValue=new EventMixinEvent(type,details,this);listeners=listeners.slice(0,listeners.length);for(var i=0,len=listeners.length;len>i&&!eventValue._stopImmediatePropagationCalled;i++)listeners[i].listener(eventValue);return eventValue.defaultPrevented||!1}return!1},removeEventListener:function(type,listener,useCapture){useCapture=useCapture||!1;var listeners=this._listeners&&this._listeners[type];if(listeners)for(var i=0,len=listeners.length;len>i;i++){var l=listeners[i];if(l.listener===listener&&l.useCapture===useCapture){listeners.splice(i,1),0===listeners.length&&delete this._listeners[type];break}}}};_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{_createEventProperty:createEventProperty,createEventProperties:createEventProperties,eventMixin:eventMixin})}),define("require-json",{load:function(id){throw new Error("Dynamic load not allowed: "+id)}}),define("require-json!strings/en-us/Microsoft.WinJS.resjson",{"tv/scrollViewerPageDown":"Page Down","tv/scrollViewerPageUp":"Page Up","ui/appBarAriaLabel":"App Bar","ui/appBarCommandAriaLabel":"App Bar Item","ui/appBarOverflowButtonAriaLabel":"View more","ui/autoSuggestBoxAriaLabel":"Autosuggestbox","ui/autoSuggestBoxAriaLabelInputNoPlaceHolder":"Autosuggestbox, enter to submit query, esc to clear text","ui/autoSuggestBoxAriaLabelInputPlaceHolder":"Autosuggestbox, {0}, enter to submit query, esc to clear text","ui/autoSuggestBoxAriaLabelQuery":"Suggestion: {0}","_ui/autoSuggestBoxAriaLabelQuery.comment":"Suggestion: query text (example: Suggestion: contoso)","ui/autoSuggestBoxAriaLabelSeparator":"Separator: {0}","_ui/autoSuggestBoxAriaLabelSeparator.comment":"Separator: separator text (example: Separator: People or Separator: Apps)","ui/autoSuggestBoxAriaLabelResult":"Result: {0}, {1}","_ui/autoSuggestBoxAriaLabelResult.comment":"Result: text, detailed text (example: Result: contoso, www.contoso.com)","ui/averageRating":"Average Rating","ui/backbuttonarialabel":"Back","ui/chapterSkipBackMediaCommandDisplayText":"Chapter back","ui/chapterSkipForwardMediaCommandDisplayText":"Chapter forward","ui/clearYourRating":"Clear your rating","ui/closedCaptionsLabelNone":"Off","ui/closedCaptionsMediaCommandDisplayText":"Closed captioning","ui/closeOverlay":"Close","ui/commandingSurfaceAriaLabel":"CommandingSurface","ui/commandingSurfaceOverflowButtonAriaLabel":"View more","ui/datePicker":"Date Picker","ui/fastForwardMediaCommandDisplayText":"Fast forward","ui/fastForwardFeedbackDisplayText":" {0}X","ui/fastForwardFeedbackSlowMotionDisplayText":"0.5X","ui/flipViewPanningContainerAriaLabel":"Scrolling Container","ui/flyoutAriaLabel":"Flyout","ui/goToFullScreenButtonLabel":"Go full screen",
"ui/goToLiveMediaCommandDisplayText":"LIVE","ui/hubViewportAriaLabel":"Scrolling Container","ui/listViewViewportAriaLabel":"Scrolling Container","ui/mediaErrorAborted":"Playback was interrupted. Please try again.","ui/mediaErrorNetwork":"There was a network connection error.","ui/mediaErrorDecode":"The content could not be decoded","ui/mediaErrorSourceNotSupported":"This content type is not supported.","ui/mediaErrorUnknown":"There was an unknown error.","ui/mediaPlayerAudioTracksButtonLabel":"Audio tracks","ui/mediaPlayerCastButtonLabel":"Cast","ui/mediaPlayerChapterSkipBackButtonLabel":"Previous","ui/mediaPlayerChapterSkipForwardButtonLabel":"Next","ui/mediaPlayerClosedCaptionsButtonLabel":"Closed captions","ui/mediaPlayerFastForwardButtonLabel":"Fast forward","ui/mediaPlayerFullscreenButtonLabel":"Fullscreen","ui/mediaPlayerLiveButtonLabel":"LIVE","ui/mediaPlayerNextTrackButtonLabel":"Next","ui/mediaPlayerOverlayActiveOptionIndicator":"(On)","ui/mediaPlayerPauseButtonLabel":"Pause","ui/mediaPlayerPlayButtonLabel":"Play","ui/mediaPlayerPlayFromBeginningButtonLabel":"Replay","ui/mediaPlayerPlayRateButtonLabel":"Playback rate","ui/mediaPlayerPreviousTrackButtonLabel":"Previous","ui/mediaPlayerRewindButtonLabel":"Rewind","ui/mediaPlayerStopButtonLabel":"Stop","ui/mediaPlayerTimeSkipBackButtonLabel":"8 second replay","ui/mediaPlayerTimeSkipForwardButtonLabel":"30 second skip","ui/mediaPlayerToggleSnapButtonLabel":"Snap","ui/mediaPlayerVolumeButtonLabel":"Volume","ui/mediaPlayerZoomButtonLabel":"Zoom","ui/menuCommandAriaLabel":"Menu Item","ui/menuAriaLabel":"Menu","ui/navBarContainerViewportAriaLabel":"Scrolling Container","ui/nextTrackMediaCommandDisplayText":"Next track","ui/off":"Off","ui/on":"On","ui/pauseMediaCommandDisplayText":"Pause","ui/playFromBeginningMediaCommandDisplayText":"Play again","ui/playbackRateHalfSpeedLabel":"0.5x","ui/playbackRateNormalSpeedLabel":"Normal","ui/playbackRateOneAndHalfSpeedLabel":"1.5x","ui/playbackRateDoubleSpeedLabel":"2x","ui/playMediaCommandDisplayText":"Play","ui/pivotAriaLabel":"Pivot","ui/pivotViewportAriaLabel":"Scrolling Container","ui/replayMediaCommandDisplayText":"Play again","ui/rewindMediaCommandDisplayText":"Rewind","ui/rewindFeedbackDisplayText":" {0}X","ui/rewindFeedbackSlowMotionDisplayText":"0.5X","ui/searchBoxAriaLabel":"Searchbox","ui/searchBoxAriaLabelInputNoPlaceHolder":"Searchbox, enter to submit query, esc to clear text","ui/searchBoxAriaLabelInputPlaceHolder":"Searchbox, {0}, enter to submit query, esc to clear text","ui/searchBoxAriaLabelButton":"Click to submit query","ui/seeMore":"See more","ui/selectAMPM":"Select A.M P.M","ui/selectDay":"Select Day","ui/selectHour":"Select Hour","ui/selectMinute":"Select Minute","ui/selectMonth":"Select Month","ui/selectYear":"Select Year","ui/settingsFlyoutAriaLabel":"Settings Flyout","ui/stopMediaCommandDisplayText":"Stop","ui/tentativeRating":"Tentative Rating","ui/timePicker":"Time Picker","ui/timeSeparator":":","ui/timeSkipBackMediaCommandDisplayText":"Skip back","ui/timeSkipForwardMediaCommandDisplayText":"Skip forward","ui/toolbarAriaLabel":"ToolBar","ui/toolbarOverflowButtonAriaLabel":"View more","ui/unrated":"Unrated","ui/userRating":"User Rating","ui/zoomMediaCommandDisplayText":"Zoom","ui/appBarIcons/previous":"","_ui/appBarIcons/previous.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/next":"","_ui/appBarIcons/next.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/play":"","_ui/appBarIcons/play.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/pause":"","_ui/appBarIcons/pause.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/edit":"","_ui/appBarIcons/edit.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/save":"","_ui/appBarIcons/save.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/clear":"","_ui/appBarIcons/clear.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/delete":"","_ui/appBarIcons/delete.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/remove":"","_ui/appBarIcons/remove.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/add":"","_ui/appBarIcons/add.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/cancel":"","_ui/appBarIcons/cancel.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/accept":"","_ui/appBarIcons/accept.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/more":"","_ui/appBarIcons/more.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/redo":"","_ui/appBarIcons/redo.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/undo":"","_ui/appBarIcons/undo.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/home":"","_ui/appBarIcons/home.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/up":"","_ui/appBarIcons/up.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/forward":"","_ui/appBarIcons/forward.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/right":"","_ui/appBarIcons/right.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/back":"","_ui/appBarIcons/back.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/left":"","_ui/appBarIcons/left.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/favorite":"","_ui/appBarIcons/favorite.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/camera":"","_ui/appBarIcons/camera.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/settings":"","_ui/appBarIcons/settings.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/video":"","_ui/appBarIcons/video.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/sync":"","_ui/appBarIcons/sync.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/download":"","_ui/appBarIcons/download.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mail":"","_ui/appBarIcons/mail.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/find":"","_ui/appBarIcons/find.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/help":"","_ui/appBarIcons/help.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/upload":"","_ui/appBarIcons/upload.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/emoji":"","_ui/appBarIcons/emoji.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/twopage":"","_ui/appBarIcons/twopage.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/leavechat":"","_ui/appBarIcons/leavechat.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mailforward":"","_ui/appBarIcons/mailforward.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/clock":"","_ui/appBarIcons/clock.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/send":"","_ui/appBarIcons/send.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/crop":"","_ui/appBarIcons/crop.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/rotatecamera":"","_ui/appBarIcons/rotatecamera.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/people":"","_ui/appBarIcons/people.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/closepane":"","_ui/appBarIcons/closepane.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/openpane":"","_ui/appBarIcons/openpane.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/world":"","_ui/appBarIcons/world.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/flag":"","_ui/appBarIcons/flag.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/previewlink":"","_ui/appBarIcons/previewlink.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/globe":"","_ui/appBarIcons/globe.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/trim":"","_ui/appBarIcons/trim.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/attachcamera":"","_ui/appBarIcons/attachcamera.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/zoomin":"","_ui/appBarIcons/zoomin.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/bookmarks":"","_ui/appBarIcons/bookmarks.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/document":"","_ui/appBarIcons/document.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/protecteddocument":"","_ui/appBarIcons/protecteddocument.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/page":"","_ui/appBarIcons/page.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/bullets":"","_ui/appBarIcons/bullets.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/comment":"","_ui/appBarIcons/comment.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mail2":"","_ui/appBarIcons/mail2.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/contactinfo":"","_ui/appBarIcons/contactinfo.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/hangup":"","_ui/appBarIcons/hangup.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/viewall":"","_ui/appBarIcons/viewall.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mappin":"","_ui/appBarIcons/mappin.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/phone":"","_ui/appBarIcons/phone.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/videochat":"","_ui/appBarIcons/videochat.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/switch":"","_ui/appBarIcons/switch.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/contact":"","_ui/appBarIcons/contact.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/rename":"","_ui/appBarIcons/rename.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/pin":"","_ui/appBarIcons/pin.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/musicinfo":"","_ui/appBarIcons/musicinfo.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/go":"","_ui/appBarIcons/go.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/keyboard":"","_ui/appBarIcons/keyboard.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/dockleft":"","_ui/appBarIcons/dockleft.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/dockright":"","_ui/appBarIcons/dockright.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/dockbottom":"","_ui/appBarIcons/dockbottom.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/remote":"","_ui/appBarIcons/remote.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/refresh":"","_ui/appBarIcons/refresh.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/rotate":"","_ui/appBarIcons/rotate.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/shuffle":"","_ui/appBarIcons/shuffle.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/list":"","_ui/appBarIcons/list.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/shop":"","_ui/appBarIcons/shop.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/selectall":"","_ui/appBarIcons/selectall.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/orientation":"","_ui/appBarIcons/orientation.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/import":"","_ui/appBarIcons/import.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/importall":"","_ui/appBarIcons/importall.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/browsephotos":"","_ui/appBarIcons/browsephotos.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/webcam":"","_ui/appBarIcons/webcam.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/pictures":"","_ui/appBarIcons/pictures.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/savelocal":"","_ui/appBarIcons/savelocal.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/caption":"","_ui/appBarIcons/caption.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/stop":"","_ui/appBarIcons/stop.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/showresults":"","_ui/appBarIcons/showresults.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/volume":"","_ui/appBarIcons/volume.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/repair":"","_ui/appBarIcons/repair.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/message":"","_ui/appBarIcons/message.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/page2":"","_ui/appBarIcons/page2.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/calendarday":"","_ui/appBarIcons/calendarday.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/calendarweek":"","_ui/appBarIcons/calendarweek.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/calendar":"","_ui/appBarIcons/calendar.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/characters":"","_ui/appBarIcons/characters.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mailreplyall":"","_ui/appBarIcons/mailreplyall.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/read":"","_ui/appBarIcons/read.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/link":"","_ui/appBarIcons/link.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/accounts":"","_ui/appBarIcons/accounts.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/showbcc":"","_ui/appBarIcons/showbcc.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/hidebcc":"","_ui/appBarIcons/hidebcc.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/cut":"","_ui/appBarIcons/cut.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/attach":"","_ui/appBarIcons/attach.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/paste":"","_ui/appBarIcons/paste.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/filter":"","_ui/appBarIcons/filter.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/copy":"","_ui/appBarIcons/copy.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/emoji2":"","_ui/appBarIcons/emoji2.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/important":"","_ui/appBarIcons/important.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mailreply":"","_ui/appBarIcons/mailreply.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/slideshow":"","_ui/appBarIcons/slideshow.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/sort":"","_ui/appBarIcons/sort.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/manage":"","_ui/appBarIcons/manage.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/allapps":"","_ui/appBarIcons/allapps.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/disconnectdrive":"","_ui/appBarIcons/disconnectdrive.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mapdrive":"","_ui/appBarIcons/mapdrive.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/newwindow":"","_ui/appBarIcons/newwindow.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/openwith":"","_ui/appBarIcons/openwith.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/contactpresence":"","_ui/appBarIcons/contactpresence.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/priority":"","_ui/appBarIcons/priority.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/uploadskydrive":"","_ui/appBarIcons/uploadskydrive.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/gototoday":"","_ui/appBarIcons/gototoday.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/font":"","_ui/appBarIcons/font.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/fontcolor":"","_ui/appBarIcons/fontcolor.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/contact2":"","_ui/appBarIcons/contact2.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/folder":"","_ui/appBarIcons/folder.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/audio":"","_ui/appBarIcons/audio.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/placeholder":"","_ui/appBarIcons/placeholder.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/view":"","_ui/appBarIcons/view.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/setlockscreen":"","_ui/appBarIcons/setlockscreen.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/settile":"","_ui/appBarIcons/settile.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/cc":"","_ui/appBarIcons/cc.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/stopslideshow":"","_ui/appBarIcons/stopslideshow.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/permissions":"","_ui/appBarIcons/permissions.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/highlight":"","_ui/appBarIcons/highlight.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/disableupdates":"","_ui/appBarIcons/disableupdates.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/unfavorite":"","_ui/appBarIcons/unfavorite.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/unpin":"","_ui/appBarIcons/unpin.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/openlocal":"","_ui/appBarIcons/openlocal.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/mute":"","_ui/appBarIcons/mute.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/italic":"","_ui/appBarIcons/italic.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/underline":"","_ui/appBarIcons/underline.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/bold":"","_ui/appBarIcons/bold.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/movetofolder":"","_ui/appBarIcons/movetofolder.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/likedislike":"","_ui/appBarIcons/likedislike.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/dislike":"","_ui/appBarIcons/dislike.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/like":"","_ui/appBarIcons/like.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/alignright":"","_ui/appBarIcons/alignright.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/aligncenter":"","_ui/appBarIcons/aligncenter.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/alignleft":"","_ui/appBarIcons/alignleft.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/zoom":"","_ui/appBarIcons/zoom.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/zoomout":"","_ui/appBarIcons/zoomout.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/openfile":"","_ui/appBarIcons/openfile.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/otheruser":"","_ui/appBarIcons/otheruser.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/admin":"","_ui/appBarIcons/admin.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/street":"","_ui/appBarIcons/street.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/map":"","_ui/appBarIcons/map.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/clearselection":"","_ui/appBarIcons/clearselection.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/fontdecrease":"","_ui/appBarIcons/fontdecrease.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/fontincrease":"","_ui/appBarIcons/fontincrease.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/fontsize":"","_ui/appBarIcons/fontsize.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/cellphone":"","_ui/appBarIcons/cellphone.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/reshare":"","_ui/appBarIcons/reshare.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/tag":"","_ui/appBarIcons/tag.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/repeatone":"","_ui/appBarIcons/repeatone.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/repeatall":"","_ui/appBarIcons/repeatall.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/outlinestar":"","_ui/appBarIcons/outlinestar.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/solidstar":"","_ui/appBarIcons/solidstar.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/calculator":"","_ui/appBarIcons/calculator.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/directions":"","_ui/appBarIcons/directions.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/target":"","_ui/appBarIcons/target.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/library":"","_ui/appBarIcons/library.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/phonebook":"","_ui/appBarIcons/phonebook.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/memo":"","_ui/appBarIcons/memo.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/microphone":"","_ui/appBarIcons/microphone.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/postupdate":"","_ui/appBarIcons/postupdate.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/backtowindow":"","_ui/appBarIcons/backtowindow.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/fullscreen":"","_ui/appBarIcons/fullscreen.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/newfolder":"","_ui/appBarIcons/newfolder.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/calendarreply":"","_ui/appBarIcons/calendarreply.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/unsyncfolder":"","_ui/appBarIcons/unsyncfolder.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/reporthacked":"","_ui/appBarIcons/reporthacked.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/syncfolder":"","_ui/appBarIcons/syncfolder.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/blockcontact":"","_ui/appBarIcons/blockcontact.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/switchapps":"","_ui/appBarIcons/switchapps.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/addfriend":"","_ui/appBarIcons/addfriend.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/touchpointer":"","_ui/appBarIcons/touchpointer.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/gotostart":"","_ui/appBarIcons/gotostart.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/zerobars":"","_ui/appBarIcons/zerobars.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/onebar":"","_ui/appBarIcons/onebar.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/twobars":"","_ui/appBarIcons/twobars.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/threebars":"","_ui/appBarIcons/threebars.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/fourbars":"","_ui/appBarIcons/fourbars.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/scan":"","_ui/appBarIcons/scan.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/preview":"","_ui/appBarIcons/preview.comment":"{Locked=qps-ploc,qps-plocm}","ui/appBarIcons/hamburger":"","_ui/appBarIcons/hamburger.comment":"{Locked=qps-ploc,qps-plocm}"}),define("WinJS/Core/_Resources",["exports","./_Global","./_WinRT","./_Base","./_Events","require-json!strings/en-us/Microsoft.WinJS.resjson"],function(exports,_Global,_WinRT,_Base,_Events,defaultStrings){"use strict";function _getWinJSString(id){var result=getString("ms-resource:///Microsoft.WinJS/"+id);return result.empty&&(result=_getStringBuiltIn(id)),result}function _getStringBuiltIn(resourceId){var str=defaultStrings[resourceId];return"string"==typeof str&&(str={value:str}),str||{value:resourceId,empty:!0}}function formatString(string){var args=arguments;return args.length>1&&(string=string.replace(/({{)|(}})|{(\d+)}|({)|(})/g,function(unused,left,right,index,illegalLeft,illegalRight){if(illegalLeft||illegalRight)throw formatString(strings.malformedFormatStringInput,illegalLeft||illegalRight);return left&&"{"||right&&"}"||args[(0|index)+1]})),string}var resourceMap,resourceContext,mrtEventHook=!1,contextChangedET="contextchanged",ListenerType=_Base.Class.mix(_Base.Class.define(null,{},{supportedForProcessing:!1}),_Events.eventMixin),listeners=new ListenerType,createEvent=_Events._createEventProperty,strings={get malformedFormatStringInput(){return"Malformed, did you mean to escape your '{0}'?"}};_Base.Namespace.define("WinJS.Resources",{_getWinJSString:_getWinJSString}),_Base.Namespace._moduleDefine(exports,"WinJS.Resources",{addEventListener:function(type,listener,useCapture){if(_WinRT.Windows.ApplicationModel.Resources.Core.ResourceManager&&!mrtEventHook&&type===contextChangedET)try{var resContext=exports._getResourceContext();resContext?resContext.qualifierValues.addEventListener("mapchanged",function(e){exports.dispatchEvent(contextChangedET,{qualifier:e.key,changed:e.target[e.key]})},!1):_WinRT.Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.qualifierValues.addEventListener("mapchanged",function(e){exports.dispatchEvent(contextChangedET,{qualifier:e.key,changed:e.target[e.key]})},!1),mrtEventHook=!0}catch(e){}listeners.addEventListener(type,listener,useCapture)},removeEventListener:listeners.removeEventListener.bind(listeners),dispatchEvent:listeners.dispatchEvent.bind(listeners),_formatString:formatString,_getStringWinRT:function(resourceId){if(!resourceMap){var mainResourceMap=_WinRT.Windows.ApplicationModel.Resources.Core.ResourceManager.current.mainResourceMap;try{resourceMap=mainResourceMap.getSubtree("Resources")}catch(e){}resourceMap||(resourceMap=mainResourceMap)}var stringValue,langValue,resCandidate;try{var resContext=exports._getResourceContext();resCandidate=resContext?resourceMap.getValue(resourceId,resContext):resourceMap.getValue(resourceId),resCandidate&&(stringValue=resCandidate.valueAsString,void 0===stringValue&&(stringValue=resCandidate.toString()))}catch(e){}if(!stringValue)return exports._getStringJS(resourceId);try{langValue=resCandidate.getQualifierValue("Language")}catch(e){return{value:stringValue}}return{value:stringValue,lang:langValue}},_getStringJS:function(resourceId){var str=_Global.strings&&_Global.strings[resourceId];return"string"==typeof str&&(str={value:str}),str||{value:resourceId,empty:!0}},_getResourceContext:function(){if(_Global.document&&"undefined"==typeof resourceContext){var context=_WinRT.Windows.ApplicationModel.Resources.Core.ResourceContext;resourceContext=context.getForCurrentView?context.getForCurrentView():null}return resourceContext},oncontextchanged:createEvent(contextChangedET)});var getStringImpl=_WinRT.Windows.ApplicationModel.Resources.Core.ResourceManager?exports._getStringWinRT:exports._getStringJS,getString=function(resourceId){return getStringImpl(resourceId)};_Base.Namespace._moduleDefine(exports,null,{_formatString:formatString,_getWinJSString:_getWinJSString}),_Base.Namespace._moduleDefine(exports,"WinJS.Resources",{getString:{get:function(){return getString},set:function(value){getString=value}}})}),define("WinJS/Core/_Trace",["./_Global"],function(_Global){"use strict";function nop(v){return v}return{_traceAsyncOperationStarting:_Global.Debug&&_Global.Debug.msTraceAsyncOperationStarting&&_Global.Debug.msTraceAsyncOperationStarting.bind(_Global.Debug)||nop,_traceAsyncOperationCompleted:_Global.Debug&&_Global.Debug.msTraceAsyncOperationCompleted&&_Global.Debug.msTraceAsyncOperationCompleted.bind(_Global.Debug)||nop,_traceAsyncCallbackStarting:_Global.Debug&&_Global.Debug.msTraceAsyncCallbackStarting&&_Global.Debug.msTraceAsyncCallbackStarting.bind(_Global.Debug)||nop,_traceAsyncCallbackCompleted:_Global.Debug&&_Global.Debug.msTraceAsyncCallbackCompleted&&_Global.Debug.msTraceAsyncCallbackCompleted.bind(_Global.Debug)||nop}}),define("WinJS/Promise/_StateMachine",["../Core/_Global","../Core/_BaseCoreUtils","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Trace"],function(_Global,_BaseCoreUtils,_Base,_ErrorFromName,_Events,_Trace){"use strict";function _(){}function completed(promise,value){var targetState;targetState=value&&"object"==typeof value&&"function"==typeof value.then?state_waiting:state_success_notify,promise._value=value,promise._setState(targetState)}function createErrorDetails(exception,error,promise,id,parent,handler){return{exception:exception,error:error,promise:promise,handler:handler,id:id,parent:parent}}function detailsForHandledError(promise,errorValue,context,handler){var exception=context._isException,errorId=context._errorId;return createErrorDetails(exception?errorValue:null,exception?null:errorValue,promise,errorId,context,handler)}function detailsForChainedError(promise,errorValue,context){var exception=context._isException,errorId=context._errorId;return setErrorInfo(promise,errorId,exception),createErrorDetails(exception?errorValue:null,exception?null:errorValue,promise,errorId,context)}function detailsForError(promise,errorValue){var errorId=++error_number;return setErrorInfo(promise,errorId),createErrorDetails(null,errorValue,promise,errorId)}function detailsForException(promise,exceptionValue){var errorId=++error_number;return setErrorInfo(promise,errorId,!0),createErrorDetails(exceptionValue,null,promise,errorId)}function done(promise,onComplete,onError,onProgress){var asyncOpID=_Trace._traceAsyncOperationStarting("WinJS.Promise.done");pushListener(promise,{c:onComplete,e:onError,p:onProgress,asyncOpID:asyncOpID})}function error(promise,value,onerrorDetails,context){promise._value=value,callonerror(promise,value,onerrorDetails,context),promise._setState(state_error_notify)}function notifySuccess(promise,queue){var value=promise._value,listeners=promise._listeners;if(listeners){promise._listeners=null;var i,len;for(i=0,len=Array.isArray(listeners)?listeners.length:1;len>i;i++){var listener=1===len?listeners:listeners[i],onComplete=listener.c,target=listener.promise;if(_Trace._traceAsyncOperationCompleted(listener.asyncOpID,_Global.Debug&&_Global.Debug.MS_ASYNC_OP_STATUS_SUCCESS),target){_Trace._traceAsyncCallbackStarting(listener.asyncOpID);try{target._setCompleteValue(onComplete?onComplete(value):value)}catch(ex){target._setExceptionValue(ex)}finally{_Trace._traceAsyncCallbackCompleted()}target._state!==state_waiting&&target._listeners&&queue.push(target)}else CompletePromise.prototype.done.call(promise,onComplete)}}}function notifyError(promise,queue){var value=promise._value,listeners=promise._listeners;if(listeners){promise._listeners=null;var i,len;for(i=0,len=Array.isArray(listeners)?listeners.length:1;len>i;i++){var listener=1===len?listeners:listeners[i],onError=listener.e,target=listener.promise,errorID=_Global.Debug&&(value&&value.name===canceledName?_Global.Debug.MS_ASYNC_OP_STATUS_CANCELED:_Global.Debug.MS_ASYNC_OP_STATUS_ERROR);if(_Trace._traceAsyncOperationCompleted(listener.asyncOpID,errorID),target){var asyncCallbackStarted=!1;try{onError?(_Trace._traceAsyncCallbackStarting(listener.asyncOpID),asyncCallbackStarted=!0,onError.handlesOnError||callonerror(target,value,detailsForHandledError,promise,onError),target._setCompleteValue(onError(value))):target._setChainedErrorValue(value,promise)}catch(ex){target._setExceptionValue(ex)}finally{asyncCallbackStarted&&_Trace._traceAsyncCallbackCompleted()}target._state!==state_waiting&&target._listeners&&queue.push(target)}else ErrorPromise.prototype.done.call(promise,null,onError)}}}function callonerror(promise,value,onerrorDetailsGenerator,context,handler){if(promiseEventListeners._listeners[errorET]){if(value instanceof Error&&value.message===canceledName)return;promiseEventListeners.dispatchEvent(errorET,onerrorDetailsGenerator(promise,value,context,handler))}}function progress(promise,value){var listeners=promise._listeners;if(listeners){var i,len;for(i=0,len=Array.isArray(listeners)?listeners.length:1;len>i;i++){var listener=1===len?listeners:listeners[i],onProgress=listener.p;if(onProgress)try{onProgress(value)}catch(ex){}listener.c||listener.e||!listener.promise||listener.promise._progress(value)}}}function pushListener(promise,listener){var listeners=promise._listeners;listeners?(listeners=Array.isArray(listeners)?listeners:[listeners],listeners.push(listener)):listeners=listener,promise._listeners=listeners}function setErrorInfo(promise,errorId,isException){promise._isException=isException||!1,promise._errorId=errorId}function setErrorValue(promise,value,onerrorDetails,context){promise._value=value,callonerror(promise,value,onerrorDetails,context),promise._setState(state_error)}function setCompleteValue(promise,value){var targetState;targetState=value&&"object"==typeof value&&"function"==typeof value.then?state_waiting:state_success,promise._value=value,promise._setState(targetState)}function then(promise,onComplete,onError,onProgress){var result=new ThenPromise(promise),asyncOpID=_Trace._traceAsyncOperationStarting("WinJS.Promise.then");return pushListener(promise,{promise:result,c:onComplete,e:onError,p:onProgress,asyncOpID:asyncOpID}),result}function timeout(timeoutMS){var id;return new Promise(function(c){timeoutMS?id=_Global.setTimeout(c,timeoutMS):_BaseCoreUtils._setImmediate(c)},function(){id&&_Global.clearTimeout(id)})}function timeoutWithPromise(timeout,promise){var cancelPromise=function(){promise.cancel()},cancelTimeout=function(){timeout.cancel()};return timeout.then(cancelPromise),promise.then(cancelTimeout,cancelTimeout),
promise}_Global.Debug&&(_Global.Debug.setNonUserCodeExceptions=!0);var ListenerType=_Base.Class.mix(_Base.Class.define(null,{},{supportedForProcessing:!1}),_Events.eventMixin),promiseEventListeners=new ListenerType;promiseEventListeners._listeners={};var errorET="error",canceledName="Canceled",tagWithStack=!1,tag={promise:1,thenPromise:2,errorPromise:4,exceptionPromise:8,completePromise:16};tag.all=tag.promise|tag.thenPromise|tag.errorPromise|tag.exceptionPromise|tag.completePromise;var state_created,state_working,state_waiting,state_waiting_canceled,state_canceled,state_canceling,state_success_notify,state_success,state_error_notify,state_error,error_number=1;state_created={name:"created",enter:function(promise){promise._setState(state_working)},cancel:_,done:_,then:_,_completed:_,_error:_,_notify:_,_progress:_,_setCompleteValue:_,_setErrorValue:_},state_working={name:"working",enter:_,cancel:function(promise){promise._setState(state_canceled)},done:done,then:then,_completed:completed,_error:error,_notify:_,_progress:progress,_setCompleteValue:setCompleteValue,_setErrorValue:setErrorValue},state_waiting={name:"waiting",enter:function(promise){var waitedUpon=promise._value;if(waitedUpon instanceof ThenPromise&&waitedUpon._state!==state_error&&waitedUpon._state!==state_success)pushListener(waitedUpon,{promise:promise});else{var error=function(value){waitedUpon._errorId?promise._chainedError(value,waitedUpon):(callonerror(promise,value,detailsForHandledError,waitedUpon,error),promise._error(value))};error.handlesOnError=!0,waitedUpon.then(promise._completed.bind(promise),error,promise._progress.bind(promise))}},cancel:function(promise){promise._setState(state_waiting_canceled)},done:done,then:then,_completed:completed,_error:error,_notify:_,_progress:progress,_setCompleteValue:setCompleteValue,_setErrorValue:setErrorValue},state_waiting_canceled={name:"waiting_canceled",enter:function(promise){promise._setState(state_canceling);var waitedUpon=promise._value;waitedUpon.cancel&&waitedUpon.cancel()},cancel:_,done:done,then:then,_completed:completed,_error:error,_notify:_,_progress:progress,_setCompleteValue:setCompleteValue,_setErrorValue:setErrorValue},state_canceled={name:"canceled",enter:function(promise){promise._setState(state_canceling),promise._cancelAction()},cancel:_,done:done,then:then,_completed:completed,_error:error,_notify:_,_progress:progress,_setCompleteValue:setCompleteValue,_setErrorValue:setErrorValue},state_canceling={name:"canceling",enter:function(promise){var error=new Error(canceledName);error.name=error.message,promise._value=error,promise._setState(state_error_notify)},cancel:_,done:_,then:_,_completed:_,_error:_,_notify:_,_progress:_,_setCompleteValue:_,_setErrorValue:_},state_success_notify={name:"complete_notify",enter:function(promise){if(promise.done=CompletePromise.prototype.done,promise.then=CompletePromise.prototype.then,promise._listeners)for(var p,queue=[promise];queue.length;)p=queue.shift(),p._state._notify(p,queue);promise._setState(state_success)},cancel:_,done:null,then:null,_completed:_,_error:_,_notify:notifySuccess,_progress:_,_setCompleteValue:_,_setErrorValue:_},state_success={name:"success",enter:function(promise){promise.done=CompletePromise.prototype.done,promise.then=CompletePromise.prototype.then,promise._cleanupAction()},cancel:_,done:null,then:null,_completed:_,_error:_,_notify:notifySuccess,_progress:_,_setCompleteValue:_,_setErrorValue:_},state_error_notify={name:"error_notify",enter:function(promise){if(promise.done=ErrorPromise.prototype.done,promise.then=ErrorPromise.prototype.then,promise._listeners)for(var p,queue=[promise];queue.length;)p=queue.shift(),p._state._notify(p,queue);promise._setState(state_error)},cancel:_,done:null,then:null,_completed:_,_error:_,_notify:notifyError,_progress:_,_setCompleteValue:_,_setErrorValue:_},state_error={name:"error",enter:function(promise){promise.done=ErrorPromise.prototype.done,promise.then=ErrorPromise.prototype.then,promise._cleanupAction()},cancel:_,done:null,then:null,_completed:_,_error:_,_notify:notifyError,_progress:_,_setCompleteValue:_,_setErrorValue:_};var staticCanceledPromise,PromiseStateMachine=_Base.Class.define(null,{_listeners:null,_nextState:null,_state:null,_value:null,cancel:function(){this._state.cancel(this),this._run()},done:function(onComplete,onError,onProgress){this._state.done(this,onComplete,onError,onProgress)},then:function(onComplete,onError,onProgress){return this._state.then(this,onComplete,onError,onProgress)},_chainedError:function(value,context){var result=this._state._error(this,value,detailsForChainedError,context);return this._run(),result},_completed:function(value){var result=this._state._completed(this,value);return this._run(),result},_error:function(value){var result=this._state._error(this,value,detailsForError);return this._run(),result},_progress:function(value){this._state._progress(this,value)},_setState:function(state){this._nextState=state},_setCompleteValue:function(value){this._state._setCompleteValue(this,value),this._run()},_setChainedErrorValue:function(value,context){var result=this._state._setErrorValue(this,value,detailsForChainedError,context);return this._run(),result},_setExceptionValue:function(value){var result=this._state._setErrorValue(this,value,detailsForException);return this._run(),result},_run:function(){for(;this._nextState;)this._state=this._nextState,this._nextState=null,this._state.enter(this)}},{supportedForProcessing:!1}),ThenPromise=_Base.Class.derive(PromiseStateMachine,function(creator){tagWithStack&&(tagWithStack===!0||tagWithStack&tag.thenPromise)&&(this._stack=Promise._getStack()),this._creator=creator,this._setState(state_created),this._run()},{_creator:null,_cancelAction:function(){this._creator&&this._creator.cancel()},_cleanupAction:function(){this._creator=null}},{supportedForProcessing:!1}),ErrorPromise=_Base.Class.define(function(value){tagWithStack&&(tagWithStack===!0||tagWithStack&tag.errorPromise)&&(this._stack=Promise._getStack()),this._value=value,callonerror(this,value,detailsForError)},{cancel:function(){},done:function(unused,onError){var value=this._value;if(onError)try{onError.handlesOnError||callonerror(null,value,detailsForHandledError,this,onError);var result=onError(value);return void(result&&"object"==typeof result&&"function"==typeof result.done&&result.done())}catch(ex){value=ex}value instanceof Error&&value.message===canceledName||Promise._doneHandler(value)},then:function(unused,onError){if(!onError)return this;var result,value=this._value;try{onError.handlesOnError||callonerror(null,value,detailsForHandledError,this,onError),result=new CompletePromise(onError(value))}catch(ex){result=ex===value?this:new ExceptionPromise(ex)}return result}},{supportedForProcessing:!1}),ExceptionPromise=_Base.Class.derive(ErrorPromise,function(value){tagWithStack&&(tagWithStack===!0||tagWithStack&tag.exceptionPromise)&&(this._stack=Promise._getStack()),this._value=value,callonerror(this,value,detailsForException)},{},{supportedForProcessing:!1}),CompletePromise=_Base.Class.define(function(value){if(tagWithStack&&(tagWithStack===!0||tagWithStack&tag.completePromise)&&(this._stack=Promise._getStack()),value&&"object"==typeof value&&"function"==typeof value.then){var result=new ThenPromise(null);return result._setCompleteValue(value),result}this._value=value},{cancel:function(){},done:function(onComplete){if(onComplete)try{var result=onComplete(this._value);result&&"object"==typeof result&&"function"==typeof result.done&&result.done()}catch(ex){Promise._doneHandler(ex)}},then:function(onComplete){try{var newValue=onComplete?onComplete(this._value):this._value;return newValue===this._value?this:new CompletePromise(newValue)}catch(ex){return new ExceptionPromise(ex)}}},{supportedForProcessing:!1}),Promise=_Base.Class.derive(PromiseStateMachine,function(init,oncancel){tagWithStack&&(tagWithStack===!0||tagWithStack&tag.promise)&&(this._stack=Promise._getStack()),this._oncancel=oncancel,this._setState(state_created),this._run();try{var complete=this._completed.bind(this),error=this._error.bind(this),progress=this._progress.bind(this);init(complete,error,progress)}catch(ex){this._setExceptionValue(ex)}},{_oncancel:null,_cancelAction:function(){if(this._oncancel)try{this._oncancel()}catch(ex){}},_cleanupAction:function(){this._oncancel=null}},{addEventListener:function(eventType,listener,capture){promiseEventListeners.addEventListener(eventType,listener,capture)},any:function(values){return new Promise(function(complete,error){var keys=Object.keys(values);0===keys.length&&complete();var canceled=0;keys.forEach(function(key){Promise.as(values[key]).then(function(){complete({key:key,value:values[key]})},function(e){return e instanceof Error&&e.name===canceledName?void(++canceled===keys.length&&complete(Promise.cancel)):void error({key:key,value:values[key]})})})},function(){var keys=Object.keys(values);keys.forEach(function(key){var promise=Promise.as(values[key]);"function"==typeof promise.cancel&&promise.cancel()})})},as:function(value){return value&&"object"==typeof value&&"function"==typeof value.then?value:new CompletePromise(value)},cancel:{get:function(){return staticCanceledPromise=staticCanceledPromise||new ErrorPromise(new _ErrorFromName(canceledName))}},dispatchEvent:function(eventType,details){return promiseEventListeners.dispatchEvent(eventType,details)},is:function(value){return value&&"object"==typeof value&&"function"==typeof value.then},join:function(values){return new Promise(function(complete,error,progress){var keys=Object.keys(values),errors=Array.isArray(values)?[]:{},results=Array.isArray(values)?[]:{},undefineds=0,pending=keys.length,argDone=function(key){if(0===--pending){var errorCount=Object.keys(errors).length;if(0===errorCount)complete(results);else{var canceledCount=0;keys.forEach(function(key){var e=errors[key];e instanceof Error&&e.name===canceledName&&canceledCount++}),canceledCount===errorCount?complete(Promise.cancel):error(errors)}}else progress({Key:key,Done:!0})};return keys.forEach(function(key){var value=values[key];void 0===value?undefineds++:Promise.then(value,function(value){results[key]=value,argDone(key)},function(value){errors[key]=value,argDone(key)})}),pending-=undefineds,0===pending?void complete(results):void 0},function(){Object.keys(values).forEach(function(key){var promise=Promise.as(values[key]);"function"==typeof promise.cancel&&promise.cancel()})})},removeEventListener:function(eventType,listener,capture){promiseEventListeners.removeEventListener(eventType,listener,capture)},supportedForProcessing:!1,then:function(value,onComplete,onError,onProgress){return Promise.as(value).then(onComplete,onError,onProgress)},thenEach:function(values,onComplete,onError,onProgress){var result=Array.isArray(values)?[]:{};return Object.keys(values).forEach(function(key){result[key]=Promise.as(values[key]).then(onComplete,onError,onProgress)}),Promise.join(result)},timeout:function(time,promise){var to=timeout(time);return promise?timeoutWithPromise(to,promise):to},wrap:function(value){return new CompletePromise(value)},wrapError:function(error){return new ErrorPromise(error)},_veryExpensiveTagWithStack:{get:function(){return tagWithStack},set:function(value){tagWithStack=value}},_veryExpensiveTagWithStack_tag:tag,_getStack:function(){if(_Global.Debug&&_Global.Debug.debuggerEnabled)try{throw new Error}catch(e){return e.stack}},_cancelBlocker:function(input,oncancel){if(!Promise.is(input))return Promise.wrap(input);var complete,error,output=new Promise(function(c,e){complete=c,error=e},function(){complete=null,error=null,oncancel&&oncancel()});return input.then(function(v){complete&&complete(v)},function(e){error&&error(e)}),output}});return Object.defineProperties(Promise,_Events.createEventProperties(errorET)),Promise._doneHandler=function(value){_BaseCoreUtils._setImmediate(function(){throw value})},{PromiseStateMachine:PromiseStateMachine,Promise:Promise,state_created:state_created}}),define("WinJS/Promise",["./Core/_Base","./Promise/_StateMachine"],function(_Base,_StateMachine){"use strict";return _Base.Namespace.define("WinJS",{Promise:_StateMachine.Promise}),_StateMachine.Promise}),define("WinJS/Core/_Log",["exports","./_Global","./_Base"],function(exports,_Global,_Base){"use strict";function format(message,tag,type){var m=message;return"function"==typeof m&&(m=m()),(type&&typeR.test(type)?"":type?type+": ":"")+(tag?tag.replace(spaceR,":")+": ":"")+m}function defAction(message,tag,type){var m=exports.formatLog(message,tag,type);_Global.console&&_Global.console[type&&typeR.test(type)?type:"log"](m)}function escape(s){return s.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")}var spaceR=/\s+/g,typeR=/^(error|warn|info|log)$/,WinJSLog=null;_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{startLog:function(options){options=options||{},"string"==typeof options&&(options={tags:options});var el=options.type&&new RegExp("^("+escape(options.type).replace(spaceR," ").split(" ").join("|")+")$"),not=options.excludeTags&&new RegExp("(^|\\s)("+escape(options.excludeTags).replace(spaceR," ").split(" ").join("|")+")(\\s|$)","i"),has=options.tags&&new RegExp("(^|\\s)("+escape(options.tags).replace(spaceR," ").split(" ").join("|")+")(\\s|$)","i"),action=options.action||defAction;if(!(el||not||has||exports.log))return void(exports.log=action);var result=function(message,tag,type){el&&!el.test(type)||not&&not.test(tag)||has&&!has.test(tag)||action(message,tag,type),result.next&&result.next(message,tag,type)};result.next=exports.log,exports.log=result},stopLog:function(){exports.log=null},formatLog:format}),_Base.Namespace._moduleDefine(exports,"WinJS",{log:{get:function(){return WinJSLog},set:function(value){WinJSLog=value}}})}),define("WinJS/Scheduler",["exports","./Core/_Global","./Core/_Base","./Core/_ErrorFromName","./Core/_Log","./Core/_Resources","./Core/_Trace","./Core/_WriteProfilerMark","./Promise"],function(exports,_Global,_Base,_ErrorFromName,_Log,_Resources,_Trace,_WriteProfilerMark,Promise){"use strict";function linkedListMixin(name){var mixin={},PREV="_prev"+name,NEXT="_next"+name;return mixin["_remove"+name]=function(){var prev=this[PREV],next=this[NEXT];next&&(next[PREV]=prev),prev&&(prev[NEXT]=next),this[PREV]=null,this[NEXT]=null},mixin["_insert"+name+"Before"]=function(node){var prev=this[PREV];return prev&&(prev[NEXT]=node),node[NEXT]=this,node[PREV]=prev,this[PREV]=node,node},mixin["_insert"+name+"After"]=function(node){var next=this[NEXT];return this[NEXT]=node,node[NEXT]=next,node[PREV]=this,next&&(next[PREV]=node),node},mixin}function profilerMarkArgs(arg0,arg1,arg2){return void 0!==arg2?"("+arg0+";"+arg1+";"+arg2+")":void 0!==arg1?"("+arg0+";"+arg1+")":void 0!==arg0?"("+arg0+")":""}function schedulerProfilerMark(operation,markerType,arg0,arg1){_WriteProfilerMark("WinJS.Scheduler:"+operation+profilerMarkArgs(arg0,arg1)+","+markerType)}function jobProfilerMark(job,operation,markerType,arg0,arg1){var argProvided=job.name||void 0!==arg0||void 0!==arg1;_WriteProfilerMark("WinJS.Scheduler:"+operation+":"+job.id+(argProvided?profilerMarkArgs(job.name,arg0,arg1):"")+","+markerType)}function _(){return!1}function illegal(job){throw"Illegal call by job("+job.id+") in state: "+this.name}function setState(state){return function(job,arg0,arg1){job._setState(state,arg0,arg1)}}function changePriority(job,priority){job._setPriority(priority)}function dumpList(type,reverse){function dumpMarker(marker,pos){_Log.log&&_Log.log(pos+": MARKER: "+marker.name,"winjs scheduler","log")}function dumpJob(job,pos){_Log.log&&_Log.log(pos+": JOB("+job.id+"): state: "+(job._state?job._state.name:"")+(job.name?", name: "+job.name:""),"winjs scheduler","log")}_Log.log&&_Log.log("highWaterMark: "+highWaterMark,"winjs scheduler","log");var pos=0,head=reverse?priorities[priorities.length-1]:priorities[0],current=head;do current instanceof MarkerNode&&dumpMarker(current,pos),current instanceof JobNode&&dumpJob(current,pos),pos++,current=reverse?current["_prev"+type]:current["_next"+type];while(current)}function retrieveState(){function logJob(job,isRunning){output+="    "+(isRunning?"*":" ")+"id: "+job.id+", priority: "+markerFromPriority(job.priority).name+(job.name?", name: "+job.name:"")+"\n"}var output="";output+="Jobs:\n";var current=markerFromPriority(highWaterMark),jobCount=0;for(runningJob&&(logJob(runningJob,!0),jobCount++);current.priority>=Priority.min;)current instanceof JobNode&&(logJob(current,!1),jobCount++),current=current._nextJob;0===jobCount&&(output+="     None\n"),output+="Drain requests:\n";for(var i=0,len=drainQueue.length;len>i;i++)output+="    "+(0===i?"*":" ")+"priority: "+markerFromPriority(drainQueue[i].priority).name+", name: "+drainQueue[i].name+"\n";return 0===drainQueue.length&&(output+="     None\n"),output}function isEmpty(){var current=priorities[0];do{if(current instanceof JobNode)return!1;current=current._nextJob}while(current);return!0}function currentDrainPriority(){return 0===drainQueue.length?null:drainQueue[0].priority}function drainStarting(listener){schedulerProfilerMark("drain","StartTM",listener.name,markerFromPriority(listener.priority).name)}function drainStopping(listener,canceled){canceled&&schedulerProfilerMark("drain-canceled","info",listener.name,markerFromPriority(listener.priority).name),schedulerProfilerMark("drain","StopTM",listener.name,markerFromPriority(listener.priority).name)}function addDrainListener(priority,complete,name){drainQueue.push({priority:priority,complete:complete,name:name}),1===drainQueue.length&&(drainStarting(drainQueue[0]),priority>highWaterMark&&(highWaterMark=priority,immediateYield=!0))}function removeDrainListener(complete,canceled){var i,len=drainQueue.length;for(i=0;len>i;i++)if(drainQueue[i].complete===complete){0===i&&(drainStopping(drainQueue[0],canceled),drainQueue[1]&&drainStarting(drainQueue[1])),drainQueue.splice(i,1);break}}function notifyCurrentDrainListener(){var listener=drainQueue.shift();listener&&(drainStopping(listener),drainQueue[0]&&drainStarting(drainQueue[0]),listener.complete())}function notifyDrainListeners(){var notifiedSomebody=!1;if(drainQueue.length)for(var drainPriority=currentDrainPriority();+drainPriority===drainPriority&&drainPriority>highWaterMark;)pumpingPriority=drainPriority,notifyCurrentDrainListener(),notifiedSomebody=!0,drainPriority=currentDrainPriority();return notifiedSomebody}function toWwaPriority(winjsPriority){return winjsPriority>=Priority.aboveNormal+1?MSApp.HIGH:winjsPriority>=Priority.belowNormal?MSApp.NORMAL:MSApp.IDLE}function isEqualOrHigherWwaPriority(priority1,priority2){return wwaPriorityToInt[priority1]>=wwaPriorityToInt[priority2]}function isHigherWwaPriority(priority1,priority2){return wwaPriorityToInt[priority1]>wwaPriorityToInt[priority2]}function wwaTaskScheduledAtPriorityHigherThan(wwaPriority){switch(wwaPriority){case MSApp.HIGH:return!1;case MSApp.NORMAL:return MSApp.isTaskScheduledAtPriorityOrHigher(MSApp.HIGH);case MSApp.IDLE:return MSApp.isTaskScheduledAtPriorityOrHigher(MSApp.NORMAL)}}function addJobAtHeadOfPriority(node,priority){var marker=markerFromPriority(priority);marker.priority>highWaterMark&&(highWaterMark=marker.priority,immediateYield=!0),marker._insertJobAfter(node)}function addJobAtTailOfPriority(node,priority){var marker=markerFromPriority(priority);marker.priority>highWaterMark&&(highWaterMark=marker.priority,immediateYield=!0),marker._nextMarker._insertJobBefore(node)}function clampPriority(priority){return priority=0|priority,priority=Math.max(priority,MIN_PRIORITY),priority=Math.min(priority,MAX_PRIORITY)}function markerFromPriority(priority){return priority=clampPriority(priority),priorities[-1*(priority-MAX_PRIORITY)]}function run(scheduled){pumping=!0,schedulerProfilerMark("timeslice","StartTM");var didWork,current,lastLoggedPriority,ranJobSuccessfully=!0,timesliceExhausted=!1,yieldForPriorityBoundary=!1;immediateYield=!1;try{for(var start=now(),end=start+TIME_SLICE,shouldYield=function(){return timesliceExhausted=!1,immediateYield?!0:wwaTaskScheduledAtPriorityHigherThan(toWwaPriority(highWaterMark))?!0:drainQueue.length?!1:now()>end?(timesliceExhausted=!0,!0):!1};highWaterMark>=Priority.min&&!shouldYield()&&!yieldForPriorityBoundary;){didWork=!1,current=markerFromPriority(highWaterMark)._nextJob;do{if(pumpingPriority=current.priority,current instanceof JobNode)lastLoggedPriority!==current.priority&&(+lastLoggedPriority===lastLoggedPriority&&schedulerProfilerMark("priority","StopTM",markerFromPriority(lastLoggedPriority).name),schedulerProfilerMark("priority","StartTM",markerFromPriority(current.priority).name),lastLoggedPriority=current.priority),didWork=!0,ranJobSuccessfully=!1,runningJob=current,jobProfilerMark(runningJob,"job-running","StartTM",markerFromPriority(pumpingPriority).name),current._execute(shouldYield),jobProfilerMark(runningJob,"job-running","StopTM",markerFromPriority(pumpingPriority).name),runningJob=null,ranJobSuccessfully=!0;else{var wwaPrevHighWaterMark=toWwaPriority(highWaterMark);highWaterMark=current.priority,didWork=notifyDrainListeners();var wwaHighWaterMark=toWwaPriority(highWaterMark);!isHigherWwaPriority(wwaPrevHighWaterMark,wwaHighWaterMark)||usingWwaScheduler&&!MSApp.isTaskScheduledAtPriorityOrHigher(wwaHighWaterMark)||(yieldForPriorityBoundary=!0)}current=current._nextJob}while(current&&!didWork&&!yieldForPriorityBoundary&&!wwaTaskScheduledAtPriorityHigherThan(toWwaPriority(highWaterMark)));immediateYield=!1}}finally{runningJob=null,ranJobSuccessfully||(jobProfilerMark(current,"job-error","info"),jobProfilerMark(current,"job-running","StopTM",markerFromPriority(pumpingPriority).name),current.cancel()),+lastLoggedPriority===lastLoggedPriority&&schedulerProfilerMark("priority","StopTM",markerFromPriority(lastLoggedPriority).name);for(var foundAJob=!1;highWaterMark>=Priority.min&&!foundAJob;){didWork=!1,current=markerFromPriority(highWaterMark)._nextJob;do current instanceof JobNode?foundAJob=!0:(highWaterMark=current.priority,didWork=notifyDrainListeners()),current=current._nextJob;while(current&&!didWork&&!foundAJob)}var reasonForYielding;reasonForYielding=ranJobSuccessfully?timesliceExhausted?"timeslice exhausted":highWaterMark<Priority.min?"jobs exhausted":yieldForPriorityBoundary?"reached WWA priority boundary":"WWA host work":"job error",scheduled&&(scheduledWwaPriority=null),pumping=!1,highWaterMark>=Priority.min&&startRunning(),schedulerProfilerMark("yielding","info",reasonForYielding),schedulerProfilerMark("timeslice","StopTM")}}function startRunning(priority){+priority!==priority&&(priority=highWaterMark);var priorityWwa=toWwaPriority(priority);if(!pumping&&(!scheduledWwaPriority||usingWwaScheduler&&!isEqualOrHigherWwaPriority(scheduledWwaPriority,priorityWwa))){var current=++scheduledVersion,runner=function(){current>executedVersion&&(executedVersion=scheduledVersion,run(!0))};MSApp.execAsyncAtPriority(runner,priorityWwa),scheduledWwaPriority=priorityWwa}}function requestDrain(priority,name){var id=globalDrainId++;void 0===name&&(name="Drain Request "+id),priority=+priority===priority?priority:Priority.min,priority=clampPriority(priority);var complete,promise=new Promise(function(c){complete=c,addDrainListener(priority,complete,name)},function(){removeDrainListener(complete,!0)});return pumping||startRunning(),promise}function execHigh(callback){return MSApp.execAtPriority(callback,MSApp.HIGH)}function createOwnerToken(){return new OwnerToken}function schedule(work,priority,thisArg,name){priority=priority||Priority.normal,thisArg=thisArg||null;var jobId=++globalJobId,asyncOpID=_Trace._traceAsyncOperationStarting("WinJS.Utilities.Scheduler.schedule: "+jobId+profilerMarkArgs(name));return name=name||"",new JobNode(jobId,work,priority,thisArg,name,asyncOpID)}function getCurrentPriority(){if(pumping)return pumpingPriority;switch(MSApp.getCurrentPriority()){case MSApp.HIGH:return Priority.high;case MSApp.NORMAL:return Priority.normal;case MSApp.IDLE:return Priority.idle}}function makeSchedulePromise(priority){return function(promiseValue,jobName){var job;return new Promise(function(c){job=schedule(function(){c(promiseValue)},priority,null,jobName)},function(){job.cancel()})}}_Base.Namespace.define("WinJS.Utilities",{_linkedListMixin:linkedListMixin});var strings={get jobInfoIsNoLongerValid(){return"The job info object can only be used while the job is running"}},JobNode=_Base.Class.define(function(id,work,priority,context,name,asyncOpID){this._id=id,this._work=work,this._context=context,this._name=name,this._asyncOpID=asyncOpID,this._setPriority(priority),this._setState(state_created),jobProfilerMark(this,"job-scheduled","info")},{completed:{get:function(){return!!this._state.completed}},id:{get:function(){return this._id}},name:{get:function(){return this._name},set:function(value){this._name=value}},owner:{get:function(){return this._owner},set:function(value){this._owner&&this._owner._remove(this),this._owner=value,this._owner&&this._owner._add(this)}},priority:{get:function(){return this._priority},set:function(value){value=clampPriority(value),this._state.setPriority(this,value)}},cancel:function(){this._state.cancel(this)},pause:function(){this._state.pause(this)},resume:function(){this._state.resume(this)},_execute:function(shouldYield){this._state.execute(this,shouldYield)},_executeDone:function(result){return this._state.executeDone(this,result)},_blockedDone:function(result){return this._state.blockedDone(this,result)},_setPriority:function(value){+this._priority===this._priority&&this._priority!==value&&jobProfilerMark(this,"job-priority-changed","info",markerFromPriority(this._priority).name,markerFromPriority(value).name),this._priority=value},_setState:function(state,arg0,arg1){this._state&&_Log.log&&_Log.log("Transitioning job ("+this.id+") from: "+this._state.name+" to: "+state.name,"winjs scheduler","log"),this._state=state,this._state.enter(this,arg0,arg1)}});_Base.Class.mix(JobNode,linkedListMixin("Job"));var YieldPolicy={complete:1,"continue":2,block:3},JobInfo=_Base.Class.define(function(shouldYield,job){this._job=job,this._result=null,this._yieldPolicy=YieldPolicy.complete,this._shouldYield=shouldYield},{job:{get:function(){return this._throwIfDisabled(),this._job}},shouldYield:{get:function(){return this._throwIfDisabled(),this._shouldYield()}},setPromise:function(promise){this._throwIfDisabled(),this._result=promise,this._yieldPolicy=YieldPolicy.block},setWork:function(work){this._throwIfDisabled(),this._result=work,this._yieldPolicy=YieldPolicy["continue"]},_disablePublicApi:function(){this._publicApiDisabled=!0},_throwIfDisabled:function(){if(this._publicApiDisabled)throw new _ErrorFromName("WinJS.Utilities.Scheduler.JobInfoIsNoLongerValid",strings.jobInfoIsNoLongerValid)}}),OwnerToken=_Base.Class.define(function(){this._jobs={}},{cancelAll:function(){var jobs=this._jobs,jobIds=Object.keys(jobs);this._jobs={};for(var i=0,len=jobIds.length;len>i;i++)jobs[jobIds[i]].cancel()},_add:function(job){this._jobs[job.id]=job},_remove:function(job){delete this._jobs[job.id]}}),State=_Base.Class.define(function(name){this.name=name,this.enter=illegal,this.execute=illegal,this.executeDone=illegal,this.blockedDone=illegal,this.cancel=illegal,this.pause=illegal,this.resume=illegal,this.setPriority=illegal}),state_created=new State("created"),state_scheduled=new State("scheduled"),state_paused=new State("paused"),state_canceled=new State("canceled"),state_running=new State("running"),state_running_paused=new State("running_paused"),state_running_resumed=new State("running_resumed"),state_running_canceled=new State("running_canceled"),state_running_canceled_blocked=new State("running_canceled_blocked"),state_cooperative_yield=new State("cooperative_yield"),state_cooperative_yield_paused=new State("cooperative_yield_paused"),state_blocked=new State("blocked"),state_blocked_waiting=new State("blocked_waiting"),state_blocked_paused=new State("blocked_paused"),state_blocked_paused_waiting=new State("blocked_paused_waiting"),state_blocked_canceled=new State("blocked_canceled"),state_complete=new State("complete");state_created.enter=function(job){addJobAtTailOfPriority(job,job.priority),job._setState(state_scheduled)},state_scheduled.enter=function(){startRunning()},state_scheduled.execute=setState(state_running),state_scheduled.cancel=setState(state_canceled),state_scheduled.pause=setState(state_paused),state_scheduled.resume=_,state_scheduled.setPriority=function(job,priority){job.priority!==priority&&(job._setPriority(priority),job.pause(),job.resume())},state_paused.enter=function(job){jobProfilerMark(job,"job-paused","info"),job._removeJob()},state_paused.cancel=setState(state_canceled),state_paused.pause=_,state_paused.resume=function(job){jobProfilerMark(job,"job-resumed","info"),addJobAtTailOfPriority(job,job.priority),job._setState(state_scheduled)},state_paused.setPriority=changePriority,state_canceled.enter=function(job){jobProfilerMark(job,"job-canceled","info"),_Trace._traceAsyncOperationCompleted(job._asyncOpID,_Global.Debug&&_Global.Debug.MS_ASYNC_OP_STATUS_CANCELED),job._removeJob(),job._work=null,job._context=null,job.owner=null},state_canceled.cancel=_,state_canceled.pause=_,state_canceled.resume=_,state_canceled.setPriority=_,state_running.enter=function(job,shouldYield){job._removeJob();var priority=job.priority,work=job._work,context=job._context;job._work=null,job._context=null;var jobInfo=new JobInfo(shouldYield,job);_Trace._traceAsyncCallbackStarting(job._asyncOpID);try{MSApp.execAtPriority(function(){work.call(context,jobInfo)},toWwaPriority(priority))}finally{_Trace._traceAsyncCallbackCompleted(),jobInfo._disablePublicApi()}job._context=context;var targetState=job._executeDone(jobInfo._yieldPolicy);job._setState(targetState,jobInfo._result,priority)},state_running.executeDone=function(job,yieldPolicy){switch(yieldPolicy){case YieldPolicy.complete:return state_complete;case YieldPolicy["continue"]:return state_cooperative_yield;case YieldPolicy.block:return state_blocked}},state_running.cancel=function(job){immediateYield=!0,job._setState(state_running_canceled)},state_running.pause=function(job){immediateYield=!0,job._setState(state_running_paused)},state_running.resume=_,state_running.setPriority=changePriority,state_running_paused.enter=_,state_running_paused.executeDone=function(job,yieldPolicy){switch(yieldPolicy){case YieldPolicy.complete:return state_complete;case YieldPolicy["continue"]:return state_cooperative_yield_paused;case YieldPolicy.block:return state_blocked_paused}},state_running_paused.cancel=setState(state_running_canceled),state_running_paused.pause=_,state_running_paused.resume=setState(state_running_resumed),state_running_paused.setPriority=changePriority,state_running_resumed.enter=_,state_running_resumed.executeDone=function(job,yieldPolicy){switch(yieldPolicy){case YieldPolicy.complete:return state_complete;case YieldPolicy["continue"]:return state_cooperative_yield;case YieldPolicy.block:return state_blocked}},state_running_resumed.cancel=setState(state_running_canceled),state_running_resumed.pause=setState(state_running_paused),state_running_resumed.resume=_,state_running_resumed.setPriority=changePriority,state_running_canceled.enter=_,state_running_canceled.executeDone=function(job,yieldPolicy){switch(yieldPolicy){case YieldPolicy.complete:case YieldPolicy["continue"]:return state_canceled;case YieldPolicy.block:return state_running_canceled_blocked}},state_running_canceled.cancel=_,state_running_canceled.pause=_,state_running_canceled.resume=_,state_running_canceled.setPriority=_,state_running_canceled_blocked.enter=function(job,work){work.cancel(),job._setState(state_canceled)},state_cooperative_yield.enter=function(job,work,initialPriority){jobProfilerMark(job,"job-yielded","info"),initialPriority===job.priority?addJobAtHeadOfPriority(job,job.priority):addJobAtTailOfPriority(job,job.priority),job._work=work,job._setState(state_scheduled);
},state_cooperative_yield_paused.enter=function(job,work){jobProfilerMark(job,"job-yielded","info"),job._work=work,job._setState(state_paused)},state_blocked.enter=function(job,work,initialPriority){jobProfilerMark(job,"job-blocked","StartTM"),job._work=work,job._setState(state_blocked_waiting),work.done(function(newWork){jobProfilerMark(job,"job-blocked","StopTM");var targetState=job._blockedDone(newWork);job._setState(targetState,newWork,initialPriority)},function(error){return error&&"Canceled"===error.name||jobProfilerMark(job,"job-error","info"),jobProfilerMark(job,"job-blocked","StopTM"),job._setState(state_canceled),Promise.wrapError(error)})},state_blocked_waiting.enter=_,state_blocked_waiting.blockedDone=function(job,result){return"function"==typeof result?state_cooperative_yield:state_complete},state_blocked_waiting.cancel=setState(state_blocked_canceled),state_blocked_waiting.pause=setState(state_blocked_paused_waiting),state_blocked_waiting.resume=_,state_blocked_waiting.setPriority=changePriority,state_blocked_paused.enter=function(job,work,initialPriority){jobProfilerMark(job,"job-blocked","StartTM"),job._work=work,job._setState(state_blocked_paused_waiting),work.done(function(newWork){jobProfilerMark(job,"job-blocked","StopTM");var targetState=job._blockedDone(newWork);job._setState(targetState,newWork,initialPriority)},function(error){return error&&"Canceled"===error.name||jobProfilerMark(job,"job-error","info"),jobProfilerMark(job,"job-blocked","StopTM"),job._setState(state_canceled),Promise.wrapError(error)})},state_blocked_paused_waiting.enter=_,state_blocked_paused_waiting.blockedDone=function(job,result){return"function"==typeof result?state_cooperative_yield_paused:state_complete},state_blocked_paused_waiting.cancel=setState(state_blocked_canceled),state_blocked_paused_waiting.pause=_,state_blocked_paused_waiting.resume=setState(state_blocked_waiting),state_blocked_paused_waiting.setPriority=changePriority,state_blocked_canceled.enter=function(job){job._work.cancel(),job._work=null},state_blocked_canceled.blockedDone=function(){return state_canceled},state_blocked_canceled.cancel=_,state_blocked_canceled.pause=_,state_blocked_canceled.resume=_,state_blocked_canceled.setPriority=_,state_complete.completed=!0,state_complete.enter=function(job){_Trace._traceAsyncOperationCompleted(job._asyncOpID,_Global.Debug&&_Global.Debug.MS_ASYNC_OP_STATUS_SUCCESS),job._work=null,job._context=null,job.owner=null,jobProfilerMark(job,"job-completed","info")},state_complete.cancel=_,state_complete.pause=_,state_complete.resume=_,state_complete.setPriority=_;var MarkerNode=_Base.Class.define(function(priority,name){this.priority=priority,this.name=name},{});_Base.Class.mix(MarkerNode,linkedListMixin("Job"),linkedListMixin("Marker"));var pumping,pumpingPriority,immediateYield,globalJobId=0,globalDrainId=0,MIN_PRIORITY=-15,MAX_PRIORITY=15,Priority={max:15,high:13,aboveNormal:9,normal:0,belowNormal:-9,idle:-13,min:-15},priorities=[new MarkerNode(15,"max"),new MarkerNode(14,"14"),new MarkerNode(13,"high"),new MarkerNode(12,"12"),new MarkerNode(11,"11"),new MarkerNode(10,"10"),new MarkerNode(9,"aboveNormal"),new MarkerNode(8,"8"),new MarkerNode(7,"7"),new MarkerNode(6,"6"),new MarkerNode(5,"5"),new MarkerNode(4,"4"),new MarkerNode(3,"3"),new MarkerNode(2,"2"),new MarkerNode(1,"1"),new MarkerNode(0,"normal"),new MarkerNode(-1,"-1"),new MarkerNode(-2,"-2"),new MarkerNode(-3,"-3"),new MarkerNode(-4,"-4"),new MarkerNode(-5,"-5"),new MarkerNode(-6,"-6"),new MarkerNode(-7,"-7"),new MarkerNode(-8,"-8"),new MarkerNode(-9,"belowNormal"),new MarkerNode(-10,"-10"),new MarkerNode(-11,"-11"),new MarkerNode(-12,"-12"),new MarkerNode(-13,"idle"),new MarkerNode(-14,"-14"),new MarkerNode(-15,"min"),new MarkerNode(-16,"<TAIL>")],scheduledWwaPriority=null,runningJob=null,usingWwaScheduler=!(!_Global.MSApp||!_Global.MSApp.execAtPriority),drainQueue=[],TIME_SLICE=30,highWaterMark=Priority.min;priorities.reduce(function(prev,current){return prev&&(prev._insertJobAfter(current),prev._insertMarkerAfter(current)),current});var scheduleWithHost=_Global.setImmediate?_Global.setImmediate.bind(_Global):function(callback){_Global.setTimeout(callback,16)},MSAppStubs={execAsyncAtPriority:function(callback,priority){priority===MSApp.HIGH&&_Global.setTimeout(callback,0),scheduleWithHost(callback)},execAtPriority:function(callback){return callback()},getCurrentPriority:function(){return MSAppStubs.NORMAL},isTaskScheduledAtPriorityOrHigher:function(){return!1},HIGH:"high",NORMAL:"normal",IDLE:"idle"},MSApp=usingWwaScheduler?_Global.MSApp:MSAppStubs,wwaPriorityToInt={};wwaPriorityToInt[MSApp.IDLE]=1,wwaPriorityToInt[MSApp.NORMAL]=2,wwaPriorityToInt[MSApp.HIGH]=3;var now=_Global.performance&&_Global.performance.now&&_Global.performance.now.bind(_Global.performance)||Date.now.bind(Date),scheduledVersion=0,executedVersion=0;_Base.Namespace._moduleDefine(exports,"WinJS.Utilities.Scheduler",{Priority:Priority,schedule:schedule,createOwnerToken:createOwnerToken,execHigh:execHigh,requestDrain:requestDrain,currentPriority:{get:getCurrentPriority},schedulePromiseHigh:makeSchedulePromise(Priority.high),schedulePromiseAboveNormal:makeSchedulePromise(Priority.aboveNormal),schedulePromiseNormal:makeSchedulePromise(Priority.normal),schedulePromiseBelowNormal:makeSchedulePromise(Priority.belowNormal),schedulePromiseIdle:makeSchedulePromise(Priority.idle),retrieveState:retrieveState,_JobNode:JobNode,_JobInfo:JobInfo,_OwnerToken:OwnerToken,_dumpList:dumpList,_isEmpty:{get:isEmpty},_usingWwaScheduler:{get:function(){return usingWwaScheduler},set:function(value){usingWwaScheduler=value,MSApp=usingWwaScheduler?_Global.MSApp:MSAppStubs}},_MSApp:{get:function(){return MSApp},set:function(value){MSApp=value}},_TIME_SLICE:TIME_SLICE})}),define("WinJS/Core/_BaseUtils",["exports","./_Global","./_Base","./_BaseCoreUtils","./_ErrorFromName","./_Resources","./_Trace","../Promise","../Scheduler"],function(exports,_Global,_Base,_BaseCoreUtils,_ErrorFromName,_Resources,_Trace,Promise,Scheduler){"use strict";function nop(v){return v}function getMemberFiltered(name,root,filter){return name.split(".").reduce(function(currentNamespace,name){return currentNamespace?filter(currentNamespace[name]):null},root)}function getMember(name,root){return name?getMemberFiltered(name,root||_Global,nop):null}function getCamelCasedName(styleName){return styleName.length>0&&0!==styleName.indexOf("-moz")&&"-"===styleName.charAt(0)&&(styleName=styleName.slice(1)),styleName.replace(/\-[a-z]/g,function(x){return x[1].toUpperCase()})}function addPrefixToCamelCasedName(prefix,name){return""===prefix?name:prefix+name.charAt(0).toUpperCase()+name.slice(1)}function addPrefixToCSSName(prefix,name){return(""!==prefix?"-"+prefix.toLowerCase()+"-":"")+name}function getBrowserStyleEquivalents(){if(!_Global.document)return{};for(var equivalents={},docStyle=_Global.document.documentElement.style,stylePrefixesToTest=["","webkit","ms","Moz"],styles=["animation","transition","transform","animation-name","animation-duration","animation-delay","animation-timing-function","animation-iteration-count","animation-direction","animation-fill-mode","grid-column","grid-columns","grid-column-span","grid-row","grid-rows","grid-row-span","transform-origin","transition-property","transition-duration","transition-delay","transition-timing-function","scroll-snap-points-x","scroll-snap-points-y","scroll-chaining","scroll-limit","scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","touch-action","overflow-style","user-select"],prefixesUsedOnStyles={},i=0,len=styles.length;len>i;i++)for(var originalName=styles[i],styleToTest=getCamelCasedName(originalName),j=0,prefixLen=stylePrefixesToTest.length;prefixLen>j;j++){var prefix=stylePrefixesToTest[j],styleName=addPrefixToCamelCasedName(prefix,styleToTest);if(styleName in docStyle){var cssName=addPrefixToCSSName(prefix,originalName);equivalents[originalName]={cssName:cssName,scriptName:styleName},prefixesUsedOnStyles[originalName]=prefix;break}}return equivalents.animationPrefix=addPrefixToCSSName(prefixesUsedOnStyles.animation,""),equivalents.keyframes=addPrefixToCSSName(prefixesUsedOnStyles.animation,"keyframes"),equivalents}function getBrowserEventEquivalents(){for(var equivalents={},animationEventPrefixes=["","WebKit"],animationEvents=[{eventObject:"TransitionEvent",events:["transitionStart","transitionEnd"]},{eventObject:"AnimationEvent",events:["animationStart","animationEnd"]}],i=0,len=animationEvents.length;len>i;i++){for(var eventToTest=animationEvents[i],chosenPrefix="",j=0,prefixLen=animationEventPrefixes.length;prefixLen>j;j++){var prefix=animationEventPrefixes[j];if(prefix+eventToTest.eventObject in _Global){chosenPrefix=prefix.toLowerCase();break}}for(var j=0,eventsLen=eventToTest.events.length;eventsLen>j;j++){var eventName=eventToTest.events[j];equivalents[eventName]=addPrefixToCamelCasedName(chosenPrefix,eventName),""===chosenPrefix&&(equivalents[eventName]=equivalents[eventName].toLowerCase())}}return equivalents.manipulationStateChanged="MSManipulationEvent"in _Global?"ManipulationEvent":null,equivalents}function throttledFunction(delay,fn){function makeThrottlePromise(){return Promise.timeout(delay).then(function(){throttlePromise=null})}var throttlePromise=null,pendingCallPromise=null,nextContext=null,nextArgs=null;return function(){pendingCallPromise?(nextContext=this,nextArgs=[].slice.call(arguments,0)):throttlePromise?(nextContext=this,nextArgs=[].slice.call(arguments,0),pendingCallPromise=throttlePromise.then(function(){var context=nextContext;nextContext=null;var args=nextArgs;nextArgs=null,throttlePromise=makeThrottlePromise(),pendingCallPromise=null,fn.apply(context,args)})):(throttlePromise=makeThrottlePromise(),fn.apply(this,arguments))}}var requestAnimationWorker,strings={get notSupportedForProcessing(){return"Value is not supported within a declarative processing context, if you want it to be supported mark it using WinJS.Utilities.markSupportedForProcessing. The value was: '{0}'"}},requestAnimationId=0,requestAnimationHandlers={},validation=!1,platform=_Global.navigator.platform,isiOS="iPhone"===platform||"iPad"===platform||"iPod"===platform;_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{_setHasWinRT:{value:function(value){_BaseCoreUtils.hasWinRT=value},configurable:!1,writable:!1,enumerable:!1},hasWinRT:{get:function(){return _BaseCoreUtils.hasWinRT},configurable:!1,enumerable:!0},_setIsiOS:{value:function(value){isiOS=value},configurable:!1,writable:!1,enumerable:!1},_isiOS:{get:function(){return isiOS},configurable:!1,enumerable:!0},_getMemberFiltered:getMemberFiltered,getMember:getMember,_browserStyleEquivalents:getBrowserStyleEquivalents(),_browserEventEquivalents:getBrowserEventEquivalents(),_getCamelCasedName:getCamelCasedName,ready:function ready(callback,async){return new Promise(function(c,e){function complete(){if(callback)try{callback(),c()}catch(err){e(err)}else c()}var readyState=ready._testReadyState;readyState||(readyState=_Global.document?_Global.document.readyState:"complete"),"complete"===readyState||_Global.document&&null!==_Global.document.body?async?Scheduler.schedule(function(){complete()},Scheduler.Priority.normal,null,"WinJS.Utilities.ready"):complete():_Global.addEventListener("DOMContentLoaded",complete,!1)})},strictProcessing:{get:function(){return!0},configurable:!1,enumerable:!0},markSupportedForProcessing:{value:_BaseCoreUtils.markSupportedForProcessing,configurable:!1,writable:!1,enumerable:!0},requireSupportedForProcessing:{value:function(value){var supportedForProcessing=!0;switch(supportedForProcessing=supportedForProcessing&&value!==_Global,supportedForProcessing=supportedForProcessing&&value!==_Global.location,supportedForProcessing=supportedForProcessing&&!(value instanceof _Global.HTMLIFrameElement),supportedForProcessing=supportedForProcessing&&!("function"==typeof value&&!value.supportedForProcessing),_Global.frames.length){case 0:break;case 1:supportedForProcessing=supportedForProcessing&&value!==_Global.frames[0];break;default:for(var i=0,len=_Global.frames.length;supportedForProcessing&&len>i;i++)supportedForProcessing=supportedForProcessing&&value!==_Global.frames[i]}if(supportedForProcessing)return value;throw new _ErrorFromName("WinJS.Utilities.requireSupportedForProcessing",_Resources._formatString(strings.notSupportedForProcessing,value))},configurable:!1,writable:!1,enumerable:!0},_setImmediate:_BaseCoreUtils._setImmediate,_requestAnimationFrame:_Global.requestAnimationFrame?_Global.requestAnimationFrame.bind(_Global):function(handler){var handle=++requestAnimationId;return requestAnimationHandlers[handle]=handler,requestAnimationWorker=requestAnimationWorker||_Global.setTimeout(function(){var toProcess=requestAnimationHandlers,now=Date.now();requestAnimationHandlers={},requestAnimationWorker=null,Object.keys(toProcess).forEach(function(key){toProcess[key](now)})},16),handle},_cancelAnimationFrame:_Global.cancelAnimationFrame?_Global.cancelAnimationFrame.bind(_Global):function(handle){delete requestAnimationHandlers[handle]},_yieldForEvents:_Global.setImmediate?_Global.setImmediate.bind(_Global):function(handler){_Global.setTimeout(handler,0)},_yieldForDomModification:_Global.setImmediate?_Global.setImmediate.bind(_Global):function(handler){_Global.setTimeout(handler,0)},_throttledFunction:throttledFunction,_shallowCopy:function(a){return this._mergeAll([a])},_merge:function(a,b){return this._mergeAll([a,b])},_mergeAll:function(list){var o={};return list.forEach(function(part){Object.keys(part).forEach(function(k){o[k]=part[k]})}),o},_getProfilerMarkIdentifier:function(element){var profilerMarkIdentifier="";return element.id&&(profilerMarkIdentifier+=" id='"+element.id+"'"),element.className&&(profilerMarkIdentifier+=" class='"+element.className+"'"),profilerMarkIdentifier},_now:function(){return _Global.performance&&_Global.performance.now&&_Global.performance.now()||Date.now()},_traceAsyncOperationStarting:_Trace._traceAsyncOperationStarting,_traceAsyncOperationCompleted:_Trace._traceAsyncOperationCompleted,_traceAsyncCallbackStarting:_Trace._traceAsyncCallbackStarting,_traceAsyncCallbackCompleted:_Trace._traceAsyncCallbackCompleted,_version:"4.3.1"}),_Base.Namespace._moduleDefine(exports,"WinJS",{validation:{get:function(){return validation},set:function(value){validation=value}}}),_Base.Namespace.define("WinJS",{strictProcessing:{value:function(){},configurable:!1,writable:!1,enumerable:!1}})}),define("WinJS/Core",["./Core/_Base","./Core/_BaseCoreUtils","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Events","./Core/_Global","./Core/_Log","./Core/_Resources","./Core/_Trace","./Core/_WinRT","./Core/_WriteProfilerMark"],function(){}),define("WinJS/_Signal",["./Core/_Base","./Promise/_StateMachine"],function(_Base,_StateMachine){"use strict";var SignalPromise=_Base.Class.derive(_StateMachine.PromiseStateMachine,function(cancel){this._oncancel=cancel,this._setState(_StateMachine.state_created),this._run()},{_cancelAction:function(){this._oncancel&&this._oncancel()},_cleanupAction:function(){this._oncancel=null}},{supportedForProcessing:!1}),Signal=_Base.Class.define(function(oncancel){this._promise=new SignalPromise(oncancel)},{promise:{get:function(){return this._promise}},cancel:function(){this._promise.cancel()},complete:function(value){this._promise._completed(value)},error:function(value){this._promise._error(value)},progress:function(value){this._promise._progress(value)}},{supportedForProcessing:!1});return _Base.Namespace.define("WinJS",{_Signal:Signal}),Signal}),define("WinJS/Utilities/_Control",["exports","../Core/_Global","../Core/_Base"],function(exports,_Global,_Base){"use strict";function setOptions(control,options){_setOptions(control,options)}function _setOptions(control,options,eventsOnly){if("object"==typeof options)for(var keys=Object.keys(options),i=0,len=keys.length;len>i;i++){var key=keys[i],value=options[key];if(key.length>2){var ch1=key[0],ch2=key[1];if(!("o"!==ch1&&"O"!==ch1||"n"!==ch2&&"N"!==ch2)&&"function"==typeof value&&control.addEventListener){control.addEventListener(key.substr(2),value);continue}}eventsOnly||(control[key]=value)}}_Global.document&&_Base.Namespace._moduleDefine(exports,"WinJS.UI",{DOMEventMixin:_Base.Namespace._lazy(function(){return{_domElement:null,addEventListener:function(type,listener,useCapture){(this.element||this._domElement).addEventListener(type,listener,useCapture||!1)},dispatchEvent:function(type,eventProperties){var eventValue=_Global.document.createEvent("Event");return eventValue.initEvent(type,!1,!1),eventValue.detail=eventProperties,"object"==typeof eventProperties&&Object.keys(eventProperties).forEach(function(key){eventValue[key]=eventProperties[key]}),(this.element||this._domElement).dispatchEvent(eventValue)},removeEventListener:function(type,listener,useCapture){(this.element||this._domElement).removeEventListener(type,listener,useCapture||!1)}}}),setOptions:setOptions,_setOptions:_setOptions})}),define("WinJS/Utilities/_ElementUtilities",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_WinRT","../Promise","../Scheduler"],function(exports,_Global,_Base,_BaseUtils,_WinRT,Promise,Scheduler){"use strict";function getDefaultComputedStyle(){return defaultComputedStyle||(defaultComputedStyle={},Object.keys(_Global.CSS2Properties.prototype).forEach(function(cssProperty){defaultComputedStyle[cssProperty]=""})),defaultComputedStyle}function _getComputedStyle(element,pseudoElement){return _Global.getComputedStyle(element,pseudoElement)||getDefaultComputedStyle()}function removeEmpties(arr){for(var len=arr.length,i=len-1;i>=0;i--)arr[i]||(arr.splice(i,1),len--);return len}function getClassName(e){var name=e.className||"";return"string"==typeof name?name:name.baseVal||""}function setClassName(e,value){var name=e.className||"";return"string"==typeof name?e.className=value:e.className.baseVal=value,e}function addClass(e,name){if(e.classList){if(name.indexOf(" ")<0)e.classList.add(name);else{var namesToAdd=name.split(" ");removeEmpties(namesToAdd);for(var i=0,len=namesToAdd.length;len>i;i++)e.classList.add(namesToAdd[i])}return e}var toAdd,className=getClassName(e),names=className.split(" "),l=removeEmpties(names);if(name.indexOf(" ")>=0){var namesToAdd=name.split(" ");removeEmpties(namesToAdd);for(var i=0;l>i;i++){var found=namesToAdd.indexOf(names[i]);found>=0&&namesToAdd.splice(found,1)}namesToAdd.length>0&&(toAdd=namesToAdd.join(" "))}else{for(var saw=!1,i=0;l>i;i++)if(names[i]===name){saw=!0;break}saw||(toAdd=name)}return toAdd&&(l>0&&names[0].length>0?setClassName(e,className+" "+toAdd):setClassName(e,toAdd)),e}function removeClass(e,name){if(e.classList){if(0===e.classList.length)return e;var namesToRemove=name.split(" ");removeEmpties(namesToRemove);for(var i=0,len=namesToRemove.length;len>i;i++)e.classList.remove(namesToRemove[i]);return e}var namesToRemove,namesToRemoveLen,original=getClassName(e);if(name.indexOf(" ")>=0)namesToRemove=name.split(" "),namesToRemoveLen=removeEmpties(namesToRemove);else{if(original.indexOf(name)<0)return e;namesToRemove=[name],namesToRemoveLen=1}for(var removed,names=original.split(" "),namesLen=removeEmpties(names),i=namesLen-1;i>=0;i--)namesToRemove.indexOf(names[i])>=0&&(names.splice(i,1),removed=!0);return removed&&setClassName(e,names.join(" ")),e}function toggleClass(e,name){if(e.classList)return e.classList.toggle(name),e;for(var className=getClassName(e),names=className.trim().split(" "),l=names.length,found=!1,i=0;l>i;i++)names[i]===name&&(found=!0);return found?setClassName(e,names.reduce(function(r,e){return e===name?r:r&&r.length>0?r+" "+e:e},"")):l>0&&names[0].length>0?setClassName(e,className+" "+name):setClassName(e,className+name),e}function setAttribute(element,attribute,value){element.getAttribute(attribute)!==""+value&&element.setAttribute(attribute,value)}function _clamp(value,lowerBound,upperBound,defaultValue){var n=Math.max(lowerBound,Math.min(upperBound,+value));return 0===n?0:n||Math.max(lowerBound,Math.min(upperBound,defaultValue))}function convertToPixels(element,value){if(!_pixelsRE.test(value)&&_numberRE.test(value)){var previousValue=element.style.left;return element.style.left=value,value=element.style.pixelLeft,element.style.left=previousValue,value}return Math.round(parseFloat(value))||0}function getDimension(element,property){return convertToPixels(element,_getComputedStyle(element,null)[property])}function _convertToPrecisePixels(value){return parseFloat(value)||0}function _getPreciseDimension(element,property){return _convertToPrecisePixels(_getComputedStyle(element,null)[property])}function _getPreciseMargins(element){var style=_getComputedStyle(element);return{top:_convertToPrecisePixels(style.marginTop),right:_convertToPrecisePixels(style.marginRight),bottom:_convertToPrecisePixels(style.marginBottom),left:_convertToPrecisePixels(style.marginLeft)}}function addListenerToEventMap(element,type,listener,useCapture,data){var eventNameLowercase=type.toLowerCase();element._eventsMap||(element._eventsMap={}),element._eventsMap[eventNameLowercase]||(element._eventsMap[eventNameLowercase]=[]),element._eventsMap[eventNameLowercase].push({listener:listener,useCapture:useCapture,data:data})}function removeListenerFromEventMap(element,type,listener,useCapture){var eventNameLowercase=type.toLowerCase(),mappedEvents=element._eventsMap&&element._eventsMap[eventNameLowercase];if(mappedEvents)for(var i=mappedEvents.length-1;i>=0;i--){var mapping=mappedEvents[i];if(mapping.listener===listener&&!!useCapture==!!mapping.useCapture)return mappedEvents.splice(i,1),mapping}return null}function lookupListeners(element,type){var eventNameLowercase=type.toLowerCase();return element._eventsMap&&element._eventsMap[eventNameLowercase]&&element._eventsMap[eventNameLowercase].slice(0)||[]}function bubbleEvent(element,type,eventObject){for(;element;){for(var handlers=lookupListeners(element,type),i=0,len=handlers.length;len>i;i++)handlers[i].listener.call(element,eventObject);element=element.parentNode}}function prepareFocusEvent(eventObject){return(eventObject.relatedTarget&&"IFRAME"===eventObject.relatedTarget.tagName||eventObject.target&&"IFRAME"===eventObject.target.tagName)&&(eventObject.relatedTarget=null),eventObject}function registerBubbleListener(element,type,listener,useCapture){if(useCapture)throw"This custom WinJS event only supports bubbling";addListenerToEventMap(element,type,listener,useCapture)}function touchEventTranslator(callback,eventObject){var changedTouches=eventObject.changedTouches,retVal=null;if(!changedTouches)return retVal;for(var i=0,len=changedTouches.length;len>i;i++){var touchObject=changedTouches[i],pointerEventObject=new PointerEventProxy(eventObject,{pointerType:_MSPointerEvent.MSPOINTER_TYPE_TOUCH,pointerId:touchObject.identifier,isPrimary:0===i,screenX:touchObject.screenX,screenY:touchObject.screenY,clientX:touchObject.clientX,clientY:touchObject.clientY,pageX:touchObject.pageX,pageY:touchObject.pageY,radiusX:touchObject.radiusX,radiusY:touchObject.radiusY,rotationAngle:touchObject.rotationAngle,force:touchObject.force,_currentTouch:touchObject}),newRetVal=callback(pointerEventObject);retVal=retVal||newRetVal}return retVal}function mouseEventTranslator(callback,eventObject){return eventObject.pointerType=_MSPointerEvent.MSPOINTER_TYPE_MOUSE,eventObject.pointerId=-1,eventObject.isPrimary=!0,callback(eventObject)}function mspointerEventTranslator(callback,eventObject){return callback(eventObject)}function registerPointerEvent(element,type,callback,capture){var mouseWrapper,touchWrapper,mspointerWrapper,touchHandled,eventNameLowercase=type.toLowerCase(),translations=eventTranslations[eventNameLowercase];_Global.MSPointerEvent?(mspointerWrapper=function(eventObject){return eventObject._normalizedType=eventNameLowercase,touchHandled=!0,mspointerEventTranslator(callback,eventObject)},element.addEventListener(translations.mspointer,mspointerWrapper,capture)):(translations.mouse&&(mouseWrapper=function(eventObject){return eventObject._normalizedType=eventNameLowercase,touchHandled?void(touchHandled=!1):mouseEventTranslator(callback,eventObject)},element.addEventListener(translations.mouse,mouseWrapper,capture)),translations.touch&&(touchWrapper=function(eventObject){return eventObject._normalizedType=eventNameLowercase,touchHandled=!0,touchEventTranslator(callback,eventObject)},element.addEventListener(translations.touch,touchWrapper,capture))),addListenerToEventMap(element,type,callback,capture,{mouseWrapper:mouseWrapper,touchWrapper:touchWrapper,mspointerWrapper:mspointerWrapper})}function unregisterPointerEvent(element,type,callback,capture){var eventNameLowercase=type.toLowerCase(),mapping=removeListenerFromEventMap(element,type,callback,capture);if(mapping){var translations=eventTranslations[eventNameLowercase];mapping.data.mouseWrapper&&element.removeEventListener(translations.mouse,mapping.data.mouseWrapper,capture),mapping.data.touchWrapper&&element.removeEventListener(translations.touch,mapping.data.touchWrapper,capture),mapping.data.mspointerWrapper&&element.removeEventListener(translations.mspointer,mapping.data.mspointerWrapper,capture)}}function determineRTLEnvironment(){var element=_Global.document.createElement("div");element.style.direction="rtl",element.innerHTML="<div style='width: 100px; height: 100px; overflow: scroll; visibility:hidden'><div style='width: 10000px; height: 100px;'></div></div>",_Global.document.body.appendChild(element);var elementScroller=element.firstChild;elementScroller.scrollLeft>0&&(usingWebkitScrollCoordinates=!0),elementScroller.scrollLeft+=100,0===elementScroller.scrollLeft&&(usingFirefoxScrollCoordinates=!0),_Global.document.body.removeChild(element),determinedRTLEnvironment=!0}function getAdjustedScrollPosition(element){var computedStyle=_getComputedStyle(element),scrollLeft=element.scrollLeft;return"rtl"===computedStyle.direction&&(determinedRTLEnvironment||determineRTLEnvironment(),usingWebkitScrollCoordinates&&(scrollLeft=element.scrollWidth-element.clientWidth-scrollLeft),scrollLeft=Math.abs(scrollLeft)),{scrollLeft:scrollLeft,scrollTop:element.scrollTop}}function setAdjustedScrollPosition(element,scrollLeft,scrollTop){if(void 0!==scrollLeft){var computedStyle=_getComputedStyle(element);"rtl"===computedStyle.direction&&(determinedRTLEnvironment||determineRTLEnvironment(),usingFirefoxScrollCoordinates?scrollLeft=-scrollLeft:usingWebkitScrollCoordinates&&(scrollLeft=element.scrollWidth-element.clientWidth-scrollLeft)),element.scrollLeft=scrollLeft}void 0!==scrollTop&&(element.scrollTop=scrollTop)}function getScrollPosition(element){return getAdjustedScrollPosition(element)}function setScrollPosition(element,position){position=position||{},setAdjustedScrollPosition(element,position.scrollLeft,position.scrollTop)}function uniqueID(e){return e.uniqueID||e._uniqueID||(e._uniqueID="element__"+ ++uniqueElementIDCounter),e.uniqueID||e._uniqueID}function ensureId(element){element.id||(element.id=uniqueID(element))}function _getCursorPos(eventObject){var docElement=_Global.document.documentElement,docScrollPos=getScrollPosition(docElement);return{left:eventObject.clientX+("rtl"===_Global.document.body.dir?-docScrollPos.scrollLeft:docScrollPos.scrollLeft),top:eventObject.clientY+docElement.scrollTop}}function _getElementsByClasses(parent,classes){for(var retVal=[],i=0,len=classes.length;len>i;i++){var element=parent.querySelector("."+classes[i]);element&&retVal.push(element)}return retVal}if(_Global.document){var _zoomToDuration=167,defaultComputedStyle=null,_pixelsRE=/^-?\d+\.?\d*(px)?$/i,_numberRE=/^-?\d+/i,_MSGestureEvent=_Global.MSGestureEvent||{MSGESTURE_FLAG_BEGIN:1,MSGESTURE_FLAG_CANCEL:4,MSGESTURE_FLAG_END:2,MSGESTURE_FLAG_INERTIA:8,MSGESTURE_FLAG_NONE:0},_MSManipulationEvent=_Global.MSManipulationEvent||{MS_MANIPULATION_STATE_ACTIVE:1,MS_MANIPULATION_STATE_CANCELLED:6,MS_MANIPULATION_STATE_COMMITTED:7,MS_MANIPULATION_STATE_DRAGGING:5,MS_MANIPULATION_STATE_INERTIA:2,MS_MANIPULATION_STATE_PRESELECT:3,MS_MANIPULATION_STATE_SELECTING:4,MS_MANIPULATION_STATE_STOPPED:0},_MSPointerEvent=_Global.MSPointerEvent||{MSPOINTER_TYPE_TOUCH:"touch",MSPOINTER_TYPE_PEN:"pen",MSPOINTER_TYPE_MOUSE:"mouse"},nativeSupportForFocusIn="onfocusin"in _Global.document.documentElement,activeElement=null;_Global.addEventListener(nativeSupportForFocusIn?"focusout":"blur",function(eventObject){if(eventObject.target===_Global){var previousActiveElement=activeElement;previousActiveElement&&bubbleEvent(previousActiveElement,"focusout",prepareFocusEvent({type:"focusout",target:previousActiveElement,relatedTarget:null})),activeElement=null}}),_Global.document.documentElement.addEventListener(nativeSupportForFocusIn?"focusin":"focus",function(eventObject){var previousActiveElement=activeElement;activeElement=eventObject.target,previousActiveElement&&bubbleEvent(previousActiveElement,"focusout",prepareFocusEvent({type:"focusout",target:previousActiveElement,relatedTarget:activeElement})),activeElement&&bubbleEvent(activeElement,"focusin",prepareFocusEvent({type:"focusin",target:activeElement,relatedTarget:previousActiveElement}))},!0);var PointerEventProxy=function(eventObject,overrideProperties){overrideProperties=overrideProperties||{},this.__eventObject=eventObject;var that=this;Object.keys(overrideProperties).forEach(function(propertyName){Object.defineProperty(that,propertyName,{value:overrideProperties[propertyName]})})};["altKey","AT_TARGET","bubbles","BUBBLING_PHASE","button","buttons","cancelable","cancelBubble","CAPTURING_PHASE","clientX","clientY","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","getModifierState","height","hwTimestamp","initEvent","initMouseEvent","initPointerEvent","initUIEvent","isPrimary","isTrusted","layerX","layerY","metaKey","offsetX","offsetY","pageX","pageY","pointerId","pointerType","pressure","preventDefault","relatedTarget","rotation","screenX","screenY","shiftKey","srcElement","stopImmediatePropagation","stopPropagation","target","tiltX","tiltY","timeStamp","toElement","type","view","which","width","x","y","_normalizedType","_fakedBySemanticZoom"].forEach(function(propertyName){Object.defineProperty(PointerEventProxy.prototype,propertyName,{get:function(){var value=this.__eventObject[propertyName];return"function"==typeof value?value.bind(this.__eventObject):value},configurable:!0})});var eventTranslations={pointerdown:{touch:"touchstart",mspointer:"MSPointerDown",mouse:"mousedown"},pointerup:{touch:"touchend",mspointer:"MSPointerUp",mouse:"mouseup"},pointermove:{touch:"touchmove",mspointer:"MSPointerMove",mouse:"mousemove"},pointerenter:{touch:"touchenter",mspointer:"MSPointerEnter",mouse:"mouseenter"},pointerover:{touch:null,mspointer:"MSPointerOver",mouse:"mouseover"},pointerout:{touch:"touchleave",mspointer:"MSPointerOut",mouse:"mouseout"},pointercancel:{touch:"touchcancel",mspointer:"MSPointerCancel",mouse:null}},customEvents={focusout:{register:registerBubbleListener,unregister:removeListenerFromEventMap},focusin:{register:registerBubbleListener,unregister:removeListenerFromEventMap}};if(!_Global.PointerEvent){var pointerEventEntry={register:registerPointerEvent,unregister:unregisterPointerEvent};customEvents.pointerdown=pointerEventEntry,customEvents.pointerup=pointerEventEntry,customEvents.pointermove=pointerEventEntry,customEvents.pointerenter=pointerEventEntry,customEvents.pointerover=pointerEventEntry,customEvents.pointerout=pointerEventEntry,customEvents.pointercancel=pointerEventEntry}var MutationObserverShim=_Base.Class.define(function(callback){this._callback=callback,this._toDispose=[],this._attributeFilter=[],this._scheduled=!1,this._pendingChanges=[],this._observerCount=0,this._handleCallback=this._handleCallback.bind(this),this._targetElements=[]},{observe:function(element,configuration){-1===this._targetElements.indexOf(element)&&this._targetElements.push(element),
this._observerCount++,configuration.attributes&&this._addRemovableListener(element,"DOMAttrModified",this._handleCallback),configuration.attributeFilter&&(this._attributeFilter=configuration.attributeFilter)},disconnect:function(){this._observerCount=0,this._targetElements=[],this._toDispose.forEach(function(disposeFunc){disposeFunc()})},_addRemovableListener:function(target,event,listener){target.addEventListener(event,listener),this._toDispose.push(function(){target.removeEventListener(event,listener)})},_handleCallback:function(evt){evt.stopPropagation();var attrName=evt.attrName;if((!this._attributeFilter.length||-1!==this._attributeFilter.indexOf(attrName))&&-1!==this._targetElements.indexOf(evt.target)){var isAriaMutation=attrName.indexOf("aria")>=0;"tabindex"===attrName&&(attrName="tabIndex"),this._pendingChanges.push({type:"attributes",target:evt.target,attributeName:attrName}),1!==this._observerCount||isAriaMutation?this._scheduled===!1&&(this._scheduled=!0,_BaseUtils._setImmediate(this._dispatchEvent.bind(this))):this._dispatchEvent()}},_dispatchEvent:function(){try{this._callback(this._pendingChanges)}finally{this._pendingChanges=[],this._scheduled=!1}}},{_isShim:!0}),_MutationObserver=_Global.MutationObserver||MutationObserverShim,_resizeNotifier=null,ResizeNotifier=_Base.Class.define(function(){_Global.addEventListener("resize",this._handleResize.bind(this))},{subscribe:function(element,handler){element.addEventListener(this._resizeEvent,handler),addClass(element,this._resizeClass)},unsubscribe:function(element,handler){removeClass(element,this._resizeClass),element.removeEventListener(this._resizeEvent,handler)},_handleResize:function(){for(var resizables=_Global.document.querySelectorAll("."+this._resizeClass),length=resizables.length,i=0;length>i;i++){var event=_Global.document.createEvent("Event");event.initEvent(this._resizeEvent,!1,!0),resizables[i].dispatchEvent(event)}},_resizeClass:{get:function(){return"win-element-resize"}},_resizeEvent:{get:function(){return"WinJSElementResize"}}}),GenericListener=_Base.Class.define(function(objectName,object,options){options=options||{},this.registerThruWinJSCustomEvents=!!options.registerThruWinJSCustomEvents,this.objectName=objectName,this.object=object,this.capture={},this.bubble={}},{addEventListener:function(element,name,listener,capture){name=name.toLowerCase();var handlers=this._getHandlers(capture),handler=handlers[name];handler||(handler=this._getListener(name,capture),handler.refCount=0,handlers[name]=handler,this.registerThruWinJSCustomEvents?exports._addEventListener(this.object,name,handler,capture):this.object.addEventListener(name,handler,capture)),handler.refCount++,element.addEventListener(this._getEventName(name,capture),listener),addClass(element,this._getClassName(name,capture))},removeEventListener:function(element,name,listener,capture){name=name.toLowerCase();var handlers=this._getHandlers(capture),handler=handlers[name];handler&&(handler.refCount--,0===handler.refCount&&(this.registerThruWinJSCustomEvents?exports._removeEventListener(this.object,name,handler,capture):this.object.removeEventListener(name,handler,capture),delete handlers[name])),removeClass(element,this._getClassName(name,capture)),element.removeEventListener(this._getEventName(name,capture),listener)},_getHandlers:function(capture){return capture?this.capture:this.bubble},_getClassName:function(name,capture){var captureSuffix=capture?"capture":"bubble";return"win-"+this.objectName.toLowerCase()+"-event-"+name+captureSuffix},_getEventName:function(name,capture){var captureSuffix=capture?"capture":"bubble";return"WinJS"+this.objectName+"Event-"+name+captureSuffix},_getListener:function(name,capture){var listener=function(ev){for(var targets=_Global.document.querySelectorAll("."+this._getClassName(name,capture)),length=targets.length,handled=!1,i=0;length>i;i++){var event=_Global.document.createEvent("Event");event.initEvent(this._getEventName(name,capture),!1,!0),event.detail={originalEvent:ev};var doDefault=targets[i].dispatchEvent(event);handled=handled||!doDefault}return handled};return listener.bind(this)}}),determinedRTLEnvironment=!1,usingWebkitScrollCoordinates=!1,usingFirefoxScrollCoordinates=!1,supportsSnapPoints=_Global.navigator.msManipulationViewsEnabled||_Global.navigator.userAgent.indexOf("MSAppHost")>=0,supportsTouchDetection=!(!_Global.MSPointerEvent&&!_Global.TouchEvent),uniqueElementIDCounter=0,_selectionPartsSelector=".win-selectionborder, .win-selectionbackground, .win-selectioncheckmark, .win-selectioncheckmarkbackground",_dataKey="_msDataKey";_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{_dataKey:_dataKey,_supportsSnapPoints:{get:function(){return supportsSnapPoints}},_supportsTouchDetection:{get:function(){return supportsTouchDetection}},_uniqueID:uniqueID,_ensureId:ensureId,_clamp:_clamp,_getCursorPos:_getCursorPos,_getElementsByClasses:_getElementsByClasses,_createGestureRecognizer:function(){if(_Global.MSGesture)return new _Global.MSGesture;var doNothing=function(){};return{addEventListener:doNothing,removeEventListener:doNothing,addPointer:doNothing,stop:doNothing}},_MSGestureEvent:_MSGestureEvent,_MSManipulationEvent:_MSManipulationEvent,_elementsFromPoint:function(x,y){if(_Global.document.msElementsFromPoint)return _Global.document.msElementsFromPoint(x,y);var element=_Global.document.elementFromPoint(x,y);return element?[element]:null},_matchesSelector:function(element,selectorString){var matchesSelector=element.matches||element.msMatchesSelector||element.mozMatchesSelector||element.webkitMatchesSelector;return matchesSelector.call(element,selectorString)},_selectionPartsSelector:_selectionPartsSelector,_isSelectionRendered:function(itemBox){return itemBox.querySelectorAll(_selectionPartsSelector).length>0},_addEventListener:function(element,type,listener,useCapture){var eventNameLower=type&&type.toLowerCase(),entry=customEvents[eventNameLower],equivalentEvent=_BaseUtils._browserEventEquivalents[type];entry?entry.register(element,type,listener,useCapture):equivalentEvent?element.addEventListener(equivalentEvent,listener,useCapture):element.addEventListener(type,listener,useCapture)},_removeEventListener:function(element,type,listener,useCapture){var eventNameLower=type&&type.toLowerCase(),entry=customEvents[eventNameLower],equivalentEvent=_BaseUtils._browserEventEquivalents[type];entry?entry.unregister(element,type,listener,useCapture):equivalentEvent?element.removeEventListener(equivalentEvent,listener,useCapture):element.removeEventListener(type,listener,useCapture)},_initEventImpl:function(initType,event,eventType){eventType=eventType.toLowerCase();var mapping=eventTranslations[eventType];if(mapping)switch(initType.toLowerCase()){case"pointer":_Global.PointerEvent||(arguments[2]=mapping.mspointer);break;default:arguments[2]=mapping[initType.toLowerCase()]}event["init"+initType+"Event"].apply(event,Array.prototype.slice.call(arguments,2))},_initMouseEvent:function(event){this._initEventImpl.apply(this,["Mouse",event].concat(Array.prototype.slice.call(arguments,1)))},_initPointerEvent:function(event){this._initEventImpl.apply(this,["Pointer",event].concat(Array.prototype.slice.call(arguments,1)))},_PointerEventProxy:PointerEventProxy,_bubbleEvent:bubbleEvent,_setPointerCapture:function(element,pointerId){element.setPointerCapture&&element.setPointerCapture(pointerId)},_releasePointerCapture:function(element,pointerId){element.releasePointerCapture&&element.releasePointerCapture(pointerId)},_MSPointerEvent:_MSPointerEvent,_getComputedStyle:_getComputedStyle,_zoomToDuration:_zoomToDuration,_zoomTo:function(element,args){this._supportsSnapPoints&&element.msZoomTo?element.msZoomTo(args):Scheduler.schedule(function(){var initialPos=getAdjustedScrollPosition(element),effectiveScrollLeft="number"==typeof element._zoomToDestX?element._zoomToDestX:initialPos.scrollLeft,effectiveScrollTop="number"==typeof element._zoomToDestY?element._zoomToDestY:initialPos.scrollTop,cs=_getComputedStyle(element),scrollLimitX=element.scrollWidth-parseInt(cs.width,10)-parseInt(cs.paddingLeft,10)-parseInt(cs.paddingRight,10),scrollLimitY=element.scrollHeight-parseInt(cs.height,10)-parseInt(cs.paddingTop,10)-parseInt(cs.paddingBottom,10);"number"!=typeof args.contentX&&(args.contentX=effectiveScrollLeft),"number"!=typeof args.contentY&&(args.contentY=effectiveScrollTop);var zoomToDestX=_clamp(args.contentX,0,scrollLimitX),zoomToDestY=_clamp(args.contentY,0,scrollLimitY);if(zoomToDestX!==effectiveScrollLeft||zoomToDestY!==effectiveScrollTop){element._zoomToId=element._zoomToId||0,element._zoomToId++,element._zoomToDestX=zoomToDestX,element._zoomToDestY=zoomToDestY;var thisZoomToId=element._zoomToId,start=_BaseUtils._now(),xFactor=(element._zoomToDestX-initialPos.scrollLeft)/_zoomToDuration,yFactor=(element._zoomToDestY-initialPos.scrollTop)/_zoomToDuration,update=function(){var t=_BaseUtils._now()-start;element._zoomToId===thisZoomToId&&(t>_zoomToDuration?(setAdjustedScrollPosition(element,element._zoomToDestX,element._zoomToDestY),element._zoomToDestX=null,element._zoomToDestY=null):(setAdjustedScrollPosition(element,initialPos.scrollLeft+t*xFactor,initialPos.scrollTop+t*yFactor),_BaseUtils._requestAnimationFrame(update)))};_BaseUtils._requestAnimationFrame(update)}},Scheduler.Priority.high,null,"WinJS.Utilities._zoomTo")},_setActive:function(element,scroller){var success=!0;try{if(_Global.HTMLElement&&_Global.HTMLElement.prototype.setActive)element.setActive();else{var scrollLeft,scrollTop;scroller&&(scrollLeft=scroller.scrollLeft,scrollTop=scroller.scrollTop),element.focus(),scroller&&(scroller.scrollLeft=scrollLeft,scroller.scrollTop=scrollTop)}}catch(e){success=!1}return success},_MutationObserver:_MutationObserver,_resizeNotifier:{get:function(){return _resizeNotifier||(_resizeNotifier=new ResizeNotifier),_resizeNotifier}},_GenericListener:GenericListener,_globalListener:new GenericListener("Global",_Global,{registerThruWinJSCustomEvents:!0}),_documentElementListener:new GenericListener("DocumentElement",_Global.document.documentElement,{registerThruWinJSCustomEvents:!0}),_inputPaneListener:_WinRT.Windows.UI.ViewManagement.InputPane?new GenericListener("InputPane",_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView()):{addEventListener:function(){},removeEventListener:function(){}},_addInsertedNotifier:function(element){var hiddenElement=_Global.document.createElement("div");return hiddenElement.style[_BaseUtils._browserStyleEquivalents["animation-name"].scriptName]="WinJS-node-inserted",hiddenElement.style[_BaseUtils._browserStyleEquivalents["animation-duration"].scriptName]="0.01s",hiddenElement.style.position="absolute",element.appendChild(hiddenElement),exports._addEventListener(hiddenElement,"animationStart",function(e){if("WinJS-node-inserted"===e.animationName){var e=_Global.document.createEvent("Event");e.initEvent("WinJSNodeInserted",!1,!0),element.dispatchEvent(e)}},!1),hiddenElement},_inDom:function(element){return new Promise(function(c){if(_Global.document.body.contains(element))c();else{var nodeInsertedHandler=function(){element.removeEventListener("WinJSNodeInserted",nodeInsertedHandler,!1),c()};exports._addInsertedNotifier(element),element.addEventListener("WinJSNodeInserted",nodeInsertedHandler,!1)}})},_setFlexStyle:function(element,flexParams){var styleObject=element.style;"undefined"!=typeof flexParams.grow&&(styleObject.msFlexPositive=flexParams.grow,styleObject.webkitFlexGrow=flexParams.grow,styleObject.flexGrow=flexParams.grow),"undefined"!=typeof flexParams.shrink&&(styleObject.msFlexNegative=flexParams.shrink,styleObject.webkitFlexShrink=flexParams.shrink,styleObject.flexShrink=flexParams.shrink),"undefined"!=typeof flexParams.basis&&(styleObject.msFlexPreferredSize=flexParams.basis,styleObject.webkitFlexBasis=flexParams.basis,styleObject.flexBasis=flexParams.basis)},Key:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,deleteKey:46,num0:48,num1:49,num2:50,num3:51,num4:52,num5:53,num6:54,num7:55,num8:56,num9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindows:91,rightWindows:92,menu:93,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NavigationView:136,NavigationMenu:137,NavigationUp:138,NavigationDown:139,NavigationLeft:140,NavigationRight:141,NavigationAccept:142,NavigationCancel:143,numLock:144,scrollLock:145,browserBack:166,browserForward:167,semicolon:186,equal:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,GamepadA:195,GamepadB:196,GamepadX:197,GamepadY:198,GamepadRightShoulder:199,GamepadLeftShoulder:200,GamepadLeftTrigger:201,GamepadRightTrigger:202,GamepadDPadUp:203,GamepadDPadDown:204,GamepadDPadLeft:205,GamepadDPadRight:206,GamepadMenu:207,GamepadView:208,GamepadLeftThumbstick:209,GamepadRightThumbstick:210,GamepadLeftThumbstickUp:211,GamepadLeftThumbstickDown:212,GamepadLeftThumbstickRight:213,GamepadLeftThumbstickLeft:214,GamepadRightThumbstickUp:215,GamepadRightThumbstickDown:216,GamepadRightThumbstickRight:217,GamepadRightThumbstickLeft:218,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222,IME:229},data:function(element){return element[_dataKey]||(element[_dataKey]={}),element[_dataKey]},hasClass:function(e,name){if(e.classList)return e.classList.contains(name);for(var className=getClassName(e),names=className.trim().split(" "),l=names.length,i=0;l>i;i++)if(names[i]===name)return!0;return!1},addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,_setAttribute:setAttribute,getRelativeLeft:function(element,parent){if(!element)return 0;for(var left=element.offsetLeft,e=element.parentNode;e&&(left-=e.offsetLeft,e!==parent);)e=e.parentNode;return left},getRelativeTop:function(element,parent){if(!element)return 0;for(var top=element.offsetTop,e=element.parentNode;e&&(top-=e.offsetTop,e!==parent);)e=e.parentNode;return top},getScrollPosition:getScrollPosition,setScrollPosition:setScrollPosition,empty:function(element){if(element.childNodes&&element.childNodes.length>0)for(var i=element.childNodes.length-1;i>=0;i--)element.removeChild(element.childNodes.item(i));return element},_isDOMElement:function(element){return element&&"object"==typeof element&&"string"==typeof element.tagName},getContentWidth:function(element){var border=getDimension(element,"borderLeftWidth")+getDimension(element,"borderRightWidth"),padding=getDimension(element,"paddingLeft")+getDimension(element,"paddingRight");return element.offsetWidth-border-padding},_getPreciseContentWidth:function(element){var border=_getPreciseDimension(element,"borderLeftWidth")+_getPreciseDimension(element,"borderRightWidth"),padding=_getPreciseDimension(element,"paddingLeft")+_getPreciseDimension(element,"paddingRight");return element.offsetWidth-border-padding},getTotalWidth:function(element){var margin=getDimension(element,"marginLeft")+getDimension(element,"marginRight");return element.offsetWidth+margin},_getPreciseTotalWidth:function(element){var margin=_getPreciseDimension(element,"marginLeft")+_getPreciseDimension(element,"marginRight");return element.offsetWidth+margin},getContentHeight:function(element){var border=getDimension(element,"borderTopWidth")+getDimension(element,"borderBottomWidth"),padding=getDimension(element,"paddingTop")+getDimension(element,"paddingBottom");return element.offsetHeight-border-padding},_getPreciseContentHeight:function(element){var border=_getPreciseDimension(element,"borderTopWidth")+_getPreciseDimension(element,"borderBottomWidth"),padding=_getPreciseDimension(element,"paddingTop")+_getPreciseDimension(element,"paddingBottom");return element.offsetHeight-border-padding},getTotalHeight:function(element){var margin=getDimension(element,"marginTop")+getDimension(element,"marginBottom");return element.offsetHeight+margin},_getPreciseTotalHeight:function(element){var margin=_getPreciseDimension(element,"marginTop")+_getPreciseDimension(element,"marginBottom");return element.offsetHeight+margin},getPosition:function(element){return exports._getPositionRelativeTo(element,null)},getTabIndex:function(element){var tabbableElementsRE=/BUTTON|COMMAND|MENUITEM|OBJECT|SELECT|TEXTAREA/;if(element.disabled)return-1;var tabIndex=element.getAttribute("tabindex");if(null===tabIndex||void 0===tabIndex){var name=element.tagName;return tabbableElementsRE.test(name)||element.href&&("A"===name||"AREA"===name||"LINK"===name)||"INPUT"===name&&"hidden"!==element.type||"TH"===name&&element.sorted?0:-1}return parseInt(tabIndex,10)},convertToPixels:convertToPixels,_convertToPrecisePixels:_convertToPrecisePixels,_getPreciseMargins:_getPreciseMargins,eventWithinElement:function(element,event){var related=event.relatedTarget;return related&&related!==element?element.contains(related):!1},_deprecated:function(message){_Global.console&&_Global.console.warn(message)},_syncRenderer:function(renderer,tagName){if(tagName=tagName||"div","function"==typeof renderer)return function(data,container){return container?(container.appendChild(renderer(data)),container):renderer(data)};var template;return"function"==typeof renderer.render?template=renderer:renderer.winControl&&"function"==typeof renderer.winControl.render&&(template=renderer.winControl),function(data,container){var host=container||_Global.document.createElement(tagName);if(template.render(data,host),container)return container;var element=host.firstElementChild;if(element&&host.dispose){var prev=element.dispose;element.dispose=function(){element.dispose=prev,host.appendChild(element),host.dispose()}}return element}},_getPositionRelativeTo:function(element,ancestor){for(var fromElement=element,offsetParent=element.offsetParent,top=element.offsetTop,left=element.offsetLeft;(element=element.parentNode)&&element!==ancestor&&element!==_Global.document.body&&element!==_Global.document.documentElement;){top-=element.scrollTop;var dir=_getComputedStyle(element,null).direction;left-="rtl"!==dir?element.scrollLeft:-getAdjustedScrollPosition(element).scrollLeft,element===offsetParent&&(top+=element.offsetTop,left+=element.offsetLeft,offsetParent=element.offsetParent)}return{left:left,top:top,width:fromElement.offsetWidth,height:fromElement.offsetHeight}},_getHighAndLowTabIndices:function(element){for(var descendants=element.getElementsByTagName("*"),lowestTabIndex=0,highestTabIndex=0,foundTabIndex0=!1,i=0,len=descendants.length;len>i;i++){var tabIndexStr=descendants[i].getAttribute("tabIndex");if(null!==tabIndexStr&&void 0!==tabIndexStr){var tabIndex=parseInt(tabIndexStr,10);tabIndex>0&&(lowestTabIndex>tabIndex||0===lowestTabIndex)&&(lowestTabIndex=tabIndex),foundTabIndex0||(0===tabIndex?(foundTabIndex0=!0,highestTabIndex=0):tabIndex>highestTabIndex&&(highestTabIndex=tabIndex))}}return{highest:highestTabIndex,lowest:lowestTabIndex}},_getLowestTabIndexInList:function(elements){for(var elmTabIndex,lowestTabIndex=0,i=0;i<elements.length;i++)elmTabIndex=parseInt(elements[i].getAttribute("tabIndex"),10),elmTabIndex>0&&(lowestTabIndex>elmTabIndex||!lowestTabIndex)&&(lowestTabIndex=elmTabIndex);return lowestTabIndex},_getHighestTabIndexInList:function(elements){for(var elmTabIndex,highestTabIndex=0,i=0;i<elements.length;i++){if(elmTabIndex=parseInt(elements[i].getAttribute("tabIndex"),10),0===elmTabIndex)return elmTabIndex;elmTabIndex>highestTabIndex&&(highestTabIndex=elmTabIndex)}return highestTabIndex},_hasCursorKeysBehaviors:function(element){return"SELECT"===element.tagName||"TEXTAREA"===element.tagName?!0:"INPUT"===element.tagName?""===element.type||"date"===element.type||"datetime"===element.type||"datetime-local"===element.type||"email"===element.type||"month"===element.type||"number"===element.type||"password"===element.type||"range"===element.type||"search"===element.type||"tel"===element.type||"text"===element.type||"time"===element.type||"url"===element.type||"week"===element.type:!1},_reparentChildren:function(originalParent,destinationParent){for(var child=originalParent.firstChild;child;){var sibling=child.nextSibling;destinationParent.appendChild(child),child=sibling}},_maintainFocus:function(callback){var focusedElement=_Global.document.activeElement;callback(),exports._trySetActiveOnAnyElement(focusedElement)},_trySetActiveOnAnyElement:function(element,scroller){return exports._tryFocusOnAnyElement(element,!0,scroller)},_tryFocusOnAnyElement:function(element,useSetActive,scroller){var previousActiveElement=_Global.document.activeElement;return element===previousActiveElement?!0:(useSetActive?exports._setActive(element,scroller):element.focus(),previousActiveElement!==_Global.document.activeElement)},_trySetActive:function(elem,scroller){return this._tryFocus(elem,!0,scroller)},_tryFocus:function(elem,useSetActive,scroller){var previousActiveElement=_Global.document.activeElement;if(elem===previousActiveElement)return!0;var simpleLogicForValidTabStop=exports.getTabIndex(elem)>=0;return simpleLogicForValidTabStop?(useSetActive?exports._setActive(elem,scroller):elem.focus(),previousActiveElement!==_Global.document.activeElement?!0:!1):!1},_setActiveFirstFocusableElement:function(rootEl,scroller){return this._focusFirstFocusableElement(rootEl,!0,scroller)},_focusFirstFocusableElement:function(rootEl,useSetActive,scroller){for(var i,_elms=rootEl.getElementsByTagName("*"),_lowestTabIndex=this._getLowestTabIndexInList(_elms),_nextLowestTabIndex=0;_lowestTabIndex;){for(i=0;i<_elms.length;i++)if(_elms[i].tabIndex===_lowestTabIndex){if(this._tryFocus(_elms[i],useSetActive,scroller))return!0}else _lowestTabIndex<_elms[i].tabIndex&&(_elms[i].tabIndex<_nextLowestTabIndex||0===_nextLowestTabIndex)&&(_nextLowestTabIndex=_elms[i].tabIndex);_lowestTabIndex=_nextLowestTabIndex,_nextLowestTabIndex=0}for(i=0;i<_elms.length;i++)if(this._tryFocus(_elms[i],useSetActive,scroller))return!0;return!1},_setActiveLastFocusableElement:function(rootEl,scroller){return this._focusLastFocusableElement(rootEl,!0,scroller)},_focusLastFocusableElement:function(rootEl,useSetActive,scroller){var i,_elms=rootEl.getElementsByTagName("*"),_highestTabIndex=this._getHighestTabIndexInList(_elms),_nextHighestTabIndex=0;if(0===_highestTabIndex){for(i=_elms.length-1;i>=0;i--)if(_elms[i].tabIndex===_highestTabIndex){if(this._tryFocus(_elms[i],useSetActive,scroller))return!0}else _nextHighestTabIndex<_elms[i].tabIndex&&(_nextHighestTabIndex=_elms[i].tabIndex);_highestTabIndex=_nextHighestTabIndex,_nextHighestTabIndex=0}for(;_highestTabIndex;){for(i=_elms.length-1;i>=0;i--)if(_elms[i].tabIndex===_highestTabIndex){if(this._tryFocus(_elms[i],useSetActive,scroller))return!0}else _nextHighestTabIndex<_elms[i].tabIndex&&_elms[i].tabIndex<_highestTabIndex&&(_nextHighestTabIndex=_elms[i].tabIndex);_highestTabIndex=_nextHighestTabIndex,_nextHighestTabIndex=0}for(i=_elms.length-2;i>0;i--)if(this._tryFocus(_elms[i],useSetActive,scroller))return!0;return!1}})}}),define("WinJS/Utilities/_Dispose",["exports","../Core/_Base","../Core/_WriteProfilerMark","./_ElementUtilities"],function(exports,_Base,_WriteProfilerMark,_ElementUtilities){"use strict";function markDisposable(element,disposeImpl){var disposed=!1;_ElementUtilities.addClass(element,"win-disposable");var disposable=element.winControl||element;disposable.dispose=function(){disposed||(disposed=!0,disposeSubTree(element),disposeImpl&&disposeImpl())}}function disposeSubTree(element){if(element){_WriteProfilerMark("WinJS.Utilities.disposeSubTree,StartTM");for(var query=element.querySelectorAll(".win-disposable"),index=0,length=query.length;length>index;){var disposable=query[index];disposable.winControl&&disposable.winControl.dispose&&disposable.winControl.dispose(),disposable.dispose&&disposable.dispose(),index+=disposable.querySelectorAll(".win-disposable").length+1}_WriteProfilerMark("WinJS.Utilities.disposeSubTree,StopTM")}}function _disposeElement(element){if(element){var disposed=!1;element.winControl&&element.winControl.dispose&&(element.winControl.dispose(),disposed=!0),element.dispose&&(element.dispose(),disposed=!0),disposed||disposeSubTree(element)}}_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{markDisposable:markDisposable,disposeSubTree:disposeSubTree,_disposeElement:_disposeElement})}),define("WinJS/ControlProcessor/_OptionsLexer",["exports","../Core/_Base"],function optionsLexerInit(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_optionsLexer:_Base.Namespace._lazy(function(){function reservedWord(word){return{type:tokenType.reservedWord,value:word,length:word.length,keyword:!0}}function reservedWordLookup(identifier){switch(identifier.charCodeAt(0)){case 98:switch(identifier){case"break":return reservedWord(identifier)}break;case 99:switch(identifier){case"case":case"catch":case"class":case"const":case"continue":return reservedWord(identifier)}break;case 100:switch(identifier){case"debugger":case"default":case"delete":case"do":return reservedWord(identifier)}break;case 101:switch(identifier){case"else":case"enum":case"export":case"extends":return reservedWord(identifier)}break;case 102:switch(identifier){case"false":return tokens.falseLiteral;case"finally":case"for":case"function":return reservedWord(identifier)}break;case 105:switch(identifier){case"if":case"import":case"in":case"instanceof":return reservedWord(identifier)}break;case 110:switch(identifier){case"null":return tokens.nullLiteral;case"new":return reservedWord(identifier)}break;case 114:switch(identifier){case"return":return reservedWord(identifier)}break;case 115:switch(identifier){case"super":case"switch":return reservedWord(identifier)}break;case 116:switch(identifier){case"true":return tokens.trueLiteral;case"this":return tokens.thisKeyword;case"throw":case"try":case"typeof":return reservedWord(identifier)}break;case 118:switch(identifier){case"var":case"void":return reservedWord(identifier)}break;case 119:switch(identifier){case"while":case"with":return reservedWord(identifier)}}}var tokenType={leftBrace:1,rightBrace:2,leftBracket:3,rightBracket:4,separator:5,colon:6,semicolon:7,comma:8,dot:9,nullLiteral:10,trueLiteral:11,falseLiteral:12,numberLiteral:13,stringLiteral:14,identifier:15,reservedWord:16,thisKeyword:17,leftParentheses:18,rightParentheses:19,eof:20,error:21},tokens={leftBrace:{type:tokenType.leftBrace,length:1},rightBrace:{type:tokenType.rightBrace,length:1},leftBracket:{type:tokenType.leftBracket,length:1},rightBracket:{type:tokenType.rightBracket,length:1},colon:{type:tokenType.colon,length:1},semicolon:{type:tokenType.semicolon,length:1},comma:{type:tokenType.comma,length:1},dot:{type:tokenType.dot,length:1},nullLiteral:{type:tokenType.nullLiteral,length:4,value:null,keyword:!0},trueLiteral:{type:tokenType.trueLiteral,length:4,value:!0,keyword:!0},falseLiteral:{type:tokenType.falseLiteral,length:5,value:!1,keyword:!0},thisKeyword:{type:tokenType.thisKeyword,length:4,value:"this",keyword:!0},leftParentheses:{type:tokenType.leftParentheses,length:1},rightParentheses:{type:tokenType.rightParentheses,length:1},eof:{type:tokenType.eof,length:0}},lexer=function(){function isIdentifierStartCharacter(code,text,offset,limit){switch(code){case code>=97&&122>=code&&code:case code>=65&&90>=code&&code:case 36:case 95:return!0;case isWhitespace(code)&&code:case isLineTerminator(code)&&code:return!1;case code>127&&code:return!0;case 92:return limit>offset+4&&117===text.charCodeAt(offset)&&isHexDigit(text.charCodeAt(offset+1))&&isHexDigit(text.charCodeAt(offset+2))&&isHexDigit(text.charCodeAt(offset+3))&&isHexDigit(text.charCodeAt(offset+4))?!0:!1;default:return!1}}function readIdentifierPart(text,offset,limit){for(var hasEscape=!1;limit>offset;){var code=text.charCodeAt(offset);switch(code){case code>=97&&122>=code&&code:case code>=65&&90>=code&&code:case 36:case 95:break;case isWhitespace(code)&&code:case isLineTerminator(code)&&code:return hasEscape?-offset:offset;case code>127&&code:break;case code>=48&&57>=code&&code:break;case 92:if(limit>offset+5&&117===text.charCodeAt(offset+1)&&isHexDigit(text.charCodeAt(offset+2))&&isHexDigit(text.charCodeAt(offset+3))&&isHexDigit(text.charCodeAt(offset+4))&&isHexDigit(text.charCodeAt(offset+5))){offset+=5,hasEscape=!0;break}return hasEscape?-offset:offset;default:return hasEscape?-offset:offset}offset++}return hasEscape?-offset:offset}function readIdentifierToken(text,offset,limit){var startOffset=offset;offset=readIdentifierPart(text,offset,limit);var hasEscape=!1;0>offset&&(offset=-offset,hasEscape=!0);var identifier=text.substr(startOffset,offset-startOffset);hasEscape&&(identifier=""+JSON.parse('"'+identifier+'"'));var wordToken=reservedWordLookup(identifier);return wordToken?wordToken:{type:tokenType.identifier,length:offset-startOffset,value:identifier}}function isHexDigit(code){switch(code){case code>=48&&57>=code&&code:case code>=97&&102>=code&&code:case code>=65&&70>=code&&code:return!0;default:return!1}}function readHexIntegerLiteral(text,offset,limit){for(;limit>offset&&isHexDigit(text.charCodeAt(offset));)offset++;return offset}function isDecimalDigit(code){switch(code){case code>=48&&57>=code&&code:return!0;default:return!1}}function readDecimalDigits(text,offset,limit){for(;limit>offset&&isDecimalDigit(text.charCodeAt(offset));)offset++;return offset}function readDecimalLiteral(text,offset,limit){if(offset=readDecimalDigits(text,offset,limit),limit>offset&&46===text.charCodeAt(offset)&&limit>offset+1&&isDecimalDigit(text.charCodeAt(offset+1))&&(offset=readDecimalDigits(text,offset+2,limit)),limit>offset){var code=text.charCodeAt(offset);if(101===code||69===code){var tempOffset=offset+1;limit>tempOffset&&(code=text.charCodeAt(tempOffset),(43===code||45===code)&&tempOffset++,offset=readDecimalDigits(text,tempOffset,limit))}}return offset}function readDecimalLiteralToken(text,start,offset,limit){var offset=readDecimalLiteral(text,offset,limit),length=offset-start;return{type:tokenType.numberLiteral,length:length,value:+text.substr(start,length)}}function isLineTerminator(code){switch(code){case 10:case 13:case 8232:case 8233:return!0;default:return!1}}function readStringLiteralToken(text,offset,limit){var startOffset=offset,quoteCharCode=text.charCodeAt(offset),hasEscape=!1;for(offset++;limit>offset&&!isLineTerminator(text.charCodeAt(offset));){if(limit>offset+1&&92===text.charCodeAt(offset))switch(hasEscape=!0,text.charCodeAt(offset+1)){case quoteCharCode:case 92:case 10:case 8232:case 8233:offset+=2;continue;case 13:offset+=limit>offset+2&&10===text.charCodeAt(offset+2)?3:2;continue}if(offset++,text.charCodeAt(offset-1)===quoteCharCode)break}var length=offset-startOffset;hasEscape=hasEscape||1===length||text.charCodeAt(offset-1)!==quoteCharCode;var stringValue;return stringValue=hasEscape?eval(text.substr(startOffset,length)):text.substr(startOffset+1,length-2),{type:tokenType.stringLiteral,length:length,value:stringValue}}function isWhitespace(code){switch(code){case 9:case 11:case 12:case 32:case 160:case 65279:return!0;case 5760>code&&code:return!1;case 5760:case 6158:case code>=8192&&8202>=code&&code:case 8239:case 8287:case 12288:return!0;default:return!1}}function readWhitespace(text,offset,limit){for(;limit>offset;){var code=text.charCodeAt(offset);switch(code){case 9:case 11:case 12:case 32:case 160:case 65279:break;case 5760>code&&code:return offset;case 5760:case 6158:case code>=8192&&8202>=code&&code:case 8239:case 8287:case 12288:break;default:return offset}offset++}return offset}function lex(result,text,offset,limit){for(;limit>offset;){var token,startOffset=offset,code=text.charCodeAt(offset++);switch(code){case isWhitespace(code)&&code:case isLineTerminator(code)&&code:offset=readWhitespace(text,offset,limit),
token={type:tokenType.separator,length:offset-startOffset};continue;case 34:case 39:token=readStringLiteralToken(text,offset-1,limit);break;case 40:token=tokens.leftParentheses;break;case 41:token=tokens.rightParentheses;break;case 43:case 45:if(limit>offset){var afterSign=text.charCodeAt(offset);if(46===afterSign){var signOffset=offset+1;if(limit>signOffset&&isDecimalDigit(text.charCodeAt(signOffset))){token=readDecimalLiteralToken(text,startOffset,signOffset,limit);break}}else if(isDecimalDigit(afterSign)){token=readDecimalLiteralToken(text,startOffset,offset,limit);break}}token={type:tokenType.error,length:offset-startOffset,value:text.substring(startOffset,offset)};break;case 44:token=tokens.comma;break;case 46:token=tokens.dot,limit>offset&&isDecimalDigit(text.charCodeAt(offset))&&(token=readDecimalLiteralToken(text,startOffset,offset,limit));break;case 48:var ch2=limit>offset?text.charCodeAt(offset):0;if(120===ch2||88===ch2){var hexOffset=readHexIntegerLiteral(text,offset+1,limit);token={type:tokenType.numberLiteral,length:hexOffset-startOffset,value:+text.substr(startOffset,hexOffset-startOffset)}}else token=readDecimalLiteralToken(text,startOffset,offset,limit);break;case code>=49&&57>=code&&code:token=readDecimalLiteralToken(text,startOffset,offset,limit);break;case 58:token=tokens.colon;break;case 59:token=tokens.semicolon;break;case 91:token=tokens.leftBracket;break;case 93:token=tokens.rightBracket;break;case 123:token=tokens.leftBrace;break;case 125:token=tokens.rightBrace;break;default:if(isIdentifierStartCharacter(code,text,offset,limit)){token=readIdentifierToken(text,offset-1,limit);break}token={type:tokenType.error,length:offset-startOffset,value:text.substring(startOffset,offset)}}offset+=token.length-1,result.push(token)}}return function(text){var result=[];return lex(result,text,0,text.length),result.push(tokens.eof),result}}();return lexer.tokenType=tokenType,lexer})})}),define("WinJS/ControlProcessor/_OptionsParser",["exports","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","./_OptionsLexer"],function(exports,_Base,_BaseUtils,_ErrorFromName,_Resources,_OptionsLexer){"use strict";function illegal(){throw"Illegal"}function tokenTypeName(type){for(var keys=Object.keys(imports.tokenType),i=0,len=keys.length;len>i;i++)if(type===imports.tokenType[keys[i]])return keys[i];return"<unknown>"}var strings={get invalidOptionsRecord(){return"Invalid options record: '{0}', expected to be in the format of an object literal. {1}"},get unexpectedTokenExpectedToken(){return"Unexpected token: {0}, expected token: {1}, at offset {2}"},get unexpectedTokenExpectedTokens(){return"Unexpected token: {0}, expected one of: {1}, at offset {2}"},get unexpectedTokenGeneric(){return"Unexpected token: {0}, at offset {1}"}},imports=_Base.Namespace.defineWithParent(null,null,{lexer:_Base.Namespace._lazy(function(){return _OptionsLexer._optionsLexer}),tokenType:_Base.Namespace._lazy(function(){return _OptionsLexer._optionsLexer.tokenType})}),requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,local=_Base.Namespace.defineWithParent(null,null,{BaseInterpreter:_Base.Namespace._lazy(function(){return _Base.Class.define(null,{_error:function(message){throw new _ErrorFromName("WinJS.UI.ParseError",message)},_currentOffset:function(){for(var p=this._pos,offset=0,i=0;p>i;i++)offset+=this._tokens[i].length;return offset},_evaluateAccessExpression:function(value){switch(this._current.type){case imports.tokenType.dot:switch(this._read(),this._current.type){case imports.tokenType.identifier:case this._current.keyword&&this._current.type:var id=this._current.value;return this._read(),value[id];default:this._unexpectedToken(imports.tokenType.identifier,imports.tokenType.reservedWord)}return;case imports.tokenType.leftBracket:this._read();var index=this._evaluateValue();return this._read(imports.tokenType.rightBracket),value[index]}},_evaluateAccessExpressions:function(value){for(;;)switch(this._current.type){case imports.tokenType.dot:case imports.tokenType.leftBracket:value=this._evaluateAccessExpression(value);break;default:return value}},_evaluateIdentifier:function(nested,value){var id=this._readIdentifier();return value=nested?value[id]:this._context[id]},_evaluateIdentifierExpression:function(){var value=this._evaluateIdentifier(!1);switch(this._current.type){case imports.tokenType.dot:case imports.tokenType.leftBracket:return this._evaluateAccessExpressions(value);default:return value}},_initialize:function(tokens,originalSource,context,functionContext){this._originalSource=originalSource,this._tokens=tokens,this._context=context,this._functionContext=functionContext,this._pos=0,this._current=this._tokens[0]},_read:function(expected){expected&&this._current.type!==expected&&this._unexpectedToken(expected),this._current!==imports.tokenType.eof&&(this._current=this._tokens[++this._pos])},_peek:function(expected){return expected&&this._current.type!==expected?void 0:this._current!==imports.tokenType.eof?this._tokens[this._pos+1]:void 0},_readAccessExpression:function(parts){switch(this._current.type){case imports.tokenType.dot:switch(this._read(),this._current.type){case imports.tokenType.identifier:case this._current.keyword&&this._current.type:parts.push(this._current.value),this._read();break;default:this._unexpectedToken(imports.tokenType.identifier,imports.tokenType.reservedWord)}return;case imports.tokenType.leftBracket:return this._read(),parts.push(this._evaluateValue()),void this._read(imports.tokenType.rightBracket)}},_readAccessExpressions:function(parts){for(;;)switch(this._current.type){case imports.tokenType.dot:case imports.tokenType.leftBracket:this._readAccessExpression(parts);break;default:return}},_readIdentifier:function(){var id=this._current.value;return this._read(imports.tokenType.identifier),id},_readIdentifierExpression:function(){var parts=[];switch(this._peek(imports.tokenType.thisKeyword)&&0===parts.length?this._read():parts.push(this._readIdentifier()),this._current.type){case imports.tokenType.dot:case imports.tokenType.leftBracket:this._readAccessExpressions(parts)}return parts},_unexpectedToken:function(expected){var unexpected=this._current.type===imports.tokenType.error?"'"+this._current.value+"'":tokenTypeName(this._current.type);if(expected)if(1===arguments.length)expected=tokenTypeName(expected),this._error(_Resources._formatString(strings.unexpectedTokenExpectedToken,unexpected,expected,this._currentOffset()));else{for(var names=[],i=0,len=arguments.length;len>i;i++)names.push(tokenTypeName(arguments[i]));expected=names.join(", "),this._error(_Resources._formatString(strings.unexpectedTokenExpectedTokens,unexpected,expected,this._currentOffset()))}else this._error(_Resources._formatString(strings.unexpectedTokenGeneric,unexpected,this._currentOffset()))}},{supportedForProcessing:!1})}),OptionsInterpreter:_Base.Namespace._lazy(function(){return _Base.Class.derive(local.BaseInterpreter,function(tokens,originalSource,context,functionContext){this._initialize(tokens,originalSource,context,functionContext)},{_error:function(message){throw new _ErrorFromName("WinJS.UI.ParseError",_Resources._formatString(strings.invalidOptionsRecord,this._originalSource,message))},_evaluateArrayLiteral:function(){var a=[];return this._read(imports.tokenType.leftBracket),this._readArrayElements(a),this._read(imports.tokenType.rightBracket),a},_evaluateObjectLiteral:function(){var o={};return this._read(imports.tokenType.leftBrace),this._readObjectProperties(o),this._tryReadComma(),this._read(imports.tokenType.rightBrace),o},_evaluateOptionsLiteral:function(){var value=this._evaluateValue();return this._current.type!==imports.tokenType.eof&&this._unexpectedToken(imports.tokenType.eof),value},_peekValue:function(){switch(this._current.type){case imports.tokenType.falseLiteral:case imports.tokenType.nullLiteral:case imports.tokenType.stringLiteral:case imports.tokenType.trueLiteral:case imports.tokenType.numberLiteral:case imports.tokenType.leftBrace:case imports.tokenType.leftBracket:case imports.tokenType.identifier:return!0;default:return!1}},_evaluateValue:function(){switch(this._current.type){case imports.tokenType.falseLiteral:case imports.tokenType.nullLiteral:case imports.tokenType.stringLiteral:case imports.tokenType.trueLiteral:case imports.tokenType.numberLiteral:var value=this._current.value;return this._read(),value;case imports.tokenType.leftBrace:return this._evaluateObjectLiteral();case imports.tokenType.leftBracket:return this._evaluateArrayLiteral();case imports.tokenType.identifier:return requireSupportedForProcessing(this._peek(imports.tokenType.identifier).type===imports.tokenType.leftParentheses?this._evaluateObjectQueryExpression():this._evaluateIdentifierExpression());default:this._unexpectedToken(imports.tokenType.falseLiteral,imports.tokenType.nullLiteral,imports.tokenType.stringLiteral,imports.tokenType.trueLiteral,imports.tokenType.numberLiteral,imports.tokenType.leftBrace,imports.tokenType.leftBracket,imports.tokenType.identifier)}},_tryReadElement:function(a){return this._peekValue()?(a.push(this._evaluateValue()),!0):!1},_tryReadComma:function(){return this._peek(imports.tokenType.comma)?(this._read(),!0):!1},_tryReadElision:function(a){for(var found=!1;this._tryReadComma();)a.push(void 0),found=!0;return found},_readArrayElements:function(a){for(;!this._peek(imports.tokenType.rightBracket);){var elision=this._tryReadElision(a),element=this._tryReadElement(a),comma=this._peek(imports.tokenType.comma);if(!element||!comma){if(element||elision)break;this._unexpectedToken(imports.tokenType.falseLiteral,imports.tokenType.nullLiteral,imports.tokenType.stringLiteral,imports.tokenType.trueLiteral,imports.tokenType.numberLiteral,imports.tokenType.leftBrace,imports.tokenType.leftBracket,imports.tokenType.identifier);break}this._read()}},_readObjectProperties:function(o){for(;!this._peek(imports.tokenType.rightBrace);){var property=this._tryReadObjectProperty(o),comma=this._peek(imports.tokenType.comma);if(!property||!comma){if(property)break;this._unexpectedToken(imports.tokenType.numberLiteral,imports.tokenType.stringLiteral,imports.tokenType.identifier);break}this._read()}},_tryReadObjectProperty:function(o){switch(this._current.type){case imports.tokenType.numberLiteral:case imports.tokenType.stringLiteral:case imports.tokenType.identifier:case this._current.keyword&&this._current.type:var propertyName=this._current.value;return this._read(),this._read(imports.tokenType.colon),o[propertyName]=this._evaluateValue(),!0;default:return!1}},_failReadObjectProperty:function(){this._unexpectedToken(imports.tokenType.numberLiteral,imports.tokenType.stringLiteral,imports.tokenType.identifier,imports.tokenType.reservedWord)},_evaluateObjectQueryExpression:function(){var functionName=this._current.value;this._read(imports.tokenType.identifier),this._read(imports.tokenType.leftParentheses);var queryExpression=this._current.value;this._read(imports.tokenType.stringLiteral),this._read(imports.tokenType.rightParentheses);var value=requireSupportedForProcessing(this._functionContext[functionName])(queryExpression);switch(this._current.type){case imports.tokenType.dot:case imports.tokenType.leftBracket:return this._evaluateAccessExpressions(value);default:return value}},run:function(){return this._evaluateOptionsLiteral()}},{supportedForProcessing:!1})}),OptionsParser:_Base.Namespace._lazy(function(){return _Base.Class.derive(local.OptionsInterpreter,function(tokens,originalSource){this._initialize(tokens,originalSource)},{_evaluateAccessExpression:illegal,_evaluateAccessExpressions:illegal,_evaluateIdentifier:illegal,_evaluateIdentifierExpression:illegal,_evaluateObjectQueryExpression:illegal,_evaluateValue:function(){switch(this._current.type){case imports.tokenType.falseLiteral:case imports.tokenType.nullLiteral:case imports.tokenType.stringLiteral:case imports.tokenType.trueLiteral:case imports.tokenType.numberLiteral:var value=this._current.value;return this._read(),value;case imports.tokenType.leftBrace:return this._evaluateObjectLiteral();case imports.tokenType.leftBracket:return this._evaluateArrayLiteral();case imports.tokenType.identifier:return this._peek(imports.tokenType.identifier).type===imports.tokenType.leftParentheses?this._readObjectQueryExpression():this._readIdentifierExpression();default:this._unexpectedToken(imports.tokenType.falseLiteral,imports.tokenType.nullLiteral,imports.tokenType.stringLiteral,imports.tokenType.trueLiteral,imports.tokenType.numberLiteral,imports.tokenType.leftBrace,imports.tokenType.leftBracket,imports.tokenType.identifier)}},_readIdentifierExpression:function(){var parts=local.BaseInterpreter.prototype._readIdentifierExpression.call(this);return new IdentifierExpression(parts)},_readObjectQueryExpression:function(){var functionName=this._current.value;this._read(imports.tokenType.identifier),this._read(imports.tokenType.leftParentheses);var queryExpressionLiteral=this._current.value;this._read(imports.tokenType.stringLiteral),this._read(imports.tokenType.rightParentheses);var call=new CallExpression(functionName,queryExpressionLiteral);switch(this._current.type){case imports.tokenType.dot:case imports.tokenType.leftBracket:var parts=[call];return this._readAccessExpressions(parts),new IdentifierExpression(parts);default:return call}}},{supportedForProcessing:!1})})}),parser=function(text,context,functionContext){var tokens=imports.lexer(text),interpreter=new local.OptionsInterpreter(tokens,text,context||{},functionContext||{});return interpreter.run()};Object.defineProperty(parser,"_BaseInterpreter",{get:function(){return local.BaseInterpreter}});var parser2=function(text){var tokens=imports.lexer(text),parser=new local.OptionsParser(tokens,text);return parser.run()},CallExpression=_Base.Class.define(function(target,arg0Value){this.target=target,this.arg0Value=arg0Value});CallExpression.supportedForProcessing=!1;var IdentifierExpression=_Base.Class.define(function(parts){this.parts=parts});IdentifierExpression.supportedForProcessing=!1,_Base.Namespace._moduleDefine(exports,"WinJS.UI",{optionsParser:parser,_optionsParser:parser2,_CallExpression:CallExpression,_IdentifierExpression:IdentifierExpression})}),define("WinJS/ControlProcessor",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_Log","./Core/_Resources","./Core/_WriteProfilerMark","./ControlProcessor/_OptionsParser","./Promise","./Utilities/_ElementUtilities"],function(exports,_Global,_Base,_BaseUtils,_Log,_Resources,_WriteProfilerMark,_OptionsParser,Promise,_ElementUtilities){"use strict";function createSelect(element){var result=function(selector){for(var selected,current=element;current;){if(current.msParentSelectorScope){var scope=current.parentNode;if(scope&&(selected=_ElementUtilities._matchesSelector(scope,selector)?scope:scope.querySelector(selector)))break}current=current.parentNode}return selected||_Global.document.querySelector(selector)};return markSupportedForProcessing(result)}function activate(element,Handler){return new Promise(function(complete,error){try{var options,optionsAttribute=element.getAttribute("data-win-options");optionsAttribute&&(options=_OptionsParser.optionsParser(optionsAttribute,_Global,{select:createSelect(element)}));var ctl,count=1;Handler.length>2&&count++;var checkComplete=function(){count--,0===count&&(element.winControl=element.winControl||ctl,complete(ctl))};ctl=new Handler(element,options,checkComplete),checkComplete()}catch(err){_Log.log&&_Log.log(_Resources._formatString(strings.errorActivatingControl,err&&err.message),"winjs controls","error"),error(err)}})}function processAllImpl(rootElement,skipRootElement){return new Promise(function(complete,error){_WriteProfilerMark("WinJS.UI:processAll,StartTM"),rootElement=rootElement||_Global.document.body;var pending=0,selector="[data-win-control]",allElements=rootElement.querySelectorAll(selector),elements=[];!skipRootElement&&getControlHandler(rootElement)&&elements.push(rootElement);for(var i=0,len=allElements.length;len>i;i++)elements.push(allElements[i]);if(0===elements.length)return _WriteProfilerMark("WinJS.UI:processAll,StopTM"),void complete(rootElement);for(var checkAllComplete=function(){pending-=1,0>pending&&(_WriteProfilerMark("WinJS.UI:processAll,StopTM"),complete(rootElement))},controls=new Array(elements.length),i=0,len=elements.length;len>i;i++){var control,element=elements[i],instance=element.winControl;instance?control=instance.constructor:controls[i]=control=getControlHandler(element),control&&control.isDeclarativeControlContainer&&(i+=element.querySelectorAll(selector).length)}_WriteProfilerMark("WinJS.UI:processAllActivateControls,StartTM");for(var i=0,len=elements.length;len>i;i++){var ctl=controls[i],element=elements[i];if(ctl&&!element.winControl&&(pending++,activate(element,ctl).then(checkAllComplete,function(e){_WriteProfilerMark("WinJS.UI:processAll,StopTM"),error(e)}),ctl.isDeclarativeControlContainer&&"function"==typeof ctl.isDeclarativeControlContainer)){var idcc=requireSupportedForProcessing(ctl.isDeclarativeControlContainer);idcc(element.winControl,processAll)}}_WriteProfilerMark("WinJS.UI:processAllActivateControls,StopTM"),checkAllComplete()})}function getControlHandler(element){if(element.getAttribute){var evaluator=element.getAttribute("data-win-control");if(evaluator)return _BaseUtils._getMemberFiltered(evaluator.trim(),_Global,requireSupportedForProcessing)}}function scopedSelect(selector,element){return createSelect(element)(selector)}function processAll(rootElement,skipRoot){return processedAllCalled?processAllImpl(rootElement,skipRoot):_BaseUtils.ready().then(function(){return processedAllCalled=!0,processAllImpl(rootElement,skipRoot)})}function process(element){if(element&&element.winControl)return Promise.as(element.winControl);var handler=getControlHandler(element);return handler?activate(element,handler):Promise.as()}if(_Global.document){var strings={get errorActivatingControl(){return"Error activating control: {0}"}},markSupportedForProcessing=_BaseUtils.markSupportedForProcessing,requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,processedAllCalled=!1;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{scopedSelect:scopedSelect,processAll:processAll,process:process})}}),define("WinJS/Utilities/_ElementListUtilities",["exports","../Core/_Global","../Core/_Base","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_ElementUtilities"],function(exports,_Global,_Base,ControlProcessor,Promise,_Control,_ElementUtilities){"use strict";_Global.document&&_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{QueryCollection:_Base.Class.derive(Array,function(items){items&&this.include(items)},{forEach:function(callbackFn,thisArg){return Array.prototype.forEach.apply(this,[callbackFn,thisArg]),this},get:function(index){return this[index]},setAttribute:function(name,value){return this.forEach(function(item){item.setAttribute(name,value)}),this},getAttribute:function(name){return this.length>0?this[0].getAttribute(name):void 0},addClass:function(name){return this.forEach(function(item){_ElementUtilities.addClass(item,name)}),this},hasClass:function(name){return this.length>0?_ElementUtilities.hasClass(this[0],name):!1},removeClass:function(name){return this.forEach(function(item){_ElementUtilities.removeClass(item,name)}),this},toggleClass:function(name){return this.forEach(function(item){_ElementUtilities.toggleClass(item,name)}),this},listen:function(eventType,listener,capture){return this.forEach(function(item){item.addEventListener(eventType,listener,capture)}),this},removeEventListener:function(eventType,listener,capture){return this.forEach(function(item){item.removeEventListener(eventType,listener,capture)}),this},setStyle:function(name,value){return this.forEach(function(item){item.style[name]=value}),this},clearStyle:function(name){return this.forEach(function(item){item.style[name]=""}),this},query:function(query){var newCollection=new exports.QueryCollection;return this.forEach(function(item){newCollection.include(item.querySelectorAll(query))}),newCollection},include:function(items){if("number"==typeof items.length)for(var i=0;i<items.length;i++)this.push(items[i]);else items.DOCUMENT_FRAGMENT_NODE&&items.nodeType===items.DOCUMENT_FRAGMENT_NODE?this.include(items.childNodes):this.push(items)},control:function(Ctor,options){return Ctor&&"function"==typeof Ctor?this.forEach(function(element){element.winControl=new Ctor(element,options)}):(options=Ctor,this.forEach(function(element){ControlProcessor.process(element).done(function(control){control&&_Control.setOptions(control,options)})})),this},template:function(templateElement,data,renderDonePromiseCallback){templateElement instanceof exports.QueryCollection&&(templateElement=templateElement[0]);var template=templateElement.winControl;null!==data&&void 0!==data&&data.forEach||(data=[data]),renderDonePromiseCallback=renderDonePromiseCallback||function(){};var that=this,donePromises=[];return data.forEach(function(datum){that.forEach(function(element){donePromises.push(template.render(datum,element))})}),renderDonePromiseCallback(Promise.join(donePromises)),this}},{supportedForProcessing:!1}),query:function(query,element){return new exports.QueryCollection((element||_Global.document).querySelectorAll(query))},id:function(id){var e=_Global.document.getElementById(id);return new exports.QueryCollection(e?[e]:[])},children:function(element){return new exports.QueryCollection(element.children)}})}),define("WinJS/Utilities/_Hoverable",["exports","../Core/_Global"],function(exports,_Global){"use strict";if(_Global.document&&(_Global.document.documentElement.classList.add("win-hoverable"),exports.isHoverable=!0,!_Global.MSPointerEvent)){var touchStartHandler=function(){_Global.document.removeEventListener("touchstart",touchStartHandler),_Global.document.documentElement.classList.remove("win-hoverable"),exports.isHoverable=!1};_Global.document.addEventListener("touchstart",touchStartHandler)}}),define("WinJS/Utilities/_ParallelWorkQueue",["exports","../Core/_Base","../Promise","../Scheduler"],function(exports,_Base,Promise,Scheduler){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ParallelWorkQueue:_Base.Namespace._lazy(function(){return _Base.Class.define(function(maxRunning){function runNext(){running--,processing||Scheduler.schedule(run,Scheduler.Priority.normal,null,"WinJS._ParallelWorkQueue.runNext")}function run(){for(processing++;maxRunning>running;running++){var next,nextWork;do next=workQueue.shift(),nextWork=next&&workItems[next];while(next&&!nextWork);if(!nextWork)break;delete workItems[next];try{nextWork().then(runNext,runNext)}catch(err){runNext()}}processing--}function queue(f,data,first){var workPromise,id="w"+workIndex++;return new Promise(function(c,e,p){var w=function(){return workPromise=f().then(c,e,p)};w.data=data,workItems[id]=w,first?workQueue.unshift(id):workQueue.push(id),run()},function(){delete workItems[id],workPromise&&workPromise.cancel()})}var workIndex=0,workItems={},workQueue=[];maxRunning=maxRunning||3;var running=0,processing=0;this.sort=function(f){workQueue.sort(function(a,b){return a=workItems[a],b=workItems[b],void 0===a&&void 0===b?0:void 0===a?1:void 0===b?-1:f(a.data,b.data)})},this.queue=queue},{},{supportedForProcessing:!1})})})}),define("WinJS/Utilities/_VersionManager",["exports","../Core/_Base","../_Signal"],function(exports,_Base,_Signal){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_VersionManager:_Base.Namespace._lazy(function(){return _Base.Class.define(function(){this._unlocked=new _Signal,this._unlocked.complete()},{_cancelCount:0,_notificationCount:0,_updateCount:0,_version:0,locked:{get:function(){return 0!==this._notificationCount||0!==this._updateCount}},noOutstandingNotifications:{get:function(){return 0===this._notificationCount}},version:{get:function(){return this._version}},unlocked:{get:function(){return this._unlocked.promise}},_dispose:function(){this._unlocked&&(this._unlocked.cancel(),this._unlocked=null)},beginUpdating:function(){this._checkLocked(),this._updateCount++},endUpdating:function(){this._updateCount--,this._checkUnlocked()},beginNotifications:function(){this._checkLocked(),this._notificationCount++},endNotifications:function(){this._notificationCount--,this._checkUnlocked()},_checkLocked:function(){this.locked||(this._dispose(),this._unlocked=new _Signal)},_checkUnlocked:function(){this.locked||this._unlocked.complete()},receivedNotification:function(){if(this._version++,this._cancel){var cancel=this._cancel;this._cancel=null,cancel.forEach(function(p){p&&p.cancel()})}},cancelOnNotification:function(promise){return this._cancel||(this._cancel=[],this._cancelCount=0),this._cancel[this._cancelCount++]=promise,this._cancelCount-1},clearCancelOnNotification:function(token){this._cancel&&delete this._cancel[token]}},{supportedForProcessing:!1})})})}),define("WinJS/Utilities/_ItemsManager",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../_Signal","../Scheduler","../Utilities/_ElementUtilities","./_ParallelWorkQueue","./_VersionManager"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,_WriteProfilerMark,Promise,_Signal,Scheduler,_ElementUtilities,_ParallelWorkQueue,_VersionManager){"use strict";function simpleItemRenderer(f){return markSupportedForProcessing(function(itemPromise,element){return itemPromise.then(function(item){return item?f(item,element):null})})}function compareImageLoadPriority(a,b){var aon=!1,bon=!1;return a.isOnScreen().then(function(v){aon=v}),b.isOnScreen().then(function(v){bon=v}),(aon?0:1)-(bon?0:1)}function seenUrl(srcUrl){if(!/^blob:/i.test(srcUrl)&&(seenUrls[srcUrl]=!0,seenUrlsMRU.push(srcUrl),seenUrlsMRU.length>SEEN_URLS_MRU_MAXSIZE)){var mru=seenUrlsMRU;seenUrls={},seenUrlsMRU=[];for(var count=0,i=mru.length-1;i>=0&&SEEN_URLS_MAXSIZE>count;i--){var url=mru[i];seenUrls[url]||(seenUrls[url]=!0,count++)}}}function loadImage(srcUrl,image,data){var imageId=nextImageLoaderId++;return imageLoader=imageLoader||new _ParallelWorkQueue._ParallelWorkQueue(6),imageLoader.queue(function(){return new Promise(function(c,e){Scheduler.schedule(function(jobInfo){image||(image=_Global.document.createElement("img"));var seen=seenUrls[srcUrl];seen?(seenUrl(srcUrl),image.src=srcUrl,c(image)):jobInfo.setPromise(new Promise(function(imageLoadComplete){var tempImage=_Global.document.createElement("img"),cleanup=function(){tempImage.removeEventListener("load",loadComplete,!1),tempImage.removeEventListener("error",loadError,!1),image.src=srcUrl;var currentDate=new Date;currentDate-lastSort>minDurationBetweenImageSort&&(lastSort=currentDate,imageLoader.sort(compareImageLoadPriority))},loadComplete=function(){imageLoadComplete(jobComplete)},loadError=function(){imageLoadComplete(jobError)},jobComplete=function(){seenUrl(srcUrl),cleanup(),c(image)},jobError=function(){cleanup(),e(image)};tempImage.addEventListener("load",loadComplete,!1),tempImage.addEventListener("error",loadError,!1),tempImage.src=srcUrl}))},Scheduler.Priority.normal,null,"WinJS.UI._ImageLoader._image"+imageId)})},data)}function isImageCached(srcUrl){return seenUrls[srcUrl]}function defaultRenderer(){return _Global.document.createElement("div")}var markSupportedForProcessing=_BaseUtils.markSupportedForProcessing,uniqueID=_ElementUtilities._uniqueID,trivialHtmlRenderer=simpleItemRenderer(function(item){if(_ElementUtilities._isDOMElement(item.data))return item.data;var data=item.data;void 0===data?data="undefined":null===data?data="null":"object"==typeof data&&(data=JSON.stringify(data));var element=_Global.document.createElement("span");return element.textContent=data.toString(),element});_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_normalizeRendererReturn:function(v){if(v){if("object"==typeof v&&v.element){var elementPromise=Promise.as(v.element);return elementPromise.then(function(e){return{element:e,renderComplete:Promise.as(v.renderComplete)}})}var elementPromise=Promise.as(v);return elementPromise.then(function(e){return{element:e,renderComplete:Promise.as()}})}return{element:null,renderComplete:Promise.as()}},simpleItemRenderer:simpleItemRenderer,_trivialHtmlRenderer:trivialHtmlRenderer});var imageLoader,strings={get listDataSourceIsInvalid(){return"Invalid argument: dataSource must be an object."},get itemRendererIsInvalid(){return"Invalid argument: itemRenderer must be a function."},get itemIsInvalid(){return"Invalid argument: item must be a DOM element that was returned by the Items Manager, and has not been replaced or released."}},lastSort=new Date,minDurationBetweenImageSort=64,nextImageLoaderId=0,seenUrls={},seenUrlsMRU=[],SEEN_URLS_MAXSIZE=250,SEEN_URLS_MRU_MAXSIZE=1e3;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_seenUrl:seenUrl,_getSeenUrls:function(){return seenUrls},_getSeenUrlsMRU:function(){return seenUrlsMRU},_seenUrlsMaxSize:SEEN_URLS_MAXSIZE,_seenUrlsMRUMaxSize:SEEN_URLS_MRU_MAXSIZE}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_createItemsManager:_Base.Namespace._lazy(function(){var ListNotificationHandler=_Base.Class.define(function(itemsManager){this._itemsManager=itemsManager},{beginNotifications:function(){this._itemsManager._versionManager.beginNotifications(),this._itemsManager._beginNotifications()},inserted:function(itemPromise,previousHandle,nextHandle){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._inserted(itemPromise,previousHandle,nextHandle)},changed:function(newItem,oldItem){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._changed(newItem,oldItem)},moved:function(itemPromise,previousHandle,nextHandle){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._moved(itemPromise,previousHandle,nextHandle)},removed:function(handle,mirage){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._removed(handle,mirage)},countChanged:function(newCount,oldCount){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._countChanged(newCount,oldCount)},indexChanged:function(handle,newIndex,oldIndex){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._indexChanged(handle,newIndex,oldIndex)},affectedRange:function(range){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._affectedRange(range)},endNotifications:function(){this._itemsManager._versionManager.endNotifications(),this._itemsManager._endNotifications()},reload:function(){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._reload()}},{supportedForProcessing:!1}),ItemsManager=_Base.Class.define(function(listDataSource,itemRenderer,elementNotificationHandler,options){if(!listDataSource)throw new _ErrorFromName("WinJS.UI.ItemsManager.ListDataSourceIsInvalid",strings.listDataSourceIsInvalid);if(!itemRenderer)throw new _ErrorFromName("WinJS.UI.ItemsManager.ItemRendererIsInvalid",strings.itemRendererIsInvalid);this.$pipeline_callbacksMap={},this._listDataSource=listDataSource,this.dataSource=this._listDataSource,this._elementNotificationHandler=elementNotificationHandler,this._listBinding=this._listDataSource.createListBinding(new ListNotificationHandler(this)),options&&(options.ownerElement&&(this._ownerElement=options.ownerElement),this._profilerId=options.profilerId,this._versionManager=options.versionManager||new _VersionManager._VersionManager),this._indexInView=options&&options.indexInView,this._itemRenderer=itemRenderer,this._viewCallsReady=options&&options.viewCallsReady,this._elementMap={},this._handleMap={},this._jobOwner=Scheduler.createOwnerToken(),this._notificationsSent=!1,this._listBinding.last&&(this.lastItem=function(){return this._elementForItem(this._listBinding.last())})},{_itemFromItemPromise:function(itemPromise){
return this._waitForElement(this._elementForItem(itemPromise))},_itemFromItemPromiseThrottled:function(itemPromise){return this._waitForElement(this._elementForItem(itemPromise,!0))},_itemAtIndex:function(index){var itemPromise=this._itemPromiseAtIndex(index);this._itemFromItemPromise(itemPromise).then(null,function(e){return itemPromise.cancel(),Promise.wrapError(e)})},_itemPromiseAtIndex:function(index){return this._listBinding.fromIndex(index)},_waitForElement:function(possiblePlaceholder){var that=this;return new Promise(function(c){if(possiblePlaceholder)if(that.isPlaceholder(possiblePlaceholder)){var placeholderID=uniqueID(possiblePlaceholder),callbacks=that.$pipeline_callbacksMap[placeholderID];callbacks?callbacks.push(c):that.$pipeline_callbacksMap[placeholderID]=[c]}else c(possiblePlaceholder);else c(possiblePlaceholder)})},_updateElement:function(newElement,oldElement){var placeholderID=uniqueID(oldElement),callbacks=this.$pipeline_callbacksMap[placeholderID];callbacks&&(delete this.$pipeline_callbacksMap[placeholderID],callbacks.forEach(function(c){c(newElement)}))},_firstItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.first()))},_lastItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.last()))},_previousItem:function(element){return this._listBinding.jumpToItem(this._itemFromElement(element)),this._waitForElement(this._elementForItem(this._listBinding.previous()))},_nextItem:function(element){return this._listBinding.jumpToItem(this._itemFromElement(element)),this._waitForElement(this._elementForItem(this._listBinding.next()))},_itemFromPromise:function(itemPromise){return this._waitForElement(this._elementForItem(itemPromise))},isPlaceholder:function(item){return!!this._recordFromElement(item).elementIsPlaceholder},itemObject:function(element){return this._itemFromElement(element)},release:function(){this._listBinding.release(),this._elementNotificationHandler=null,this._listBinding=null,this._jobOwner.cancelAll(),this._released=!0},releaseItemPromise:function(itemPromise){var handle=itemPromise.handle,record=this._handleMap[handle];record?this._releaseRecord(record):itemPromise.cancel()},releaseItem:function(element){var record=this._elementMap[uniqueID(element)];this._releaseRecord(record)},_releaseRecord:function(record){record&&(record.renderPromise&&record.renderPromise.cancel(),record.itemPromise&&record.itemPromise.cancel(),record.imagePromises&&record.imagePromises.forEach(function(promise){promise.cancel()}),record.itemReadyPromise&&record.itemReadyPromise.cancel(),record.renderComplete&&record.renderComplete.cancel(),this._removeEntryFromElementMap(record.element),this._removeEntryFromHandleMap(record.itemPromise.handle,record),record.item&&this._listBinding.releaseItem(record.item))},refresh:function(){return this._listDataSource.invalidateAll()},_handlerToNotifyCaresAboutItemAvailable:function(){return!(!this._elementNotificationHandler||!this._elementNotificationHandler.itemAvailable)},_handlerToNotify:function(){return this._notificationsSent||(this._notificationsSent=!0,this._elementNotificationHandler&&this._elementNotificationHandler.beginNotifications&&this._elementNotificationHandler.beginNotifications()),this._elementNotificationHandler},_defineIndexProperty:function(itemForRenderer,item,record){record.indexObserved=!1,Object.defineProperty(itemForRenderer,"index",{get:function(){return record.indexObserved=!0,item.index}})},_renderPlaceholder:function(record){var itemForRenderer={},elementPlaceholder=defaultRenderer(itemForRenderer);return record.elementIsPlaceholder=!0,elementPlaceholder},_renderItem:function(itemPromise,record,callerThrottlesStage1){function queueAsyncStage1(){itemPromise.then(function(item){that._writeProfilerMark(perfItemPromiseId+",StartTM"),stage1Signal.complete(item),that._writeProfilerMark(perfItemPromiseId+",StopTM")})}var that=this,indexInView=that._indexInView||function(){return!0},stage1Signal=new _Signal,readySignal=new _Signal,perfItemPromiseId="_renderItem("+record.item.index+"):itemPromise",stage0RunningSync=!0,stage0Ran=!1;itemPromise.then(function(item){stage0Ran=!0,stage0RunningSync&&stage1Signal.complete(item)}),stage0RunningSync=!1;var itemForRendererPromise=stage1Signal.promise.then(function(item){if(item){var itemForRenderer=Object.create(item);return that._defineIndexProperty(itemForRenderer,item,record),itemForRenderer.ready=readySignal.promise,itemForRenderer.isOnScreen=function(){return Promise.wrap(indexInView(item.index))},itemForRenderer.loadImage=function(srcUrl,image){var loadImagePromise=loadImage(srcUrl,image,itemForRenderer);return record.imagePromises?record.imagePromises.push(loadImagePromise):record.imagePromises=[loadImagePromise],loadImagePromise},itemForRenderer.isImageCached=isImageCached,itemForRenderer}return Promise.cancel});stage0Ran||(callerThrottlesStage1?(record.stage0=itemPromise,record.startStage1=function(){record.startStage1=null,queueAsyncStage1()}):queueAsyncStage1()),itemForRendererPromise.handle=itemPromise.handle,record.itemPromise=itemForRendererPromise,record.itemReadyPromise=readySignal.promise,record.readyComplete=!1;var perfRendererWorkId="_renderItem("+record.item.index+(stage0Ran?"):syncItemPromise":"):placeholder"),perfItemReadyId="_renderItem("+record.item.index+"):itemReady";this._writeProfilerMark(perfRendererWorkId+",StartTM");var rendererPromise=Promise.as(that._itemRenderer(itemForRendererPromise,record.element)).then(exports._normalizeRendererReturn).then(function(v){return that._released?Promise.cancel:(itemForRendererPromise.then(function(item){if(record.pendingReady=function(){record.pendingReady&&(record.pendingReady=null,record.readyComplete=!0,that._writeProfilerMark(perfItemReadyId+",StartTM"),readySignal.complete(item),that._writeProfilerMark(perfItemReadyId+",StopTM"))},!that._viewCallsReady){var job=Scheduler.schedule(record.pendingReady,Scheduler.Priority.normal,record,"WinJS.UI._ItemsManager._pendingReady");job.owner=that._jobOwner}}),v)});return this._writeProfilerMark(perfRendererWorkId+",StopTM"),rendererPromise},_replaceElement:function(record,elementNew){this._removeEntryFromElementMap(record.element),record.element=elementNew,this._addEntryToElementMap(elementNew,record)},_changeElement:function(record,elementNew,elementNewIsPlaceholder){record.renderPromise=null;var elementOld=record.element,itemOld=record.item;record.newItem&&(record.item=record.newItem,record.newItem=null),this._replaceElement(record,elementNew),record.item&&record.elementIsPlaceholder&&!elementNewIsPlaceholder?(record.elementDelayed=null,record.elementIsPlaceholder=!1,this._updateElement(record.element,elementOld),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(record.element,elementOld)):this._handlerToNotify().changed(elementNew,elementOld,itemOld)},_elementForItem:function(itemPromise,callerThrottlesStage1){var element,handle=itemPromise.handle,record=this._recordFromHandle(handle,!0);if(!handle)return null;if(record)element=record.element;else{record={item:itemPromise,itemPromise:itemPromise},this._addEntryToHandleMap(handle,record);var that=this,mirage=!1,synchronous=!1,renderPromise=that._renderItem(itemPromise,record,callerThrottlesStage1).then(function(v){var elementNew=v.element;record.renderComplete=v.renderComplete,itemPromise.then(function(item){record.item=item,item||(mirage=!0,element=null)}),synchronous=!0,record.renderPromise=null,elementNew&&(element?that._presentElements(record,elementNew):element=elementNew)});mirage||(synchronous||(record.renderPromise=renderPromise),element||(element=this._renderPlaceholder(record)),record.element=element,this._addEntryToElementMap(element,record),itemPromise.retain())}return element},_addEntryToElementMap:function(element,record){this._elementMap[uniqueID(element)]=record},_removeEntryFromElementMap:function(element){delete this._elementMap[uniqueID(element)]},_recordFromElement:function(element){var record=this._elementMap[uniqueID(element)];if(!record)throw this._writeProfilerMark("_recordFromElement:ItemIsInvalidError,info"),new _ErrorFromName("WinJS.UI.ItemsManager.ItemIsInvalid",strings.itemIsInvalid);return record},_addEntryToHandleMap:function(handle,record){this._handleMap[handle]=record},_removeEntryFromHandleMap:function(handle){delete this._handleMap[handle]},_handleInHandleMap:function(handle){return!!this._handleMap[handle]},_recordFromHandle:function(handle,ignoreFailure){var record=this._handleMap[handle];if(!record&&!ignoreFailure)throw new _ErrorFromName("WinJS.UI.ItemsManager.ItemIsInvalid",strings.itemIsInvalid);return record},_foreachRecord:function(callback){var records=this._handleMap;for(var property in records){var record=records[property];callback(record)}},_itemFromElement:function(element){return this._recordFromElement(element).item},_elementFromHandle:function(handle){if(handle){var record=this._recordFromHandle(handle,!0);if(record&&record.element)return record.element}return null},_inserted:function(itemPromise,previousHandle,nextHandle){this._handlerToNotify().inserted(itemPromise,previousHandle,nextHandle)},_changed:function(newItem,oldItem){if(this._handleInHandleMap(oldItem.handle)){var record=this._recordFromHandle(oldItem.handle);record.renderPromise&&record.renderPromise.cancel(),record.itemPromise&&record.itemPromise.cancel(),record.imagePromises&&record.imagePromises.forEach(function(promise){promise.cancel()}),record.itemReadyPromise&&record.itemReadyPromise.cancel(),record.renderComplete&&record.renderComplete.cancel(),record.newItem=newItem;var that=this,newItemPromise=Promise.as(newItem);newItemPromise.handle=record.itemPromise.handle,record.renderPromise=this._renderItem(newItemPromise,record).then(function(v){record.renderComplete=v.renderComplete,that._changeElement(record,v.element,!1),that._presentElements(record)})}},_moved:function(itemPromise,previousHandle,nextHandle){var element=this._elementFromHandle(itemPromise.handle),previous=this._elementFromHandle(previousHandle),next=this._elementFromHandle(nextHandle);this._handlerToNotify().moved(element,previous,next,itemPromise),this._presentAllElements()},_removed:function(handle,mirage){if(this._handleInHandleMap(handle)){var element=this._elementFromHandle(handle);this._handlerToNotify().removed(element,mirage,handle),this.releaseItem(element),this._presentAllElements()}else this._handlerToNotify().removed(null,mirage,handle)},_countChanged:function(newCount,oldCount){this._elementNotificationHandler&&this._elementNotificationHandler.countChanged&&this._handlerToNotify().countChanged(newCount,oldCount)},_indexChanged:function(handle,newIndex,oldIndex){var element;if(this._handleInHandleMap(handle)){var record=this._recordFromHandle(handle);if(record.indexObserved)if(record.elementIsPlaceholder)this._changeElement(record,this._renderPlaceholder(record),!0);else if(record.item.index!==newIndex){record.renderPromise&&record.renderPromise.cancel(),record.renderComplete&&record.renderComplete.cancel();var itemToRender=record.newItem||record.item;itemToRender.index=newIndex;var newItemPromise=Promise.as(itemToRender);newItemPromise.handle=record.itemPromise.handle;var that=this;record.renderPromise=this._renderItem(newItemPromise,record).then(function(v){record.renderComplete=v.renderComplete,that._changeElement(record,v.element,!1),that._presentElements(record)})}element=record.element}this._elementNotificationHandler&&this._elementNotificationHandler.indexChanged&&this._handlerToNotify().indexChanged(element,newIndex,oldIndex)},_affectedRange:function(range){this._elementNotificationHandler&&this._elementNotificationHandler.updateAffectedRange&&this._handlerToNotify().updateAffectedRange(range)},_beginNotifications:function(){this._externalBegin=!0,this._handlerToNotify()},_endNotifications:function(){this._notificationsSent&&(this._notificationsSent=!1,this._externalBegin=!1,this._elementNotificationHandler&&this._elementNotificationHandler.endNotifications&&this._elementNotificationHandler.endNotifications())},_reload:function(){this._elementNotificationHandler&&this._elementNotificationHandler.reload&&this._elementNotificationHandler.reload()},_postEndNotifications:function(){if(this._notificationsSent&&!this._externalBegin&&!this._endNotificationsPosted){this._endNotificationsPosted=!0;var that=this;Scheduler.schedule(function(){that._endNotificationsPosted=!1,that._endNotifications()},Scheduler.Priority.high,null,"WinJS.UI._ItemsManager._postEndNotifications")}},_presentElement:function(record){var elementOld=record.element;this._replaceElement(record,record.elementDelayed),record.elementDelayed=null,record.elementIsPlaceholder=!1,this._updateElement(record.element,elementOld),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(record.element,elementOld)},_presentElements:function(record,elementDelayed){elementDelayed&&(record.elementDelayed=elementDelayed),this._listBinding.jumpToItem(record.item),record.elementDelayed&&this._presentElement(record),this._postEndNotifications()},_presentAllElements:function(){var that=this;this._foreachRecord(function(record){record.elementDelayed&&that._presentElement(record)})},_writeProfilerMark:function(text){var message="WinJS.UI._ItemsManager:"+(this._profilerId?this._profilerId+":":":")+text;_WriteProfilerMark(message)}},{supportedForProcessing:!1});return function(dataSource,itemRenderer,elementNotificationHandler,options){return new ItemsManager(dataSource,itemRenderer,elementNotificationHandler,options)}})})}),define("WinJS/Utilities/_TabContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","./_ElementUtilities"],function(exports,_Global,_Base,_BaseUtils,_ElementUtilities){"use strict";function fireEvent(element,name,forward,cancelable){var event=_Global.document.createEvent("UIEvent");return event.initUIEvent(name,!1,!!cancelable,_Global,forward?1:0),!element.dispatchEvent(event)}function tabbableElementsNodeFilter(node){var nodeStyle=_ElementUtilities._getComputedStyle(node);if("none"===nodeStyle.display||"hidden"===nodeStyle.visibility)return _Global.NodeFilter.FILTER_REJECT;if(node._tabContainer)return _Global.NodeFilter.FILTER_ACCEPT;if(node.parentNode&&node.parentNode._tabContainer){var managedTarget=node.parentNode._tabContainer.childFocus;return managedTarget&&node.contains(managedTarget)?getTabIndex(node)>=0?_Global.NodeFilter.FILTER_ACCEPT:_Global.NodeFilter.FILTER_SKIP:_Global.NodeFilter.FILTER_REJECT}var tabIndex=getTabIndex(node);return tabIndex>=0?_Global.NodeFilter.FILTER_ACCEPT:_Global.NodeFilter.FILTER_SKIP}function scrapeTabManagedSubtree(walker){function scrapeSubtree(){if(walker.currentNode._tabContainer)elementsFound=elementsFound.concat(scrapeTabManagedSubtree(walker));else if(getTabIndex(walker.currentNode)>=0&&elementsFound.push(walker.currentNode),walker.firstChild()){do scrapeSubtree();while(walker.nextSibling());walker.parentNode()}}var tabManagedElement=walker.currentNode,childFocus=tabManagedElement._tabContainer.childFocus,elementsFound=[];return childFocus?(walker.currentNode=childFocus,scrapeSubtree(),walker.currentNode=tabManagedElement,elementsFound):[]}function TabHelperObject(element,tabIndex){function createCatcher(){var fragment=_Global.document.createElement("DIV");return fragment.tabIndex=tabIndex?tabIndex:0,fragment.setAttribute("aria-hidden",!0),fragment}var parent=element.parentNode,catcherBegin=createCatcher();parent.insertBefore(catcherBegin,element);var catcherEnd=createCatcher();parent.insertBefore(catcherEnd,element.nextSibling),catcherBegin.addEventListener("focus",function(){fireEvent(element,"onTabEnter",!0)},!0),catcherEnd.addEventListener("focus",function(){fireEvent(element,"onTabEnter",!1)},!0),this._catcherBegin=catcherBegin,this._catcherEnd=catcherEnd;var refCount=1;this.addRef=function(){refCount++},this.release=function(){return 0===--refCount&&(catcherBegin.parentElement&&parent.removeChild(catcherBegin),catcherEnd.parentElement&&parent.removeChild(catcherEnd)),refCount},this.updateTabIndex=function(tabIndex){catcherBegin.tabIndex=tabIndex,catcherEnd.tabIndex=tabIndex}}if(_Global.document){var getTabIndex=_ElementUtilities.getTabIndex,TrackTabBehavior={attach:function(element,tabIndex){return element["win-trackTabHelperObject"]?element["win-trackTabHelperObject"].addRef():element["win-trackTabHelperObject"]=new TabHelperObject(element,tabIndex),element["win-trackTabHelperObject"]},detach:function(element){element["win-trackTabHelperObject"].release()||delete element["win-trackTabHelperObject"]}};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{TrackTabBehavior:TrackTabBehavior,TabContainer:_Base.Class.define(function(element){this._element=element,this._tabIndex=0,element._tabContainer=this,null===element.getAttribute("tabindex")&&(element.tabIndex=-1);var that=this;element.addEventListener("onTabEnter",function(e){var skipDefaultBehavior=fireEvent(that._element,"onTabEntered",e.detail,!0);skipDefaultBehavior||(that.childFocus?that.childFocus.focus():element.focus())}),element.addEventListener("keydown",function(e){var targetElement=e.target;if(e.keyCode===_ElementUtilities.Key.tab){var forwardTab=!e.shiftKey,canKeepTabbing=that._hasMoreElementsInTabOrder(targetElement,forwardTab);if(!canKeepTabbing){var skipTabExitHandling=fireEvent(that._element,"onTabExiting",forwardTab,!0);if(skipTabExitHandling)return e.stopPropagation(),void e.preventDefault();for(var allTabbableElements=that._element.querySelectorAll("a[href],area[href],button,command,input,link,menuitem,object,select,textarea,th[sorted],[tabindex]"),len=allTabbableElements.length,originalTabIndices=[],i=0;len>i;i++){var element=allTabbableElements[i];originalTabIndices.push(element.tabIndex),element.tabIndex=-1}that._elementTabHelper[forwardTab?"_catcherEnd":"_catcherBegin"].tabIndex=-1;var restoreTabIndicesOnBlur=function(){targetElement.removeEventListener("blur",restoreTabIndicesOnBlur,!1);for(var i=0;len>i;i++)-1!==originalTabIndices[i]&&(allTabbableElements[i].tabIndex=originalTabIndices[i]);that._elementTabHelper._catcherBegin.tabIndex=that._tabIndex,that._elementTabHelper._catcherEnd.tabIndex=that._tabIndex};targetElement.addEventListener("blur",restoreTabIndicesOnBlur,!1),_BaseUtils._yieldForEvents(function(){fireEvent(that._element,"onTabExit",forwardTab)})}}}),this._elementTabHelper=TrackTabBehavior.attach(element,this._tabIndex),this._elementTabHelper._catcherBegin.tabIndex=0,this._elementTabHelper._catcherEnd.tabIndex=0},{dispose:function(){TrackTabBehavior.detach(this._element,this._tabIndex)},childFocus:{set:function(e){e!==this._focusElement&&(e&&e.parentNode?this._focusElement=e:this._focusElement=null)},get:function(){return this._focusElement}},tabIndex:{set:function(tabIndex){this._tabIndex=tabIndex,this._elementTabHelper.updateTabIndex(tabIndex)},get:function(){return this._tabIndex}},_element:null,_skipper:function(e){e.stopPropagation(),e.preventDefault()},_hasMoreElementsInTabOrder:function(currentFocus,movingForwards){if(!this.childFocus)return!1;for(var walker=_Global.document.createTreeWalker(this._element,_Global.NodeFilter.SHOW_ELEMENT,tabbableElementsNodeFilter,!1),tabStops=scrapeTabManagedSubtree(walker),i=0;i<tabStops.length;i++)if(tabStops[i]===currentFocus)return movingForwards?i<tabStops.length-1:i>0;return!1},_focusElement:null},{supportedForProcessing:!1})})}}),define("WinJS/Utilities/_KeyboardBehavior",["exports","../Core/_Global","../Core/_Base","./_Control","./_ElementUtilities","./_TabContainer"],function(exports,_Global,_Base,_Control,_ElementUtilities,_TabContainer){"use strict";if(_Global.document){var InputTypes={touch:"touch",pen:"pen",mouse:"mouse",keyboard:"keyboard"},_lastInputType=InputTypes.mouse,pointerTypeToInputType={2:InputTypes.touch,3:InputTypes.pen,4:InputTypes.mouse,touch:InputTypes.touch,pen:InputTypes.pen,mouse:InputTypes.mouse};_ElementUtilities._addEventListener(_Global,"pointerdown",function(eventObject){_lastInputType=pointerTypeToInputType[eventObject.pointerType]||InputTypes.mouse},!0),_Global.addEventListener("keydown",function(){_lastInputType=InputTypes.keyboard},!0),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_keyboardSeenLast:{get:function(){return _lastInputType===InputTypes.keyboard},set:function(value){_lastInputType=value?InputTypes.keyboard:InputTypes.mouse}},_lastInputType:{get:function(){return _lastInputType},set:function(value){InputTypes[value]&&(_lastInputType=value)}},_InputTypes:InputTypes,_WinKeyboard:function(element){_ElementUtilities._addEventListener(element,"pointerdown",function(ev){_ElementUtilities.removeClass(ev.target,"win-keyboard")},!0),element.addEventListener("keydown",function(ev){_ElementUtilities.addClass(ev.target,"win-keyboard")},!0),_ElementUtilities._addEventListener(element,"focusin",function(ev){exports._keyboardSeenLast&&_ElementUtilities.addClass(ev.target,"win-keyboard")},!1),_ElementUtilities._addEventListener(element,"focusout",function(ev){_ElementUtilities.removeClass(ev.target,"win-keyboard")},!1)},_KeyboardBehavior:_Base.Namespace._lazy(function(){var Key=_ElementUtilities.Key,_KeyboardBehavior=_Base.Class.define(function(element,options){element=element||_Global.document.createElement("DIV"),options=options||{},element._keyboardBehavior=this,this._element=element,this._fixedDirection=_KeyboardBehavior.FixedDirection.width,this._fixedSize=1,this._currentIndex=0,_Control.setOptions(this,options),this._tabContainer=new _TabContainer.TabContainer(this.scroller||this._element),this._tabContainer.tabIndex=0,this._element.children.length>0&&(this._tabContainer.childFocus=this._getFocusInto(this._element.children[0])),this._element.addEventListener("keydown",this._keyDownHandler.bind(this)),_ElementUtilities._addEventListener(this._element,"pointerdown",this._MSPointerDownHandler.bind(this))},{element:{get:function(){return this._element}},fixedDirection:{get:function(){return this._fixedDirection},set:function(value){this._fixedDirection=value}},fixedSize:{get:function(){return this._fixedSize},set:function(value){+value===value&&(value=Math.max(1,value),this._fixedSize=value)}},currentIndex:{get:function(){return this._element.children.length>0?this._currentIndex:-1},set:function(value){if(+value===value){var length=this._element.children.length;value=Math.max(0,Math.min(length-1,value)),this._currentIndex=value,this._tabContainer.childFocus=this._getFocusInto(this._element.children[value])}}},getAdjacent:{get:function(){return this._getAdjacent},set:function(value){this._getAdjacent=value}},scroller:{get:function(){return this._scroller},set:function(value){this._scroller=value}},_keyDownHandler:function(ev){if(!ev.altKey){if(_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *"))return;var newIndex=this.currentIndex,maxIndex=this._element.children.length-1,rtl="rtl"===_ElementUtilities._getComputedStyle(this._element).direction,leftStr=rtl?Key.rightArrow:Key.leftArrow,rightStr=rtl?Key.leftArrow:Key.rightArrow,targetIndex=this.getAdjacent&&this.getAdjacent(newIndex,ev.keyCode);if(+targetIndex===targetIndex)newIndex=targetIndex;else{var modFixedSize=newIndex%this.fixedSize;ev.keyCode===leftStr?this.fixedDirection===_KeyboardBehavior.FixedDirection.width?0!==modFixedSize&&newIndex--:newIndex>=this.fixedSize&&(newIndex-=this.fixedSize):ev.keyCode===rightStr?this.fixedDirection===_KeyboardBehavior.FixedDirection.width?modFixedSize!==this.fixedSize-1&&newIndex++:newIndex+this.fixedSize-modFixedSize<=maxIndex&&(newIndex+=this.fixedSize):ev.keyCode===Key.upArrow?this.fixedDirection===_KeyboardBehavior.FixedDirection.height?0!==modFixedSize&&newIndex--:newIndex>=this.fixedSize&&(newIndex-=this.fixedSize):ev.keyCode===Key.downArrow?this.fixedDirection===_KeyboardBehavior.FixedDirection.height?modFixedSize!==this.fixedSize-1&&newIndex++:newIndex+this.fixedSize-modFixedSize<=maxIndex&&(newIndex+=this.fixedSize):ev.keyCode===Key.home?newIndex=0:ev.keyCode===Key.end&&(newIndex=this._element.children.length-1)}newIndex=Math.max(0,Math.min(this._element.children.length-1,newIndex)),newIndex!==this.currentIndex&&(this._focus(newIndex,ev.keyCode),(ev.keyCode===leftStr||ev.keyCode===rightStr||ev.keyCode===Key.upArrow||ev.keyCode===Key.downArrow)&&ev.stopPropagation(),ev.preventDefault())}},_getFocusInto:function(elementToFocus,keyCode){return elementToFocus&&elementToFocus.winControl&&elementToFocus.winControl._getFocusInto?elementToFocus.winControl._getFocusInto(keyCode):elementToFocus},_focus:function(index,keyCode){index=+index===index?index:this.currentIndex;var elementToFocus=this._element.children[index];elementToFocus&&(elementToFocus=this._getFocusInto(elementToFocus,keyCode),this.currentIndex=index,_ElementUtilities._setActive(elementToFocus,this.scroller))},_MSPointerDownHandler:function(ev){var srcElement=ev.target;if(srcElement!==this.element){for(;srcElement.parentNode!==this.element;)srcElement=srcElement.parentNode;for(var index=-1;srcElement;)index++,srcElement=srcElement.previousElementSibling;this.currentIndex=index}}},{FixedDirection:{height:"height",width:"width"}});return _KeyboardBehavior})})}}),define("WinJS/Utilities/_SafeHtml",["exports","../Core/_WinJS","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources"],function(exports,_WinJS,_Global,_Base,_ErrorFromName,_Resources){"use strict";var setInnerHTML,setInnerHTMLUnsafe,setOuterHTML,setOuterHTMLUnsafe,insertAdjacentHTML,insertAdjacentHTMLUnsafe,strings={get nonStaticHTML(){return"Unable to add dynamic content. A script attempted to inject dynamic content, or elements previously modified dynamically, that might be unsafe. For example, using the innerHTML property or the document.write method to add a script element will generate this exception. If the content is safe and from a trusted source, use a method to explicitly manipulate elements and attributes, such as createElement, or use setInnerHTMLUnsafe (or other unsafe method)."}};setInnerHTML=setInnerHTMLUnsafe=function(element,text){element.innerHTML=text},setOuterHTML=setOuterHTMLUnsafe=function(element,text){element.outerHTML=text},insertAdjacentHTML=insertAdjacentHTMLUnsafe=function(element,position,text){element.insertAdjacentHTML(position,text)};var msApp=_Global.MSApp;if(msApp&&msApp.execUnsafeLocalFunction)setInnerHTMLUnsafe=function(element,text){msApp.execUnsafeLocalFunction(function(){try{_WinJS._execUnsafe=!0,element.innerHTML=text}finally{_WinJS._execUnsafe=!1}})},setOuterHTMLUnsafe=function(element,text){msApp.execUnsafeLocalFunction(function(){try{_WinJS._execUnsafe=!0,element.outerHTML=text}finally{_WinJS._execUnsafe=!1}})},insertAdjacentHTMLUnsafe=function(element,position,text){msApp.execUnsafeLocalFunction(function(){try{_WinJS._execUnsafe=!0,element.insertAdjacentHTML(position,text)}finally{_WinJS._execUnsafe=!1}})};else if(_Global.msIsStaticHTML){var check=function(str){if(!_Global.msIsStaticHTML(str))throw new _ErrorFromName("WinJS.Utitilies.NonStaticHTML",strings.nonStaticHTML)};setInnerHTML=function(element,text){check(text),element.innerHTML=text},setOuterHTML=function(element,text){check(text),element.outerHTML=text},insertAdjacentHTML=function(element,position,text){check(text),element.insertAdjacentHTML(position,text)}}_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{setInnerHTML:setInnerHTML,setInnerHTMLUnsafe:setInnerHTMLUnsafe,setOuterHTML:setOuterHTML,setOuterHTMLUnsafe:setOuterHTMLUnsafe,insertAdjacentHTML:insertAdjacentHTML,insertAdjacentHTMLUnsafe:insertAdjacentHTMLUnsafe})}),define("WinJS/Utilities/_Select",["exports","../Core/_Base","./_SafeHtml"],function(exports,_Base,_SafeHtml){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_Select:_Base.Namespace._lazy(function(){function encodeHtml(str){return str.replace(encodeHtmlRegEx,function(m){return encodeHtmlEscapeMap[m]||""})}function stripDirectionMarker(str){return str.replace(stringDirectionRegEx,"")}function stockGetValue(index){return this[index]}function stockGetLength(){return this.length}function fixDataSource(dataSource){return dataSource.getValue||(dataSource.getValue=stockGetValue),dataSource.getLength||(dataSource.getLength=stockGetLength),dataSource}var encodeHtmlRegEx=/[&<>'"]/g,encodeHtmlEscapeMap={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},stringDirectionRegEx=/[\u200e\u200f]/g;return _Base.Class.define(function(element,options){this._dataSource=fixDataSource(options.dataSource),this._index=options.index||0,this._domElement=element,this._domElement.tabIndex=0,options.disabled&&this.setDisabled(options.disabled);var that=this;this._domElement.addEventListener("change",function(){that._index=that._domElement.selectedIndex},!1),this._createSelectElement()},{_index:0,_dataSource:null,dataSource:{get:function(){return this._dataSource},set:function(value){this._dataSource=fixDataSource(value),this._domElement&&this._createSelectElement()}},setDisabled:function(disabled){disabled?this._domElement.setAttribute("disabled","disabled"):this._domElement.removeAttribute("disabled")},_createSelectElement:function(){for(var dataSourceLength=this._dataSource.getLength(),text="",i=0;dataSourceLength>i;i++){var value=""+this._dataSource.getValue(i),escaped=encodeHtml(value),stripped=stripDirectionMarker(escaped);text+="<option value='"+stripped+"'>"+escaped+"</option>"}_SafeHtml.setInnerHTMLUnsafe(this._domElement,text),this._domElement.selectedIndex=this._index},index:{get:function(){return Math.max(0,Math.min(this._index,this._dataSource.getLength()-1))},set:function(value){if(this._index!==value){this._index=value;var d=this._domElement;d&&d.selectedIndex!==value&&(d.selectedIndex=value)}}},value:{get:function(){return this._dataSource.getValue(this.index)}}})})})}),define("WinJS/Utilities/_Telemetry",["exports"],function(exports){"use strict";exports.send=function(name,params){}}),define("WinJS/Utilities/_UI",["exports","../Core/_BaseCoreUtils","../Core/_Base"],function(exports,_BaseCoreUtils,_Base){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{eventHandler:function(handler){return _BaseCoreUtils.markSupportedForProcessing(handler)},Orientation:{horizontal:"horizontal",vertical:"vertical"},CountResult:{unknown:"unknown"},CountError:{noResponse:"noResponse"},DataSourceStatus:{ready:"ready",waiting:"waiting",failure:"failure"},FetchError:{noResponse:"noResponse",doesNotExist:"doesNotExist"},EditError:{noResponse:"noResponse",canceled:"canceled",notPermitted:"notPermitted",noLongerMeaningful:"noLongerMeaningful"},ObjectType:{item:"item",groupHeader:"groupHeader",header:"header",footer:"footer"},SelectionMode:{none:"none",single:"single",multi:"multi"},TapBehavior:{directSelect:"directSelect",toggleSelect:"toggleSelect",invokeOnly:"invokeOnly",none:"none"},SwipeBehavior:{select:"select",none:"none"},GroupHeaderTapBehavior:{invoke:"invoke",none:"none"}})}),define("WinJS/Utilities/_Xhr",["../Core/_Global","../Core/_Base","../Promise","../Scheduler"],function(_Global,_Base,Promise,Scheduler){"use strict";function schedule(f,arg,priority){Scheduler.schedule(function(){f(arg)},priority,null,"WinJS.xhr")}function noop(){}function xhr(options){var req;return new Promise(function(c,e,p){var priority=Scheduler.currentPriority;req=new _Global.XMLHttpRequest;var isLocalRequest=!1,schemeMatch=schemeRegex.exec(options.url.toLowerCase());schemeMatch?"file"===schemeMatch[1]&&(isLocalRequest=!0):"file:"===_Global.location.protocol&&(isLocalRequest=!0),req.onreadystatechange=function(){return req._canceled?void(req.onreadystatechange=noop):void(4===req.readyState?(req.status>=200&&req.status<300||isLocalRequest&&0===req.status?schedule(c,req,priority):schedule(e,req,priority),req.onreadystatechange=noop):schedule(p,req,priority))},req.open(options.type||"GET",options.url,!0,options.user,options.password),req.responseType=options.responseType||"",Object.keys(options.headers||{}).forEach(function(k){
req.setRequestHeader(k,options.headers[k])}),options.customRequestInitializer&&options.customRequestInitializer(req),void 0===options.data?req.send():req.send(options.data)},function(){req.onreadystatechange=noop,req._canceled=!0,req.abort()})}var schemeRegex=/^(\w+)\:\/\//;return _Base.Namespace.define("WinJS",{xhr:xhr}),xhr}),define("WinJS/Utilities",["./Utilities/_Control","./Utilities/_Dispose","./Utilities/_ElementListUtilities","./Utilities/_ElementUtilities","./Utilities/_Hoverable","./Utilities/_ItemsManager","./Utilities/_KeyboardBehavior","./Utilities/_ParallelWorkQueue","./Utilities/_SafeHtml","./Utilities/_Select","./Utilities/_TabContainer","./Utilities/_Telemetry","./Utilities/_UI","./Utilities/_VersionManager","./Utilities/_Xhr"],function(){}),define("WinJS/XYFocus",["require","exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Utilities/_ElementUtilities","./Core/_Events","./ControlProcessor/_OptionsParser"],function(require,exports,_Global,_Base,_BaseUtils,_ElementUtilities,_Events,_OptionsParser){"use strict";function findNextFocusElement(direction,options){var result=_findNextFocusElementInternal(direction,options);return result?result.target:null}function moveFocus(direction,options){var result=findNextFocusElement(direction,options);if(result){var previousFocusElement=_Global.document.activeElement;if(_trySetFocus(result,-1))return eventSrc.dispatchEvent(EventNames.focusChanged,{previousFocusElement:previousFocusElement,keyCode:-1}),result}return null}function _xyFocus(direction,keyCode,referenceRect,dontExit){function updateHistoryRect(direction,result){var newHistoryRect=_defaultRect();direction===DirectionNames.left||direction===DirectionNames.right?(newHistoryRect.top=Math.max(result.targetRect.top,result.referenceRect.top,_historyRect?_historyRect.top:Number.MIN_VALUE),newHistoryRect.bottom=Math.min(result.targetRect.bottom,result.referenceRect.bottom,_historyRect?_historyRect.bottom:Number.MAX_VALUE),newHistoryRect.bottom<=newHistoryRect.top&&(newHistoryRect.top=result.targetRect.top,newHistoryRect.bottom=result.targetRect.bottom),newHistoryRect.height=newHistoryRect.bottom-newHistoryRect.top,newHistoryRect.width=Number.MAX_VALUE,newHistoryRect.left=Number.MIN_VALUE,newHistoryRect.right=Number.MAX_VALUE):(newHistoryRect.left=Math.max(result.targetRect.left,result.referenceRect.left,_historyRect?_historyRect.left:Number.MIN_VALUE),newHistoryRect.right=Math.min(result.targetRect.right,result.referenceRect.right,_historyRect?_historyRect.right:Number.MAX_VALUE),newHistoryRect.right<=newHistoryRect.left&&(newHistoryRect.left=result.targetRect.left,newHistoryRect.right=result.targetRect.right),newHistoryRect.width=newHistoryRect.right-newHistoryRect.left,newHistoryRect.height=Number.MAX_VALUE,newHistoryRect.top=Number.MIN_VALUE,newHistoryRect.bottom=Number.MAX_VALUE),_historyRect=newHistoryRect}if(referenceRect||_Global.document.activeElement!==_lastTarget)_historyRect=null,_lastTarget=null,_cachedLastTargetRect=null;else if(_lastTarget&&_cachedLastTargetRect){var lastTargetRect=_toIRect(_lastTarget.getBoundingClientRect());(lastTargetRect.left!==_cachedLastTargetRect.left||lastTargetRect.top!==_cachedLastTargetRect.top)&&(_historyRect=null,_lastTarget=null,_cachedLastTargetRect=null)}var activeElement=_Global.document.activeElement,result=_findNextFocusElementInternal(direction,{focusRoot:exports.focusRoot,historyRect:_historyRect,referenceElement:_lastTarget,referenceRect:referenceRect});if(result&&_trySetFocus(result.target,keyCode)){if(updateHistoryRect(direction,result),_lastTarget=result.target,_cachedLastTargetRect=result.targetRect,_ElementUtilities.hasClass(result.target,ClassNames.toggleMode)&&_ElementUtilities.removeClass(result.target,ClassNames.toggleModeActive),"IFRAME"===result.target.tagName){var targetIframe=result.target;if(IFrameHelper.isXYFocusEnabled(targetIframe)){var refRect=_toIRect({left:result.referenceRect.left-result.targetRect.left,top:result.referenceRect.top-result.targetRect.top,width:result.referenceRect.width,height:result.referenceRect.height}),message={};message[CrossDomainMessageConstants.messageDataProperty]={type:CrossDomainMessageConstants.dFocusEnter,direction:direction,referenceRect:refRect},targetIframe.contentWindow.postMessage(message,"*")}}return eventSrc.dispatchEvent(EventNames.focusChanged,{previousFocusElement:activeElement,keyCode:keyCode}),!0}if(!dontExit&&top!==window){var refRect=referenceRect;refRect||(refRect=_Global.document.activeElement?_toIRect(_Global.document.activeElement.getBoundingClientRect()):_defaultRect());var message={};return message[CrossDomainMessageConstants.messageDataProperty]={type:CrossDomainMessageConstants.dFocusExit,direction:direction,referenceRect:refRect},_Global.parent.postMessage(message,"*"),!0}return!1}function _findNextFocusElementInternal(direction,options){function calculatePercentInShadow(minReferenceCoord,maxReferenceCoord,minPotentialCoord,maxPotentialCoord){if(minReferenceCoord>=maxPotentialCoord||minPotentialCoord>=maxReferenceCoord)return 0;var pixelOverlap=Math.min(maxReferenceCoord,maxPotentialCoord)-Math.max(minReferenceCoord,minPotentialCoord),shortEdge=Math.min(maxPotentialCoord-minPotentialCoord,maxReferenceCoord-minReferenceCoord);return 0===shortEdge?0:pixelOverlap/shortEdge}function calculateScore(direction,maxDistance,historyRect,referenceRect,potentialRect){var percentInShadow,primaryAxisDistance,score=0,secondaryAxisDistance=0,percentInHistoryShadow=0;switch(direction){case DirectionNames.left:if(potentialRect.left>=referenceRect.left)break;percentInShadow=calculatePercentInShadow(referenceRect.top,referenceRect.bottom,potentialRect.top,potentialRect.bottom),primaryAxisDistance=referenceRect.left-potentialRect.right,percentInShadow>0?percentInHistoryShadow=calculatePercentInShadow(historyRect.top,historyRect.bottom,potentialRect.top,potentialRect.bottom):secondaryAxisDistance=referenceRect.bottom<=potentialRect.top?potentialRect.top-referenceRect.bottom:referenceRect.top-potentialRect.bottom;break;case DirectionNames.right:if(potentialRect.right<=referenceRect.right)break;percentInShadow=calculatePercentInShadow(referenceRect.top,referenceRect.bottom,potentialRect.top,potentialRect.bottom),primaryAxisDistance=potentialRect.left-referenceRect.right,percentInShadow>0?percentInHistoryShadow=calculatePercentInShadow(historyRect.top,historyRect.bottom,potentialRect.top,potentialRect.bottom):secondaryAxisDistance=referenceRect.bottom<=potentialRect.top?potentialRect.top-referenceRect.bottom:referenceRect.top-potentialRect.bottom;break;case DirectionNames.up:if(potentialRect.top>=referenceRect.top)break;percentInShadow=calculatePercentInShadow(referenceRect.left,referenceRect.right,potentialRect.left,potentialRect.right),primaryAxisDistance=referenceRect.top-potentialRect.bottom,percentInShadow>0?percentInHistoryShadow=calculatePercentInShadow(historyRect.left,historyRect.right,potentialRect.left,potentialRect.right):secondaryAxisDistance=referenceRect.right<=potentialRect.left?potentialRect.left-referenceRect.right:referenceRect.left-potentialRect.right;break;case DirectionNames.down:if(potentialRect.bottom<=referenceRect.bottom)break;percentInShadow=calculatePercentInShadow(referenceRect.left,referenceRect.right,potentialRect.left,potentialRect.right),primaryAxisDistance=potentialRect.top-referenceRect.bottom,percentInShadow>0?percentInHistoryShadow=calculatePercentInShadow(historyRect.left,historyRect.right,potentialRect.left,potentialRect.right):secondaryAxisDistance=referenceRect.right<=potentialRect.left?potentialRect.left-referenceRect.right:referenceRect.left-potentialRect.right}return primaryAxisDistance>=0&&(primaryAxisDistance=maxDistance-primaryAxisDistance,secondaryAxisDistance=maxDistance-secondaryAxisDistance,primaryAxisDistance>=0&&secondaryAxisDistance>=0&&(primaryAxisDistance+=primaryAxisDistance*percentInShadow,score=primaryAxisDistance*ScoringConstants.primaryAxisDistanceWeight+secondaryAxisDistance*ScoringConstants.secondaryAxisDistanceWeight+percentInHistoryShadow*ScoringConstants.percentInHistoryShadowWeight)),score}function getReferenceObject(referenceElement,referenceRect){var refElement,refRect;return(!referenceElement&&!referenceRect||referenceElement&&!referenceElement.parentNode)&&_Global.document.activeElement!==_Global.document.body&&(referenceElement=_Global.document.activeElement),referenceElement?(refElement=referenceElement,refRect=_toIRect(refElement.getBoundingClientRect())):refRect=referenceRect?_toIRect(referenceRect):_defaultRect(),{element:refElement,rect:refRect}}options=options||{},options.focusRoot=options.focusRoot||exports.focusRoot||_Global.document.body,options.historyRect=options.historyRect||_defaultRect();var maxDistance=Math.max(_Global.screen.availHeight,_Global.screen.availWidth),refObj=getReferenceObject(options.referenceElement,options.referenceRect);if(refObj.element){var manualOverrideOptions=refObj.element.getAttribute(AttributeNames.focusOverride)||refObj.element.getAttribute(AttributeNames.focusOverrideLegacy);if(manualOverrideOptions){var parsedOptions=_OptionsParser.optionsParser(manualOverrideOptions),selector=parsedOptions[direction]||parsedOptions[direction[0].toUpperCase()+direction.substr(1)];if(selector){for(var target,element=refObj.element;!target&&element;)target=element.querySelector(selector),element=element.parentElement;if(target)return target===_Global.document.activeElement?null:{target:target,targetRect:_toIRect(target.getBoundingClientRect()),referenceRect:refObj.rect,usedOverride:!0}}}}for(var bestPotential={element:null,rect:null,score:0},allElements=options.focusRoot.querySelectorAll("*"),i=0,length=allElements.length;length>i;i++){var potentialElement=allElements[i];if(refObj.element!==potentialElement&&_isFocusable(potentialElement)&&!_isInInactiveToggleModeContainer(potentialElement)){var potentialRect=_toIRect(potentialElement.getBoundingClientRect());if(0!==potentialRect.width&&0!==potentialRect.height){var score=calculateScore(direction,maxDistance,options.historyRect,refObj.rect,potentialRect);score>bestPotential.score&&(bestPotential.element=potentialElement,bestPotential.rect=potentialRect,bestPotential.score=score)}}}return bestPotential.element?{target:bestPotential.element,targetRect:bestPotential.rect,referenceRect:refObj.rect,usedOverride:!1}:null}function _defaultRect(){return{top:-1,bottom:-1,right:-1,left:-1,height:0,width:0}}function _toIRect(rect){return{top:Math.floor(rect.top),bottom:Math.floor(rect.top+rect.height),right:Math.floor(rect.left+rect.width),left:Math.floor(rect.left),height:Math.floor(rect.height),width:Math.floor(rect.width)}}function _trySetFocus(element,keyCode){var canceled=eventSrc.dispatchEvent(EventNames.focusChanging,{nextFocusElement:element,keyCode:keyCode});return canceled||element.focus(),_Global.document.activeElement===element}function _isFocusable(element){var elementTagName=element.tagName;if(!element.hasAttribute("tabindex")&&-1===FocusableTagNames.indexOf(elementTagName)&&!_ElementUtilities.hasClass(element,ClassNames.focusable))return!1;if("IFRAME"===elementTagName&&!IFrameHelper.isXYFocusEnabled(element))return!1;if("DIV"===elementTagName&&element.winControl&&element.winControl.disabled)return!1;var style=_ElementUtilities._getComputedStyle(element);return"-1"===element.getAttribute("tabIndex")||"none"===style.display||"hidden"===style.visibility||element.disabled?!1:!0}function _findParentToggleModeContainer(element){for(var toggleModeRoot=element.parentElement;toggleModeRoot&&!_isToggleMode(toggleModeRoot);)toggleModeRoot=toggleModeRoot.parentElement;return toggleModeRoot}function _isInInactiveToggleModeContainer(element){var container=_findParentToggleModeContainer(element);return container&&!_ElementUtilities.hasClass(container,ClassNames.toggleModeActive)}function _isToggleMode(element){if(_ElementUtilities.hasClass(element,ClassNames.toggleMode))return!0;if("INPUT"===element.tagName){var inputType=element.type.toLowerCase();if("date"===inputType||"datetime"===inputType||"datetime-local"===inputType||"email"===inputType||"month"===inputType||"number"===inputType||"password"===inputType||"range"===inputType||"search"===inputType||"tel"===inputType||"text"===inputType||"time"===inputType||"url"===inputType||"week"===inputType)return!0}else if("TEXTAREA"===element.tagName)return!0;return!1}function _getStateHandler(element){var suspended=!1,toggleMode=!1,toggleModeActive=!1;element&&(suspended=_ElementUtilities._matchesSelector(element,"."+ClassNames.suspended+", ."+ClassNames.suspended+" *"),toggleMode=_isToggleMode(element),toggleModeActive=_ElementUtilities.hasClass(element,ClassNames.toggleModeActive));var stateHandler=KeyHandlerStates.RestState;return suspended?stateHandler=KeyHandlerStates.SuspendedState:toggleMode&&(stateHandler=toggleModeActive?KeyHandlerStates.ToggleModeActiveState:KeyHandlerStates.ToggleModeRestState),stateHandler}function _handleKeyEvent(e){if(!e.defaultPrevented){var stateHandler=_getStateHandler(document.activeElement),direction="";if(-1!==exports.keyCodeMap.up.indexOf(e.keyCode)?direction="up":-1!==exports.keyCodeMap.down.indexOf(e.keyCode)?direction="down":-1!==exports.keyCodeMap.left.indexOf(e.keyCode)?direction="left":-1!==exports.keyCodeMap.right.indexOf(e.keyCode)&&(direction="right"),direction){var shouldPreventDefault=stateHandler.xyFocus(direction,e.keyCode);shouldPreventDefault&&e.preventDefault()}}}function _handleCaptureKeyEvent(e){if(!e.defaultPrevented){var activeElement=document.activeElement,shouldPreventDefault=!1,stateHandler=_getStateHandler(document.activeElement);-1!==exports.keyCodeMap.accept.indexOf(e.keyCode)?shouldPreventDefault=stateHandler.accept(activeElement):-1!==exports.keyCodeMap.cancel.indexOf(e.keyCode)&&(shouldPreventDefault=stateHandler.cancel(activeElement)),shouldPreventDefault&&e.preventDefault()}}var Keys=_ElementUtilities.Key,AttributeNames={focusOverride:"data-win-xyfocus",focusOverrideLegacy:"data-win-focus"},ClassNames={focusable:"win-focusable",suspended:"win-xyfocus-suspended",toggleMode:"win-xyfocus-togglemode",toggleModeActive:"win-xyfocus-togglemode-active",xboxPlatform:"win-xbox"},CrossDomainMessageConstants={messageDataProperty:"msWinJSXYFocusControlMessage",register:"register",unregister:"unregister",dFocusEnter:"dFocusEnter",dFocusExit:"dFocusExit"},DirectionNames={left:"left",right:"right",up:"up",down:"down"},EventNames={focusChanging:"focuschanging",focusChanged:"focuschanged"},FocusableTagNames=["A","BUTTON","IFRAME","INPUT","SELECT","TEXTAREA"],ScoringConstants={primaryAxisDistanceWeight:30,secondaryAxisDistanceWeight:20,percentInHistoryShadowWeight:1e5};exports.keyCodeMap={left:[],right:[],up:[],down:[],accept:[],cancel:[]},exports.focusRoot,exports.findNextFocusElement=findNextFocusElement,exports.moveFocus=moveFocus;var _lastTarget,_cachedLastTargetRect,_historyRect,KeyHandlerStates;!function(KeyHandlerStates){function _clickElement(element){return element&&element.click&&element.click(),!1}function _nop(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i-0]=arguments[_i];return!1}var RestState=function(){function RestState(){}return RestState.accept=_clickElement,RestState.cancel=_nop,RestState.xyFocus=_xyFocus,RestState}();KeyHandlerStates.RestState=RestState;var SuspendedState=function(){function SuspendedState(){}return SuspendedState.accept=_nop,SuspendedState.cancel=_nop,SuspendedState.xyFocus=_nop,SuspendedState}();KeyHandlerStates.SuspendedState=SuspendedState;var ToggleModeRestState=function(){function ToggleModeRestState(){}return ToggleModeRestState.accept=function(element){return _ElementUtilities.addClass(element,ClassNames.toggleModeActive),!0},ToggleModeRestState.cancel=_nop,ToggleModeRestState.xyFocus=_xyFocus,ToggleModeRestState}();KeyHandlerStates.ToggleModeRestState=ToggleModeRestState;var ToggleModeActiveState=function(){function ToggleModeActiveState(){}return ToggleModeActiveState.cancel=function(element){return element&&_ElementUtilities.removeClass(element,ClassNames.toggleModeActive),!0},ToggleModeActiveState.accept=_clickElement,ToggleModeActiveState.xyFocus=_nop,ToggleModeActiveState}();KeyHandlerStates.ToggleModeActiveState=ToggleModeActiveState}(KeyHandlerStates||(KeyHandlerStates={}));var IFrameHelper;if(function(IFrameHelper){function count(){return _safeForEach(function(){return!1}),iframes.length}function getIFrameFromWindow(win){var iframes=_Global.document.querySelectorAll("IFRAME"),found=Array.prototype.filter.call(iframes,function(x){return x.contentWindow===win});return found.length?found[0]:null}function isXYFocusEnabled(iframe){var found=!1;return _safeForEach(function(ifr){ifr===iframe&&(found=!0)}),found}function registerIFrame(iframe){iframes.push(iframe)}function unregisterIFrame(iframe){var index=-1;_safeForEach(function(ifr,i){ifr===iframe&&(index=i)}),-1!==index&&iframes.splice(index,1)}function _safeForEach(callback){for(var i=iframes.length-1;i>=0;i--)try{var iframe=iframes[i];iframe.contentWindow?callback(iframe,i):iframes.splice(i,1)}catch(e){iframes.splice(i,1)}}var iframes=[];IFrameHelper.count=count,IFrameHelper.getIFrameFromWindow=getIFrameFromWindow,IFrameHelper.isXYFocusEnabled=isXYFocusEnabled,IFrameHelper.registerIFrame=registerIFrame,IFrameHelper.unregisterIFrame=unregisterIFrame}(IFrameHelper||(IFrameHelper={})),_Global.document){exports.keyCodeMap.left.push(Keys.GamepadLeftThumbstickLeft,Keys.GamepadDPadLeft,Keys.NavigationLeft),exports.keyCodeMap.right.push(Keys.GamepadLeftThumbstickRight,Keys.GamepadDPadRight,Keys.NavigationRight),exports.keyCodeMap.up.push(Keys.GamepadLeftThumbstickUp,Keys.GamepadDPadUp,Keys.NavigationUp),exports.keyCodeMap.down.push(Keys.GamepadLeftThumbstickDown,Keys.GamepadDPadDown,Keys.NavigationDown),exports.keyCodeMap.accept.push(Keys.GamepadA,Keys.NavigationAccept),exports.keyCodeMap.cancel.push(Keys.GamepadB,Keys.NavigationCancel),_Global.addEventListener("message",function(e){var sourceWindow=null;try{if(sourceWindow=e.source,!sourceWindow)return}catch(e){return}if(e.data&&e.data[CrossDomainMessageConstants.messageDataProperty]){var data=e.data[CrossDomainMessageConstants.messageDataProperty];switch(data.type){case CrossDomainMessageConstants.register:var iframe=IFrameHelper.getIFrameFromWindow(sourceWindow);iframe&&IFrameHelper.registerIFrame(iframe);break;case CrossDomainMessageConstants.unregister:var iframe=IFrameHelper.getIFrameFromWindow(sourceWindow);iframe&&IFrameHelper.unregisterIFrame(iframe);break;case CrossDomainMessageConstants.dFocusEnter:var focused=_xyFocus(data.direction,-1,data.referenceRect,!0);focused||(_isFocusable(_Global.document.body)?_Global.document.body.focus():_xyFocus(data.direction,-1));break;case CrossDomainMessageConstants.dFocusExit:var iframe=IFrameHelper.getIFrameFromWindow(sourceWindow);if(_Global.document.activeElement!==iframe)break;var refRect=data.referenceRect,iframeRect=iframe.getBoundingClientRect();refRect.left+=iframeRect.left,refRect.top+=iframeRect.top,"number"==typeof refRect.right&&(refRect.right+=iframeRect.left),"number"==typeof refRect.bottom&&(refRect.bottom+=iframeRect.top),_xyFocus(data.direction,-1,refRect)}}}),_BaseUtils.ready().then(function(){if(_ElementUtilities.hasWinRT&&_Global.Windows&&_Global.Windows.Xbox&&_ElementUtilities.addClass(_Global.document.body,ClassNames.xboxPlatform),_Global.document.addEventListener("keydown",_handleCaptureKeyEvent,!0),_Global.document.addEventListener("keydown",_handleKeyEvent),_Global.top!==_Global.window){var message={};message[CrossDomainMessageConstants.messageDataProperty]={type:CrossDomainMessageConstants.register,version:1},_Global.parent.postMessage(message,"*")}});var toPublish={focusRoot:{get:function(){return exports.focusRoot},set:function(value){exports.focusRoot=value}},findNextFocusElement:findNextFocusElement,keyCodeMap:exports.keyCodeMap,moveFocus:moveFocus,onfocuschanged:_Events._createEventProperty(EventNames.focusChanged),onfocuschanging:_Events._createEventProperty(EventNames.focusChanging),_xyFocus:_xyFocus,_iframeHelper:IFrameHelper};toPublish=_BaseUtils._merge(toPublish,_Events.eventMixin),toPublish._listeners={};var eventSrc=toPublish;_Base.Namespace.define("WinJS.UI.XYFocus",toPublish)}}),define("WinJS/Fragments",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Resources","./Core/_WriteProfilerMark","./Promise","./Utilities/_ElementUtilities","./Utilities/_SafeHtml","./Utilities/_Xhr"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Resources,_WriteProfilerMark,Promise,_ElementUtilities,_SafeHtml,_Xhr){"use strict";function addScript(scriptTag,fragmentHref,position,lastNonInlineScriptPromise){var src=scriptTag.src,inline=!src;if(inline&&(src=fragmentHref+"script["+position+"]"),src=src.toLowerCase(),!(src in scripts)){var promise=null;scripts[src]=!0;var n=_Global.document.createElement("script");if(scriptTag.language&&n.setAttribute("language","javascript"),n.setAttribute("type",scriptTag.type),n.setAttribute("async","false"),scriptTag.id&&n.setAttribute("id",scriptTag.id),inline){var text=scriptTag.text;promise=lastNonInlineScriptPromise.then(function(){n.text=text}).then(null,function(){})}else promise=new Promise(function(c){n.onload=n.onerror=function(){c()},n.setAttribute("src",scriptTag.src)});return head.appendChild(n),{promise:promise,inline:inline}}}function addStyle(styleTag,fragmentHref,position){var src=(fragmentHref+"script["+position+"]").toLowerCase();src in styles||(styles[src]=!0,head.appendChild(styleTag.cloneNode(!0)))}function addLink(styleTag){var src=styleTag.href.toLowerCase();if(!(src in links)){links[src]=!0;var n=styleTag.cloneNode(!1);n.href=styleTag.href,head.appendChild(n)}}function getStateRecord(href,removeFromCache){if("string"==typeof href)return loadFromCache(href,removeFromCache);var state={docfrag:_ElementUtilities.data(href).docFragment};if(!state.docfrag){for(var fragment=_Global.document.createDocumentFragment();href.childNodes.length>0;)fragment.appendChild(href.childNodes[0]);state.docfrag=_ElementUtilities.data(href).docFragment=fragment,href.setAttribute("data-win-hasfragment","")}return removeFromCache&&clearCache(href),Promise.as(state)}function createEntry(state,href){return populateDocument(state,href).then(function(){return state.document?processDocument(href,state):state}).then(function(){return state.document&&delete state.document,state})}function loadFromCache(href,removeFromCache){var fragmentId=href.toLowerCase(),state=cacheStore[fragmentId];if(state)return removeFromCache&&delete cacheStore[fragmentId],state.promise?state.promise:Promise.as(state);state={},removeFromCache||(cacheStore[fragmentId]=state);var result=state.promise=createEntry(state,href);return state.promise.then(function(){delete state.promise}),result}function processDocument(href,state){var cd=state.document,b=cd.body,sp=[];forEach(cd.querySelectorAll('link[rel="stylesheet"], link[type="text/css"]'),addLink),forEach(cd.getElementsByTagName("style"),function(e,i){addStyle(e,href,i)});var lastNonInlineScriptPromise=Promise.as();forEach(cd.getElementsByTagName("script"),function(e,i){var result=addScript(e,href,i,lastNonInlineScriptPromise);result&&(result.inline||(lastNonInlineScriptPromise=result.promise),sp.push(result.promise))}),forEach(b.getElementsByTagName("img"),function(e){e.src=e.src}),forEach(b.getElementsByTagName("a"),function(e){if(""!==e.href){var href=e.getAttribute("href");href&&"#"!==href[0]&&(e.href=e.href)}});for(var localScripts=b.getElementsByTagName("script");localScripts.length>0;){var s=localScripts[0];s.parentNode.removeChild(s)}return Promise.join(sp).then(function(){for(var fragment=_Global.document.createDocumentFragment(),imported=_Global.document.importNode(cd.body,!0);imported.childNodes.length>0;)fragment.appendChild(imported.childNodes[0]);return state.docfrag=fragment,state})}function initialize(){initialized||(initialized=!0,forEach(head.querySelectorAll("script"),function(e){scripts[e.src.toLowerCase()]=!0}),forEach(head.querySelectorAll('link[rel="stylesheet"], link[type="text/css"]'),function(e){links[e.href.toLowerCase()]=!0}))}function renderCopy(href,target){return renderImpl(href,target,!0)}function renderImpl(href,target,copy){var profilerMarkIdentifier=(href instanceof _Global.HTMLElement?_BaseUtils._getProfilerMarkIdentifier(href):" href='"+href+"'")+"["+ ++uniqueId+"]";return writeProfilerMark("WinJS.UI.Fragments:render"+profilerMarkIdentifier+",StartTM"),initialize(),getStateRecord(href,!copy).then(function(state){var frag=state.docfrag;copy&&(frag=frag.cloneNode(!0));for(var child=frag.firstChild;child;)1===child.nodeType&&(child.msParentSelectorScope=!0),child=child.nextSibling;var retVal;return target?(target.appendChild(frag),retVal=target):retVal=frag,writeProfilerMark("WinJS.UI.Fragments:render"+profilerMarkIdentifier+",StopTM"),retVal})}function render(href,target){return renderImpl(href,target,!1)}function cache(href){return initialize(),getStateRecord(href).then(function(state){return state.docfrag})}function clearCache(href){href?"string"==typeof href?delete cacheStore[href.toLowerCase()]:(delete _ElementUtilities.data(href).docFragment,href.removeAttribute("data-win-hasfragment")):cacheStore={}}function populateDocument(state,href){var htmlDoc=_Global.document.implementation.createHTMLDocument("frag"),base=htmlDoc.createElement("base");htmlDoc.head.appendChild(base);var anchor=htmlDoc.createElement("a");return htmlDoc.body.appendChild(anchor),base.href=_Global.document.location.href,anchor.setAttribute("href",href),base.href=anchor.href,state.document=htmlDoc,getFragmentContents(href).then(function(text){_SafeHtml.setInnerHTMLUnsafe(htmlDoc.documentElement,text),htmlDoc.head.appendChild(base)})}function getFragmentContentsXHR(href){return _Xhr({url:href}).then(function(req){return req.responseText})}if(_Global.document){var forEach=function(arrayLikeValue,action){for(var i=0,l=arrayLikeValue.length;l>i;i++)action(arrayLikeValue[i],i)},head=_Global.document.head||_Global.document.getElementsByTagName("head")[0],scripts={},styles={},links={},initialized=!1,cacheStore={},uniqueId=1,writeProfilerMark=_WriteProfilerMark,getFragmentContents=getFragmentContentsXHR;_Base.Namespace._moduleDefine(exports,"WinJS.UI.Fragments",{renderCopy:renderCopy,render:render,cache:cache,clearCache:clearCache,_cacheStore:{get:function(){return cacheStore}},_getFragmentContents:{get:function(){return getFragmentContents},set:function(value){getFragmentContents=value}},_writeProfilerMark:{get:function(){return writeProfilerMark},set:function(value){writeProfilerMark=value}}})}}),define("WinJS/Application/_State",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Promise"],function(exports,_Global,_WinRT,_Base,_BaseUtils,Promise){"use strict";function initWithWinRT(){var local,temp,roaming,IOHelper=_Base.Class.define(function(folder){this.folder=folder,this._path=folder.path,folder.tryGetItemAsync&&(this._tryGetItemAsync=folder.tryGetItemAsync.bind(folder))},{_tryGetItemAsync:function(fileName){return this.folder.getFileAsync(fileName).then(null,function(){return!1})},exists:function(fileName){return this._tryGetItemAsync(fileName).then(function(fileItem){return fileItem?!0:!1})},remove:function(fileName){return this._tryGetItemAsync(fileName).then(function(fileItem){return fileItem?fileItem.deleteAsync():!1}).then(null,function(){return!1})},writeText:function(fileName,str){var sto=_WinRT.Windows.Storage,that=this;return that.folder.createFileAsync(fileName,sto.CreationCollisionOption.openIfExists).then(function(fileItem){return sto.FileIO.writeTextAsync(fileItem,str)})},readText:function(fileName,def){var sto=_WinRT.Windows.Storage;return this._tryGetItemAsync(fileName).then(function(fileItem){return fileItem?sto.FileIO.readTextAsync(fileItem):def}).then(null,function(){return def})}},{supportedForProcessing:!1});_Base.Namespace._moduleDefine(exports,"WinJS.Application",{local:{get:function(){return local||(local=new IOHelper(_WinRT.Windows.Storage.ApplicationData.current.localFolder)),local}},temp:{get:function(){return temp||(temp=new IOHelper(_WinRT.Windows.Storage.ApplicationData.current.temporaryFolder)),temp}},roaming:{get:function(){return roaming||(roaming=new IOHelper(_WinRT.Windows.Storage.ApplicationData.current.roamingFolder)),roaming}}})}function initWithStub(){var InMemoryHelper=_Base.Class.define(function(){this.storage={}},{exists:function(fileName){return Promise.as(void 0!==this.storage[fileName])},remove:function(fileName){return delete this.storage[fileName],Promise.as()},writeText:function(fileName,str){return this.storage[fileName]=str,Promise.as(str.length)},readText:function(fileName,def){var result=this.storage[fileName];return Promise.as("string"==typeof result?result:def)}},{supportedForProcessing:!1});_Base.Namespace._moduleDefine(exports,"WinJS.Application",{local:new InMemoryHelper,temp:new InMemoryHelper,roaming:new InMemoryHelper})}_WinRT.Windows.Storage.FileIO&&_WinRT.Windows.Storage.ApplicationData&&_WinRT.Windows.Storage.CreationCollisionOption?initWithWinRT():initWithStub();var sessionState={};_Base.Namespace._moduleDefine(exports,"WinJS.Application",{sessionState:{get:function(){return sessionState},set:function(value){sessionState=value}},_loadState:function(e){return 3===e.previousExecutionState?exports.local.readText("_sessionState.json","{}").then(function(str){var sessionState=JSON.parse(str);sessionState&&Object.keys(sessionState).length>0&&(exports._sessionStateLoaded=!0),exports.sessionState=sessionState}).then(null,function(){exports.sessionState={}}):Promise.as()},_oncheckpoint:function(event,Application){if(!(_Global.MSApp&&_Global.MSApp.getViewOpener&&_Global.MSApp.getViewOpener())){var sessionState=exports.sessionState;if(sessionState&&Object.keys(sessionState).length>0||exports._sessionStateLoaded){var stateString;try{stateString=JSON.stringify(sessionState)}catch(e){stateString="",Application.queueEvent({type:"error",detail:e})}event.setPromise(exports.local.writeText("_sessionState.json",stateString).then(null,function(err){Application.queueEvent({type:"error",detail:err})}))}}}})}),define("WinJS/Navigation",["exports","./Core/_Base","./Core/_Events","./Core/_WriteProfilerMark","./Promise"],function(exports,_Base,_Events,_WriteProfilerMark,Promise){"use strict";var navigatedEventName="navigated",navigatingEventName="navigating",beforenavigateEventName="beforenavigate",ListenerType=_Base.Class.mix(_Base.Class.define(null,{},{supportedForProcessing:!1}),_Events.eventMixin),listeners=new ListenerType,history={backStack:[],current:{location:"",initialPlaceholder:!0},forwardStack:[]},createEvent=_Events._createEventProperty,raiseBeforeNavigate=function(proposed){return _WriteProfilerMark("WinJS.Navigation:navigation,StartTM"),Promise.as().then(function(){var waitForPromise=Promise.as(),defaultPrevented=listeners.dispatchEvent(beforenavigateEventName,{setPromise:function(promise){waitForPromise=waitForPromise.then(function(){return promise})},location:proposed.location,state:proposed.state});return waitForPromise.then(function(cancel){return defaultPrevented||cancel})})},raiseNavigating=function(delta){return Promise.as().then(function(){var waitForPromise=Promise.as();return listeners.dispatchEvent(navigatingEventName,{setPromise:function(promise){waitForPromise=waitForPromise.then(function(){return promise})},location:history.current.location,state:history.current.state,delta:delta}),waitForPromise})},raiseNavigated=function(value,err){_WriteProfilerMark("WinJS.Navigation:navigation,StopTM");var waitForPromise=Promise.as(),detail={value:value,location:history.current.location,state:history.current.state,setPromise:function(promise){waitForPromise=waitForPromise.then(function(){return promise})}};return!value&&err&&(detail.error=err),listeners.dispatchEvent(navigatedEventName,detail),waitForPromise;
},go=function(distance,fromStack,toStack,delta){return distance=Math.min(distance,fromStack.length),distance>0?raiseBeforeNavigate(fromStack[fromStack.length-distance]).then(function(cancel){if(cancel)return!1;for(toStack.push(history.current);distance-1>0;)distance--,toStack.push(fromStack.pop());return history.current=fromStack.pop(),raiseNavigating(delta).then(raiseNavigated,function(err){throw raiseNavigated(void 0,err||!0),err}).then(function(){return!0})}):Promise.wrap(!1)};_Base.Namespace._moduleDefine(exports,"WinJS.Navigation",{canGoForward:{get:function(){return history.forwardStack.length>0}},canGoBack:{get:function(){return history.backStack.length>0}},location:{get:function(){return history.current.location}},state:{get:function(){return history.current.state},set:function(value){history.current.state=value}},history:{get:function(){return history},set:function(value){history=value,history.backStack=history.backStack||[],history.forwardStack=history.forwardStack||[],history.current=history.current||{location:"",initialPlaceholder:!0},history.current.location=history.current.location||""}},forward:function(distance){return distance=distance||1,go(distance,history.forwardStack,history.backStack,distance)},back:function(distance){return distance=distance||1,go(distance,history.backStack,history.forwardStack,-distance)},navigate:function(location,initialState){var proposed={location:location,state:initialState};return raiseBeforeNavigate(proposed).then(function(cancel){return cancel?!1:(history.current.initialPlaceholder||history.backStack.push(history.current),history.forwardStack=[],history.current=proposed,raiseNavigating().then(raiseNavigated,function(err){throw raiseNavigated(void 0,err||!0),err}).then(function(){return!0}))})},addEventListener:function(eventType,listener,capture){listeners.addEventListener(eventType,listener,capture)},removeEventListener:function(eventType,listener,capture){listeners.removeEventListener(eventType,listener,capture)},onnavigated:createEvent(navigatedEventName),onnavigating:createEvent(navigatingEventName),onbeforenavigate:createEvent(beforenavigateEventName)})}),define("WinJS/Application",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_Events","./Core/_Log","./Core/_WriteProfilerMark","./Application/_State","./Navigation","./Promise","./_Signal","./Scheduler","./Utilities/_ElementUtilities"],function(exports,_Global,_WinRT,_Base,_Events,_Log,_WriteProfilerMark,_State,Navigation,Promise,_Signal,Scheduler,_ElementUtilities){"use strict";function safeSerialize(obj){var str;try{var seenObjects=[];str=JSON.stringify(obj,function(key,value){return value===_Global?"[window]":value instanceof _Global.HTMLElement?"[HTMLElement]":"function"==typeof value?"[function]":"object"==typeof value?null===value?value:-1===seenObjects.indexOf(value)?(seenObjects.push(value),value):"[circular]":value})}catch(err){str=JSON.stringify("[object]")}return str}function fatalErrorHandler(e){if(_Log.log&&_Log.log(safeSerialize(e),"winjs","error"),_Global.document&&exports._terminateApp){var data=e.detail,number=data&&(data.number||data.exception&&(data.exception.number||data.exception.code)||data.error&&data.error.number||data.errorCode||0),terminateData={description:safeSerialize(data),stack:data&&(data.stack||data.exception&&(data.exception.stack||data.exception.message)||data.error&&data.error.stack||null),errorNumber:number,number:number};exports._terminateApp(terminateData,e)}}function defaultTerminateAppHandler(data,e){_Global.MSApp&&_Global.MSApp.terminateApp(data)}function captureDeferral(obj){var id="def"+pendingDeferralID++;return{deferral:pendingDeferrals[id]=obj.getDeferral(),id:id}}function completeDeferral(deferral,deferralID){deferralID&&(deferral=pendingDeferrals[deferralID],delete pendingDeferrals[deferralID]),deferral&&deferral.complete()}function cleanupAllPendingDeferrals(){pendingDeferrals&&(Object.keys(pendingDeferrals).forEach(function(k){pendingDeferrals[k].complete()}),pendingDeferrals={})}function dispatchEvent(eventRecord){function cleanup(r){return _WriteProfilerMark("WinJS.Application:Event_"+eventRecord.type+",StopTM"),eventRecord._deferral&&completeDeferral(eventRecord._deferral,eventRecord._deferralID),r}_WriteProfilerMark("WinJS.Application:Event_"+eventRecord.type+",StartTM");var waitForPromise=Promise.as();eventRecord.setPromise=function(promise){waitForPromise=waitForPromise.then(function(){return promise})},eventRecord._stoppedImmediatePropagation=!1,eventRecord.stopImmediatePropagation=function(){eventRecord._stoppedImmediatePropagation=!0},eventRecord.detail=eventRecord.detail||{},"object"==typeof eventRecord.detail&&(eventRecord.detail.setPromise=eventRecord.setPromise);try{if(listeners._listeners){var handled=!1;if(l=listeners._listeners[eventRecord.type])for(var i=0,len=l.length;len>i&&!eventRecord._stoppedImmediatePropagation;i++)handled=l[i].listener(eventRecord)||handled}var l=builtInListeners[eventRecord.type];l&&l.forEach(function(e){e(eventRecord,handled)})}catch(err){eventRecord.type===errorET?fatalErrorHandler(eventRecord):queueEvent({type:errorET,detail:err})}return waitForPromise.then(cleanup,function(r){return r=cleanup(r),r&&"Canceled"===r.name?void 0:Promise.wrapError(r)})}function createEventQueuedSignal(){return eventQueuedSignal||(eventQueuedSignal=new _Signal,eventQueuedSignal.promise.done(function(){eventQueuedSignal=null},function(){eventQueuedSignal=null})),eventQueuedSignal}function drainOneEvent(queue){function drainError(err){queueEvent({type:errorET,detail:err})}return 0===queue.length?createEventQueuedSignal().promise:dispatchEvent(queue.shift()).then(null,drainError)}function drainQueue(jobInfo){function drainNext(){return drainQueue}var queue=jobInfo.job._queue;0===queue.length&&eventQueue.length>0&&(queue=jobInfo.job._queue=copyAndClearQueue()),jobInfo.setPromise(drainOneEvent(queue).then(drainNext,drainNext))}function startEventQueue(){function markSync(){sync=!0}for(var promise,queue=[],sync=!0;sync;)0===queue.length&&eventQueue.length>0&&(queue=copyAndClearQueue()),sync=!1,promise=drainOneEvent(queue),promise.done(markSync,markSync);eventQueueJob=Scheduler.schedule(function(jobInfo){function drainNext(){return drainQueue}jobInfo.setPromise(promise.then(drainNext,drainNext))},Scheduler.Priority.high,null,"WinJS.Application._pumpEventQueue"),eventQueueJob._queue=queue}function queueEvent(eventRecord){_WriteProfilerMark("WinJS.Application:Event_"+eventRecord.type+" queued,Info"),eventQueue.push(eventRecord),running&&eventQueuedSignal&&eventQueuedSignal.complete(drainQueue)}function copyAndClearQueue(){var queue=eventQueue;return eventQueue=[],queue}function activatedHandler(e){var def=captureDeferral(e.activatedOperation);_State._loadState(e).then(function(){queueEvent({type:activatedET,detail:e,_deferral:def.deferral,_deferralID:def.id})})}function suspendingHandler(e){var def=captureDeferral(e.suspendingOperation);queueEvent({type:checkpointET,_deferral:def.deferral,_deferralID:def.id})}function domContentLoadedHandler(){if(queueEvent({type:loadedET}),!_Global.document||!_WinRT.Windows.UI.WebUI.WebUIApplication){var activatedArgs={arguments:"",kind:"Windows.Launch",previousExecutionState:0};_State._loadState(activatedArgs).then(function(){queueEvent({type:activatedET,detail:activatedArgs})})}}function beforeUnloadHandler(){cleanupAllPendingDeferrals(),queueEvent({type:unloadET})}function errorHandler(e){var flattenedError={};for(var key in e)flattenedError[key]=e[key];var data,handled=!0,prev=exports._terminateApp;try{exports._terminateApp=function(d,e){handled=!1,data=d,prev!==defaultTerminateAppHandler&&prev(d,e)},dispatchEvent({type:errorET,detail:{error:flattenedError,errorLine:e.lineno,errorCharacter:e.colno,errorUrl:e.filename,errorMessage:e.message}})}finally{exports._terminateApp=prev}return handled}function promiseErrorHandler(e){var details=e.detail,id=details.id;if(details.parent)return void(details.handler&&outstandingPromiseErrors&&delete outstandingPromiseErrors[id]);if(details.exception instanceof Error){var error={stack:details.exception.stack,message:details.exception.message};details.exception=error}var shouldScheduleErrors=!outstandingPromiseErrors;outstandingPromiseErrors=outstandingPromiseErrors||[],outstandingPromiseErrors[id]=details,shouldScheduleErrors&&Scheduler.schedule(function(){var errors=outstandingPromiseErrors;outstandingPromiseErrors=null,errors.forEach(function(error){queueEvent({type:errorET,detail:error})})},Scheduler.Priority.high,null,"WinJS.Application._queuePromiseErrors")}function commandsRequested(e){var event={e:e,applicationcommands:void 0};listeners.dispatchEvent(settingsET,event)}function hardwareButtonBackPressed(winRTBackPressedEvent){var eventRecord={type:backClickET};Object.defineProperty(eventRecord,"_winRTBackPressedEvent",{value:winRTBackPressedEvent,enumerable:!1}),dispatchEvent(eventRecord)}function requestingFocusOnKeyboardInput(){dispatchEvent({type:beforeRequestingFocusOnKeyboardInputET})}function edgyStarting(eventObject){dispatchEvent({type:edgyStartingET,kind:eventObject.kind})}function edgyCompleted(eventObject){dispatchEvent({type:edgyCompletedET,kind:eventObject.kind})}function edgyCanceled(eventObject){dispatchEvent({type:edgyCanceledET,kind:eventObject.kind})}function getNavManager(){var manager=_WinRT.Windows.UI.Core.SystemNavigationManager;return isModern&&manager?manager.getForCurrentView():null}function register(){if(!registered){if(registered=!0,_Global.addEventListener("beforeunload",beforeUnloadHandler,!1),_Global.document){if(_Global.addEventListener("error",errorHandler,!1),_WinRT.Windows.UI.WebUI.WebUIApplication){var wui=_WinRT.Windows.UI.WebUI.WebUIApplication;wui.addEventListener("activated",activatedHandler,!1),wui.addEventListener("suspending",suspendingHandler,!1)}if(_WinRT.Windows.UI.ApplicationSettings.SettingsPane){var settingsPane=_WinRT.Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView();settingsPane.addEventListener("commandsrequested",commandsRequested)}var navManager=getNavManager();if(navManager?navManager.addEventListener("backrequested",hardwareButtonBackPressed):_WinRT.Windows.Phone.UI.Input.HardwareButtons&&_WinRT.Windows.Phone.UI.Input.HardwareButtons.addEventListener("backpressed",hardwareButtonBackPressed),_WinRT.Windows.UI.Input.EdgeGesture){var edgy=_WinRT.Windows.UI.Input.EdgeGesture.getForCurrentView();edgy.addEventListener("starting",edgyStarting),edgy.addEventListener("completed",edgyCompleted),edgy.addEventListener("canceled",edgyCanceled)}}Promise.addEventListener("error",promiseErrorHandler)}}function unregister(){if(registered){if(registered=!1,_Global.removeEventListener("beforeunload",beforeUnloadHandler,!1),_Global.document){if(_WinRT.Windows.UI.WebUI.WebUIApplication){_Global.removeEventListener("error",errorHandler,!1);var wui=_WinRT.Windows.UI.WebUI.WebUIApplication;wui.removeEventListener("activated",activatedHandler,!1),wui.removeEventListener("suspending",suspendingHandler,!1)}if(_WinRT.Windows.UI.ApplicationSettings.SettingsPane){var settingsPane=_WinRT.Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView();settingsPane.removeEventListener("commandsrequested",commandsRequested)}var navManager=getNavManager();if(navManager?navManager.removeEventListener("backrequested",hardwareButtonBackPressed):_WinRT.Windows.Phone.UI.Input.HardwareButtons&&_WinRT.Windows.Phone.UI.Input.HardwareButtons.removeEventListener("backpressed",hardwareButtonBackPressed),_WinRT.Windows.UI.Input.EdgeGesture){var edgy=_WinRT.Windows.UI.Input.EdgeGesture.getForCurrentView();edgy.removeEventListener("starting",edgyStarting),edgy.removeEventListener("completed",edgyCompleted),edgy.removeEventListener("canceled",edgyCanceled)}}Promise.removeEventListener("error",promiseErrorHandler)}}_Global.Debug&&(_Global.Debug.setNonUserCodeExceptions=!0);var outstandingPromiseErrors,checkpointET="checkpoint",unloadET="unload",activatedET="activated",loadedET="loaded",readyET="ready",errorET="error",settingsET="settings",backClickET="backclick",beforeRequestingFocusOnKeyboardInputET="beforerequestingfocusonkeyboardinput",requestingFocusOnKeyboardInputET="requestingfocusonkeyboardinput",edgyStartingET="edgystarting",edgyCompletedET="edgycompleted",edgyCanceledET="edgycanceled",eventQueue=[],eventQueueJob=null,eventQueuedSignal=null,running=!1,registered=!1,Symbol=_Global.Symbol,isModern=!!Symbol&&"symbol"==typeof Symbol.iterator,ListenerType=_Base.Class.mix(_Base.Class.define(null,{},{supportedForProcessing:!1}),_Events.eventMixin),listeners=new ListenerType,createEvent=_Events._createEventProperty,pendingDeferrals={},pendingDeferralID=0,TypeToSearch={_registered:!1,updateRegistration:function(){var ls=listeners._listeners&&listeners._listeners[requestingFocusOnKeyboardInputET]||[];!TypeToSearch._registered&&ls.length>0&&(TypeToSearch._updateKeydownCaptureListeners(_Global.top,!0),TypeToSearch._registered=!0),TypeToSearch._registered&&0===ls.length&&(TypeToSearch._updateKeydownCaptureListeners(_Global.top,!1),TypeToSearch._registered=!1)},_keydownCaptureHandler:function(event){TypeToSearch._registered&&TypeToSearch._shouldKeyTriggerTypeToSearch(event)&&requestingFocusOnKeyboardInput()},_frameLoadCaptureHandler:function(event){TypeToSearch._registered&&TypeToSearch._updateKeydownCaptureListeners(event.target.contentWindow,!0)},_updateKeydownCaptureListeners:function(win,add){if(win){try{add?win.document.addEventListener("keydown",TypeToSearch._keydownCaptureHandler,!0):win.document.removeEventListener("keydown",TypeToSearch._keydownCaptureHandler,!0)}catch(e){}if(win.frames)for(var i=0,l=win.frames.length;l>i;i++){var childWin=win.frames[i];TypeToSearch._updateKeydownCaptureListeners(childWin,add);try{add?childWin.frameElement&&childWin.frameElement.addEventListener("load",TypeToSearch._frameLoadCaptureHandler,!0):childWin.frameElement&&childWin.frameElement.removeEventListener("load",TypeToSearch._frameLoadCaptureHandler,!0)}catch(e){}}}},_shouldKeyTriggerTypeToSearch:function(event){var shouldTrigger=!1;if(!event.metaKey&&(!event.ctrlKey&&!event.altKey||event.getModifierState&&event.getModifierState("AltGraph")))switch(event.keyCode){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 186:case 187:case 188:case 189:case 190:case 191:case 192:case 219:case 220:case 221:case 222:case 223:case 226:case 229:case 231:shouldTrigger=!0}return shouldTrigger}},terminateAppHandler=defaultTerminateAppHandler,builtInListeners={activated:[function(){queueEvent({type:readyET})}],checkpoint:[function(e){_State._oncheckpoint(e,exports)}],error:[function(e,handled){handled||fatalErrorHandler(e)}],backclick:[function(e,handled){handled?e._winRTBackPressedEvent.handled=!0:Navigation.canGoBack&&(Navigation.back(),e._winRTBackPressedEvent.handled=!0)}],beforerequestingfocusonkeyboardinput:[function(e,handled){handled||dispatchEvent({type:requestingFocusOnKeyboardInputET})}]};_Global.document&&_Global.document.addEventListener("DOMContentLoaded",domContentLoadedHandler,!1);var publicNS=_Base.Namespace._moduleDefine(exports,"WinJS.Application",{stop:function(){publicNS.onactivated=null,publicNS.oncheckpoint=null,publicNS.onerror=null,publicNS.onloaded=null,publicNS.onready=null,publicNS.onsettings=null,publicNS.onunload=null,publicNS.onbackclick=null,listeners=new ListenerType,_State.sessionState={},running=!1,copyAndClearQueue(),eventQueueJob&&eventQueueJob.cancel(),eventQueueJob=null,eventQueuedSignal=null,unregister(),TypeToSearch.updateRegistration(),cleanupAllPendingDeferrals()},addEventListener:function(eventType,listener,capture){listeners.addEventListener(eventType,listener,capture),eventType===requestingFocusOnKeyboardInputET&&TypeToSearch.updateRegistration()},removeEventListener:function(eventType,listener,capture){listeners.removeEventListener(eventType,listener,capture),eventType===requestingFocusOnKeyboardInputET&&TypeToSearch.updateRegistration()},checkpoint:function(){queueEvent({type:checkpointET})},start:function(){register(),running=!0,startEventQueue()},queueEvent:queueEvent,_dispatchEvent:dispatchEvent,_terminateApp:{get:function(){return terminateAppHandler},set:function(value){terminateAppHandler=value}},_applicationListener:_Base.Namespace._lazy(function(){return new _ElementUtilities._GenericListener("Application",publicNS)}),oncheckpoint:createEvent(checkpointET),onunload:createEvent(unloadET),onactivated:createEvent(activatedET),onloaded:createEvent(loadedET),onready:createEvent(readyET),onsettings:createEvent(settingsET),onerror:createEvent(errorET),onbackclick:createEvent(backClickET)})}),define("WinJS/Animations/_Constants",["exports","../Core/_Base"],function(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{PageNavigationAnimation:{turnstile:"turnstile",slide:"slide",enterPage:"enterPage",continuum:"continuum"}})}),define("WinJS/Animations/_TransitionAnimation",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Promise","../Scheduler","../Utilities/_ElementUtilities"],function(exports,_Global,_WinRT,_Base,_BaseUtils,Promise,Scheduler,_ElementUtilities){"use strict";function makeArray(elements){return Array.isArray(elements)||elements instanceof _Global.NodeList||elements instanceof _Global.HTMLCollection?elements:elements?[elements]:[]}function getUniqueKeyframeName(){return++keyframeCounter,"WinJSUIAnimation"+keyframeCounter}function isUniqueKeyframeName(s){return"WinJSUIAnimation"===s.substring(0,16)}function resolveStyles(elem){_ElementUtilities._getComputedStyle(elem,null).opacity}function copyWithEvaluation(iElem,elem){return function(obj){var newObj={};for(var p in obj){var v=obj[p];"function"==typeof v&&(v=v(iElem,elem)),newObj[p]=v}return newObj.exactTiming||(newObj.delay+=exports._libraryDelay),newObj}}function stopExistingAction(id,prop){var key=id+"|"+prop,finish=activeActions[key];finish&&finish(reason_interrupted)}function registerAction(id,prop,finish){activeActions[id+"|"+prop]=finish}function unregisterAction(id,prop){delete activeActions[id+"|"+prop]}function setTemporaryStyles(elem,id,style,actions,desc){var styleCache=desc.styleCaches[id]||new StyleCache(id,desc,style);styleCache.cref+=actions.length,actions.forEach(function(action){stopExistingAction(id,action.property)}),(desc.isTransition||actions.some(function(action){return styleCache.removed[action[desc.nameField]]}))&&(resolveStyles(elem),styleCache.removed={});var newShorthand=actions.map(function(action){return action[desc.nameField]+" "+desc.props.map(function(p){return(p[1]?action[p[1]]:"")+p[2]}).join(" ")}).join(", "),newNames=actions.map(function(action){return action[desc.nameField]}).join(", ");return""!==styleCache.names&&(newShorthand=styleCache.names+", "+newShorthand,newNames=styleCache.names+", "+newNames),style[desc.shorthandProp]=newShorthand,styleCache.names=newNames,styleCache}function completePromise(c,synchronous){synchronous?c():Scheduler.schedule(function(){c()},Scheduler.Priority.normal,null,"WinJS.UI._Animation._completeAnimationPromise")}function executeElementTransition(elem,index,transitions,promises,animate){if(transitions.length>0){var style=elem.style,id=_ElementUtilities._uniqueID(elem);if(uniformizeStyle||(uniformizeStyle=_Global.document.createElement("DIV").style),transitions=transitions.map(copyWithEvaluation(index,elem)),transitions.forEach(function(transition){var scriptNameOfProperty=_BaseUtils._getCamelCasedName(transition.property);transition.hasOwnProperty("from")&&(style[scriptNameOfProperty]=transition.from),uniformizeStyle[scriptNameOfProperty]=transition.to,transition.to=uniformizeStyle[scriptNameOfProperty],transition.propertyScriptName=scriptNameOfProperty}),animate){var styleCache=setTemporaryStyles(elem,id,style,transitions,elementTransitionProperties),listener=elem.disabled?_Global.document:elem;transitions.forEach(function(transition){var finish;promises.push(new Promise(function(c){finish=function(reason){onTransitionEnd&&(listener.removeEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd,!1),unregisterAction(id,transition.property),styleCache.removeName(style,transition.propertyScriptName,reason?elem:null,transition.skipStylesReset),_Global.clearTimeout(timeoutId),onTransitionEnd=null),completePromise(c,reason===reason_canceled)};var onTransitionEnd=function(event){event.target===elem&&event.propertyName===transition.property&&finish()};registerAction(id,transition.property,finish),listener.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd,!1);var padding=0;style[transition.propertyScriptName]!==transition.to&&(style[transition.propertyScriptName]=transition.to,padding=50);var timeoutId=_Global.setTimeout(function(){timeoutId=_Global.setTimeout(finish,transition.delay+transition.duration)},padding)},function(){finish(reason_canceled)}))})}else transitions.forEach(function(transition){style[transition.propertyScriptName]=transition.to})}}function executeElementAnimation(elem,index,anims,promises,animate){if(animate&&anims.length>0){var style=elem.style,id=_ElementUtilities._uniqueID(elem);anims=anims.map(copyWithEvaluation(index,elem));var styleElem,listener=elem.disabled?_Global.document:elem;anims.forEach(function(anim){if(anim.keyframe)anim.keyframe=browserStyleEquivalents.animationPrefix+anim.keyframe;else{styleElem||(styleElem=_Global.document.createElement("STYLE"),_Global.document.documentElement.appendChild(styleElem)),anim.keyframe=getUniqueKeyframeName();var kf="@"+browserStyleEquivalents.keyframes+" "+anim.keyframe+" { from {"+anim.property+":"+anim.from+";} to {"+anim.property+":"+anim.to+";}}";styleElem.sheet.insertRule(kf,0)}});var styleCache=setTemporaryStyles(elem,id,style,anims,elementAnimationProperties),animationsToCleanUp=[],animationPromises=[];anims.forEach(function(anim){var finish;animationPromises.push(new Promise(function(c){finish=function(reason){onAnimationEnd&&(listener.removeEventListener(_BaseUtils._browserEventEquivalents.animationEnd,onAnimationEnd,!1),_Global.clearTimeout(timeoutId),onAnimationEnd=null),completePromise(c,reason===reason_canceled)};var onAnimationEnd=function(event){event.target===elem&&event.animationName===anim.keyframe&&finish()};registerAction(id,anim.property,finish),animationsToCleanUp.push({id:id,property:anim.property,style:style,keyframe:anim.keyframe});var timeoutId=_Global.setTimeout(function(){timeoutId=_Global.setTimeout(finish,anim.delay+anim.duration)},50);listener.addEventListener(_BaseUtils._browserEventEquivalents.animationEnd,onAnimationEnd,!1)},function(){finish(reason_canceled)}))}),styleElem&&_Global.setTimeout(function(){var parentElement=styleElem.parentElement;parentElement&&parentElement.removeChild(styleElem)},50);var cleanupAnimations=function(){for(var i=0;i<animationsToCleanUp.length;i++){var anim=animationsToCleanUp[i];unregisterAction(anim.id,anim.property),styleCache.removeName(anim.style,anim.keyframe)}};promises.push(Promise.join(animationPromises).then(cleanupAnimations,cleanupAnimations))}}function initAnimations(){animationSettings||(animationSettings=_WinRT.Windows.UI.ViewManagement.UISettings?new _WinRT.Windows.UI.ViewManagement.UISettings:{animationsEnabled:!0})}function applyAction(element,action,execAction){try{for(var animate=exports.isAnimationEnabled(),elems=makeArray(element),actions=makeArray(action),promises=[],i=0;i<elems.length;i++)if(Array.isArray(elems[i]))for(var j=0;j<elems[i].length;j++)execAction(elems[i][j],i,actions,promises,animate);else execAction(elems[i],i,actions,promises,animate);return promises.length?Promise.join(promises):Scheduler.schedulePromiseNormal(null,"WinJS.UI._Animation._completeActionPromise").then(null,function(){})}catch(e){return Promise.wrapError(e)}}function adjustAnimationTime(animation){return Array.isArray(animation)?animation.map(function(animation){return adjustAnimationTime(animation)}):animation?(animation.delay=animationTimeAdjustment(animation.delay),animation.duration=animationTimeAdjustment(animation.duration),animation):void 0}function animationAdjustment(animation){return 1===animationFactor?animation:adjustAnimationTime(animation)}if(_Global.document){var uniformizeStyle,animationSettings,browserStyleEquivalents=_BaseUtils._browserStyleEquivalents,keyframeCounter=0,activeActions=[],reason_interrupted=1,reason_canceled=2,StyleCache=_Base.Class.define(function(id,desc,style){this.cref=0,this.id=id,this.desc=desc,this.removed={},this.prevStyles=desc.props.map(function(p){return style[p[0]]}),this.prevNames=this.names=style[desc.nameProp],desc.styleCaches[id]=this},{destroy:function(style,skipStylesReset){var desc=this.desc;delete desc.styleCaches[this.id],skipStylesReset||(""===this.prevNames&&this.prevStyles.every(function(s){return""===s})?style[desc.shorthandProp]="":(desc.props.forEach(function(p,i){style[p[0]]=this.prevStyles[i]},this),style[desc.nameProp]=this.prevNames))},removeName:function(style,name,elem,skipStylesReset){var nameValue=this.names,names=nameValue.split(", "),index=names.lastIndexOf(name);index>=0&&(names.splice(index,1),this.names=nameValue=names.join(", "),""===nameValue&&this.desc.isTransition&&(nameValue="none")),--this.cref?(style[this.desc.nameProp]=nameValue,isUniqueKeyframeName(name)||(this.removed[name]=!0)):(elem&&"none"===nameValue&&(style[this.desc.nameProp]=nameValue,resolveStyles(elem)),this.destroy(style,skipStylesReset))}}),elementTransitionProperties={shorthandProp:browserStyleEquivalents.transition.scriptName,nameProp:browserStyleEquivalents["transition-property"].scriptName,nameField:"property",props:[[browserStyleEquivalents["transition-duration"].scriptName,"duration","ms"],[browserStyleEquivalents["transition-timing-function"].scriptName,"timing",""],[browserStyleEquivalents["transition-delay"].scriptName,"delay","ms"]],isTransition:!0,styleCaches:[]},elementAnimationProperties={shorthandProp:browserStyleEquivalents.animation.scriptName,nameProp:browserStyleEquivalents["animation-name"].scriptName,nameField:"keyframe",props:[[browserStyleEquivalents["animation-duration"].scriptName,"duration","ms"],[browserStyleEquivalents["animation-timing-function"].scriptName,"timing",""],[browserStyleEquivalents["animation-delay"].scriptName,"delay","ms"],[browserStyleEquivalents["animation-iteration-count"].scriptName,"","1"],[browserStyleEquivalents["animation-direction"].scriptName,"","normal"],[browserStyleEquivalents["animation-fill-mode"].scriptName,"","both"]],isTransition:!1,styleCaches:[]},enableCount=0,isAnimationEnabled=function(){return initAnimations(),enableCount+animationSettings.animationsEnabled>0},animationTimeAdjustment=function(v){return v*animationFactor},animationFactor=1,libraryDelay=0;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{disableAnimations:function(){enableCount--},enableAnimations:function(){enableCount++},isAnimationEnabled:{get:function(){return isAnimationEnabled},set:function(value){isAnimationEnabled=value}},_libraryDelay:{get:function(){return libraryDelay},set:function(value){libraryDelay=value}},executeAnimation:function(element,animation){return applyAction(element,animationAdjustment(animation),executeElementAnimation)},executeTransition:function(element,transition){return applyAction(element,animationAdjustment(transition),executeElementTransition)},_animationTimeAdjustment:{get:function(){return animationTimeAdjustment},set:function(value){animationTimeAdjustment=value}}}),_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{_fastAnimations:{get:function(){return.05===animationFactor},set:function(value){animationFactor=value?.05:1}},_slowAnimations:{get:function(){return 3===animationFactor},set:function(value){animationFactor=value?3:1}},_animationFactor:{get:function(){return animationFactor},set:function(value){animationFactor=value}}})}}),define("WinJS/Animations",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_WriteProfilerMark","./Utilities/_ElementUtilities","./Animations/_Constants","./Animations/_TransitionAnimation","./Promise"],function(exports,_Global,_Base,_BaseUtils,_WriteProfilerMark,_ElementUtilities,_Constants,_TransitionAnimation,Promise){"use strict";function checkKeyframe(offset,defOffset,keyframe){return offset.keyframe?offset.keyframe:!keyframe||offset.left!==defOffset.left||offset.top!==defOffset.top||offset.rtlflip&&!defOffset.rtlflip?null:offset.rtlflip?keyframeCallback(keyframe):keyframe}function chooseKeyframe(defOffset,keyframe){return keyframe&&defOffset.rtlflip?keyframeCallback(keyframe):keyframe}function keyframeCallback(keyframe){var keyframeRtl=keyframe+"-rtl";return function(i,elem){return"ltr"===_ElementUtilities._getComputedStyle(elem).direction?keyframe:keyframeRtl}}function makeArray(elements){return Array.isArray(elements)||elements instanceof _Global.NodeList||elements instanceof _Global.HTMLCollection?elements:elements?[elements]:[]}function collectOffsetArray(elemArray){for(var offsetArray=[],i=0;i<elemArray.length;i++){var offset={top:elemArray[i].offsetTop,left:elemArray[i].offsetLeft},matrix=_ElementUtilities._getComputedStyle(elemArray[i],null)[transformNames.scriptName].split(",");6===matrix.length&&(offset.left+=parseFloat(matrix[4]),offset.top+=parseFloat(matrix[5])),offsetArray.push(offset)}return offsetArray}function staggerDelay(initialDelay,extraDelay,delayFactor,delayCap){return function(i){for(var ret=initialDelay,j=0;i>j;j++)extraDelay*=delayFactor,ret+=extraDelay;return delayCap&&(ret=Math.min(ret,delayCap)),ret}}function makeOffsetsRelative(elemArray,offsetArray){for(var i=0;i<offsetArray.length;i++)offsetArray[i].top-=elemArray[i].offsetTop,offsetArray[i].left-=elemArray[i].offsetLeft}function animTranslate2DTransform(elemArray,offsetArray,transition){makeOffsetsRelative(elemArray,offsetArray);for(var i=0;i<elemArray.length;i++)(0!==offsetArray[i].top||0!==offsetArray[i].left)&&(elemArray[i].style[transformNames.scriptName]="translate("+offsetArray[i].left+"px, "+offsetArray[i].top+"px)");return _TransitionAnimation.executeTransition(elemArray,transition)}function animStaggeredSlide(curve,start,end,fadeIn,page,first,second,third){function prepareSlide(elements,start,end){if(elements){var startOffset={left:start+"px",top:"0px"},endOffset={left:end+"px",top:"0px"};if(+elements.length===elements.length)for(var i=0,len=elements.length;len>i;i++)elementArray.push(elements[i]),startOffsetArray.push(startOffset),endOffsetArray.push(endOffset);else elementArray.push(elements),startOffsetArray.push(startOffset),endOffsetArray.push(endOffset)}}var elementArray=[],startOffsetArray=[],endOffsetArray=[],horizontalOffset=200,startOffset=0!==start?0>start?-horizontalOffset:horizontalOffset:0,endOffset=0!==end?0>end?-horizontalOffset:horizontalOffset:0;return prepareSlide(page,start,end),prepareSlide(first,startOffset,endOffset),prepareSlide(second,2*startOffset,2*endOffset),prepareSlide(third,3*startOffset,3*endOffset),startOffsetArray=new OffsetArray(startOffsetArray),endOffsetArray=new OffsetArray(endOffsetArray),_TransitionAnimation.executeTransition(elementArray,[{property:transformNames.cssName,delay:0,duration:350,timing:curve,from:translateCallback(startOffsetArray),to:translateCallback(endOffsetArray)},{property:"opacity",delay:0,duration:350,timing:fadeIn?"steps(1, start)":"steps(1, end)",from:fadeIn?0:1,to:fadeIn?1:0}])}function animRotationTransform(elemArray,origins,transition){function onComplete(){clearAnimRotationTransform(elemArray)}elemArray=makeArray(elemArray),origins=makeArray(origins);for(var i=0,len=elemArray.length;len>i;i++){var rtl="rtl"===_ElementUtilities._getComputedStyle(elemArray[i]).direction;
elemArray[i].style[_BaseUtils._browserStyleEquivalents["transform-origin"].scriptName]=origins[Math.min(origins.length-1,i)][rtl?"rtl":"ltr"]}return _TransitionAnimation.executeTransition(elemArray,transition).then(onComplete,onComplete)}function clearAnimRotationTransform(elemArray){for(var i=0,len=elemArray.length;len>i;i++)elemArray[i].style[_BaseUtils._browserStyleEquivalents["transform-origin"].scriptName]="",elemArray[i].style[transformNames.scriptName]="",elemArray[i].style.opacity=""}function translateCallback(offsetArray,prefix){return prefix=prefix||"",function(i,elem){var offset=offsetArray.getOffset(i),left=offset.left;return offset.rtlflip&&"rtl"===_ElementUtilities._getComputedStyle(elem).direction&&(left=left.toString(),left="-"===left.charAt(0)?left.substring(1):"-"+left),prefix+"translate("+left+", "+offset.top+")"}}function translateCallbackAnimate(offsetArray,suffix){return suffix=suffix||"",function(i){var offset=offsetArray[i];return"translate("+offset.left+"px, "+offset.top+"px) "+suffix}}function keyframeCallbackAnimate(offsetArray,keyframe){return function(i){var offset=offsetArray[i];return 0===offset.left&&0===offset.top?keyframe:null}}function layoutTransition(LayoutTransition,target,affected,extra){var targetArray=makeArray(target),affectedArray=makeArray(affected),offsetArray=collectOffsetArray(affectedArray);return new LayoutTransition(targetArray,affectedArray,offsetArray,extra)}function collectTurnstileTransformOrigins(elements){for(var origins=[],i=0,len=elements.length;len>i;i++){var itemBoundingBox=elements[i].getBoundingClientRect(),offsetLeftLTR=-(40+itemBoundingBox.left),offsetLeftRTL=40+(_Global.innerWidth-itemBoundingBox.right),totalOffsetY=_Global.innerHeight/2-itemBoundingBox.top;origins.push({ltr:offsetLeftLTR+"px "+totalOffsetY+"px",rtl:offsetLeftRTL+"px "+totalOffsetY+"px"})}return origins}function writeAnimationProfilerMark(text){_WriteProfilerMark("WinJS.UI.Animation:"+text)}function transformWithTransition(element,transition){var duration=transition.duration*_TransitionAnimation._animationFactor,transitionProperty=_BaseUtils._browserStyleEquivalents.transition.scriptName;element.style[transitionProperty]=duration+"ms "+transformNames.cssName+" "+transition.timing,element.style[transformNames.scriptName]=transition.to;var finish;return new Promise(function(c){var onTransitionEnd=function(eventObject){eventObject.target===element&&eventObject.propertyName===transformNames.cssName&&finish()},didFinish=!1;finish=function(){didFinish||(_Global.clearTimeout(timeoutId),element.removeEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd),element.style[transitionProperty]="",didFinish=!0),c()};var timeoutId=_Global.setTimeout(function(){timeoutId=_Global.setTimeout(finish,duration)},50);element.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd)},function(){finish()})}function getResizeDefaultTransitions(){return{defaultResizeGrowTransition:{duration:350,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)"},defaultResizeShrinkTransition:{duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)"}}}function resizeTransition(elementClipper,element,args){var defaultTransition=getResizeDefaultTransitions()[args.to>args.from?"defaultResizeGrowTransition":"defaultResizeShrinkTransition"];args=_BaseUtils._merge(args,{duration:void 0===args.duration?defaultTransition.duration:args.duration,timing:void 0===args.timing?defaultTransition.timing:args.timing});var start=args.actualSize-args.from,end=args.actualSize-args.to;args.anchorTrailingEdge||(start=-start,end=-end);var translate="width"===args.dimension?"translateX":"translateY",transition={duration:args.duration,timing:args.timing};elementClipper.style[transformNames.scriptName]=translate+"("+start+"px)",element.style[transformNames.scriptName]=translate+"("+-start+"px)",_ElementUtilities._getComputedStyle(elementClipper).opacity,_ElementUtilities._getComputedStyle(element).opacity;var clipperTransition=_BaseUtils._merge(transition,{to:translate+"("+end+"px)"}),elementTransition=_BaseUtils._merge(transition,{to:translate+"("+-end+"px)"});return[{element:elementClipper,transition:clipperTransition},{element:element,transition:elementTransition}]}var transformNames=_BaseUtils._browserStyleEquivalents.transform,defaultOffset=[{top:"0px",left:"11px",rtlflip:!0}],OffsetArray=_Base.Class.define(function(offset,keyframe,defOffset){defOffset=defOffset||defaultOffset,Array.isArray(offset)&&offset.length>0?(this.offsetArray=offset,1===offset.length&&(this.keyframe=checkKeyframe(offset[0],defOffset[0],keyframe))):offset&&offset.hasOwnProperty("top")&&offset.hasOwnProperty("left")?(this.offsetArray=[offset],this.keyframe=checkKeyframe(offset,defOffset[0],keyframe)):(this.offsetArray=defOffset,this.keyframe=chooseKeyframe(defOffset[0],keyframe))},{getOffset:function(i){return i>=this.offsetArray.length&&(i=this.offsetArray.length-1),this.offsetArray[i]}},{supportedForProcessing:!1}),ExpandAnimation=_Base.Class.define(function(revealedArray,affectedArray,offsetArray){this.revealedArray=revealedArray,this.affectedArray=affectedArray,this.offsetArray=offsetArray},{execute:function(){writeAnimationProfilerMark("expandAnimation,StartTM");var promise1=_TransitionAnimation.executeAnimation(this.revealedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?200:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}),promise2=animTranslate2DTransform(this.affectedArray,this.offsetArray,{property:transformNames.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("expandAnimation,StopTM")})}},{supportedForProcessing:!1}),CollapseAnimation=_Base.Class.define(function(hiddenArray,affectedArray,offsetArray){this.hiddenArray=hiddenArray,this.affectedArray=affectedArray,this.offsetArray=offsetArray},{execute:function(){writeAnimationProfilerMark("collapseAnimation,StartTM");var promise1=_TransitionAnimation.executeAnimation(this.hiddenArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0}),promise2=animTranslate2DTransform(this.affectedArray,this.offsetArray,{property:transformNames.cssName,delay:this.hiddenArray.length>0?167:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("collapseAnimation,StopTM")})}},{supportedForProcessing:!1}),RepositionAnimation=_Base.Class.define(function(target,elementArray,offsetArray){this.elementArray=elementArray,this.offsetArray=offsetArray},{execute:function(){return writeAnimationProfilerMark("repositionAnimation,StartTM"),animTranslate2DTransform(this.elementArray,this.offsetArray,{property:transformNames.cssName,delay:staggerDelay(0,33,1,250),duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){writeAnimationProfilerMark("repositionAnimation,StopTM")})}},{supportedForProcessing:!1}),AddToListAnimation=_Base.Class.define(function(addedArray,affectedArray,offsetArray){this.addedArray=addedArray,this.affectedArray=affectedArray,this.offsetArray=offsetArray},{execute:function(){writeAnimationProfilerMark("addToListAnimation,StartTM");var delay=this.affectedArray.length>0?240:0,promise1=_TransitionAnimation.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:transformNames.cssName,delay:delay,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:delay,duration:120,timing:"linear",from:0,to:1}]),promise2=animTranslate2DTransform(this.affectedArray,this.offsetArray,{property:transformNames.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("addToListAnimation,StopTM")})}},{supportedForProcessing:!1}),DeleteFromListAnimation=_Base.Class.define(function(deletedArray,remainingArray,offsetArray){this.deletedArray=deletedArray,this.remainingArray=remainingArray,this.offsetArray=offsetArray},{execute:function(){writeAnimationProfilerMark("deleteFromListAnimation,StartTM");var promise1=_TransitionAnimation.executeAnimation(this.deletedArray,[{keyframe:"WinJS-scale-down",property:transformNames.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:"none",to:"scale(0.85)"},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]),promise2=animTranslate2DTransform(this.remainingArray,this.offsetArray,{property:transformNames.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("deleteFromListAnimation,StopTM")})}},{supportedForProcessing:!1}),_UpdateListAnimation=_Base.Class.define(function(addedArray,affectedArray,offsetArray,deleted){this.addedArray=addedArray,this.affectedArray=affectedArray,this.offsetArray=offsetArray;var deletedArray=makeArray(deleted);this.deletedArray=deletedArray,this.deletedOffsetArray=collectOffsetArray(deletedArray)},{execute:function(){writeAnimationProfilerMark("_updateListAnimation,StartTM"),makeOffsetsRelative(this.deletedArray,this.deletedOffsetArray);var delay=0,promise1=_TransitionAnimation.executeAnimation(this.deletedArray,[{keyframe:keyframeCallbackAnimate(this.deletedOffsetArray,"WinJS-scale-down"),property:transformNames.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:translateCallbackAnimate(this.deletedOffsetArray),to:translateCallbackAnimate(this.deletedOffsetArray,"scale(0.85)")},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]);this.deletedArray.length>0&&(delay+=60);var promise2=animTranslate2DTransform(this.affectedArray,this.offsetArray,{property:transformNames.cssName,delay:delay,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});this.affectedArray.length>0?delay+=240:delay&&(delay+=60);var promise3=_TransitionAnimation.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:transformNames.cssName,delay:delay,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:delay,duration:120,timing:"linear",from:0,to:1}]);return Promise.join([promise1,promise2,promise3]).then(function(){writeAnimationProfilerMark("_updateListAnimation,StopTM")})}},{supportedForProcessing:!1}),AddToSearchListAnimation=_Base.Class.define(function(addedArray,affectedArray,offsetArray){this.addedArray=addedArray,this.affectedArray=affectedArray,this.offsetArray=offsetArray},{execute:function(){writeAnimationProfilerMark("addToSearchListAnimation,StartTM");var promise1=_TransitionAnimation.executeAnimation(this.addedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?240:0,duration:117,timing:"linear",from:0,to:1}),promise2=animTranslate2DTransform(this.affectedArray,this.offsetArray,{property:transformNames.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("addToSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),DeleteFromSearchListAnimation=_Base.Class.define(function(deletedArray,remainingArray,offsetArray){this.deletedArray=deletedArray,this.remainingArray=remainingArray,this.offsetArray=offsetArray},{execute:function(){writeAnimationProfilerMark("deleteFromSearchListAnimation,StartTM");var promise1=_TransitionAnimation.executeAnimation(this.deletedArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:93,timing:"linear",from:1,to:0}),promise2=animTranslate2DTransform(this.remainingArray,this.offsetArray,{property:transformNames.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("deleteFromSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),PeekAnimation=_Base.Class.define(function(target,elementArray,offsetArray){this.elementArray=elementArray,this.offsetArray=offsetArray},{execute:function(){return writeAnimationProfilerMark("peekAnimation,StartTM"),animTranslate2DTransform(this.elementArray,this.offsetArray,{property:transformNames.cssName,delay:0,duration:2e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){writeAnimationProfilerMark("peekAnimation,StopTM")})}},{supportedForProcessing:!1});_Base.Namespace._moduleDefine(exports,"WinJS.UI.Animation",{createExpandAnimation:function(revealed,affected){return layoutTransition(ExpandAnimation,revealed,affected)},createCollapseAnimation:function(hidden,affected){return layoutTransition(CollapseAnimation,hidden,affected)},createRepositionAnimation:function(element){return layoutTransition(RepositionAnimation,null,element)},fadeIn:function(shown){return writeAnimationProfilerMark("fadeIn,StartTM"),_TransitionAnimation.executeTransition(shown,{property:"opacity",delay:0,duration:250,timing:"linear",from:0,to:1}).then(function(){writeAnimationProfilerMark("fadeIn,StopTM")})},fadeOut:function(hidden){return writeAnimationProfilerMark("fadeOut,StartTM"),_TransitionAnimation.executeTransition(hidden,{property:"opacity",delay:0,duration:167,timing:"linear",to:0}).then(function(){writeAnimationProfilerMark("fadeOut,StopTM")})},createAddToListAnimation:function(added,affected){return layoutTransition(AddToListAnimation,added,affected)},createDeleteFromListAnimation:function(deleted,remaining){return layoutTransition(DeleteFromListAnimation,deleted,remaining)},_createUpdateListAnimation:function(added,deleted,affected){return layoutTransition(_UpdateListAnimation,added,affected,deleted)},createAddToSearchListAnimation:function(added,affected){return layoutTransition(AddToSearchListAnimation,added,affected)},createDeleteFromSearchListAnimation:function(deleted,remaining){return layoutTransition(DeleteFromSearchListAnimation,deleted,remaining)},showEdgeUI:function(element,offset,options){writeAnimationProfilerMark("showEdgeUI,StartTM");var isTransition=options&&"transition"===options.mechanism,offsetArray=new OffsetArray(offset,"WinJS-showEdgeUI",[{top:"-70px",left:"0px"}]);return _TransitionAnimation[isTransition?"executeTransition":"executeAnimation"](element,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:isTransition?translateCallback(offsetArray):offsetArray.keyframe||translateCallback(offsetArray),to:"none"}).then(function(){writeAnimationProfilerMark("showEdgeUI,StopTM")})},showPanel:function(element,offset){writeAnimationProfilerMark("showPanel,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-showPanel",[{top:"0px",left:"364px",rtlflip:!0}]);return _TransitionAnimation.executeAnimation(element,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:offsetArray.keyframe||translateCallback(offsetArray),to:"none"}).then(function(){writeAnimationProfilerMark("showPanel,StopTM")})},hideEdgeUI:function(element,offset,options){writeAnimationProfilerMark("hideEdgeUI,StartTM");var isTransition=options&&"transition"===options.mechanism,offsetArray=new OffsetArray(offset,"WinJS-hideEdgeUI",[{top:"-70px",left:"0px"}]);return _TransitionAnimation[isTransition?"executeTransition":"executeAnimation"](element,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:isTransition?translateCallback(offsetArray):offsetArray.keyframe||translateCallback(offsetArray)}).then(function(){writeAnimationProfilerMark("hideEdgeUI,StopTM")})},hidePanel:function(element,offset){writeAnimationProfilerMark("hidePanel,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-hidePanel",[{top:"0px",left:"364px",rtlflip:!0}]);return _TransitionAnimation.executeAnimation(element,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:offsetArray.keyframe||translateCallback(offsetArray)}).then(function(){writeAnimationProfilerMark("hidePanel,StopTM")})},showPopup:function(element,offset){writeAnimationProfilerMark("showPopup,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-showPopup",[{top:"50px",left:"0px"}]);return _TransitionAnimation.executeAnimation(element,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:83,duration:83,timing:"linear",from:0,to:1},{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:offsetArray.keyframe||translateCallback(offsetArray),to:"none"}]).then(function(){writeAnimationProfilerMark("showPopup,StopTM")})},hidePopup:function(element){return writeAnimationProfilerMark("hidePopup,StartTM"),_TransitionAnimation.executeAnimation(element,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:83,timing:"linear",from:1,to:0}).then(function(){writeAnimationProfilerMark("hidePopup,StopTM")})},pointerDown:function(element){return writeAnimationProfilerMark("pointerDown,StartTM"),_TransitionAnimation.executeTransition(element,{property:transformNames.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.975, 0.975)"}).then(function(){writeAnimationProfilerMark("pointerDown,StopTM")})},pointerUp:function(element){return writeAnimationProfilerMark("pointerUp,StartTM"),_TransitionAnimation.executeTransition(element,{property:transformNames.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){writeAnimationProfilerMark("pointerUp,StopTM")})},dragSourceStart:function(dragSource,affected){writeAnimationProfilerMark("dragSourceStart,StartTM");var promise1=_TransitionAnimation.executeTransition(dragSource,[{property:transformNames.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(1.05)"},{property:"opacity",delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:.65}]),promise2=_TransitionAnimation.executeTransition(affected,{property:transformNames.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("dragSourceStart,StopTM")})},dragSourceEnd:function(dragSource,offset,affected){writeAnimationProfilerMark("dragSourceEnd,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-dragSourceEnd"),promise1=_TransitionAnimation.executeTransition(dragSource,[{property:transformNames.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""},{property:"opacity",delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:1}]),promise2=_TransitionAnimation.executeAnimation(dragSource,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:offsetArray.keyframe||translateCallback(offsetArray,"scale(1.05) "),to:"none"}),promise3=_TransitionAnimation.executeTransition(affected,{property:transformNames.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return Promise.join([promise1,promise2,promise3]).then(function(){writeAnimationProfilerMark("dragSourceEnd,StopTM")})},enterContent:function(incoming,offset,options){writeAnimationProfilerMark("enterContent,StartTM");var animationPromise,offsetArray=new OffsetArray(offset,"WinJS-enterContent",[{top:"28px",left:"0px",rtlflip:!1}]);if(options&&"transition"===options.mechanism)animationPromise=_TransitionAnimation.executeTransition(incoming,[{property:transformNames.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:translateCallback(offsetArray),to:"none"},{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}]);else{var promise1=_TransitionAnimation.executeAnimation(incoming,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:offsetArray.keyframe||translateCallback(offsetArray),to:"none"}),promise2=_TransitionAnimation.executeTransition(incoming,{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});animationPromise=Promise.join([promise1,promise2])}return animationPromise.then(function(){writeAnimationProfilerMark("enterContent,StopTM")})},exitContent:function(outgoing,offset){writeAnimationProfilerMark("exitContent,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-exit",[{top:"0px",left:"0px"}]),promise1=_TransitionAnimation.executeAnimation(outgoing,offset&&{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:117,timing:"linear",from:"none",to:offsetArray.keyframe||translateCallback(offsetArray)}),promise2=_TransitionAnimation.executeTransition(outgoing,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("exitContent,StopTM")})},dragBetweenEnter:function(target,offset){writeAnimationProfilerMark("dragBetweenEnter,StartTM");var offsetArray=new OffsetArray(offset,null,[{top:"-40px",left:"0px"},{top:"40px",left:"0px"}]);return _TransitionAnimation.executeTransition(target,{property:transformNames.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:translateCallback(offsetArray,"scale(0.95) ")}).then(function(){writeAnimationProfilerMark("dragBetweenEnter,StopTM")})},dragBetweenLeave:function(target){return writeAnimationProfilerMark("dragBetweenLeave,StartTM"),_TransitionAnimation.executeTransition(target,{property:transformNames.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"}).then(function(){writeAnimationProfilerMark("dragBetweenLeave,StopTM")})},swipeSelect:function(selected,selection){writeAnimationProfilerMark("swipeSelect,StartTM");var promise1=_TransitionAnimation.executeTransition(selected,{property:transformNames.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),promise2=_TransitionAnimation.executeAnimation(selection,{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("swipeSelect,StopTM")})},swipeDeselect:function(deselected,selection){writeAnimationProfilerMark("swipeDeselect,StartTM");var promise1=_TransitionAnimation.executeTransition(deselected,{property:transformNames.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),promise2=_TransitionAnimation.executeAnimation(selection,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("swipeDeselect,StopTM")})},swipeReveal:function(target,offset){writeAnimationProfilerMark("swipeReveal,StartTM");var offsetArray=new OffsetArray(offset,null,[{top:"25px",left:"0px"}]);return _TransitionAnimation.executeTransition(target,{property:transformNames.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:translateCallback(offsetArray)}).then(function(){writeAnimationProfilerMark("swipeReveal,StopTM")})},enterPage:function(element,offset){writeAnimationProfilerMark("enterPage,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-enterPage",[{top:"28px",left:"0px",rtlflip:!1}]),promise1=_TransitionAnimation.executeAnimation(element,{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:staggerDelay(0,83,1,333),duration:1e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:offsetArray.keyframe||translateCallback(offsetArray),to:"none"}),promise2=_TransitionAnimation.executeTransition(element,{property:"opacity",delay:staggerDelay(0,83,1,333),duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("enterPage,StopTM")})},exitPage:function(outgoing,offset){writeAnimationProfilerMark("exitPage,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-exit",[{top:"0px",left:"0px"}]),promise1=_TransitionAnimation.executeAnimation(outgoing,offset&&{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:117,timing:"linear",from:"none",to:offsetArray.keyframe||translateCallback(offsetArray)}),promise2=_TransitionAnimation.executeTransition(outgoing,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("exitPage,StopTM")})},crossFade:function(incoming,outgoing){writeAnimationProfilerMark("crossFade,StartTM");var promise1=_TransitionAnimation.executeTransition(incoming,{property:"opacity",delay:0,duration:167,timing:"linear",to:1}),promise2=_TransitionAnimation.executeTransition(outgoing,{property:"opacity",delay:0,duration:167,timing:"linear",to:0});return Promise.join([promise1,promise2]).then(function(){writeAnimationProfilerMark("crossFade,StopTM")})},createPeekAnimation:function(element){return layoutTransition(PeekAnimation,null,element)},updateBadge:function(incoming,offset){writeAnimationProfilerMark("updateBadge,StartTM");var offsetArray=new OffsetArray(offset,"WinJS-updateBadge",[{top:"24px",left:"0px"}]);return _TransitionAnimation.executeAnimation(incoming,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1},{keyframe:offsetArray.keyframe,property:transformNames.cssName,delay:0,duration:1333,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:offsetArray.keyframe||translateCallback(offsetArray),to:"none"}]).then(function(){writeAnimationProfilerMark("updateBadge,StopTM")})},turnstileForwardIn:function(incomingElements){writeAnimationProfilerMark("turnstileForwardIn,StartTM"),incomingElements=makeArray(incomingElements);var origins=collectTurnstileTransformOrigins(incomingElements);return animRotationTransform(incomingElements,origins,[{property:transformNames.cssName,delay:staggerDelay(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(80deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:staggerDelay(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){writeAnimationProfilerMark("turnstileForwardIn,StopTM")})},turnstileForwardOut:function(outgoingElements){writeAnimationProfilerMark("turnstileForwardOut,StartTM"),outgoingElements=makeArray(outgoingElements);var origins=collectTurnstileTransformOrigins(outgoingElements);return animRotationTransform(outgoingElements,origins,[{property:transformNames.cssName,delay:staggerDelay(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(600px) rotateY(0deg)",to:"perspective(600px) rotateY(-50deg)"},{property:"opacity",delay:staggerDelay(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){writeAnimationProfilerMark("turnstileForwardOut,StopTM")})},turnstileBackwardIn:function(incomingElements){writeAnimationProfilerMark("turnstileBackwardIn,StartTM"),incomingElements=makeArray(incomingElements);var origins=collectTurnstileTransformOrigins(incomingElements);return animRotationTransform(incomingElements,origins,[{property:transformNames.cssName,delay:staggerDelay(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(-50deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:staggerDelay(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){writeAnimationProfilerMark("turnstileBackwardIn,StopTM")})},turnstileBackwardOut:function(outgoingElements){writeAnimationProfilerMark("turnstileBackwardOut,StartTM"),outgoingElements=makeArray(outgoingElements);var origins=collectTurnstileTransformOrigins(outgoingElements);return animRotationTransform(outgoingElements,origins,[{property:transformNames.cssName,delay:staggerDelay(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(800px) rotateY(0deg)",to:"perspective(800px) rotateY(80deg)"},{property:"opacity",delay:staggerDelay(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){writeAnimationProfilerMark("turnstileBackwardOut,StopTM")})},slideDown:function(outgoingElements){return writeAnimationProfilerMark("slideDown,StartTM"),animRotationTransform(outgoingElements,{ltr:"",rtl:""},[{property:transformNames.cssName,delay:0,duration:250,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"translate(0px, 0px)",to:"translate(0px, 200px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){writeAnimationProfilerMark("slideDown,StopTM")})},slideUp:function(incomingElements){return writeAnimationProfilerMark("slideUp,StartTM"),animRotationTransform(incomingElements,{ltr:"",rtl:""},[{property:transformNames.cssName,delay:0,duration:350,timing:"cubic-bezier(0.17,0.79,0.215,1.0025)",from:"translate(0px, 200px)",to:"translate(0px, 0px)"},{property:"opacity",delay:staggerDelay(0,34,1,1e3),duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){writeAnimationProfilerMark("slideUp,StopTM")})},slideRightIn:function(page,firstIncomingElements,secondIncomingElements,thirdIncomingElements){return writeAnimationProfilerMark("slideRightIn,StartTM"),animStaggeredSlide("cubic-bezier(0.17,0.79,0.215,1.0025)",-_Global.innerWidth,0,!0,page,firstIncomingElements,secondIncomingElements,thirdIncomingElements).then(function(){writeAnimationProfilerMark("slideRightIn,StopTM")})},slideRightOut:function(page,firstOutgoingElements,secondOutgoingElements,thirdOutgoingElements){return writeAnimationProfilerMark("slideRightOut,StartTM"),animStaggeredSlide("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,_Global.innerWidth,!1,page,firstOutgoingElements,secondOutgoingElements,thirdOutgoingElements).then(function(){writeAnimationProfilerMark("slideRightOut,StopTM")})},slideLeftIn:function(page,firstIncomingElements,secondIncomingElements,thirdIncomingElements){return writeAnimationProfilerMark("slideLeftIn,StartTM"),animStaggeredSlide("cubic-bezier(0.17,0.79,0.215,1.0025)",_Global.innerWidth,0,!0,page,firstIncomingElements,secondIncomingElements,thirdIncomingElements).then(function(){writeAnimationProfilerMark("slideLeftIn,StopTM")})},slideLeftOut:function(page,firstOutgoingElements,secondOutgoingElements,thirdOutgoingElements){return writeAnimationProfilerMark("slideLeftOut,StartTM"),animStaggeredSlide("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,-_Global.innerWidth,!1,page,firstOutgoingElements,secondOutgoingElements,thirdOutgoingElements).then(function(){writeAnimationProfilerMark("slideLeftOut,StopTM")})},continuumForwardIn:function(incomingPage,incomingItemRoot,incomingItemContent){return writeAnimationProfilerMark("continuumForwardIn,StartTM"),Promise.join([_TransitionAnimation.executeTransition(incomingPage,[{property:transformNames.cssName,delay:0,duration:350,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(0.5, 0.5)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),_TransitionAnimation.executeTransition(incomingItemRoot,[{property:transformNames.cssName,delay:0,duration:350,timing:"cubic-bezier(0.24,1.15,0.11,1.1575)",from:"translate(0px, 225px)",to:"translate(0px, 0px)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",
from:0,to:1}]),animRotationTransform(incomingItemContent,{ltr:"0px 50%",rtl:"100% 50%"},[{property:transformNames.cssName,delay:0,duration:350,timing:"cubic-bezier(0,0.62,0.8225,0.9625)",from:"rotateX(80deg) scale(1.5, 1.5)",to:"rotateX(0deg) scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){writeAnimationProfilerMark("continuumForwardIn,StopTM")})},continuumForwardOut:function(outgoingPage,outgoingItem){return writeAnimationProfilerMark("continuumForwardOut,StartTM"),Promise.join([_TransitionAnimation.executeTransition(outgoingPage,[{property:transformNames.cssName,delay:0,duration:120,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(1.1, 1.1)"},{property:"opacity",delay:0,duration:120,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]),animRotationTransform(outgoingItem,{ltr:"0px 100%",rtl:"100% 100%"},[{property:transformNames.cssName,delay:0,duration:152,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"rotateX(0deg) scale(1.0, 1.0) translate(0px, 0px)",to:"rotateX(80deg) scale(1.5, 1.5) translate(0px, 150px)"},{property:"opacity",delay:0,duration:152,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}])]).then(function(){writeAnimationProfilerMark("continuumForwardOut,StopTM")})},continuumBackwardIn:function(incomingPage,incomingItem){return writeAnimationProfilerMark("continuumBackwardIn,StartTM"),Promise.join([_TransitionAnimation.executeTransition(incomingPage,[{property:transformNames.cssName,delay:0,duration:200,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(1.25, 1.25)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:200,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),animRotationTransform(incomingItem,{ltr:"0px 50%",rtl:"100% 50%"},[{property:transformNames.cssName,delay:0,duration:250,timing:"cubic-bezier(0.2975, 0.7325, 0.4725, 0.99)",from:"rotateX(80deg) translate(0px, -100px)",to:"rotateX(0deg) translate(0px, 0px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){writeAnimationProfilerMark("continuumBackwardIn,StopTM")})},continuumBackwardOut:function(outgoingPage){return writeAnimationProfilerMark("continuumBackwardOut,StartTM"),_TransitionAnimation.executeTransition(outgoingPage,[{property:transformNames.cssName,delay:0,duration:167,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(0.5, 0.5)"},{property:"opacity",delay:0,duration:167,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){writeAnimationProfilerMark("continuumBackwardOut,StopTM")})},drillInIncoming:function(incomingPage){return writeAnimationProfilerMark("drillInIncoming,StartTM"),_TransitionAnimation.executeTransition(incomingPage,[{property:transformNames.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"scale(0.84)",to:"scale(1.0)"},{property:"opacity",delay:0,duration:500,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:0,to:1}]).then(function(){writeAnimationProfilerMark("drillInIncoming,StopTM")})},drillInOutgoing:function(outgoingPage){return writeAnimationProfilerMark("drillInOutgoing,StartTM"),_TransitionAnimation.executeTransition(outgoingPage,[{property:transformNames.cssName,delay:0,duration:233,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"scale(1.0)",to:"scale(1.29)"},{property:"opacity",delay:0,duration:233,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:1,to:0}]).then(function(){writeAnimationProfilerMark("drillInOutgoing,StopTM")})},drillOutIncoming:function(incomingPage){return writeAnimationProfilerMark("drillOutIncoming,StartTM"),_TransitionAnimation.executeTransition(incomingPage,[{property:transformNames.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"scale(1.29)",to:"scale(1.0)"},{property:"opacity",delay:0,duration:500,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:0,to:1}]).then(function(){writeAnimationProfilerMark("drillOutIncoming,StopTM")})},drillOutOutgoing:function(outgoingPage){return writeAnimationProfilerMark("drillOutOutgoing,StartTM"),_TransitionAnimation.executeTransition(outgoingPage,[{property:transformNames.cssName,delay:0,duration:233,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"scale(1.0)",to:"scale(0.84)"},{property:"opacity",delay:0,duration:233,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:1,to:0}]).then(function(){writeAnimationProfilerMark("drillOutOutgoing,StopTM")})},createPageNavigationAnimations:function(currentPreferredAnimation,nextPreferredAnimation,movingBackwards){function emptyAnimationFunction(){return Promise.wrap()}return{exit:emptyAnimationFunction,entrance:exports.enterPage}},_resizeTransition:function(elementClipper,element,args){if(args.to!==args.from&&_TransitionAnimation.isAnimationEnabled()){for(var animationsToPlay=resizeTransition(elementClipper,element,args),animationPromises=[],i=0,len=animationsToPlay.length;len>i;i++)animationPromises.push(transformWithTransition(animationsToPlay[i].element,animationsToPlay[i].transition));return Promise.join(animationPromises)}return Promise.as()},_commandingSurfaceOpenAnimation:function(args){if(!_TransitionAnimation.isAnimationEnabled())return Promise.as();var actionAreaClipper=args.actionAreaClipper,actionArea=args.actionArea,overflowAreaClipper=args.overflowAreaClipper,overflowArea=args.overflowArea,closedHeight=args.oldHeight,openedHeight=args.newHeight,overflowAreaHeight=args.overflowAreaHeight,menuPositionedAbove=args.menuPositionedAbove,deltaHeight=openedHeight-closedHeight,actionAreaAnimations=[],transitionToUse=getResizeDefaultTransitions().defaultResizeGrowTransition;if(menuPositionedAbove){actionArea.style[transformNames.scriptName]="translateY("+deltaHeight+"px)",_ElementUtilities._getComputedStyle(actionArea).opacity;var transition=_BaseUtils._merge(transitionToUse,{to:"translateY(0px)"});actionAreaAnimations.push({element:actionArea,transition:transition})}else actionAreaAnimations=resizeTransition(actionAreaClipper,actionArea,{from:closedHeight,to:openedHeight,actualSize:openedHeight,dimension:"height",anchorTrailingEdge:!1});overflowAreaClipper.style[transformNames.scriptName]="translateY("+(menuPositionedAbove?deltaHeight:-deltaHeight)+"px)",overflowArea.style[transformNames.scriptName]="translateY("+(menuPositionedAbove?overflowAreaHeight:-overflowAreaHeight)+"px)",_ElementUtilities._getComputedStyle(overflowAreaClipper).opacity,_ElementUtilities._getComputedStyle(overflowArea).opacity;for(var animationPromises=[],i=0,len=actionAreaAnimations.length;len>i;i++)animationPromises.push(transformWithTransition(actionAreaAnimations[i].element,actionAreaAnimations[i].transition));var overflowAreaTransition=_BaseUtils._merge(transitionToUse,{to:"translateY(0px)"});return animationPromises.push(transformWithTransition(overflowAreaClipper,overflowAreaTransition)),animationPromises.push(transformWithTransition(overflowArea,overflowAreaTransition)),Promise.join(animationPromises)},_commandingSurfaceCloseAnimation:function(args){if(!_TransitionAnimation.isAnimationEnabled())return Promise.as();var actionAreaClipper=args.actionAreaClipper,actionArea=args.actionArea,overflowAreaClipper=args.overflowAreaClipper,overflowArea=args.overflowArea,openedHeight=args.oldHeight,closedHeight=args.newHeight,overflowAreaHeight=args.overflowAreaHeight,menuPositionedAbove=args.menuPositionedAbove,deltaHeight=closedHeight-openedHeight,actionAreaAnimations=[],transitionToUse=getResizeDefaultTransitions().defaultResizeShrinkTransition;if(menuPositionedAbove){actionArea.style[transformNames.scriptName]="translateY(0px)",_ElementUtilities._getComputedStyle(actionArea).opacity;var transition=_BaseUtils._merge(transitionToUse,{to:"translateY("+-deltaHeight+"px)"});actionAreaAnimations.push({element:actionArea,transition:transition})}else actionAreaAnimations=resizeTransition(actionAreaClipper,actionArea,{from:openedHeight,to:closedHeight,actualSize:openedHeight,dimension:"height",anchorTrailingEdge:!1});overflowAreaClipper.style[transformNames.scriptName]="translateY(0px)",overflowArea.style[transformNames.scriptName]="translateY(0px)",_ElementUtilities._getComputedStyle(overflowAreaClipper).opacity,_ElementUtilities._getComputedStyle(overflowArea).opacity;for(var animationPromises=[],i=0,len=actionAreaAnimations.length;len>i;i++)animationPromises.push(transformWithTransition(actionAreaAnimations[i].element,actionAreaAnimations[i].transition));var overflowAreaClipperTransition=_BaseUtils._merge(transitionToUse,{to:"translateY("+(menuPositionedAbove?-deltaHeight:deltaHeight)+"px)"}),overflowAreaTransition=_BaseUtils._merge(transitionToUse,{to:"translateY("+(menuPositionedAbove?overflowAreaHeight:-overflowAreaHeight)+"px)"});return animationPromises.push(transformWithTransition(overflowAreaClipper,overflowAreaClipperTransition)),animationPromises.push(transformWithTransition(overflowArea,overflowAreaTransition)),Promise.join(animationPromises)}})}),define("WinJS/Binding/_BindingParser",["exports","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../ControlProcessor/_OptionsLexer","../ControlProcessor/_OptionsParser"],function(exports,_Base,_BaseUtils,_ErrorFromName,_Log,_Resources,_WriteProfilerMark,_OptionsLexer,_OptionsParser){"use strict";function parser(text,context){_WriteProfilerMark("WinJS.Binding:bindingParser,StartTM");var tokens=imports.lexer(text),interpreter=new local.BindingInterpreter(tokens,text,context||{}),res=interpreter.run();return _WriteProfilerMark("WinJS.Binding:bindingParser,StopTM"),res}function parser2(text){_WriteProfilerMark("WinJS.Binding:bindingParser,StartTM");var tokens=imports.lexer(text),interpreter=new local.BindingParser(tokens,text),res=interpreter.run();return _WriteProfilerMark("WinJS.Binding:bindingParser,StopTM"),res}var strings={get invalidBinding(){return"Invalid binding:'{0}'. Expected to be '<destProp>:<sourceProp>;'. {1}"},get bindingInitializerNotFound(){return"Initializer not found:'{0}'"}},imports=_Base.Namespace.defineWithParent(null,null,{lexer:_Base.Namespace._lazy(function(){return _OptionsLexer._optionsLexer}),tokenType:_Base.Namespace._lazy(function(){return _OptionsLexer._optionsLexer.tokenType})}),requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,local=_Base.Namespace.defineWithParent(null,null,{BindingInterpreter:_Base.Namespace._lazy(function(){return _Base.Class.derive(_OptionsParser.optionsParser._BaseInterpreter,function(tokens,originalSource,context){this._initialize(tokens,originalSource,context)},{_error:function(message){throw new _ErrorFromName("WinJS.Binding.ParseError",_Resources._formatString(strings.invalidBinding,this._originalSource,message))},_evaluateInitializerName:function(){if(this._current.type===imports.tokenType.identifier){var initializer=this._evaluateIdentifierExpression();return _Log.log&&!initializer&&_Log.log(_Resources._formatString(strings.bindingInitializerNotFound,this._originalSource),"winjs binding","error"),requireSupportedForProcessing(initializer)}},_evaluateValue:function(){switch(this._current.type){case imports.tokenType.stringLiteral:case imports.tokenType.numberLiteral:var value=this._current.value;return this._read(),value;default:return void this._unexpectedToken(imports.tokenType.stringLiteral,imports.tokenType.numberLiteral)}},_readBindDeclarations:function(){for(var bindings=[];;)switch(this._current.type){case imports.tokenType.identifier:case imports.tokenType.thisKeyword:bindings.push(this._readBindDeclaration());break;case imports.tokenType.semicolon:this._read();break;case imports.tokenType.eof:return bindings;default:return void this._unexpectedToken(imports.tokenType.identifier,imports.tokenType.semicolon,imports.tokenType.eof)}},_readBindDeclaration:function(){var dest=this._readDestinationPropertyName();this._read(imports.tokenType.colon);var src=this._readSourcePropertyName(),initializer=this._evaluateInitializerName();return{destination:dest,source:src,initializer:initializer}},_readDestinationPropertyName:function(){return this._readIdentifierExpression()},_readSourcePropertyName:function(){return this._readIdentifierExpression()},run:function(){return this._readBindDeclarations()}},{supportedForProcessing:!1})}),BindingParser:_Base.Namespace._lazy(function(){return _Base.Class.derive(local.BindingInterpreter,function(tokens,originalSource){this._initialize(tokens,originalSource,{})},{_readInitializerName:function(){return this._current.type===imports.tokenType.identifier?this._readIdentifierExpression():void 0},_readBindDeclaration:function(){var dest=this._readDestinationPropertyName();this._read(imports.tokenType.colon);var src=this._readSourcePropertyName(),initializer=this._readInitializerName();return{destination:dest,source:src,initializer:initializer}}},{supportedForProcessing:!1})})});_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{_bindingParser:parser,_bindingParser2:parser2})}),define("WinJS/Binding/_DomWeakRefTable",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Scheduler"],function(exports,_Global,_WinRT,_Base,_BaseUtils,Scheduler){"use strict";function cleanup(){0===SWEEP_PERIOD&&(cleanupToken=0);var i,len,keys=Object.keys(table),time=Date.now()-TIMEOUT;for(i=0,len=keys.length;len>i;i++){var id=keys[i];table[id].time<time&&delete table[id]}unscheduleCleanupIfNeeded()}function scheduleCleanupIfNeeded(){_Global.Debug&&_Global.Debug.debuggerEnabled&&noTimeoutUnderDebugger||cleanupToken||(0===SWEEP_PERIOD?(Scheduler.schedule(cleanup,Scheduler.Priority.idle,null,"WinJS.Utilities._DOMWeakRefTable.cleanup"),cleanupToken=1):cleanupToken=_Global.setInterval(cleanup,SWEEP_PERIOD))}function unscheduleCleanupIfNeeded(){_Global.Debug&&_Global.Debug.debuggerEnabled&&noTimeoutUnderDebugger||(0===SWEEP_PERIOD?cleanupToken||0!==Object.keys(table).length&&(Scheduler.schedule(cleanup,Scheduler.Priority.idle,null,"WinJS.Utilities._DOMWeakRefTable.cleanup"),cleanupToken=1):cleanupToken&&0===Object.keys(table).length&&(_Global.clearInterval(cleanupToken),cleanupToken=0))}function createWeakRef(element,id){return table[id]={element:element,time:Date.now()},scheduleCleanupIfNeeded(),id}function getWeakRefElement(id){if(fastLoadPath){var entry=table[id];return entry?entry.element:_Global.document.getElementById(id)}var element=_Global.document.getElementById(id);if(element)delete table[id],unscheduleCleanupIfNeeded();else{var entry=table[id];entry&&(entry.time=Date.now(),element=entry.element)}return element}if(_WinRT.Windows.Foundation.Uri&&_WinRT.msSetWeakWinRTProperty&&_WinRT.msGetWeakWinRTProperty){var host=new _WinRT.Windows.Foundation.Uri("about://blank");return void _Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{_createWeakRef:function(element,id){return _WinRT.msSetWeakWinRTProperty(host,id,element),id},_getWeakRefElement:function(id){return _WinRT.msGetWeakWinRTProperty(host,id)}})}var cleanupToken,SWEEP_PERIOD=500,TIMEOUT=1e3,table={},noTimeoutUnderDebugger=!0,fastLoadPath=!1;_Base.Namespace._moduleDefine(exports,"WinJS.Utilities",{_DOMWeakRefTable_noTimeoutUnderDebugger:{get:function(){return noTimeoutUnderDebugger},set:function(value){noTimeoutUnderDebugger=value}},_DOMWeakRefTable_sweepPeriod:{get:function(){return SWEEP_PERIOD},set:function(value){SWEEP_PERIOD=value}},_DOMWeakRefTable_timeout:{get:function(){return TIMEOUT},set:function(value){TIMEOUT=value}},_DOMWeakRefTable_tableSize:{get:function(){return Object.keys(table).length}},_DOMWeakRefTable_fastLoadPath:{get:function(){return fastLoadPath},set:function(value){fastLoadPath=value}},_createWeakRef:createWeakRef,_getWeakRefElement:getWeakRefElement})}),define("WinJS/Binding/_Data",["exports","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Promise","../Scheduler","./_DomWeakRefTable"],function(exports,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Log,_Resources,Promise,Scheduler,_DomWeakRefTable){"use strict";var strings={get exceptionFromBindingInitializer(){return"Exception thrown from binding initializer: {0}"},get propertyIsUndefined(){return"{0} is undefined"},get unsupportedDataTypeForBinding(){return"Unsupported data type"}},observableMixin={_listeners:null,_pendingNotifications:null,_notifyId:0,_getObservable:function(){return this},_cancel:function(name){var v=this._pendingNotifications,hit=!1;if(v)for(var k=Object.keys(v),i=k.length-1;i>=0;i--){var entry=v[k[i]];entry.target===name&&(entry.promise&&(entry.promise.cancel(),entry.promise=null),delete v[k[i]],hit=!0)}return hit},notify:function(name,newValue,oldValue){var listeners=this._listeners&&this._listeners[name];if(listeners){var that=this;that._cancel(name),that._pendingNotifications=that._pendingNotifications||{};var x=that._notifyId++,cap=that._pendingNotifications[x]={target:name},cleanup=function(){delete that._pendingNotifications[x]};return cap.promise=Scheduler.schedulePromiseNormal(null,"WinJS.Binding.observableMixin.notify").then(function(){for(var i=0,l=listeners.length;l>i&&cap.promise;i++)try{listeners[i](newValue,oldValue)}catch(e){_Log.log&&_Log.log(_Resources._formatString(strings.exceptionFromBindingInitializer,e.toString()),"winjs binding","error")}return cleanup(),newValue}),cap.promise}return Promise.as()},bind:function(name,action){this._listeners=this._listeners||{};for(var listeners=this._listeners[name]=this._listeners[name]||[],found=!1,i=0,l=listeners.length;l>i;i++)if(listeners[i]===action){found=!0;break}return found||(listeners.push(action),action(unwrap(this[name]))),this},unbind:function(name,action){if(this._listeners=this._listeners||{},name&&action){var listeners=this._listeners[name];if(listeners){for(var nl,i=0,l=listeners.length;l>i;i++)listeners[i]!==action&&(nl=nl||[]).push(listeners[i]);this._listeners[name]=nl}}else if(name)this._cancel(name),delete this._listeners[name];else{var that=this;if(that._pendingNotifications){var v=that._pendingNotifications;that._pendingNotifications={},Object.keys(v).forEach(function(k){var n=v[k];n.promise&&n.promise.cancel()})}this._listeners={}}return this}},dynamicObservableMixin={_backingData:null,_initObservable:function(data){this._backingData=data||{}},getProperty:function(name){var data=this._backingData[name];return _Log.log&&void 0===data&&_Log.log(_Resources._formatString(strings.propertyIsUndefined,name),"winjs binding","warn"),as(data)},setProperty:function(name,value){return this.updateProperty(name,value),this},addProperty:function(name,value){return this[name]||Object.defineProperty(this,name,{get:function(){return this.getProperty(name)},set:function(value){this.setProperty(name,value)},enumerable:!0,configurable:!0}),this.setProperty(name,value)},updateProperty:function(name,value){var oldValue=this._backingData[name],newValue=unwrap(value);return oldValue!==newValue&&(this._backingData[name]=newValue,this._backingData[name]===newValue)?this.notify(name,newValue,oldValue):Promise.as()},removeProperty:function(name){var value,oldValue=this._backingData[name];try{delete this._backingData[name]}catch(e){}try{delete this[name]}catch(e){}return this.notify(name,value,oldValue),this}};Object.keys(observableMixin).forEach(function(k){dynamicObservableMixin[k]=observableMixin[k]});var bind=function(observable,bindingDescriptor){return bindImpl(observable,bindingDescriptor)},bindRefId=0,createBindRefId=function(){return"bindHandler"+bindRefId++},createProxy=function(func,bindStateRef){if(!_WinRT.msGetWeakWinRTProperty)return func;var id=createBindRefId();return _DomWeakRefTable._getWeakRefElement(bindStateRef)[id]=func,function(n,o){var bindState=_DomWeakRefTable._getWeakRefElement(bindStateRef);bindState&&bindState[id](n,o)}},bindImpl=function(observable,bindingDescriptor,bindStateRef){function cancelSimple(){simpleLast&&simpleLast.forEach(function(e){e.source.unbind(e.prop,e.listener)}),simpleLast=null}function cancelComplex(k){complexLast[k]&&(complexLast[k].complexBind.cancel(),delete complexLast[k])}if(observable=as(observable),!observable)return{cancel:function(){},empty:!0};var bindState;bindStateRef||(bindStateRef=createBindRefId(),bindState={},_DomWeakRefTable._createWeakRef(bindState,bindStateRef));var complexLast={},simpleLast=null;return Object.keys(bindingDescriptor).forEach(function(k){var listener=bindingDescriptor[k];if(listener instanceof Function)listener=createProxy(listener,bindStateRef),listener.bindState=bindState,simpleLast=simpleLast||[],simpleLast.push({source:observable,prop:k,listener:listener}),observable.bind(k,listener);else{var propChanged=function(v){cancelComplex(k);var complexBind=bindImpl(as(v),listener,bindStateRef);if(complexBind.empty){var recursiveNotify=function(root){Object.keys(root).forEach(function(key){var item=root[key];item instanceof Function?item(void 0,void 0):recursiveNotify(item)})};recursiveNotify(listener)}complexLast[k]={source:v,complexBind:complexBind}};propChanged=createProxy(propChanged,bindStateRef),propChanged.bindState=bindState,simpleLast=simpleLast||[],simpleLast.push({source:observable,prop:k,listener:propChanged}),observable.bind(k,propChanged)}}),{cancel:function(){cancelSimple(),Object.keys(complexLast).forEach(function(k){cancelComplex(k)})}}},ObservableProxy=_Base.Class.mix(function(data){this._initObservable(data),Object.defineProperties(this,expandProperties(data))},dynamicObservableMixin),expandProperties=function(shape){function addToProps(k){props[k]={get:function(){return this.getProperty(k)},set:function(value){this.setProperty(k,value)},enumerable:!0,configurable:!0}}for(var props={};shape&&shape!==Object.prototype;)Object.keys(shape).forEach(addToProps),shape=Object.getPrototypeOf(shape);return props},define=function(data){if(!(!data||"object"!=typeof data||data instanceof Date||Array.isArray(data)))return _Base.Class.mix(function(init){this._initObservable(init||Object.create(data))},dynamicObservableMixin,expandProperties(data));if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.Binding.UnsupportedDataType",_Resources._formatString(strings.unsupportedDataTypeForBinding))},as=function(data){if(!data)return data;var type=typeof data;if("object"!==type||data instanceof Date||Array.isArray(data))return data;if(data._getObservable)return data._getObservable();var observable=new ObservableProxy(data);return observable.backingData=data,Object.defineProperty(data,"_getObservable",{value:function(){return observable},enumerable:!1,writable:!1}),observable},unwrap=function(data){return data&&data.backingData?data.backingData:data};_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{mixin:{value:dynamicObservableMixin,enumerable:!0,writable:!0,configurable:!0},dynamicObservableMixin:{value:dynamicObservableMixin,enumerable:!0,writable:!0,configurable:!0},observableMixin:{value:observableMixin,enumerable:!0,writable:!0,configurable:!0},expandProperties:expandProperties,define:define,as:as,unwrap:unwrap,bind:bind})}),define("WinJS/Binding/_Declarative",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Utilities/_ElementUtilities","./_BindingParser","./_Data","./_DomWeakRefTable"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Log,_Resources,_WriteProfilerMark,Promise,_ElementUtilities,_BindingParser,_Data,_DomWeakRefTable){"use strict";function registerAutoDispose(bindable,callback){var d=bindable._autoDispose;d&&d.push(callback)}function autoDispose(bindable){bindable._autoDispose=(bindable._autoDispose||[]).filter(function(callback){return callback()})}function checkBindingToken(element,bindingId){return element?element.winBindingToken===bindingId?element:void(_Log.log&&_Log.log(_Resources._formatString(strings.duplicateBindingDetected,element.id),"winjs binding","error")):element}function setBindingToken(element){if(element.winBindingToken)return element.winBindingToken;var bindingToken="_win_bind"+uid++;return Object.defineProperty(element,"winBindingToken",{configurable:!1,writable:!1,enumerable:!1,value:bindingToken}),bindingToken}function initializerOneBinding(bind,ref,bindingId,source,e,pend,cacheEntry){var initializer=bind.initializer;if(initializer&&(initializer=initializer.winControl||initializer["data-win-control"]||initializer),initializer instanceof Function){var result=initializer(source,bind.source,e,bind.destination);return cacheEntry&&(result&&result.cancel?cacheEntry.bindings.push(function(){result.cancel()}):cacheEntry.nocache=!0),result}initializer&&initializer.render&&(pend.count++,cacheEntry&&(cacheEntry.nocache=!0),requireSupportedForProcessing(initializer.render).call(initializer,getValue(source,bind.source),e).then(function(){pend.checkComplete()}))}function makeBinding(ref,bindingId,pend,bindable,bind,cacheEntry){var bindResult,first=!0,canceled=!1;autoDispose(bindable);var resolveWeakRef=function(){if(!canceled){var found=checkBindingToken(_DomWeakRefTable._getWeakRefElement(ref),bindingId);return found||(_Log.log&&_Log.log(_Resources._formatString(strings.elementNotFound,ref),"winjs binding","info"),bindResult&&bindResult.cancel()),found}},bindingAction=function(v){var found=resolveWeakRef();found&&nestedSet(found,bind.destination,v),first&&(pend.checkComplete(),first=!1)};if(registerAutoDispose(bindable,resolveWeakRef),bindResult=bindWorker(bindable,bind.source,bindingAction)){var cancel=bindResult.cancel;bindResult.cancel=function(){return canceled=!0,cancel.call(bindResult)},cacheEntry&&cacheEntry.bindings.push(function(){bindResult.cancel()})}return bindResult}function sourceOneBinding(bind,ref,bindingId,source,e,pend,cacheEntry){var bindable;return source!==_Global&&(source=_Data.as(source)),source._getObservable&&(bindable=source._getObservable()),bindable?(pend.count++,makeBinding(ref,bindingId,pend,bindable,bind,cacheEntry)):void nestedSet(e,bind.destination,getValue(source,bind.source))}function filterIdBinding(declBind,bindingStr){for(var bindIndex=declBind.length-1;bindIndex>=0;bindIndex--){var bind=declBind[bindIndex],dest=bind.destination;if(1===dest.length&&"id"===dest[0]){if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.Binding.IdBindingNotSupported",_Resources._formatString(strings.idBindingNotSupported,bindingStr));_Log.log&&_Log.log(_Resources._formatString(strings.idBindingNotSupported,bindingStr),"winjs binding","error"),declBind.splice(bindIndex,1)}}return declBind}function calcBinding(bindingStr,bindingCache){if(bindingCache){var declBind,declBindCache=bindingCache.expressions[bindingStr];return declBindCache||(declBind=filterIdBinding(_BindingParser._bindingParser(bindingStr,_Global),bindingStr),bindingCache.expressions[bindingStr]=declBind),declBind||(declBind=declBindCache),declBind}return filterIdBinding(_BindingParser._bindingParser(bindingStr,_Global),bindingStr)}function declarativeBindImpl(rootElement,dataContext,skipRoot,bindingCache,defaultInitializer,c){_WriteProfilerMark("WinJS.Binding:processAll,StartTM");var neg,pend={count:0,checkComplete:function(){this.count--,0===this.count&&(_WriteProfilerMark("WinJS.Binding:processAll,StopTM"),c())}},baseElement=rootElement||_Global.document.body,selector="[data-win-bind],[data-win-control]",elements=baseElement.querySelectorAll(selector);skipRoot||!baseElement.getAttribute("data-win-bind")&&!baseElement.winControl||(neg=baseElement),pend.count++;var source=dataContext||_Global;_DomWeakRefTable._DOMWeakRefTable_fastLoadPath=!0;try{var baseElementData=_ElementUtilities.data(baseElement);baseElementData.winBindings=baseElementData.winBindings||[];for(var i=neg?-1:0,l=elements.length;l>i;i++){var element=0>i?neg:elements[i];if(element.winControl&&element.winControl.constructor&&element.winControl.constructor.isDeclarativeControlContainer){i+=element.querySelectorAll(selector).length;var idcc=element.winControl.constructor.isDeclarativeControlContainer;"function"==typeof idcc&&(idcc=requireSupportedForProcessing(idcc))(element.winControl,function(element){return declarativeBind(element,dataContext,!1,bindingCache,defaultInitializer)})}if(element.hasAttribute("data-win-bind")){var original=element.getAttribute("data-win-bind"),declBind=calcBinding(original,bindingCache);if(!declBind.implemented){for(var bindIndex=0,bindLen=declBind.length;bindLen>bindIndex;bindIndex++){var bind=declBind[bindIndex];bind.initializer=bind.initializer||defaultInitializer,bind.initializer?bind.implementation=initializerOneBinding:bind.implementation=sourceOneBinding}declBind.implemented=!0}pend.count++;var bindingId=setBindingToken(element),ref=optimizeBindingReferences?bindingId:element.id;ref||(element.id=ref=bindingId),_DomWeakRefTable._createWeakRef(element,ref);var elementData=_ElementUtilities.data(element);elementData.winBindings=null;var cacheEntry;bindingCache&&bindingCache.elements&&(cacheEntry=bindingCache.elements[ref],cacheEntry||(bindingCache.elements[ref]=cacheEntry={bindings:[]}));for(var bindIndex2=0,bindLen2=declBind.length;bindLen2>bindIndex2;bindIndex2++){var bind2=declBind[bindIndex2],cancel2=bind2.implementation(bind2,ref,bindingId,source,element,pend,cacheEntry);cancel2&&(elementData.winBindings=elementData.winBindings||[],elementData.winBindings.push(cancel2),baseElementData.winBindings.push(cancel2))}pend.count--}}}finally{_DomWeakRefTable._DOMWeakRefTable_fastLoadPath=!1}pend.checkComplete()}function declarativeBind(rootElement,dataContext,skipRoot,bindingCache,defaultInitializer){return new Promise(function(c,e,p){declarativeBindImpl(rootElement,dataContext,skipRoot,bindingCache,defaultInitializer,c,e,p)}).then(null,function(e){return _Log.log&&_Log.log(_Resources._formatString(strings.errorInitializingBindings,e&&e.message),"winjs binding","error"),Promise.wrapError(e)})}function converter(convert){var userConverter=function(source,sourceProperties,dest,destProperties,initialValue){var bindingId=setBindingToken(dest),ref=optimizeBindingReferences?bindingId:dest.id;ref||(dest.id=ref=bindingId),_DomWeakRefTable._createWeakRef(dest,ref);var bindable;if(source!==_Global&&(source=_Data.as(source)),source._getObservable&&(bindable=source._getObservable()),bindable){var workerResult=bindWorker(_Data.as(source),sourceProperties,function(v){var found=checkBindingToken(_DomWeakRefTable._getWeakRefElement(ref),bindingId);found?nestedSet(found,destProperties,convert(requireSupportedForProcessing(v))):workerResult&&(_Log.log&&_Log.log(_Resources._formatString(strings.elementNotFound,ref),"winjs binding","info"),workerResult.cancel())});return workerResult}var value=getValue(source,sourceProperties);value!==initialValue&&nestedSet(dest,destProperties,convert(value))};return markSupportedForProcessing(userConverter)}function getValue(obj,path){if(obj!==_Global&&(obj=requireSupportedForProcessing(obj)),path)for(var i=0,len=path.length;len>i&&null!==obj&&void 0!==obj;i++)obj=requireSupportedForProcessing(obj[path[i]]);return obj}function nestedSet(dest,destProperties,v){requireSupportedForProcessing(v),dest=requireSupportedForProcessing(dest);for(var i=0,len=destProperties.length-1;len>i;i++){if(dest=requireSupportedForProcessing(dest[destProperties[i]]),!dest)return void(_Log.log&&_Log.log(_Resources._formatString(strings.propertyDoesNotExist,destProperties[i],destProperties.join(".")),"winjs binding","error"));if(dest instanceof _Global.Node)return void(_Log.log&&_Log.log(_Resources._formatString(strings.nestedDOMElementBindingNotSupported,destProperties[i],destProperties.join(".")),"winjs binding","error"))}if(0===destProperties.length)return void(_Log.log&&_Log.log(strings.cannotBindToThis,"winjs binding","error"));var prop=destProperties[destProperties.length-1];_Log.log&&void 0===dest[prop]&&_Log.log(_Resources._formatString(strings.creatingNewProperty,prop,destProperties.join(".")),"winjs binding","warn"),dest[prop]=v}function attributeSet(dest,destProperties,v){
return dest=requireSupportedForProcessing(dest),destProperties&&1===destProperties.length&&destProperties[0]?void dest.setAttribute(destProperties[0],v):void(_Log.log&&_Log.log(strings.attributeBindingSingleProperty,"winjs binding","error"))}function setAttribute(source,sourceProperties,dest,destProperties,initialValue){var bindingId=setBindingToken(dest),ref=optimizeBindingReferences?bindingId:dest.id;ref||(dest.id=ref=bindingId),_DomWeakRefTable._createWeakRef(dest,ref);var bindable;if(source!==_Global&&(source=_Data.as(source)),source._getObservable&&(bindable=source._getObservable()),bindable){var counter=0,workerResult=bindWorker(bindable,sourceProperties,function(v){if(1!==++counter||v!==initialValue){var found=checkBindingToken(_DomWeakRefTable._getWeakRefElement(ref),bindingId);found?attributeSet(found,destProperties,requireSupportedForProcessing(v)):workerResult&&(_Log.log&&_Log.log(_Resources._formatString(strings.elementNotFound,ref),"winjs binding","info"),workerResult.cancel())}});return workerResult}var value=getValue(source,sourceProperties);value!==initialValue&&attributeSet(dest,destProperties,value)}function setAttributeOneTime(source,sourceProperties,dest,destProperties){return attributeSet(dest,destProperties,getValue(source,sourceProperties))}function addClassOneTime(source,sourceProperties,dest){dest=requireSupportedForProcessing(dest);var value=getValue(source,sourceProperties);Array.isArray(value)?value.forEach(function(className){_ElementUtilities.addClass(dest,className)}):value&&_ElementUtilities.addClass(dest,value)}function defaultBind(source,sourceProperties,dest,destProperties,initialValue){return defaultBindImpl(source,sourceProperties,dest,destProperties,initialValue)}function bindWorker(bindable,sourceProperties,func){if(sourceProperties.length>1){for(var root={},current=root,i=0,l=sourceProperties.length-1;l>i;i++)current=current[sourceProperties[i]]={};return current[sourceProperties[sourceProperties.length-1]]=func,_Data.bind(bindable,root,!0)}return 1===sourceProperties.length?(bindable.bind(sourceProperties[0],func,!0),{cancel:function(){bindable.unbind(sourceProperties[0],func),this.cancel=noop}}):void func(bindable)}function noop(){}function oneTime(source,sourceProperties,dest,destProperties){return nestedSet(dest,destProperties,getValue(source,sourceProperties)),{cancel:noop}}function initializer(customInitializer){return markSupportedForProcessing(customInitializer)}var uid=1e3*Math.random()>>0,optimizeBindingReferences=_WinRT.msSetWeakWinRTProperty&&_WinRT.msGetWeakWinRTProperty,strings={get attributeBindingSingleProperty(){return'Attribute binding requires a single destination attribute name, often in the form "this[\'aria-label\']" or "width".'},get cannotBindToThis(){return"Can't bind to 'this'."},get creatingNewProperty(){return"Creating new property {0}. Full path:{1}"},get duplicateBindingDetected(){return"Binding against element with id {0} failed because a duplicate id was detected."},get elementNotFound(){return"Element not found:{0}"},get errorInitializingBindings(){return"Error initializing bindings: {0}"},get propertyDoesNotExist(){return"{0} doesn't exist. Full path:{1}"},get idBindingNotSupported(){return"Declarative binding to ID field is not supported. Initializer: {0}"},get nestedDOMElementBindingNotSupported(){return"Binding through a property {0} of type HTMLElement is not supported, Full path:{1}."}},markSupportedForProcessing=_BaseUtils.markSupportedForProcessing,requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,defaultBindImpl=converter(function(v){return v});_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{processAll:declarativeBind,oneTime:initializer(oneTime),defaultBind:initializer(defaultBind),converter:converter,initializer:initializer,getValue:getValue,setAttribute:initializer(setAttribute),setAttributeOneTime:initializer(setAttributeOneTime),addClassOneTime:initializer(addClassOneTime)})}),define("WinJS/Binding",["./Binding/_BindingParser","./Binding/_Data","./Binding/_Declarative","./Binding/_DomWeakRefTable"],function(){}),define("WinJS/BindingTemplate/_DataTemplateCompiler",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Binding/_BindingParser","../Binding/_Declarative","../ControlProcessor","../ControlProcessor/_OptionsParser","../Fragments","../Promise","../_Signal","../Utilities/_Dispose","../Utilities/_SafeHtml","../Utilities/_ElementUtilities"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Log,_Resources,_WriteProfilerMark,_BindingParser,_Declarative,ControlProcessor,_OptionsParser,Fragments,Promise,_Signal,_Dispose,_SafeHtml,_ElementUtilities){"use strict";if(_Global.document){var strings={get attributeBindingSingleProperty(){return'Attribute binding requires a single destination attribute name, often in the form "this[\'aria-label\']" or "width".'},get cannotBindToThis(){return"Can't bind to 'this'."},get idBindingNotSupported(){return"Declarative binding to ID field is not supported. Initializer: {0}"}};_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{_TemplateCompiler:_Base.Namespace._lazy(function(){function disposeInstance(container,workPromise,renderCompletePromise){var bindings=_ElementUtilities.data(container).bindTokens;bindings&&bindings.forEach(function(binding){binding&&binding.cancel&&binding.cancel()}),workPromise&&workPromise.cancel(),renderCompletePromise&&renderCompletePromise.cancel()}function delayedBindingProcessing(data,defaultInitializer){return function(element){return _Declarative.processAll(element,data,!1,null,defaultInitializer)}}function targetSecurityCheck(value){return value=requireSupportedForProcessing(value),value instanceof _Global.Node?null:value}function format(string,parts){var multiline=-1!==string.indexOf("\n"),args=arguments,result=string.replace(formatRegEx,function(unused,left,right,part,illegalLeft,illegalRight,replacementIndex){if(illegalLeft||illegalRight)throw new _ErrorFromName("Format:MalformedInputString","Did you forget to escape a: "+(illegalLeft||illegalRight)+" at: "+replacementIndex);if(left)return"{";if(right)return"}";var result,index=+part;if(result=index===+index?args[index+1]:parts[part],void 0===result)throw new _ErrorFromName("Format:MissingPart","Missing part '"+part+"'");if(multiline){for(var pos=replacementIndex;pos>0&&" "===string[--pos];);pos>=0&&"\n"===string[pos]&&(result=indent(replacementIndex-pos-1,result))}return result});return result}function indent(numberOfSpaces,multilineStringToBeIndented){for(var indent="",i=0;numberOfSpaces>i;i++)indent+=" ";return multilineStringToBeIndented.split("\n").map(function(line,index){return index?indent+line:line}).join("\n")}function trim(s){return s.trim()}function statements(array){return array.join(";\n")}function declarationList(array){return array.join(", ")||"empty"}function identifierAccessExpression(parts){return parts.map(function(part){return part.match(identifierRegEx)?"."+part:+part===part?format("[{0}]",part):format("[{0}]",literal(part))}).join("")}function nullableFilteredIdentifierAccessExpression(initial,parts,temporary,filter){var parts=parts.map(function(part){return part.match(identifierRegEx)?"."+part:(+part===part&&(part=+part),brackets(literal(part)))}).map(function(part){return format("{filter}({temp} = {temp}{part})",{filter:filter,temp:temporary,part:part})});return parts.unshift(parens(assignment(temporary,initial))),parts.push(temporary),parens(parts.join(" && "))}function literal(instance){return JSON.stringify(instance)}function newArray(N){return N?"new Array("+ +N+")":"[]"}function assignment(target,source){return""+target+" = "+source}function parens(expression){return"("+expression+")"}function brackets(expression){return"["+expression+"]"}function propertyName(name){return name.match(identifierRegEx)?name:+name===name?+name:literal(name)}function htmlEscape(str){return str=""+str,str.replace(encodeHtmlRegEx,function(m){return encodeHtmlEscapeMap[m]||" "})}function createIdentifier(prefix,count,suffix){return suffix?new String(""+prefix+count+"_"+suffix):new String(""+prefix+count)}function multiline(str){return str.replace(/\\n/g,"\\n\\\n")}function keys(object){return Object.keys(object)}function values(object){return Object.keys(object).map(function(key){return object[key]})}function merge(a,b){return mergeAll([a,b])}function mergeAll(list){for(var o={},i=0,len=list.length;len>i;i++)for(var part=list[i],keys=Object.keys(part),j=0,len2=keys.length;len2>j;j++){var key=keys[j];o[key]=part[key]}return o}function globalLookup(parts){return parts.reduce(function(current,name){return current?requireSupportedForProcessing(current[name]):null},_Global)}function visit(node,key,pre,post){var children=node.children;if(children){var keys=Object.keys(children);key&&pre&&pre(node,key,keys.length);for(var i=0,len=keys.length;len>i;i++){var childKey=keys[i],child=children[childKey];visit(child,childKey,pre,post)}key&&post&&post(node,key,Object.keys(children).length)}else key&&pre&&pre(node,key,0),key&&post&&post(node,key,0)}function trimLinesRight(string){return string.replace(/^\s*$/gm,"").replace(/^(.*[^\s])( *)$/gm,function(unused,content){return content})}var cancelBlocker=Promise._cancelBlocker,init_defaultBind=_Declarative.defaultBind,init_oneTime=_Declarative.oneTime,init_setAttribute=_Declarative.setAttribute,init_setAttributeOneTime=_Declarative.setAttributeOneTime,init_addClassOneTime=_Declarative.addClassOneTime,promise_as=Promise.as,requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,insertAdjacentHTMLUnsafe=_SafeHtml.insertAdjacentHTMLUnsafe,utilities_data=_ElementUtilities.data,markDisposable=_Dispose.markDisposable,ui_processAll=ControlProcessor.processAll,binding_processAll=_Declarative.processAll,options_parser=_OptionsParser._optionsParser,CallExpression=_OptionsParser._CallExpression,IdentifierExpression=_OptionsParser._IdentifierExpression,binding_parser=_BindingParser._bindingParser2,scopedSelect=ControlProcessor.scopedSelect,writeProfilerMark=_WriteProfilerMark,identifierRegEx=/^[A-Za-z]\w*$/,identifierCharacterRegEx=/[^A-Za-z\w$]/g,encodeHtmlRegEx=/[&<>'"]/g,encodeHtmlEscapeMap={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},formatRegEx=/({{)|(}})|{(\w+)}|({)|(})/g,semiColonOnlyLineRegEx=/^\s*;\s*$/,capitalRegEx=/[A-Z]/g,TreeCSE=_Base.Class.define(function(compiler,name,kind,accessExpression,filter){var that=this;this.compiler=compiler,this.kind=kind,this.base=new String(name),this.tree={children:{},parent:this.base,reference:function(){return that.base}},this.accessExpression=accessExpression,this.filter=filter||""},{createPathExpression:function(path,name){if(path.length){var that=this,tail=path.reduce(function(node,part){return node.children=node.children||{},node.children[part]=node.children[part]||{parent:node},node.children[part]},this.tree);return tail.name=tail.name||that.compiler.defineInstance(that.kind,name||"",function(){return that.accessExpression(tail.parent.name?tail.parent.name:tail.parent.reference(),path.slice(-1)[0],tail.parent.parent===that.base,that.filter,!0)}),tail.name}return this.base},lower:function(){var that=this,aggregatedName=[],reference=function(node,name,last){return that.accessExpression(node.parent.name?node.parent.name:node.parent.reference(),name,node.parent.parent===that.base,that.filter,last)};visit(this.tree,"",function(node,key,childCount){aggregatedName.push(key),childCount>1?(node.name=node.name||that.compiler.defineInstance(that.kind,aggregatedName.join("_"),reference.bind(null,node,key,!0)),node.reference=function(){return node.name}):1===childCount&&(node.reference=reference.bind(null,node,key))},function(){aggregatedName.pop()})},deadNodeElimination:function(){visit(this.tree,"",null,function(node,key,childCount){(!node.name||node.name.dead)&&0===childCount&&node.parent&&node.parent.children&&delete node.parent.children[key]})},definitions:function(){var nodes=[];return visit(this.tree,"",function(node){node.name&&nodes.push(node)}),nodes.map(function(n){return n.name.definition()})}}),InstanceKind={capture:"capture",temporary:"temporary",variable:"variable",data:"data",global:"global"},InstanceKindPrefixes={capture:"c",temporary:"t",variable:"iv",data:"d",global:"g"},StaticKind={imported:"import",variable:"variable"},StaticKindPrefixes={imported:"i",variable:"sv"},BindingKind={tree:"tree",text:"text",initializer:"initializer",template:"template",error:"error"},TextBindingKind={attribute:"attribute",booleanAttribute:"booleanAttribute",inlineStyle:"inlineStyle",textContent:"textContent"},IMPORTS_ARG_NAME="imports",Stage={initial:0,analyze:1,optimze:2,lower:3,compile:4,link:5,done:6},TemplateCompiler=_Base.Class.define(function(templateElement,options){if(this._stage=Stage.initial,this._staticVariables={},this._staticVariablesCount=0,this._instanceVariables={},this._instanceVariablesCount={},this._debugBreak=options.debugBreakOnRender,this._defaultInitializer=requireSupportedForProcessing(options.defaultInitializer||init_defaultBind),this._optimizeTextBindings=!options.disableTextBindingOptimization,this._templateElement=templateElement,this._templateContent=_Global.document.createElement(templateElement.tagName),this._extractChild=options.extractChild||!1,this._controls=null,this._bindings=null,this._bindTokens=null,this._textBindingPrefix=null,this._textBindingId=0,this._suffix=[],this._htmlProcessors=[],this._profilerMarkIdentifier=options.profilerMarkIdentifier,this._captureCSE=new TreeCSE(this,"container",InstanceKind.capture,this.generateElementCaptureAccess.bind(this)),this._dataCSE=new TreeCSE(this,"data",InstanceKind.data,this.generateNormalAccess.bind(this),this.importFunctionSafe("dataSecurityCheck",requireSupportedForProcessing)),this._globalCSE=new TreeCSE(this,this.importFunctionSafe("global",_Global),InstanceKind.global,this.generateNormalAccess.bind(this),this.importFunctionSafe("globalSecurityCheck",requireSupportedForProcessing)),Fragments.renderCopy(this._templateElement,this._templateContent),this._extractChild)for(;this._templateContent.childElementCount>1;)this._templateContent.removeChild(this._templateContent.lastElementChild)},{addClassOneTimeTextBinding:function(binding){var that=this,id=this.createTextBindingHole(binding.elementCapture.element.tagName,"class",++this._textBindingId);binding.textBindingId=id,binding.kind=BindingKind.text,binding.elementCapture.element.classList.add(id),binding.elementCapture.refCount--,binding.definition=function(){return that.formatCode("{htmlEscape}({value})",{htmlEscape:that._staticVariables.htmlEscape,value:binding.value()})}},addClassOneTimeTreeBinding:function(binding){var that=this;binding.pathExpression=this.bindingExpression(binding),binding.value=function(){return binding.pathExpression},binding.kind=BindingKind.tree,binding.definition=function(){return that.formatCode("{element}.classList.add({value})",{element:binding.elementCapture,value:binding.value()})}},analyze:function(){if(this._stage>Stage.analyze)throw"Illegal: once we have moved past analyze we cannot revist it";this._stage=Stage.analyze,this._controls=this.gatherControls(),this._bindings=this.gatherBindings(),this._children=this.gatherChildren(),this.cleanControlAndBindingAttributes(),this.async&&this.createAsyncParts(),this.nullableIdentifierAccessTemporary=this.defineInstance(InstanceKind.temporary);var html=this._templateContent.innerHTML;this._html=function(){return multiline(literal(html))},this._html.text=html},bindingExpression:function(binding){return this._dataCSE.createPathExpression(binding.source,binding.source.join("_"))},capture:function(element){var capture=element._capture;if(capture)return capture.refCount++,capture;for(var path=[element],e=element.parentNode,name=element.tagName;e!==this._templateContent;)name=e.tagName+"_"+name,path.unshift(e),e=e.parentNode;for(var i=0,len=path.length;len>i;i++){var child=path[i];path[i]=Array.prototype.indexOf.call(e.children,child),e=child}return capture=this._captureCSE.createPathExpression(path,name.toLowerCase()),capture.element=element,capture.element._capture=capture,capture.refCount=1,capture},cleanControlAndBindingAttributes:function(){for(var selector="[data-win-bind],[data-win-control]",elements=this._templateContent.querySelectorAll(selector),i=0,len=elements.length;len>i;i++){var element=elements[i];element.isDeclarativeControlContainer&&(i+=element.querySelectorAll("[data-win-bind],[data-win-control]").length),element.removeAttribute("data-win-bind"),element.removeAttribute("data-win-control"),element.removeAttribute("data-win-options")}},compile:function(bodyTemplate,replacements,supportDelayBindings){if(this._stage>Stage.compile)throw"Illegal: once we have moved past compile we cannot revist it";this._stage=Stage.compile;var that=this;this._returnedElement=this._extractChild?"container.firstElementChild":"container";var binding_processing,delayed_binding_processing,control_processing=this._controls.map(function(control){var constructionFormatString;constructionFormatString=control.async?"{target}.winControl = {target}.winControl || new {SafeConstructor}({target}, {options}, controlDone)":"{target}.winControl = {target}.winControl || new {SafeConstructor}({target}, {options})";var construction=that.formatCode(constructionFormatString,{target:control.elementCapture,SafeConstructor:control.SafeConstructor,options:that.generateOptionsLiteral(control.optionsParsed,control.elementCapture)});if(control.isDeclarativeControlContainer&&"function"==typeof control.isDeclarativeControlContainer.imported){var result=[construction];return result.push(that.formatCode("{isDeclarativeControlContainer}({target}.winControl, {delayedControlProcessing})",{target:control.elementCapture,isDeclarativeControlContainer:control.isDeclarativeControlContainer,delayedControlProcessing:that._staticVariables.ui_processAll})),result.push(that.formatCode("{isDeclarativeControlContainer}({target}.winControl, {delayedBindingProcessing}(data, {templateDefaultInitializer}))",{target:control.elementCapture,isDeclarativeControlContainer:control.isDeclarativeControlContainer,delayedBindingProcessing:that._staticVariables.delayedBindingProcessing,templateDefaultInitializer:that._staticVariables.templateDefaultInitializer||literal(null)})),result.join(";\n")}return construction}),all_binding_processing=this._bindings.map(function(binding){switch(binding.kind){case BindingKind.template:return that.formatCode("({nestedTemplates}[{nestedTemplate}] = {template}.render({path}, {dest}))",{nestedTemplates:that._nestedTemplates,nestedTemplate:literal(binding.nestedTemplate),template:binding.template,path:binding.pathExpression,dest:binding.elementCapture});case BindingKind.initializer:var formatString;return formatString=binding.initialValue?"({bindTokens}[{bindToken}] = {initializer}(data, {sourceProperties}, {dest}, {destProperties}, {initialValue}))":"({bindTokens}[{bindToken}] = {initializer}(data, {sourceProperties}, {dest}, {destProperties}))",that.formatCode(formatString,{bindTokens:that._bindTokens,bindToken:literal(binding.bindToken),initializer:binding.initializer,sourceProperties:literal(binding.source),destProperties:literal(binding.destination),dest:binding.elementCapture,initialValue:binding.initialValue});case BindingKind.tree:return binding.definition();case BindingKind.text:break;case BindingKind.error:break;default:throw"NYI"}});supportDelayBindings?(binding_processing=all_binding_processing.filter(function(unused,index){return!that._bindings[index].delayable}),delayed_binding_processing=all_binding_processing.filter(function(unused,index){return that._bindings[index].delayable})):(binding_processing=all_binding_processing,delayed_binding_processing=[]);var instances=values(this._instanceVariables),instanceDefinitions=instances.filter(function(instance){return instance.kind===InstanceKind.variable}).map(function(variable){return variable.definition()}),captures=this._captureCSE.definitions(),globals=this._globalCSE.definitions(),data=this._dataCSE.definitions(),set_msParentSelectorScope=this._children.map(function(child){return that.formatCodeN("{0}.msParentSelectorScope = true",child)}),suffix=this._suffix.map(function(statement){return statement()}),renderComplete="";supportDelayBindings&&delayed_binding_processing.length&&(renderComplete=that.formatCode(renderItemImplRenderCompleteTemplate,{delayed_binding_processing:statements(delayed_binding_processing)}));var result=that.formatCode(bodyTemplate,mergeAll([this._staticVariables,replacements||{},{profilerMarkIdentifierStart:literal("WinJS.Binding.Template:render"+this._profilerMarkIdentifier+",StartTM"),profilerMarkIdentifierStop:literal("WinJS.Binding.Template:render"+this._profilerMarkIdentifier+",StopTM"),html:this._html(),tagName:literal(this._templateElement.tagName),instance_variable_declarations:declarationList(instances),global_definitions:statements(globals),data_definitions:statements(data),instance_variable_definitions:statements(instanceDefinitions),capture_definitions:statements(captures),set_msParentSelectorScope:statements(set_msParentSelectorScope),debug_break:this.generateDebugBreak(),control_processing:statements(control_processing),control_counter:this._controlCounter,binding_processing:statements(binding_processing),renderComplete:renderComplete,suffix_statements:statements(suffix),nestedTemplates:this._nestedTemplates,returnedElement:this._returnedElement}]));return this.prettify(result)},createAsyncParts:function(){this._nestedTemplates=this._nestedTemplates||this.defineInstance(InstanceKind.variable,"nestedTemplates",function(){return newArray(0)}),this._controlCounter=this._controlCounter||this.defineInstance(InstanceKind.variable,"controlCounter",function(){return literal(1)})},createTextBindingHole:function(tagName,attribute,id){if(!this._textBindingPrefix){for(var c="";-1!==this._html.text.indexOf("textbinding"+c);)c=c||0,c++;this._textBindingPrefix="textbinding"+c,this._textBindingRegex=new RegExp("(#?"+this._textBindingPrefix+"_\\d+)")}var result=this._textBindingPrefix+"_"+id;return"IMG"===tagName&&"src"===attribute&&(result="#"+result),result},deadCodeElimination:function(){var that=this;Object.keys(this._instanceVariables).forEach(function(key){var iv=that._instanceVariables[key];iv.kind===InstanceKind.capture&&(that._templateContent.contains(iv.element)||(iv.dead=!0),0===iv.refCount&&(iv.dead=!0),iv.dead&&(iv.definition=function(){},iv.name=null,delete that._instanceVariables[key]))}),this._controls=this._controls.filter(function(c){return!c.elementCapture.dead}),this._bindings=this._bindings.filter(function(b){return!b.elementCapture.dead}),this._captureCSE.deadNodeElimination()},defineInstance:function(kind,name,definition){if(this._stage>=Stage.compile)throw"Illegal: define instance variable after compilation stage has started";var variableCount=this._instanceVariablesCount[kind]||0,suffix=name?name.replace(identifierCharacterRegEx,"_"):"",identifier=createIdentifier(InstanceKindPrefixes[kind],variableCount,suffix);return identifier.definition=function(){return assignment(identifier,definition())},identifier.kind=kind,this._instanceVariables[identifier]=identifier,this._instanceVariablesCount[kind]=variableCount+1,identifier},defineStatic:function(kind,name,definition){if(this._stage>=Stage.link)throw"Illegal: define static variable after link stage has started";if(name){var known=this._staticVariables[name];if(known)return known}var suffix=name?name.replace(identifierCharacterRegEx,"_"):"",identifier=createIdentifier(StaticKindPrefixes[kind],this._staticVariablesCount,suffix);return identifier.definition=function(){return assignment(identifier,definition())},identifier.kind=kind,this._staticVariables[name||identifier]=identifier,this._staticVariablesCount++,identifier},done:function(){if(this._stage>Stage.done)throw"Illegal: once we have moved past done we cannot revist it";this._stage=Stage.done},emitScopedSelect:function(selector,elementCapture){return this.formatCode("{scopedSelect}({selector}, {element})",{scopedSelect:this._staticVariables.scopedSelect,selector:literal(selector),element:elementCapture})},emitOptionsNode:function(node,parts,elementCapture){var that=this;if(node)switch(typeof node){case"object":if(Array.isArray(node)){parts.push("[");for(var i=0,len=node.length;len>i;i++)this.emitOptionsNode(node[i],parts,elementCapture),parts.push(",");parts.push("]")}else if(node instanceof CallExpression)parts.push("select"===node.target?this.emitScopedSelect(node.arg0Value,elementCapture):literal(null));else if(node instanceof IdentifierExpression&&node.parts[0]instanceof CallExpression){var call=node.parts[0];parts.push(nullableFilteredIdentifierAccessExpression("select"===call.target?this.emitScopedSelect(call.arg0Value,elementCapture):literal(null),node.parts.slice(1),this.nullableIdentifierAccessTemporary,this.importFunctionSafe("requireSupportedForProcessing",requireSupportedForProcessing)))}else node instanceof IdentifierExpression?parts.push(node.pathExpression):(parts.push("{"),Object.keys(node).forEach(function(key){parts.push(propertyName(key)),parts.push(":"),that.emitOptionsNode(node[key],parts,elementCapture),parts.push(",")}),parts.push("}"));break;default:parts.push(literal(node))}else parts.push(literal(null))},findGlobalIdentifierExpressions:function(obj,results){results=results||[];var that=this;return Object.keys(obj).forEach(function(key){var prop=obj[key];"object"==typeof prop&&(prop instanceof IdentifierExpression?prop.parts[0]instanceof CallExpression||results.push(prop):that.findGlobalIdentifierExpressions(prop,results))}),results},formatCodeN:function(){if(this._stage<Stage.compile)throw"Illegal: format code at before compilation stage has started";return format.apply(null,arguments)},formatCode:function(string,parts){if(this._stage<Stage.compile)throw"Illegal: format code at before compilation stage has started";return format(string,parts)},gatherBindings:function(){for(var bindTokens=-1,that=this,nestedTemplates=-1,bindings=[],selector="[data-win-bind],[data-win-control]",elements=this._templateContent.querySelectorAll(selector),i=0,len=elements.length;len>i;i++){var element=elements[i];if(element.isDeclarativeControlContainer&&(i+=element.querySelectorAll(selector).length),element.hasAttribute("data-win-bind")){var bindingText=element.getAttribute("data-win-bind"),elementBindings=binding_parser(bindingText,_Global);elementBindings.forEach(function(binding){if(binding.initializer){var initializerName=binding.initializer.join("."),initializer=globalLookup(binding.initializer);initializer.render?(requireSupportedForProcessing(initializer.render),binding.template=that.importFunctionSafe(initializerName,initializer),binding.pathExpression=that.bindingExpression(binding),binding.nestedTemplate=++nestedTemplates,binding.kind=BindingKind.template):initializer.winControl&&initializer.winControl.render?(requireSupportedForProcessing(initializer.winControl.render),binding.template=that.importFunctionSafe(initializerName,initializer.winControl),binding.pathExpression=that.bindingExpression(binding),binding.nestedTemplate=++nestedTemplates,binding.kind=BindingKind.template):(binding.initializer=that.importFunction(initializerName,initializer),binding.bindToken=++bindTokens,binding.kind=BindingKind.initializer)}else binding.initializer=that.importFunctionSafe("templateDefaultInitializer",that._defaultInitializer),binding.bindToken=++bindTokens,binding.kind=BindingKind.initializer;binding.elementCapture=that.capture(element),binding.bindingText=bindingText}),bindings.push.apply(bindings,elementBindings)}}var nestedTemplateCount=nestedTemplates+1;nestedTemplateCount>0&&(this.async=!0,this._nestedTemplates=this.defineInstance(InstanceKind.variable,"nestedTemplates",function(){return newArray(nestedTemplateCount)}));var bindTokenCount=bindTokens+1;return bindTokenCount>0&&(this._bindTokens=this.defineInstance(InstanceKind.variable,"bindTokens",function(){return newArray(bindTokenCount)}),this._suffix.push(function(){return that.formatCode("{utilities_data}(returnedElement).bindTokens = {bindTokens}",{utilities_data:that._staticVariables.utilities_data,bindTokens:that._bindTokens})})),bindings},gatherChildren:function(){var that=this;return Array.prototype.map.call(this._templateContent.children,function(child){return that.capture(child)})},gatherControls:function(){for(var that=this,asyncCount=0,controls=[],selector="[data-win-control]",elements=this._templateContent.querySelectorAll(selector),i=0,len=elements.length;len>i;i++){var element=elements[i],name=element.getAttribute("data-win-control"),ControlConstructor=_BaseUtils._getMemberFiltered(name.trim(),_Global,requireSupportedForProcessing);if(ControlConstructor){var optionsText=element.getAttribute("data-win-options")||literal({}),async=ControlConstructor.length>2;async&&(asyncCount++,this.async=!0);var isDeclarativeControlContainer=ControlConstructor.isDeclarativeControlContainer;isDeclarativeControlContainer&&("function"==typeof isDeclarativeControlContainer&&(isDeclarativeControlContainer=this.importFunction(name+"_isDeclarativeControlContainer",isDeclarativeControlContainer)),element.isDeclarativeControlContainer=isDeclarativeControlContainer,i+=element.querySelectorAll(selector).length);var control={elementCapture:this.capture(element),name:name,SafeConstructor:this.importFunctionSafe(name,ControlConstructor),async:async,optionsText:literal(optionsText),optionsParsed:options_parser(optionsText),isDeclarativeControlContainer:isDeclarativeControlContainer};controls.push(control);var globalReferences=this.findGlobalIdentifierExpressions(control.optionsParsed);globalReferences.forEach(function(identifierExpression){identifierExpression.pathExpression=that.globalExpression(identifierExpression.parts)})}}return asyncCount>0&&(this._controlCounter=this.defineInstance(InstanceKind.variable,"controlCounter",function(){return literal(asyncCount+1)})),controls},generateElementCaptureAccess:function(l,r,root){if(root){var right=""+r=="0"?"":" + "+r;return this.formatCodeN("{0}.children[startIndex{1}]",l,right)}return this.formatCodeN("{0}.children[{1}]",l,r)},generateNormalAccess:function(left,right,root,filter,last){if(left.indexOf(this.nullableIdentifierAccessTemporary)>=0){var formatString;return formatString=last?"{left} && {filter}({temp}{right})":"{left} && ({temp} = {filter}({temp}{right}))",this.formatCode(formatString,{temp:this.nullableIdentifierAccessTemporary,left:left,right:identifierAccessExpression([right]),filter:filter})}var formatString;return formatString=last?"({temp} = {left}) && {filter}({temp}{right})":"({temp} = {left}) && ({temp} = {filter}({temp}{right}))",this.formatCode(formatString,{temp:this.nullableIdentifierAccessTemporary,left:left,right:identifierAccessExpression([right]),filter:filter})},generateOptionsLiteral:function(optionsParsed,elementCapture){var parts=[];return this.emitOptionsNode(optionsParsed,parts,elementCapture),parts.join(" ")},generateDebugBreak:function(){if(this._debugBreak){var counter=this.defineStatic(StaticKind.variable,"debugCounter",function(){return literal(0)});return this.formatCodeN("if (++{0} === 1) {{ debugger; }}",counter)}return""},globalExpression:function(path){return this._globalCSE.createPathExpression(path,path.join("_"))},importFunction:function(name,i){return this.importFunctionSafe(name,requireSupportedForProcessing(i))},importFunctionSafe:function(name,i){var that=this,identifier=this.defineStatic(StaticKind.imported,name,function(){return that.formatCodeN("({0}{1})",IMPORTS_ARG_NAME,identifierAccessExpression([name]))});if(identifier.imported&&identifier.imported!==i)throw"Duplicate import: '"+name+"'";return identifier.imported=i,identifier},importAll:function(imports){return Object.keys(imports).forEach(function(key){requireSupportedForProcessing(imports[key]);
}),this.importAllSafe(imports)},importAllSafe:function(imports){var that=this,result=Object.keys(imports).reduce(function(o,key){return o[key]=that.importFunctionSafe(key,imports[key]),o},{});return result},link:function(body){if(this._stage>Stage.link)throw"Illegal: once we have moved past link we cannot revist it";this._stage=Stage.link;var that=this,imports=keys(this._staticVariables).filter(function(key){return that._staticVariables[key].kind===StaticKind.imported}).reduce(function(o,key){return o[key]=that._staticVariables[key].imported,o},{}),statics=values(this._staticVariables);return new Function(IMPORTS_ARG_NAME,this.formatCode(linkerCodeTemplate,{static_variable_declarations:declarationList(statics),static_variable_definitions:statements(statics.map(function(s){return s.definition()})),body:body.trim()}))(imports)},lower:function(){if(this._stage>Stage.lower)throw"Illegal: once we have moved past lower we cannot revist it";this._stage=Stage.lower,this._captureCSE.lower(),this._dataCSE.lower(),this._globalCSE.lower()},markBindingAsError:function(binding){binding&&(binding.kind=BindingKind.error,this.markBindingAsError(binding.original))},oneTimeTextBinding:function(binding){var that=this,result=this.oneTimeTextBindingAnalyze(binding);if(result){var initialValue;binding.original&&(initialValue=binding.original.initialValue);var id=this.createTextBindingHole(binding.elementCapture.element.tagName,result.attribute,++this._textBindingId);switch(binding.textBindingId=id,binding.kind=BindingKind.text,binding.elementCapture.refCount--,binding.definition=function(){var formatString;return formatString=initialValue?"{htmlEscape}({initialValue})":"{htmlEscape}({getter})",that.formatCode(formatString,{htmlEscape:that._staticVariables.htmlEscape,getter:binding.value(),initialValue:initialValue})},result.kind){case TextBindingKind.attribute:binding.elementCapture.element.setAttribute(result.attribute,id);break;case TextBindingKind.booleanAttribute:binding.elementCapture.element.setAttribute(result.attribute,id),binding.definition=function(){var formatString;return formatString=initialValue?'({initialValue} ? {attribute} : "")':'({value} ? {attribute} : "")',that.formatCode(formatString,{value:binding.value(),attribute:literal(result.attribute),initialValue:initialValue})},this._htmlProcessors.push(function(html){return html.replace(new RegExp(result.attribute+'="'+id+'"',"i"),id)});break;case TextBindingKind.textContent:binding.elementCapture.element.textContent=id;break;case TextBindingKind.inlineStyle:var element=binding.elementCapture.element;if(!element.msReplaceStyle){element.msReplaceStyle=element.getAttribute("style")||"",""!==element.msReplaceStyle&&";"!==element.msReplaceStyle[element.msReplaceStyle.length-1]&&(element.msReplaceStyle=element.msReplaceStyle+";"),element.setAttribute("style","msReplaceStyle:'"+id+"'");var temp=element.getAttribute("style");this._htmlProcessors.push(function(html){return html.replace(temp,element.msReplaceStyle)})}element.msReplaceStyle=element.msReplaceStyle+result.property+":"+id+";";break;default:throw"NYI"}}},oneTimeTextBindingAnalyze:function(binding){var element=binding.elementCapture.element,elementType=element.tagName,targetProperty=binding.destination[0];switch(elementType){case"A":switch(targetProperty){case"href":return{kind:TextBindingKind.attribute,attribute:targetProperty}}break;case"IMG":switch(targetProperty){case"alt":case"src":case"width":case"height":return{kind:TextBindingKind.attribute,attribute:targetProperty}}break;case"SELECT":switch(targetProperty){case"disabled":case"multiple":case"required":return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty};case"size":return{kind:TextBindingKind.attribute,attribute:targetProperty}}break;case"OPTION":switch(targetProperty){case"label":case"value":return{kind:TextBindingKind.attribute,attribute:targetProperty};case"disabled":case"selected":return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty}}break;case"INPUT":switch(targetProperty){case"checked":switch(element.type){case"checkbox":case"radio":return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty}}break;case"disabled":return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty};case"max":case"maxLength":case"min":case"step":case"value":return{kind:TextBindingKind.attribute,attribute:targetProperty};case"size":switch(element.type){case"text":case"search":case"tel":case"url":case"email":case"password":return{kind:TextBindingKind.attribute,attribute:targetProperty}}break;case"readOnly":switch(element.type){case"hidden":case"range":case"color":case"checkbox":case"radio":case"file":case"button":break;default:return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty}}}break;case"BUTTON":switch(targetProperty){case"disabled":return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty};case"value":return{kind:TextBindingKind.attribute,attribute:targetProperty}}break;case"TEXTAREA":switch(targetProperty){case"disabled":case"readOnly":case"required":return{kind:TextBindingKind.booleanAttribute,attribute:targetProperty};case"cols":case"maxLength":case"placeholder":case"rows":case"wrap":return{kind:TextBindingKind.attribute,attribute:targetProperty}}}switch(targetProperty){case"className":return{kind:TextBindingKind.attribute,attribute:"class"};case"dir":case"lang":case"name":case"title":case"tabIndex":return{kind:TextBindingKind.attribute,attribute:targetProperty};case"style":if(binding.destination.length>1){var targetCssProperty=binding.destination[1];if("cssText"===targetCssProperty)return;var supported="string"==typeof element.style[targetCssProperty];if(supported)return("m"===targetCssProperty[0]&&"s"===targetCssProperty[1]||"webkit"===targetCssProperty.substring(0,6))&&(targetCssProperty="-"+targetCssProperty),targetCssProperty=targetCssProperty.replace(capitalRegEx,function(l){return"-"+l.toLowerCase()}),{kind:TextBindingKind.inlineStyle,property:targetCssProperty,attribute:"style"}}break;case"innerText":case"textContent":return{kind:TextBindingKind.textContent,attribute:"textContent"}}},oneTimeTreeBinding:function(binding){if(1===binding.destination.length&&"id"===binding.destination[0]){if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.Binding.IdBindingNotSupported",_Resources._formatString(strings.idBindingNotSupported,binding.bindingText));return _Log.log&&_Log.log(_Resources._formatString(strings.idBindingNotSupported,binding.bindingText),"winjs binding","error"),void this.markBindingAsError(binding)}if(0===binding.destination.length)return _Log.log&&_Log.log(strings.cannotBindToThis,"winjs binding","error"),void this.markBindingAsError(binding);var initialValue,that=this;binding.pathExpression=this.bindingExpression(binding),binding.value=function(){return binding.pathExpression},binding.original&&(initialValue=binding.pathExpression,binding.original.initialValue=initialValue),binding.kind=BindingKind.tree,binding.definition=function(){var formatString;return formatString=initialValue?"({targetPath} || {{}}){prop} = {initialValue}":"({targetPath} || {{}}){prop} = {sourcePath}",that.formatCode(formatString,{targetPath:nullableFilteredIdentifierAccessExpression(binding.elementCapture,binding.destination.slice(0,-1),that.nullableIdentifierAccessTemporary,that.importFunctionSafe("targetSecurityCheck",targetSecurityCheck)),prop:identifierAccessExpression(binding.destination.slice(-1)),sourcePath:binding.value(),initialValue:initialValue})}},optimize:function(){if(this._stage>Stage.optimze)throw"Illegal: once we have moved past link we cannot revist it";this._stage=Stage.optimze;for(var i=0;i<this._bindings.length;i++){var binding=this._bindings[i];if(!binding.template)switch(binding.initializer.imported){case init_defaultBind:var newBinding=merge(binding,{kind:BindingKind.tree,initializer:this.importFunctionSafe("init_oneTime",init_oneTime),original:binding});newBinding.elementCapture.refCount++,this.oneTimeTreeBinding(newBinding),this._bindings.splice(i,0,newBinding),binding.delayable=!0,i++;break;case init_setAttribute:var newBinding=merge(binding,{kind:BindingKind.tree,initializer:this.importFunctionSafe("init_setAttributeOneTime",init_setAttributeOneTime),original:binding});newBinding.elementCapture.refCount++,this.setAttributeOneTimeTreeBinding(newBinding),this._bindings.splice(i,0,newBinding),binding.delayable=!0,i++;break;case init_oneTime:this.oneTimeTreeBinding(binding);break;case init_setAttributeOneTime:this.setAttributeOneTimeTreeBinding(binding);break;case init_addClassOneTime:this.addClassOneTimeTreeBinding(binding);break;default:binding.initializer&&(binding.delayable=!!binding.initializer.imported.delayable)}}if(this._optimizeTextBindings){for(var textBindings={},i=0;i<this._bindings.length;i++){var binding=this._bindings[i];if(!binding.template&&binding.kind!==BindingKind.error){switch(binding.initializer.imported){case init_oneTime:this.oneTimeTextBinding(binding);break;case init_setAttributeOneTime:this.setAttributeOneTimeTextBinding(binding);break;case init_addClassOneTime:this.addClassOneTimeTextBinding(binding)}binding.textBindingId&&(textBindings[binding.textBindingId]=binding)}}if(Object.keys(textBindings).length){var newHtml=this._templateContent.innerHTML;newHtml=this._htmlProcessors.reduce(function(html,replacer){return replacer(html)},newHtml);for(var parts=newHtml.split(this._textBindingRegex),i=1;i<parts.length;i+=2){var binding=textBindings[parts[i]];parts[i]=binding.definition}this._html=function(){var result=parts.map(function(p){return"string"==typeof p?literal(p):p()}).join(" + ");return multiline(result)}}}},prettify:function(result){var lines=result.split("\n");return lines.filter(function(line){return!semiColonOnlyLineRegEx.test(line)}).join("\n")},setAttributeOneTimeTextBinding:function(binding){var initialValue,that=this,attribute=binding.destination[0],id=this.createTextBindingHole(binding.elementCapture.element.tagName,attribute,++this._textBindingId);binding.original&&(initialValue=binding.original.initialValue),binding.textBindingId=id,binding.kind=BindingKind.text,binding.elementCapture.element.setAttribute(attribute,id),binding.elementCapture.refCount--,binding.definition=function(){var formatString;return formatString=initialValue?"{htmlEscape}({initialValue})":"{htmlEscape}({value})",that.formatCode(formatString,{htmlEscape:that._staticVariables.htmlEscape,initialValue:initialValue,value:binding.value()})}},setAttributeOneTimeTreeBinding:function(binding){if(1===binding.destination.length&&"id"===binding.destination[0]){if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.Binding.IdBindingNotSupported",_Resources._formatString(strings.idBindingNotSupported,binding.bindingText));return _Log.log&&_Log.log(_Resources._formatString(strings.idBindingNotSupported,binding.bindingText),"winjs binding","error"),void this.markBindingAsError(binding)}if(1!==binding.destination.length||!binding.destination[0])return _Log.log&&_Log.log(strings.attributeBindingSingleProperty,"winjs binding","error"),void this.markBindingAsError(binding);var initialValue,that=this;binding.pathExpression=this.bindingExpression(binding),binding.value=function(){return binding.pathExpression},binding.original&&(initialValue=this.defineInstance(InstanceKind.variable,"",binding.value),binding.original.initialValue=initialValue),binding.kind=BindingKind.tree,binding.definition=function(){var formatString;return formatString=initialValue?'{element}.setAttribute({attribute}, "" + {initialValue})':'{element}.setAttribute({attribute}, "" + {value})',that.formatCode(formatString,{element:binding.elementCapture,attribute:literal(binding.destination[0]),initialValue:initialValue,value:binding.value()})}}},{_TreeCSE:TreeCSE,compile:function(template,templateElement,options){if(!(templateElement instanceof _Global.HTMLElement))throw"Illegal";writeProfilerMark("WinJS.Binding.Template:compile"+options.profilerMarkIdentifier+",StartTM");var compiler=new TemplateCompiler(templateElement,options);compiler.analyze();var importAliases=compiler.importAllSafe({Signal:_Signal,global:_Global,document:_Global.document,cancelBlocker:cancelBlocker,promise_as:promise_as,disposeInstance:disposeInstance,markDisposable:markDisposable,ui_processAll:ui_processAll,binding_processAll:binding_processAll,insertAdjacentHTMLUnsafe:insertAdjacentHTMLUnsafe,promise:Promise,utilities_data:utilities_data,requireSupportedForProcessing:requireSupportedForProcessing,htmlEscape:htmlEscape,scopedSelect:scopedSelect,delayedBindingProcessing:delayedBindingProcessing,writeProfilerMark:writeProfilerMark});compiler.optimize(),compiler.deadCodeElimination(),compiler.lower();var codeTemplate,delayBindings;switch(options.target){case"render":codeTemplate=compiler.async?renderImplCodeAsyncTemplate:renderImplCodeTemplate,delayBindings=!1;break;case"renderItem":codeTemplate=compiler.async?renderItemImplCodeAsyncTemplate:renderItemImplCodeTemplate,delayBindings=!0}var body=compiler.compile(codeTemplate,importAliases,delayBindings),render=compiler.link(body);return compiler.done(),writeProfilerMark("WinJS.Binding.Template:compile"+options.profilerMarkIdentifier+",StopTM"),render}}),renderImplMainCodePrefixTemplate=trimLinesRight('container.classList.add("win-template");                                                              \nvar html = {html};                                                                                      \n{insertAdjacentHTMLUnsafe}(container, "beforeend", html);                                             \nreturnedElement = {returnedElement};                                                                    \n                                                                                                        \n// Capture Definitions                                                                                  \n{capture_definitions};                                                                                  \n{set_msParentSelectorScope};                                                                            \n                                                                                                        \n'),renderImplControlAndBindingProcessing=trimLinesRight("// Control Processing                                                                                   \n{control_processing};                                                                                   \n                                                                                                        \n// Binding Processing                                                                                   \n{binding_processing};                                                                                   \n                                                                                                        \nvar result = {promise_as}(returnedElement);                                                             \n"),renderImplAsyncControlAndBindingProcessing=trimLinesRight('var controlSignal = new {Signal}();                                                                     \nvar controlDone = function () {{ if (--{control_counter} === 0) {{ controlSignal.complete(); }} }};     \ncontrolDone();                                                                                          \n                                                                                                        \n// Control Processing                                                                                   \n{control_processing};                                                                                   \n                                                                                                        \nvar result = controlSignal.promise.then(function () {{                                                  \n    // Binding Processing                                                                               \n    {binding_processing};                                                                               \n    return {promise}.join({nestedTemplates});                                                           \n}}).then(function () {{                                                                                 \n    return returnedElement;                                                                             \n}}).then(null, function (e) {{                                                                          \n    if (typeof e === "object" && e.name === "Canceled") {{ returnedElement.dispose(); }}            \n    return {promise}.wrapError(e);                                                                      \n}});                                                                                                    \n'),renderImplMainCodeSuffixTemplate=trimLinesRight("{markDisposable}(returnedElement, function () {{ {disposeInstance}(returnedElement, result); }});       \n{suffix_statements};                                                                                    \n"),renderImplCodeTemplate=trimLinesRight('function render(data, container) {{                                                                     \n    {debug_break}                                                                                       \n    if (typeof data === "object" && typeof data.then === "function") {{                             \n        // async data + a container falls back to interpreted path                                      \n        if (container) {{                                                                               \n            var result = this._renderInterpreted(data, container);                                      \n            return result.element.then(function () {{ return result.renderComplete; }});                \n        }}                                                                                              \n        return {cancelBlocker}(data).then(function(data) {{ return render(data); }});                   \n    }}                                                                                                  \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStart});                                                 \n                                                                                                        \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var returnedElement;                                                                                \n                                                                                                        \n    // Global Definitions                                                                               \n    {global_definitions};                                                                               \n                                                                                                        \n    // Data Definitions                                                                                 \n    data = (data === {global} ? data : {requireSupportedForProcessing}(data));                          \n    {data_definitions};                                                                                 \n                                                                                                        \n    // Instance Variable Definitions                                                                    \n    {instance_variable_definitions};                                                                    \n                                                                                                        \n    // HTML Processing                                                                                  \n    container = container || {document}.createElement({tagName});                                       \n    var startIndex = container.childElementCount;                                                       \n    '+trim(indent(4,renderImplMainCodePrefixTemplate))+"                                           \n                                                                                                        \n    "+trim(indent(4,renderImplControlAndBindingProcessing))+"                                      \n    "+trim(indent(4,renderImplMainCodeSuffixTemplate))+"                                           \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStop});                                                  \n                                                                                                        \n    return result;                                                                                      \n}}                                                                                                      \n"),renderImplCodeAsyncTemplate=trimLinesRight('function render(data, container) {{                                                                     \n    {debug_break}                                                                                       \n    if (typeof data === "object" && typeof data.then === "function") {{                             \n        // async data + a container falls back to interpreted path                                      \n        if (container) {{                                                                               \n            var result = this._renderInterpreted(data, container);                                      \n            return result.element.then(function () {{ return result.renderComplete; }});                \n        }}                                                                                              \n        return {cancelBlocker}(data).then(function(data) {{ return render(data, container); }});        \n    }}                                                                                                  \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStart});                                                 \n                                                                                                        \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var returnedElement;                                                                                \n                                                                                                        \n    // Global Definitions                                                                               \n    {global_definitions};                                                                               \n                                                                                                        \n    // Data Definitions                                                                                 \n    data = (data === {global} ? data : {requireSupportedForProcessing}(data));                          \n    {data_definitions};                                                                                 \n                                                                                                        \n    // Instance Variable Definitions                                                                    \n    {instance_variable_definitions};                                                                    \n                                                                                                        \n    // HTML Processing                                                                                  \n    container = container || {document}.createElement({tagName});                                       \n    var startIndex = container.childElementCount;                                                       \n    '+trim(indent(4,renderImplMainCodePrefixTemplate))+"                                           \n                                                                                                        \n    "+trim(indent(4,renderImplAsyncControlAndBindingProcessing))+"                                 \n    "+trim(indent(4,renderImplMainCodeSuffixTemplate))+"                                           \n                                                                                                        \n    {writeProfilerMark}({profilerMarkIdentifierStop});                                                  \n                                                                                                        \n    return result;                                                                                      \n}}                                                                                                      \n"),renderItemImplMainCodeSuffixTemplate=trimLinesRight("{markDisposable}(returnedElement, function () {{ {disposeInstance}(returnedElement, result, renderComplete); }});\n{suffix_statements};                                                                                    \n"),renderItemImplCodeTemplate=trimLinesRight('function renderItem(itemPromise) {{                                                                     \n    {debug_break}                                                                                       \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var element, renderComplete, data, returnedElement;                                                 \n                                                                                                        \n    element = itemPromise.then(function renderItem(item) {{                                             \n        if (typeof item.data === "object" && typeof item.data.then === "function") {{               \n            return {cancelBlocker}(item.data).then(function (data) {{ return renderItem({{ data: data }}); }});\n        }}                                                                                              \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStart});                                             \n                                                                                                        \n        // Global Definitions                                                                           \n        {global_definitions};                                                                           \n                                                                                                        \n        // Data Definitions                                                                             \n        data = item.data;                                                                               \n        data = (data === {global} ? data : {requireSupportedForProcessing}(data));                      \n        {data_definitions};                                                                             \n                                                                                                        \n        // Instance Variable Definitions                                                                \n        {instance_variable_definitions};                                                                \n                                                                                                        \n        // HTML Processing                                                                              \n        var container = {document}.createElement({tagName});                                            \n        var startIndex = 0;                                                                             \n        '+trim(indent(8,renderImplMainCodePrefixTemplate))+"                                       \n                                                                                                        \n        "+trim(indent(8,renderImplControlAndBindingProcessing))+"                                  \n        "+trim(indent(8,renderItemImplMainCodeSuffixTemplate))+"                                   \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStop});                                              \n                                                                                                        \n        return result;                                                                                  \n    }});                                                                                                \n    {renderComplete};                                                                                   \n    return {{                                                                                           \n        element: element,                                                                               \n        renderComplete: renderComplete || element,                                                      \n    }};                                                                                                 \n}}                                                                                                      \n"),renderItemImplRenderCompleteTemplate=trimLinesRight("renderComplete = element.then(function () {{                                                            \n    return itemPromise;                                                                                 \n}}).then(function (item) {{                                                                             \n    return item.ready || item;                                                                          \n}}).then(function (item) {{                                                                             \n    {delayed_binding_processing};                                                                       \n    return element;                                                                                     \n}});                                                                                                    \n"),renderItemImplCodeAsyncTemplate=trimLinesRight('function renderItem(itemPromise) {{                                                                     \n    {debug_break}                                                                                       \n    // Declarations                                                                                     \n    var {instance_variable_declarations};                                                               \n    var element, renderComplete, data, returnedElement;                                                 \n                                                                                                        \n    element = itemPromise.then(function renderItem(item) {{                                             \n        if (typeof item.data === "object" && typeof item.data.then === "function") {{               \n            return {cancelBlocker}(item.data).then(function (data) {{ return renderItem({{ data: data }}); }});\n        }}                                                                                              \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStart});                                             \n                                                                                                        \n        // Global Definitions                                                                           \n        {global_definitions};                                                                           \n                                                                                                        \n        // Data Definitions                                                                             \n        data = item.data;                                                                               \n        data = (data === {global} ? data : {requireSupportedForProcessing}(data));                      \n        {data_definitions};                                                                             \n                                                                                                        \n        // Instance Variable Definitions                                                                \n        {instance_variable_definitions};                                                                \n                                                                                                        \n        // HTML Processing                                                                              \n        var container = {document}.createElement({tagName});                                            \n        var startIndex = 0;                                                                             \n        '+trim(indent(8,renderImplMainCodePrefixTemplate))+"                                       \n                                                                                                        \n        "+trim(indent(8,renderImplAsyncControlAndBindingProcessing))+"                             \n        "+trim(indent(8,renderItemImplMainCodeSuffixTemplate))+"                                   \n                                                                                                        \n        {writeProfilerMark}({profilerMarkIdentifierStop});                                              \n                                                                                                        \n        return result;                                                                                  \n    }});                                                                                                \n    {renderComplete};                                                                                   \n    return {{                                                                                           \n        element: element,                                                                               \n        renderComplete: renderComplete || element,                                                      \n    }};                                                                                                 \n}}                                                                                                      \n"),linkerCodeTemplate=trimLinesRight('"use strict";                                                                                         \n                                                                                                        \n// statics                                                                                              \nvar {static_variable_declarations};                                                                     \n{static_variable_definitions};                                                                          \n                                                                                                        \n// generated template rendering function                                                                \nreturn {body};                                                                                          \n');
return TemplateCompiler})})}}),define("WinJS/BindingTemplate",["exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Core/_Log","./Core/_WriteProfilerMark","./Binding/_Declarative","./BindingTemplate/_DataTemplateCompiler","./ControlProcessor","./Fragments","./Promise","./Utilities/_Dispose","./Utilities/_ElementUtilities"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_Log,_WriteProfilerMark,_Declarative,_DataTemplateCompiler,ControlProcessor,Fragments,Promise,_Dispose,_ElementUtilities){"use strict";if(_Global.document){var cancelBlocker=Promise._cancelBlocker;_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{Template:_Base.Namespace._lazy(function(){function interpretedRender(template,dataContext,container){function done(){return _ElementUtilities.removeClass(d,"win-loading"),_WriteProfilerMark("WinJS.Binding:templateRender"+template._profilerMarkIdentifier+",StopTM"),extractedChild||d}_WriteProfilerMark("WinJS.Binding:templateRender"+template._profilerMarkIdentifier+",StartTM"),1===++template._counter&&(template.debugBreakOnRender||Template._debugBreakOnRender);var workPromise=Promise.wrap(),d=container||_Global.document.createElement(template.element.tagName);_ElementUtilities.addClass(d,"win-template"),_ElementUtilities.addClass(d,"win-loading");var element,extractedChild,that=template,initial=d.children.length,dispose=function(){var bindings=_ElementUtilities.data(d).winBindings;bindings&&bindings.forEach(function(item){item.cancel()}),workPromise.cancel()};template.extractChild?element=Fragments.renderCopy(that.href||that.element,_Global.document.createElement(that.element.tagName)).then(function(frag){var child=frag.firstElementChild;return extractedChild=child,_Dispose.markDisposable(child,dispose),d.appendChild(child),child}):(_Dispose.markDisposable(d,dispose),element=Fragments.renderCopy(that.href||that.element,d));var renderComplete=element.then(function(){function complete(){return work(ControlProcessor.processAll).then(function(){return cancelBlocker(dataContext)}).then(function(data){return work(_Declarative.processAll,data,!extractedChild&&!initial,that.bindingCache)}).then(null,function(e){return"object"==typeof e&&"Canceled"===e.name&&(extractedChild||d).dispose(),Promise.wrapError(e)})}var work;if(0===initial)work=function(f,a,b,c){return f(extractedChild||d,a,b,c)};else{var all=d.children;if(all.length===initial+1)work=function(f,a,b,c){return f(all[initial],a,b,c)};else{for(var elements=[],i=initial,l=all.length;l>i;i++)elements.push(all[i]);work=function(f,a,b,c){var join=[];return elements.forEach(function(e){join.push(f(e,a,b,c))}),Promise.join(join)}}}for(var child=d.firstElementChild;child;)child.msParentSelectorScope=!0,child=child.nextElementSibling;var timeout=that.processTimeout;return timeout?(0>timeout&&(timeout=0),Promise.timeout(timeout).then(function(){return workPromise=complete()})):workPromise=complete()}).then(done,function(err){return done(),Promise.wrapError(err)});return{element:element,renderComplete:renderComplete}}var Template=_Base.Class.define(function(element,options){this._element=element||_Global.document.createElement("div"),this._element.winControl=this,this._profilerMarkIdentifier=_BaseUtils._getProfilerMarkIdentifier(this._element),_WriteProfilerMark("WinJS.Binding:newTemplate"+this._profilerMarkIdentifier+",StartTM");var that=this;this._element.renderItem=function(itemPromise,recycled){return that._renderItemImpl(itemPromise,recycled)},options=options||{},this.href=options.href,this.enableRecycling=!!options.enableRecycling,this.processTimeout=options.processTimeout||0,this.bindingInitializer=options.bindingInitializer,this.debugBreakOnRender=options.debugBreakOnRender,this.disableOptimizedProcessing=options.disableOptimizedProcessing,this.extractChild=options.extractChild,this._counter=0,this._compile=!!options._compile,this.href||(this.element.style.display="none"),this.bindingCache={expressions:{}},_WriteProfilerMark("WinJS.Binding:newTemplate"+this._profilerMarkIdentifier+",StopTM")},{_shouldCompile:{get:function(){var shouldCompile=!0;return shouldCompile=shouldCompile&&!Template._interpretAll,shouldCompile=shouldCompile&&!this.disableOptimizedProcessing,shouldCompile&&(shouldCompile=shouldCompile&&0===this.processTimeout,shouldCompile=shouldCompile&&(!this.href||this.href instanceof _Global.HTMLElement),shouldCompile||_Log.log&&_Log.log("Cannot compile templates which use processTimeout or href properties","winjs binding","warn")),shouldCompile}},bindingInitializer:{get:function(){return this._bindingInitializer},set:function(value){this._bindingInitializer=value,this._reset()}},debugBreakOnRender:{get:function(){return this._debugBreakOnRender},set:function(value){this._debugBreakOnRender=!!value,this._reset()}},disableOptimizedProcessing:{get:function(){return this._disableOptimizedProcessing},set:function(value){this._disableOptimizedProcessing=!!value,this._reset()}},element:{get:function(){return this._element}},extractChild:{get:function(){return this._extractChild},set:function(value){this._extractChild=!!value,this._reset()}},processTimeout:{get:function(){return this._processTimeout||0},set:function(value){this._processTimeout=value,this._reset()}},render:_BaseUtils.markSupportedForProcessing(function(dataContext,container){return this._renderImpl(dataContext,container)}),_renderImpl:function(dataContext,container){if(this._shouldCompile)try{return this._renderImpl=this._compileTemplate({target:"render"}),this._renderImpl(dataContext,container)}catch(e){return Promise.wrapError(e)}var render=interpretedRender(this,dataContext,container);return render.element.then(function(){return render.renderComplete})},_renderInterpreted:function(dataContext,container){return interpretedRender(this,dataContext,container)},renderItem:function(item,recycled){return this._renderItemImpl(item,recycled)},_renderItemImpl:function(item,recycled){if(this._shouldCompile)try{return this._renderItemImpl=this._compileTemplate({target:"renderItem"}),this._renderItemImpl(item)}catch(e){return{element:Promise.wrapError(e),renderComplete:Promise.wrapError(e)}}var that=this;if(this.enableRecycling&&!this.bindingCache.elements&&(this.bindingCache.elements={}),this.enableRecycling&&recycled&&recycled.msOriginalTemplate===this){var cacheEntry=this.bindingCache.elements[recycled.id],okToReuse=!0;if(cacheEntry&&(cacheEntry.bindings.forEach(function(v){v()}),cacheEntry.bindings=[],okToReuse=!cacheEntry.nocache),okToReuse)return{element:recycled,renderComplete:item.then(function(item){return _Declarative.processAll(recycled,item.data,!0,that.bindingCache)})}}var render=interpretedRender(this,item.then(function(item){return item.data}));return render.element=render.element.then(function(e){return e.msOriginalTemplate=that,e}),render},_compileTemplate:function(options){var that=this,result=_DataTemplateCompiler._TemplateCompiler.compile(this,this.href||this.element,{debugBreakOnRender:this.debugBreakOnRender||Template._debugBreakOnRender,defaultInitializer:this.bindingInitializer||options.defaultInitializer,disableTextBindingOptimization:options.disableTextBindingOptimization||!1,target:options.target,extractChild:this.extractChild,profilerMarkIdentifier:this._profilerMarkIdentifier}),resetOnFragmentChange=options.resetOnFragmentChange||_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled;if(resetOnFragmentChange){var mo=new _ElementUtilities._MutationObserver(function(){that._reset(),mo.disconnect()});mo.observe(_ElementUtilities.data(this.element).docFragment,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}return result},_reset:function(){delete this._renderImpl,delete this._renderItemImpl}},{isDeclarativeControlContainer:{value:!0,writable:!1,configurable:!1},render:{value:function(href,dataContext,container){return new Template(null,{href:href}).render(dataContext,container)}}});return Template})})}}),define("WinJS/BindingList/_BindingListDataSource",["exports","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Binding/_DomWeakRefTable","../Promise","../Scheduler","../Utilities/_UI"],function(exports,_WinRT,_Base,_ErrorFromName,_DomWeakRefTable,Promise,Scheduler,_UI){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{_BindingListDataSource:_Base.Namespace._lazy(function(){function findNextKey(list,index){for(var len=list.length;len-1>index;){var item=list.getItem(++index);if(item)return item.key}return null}function findPreviousKey(list,index){for(;index>0;){var item=list.getItem(--index);if(item)return item.key}return null}function subscribe(target,handlers){Object.keys(handlers).forEach(function(handler){target.addEventListener(handler,handlers[handler])})}function unsubscribe(target,handlers){Object.keys(handlers).forEach(function(handler){target.removeEventListener(handler,handlers[handler])})}function wrap(listBinding,item){return item?new WrappedItem(listBinding,item):new NullWrappedItem}function wrapAsync(listBinding,item,name){return item?new AsyncWrappedItem(listBinding,item,name):new NullWrappedItem}function cloneWithIndex(list,item,index){return item&&list._annotateWithIndex(item,index)}function insertAtStart(unused,data){return this._list.unshift(data),this.itemFromIndex(0)}function insertBefore(unused,data,nextKey){var index=this._list.indexOfKey(nextKey);return-1===index?errors.noLongerMeaningful:(this._list.splice(index,0,data),this.itemFromIndex(index))}function insertAfter(unused,data,previousKey){var index=this._list.indexOfKey(previousKey);return-1===index?errors.noLongerMeaningful:(index+=1,this._list.splice(index,0,data),this.itemFromIndex(index))}function insertAtEnd(unused,data){return this._list.push(data),this.itemFromIndex(this._list.length-1)}function change(key,newData){var index=this._list.indexOfKey(key);return-1===index?errors.noLongerMeaningful:(this._list.setAt(index,newData),this.itemFromIndex(index))}function moveToStart(key){var sourceIndex=this._list.indexOfKey(key);if(-1===sourceIndex)return errors.noLongerMeaningful;var targetIndex=0;return this._list.move(sourceIndex,targetIndex),this.itemFromIndex(targetIndex)}function moveBefore(key,nextKey){var sourceIndex=this._list.indexOfKey(key),targetIndex=this._list.indexOfKey(nextKey);return-1===sourceIndex||-1===targetIndex?errors.noLongerMeaningful:(targetIndex=targetIndex>sourceIndex?targetIndex-1:targetIndex,this._list.move(sourceIndex,targetIndex),this.itemFromIndex(targetIndex))}function moveAfter(key,previousKey){var sourceIndex=this._list.indexOfKey(key),targetIndex=this._list.indexOfKey(previousKey);return-1===sourceIndex||-1===targetIndex?errors.noLongerMeaningful:(targetIndex=targetIndex>=sourceIndex?targetIndex:targetIndex+1,this._list.move(sourceIndex,targetIndex),this.itemFromIndex(targetIndex))}function moveToEnd(key){var sourceIndex=this._list.indexOfKey(key);if(-1===sourceIndex)return errors.noLongerMeaningful;var targetIndex=this._list.length-1;return this._list.move(sourceIndex,targetIndex),this.itemFromIndex(targetIndex)}function remove(key){var index=this._list.indexOfKey(key);return-1===index?errors.noLongerMeaningful:(this._list.splice(index,1),Promise.wrap())}var errors={get noLongerMeaningful(){return Promise.wrapError(new _ErrorFromName(_UI.EditError.noLongerMeaningful))}},CompletePromise=Promise.wrap().constructor,NullWrappedItem=_Base.Class.derive(CompletePromise,function(){this._value=null},{release:function(){},retain:function(){return this}},{supportedForProcessing:!1}),WrappedItem=_Base.Class.derive(CompletePromise,function(listBinding,item){this._value=item,this._listBinding=listBinding},{handle:{get:function(){return this._value.key}},index:{get:function(){return this._value.index}},release:function(){this._listBinding._release(this._value,this._listBinding._list.indexOfKey(this._value.key))},retain:function(){return this._listBinding._addRef(this._value,this._listBinding._list.indexOfKey(this._value.key)),this}},{supportedForProcessing:!1}),AsyncWrappedItem=_Base.Class.derive(Promise,function(listBinding,item,name){var that=this;this._item=item,this._listBinding=listBinding,Promise.call(this,function(c){Scheduler.schedule(function(){return listBinding._released?void that.cancel():void c(item)},Scheduler.Priority.normal,null,"WinJS.Binding.List."+name)})},{handle:{get:function(){return this._item.key}},index:{get:function(){return this._item.index}},release:function(){this._listBinding._release(this._item,this._listBinding._list.indexOfKey(this._item.key))},retain:function(){return this._listBinding._addRef(this._item,this._listBinding._list.indexOfKey(this._item.key)),this}},{supportedForProcessing:!1}),ListBinding=_Base.Class.define(function(dataSource,list,notificationHandler,id){this._dataSource=dataSource,this._list=list,this._editsCount=0,this._notificationHandler=notificationHandler,this._pos=-1,this._retained=[],this._retained.length=list.length,this._retainedKeys={},this._affectedRange=null;var fallbackReference=null;if(_WinRT.msSetWeakWinRTProperty&&_WinRT.msGetWeakWinRTProperty||(fallbackReference=this),notificationHandler){var handleEvent=function(eventName,eventArg){var lb=_DomWeakRefTable._getWeakRefElement(id)||fallbackReference;return lb?(lb["_"+eventName](eventArg),!0):!1};this._handlers={itemchanged:function handler(event){handleEvent("itemchanged",event)||list.removeEventListener("itemchanged",handler)},iteminserted:function handler(event){handleEvent("iteminserted",event)||list.removeEventListener("iteminserted",handler)},itemmoved:function handler(event){handleEvent("itemmoved",event)||list.removeEventListener("itemmoved",handler)},itemremoved:function handler(event){handleEvent("itemremoved",event)||list.removeEventListener("itemremoved",handler)},reload:function handler(){handleEvent("reload")||list.removeEventListener("reload",handler)}},subscribe(this._list,this._handlers)}},{_itemchanged:function(event){var key=event.detail.key,index=event.detail.index;this._updateAffectedRange(index,"changed");var newItem=event.detail.newItem,oldItem=this._retained[index];if(oldItem){var handler=this._notificationHandler;if(oldItem.index!==index){var oldIndex=oldItem.index;oldItem.index=index,handler&&handler.indexChanged&&handler.indexChanged(newItem.key,index,oldIndex)}newItem=cloneWithIndex(this._list,newItem,index),newItem._retainedCount=oldItem._retainedCount,this._retained[index]=newItem,this._retainedKeys[key]=newItem,this._beginEdits(this._list.length),handler&&handler.changed&&handler.changed(newItem,oldItem),this._endEdits()}else this._beginEdits(this._list.length),this._endEdits()},_iteminserted:function(event){var index=event.detail.index;this._updateAffectedRange(index,"inserted"),this._beginEdits(this._list.length-1),index<=this._pos&&(this._pos=Math.min(this._pos+1,this._list.length));var retained=this._retained;if(retained.splice(index,0,0),delete retained[index],this._shouldNotify(index)||1===this._list.length){var handler=this._notificationHandler;handler&&handler.inserted&&handler.inserted(wrap(this,cloneWithIndex(this._list,this._list.getItem(index),index)),findPreviousKey(this._list,index),findNextKey(this._list,index))}this._endEdits()},_itemmoved:function(event){var oldIndex=event.detail.oldIndex,newIndex=event.detail.newIndex;this._updateAffectedRange(oldIndex,"moved"),this._updateAffectedRange(newIndex,"moved"),this._beginEdits(this._list.length),(oldIndex<this._pos||newIndex<=this._pos)&&(newIndex>this._pos?this._pos=Math.max(-1,this._pos-1):oldIndex>this._pos&&(this._pos=Math.min(this._pos+1,this._list.length)));var retained=this._retained,item=retained.splice(oldIndex,1)[0];retained.splice(newIndex,0,item),item||(delete retained[newIndex],item=cloneWithIndex(this._list,this._list.getItem(newIndex),newIndex)),item._moved=!0,this._addRef(item,newIndex),this._endEdits()},_itemremoved:function(event){var key=event.detail.key,index=event.detail.index;this._updateAffectedRange(index,"removed"),this._beginEdits(this._list.length+1),index<this._pos&&(this._pos=Math.max(-1,this._pos-1));var retained=this._retained,retainedKeys=this._retainedKeys,wasRetained=index in retained;retained.splice(index,1),delete retainedKeys[key];var handler=this._notificationHandler;wasRetained&&handler&&handler.removed&&handler.removed(key,!1),this._endEdits()},_reload:function(){this._retained=[],this._retainedKeys={};var handler=this._notificationHandler;handler&&handler.reload&&handler.reload()},_addRef:function(item,index){index in this._retained?this._retained[index]._retainedCount++:(this._retained[index]=item,this._retainedKeys[item.key]=item,item._retainedCount=1)},_release:function(item,index){var retained=this._retained[index];retained&&(1===retained._retainedCount?(delete this._retained[index],delete this._retainedKeys[retained.key]):retained._retainedCount--)},_shouldNotify:function(index){var retained=this._retained;return index in retained||index+1 in retained||index-1 in retained},_updateAffectedRange:function(index,operation){if(this._notificationHandler.affectedRange){var newStart=index,newEnd="removed"!==operation?index+1:index;if(this._affectedRange){switch(operation){case"inserted":index<=this._affectedRange.end&&++this._affectedRange.end;break;case"removed":index<this._affectedRange.end&&--this._affectedRange.end;break;case"moved":case"changed":}this._affectedRange.start=Math.min(this._affectedRange.start,newStart),this._affectedRange.end=Math.max(this._affectedRange.end,newEnd)}else this._affectedRange={start:newStart,end:newEnd}}},_notifyAffectedRange:function(){this._affectedRange&&(this._notificationHandler&&this._notificationHandler.affectedRange&&this._notificationHandler.affectedRange(this._affectedRange),this._affectedRange=null)},_notifyCountChanged:function(){var oldCount=this._countAtBeginEdits,newCount=this._list.length;if(oldCount!==newCount){var handler=this._notificationHandler;handler&&handler.countChanged&&handler.countChanged(newCount,oldCount)}},_notifyIndicesChanged:function(){for(var retained=this._retained,i=0,len=retained.length;len>i;i++){var item=retained[i];if(item&&item.index!==i){var newIndex=i,oldIndex=item.index;item.index=newIndex;var handler=this._notificationHandler;handler&&handler.indexChanged&&handler.indexChanged(item.key,newIndex,oldIndex)}}},_notifyMoved:function(){for(var retained=this._retained,i=0,len=retained.length;len>i;i++){var item=retained[i];if(item&&item._moved&&(item._moved=!1,this._release(item,i),this._shouldNotify(i))){var handler=this._notificationHandler;handler&&handler.moved&&handler.moved(wrap(this,item),findPreviousKey(this._list,i),findNextKey(this._list,i))}}},_beginEdits:function(length,explicit){this._editsCount++;var handler=this._notificationHandler;if(1===this._editsCount&&handler){if(!explicit){this._editsCount++;var that=this;Scheduler.schedule(function(){that._endEdits()},Scheduler.Priority.high,null,"WinJS.Binding.List._endEdits")}handler.beginNotifications&&handler.beginNotifications(),this._countAtBeginEdits=length}},_endEdits:function(){this._editsCount--;var handler=this._notificationHandler;0===this._editsCount&&handler&&(this._notifyIndicesChanged(),this._notifyMoved(),this._notifyCountChanged(),this._notifyAffectedRange(),handler.endNotifications&&handler.endNotifications())},jumpToItem:function(item){var index=this._list.indexOfKey(item.handle);return-1===index?Promise.wrap(null):(this._pos=index,this.current())},current:function(){return this.fromIndex(this._pos)},previous:function(){return this._pos=Math.max(-1,this._pos-1),this._fromIndex(this._pos,!0,"previous")},next:function(){return this._pos=Math.min(this._pos+1,this._list.length),this._fromIndex(this._pos,!0,"next")},releaseItem:function(item){item.release?item.release():this._release(item,this._list.indexOfKey(item.key))},release:function(){this._notificationHandler&&unsubscribe(this._list,this._handlers),this._notificationHandler=null,this._dataSource._releaseBinding(this),this._released=!0},first:function(){return this.fromIndex(0)},last:function(){return this.fromIndex(this._list.length-1)},fromKey:function(key){var item,retainedKeys=this._retainedKeys;return item=key in retainedKeys?retainedKeys[key]:cloneWithIndex(this._list,this._list.getItemFromKey(key),this._list.indexOfKey(key)),wrap(this,item)},fromIndex:function(index){return this._fromIndex(index,!1,"fromIndex")},_fromIndex:function(index,async,name){var item,retained=this._retained;return item=index in retained?retained[index]:cloneWithIndex(this._list,this._list.getItem(index),index),async?wrapAsync(this,item,name):wrap(this,item)}},{supportedForProcessing:!1}),bindingId=0,DataSource=_Base.Class.define(function(list){this._usingWeakRef=_WinRT.msSetWeakWinRTProperty&&_WinRT.msGetWeakWinRTProperty,this._bindings={},this._list=list,list.unshift&&(this.insertAtStart=insertAtStart),list.push&&(this.insertAtEnd=insertAtEnd),list.setAt&&(this.change=change),list.splice&&(this.insertAfter=insertAfter,this.insertBefore=insertBefore,this.remove=remove),list.move&&(this.moveAfter=moveAfter,this.moveBefore=moveBefore,this.moveToEnd=moveToEnd,this.moveToStart=moveToStart)},{_releaseBinding:function(binding){delete this._bindings[binding._id]},addEventListener:function(){},removeEventListener:function(){},createListBinding:function(notificationHandler){var id="ds_"+ ++bindingId,binding=new ListBinding(this,this._list,notificationHandler,id);return binding._id=id,this._usingWeakRef?(_DomWeakRefTable._createWeakRef(binding,id),this._bindings[id]=id):this._bindings[id]=binding,binding},getCount:function(){return Promise.wrap(this._list.length)},itemFromKey:function(key){var list=this._list,item=cloneWithIndex(list,list.getItemFromKey(key),-1);return Object.defineProperty(item,"index",{get:function(){return list.indexOfKey(key)},enumerable:!1,configurable:!0}),Promise.wrap(item)},itemFromIndex:function(index){return Promise.wrap(cloneWithIndex(this._list,this._list.getItem(index),index))},list:{get:function(){return this._list}},beginEdits:function(){var length=this._list.length;this._forEachBinding(function(binding){binding._beginEdits(length,!0)})},endEdits:function(){this._forEachBinding(function(binding){binding._endEdits()})},_forEachBinding:function(callback){if(this._usingWeakRef){var toBeDeleted=[];Object.keys(this._bindings).forEach(function(id){var lb=_DomWeakRefTable._getWeakRefElement(id);lb?callback(lb):toBeDeleted.push(id)});for(var i=0,len=toBeDeleted.length;len>i;i++)delete this._bindings[toBeDeleted[i]]}else{var that=this;Object.keys(this._bindings).forEach(function(id){callback(that._bindings[id])})}},invalidateAll:function(){return Promise.wrap()},moveAfter:void 0,moveBefore:void 0,moveToEnd:void 0,moveToStart:void 0},{supportedForProcessing:!1});return DataSource})})}),define("WinJS/BindingList",["exports","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Events","./Core/_Resources","./Binding/_Data","./BindingList/_BindingListDataSource"],function(exports,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_Data,_BindingListDataSource){"use strict";function copyargs(args){return Array.prototype.slice.call(args,0)}function cloneItem(item){return{handle:item.handle,key:item.key,data:item.data,groupKey:item.groupKey,groupSize:item.groupSize,firstItemKey:item.firstItemKey,firstItemIndexHint:item.firstItemIndexHint}}function asNumber(n){return void 0===n?void 0:+n}function mergeSort(arr,sorter){function copyBack(start,end){for(;end>start;start++)arr[start]=temp[start]}function sort(start,end){if(!(2>end-start)){var middle=Math.floor((end+start)/2);sort(start,middle),sort(middle,end),merge(start,middle,end),copyBack(start,end)}}function merge(start,middle,end){for(var left=start,right=middle,i=start;end>i;i++)middle>left&&(right>=end||sorter(arr[left],arr[right])<=0)?(temp[i]=arr[left],left++):(temp[i]=arr[right],right++)}var temp=new Array(arr.length);return sort(0,arr.length),arr}var strings={get sparseArrayNotSupported(){return"Sparse arrays are not supported with proxy: true"},get illegalListLength(){return"List length must be assigned a finite positive number"}},createEvent=_Events._createEventProperty,emptyOptions={},ns=_Base.Namespace.defineWithParent(null,null,{ListBase:_Base.Namespace._lazy(function(){var ListBase=_Base.Class.define(null,{_annotateWithIndex:function(item,index){var result=cloneItem(item);return result.index=index,result},onitemchanged:createEvent("itemchanged"),oniteminserted:createEvent("iteminserted"),onitemmoved:createEvent("itemmoved"),onitemmutated:createEvent("itemmutated"),onitemremoved:createEvent("itemremoved"),onreload:createEvent("reload"),_notifyItemChanged:function(key,index,oldValue,newValue,oldItem,newItem){this._listeners&&this._listeners.itemchanged&&this.dispatchEvent("itemchanged",{key:key,index:index,oldValue:oldValue,newValue:newValue,oldItem:oldItem,newItem:newItem})},_notifyItemInserted:function(key,index,value){this._listeners&&this._listeners.iteminserted&&this.dispatchEvent("iteminserted",{key:key,index:index,value:value});var len=this.length;len!==this._lastNotifyLength&&(this.notify("length",len,this._lastNotifyLength),this._lastNotifyLength=len)},_notifyItemMoved:function(key,oldIndex,newIndex,value){this._listeners&&this._listeners.itemmoved&&this.dispatchEvent("itemmoved",{key:key,oldIndex:oldIndex,newIndex:newIndex,value:value})},_notifyItemMutated:function(key,value,item){this._listeners&&this._listeners.itemmutated&&this.dispatchEvent("itemmutated",{key:key,value:value,item:item})},_notifyItemRemoved:function(key,index,value,item){this._listeners&&this._listeners.itemremoved&&this.dispatchEvent("itemremoved",{key:key,index:index,value:value,item:item});var len=this.length;len!==this._lastNotifyLength&&(this.notify("length",len,this._lastNotifyLength),this._lastNotifyLength=len)},_notifyReload:function(){if(this._listeners&&this._listeners.reload&&this.dispatchEvent("reload"),len!==this._lastNotifyLength){var len=this.length;this.notify("length",len,this._lastNotifyLength),this._lastNotifyLength=len}},_normalizeIndex:function(index){return index=asNumber(index),0>index?this.length+index:index},_notifyMutatedFromKey:function(key){var item=this.getItemFromKey(key);this._notifyItemMutated(key,item.data,item)},notifyReload:function(){this._notifyReload()},getAt:function(index){index=asNumber(index);var item=this.getItem(index);return item&&item.data},_getArray:function(){for(var results=new Array(this.length),i=0,len=this.length;len>i;i++){var item=this.getItem(i);item&&(results[i]=item.data)}return results},_getFromKey:function(key){var item=this.getItemFromKey(key);return item&&item.data},_getKey:function(index){index=asNumber(index);var item=this.getItem(index);return item&&item.key},concat:function(){var a=this._getArray();return a.concat.apply(a,arguments)},join:function(separator){return this._getArray().join(separator||",")},slice:function(begin,end){return this._getArray().slice(begin,end)},indexOf:function(searchElement,fromIndex){fromIndex=asNumber(fromIndex),fromIndex=Math.max(0,this._normalizeIndex(fromIndex)||0);for(var i=fromIndex,len=this.length;len>i;i++){var item=this.getItem(i);if(item&&item.data===searchElement)return i}return-1},lastIndexOf:function(searchElement,fromIndex){fromIndex=asNumber(fromIndex);var length=this.length;fromIndex=Math.min(this._normalizeIndex(void 0!==fromIndex?fromIndex:length),length-1);var i;for(i=fromIndex;i>=0;i--){var item=this.getItem(i);if(item&&item.data===searchElement)return i}return-1},every:function(callback,thisArg){return this._getArray().every(callback,thisArg)},filter:function(callback,thisArg){return this._getArray().filter(callback,thisArg)},forEach:function(callback,thisArg){this._getArray().forEach(callback,thisArg)},map:function(callback,thisArg){return this._getArray().map(callback,thisArg)},some:function(callback,thisArg){return this._getArray().some(callback,thisArg)},reduce:function(callback,initialValue){return arguments.length>1?this._getArray().reduce(callback,initialValue):this._getArray().reduce(callback)},reduceRight:function(callback,initialValue){return arguments.length>1?this._getArray().reduceRight(callback,initialValue):this._getArray().reduceRight(callback)},createFiltered:function(predicate){return new ns.FilteredListProjection(this,predicate)},createGrouped:function(groupKey,groupData,groupSorter){return new ns.GroupedSortedListProjection(this,groupKey,groupData,groupSorter)},createSorted:function(sorter){return new ns.SortedListProjection(this,sorter)},dataSource:{get:function(){return this._dataSource=this._dataSource||new _BindingListDataSource._BindingListDataSource(this)}}},{supportedForProcessing:!1});return _Base.Class.mix(ListBase,_Data.observableMixin),_Base.Class.mix(ListBase,_Events.eventMixin),ListBase}),ListBaseWithMutators:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.ListBase,null,{pop:function(){return this.splice(-1,1)[0]},push:function(value){if(1===arguments.length)return this.splice(this.length,0,value),this.length;var args=copyargs(arguments);return args.splice(0,0,this.length,0),this.splice.apply(this,args),this.length},shift:function(){return this.splice(0,1)[0]},unshift:function(value){if(1===arguments.length)this.splice(0,0,value);else{var args=copyargs(arguments);args.splice(0,0,0,0),this.splice.apply(this,args)}return this.length}},{supportedForProcessing:!1})}),ListProjection:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.ListBaseWithMutators,null,{_list:null,_myListeners:null,_addListListener:function(name,func){var l={name:name,handler:func.bind(this)};this._myListeners=this._myListeners||[],this._myListeners.push(l),this._list.addEventListener(name,l.handler)},dispose:function(){var list=this._list,listeners=this._myListeners;this._myListeners=[];for(var i=0,len=listeners.length;len>i;i++){var l=listeners[i];list.removeEventListener(l.name,l.handler)}this._list=new exports.List,this._listReload()},getItemFromKey:function(key){return this._list.getItemFromKey(key)},move:function(index,newIndex){index=asNumber(index),newIndex=asNumber(newIndex),index===newIndex||0>index||0>newIndex||index>=this.length||newIndex>=this.length||(index=this._list.indexOfKey(this._getKey(index)),newIndex=this._list.indexOfKey(this._getKey(newIndex)),this._list.move(index,newIndex))},_notifyMutatedFromKey:function(key){this._list._notifyMutatedFromKey(key)},splice:function(index,howMany,item){index=asNumber(index),index=Math.max(0,this._normalizeIndex(index));var args=copyargs(arguments);return index===this.length?(args[0]=this._list.length,this._list.splice.apply(this._list,args)):(args[0]=this._getKey(index),this._spliceFromKey.apply(this,args))},_setAtKey:function(key,value){this._list._setAtKey(key,value)}},{supportedForProcessing:!1})}),FilteredListProjection:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.ListProjection,function(list,filter){this._list=list,this._addListListener("itemchanged",this._listItemChanged),this._addListListener("iteminserted",this._listItemInserted),this._addListListener("itemmutated",this._listItemMutated),this._addListListener("itemmoved",this._listItemMoved),this._addListListener("itemremoved",this._listItemRemoved),this._addListListener("reload",this._listReload),this._filter=filter,this._initFilteredKeys()},{_filter:null,_filteredKeys:null,_initFilteredKeys:function(){for(var filter=this._filter,list=this._list,keys=[],i=0,len=list.length;len>i;i++){var item=list.getItem(i);item&&filter(item.data)&&keys.push(item.key)}this._filteredKeys=keys},_findInsertionPosition:function(key,index){for(var previousKey,filter=this._filter;--index>=0;){var item=this._list.getItem(index);if(item&&filter(item.data)){previousKey=item.key;break}}var filteredKeys=this._filteredKeys,filteredIndex=previousKey?filteredKeys.indexOf(previousKey)+1:0;return filteredIndex},_listItemChanged:function(event){var key=event.detail.key,index=event.detail.index,oldValue=event.detail.oldValue,newValue=event.detail.newValue,oldItem=event.detail.oldItem,newItem=event.detail.newItem,filter=this._filter,oldInFilter=filter(oldValue),newInFilter=filter(newValue);
if(oldInFilter&&newInFilter){var filteredKeys=this._filteredKeys,filteredIndex=filteredKeys.indexOf(key);this._notifyItemChanged(key,filteredIndex,oldValue,newValue,oldItem,newItem)}else oldInFilter&&!newInFilter?this._listItemRemoved({detail:{key:key,index:index,value:oldValue,item:oldItem}}):!oldInFilter&&newInFilter&&this._listItemInserted({detail:{key:key,index:index,value:newValue}})},_listItemInserted:function(event){var key=event.detail.key,index=event.detail.index,value=event.detail.value,filter=this._filter;if(filter(value)){var filteredIndex=this._findInsertionPosition(key,index),filteredKeys=this._filteredKeys;filteredKeys.splice(filteredIndex,0,key),this._notifyItemInserted(key,filteredIndex,value)}},_listItemMoved:function(event){var key=event.detail.key,newIndex=event.detail.newIndex,value=event.detail.value,filteredKeys=this._filteredKeys,oldFilteredIndex=filteredKeys.indexOf(key);if(-1!==oldFilteredIndex){filteredKeys.splice(oldFilteredIndex,1);var newFilteredIndex=this._findInsertionPosition(key,newIndex);filteredKeys.splice(newFilteredIndex,0,key),this._notifyItemMoved(key,oldFilteredIndex,newFilteredIndex,value)}},_listItemMutated:function(event){var key=event.detail.key,value=event.detail.value,item=event.detail.item,filter=this._filter,filteredKeys=this._filteredKeys,filteredIndex=filteredKeys.indexOf(key),oldInFilter=-1!==filteredIndex,newInFilter=filter(value);oldInFilter&&newInFilter?this._notifyItemMutated(key,value,item):oldInFilter&&!newInFilter?(filteredKeys.splice(filteredIndex,1),this._notifyItemRemoved(key,filteredIndex,value,item)):!oldInFilter&&newInFilter&&this._listItemInserted({detail:{key:key,index:this._list.indexOfKey(key),value:value}})},_listItemRemoved:function(event){var key=event.detail.key,value=event.detail.value,item=event.detail.item,filteredKeys=this._filteredKeys,filteredIndex=filteredKeys.indexOf(key);-1!==filteredIndex&&(filteredKeys.splice(filteredIndex,1),this._notifyItemRemoved(key,filteredIndex,value,item))},_listReload:function(){this._initFilteredKeys(),this._notifyReload()},length:{get:function(){return this._filteredKeys.length},set:function(value){if(!("number"==typeof value&&value>=0))throw new _ErrorFromName("WinJS.Binding.List.IllegalLength",strings.illegalListLength);var current=this.length;current>value&&this.splice(value,current-value)}},getItem:function(index){return index=asNumber(index),this.getItemFromKey(this._filteredKeys[index])},indexOfKey:function(key){return this._filteredKeys.indexOf(key)},notifyMutated:function(index){return index=asNumber(index),this._notifyMutatedFromKey(this._filteredKeys[index])},setAt:function(index,value){index=asNumber(index),this._setAtKey(this._filteredKeys[index],value)},_spliceFromKey:function(key,howMany){if(arguments.length>2){var args=copyargs(arguments);args[1]=0,this._list._spliceFromKey.apply(this._list,args)}var result=[];if(howMany){for(var keysToRemove=[],filteredKeys=this._filteredKeys,filteredKeyIndex=filteredKeys.indexOf(key),i=filteredKeyIndex,len=filteredKeys.length;len>i&&howMany>i-filteredKeyIndex;i++){var key=filteredKeys[i];keysToRemove.push(key)}var that=this;keysToRemove.forEach(function(key){result.push(that._list._spliceFromKey(key,1)[0])})}return result}},{supportedForProcessing:!1})}),SortedListProjection:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.ListProjection,function(list,sortFunction){this._list=list,this._addListListener("itemchanged",this._listItemChanged),this._addListListener("iteminserted",this._listItemInserted),this._addListListener("itemmoved",this._listItemMoved),this._addListListener("itemmutated",this._listItemMutated),this._addListListener("itemremoved",this._listItemRemoved),this._addListListener("reload",this._listReload),this._sortFunction=sortFunction,this._initSortedKeys()},{_sortFunction:null,_sortedKeys:null,_initSortedKeys:function(){for(var list=this._list,keys=[],i=0,len=list.length;len>i;i++){var item=list.getItem(i);item&&(keys[i]=item.key)}var sorter=this._sortFunction,sorted=mergeSort(keys,function(l,r){return l=list.getItemFromKey(l).data,r=list.getItemFromKey(r).data,sorter(l,r)});this._sortedKeys=sorted},_findInsertionPos:function(key,index,value,startingMin,startingMax){for(var sorter=this._sortFunction,sortedKeys=this._sortedKeys,min=Math.max(0,startingMin||-1),max=Math.min(sortedKeys.length,startingMax||Number.MAX_VALUE),mid=min;max>=min;){mid=(min+max)/2>>>0;var sortedKey=sortedKeys[mid];if(!sortedKey)break;var sortedItem=this.getItemFromKey(sortedKey),r=sorter(sortedItem.data,value);if(0>r)min=mid+1;else{if(0===r)return this._findStableInsertionPos(key,index,min,max,mid,value);max=mid-1}}return min},_findBeginningOfGroup:function(mid,sorter,list,sortedKeys,value){for(var min=0,max=mid;max>=min;){mid=(min+max)/2>>>0;var sortedKey=sortedKeys[mid],sortedItem=list.getItemFromKey(sortedKey),r=sorter(sortedItem.data,value);0>r?min=mid+1:max=mid-1}return min},_findEndOfGroup:function(mid,sorter,list,sortedKeys,value){for(var min=mid,max=sortedKeys.length;max>=min;){mid=(min+max)/2>>>0;var sortedKey=sortedKeys[mid];if(!sortedKey)return sortedKeys.length;var sortedItem=list.getItemFromKey(sortedKey),r=sorter(sortedItem.data,value);0>=r?min=mid+1:max=mid-1}return min},_findStableInsertionPos:function(key,index,min,max,mid,value){var list=this._list,length=list.length,sorter=this._sortFunction,sortedKeys=this._sortedKeys;if(length/2>index){for(var i=index-1;i>=0;i--){var item=list.getItem(i);if(0===sorter(item.data,value))return length-min>max?sortedKeys.indexOf(item.key,min)+1:sortedKeys.lastIndexOf(item.key,max)+1}return this._findBeginningOfGroup(mid,sorter,list,sortedKeys,value)}for(var i=index+1;length>i;i++){var item=list.getItem(i);if(0===sorter(item.data,value))return length-min>max?sortedKeys.indexOf(item.key,min):sortedKeys.lastIndexOf(item.key,max)}return this._findEndOfGroup(mid,sorter,list,sortedKeys,value)},_listItemChanged:function(event){var key=event.detail.key,newValue=event.detail.newValue,oldValue=event.detail.oldValue,sortFunction=this._sortFunction;if(0===sortFunction(oldValue,newValue)){var sortedIndex=this.indexOfKey(key);this._notifyItemChanged(key,sortedIndex,oldValue,newValue,event.detail.oldItem,event.detail.newItem)}else this._listItemRemoved({detail:{key:key,index:event.detail.index,value:event.detail.oldValue,item:event.detail.oldItem}}),this._listItemInserted({detail:{key:key,index:event.detail.index,value:event.detail.newValue}})},_listItemInserted:function(event,knownMin,knownMax){var key=event.detail.key,index=event.detail.index,value=event.detail.value,sortedIndex=this._findInsertionPos(key,index,value,knownMin,knownMax);this._sortedKeys.splice(sortedIndex,0,key),this._notifyItemInserted(key,sortedIndex,value)},_listItemMoved:function(event,knownMin,knownMax){var key=event.detail.key,newIndex=event.detail.newIndex,value=event.detail.value,sortedKeys=this._sortedKeys,oldSortedIndex=sortedKeys.indexOf(key,knownMin);sortedKeys.splice(oldSortedIndex,1);var newSortedIndex=this._findInsertionPos(key,newIndex,value,knownMin,knownMax);sortedKeys.splice(newSortedIndex,0,key),newSortedIndex!==oldSortedIndex&&this._notifyItemMoved(key,oldSortedIndex,newSortedIndex,value)},_listItemMutated:function(event){var key=event.detail.key,value=event.detail.value,item=event.detail.item,index=this._list.indexOfKey(key),sortedIndex=this._sortedKeys.indexOf(key);this._sortedKeys.splice(sortedIndex,1);var targetIndex=this._findInsertionPos(key,index,value);return this._sortedKeys.splice(sortedIndex,0,key),sortedIndex===targetIndex?void this._notifyItemMutated(key,value,item):(this._listItemRemoved({detail:{key:key,index:index,value:value,item:item}}),void this._listItemInserted({detail:{key:key,index:index,value:value}}))},_listItemRemoved:function(event,knownMin){var key=event.detail.key,value=event.detail.value,item=event.detail.item,sortedKeys=this._sortedKeys,sortedIndex=sortedKeys.indexOf(key,knownMin);sortedKeys.splice(sortedIndex,1),this._notifyItemRemoved(key,sortedIndex,value,item)},_listReload:function(){this._initSortedKeys(),this._notifyReload()},length:{get:function(){return this._sortedKeys.length},set:function(value){if(!("number"==typeof value&&value>=0))throw new _ErrorFromName("WinJS.Binding.List.IllegalLength",strings.illegalListLength);var current=this.length;current>value&&this.splice(value,current-value)}},getItem:function(index){return index=asNumber(index),this.getItemFromKey(this._sortedKeys[index])},indexOfKey:function(key){return this._sortedKeys.indexOf(key)},notifyMutated:function(index){index=asNumber(index),this._notifyMutatedFromKey(this._sortedKeys[index])},setAt:function(index,value){index=asNumber(index),this._setAtKey(this._sortedKeys[index],value)},_spliceFromKey:function(key,howMany){if(arguments.length>2){var args=copyargs(arguments);args[1]=0,this._list._spliceFromKey.apply(this._list,args)}var result=[];if(howMany){for(var keysToRemove=[],sortedKeys=this._sortedKeys,sortedKeyIndex=sortedKeys.indexOf(key),i=sortedKeyIndex,len=sortedKeys.length;len>i&&howMany>i-sortedKeyIndex;i++)keysToRemove.push(sortedKeys[i]);var that=this;keysToRemove.forEach(function(key){result.push(that._list._spliceFromKey(key,1)[0])})}return result}},{supportedForProcessing:!1})}),GroupedSortedListProjection:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.SortedListProjection,function(list,groupKeyOf,groupDataOf,groupSorter){this._list=list,this._addListListener("itemchanged",this._listGroupedItemChanged),this._addListListener("iteminserted",this._listGroupedItemInserted),this._addListListener("itemmoved",this._listGroupedItemMoved),this._addListListener("itemmutated",this._listGroupedItemMutated),this._addListListener("itemremoved",this._listGroupedItemRemoved),this._addListListener("reload",this._listReload),this._sortFunction=function(l,r){return l=groupKeyOf(l),r=groupKeyOf(r),groupSorter?groupSorter(l,r):r>l?-1:l===r?0:1},this._groupKeyOf=groupKeyOf,this._groupDataOf=groupDataOf,this._initSortedKeys(),this._initGroupedItems()},{_groupKeyOf:null,_groupDataOf:null,_groupedItems:null,_initGroupedItems:function(){for(var groupedItems={},list=this._list,groupKeyOf=this._groupKeyOf,i=0,len=list.length;len>i;i++){var item=cloneItem(list.getItem(i));item.groupKey=groupKeyOf(item.data),groupedItems[item.key]=item}this._groupedItems=groupedItems},_groupsProjection:null,_listGroupedItemChanged:function(event){var key=event.detail.key,oldValue=event.detail.oldValue,newValue=event.detail.newValue,groupedItems=this._groupedItems,oldGroupedItem=groupedItems[key],newGroupedItem=cloneItem(oldGroupedItem);newGroupedItem.data=newValue,newGroupedItem.groupKey=this._groupKeyOf(newValue),groupedItems[key]=newGroupedItem;var index;oldGroupedItem.groupKey===newGroupedItem.groupKey?(index=this.indexOfKey(key),this._notifyItemChanged(key,index,oldValue,newValue,oldGroupedItem,newGroupedItem)):(index=event.detail.index,this._listItemChanged({detail:{key:key,index:index,oldValue:oldValue,newValue:newValue,oldItem:oldGroupedItem,newItem:newGroupedItem}}))},_listGroupedItemInserted:function(event){var key=event.detail.key,value=event.detail.value,groupKey=this._groupKeyOf(value);this._groupedItems[key]={handle:key,key:key,data:value,groupKey:groupKey};var groupMin,groupMax;if(this._groupsProjection){var groupItem=this._groupsProjection._groupItems[groupKey];groupItem&&(groupMin=groupItem.firstItemIndexHint,groupMax=groupMin+groupItem.groupSize)}this._listItemInserted(event,groupMin,groupMax)},_listGroupedItemMoved:function(event){var groupMin,groupMax,groupKey=this._groupedItems[event.detail.key].groupKey;if(this._groupsProjection){var groupItem=this._groupsProjection._groupItems[groupKey];groupMin=groupItem.firstItemIndexHint,groupMax=groupMin+groupItem.groupSize}this._listItemMoved(event,groupMin,groupMax)},_listGroupedItemMutated:function(event){var key=event.detail.key,value=event.detail.value,groupedItems=this._groupedItems,oldGroupedItem=groupedItems[key],groupKey=this._groupKeyOf(value);if(oldGroupedItem.groupKey===groupKey)this._notifyItemMutated(key,value,oldGroupedItem);else{var newGroupedItem=cloneItem(oldGroupedItem);newGroupedItem.groupKey=groupKey,groupedItems[key]=newGroupedItem;var index=this._list.indexOfKey(key);this._listItemRemoved({detail:{key:key,index:index,value:value,item:oldGroupedItem}}),this._listItemInserted({detail:{key:key,index:index,value:value}})}},_listGroupedItemRemoved:function(event){var key=event.detail.key,index=event.detail.index,value=event.detail.value,groupedItems=this._groupedItems,groupedItem=groupedItems[key];delete groupedItems[key];var groupMin,groupMax;if(this._groupsProjection){var groupItem=this._groupsProjection._groupItems[groupedItem.groupKey];groupMin=groupItem.firstItemIndexHint,groupMax=groupMin+groupItem.groupSize}this._listItemRemoved({detail:{key:key,index:index,value:value,item:groupedItem}},groupMin,groupMax)},_listReload:function(){this._initGroupedItems(),ns.SortedListProjection.prototype._listReload.call(this)},groups:{get:function(){return null===this._groupsProjection&&(this._groupsProjection=new ns.GroupsListProjection(this,this._groupKeyOf,this._groupDataOf)),this._groupsProjection}},getItemFromKey:function(key){return this._groupedItems[key]}},{supportedForProcessing:!1})}),GroupsListProjection:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.ListBase,function(list,groupKeyOf,groupDataOf){this._list=list,this._addListListener("itemchanged",this._listItemChanged),this._addListListener("iteminserted",this._listItemInserted),this._addListListener("itemmoved",this._listItemMoved),this._addListListener("itemremoved",this._listItemRemoved),this._addListListener("reload",this._listReload),this._groupKeyOf=groupKeyOf,this._groupDataOf=groupDataOf,this._initGroupKeysAndItems()},{_list:null,_addListListener:function(name,func){this._list.addEventListener(name,func.bind(this))},_groupDataOf:null,_groupKeyOf:null,_groupOf:function(item){return this.getItemFromKey(this._groupKeyOf(item.data))},_groupKeys:null,_groupItems:null,_initGroupKeysAndItems:function(){for(var groupCount,groupDataOf=this._groupDataOf,list=this._list,groupItems={},groupKeys=[],currentGroupKey=null,currentGroupItem=null,i=0,len=list.length;len>i;i++){var item=list.getItem(i),groupKey=item.groupKey;groupKey!==currentGroupKey?(currentGroupItem&&(currentGroupItem.groupSize=groupCount),groupCount=1,currentGroupKey=groupKey,currentGroupItem={handle:groupKey,key:groupKey,data:groupDataOf(item.data),firstItemKey:item.key,firstItemIndexHint:i},groupItems[groupKey]=currentGroupItem,groupKeys.push(groupKey)):groupCount++}currentGroupItem&&(currentGroupItem.groupSize=groupCount),this._groupKeys=groupKeys,this._groupItems=groupItems},_listItemChanged:function(event){var key=event.detail.key,index=event.detail.index,newValue=event.detail.newValue,list=this._list,groupKey=list.getItemFromKey(key).groupKey,groupItems=this._groupItems,groupItem=groupItems[groupKey];if(groupItem.firstItemIndexHint===index){var newGroupItem=cloneItem(groupItem);newGroupItem.data=this._groupDataOf(newValue),newGroupItem.firstItemKey=key,groupItems[groupKey]=newGroupItem,this._notifyItemChanged(groupKey,this._groupKeys.indexOf(groupKey),groupItem.data,newGroupItem.data,groupItem,newGroupItem)}},_listItemInserted:function(event){var groupIndex,oldGroupItem,newGroupItem,i,len,key=event.detail.key,index=event.detail.index,value=event.detail.value,list=this._list,groupKey=list.getItemFromKey(key).groupKey,groupItems=this._groupItems,groupKeys=this._groupKeys,groupItem=groupItems[groupKey];if(groupItem)oldGroupItem=groupItem,newGroupItem=cloneItem(oldGroupItem),newGroupItem.groupSize++,oldGroupItem.firstItemIndexHint===index&&(newGroupItem.groupData=this._groupDataOf(value),newGroupItem.firstItemKey=key,newGroupItem.firstItemIndexHint=index),groupItems[groupKey]=newGroupItem,groupIndex=groupKeys.indexOf(groupKey),this._notifyItemChanged(groupKey,groupIndex,oldGroupItem.data,newGroupItem.data,oldGroupItem,newGroupItem);else{for(i=0,len=groupKeys.length;len>i&&(groupItem=groupItems[groupKeys[i]],!(groupItem.firstItemIndexHint>=index));i++);groupIndex=i,groupItem={handle:groupKey,key:groupKey,data:this._groupDataOf(value),groupSize:1,firstItemKey:key,firstItemIndexHint:index},groupKeys.splice(groupIndex,0,groupKey),groupItems[groupKey]=groupItem,this._notifyItemInserted(groupKey,groupIndex,groupItem.data)}for(i=groupIndex+1,len=groupKeys.length;len>i;i++)oldGroupItem=groupItems[groupKeys[i]],newGroupItem=cloneItem(oldGroupItem),newGroupItem.firstItemIndexHint++,groupItems[newGroupItem.key]=newGroupItem,this._notifyItemChanged(newGroupItem.key,i,oldGroupItem.data,newGroupItem.data,oldGroupItem,newGroupItem)},_listItemMoved:function(event){var key=event.detail.key,oldIndex=event.detail.oldIndex,newIndex=event.detail.newIndex,list=this._list,groupKey=list.getItemFromKey(key).groupKey,groupItems=this._groupItems,groupItem=groupItems[groupKey];if(groupItem.firstItemIndexHint===newIndex||groupItem.firstItemIndexHint===oldIndex){var item=list.getItem(groupItem.firstItemIndexHint),newGroupItem=cloneItem(groupItem);newGroupItem.data=this._groupDataOf(item.data),newGroupItem.firstItemKey=item.key,groupItems[groupKey]=newGroupItem,this._notifyItemChanged(groupKey,this._groupKeys.indexOf(groupKey),groupItem.data,newGroupItem.data,groupItem,newGroupItem)}},_listItemRemoved:function(event){var oldGroupItem,newGroupItem,index=event.detail.index,item=event.detail.item,groupItems=this._groupItems,groupKeys=this._groupKeys,groupKey=item.groupKey,groupItem=groupItems[groupKey],groupIndex=groupKeys.indexOf(groupKey);if(1===groupItem.groupSize)groupKeys.splice(groupIndex,1),delete groupItems[groupKey],this._notifyItemRemoved(groupKey,groupIndex,groupItem.data,groupItem),groupIndex--;else{if(oldGroupItem=groupItem,newGroupItem=cloneItem(oldGroupItem),newGroupItem.groupSize--,oldGroupItem.firstItemIndexHint===index){var newFirstItem=this._list.getItem(index);newGroupItem.data=this._groupDataOf(newFirstItem.data),newGroupItem.firstItemKey=newFirstItem.key}groupItems[groupKey]=newGroupItem,this._notifyItemChanged(groupKey,groupIndex,oldGroupItem.data,newGroupItem.data,oldGroupItem,newGroupItem)}for(var i=groupIndex+1,len=groupKeys.length;len>i;i++)oldGroupItem=groupItems[groupKeys[i]],newGroupItem=cloneItem(oldGroupItem),newGroupItem.firstItemIndexHint--,groupItems[newGroupItem.key]=newGroupItem,this._notifyItemChanged(newGroupItem.key,i,oldGroupItem.data,newGroupItem.data,oldGroupItem,newGroupItem)},_listReload:function(){this._initGroupKeysAndItems(),this._notifyReload()},length:{get:function(){return this._groupKeys.length}},getItem:function(index){return index=asNumber(index),this._groupItems[this._groupKeys[index]]},getItemFromKey:function(key){return this._groupItems[key]},indexOfKey:function(key){return this._groupKeys.indexOf(key)}},{supportedForProcessing:!1})})});_Base.Namespace._moduleDefine(exports,"WinJS.Binding",{List:_Base.Namespace._lazy(function(){return _Base.Class.derive(ns.ListBaseWithMutators,function(list,options){if(this._currentKey=0,this._keys=null,this._keyMap={},options=options||emptyOptions,this._proxy=options.proxy,this._binding=options.binding,this._proxy){if(Object.keys(list).length!==list.length)throw new _ErrorFromName("WinJS.Binding.List.NotSupported",strings.sparseArrayNotSupported);this._data=list,this._currentKey=list.length}else if(list){for(var keyDataMap=this._keyMap,pos=0,i=0,len=list.length;len>i;i++)if(i in list){var item=list[i];this._binding&&(item=_Data.as(item));var key=pos.toString();pos++,keyDataMap[key]={handle:key,key:key,data:item}}pos!==i&&this._initializeKeys(),this._currentKey=pos}},{_currentKey:0,_keys:null,_keyMap:null,_modifyingData:0,_initializeKeys:function(){if(!this._keys){var keys=[];if(this._data){for(var keyMap=this._keyMap,data=this._data,i=0,len=data.length;len>i;i++)if(i in data){var key=i.toString();if(keys[i]=key,!(key in keyMap)){var item=data[i];this._binding&&(item=_Data.as(item)),keyMap[key]={handle:key,key:key,data:item}}}}else Object.keys(this._keyMap).forEach(function(key){keys[key>>>0]=key});this._keys=keys}},_lazyPopulateEntry:function(index){if(this._data&&index in this._data){var item=this._data[index];this._binding&&(item=_Data.as(item));var key=index.toString(),entry={handle:key,key:key,data:item};return this._keyMap[entry.key]=entry,entry}},_assignKey:function(){return(++this._currentKey).toString()},length:{get:function(){return this._data?this._data.length:this._keys?this._keys.length:this._currentKey},set:function(value){if(!("number"==typeof value&&value>=0))throw new _ErrorFromName("WinJS.Binding.List.IllegalLength",strings.illegalListLength);this._initializeKeys();var current=this.length;if(current>value?this.splice(value,current-value):value=current,this._data){this._modifyingData++;try{this._data.length=value}finally{this._modifyingData--}}this._keys&&(this._keys.length=value)}},getItem:function(index){var entry,key;return index=asNumber(index),this._keys?(key=this._keys[index],entry=key&&this._keyMap[key]):(key=index.toString(),entry=this._keyMap[key]||this._lazyPopulateEntry(index)),entry},getItemFromKey:function(key){var entry;return entry=this._keys||!this._data?this._keyMap[key]:this.getItem(key>>>0)},indexOfKey:function(key){var index=-1;if(this._keys)index=this._keys.indexOf(key);else{var t=key>>>0;t<this._currentKey&&(index=t)}return index},move:function(index,newIndex){if(index=asNumber(index),newIndex=asNumber(newIndex),this._initializeKeys(),!(index===newIndex||0>index||0>newIndex||index>=this.length||newIndex>=this.length)){if(this._data){this._modifyingData++;try{var item=this._data.splice(index,1)[0];this._data.splice(newIndex,0,item)}finally{this._modifyingData--}}var key=this._keys.splice(index,1)[0];this._keys.splice(newIndex,0,key),this._notifyItemMoved(key,index,newIndex,this.getItemFromKey(key).data)}},notifyMutated:function(index){index=asNumber(index);var key=this._keys?this._keys[index]:index.toString();this._notifyMutatedFromKey(key)},setAt:function(index,newValue){index=asNumber(index),this._initializeKeys();var length=this.length;if(index===length)this.push(newValue);else if(length>index){if(this._data){this._modifyingData++;try{this._data[index]=newValue}finally{this._modifyingData--}}if(this._binding&&(newValue=_Data.as(newValue)),index in this._keys){var key=this._keys[index],oldEntry=this._keyMap[key],newEntry=cloneItem(oldEntry);newEntry.data=newValue,this._keyMap[key]=newEntry,this._notifyItemChanged(key,index,oldEntry.data,newValue,oldEntry,newEntry)}}},_setAtKey:function(key,newValue){this.setAt(this.indexOfKey(key),newValue)},reverse:function(){if(this._initializeKeys(),this._data){this._modifyingData++;try{this._data.reverse()}finally{this._modifyingData--}}return this._keys.reverse(),this._notifyReload(),this},sort:function(sortFunction){if(this._initializeKeys(),this._data){this._modifyingData++;try{this._data.sort(sortFunction)}finally{this._modifyingData--}}var that=this;return this._keys.sort(function(l,r){return l=that._keyMap[l],r=that._keyMap[r],sortFunction?sortFunction(l.data,r.data):(l=(l&&l.data||"").toString(),r=(l&&r.data||"").toString(),r>l?-1:l===r?0:1)}),this._notifyReload(),this},pop:function(){if(0!==this.length){this._initializeKeys();var key=this._keys.pop(),entry=this._keyMap[key],data=entry&&entry.data;if(this._data){this._modifyingData++;try{this._data.pop()}finally{this._modifyingData--}}return delete this._keyMap[key],this._notifyItemRemoved(key,this._keys.length,data,entry),data}},push:function(){this._initializeKeys();for(var length=arguments.length,i=0;length>i;i++){var item=arguments[i];this._binding&&(item=_Data.as(item));var key=this._assignKey();if(this._keys.push(key),this._data){this._modifyingData++;try{this._data.push(arguments[i])}finally{this._modifyingData--}}this._keyMap[key]={handle:key,key:key,data:item},this._notifyItemInserted(key,this._keys.length-1,item)}return this.length},shift:function(){if(0!==this.length){this._initializeKeys();var key=this._keys.shift(),entry=this._keyMap[key],data=entry&&entry.data;if(this._data){this._modifyingData++;try{this._data.shift()}finally{this._modifyingData--}}return delete this._keyMap[key],this._notifyItemRemoved(key,0,data,entry),data}},unshift:function(){this._initializeKeys();for(var length=arguments.length,i=length-1;i>=0;i--){var item=arguments[i];this._binding&&(item=_Data.as(item));var key=this._assignKey();if(this._keys.unshift(key),this._data){this._modifyingData++;try{this._data.unshift(arguments[i])}finally{this._modifyingData--}}this._keyMap[key]={handle:key,key:key,data:item},this._notifyItemInserted(key,0,item)}return this.length},splice:function(index,howMany,item){index=asNumber(index),this._initializeKeys(),index=Math.max(0,this._normalizeIndex(index)),howMany=Math.max(0,Math.min(howMany||0,this.length-index));for(var result=[];howMany;){var key=this._keys[index],entry=this._keyMap[key],data=entry&&entry.data;if(result.push(data),this._keys.splice(index,1),this._data){this._modifyingData++;try{this._data.splice(index,1)}finally{this._modifyingData--}}delete this._keyMap[key],this._notifyItemRemoved(key,index,data,entry),--howMany}if(arguments.length>2)for(var i=2,len=arguments.length;len>i;i++){var additionalItem=arguments[i];this._binding&&(additionalItem=_Data.as(additionalItem));var pos=Math.min(index+i-2,this.length),newKey=this._assignKey();if(this._keys.splice(pos,0,newKey),this._data){this._modifyingData++;try{this._data.splice(pos,0,arguments[i])}finally{this._modifyingData--}}this._keyMap[newKey]={handle:newKey,key:newKey,data:additionalItem},this._notifyItemInserted(newKey,pos,additionalItem)}return result},_spliceFromKey:function(key){this._initializeKeys();var args=copyargs(arguments);return args[0]=this._keys.indexOf(key),this.splice.apply(this,args)}},{supportedForProcessing:!1})})})}),define("WinJS/Res",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./Core/_ErrorFromName","./Core/_Resources","./ControlProcessor/_OptionsParser","./Promise"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,_OptionsParser,Promise){"use strict";function processAllImpl(rootElement,count){rootElement=rootElement||_Global.document.body;var count=count||0;if(4>count){if(0===count&&rootElement.getAttribute){var rootElementNode=rootElement.getAttribute("data-win-res");if(rootElementNode){var decls=_OptionsParser.optionsParser(rootElementNode);setMembers(rootElement,rootElement,decls,count)}}var selector="[data-win-res],[data-win-control]",elements=rootElement.querySelectorAll(selector);if(0===elements.length)return Promise.as(rootElement);for(var i=0,len=elements.length;len>i;i++){var e=elements[i];if(e.winControl&&e.winControl.constructor&&e.winControl.constructor.isDeclarativeControlContainer){var idcc=e.winControl.constructor.isDeclarativeControlContainer;"function"==typeof idcc&&(idcc=requireSupportedForProcessing(idcc),idcc(e.winControl,processAll),i+=e.querySelectorAll(selector).length)}if(e.hasAttribute("data-win-res")){var decls=_OptionsParser.optionsParser(e.getAttribute("data-win-res"));setMembers(e,e,decls,count)}}}else if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.Res.NestingExceeded","NestingExceeded");return Promise.as(rootElement)}function setAttributes(root,descriptor){for(var names=Object.keys(descriptor),k=0,l=names.length;l>k;k++){var name=names[k],value=descriptor[name],data=_Resources.getString(value);data&&data.empty?_BaseUtils.validation&&notFound(value):(root.setAttribute(name,data.value),void 0!==data.lang&&void 0!==root.lang&&root.lang!==data.lang&&(root.lang=data.lang))}}function notFound(name){throw new _ErrorFromName("WinJS.Res.NotFound",_Resources._formatString("NotFound: {0}",name))}function setMembers(root,target,descriptor,count){var names=Object.keys(descriptor);target=requireSupportedForProcessing(target);for(var k=0,l=names.length;l>k;k++){var name=names[k],value=descriptor[name];if("string"==typeof value){var data=_Resources.getString(value);data&&data.empty?_BaseUtils.validation&&notFound(value):(target[name]=data.value,void 0!==data.lang&&void 0!==root.lang&&root.lang!==data.lang&&(root.lang=data.lang),"innerHTML"===name&&processAllImpl(target,count+1))}else root===target&&"attributes"===name?setAttributes(root,value):setMembers(root,target[name],value,count)}}function processAll(rootElement){if(!readyComplete)return _BaseUtils.ready().then(function(){return readyComplete=!0,processAllImpl(rootElement)});try{return processAllImpl(rootElement)}catch(e){return Promise.wrapError(e)}}var readyComplete=!1,requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing;_Base.Namespace._moduleDefine(exports,"WinJS.Resources",{processAll:processAll})}),define("WinJS/Pages/_BasePage",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_WriteProfilerMark","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities"],function(exports,_Global,_Base,_BaseUtils,_WriteProfilerMark,Promise,_Control,_Dispose,_ElementUtilities){"use strict";function abs(uri){var a=_Global.document.createElement("a");return a.href=uri,a.href}function selfhost(uri){return _Global.document.location.href.toLowerCase()===uri.toLowerCase()}function Pages_define(uri,members){var base=get(uri);return uri=abs(uri),base||(base=_Base.Class.define(function(element,options,complete,parentedPromise){var that=this;this._disposed=!1,this.element=element=element||_Global.document.createElement("div"),_ElementUtilities.addClass(element,"win-disposable"),element.msSourceLocation=uri,this.uri=uri,this.selfhost=selfhost(uri),element.winControl=this,_ElementUtilities.addClass(element,"pagecontrol");var profilerMarkIdentifier=" uri='"+uri+"'"+_BaseUtils._getProfilerMarkIdentifier(this.element);_WriteProfilerMark("WinJS.UI.Pages:createPage"+profilerMarkIdentifier+",StartTM");var load=Promise.wrap().then(function(){return that.load(uri)}),renderCalled=load.then(function(loadResult){return Promise.join({loadResult:loadResult,initResult:that.init(element,options)})}).then(function(result){return that.render(element,options,result.loadResult)});this.elementReady=renderCalled.then(function(){return element}),this.renderComplete=renderCalled.then(function(){return that.process(element,options)}).then(function(){return that.processed(element,options)}).then(function(){return that});var callComplete=function(){complete&&complete(that),_WriteProfilerMark("WinJS.UI.Pages:createPage"+profilerMarkIdentifier+",StopTM")};this.renderComplete.then(callComplete,callComplete),this.readyComplete=this.renderComplete.then(function(){return parentedPromise}).then(function(){return that.ready(element,options),that}).then(null,function(err){return that.error(err)})},_mixin),base=_Base.Class.mix(base,_Control.DOMEventMixin),viewMap[uri.toLowerCase()]=base),members&&(base=_Base.Class.mix(base,members)),base.selfhost=selfhost(uri),base}function get(uri){return uri=abs(uri),viewMap[uri.toLowerCase()]}function remove(uri){uri=abs(uri),delete viewMap[uri.toLowerCase()]}if(_Global.document){var viewMap={},_mixin={dispose:function(){this._disposed||(this._disposed=!0,_Dispose.disposeSubTree(this.element),this.element=null)},load:function(uri){},init:function(element,options){},process:function(element,options){},processed:function(element,options){},render:function(element,options,loadResult){},ready:function(element,options){},error:function(err){return Promise.wrapError(err)}};_Base.Namespace._moduleDefine(exports,null,{abs:abs,define:Pages_define,get:get,remove:remove,viewMap:viewMap})}}),define("WinJS/Pages",["exports","./Core/_Global","./Core/_Base","./Core/_BaseUtils","./ControlProcessor","./Fragments","./Pages/_BasePage","./Promise"],function(exports,_Global,_Base,_BaseUtils,ControlProcessor,Fragments,_BasePage,Promise){"use strict";function Pages_define(uri,members){var Page=_BasePage.get(uri);return Page||(Page=_BasePage.define(uri,_mixin)),
members&&(Page=_Base.Class.mix(Page,members)),Page.selfhost&&_BaseUtils.ready(function(){render(_BasePage.abs(uri),_Global.document.body)},!0),Page}function get(uri){var ctor=_BasePage.get(uri);return ctor||(ctor=Pages_define(uri)),ctor}function _remove(uri){Fragments.clearCache(_BasePage.abs(uri)),_BasePage.remove(uri)}function render(uri,element,options,parentedPromise){var Ctor=get(uri),control=new Ctor(element,options,null,parentedPromise);return control.renderComplete.then(null,function(err){return Promise.wrapError({error:err,page:control})})}if(_Global.document){var _mixin={load:function(uri){return this.selfhost?void 0:Fragments.renderCopy(_BasePage.abs(uri))},process:function(element,options){return ControlProcessor.processAll(element)},render:function(element,options,loadResult){return this.selfhost||element.appendChild(loadResult),element}};_Base.Namespace._moduleDefine(exports,"WinJS.UI.Pages",{define:Pages_define,get:get,_remove:_remove,render:render,_viewMap:_BasePage.viewMap})}}),define("WinJS/Controls/HtmlControl",["exports","../Core/_Global","../Core/_Base","../Pages"],function(exports,_Global,_Base,Pages){"use strict";_Global.document&&_Base.Namespace._moduleDefine(exports,"WinJS.UI",{HtmlControl:_Base.Class.define(function(element,options,complete){Pages.render(options.uri,element,options).then(complete,function(){complete()})})})}),define("base",["WinJS/Core/_WinJS","WinJS/Core","WinJS/Promise","WinJS/_Signal","WinJS/Scheduler","WinJS/Utilities","WinJS/XYFocus","WinJS/Fragments","WinJS/Application","WinJS/Navigation","WinJS/Animations","WinJS/Binding","WinJS/BindingTemplate","WinJS/BindingList","WinJS/Res","WinJS/Pages","WinJS/ControlProcessor","WinJS/Controls/HtmlControl"],function(_WinJS){"use strict";return _WinJS.Namespace.define("WinJS.Utilities",{_require:require,_define:define}),_WinJS}),require(["WinJS/Core/_WinJS","base"],function(_WinJS){globalObject.WinJS=_WinJS,"undefined"!=typeof module&&(module.exports=_WinJS)}),globalObject.WinJS})}(),function(){var globalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};!function(factory){"function"==typeof define&&define.amd?define(["./base"],factory):(globalObject.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.3 4.3.1.winjs.2015.9.29 ui.js,StartTM"),factory("object"==typeof exports&&"string"!=typeof exports.nodeName?require("./base"):globalObject.WinJS),globalObject.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.3 4.3.1.winjs.2015.9.29 ui.js,StopTM"))}(function(WinJS){var require=WinJS.Utilities._require,define=WinJS.Utilities._define;define("WinJS/VirtualizedDataSource/_VirtualizedDataSourceImpl",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../_Signal","../Utilities/_UI"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Promise,Scheduler,_Signal,_UI){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{VirtualizedDataSource:_Base.Namespace._lazy(function(){function _baseDataSourceConstructor(listDataAdapter,options){function profilerMarkStart(text){var message="WinJS.UI.VirtualizedDataSource:"+dataSourceID+":"+text+",StartTM";_WriteProfilerMark(message),_Log.log&&_Log.log(message,"winjs vds","perf")}function profilerMarkEnd(text){var message="WinJS.UI.VirtualizedDataSource:"+dataSourceID+":"+text+",StopTM";_WriteProfilerMark(message),_Log.log&&_Log.log(message,"winjs vds","perf")}function isNonNegativeNumber(n){return"number"==typeof n&&n>=0}function isNonNegativeInteger(n){return isNonNegativeNumber(n)&&n===Math.floor(n)}function validateIndexReturned(index){if(null===index)index=void 0;else if(void 0!==index&&!isNonNegativeInteger(index))throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidIndexReturned",strings.invalidIndexReturned);return index}function validateCountReturned(count){if(null===count)count=void 0;else if(void 0!==count&&!isNonNegativeInteger(count)&&count!==CountResult.unknown)throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidCountReturned",strings.invalidCountReturned);return count}function createSlot(){var handle=(nextHandle++).toString(),slotNew={handle:handle,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return handleMap[handle]=slotNew,slotNew}function createPrimarySlot(){return createSlot()}function insertSlot(slot,slotNext){slot.prev=slotNext.prev,slot.next=slotNext,slot.prev.next=slot,slotNext.prev=slot}function removeSlot(slot){slot.lastInSequence&&(delete slot.lastInSequence,slot.prev.lastInSequence=!0),slot.firstInSequence&&(delete slot.firstInSequence,slot.next.firstInSequence=!0),slot.prev.next=slot.next,slot.next.prev=slot.prev}function sequenceStart(slot){for(;!slot.firstInSequence;)slot=slot.prev;return slot}function sequenceEnd(slot){for(;!slot.lastInSequence;)slot=slot.next;return slot}function moveSequenceBefore(slotNext,slotFirst,slotLast){return slotFirst.prev.next=slotLast.next,slotLast.next.prev=slotFirst.prev,slotFirst.prev=slotNext.prev,slotLast.next=slotNext,slotFirst.prev.next=slotFirst,slotNext.prev=slotLast,!0}function moveSequenceAfter(slotPrev,slotFirst,slotLast){return slotFirst.prev.next=slotLast.next,slotLast.next.prev=slotFirst.prev,slotFirst.prev=slotPrev,slotLast.next=slotPrev.next,slotPrev.next=slotFirst,slotLast.next.prev=slotLast,!0}function mergeSequences(slotPrev){delete slotPrev.lastInSequence,delete slotPrev.next.firstInSequence}function splitSequence(slotPrev){var slotNext=slotPrev.next;slotPrev.lastInSequence=!0,slotNext.firstInSequence=!0,slotNext===slotListEnd&&changeSlotIndex(slotListEnd,void 0)}function insertAndMergeSlot(slot,slotNext,mergeWithPrev,mergeWithNext){insertSlot(slot,slotNext);var slotPrev=slot.prev;slotPrev.lastInSequence&&(mergeWithPrev?delete slotPrev.lastInSequence:slot.firstInSequence=!0,mergeWithNext?delete slotNext.firstInSequence:slot.lastInSequence=!0)}function setSlotKey(slot,key){slot.key=key,keyMap[slot.key]=slot}function setSlotIndex(slot,index,indexMapForSlot){+index===index&&(slot.index=index,indexMapForSlot[index]=slot,indexUpdateDeferred||(slot.firstInSequence&&slot.prev&&slot.prev.index===index-1&&mergeSequences(slot.prev),slot.lastInSequence&&slot.next&&slot.next.index===index+1&&mergeSequences(slot)))}function createAndAddSlot(slotNext,indexMapForSlot){var slotNew=indexMapForSlot===indexMap?createPrimarySlot():createSlot();return insertSlot(slotNew,slotNext),slotNew}function createSlotSequence(slotNext,index,indexMapForSlot){var slotNew=createAndAddSlot(slotNext,indexMapForSlot);return slotNew.firstInSequence=!0,slotNew.lastInSequence=!0,setSlotIndex(slotNew,index,indexMapForSlot),slotNew}function createPrimarySlotSequence(slotNext,index){return createSlotSequence(slotNext,index,indexMap)}function addSlotBefore(slotNext,indexMapForSlot){var slotNew=createAndAddSlot(slotNext,indexMapForSlot);return delete slotNext.firstInSequence,slotNew.prev.index===slotNew.index-1?delete slotNew.prev.lastInSequence:slotNew.firstInSequence=!0,setSlotIndex(slotNew,slotNext.index-1,indexMapForSlot),slotNew}function addSlotAfter(slotPrev,indexMapForSlot){var slotNew=createAndAddSlot(slotPrev.next,indexMapForSlot);return delete slotPrev.lastInSequence,slotNew.next.index===slotNew.index+1?delete slotNew.next.firstInSequence:slotNew.lastInSequence=!0,setSlotIndex(slotNew,slotPrev.index+1,indexMapForSlot),slotNew}function reinsertSlot(slot,slotNext,mergeWithPrev,mergeWithNext){insertAndMergeSlot(slot,slotNext,mergeWithPrev,mergeWithNext),keyMap[slot.key]=slot,void 0!==slot.index&&(indexMap[slot.index]=slot)}function removeSlotPermanently(slot){removeSlot(slot),slot.key&&delete keyMap[slot.key],void 0!==slot.index&&indexMap[slot.index]===slot&&delete indexMap[slot.index];var bindingMap=slot.bindingMap;for(var listBindingID in bindingMap){var handle=bindingMap[listBindingID].handle;handle&&handleMap[handle]===slot&&delete handleMap[handle]}handleMap[slot.handle]===slot&&delete handleMap[slot.handle]}function slotPermanentlyRemoved(slot){return!handleMap[slot.handle]}function successorFromIndex(index,indexMapForSlot,listStart,listEnd,skipPreviousIndex){var slotNext=skipPreviousIndex?null:indexMapForSlot[index-1];if(slotNext&&(slotNext.next!==listEnd||listEnd.firstInSequence))slotNext=slotNext.next;else if(slotNext=indexMapForSlot[index+1],!slotNext){slotNext=listStart.next;for(var lastSequenceStart;;){if(slotNext.firstInSequence&&(lastSequenceStart=slotNext),!(index>=slotNext.index)||slotNext===listEnd)break;slotNext=slotNext.next}slotNext!==listEnd||listEnd.firstInSequence||(slotNext=lastSequenceStart&&void 0===lastSequenceStart.index?lastSequenceStart:void 0)}return slotNext}function isPlaceholder(slot){return!slot.item&&!slot.itemNew&&slot!==slotListEnd}function defineHandleProperty(item,handle){Object.defineProperty(item,"handle",{value:handle,writable:!1,enumerable:!1,configurable:!0})}function defineCommonItemProperties(item,slot,handle){defineHandleProperty(item,handle),Object.defineProperty(item,"index",{get:function(){for(;slot.slotMergedWith;)slot=slot.slotMergedWith;return slot.index},enumerable:!1,configurable:!0})}function validateData(data){if(void 0===data)return data;var dataValidated=JSON.stringify(data);if(void 0===dataValidated)throw new _ErrorFromName("WinJS.UI.ListDataSource.ObjectIsNotValidJson",strings.objectIsNotValidJson);return dataValidated}function itemSignature(item){return listDataAdapter.itemSignature?listDataAdapter.itemSignature(item.data):validateData(item.data)}function prepareSlotItem(slot){var item=slot.itemNew;slot.itemNew=null,item&&(item=Object.create(item),defineCommonItemProperties(item,slot,slot.handle),listDataAdapter.compareByIdentity||(slot.signature=itemSignature(item))),slot.item=item,delete slot.indexRequested,delete slot.keyRequested}function slotRetained(slot){return slot.bindingMap||slot.cursorCount>0}function slotRequested(slot){return slotRetained(slot)||slot.fetchListeners||slot.directFetchListeners}function slotLive(slot){return slotRequested(slot)||!slot.firstInSequence&&slotRetained(slot.prev)||!slot.lastInSequence&&slotRetained(slot.next)||!itemsFromIndex&&(!slot.firstInSequence&&slot.prev!==slotsStart&&!(slot.prev.item||slot.prev.itemNew))|(!slot.lastInSequence&&slot.next!==slotListEnd&&!(slot.next.item||slot.next.itemNew))}function deleteUnnecessarySlot(slot){splitSequence(slot),removeSlotPermanently(slot)}function reduceReleasedSlotCount(){if(!editsQueued){(!lastSlotReleased||slotPermanentlyRemoved(lastSlotReleased))&&(lastSlotReleased=slotListEnd.prev);for(var slotPrev=lastSlotReleased.prev,slotNext=lastSlotReleased.next,releasedSlotsFound=0,considerDeletingSlot=function(slotToDelete){slotToDelete===slotListEnd||slotLive(slotToDelete)||(cacheSize>=releasedSlotsFound?releasedSlotsFound++:deleteUnnecessarySlot(slotToDelete))};slotPrev||slotNext;){if(slotPrev){var slotPrevToDelete=slotPrev;slotPrev=slotPrevToDelete.prev,slotPrevToDelete!==slotsStart&&considerDeletingSlot(slotPrevToDelete)}if(slotNext){var slotNextToDelete=slotNext;slotNext=slotNextToDelete.next,slotNextToDelete!==slotsEnd&&considerDeletingSlot(slotNextToDelete)}}releasedSlots=0}}function releaseSlotIfUnrequested(slot){slotRequested(slot)||(releasedSlots++,editsQueued||refreshInProgress||(lastSlotReleased=slot,releasedSlots>cacheSize&&!reduceReleasedSlotCountPosted&&(reduceReleasedSlotCountPosted=!0,Scheduler.schedule(function(){reduceReleasedSlotCountPosted=!1,reduceReleasedSlotCount()},Scheduler.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested"))))}function forEachBindingRecord(callback){for(var listBindingID in bindingMap)callback(bindingMap[listBindingID])}function forEachBindingRecordOfSlot(slot,callback){for(var listBindingID in slot.bindingMap)callback(slot.bindingMap[listBindingID].bindingRecord,listBindingID)}function handlerToNotify(bindingRecord){return bindingRecord.notificationsSent||(bindingRecord.notificationsSent=!0,bindingRecord.notificationHandler.beginNotifications&&bindingRecord.notificationHandler.beginNotifications()),bindingRecord.notificationHandler}function finishNotifications(){editsInProgress||dataNotificationsInProgress||forEachBindingRecord(function(bindingRecord){bindingRecord.notificationsSent&&(bindingRecord.notificationsSent=!1,bindingRecord.notificationHandler.endNotifications&&bindingRecord.notificationHandler.endNotifications())})}function handleForBinding(slot,listBindingID){var bindingMap=slot.bindingMap;if(bindingMap){var slotBinding=bindingMap[listBindingID];if(slotBinding){var handle=slotBinding.handle;if(handle)return handle}}return slot.handle}function itemForBinding(item,handle){return item&&item.handle!==handle&&(item=Object.create(item),defineHandleProperty(item,handle)),item}function changeCount(count){var oldCount=knownCount;knownCount=count,forEachBindingRecord(function(bindingRecord){bindingRecord.notificationHandler&&bindingRecord.notificationHandler.countChanged&&handlerToNotify(bindingRecord).countChanged(knownCount,oldCount)})}function sendIndexChangedNotifications(slot,indexOld){forEachBindingRecordOfSlot(slot,function(bindingRecord,listBindingID){bindingRecord.notificationHandler.indexChanged&&handlerToNotify(bindingRecord).indexChanged(handleForBinding(slot,listBindingID),slot.index,indexOld)})}function changeSlotIndex(slot,index){var indexOld=slot.index;if(void 0!==indexOld&&indexMap[indexOld]===slot&&delete indexMap[indexOld],+index===index)setSlotIndex(slot,index,indexMap);else{if(+indexOld!==indexOld)return;delete slot.index}sendIndexChangedNotifications(slot,indexOld)}function insertionNotificationRecipients(slot,slotPrev,slotNext,mergeWithPrev,mergeWithNext){var bindingMapRecipients={};if((mergeWithPrev||!slotPrev.lastInSequence)&&(mergeWithNext||!slotNext.firstInSequence))if(slotPrev===slotsStart)if(slotNext===slotListEnd)for(var listBindingID in bindingMap)bindingMapRecipients[listBindingID]=bindingMap[listBindingID];else for(var listBindingID in slotNext.bindingMap)bindingMapRecipients[listBindingID]=bindingMap[listBindingID];else if(slotNext===slotListEnd||slotNext.bindingMap)for(var listBindingID in slotPrev.bindingMap)(slotNext===slotListEnd||slotNext.bindingMap[listBindingID])&&(bindingMapRecipients[listBindingID]=bindingMap[listBindingID]);for(var listBindingID in slot.bindingMap)bindingMapRecipients[listBindingID]=bindingMap[listBindingID];return bindingMapRecipients}function sendInsertedNotification(slot){var listBindingID,slotPrev=slot.prev,slotNext=slot.next,bindingMapRecipients=insertionNotificationRecipients(slot,slotPrev,slotNext);for(listBindingID in bindingMapRecipients){var bindingRecord=bindingMapRecipients[listBindingID];bindingRecord.notificationHandler&&handlerToNotify(bindingRecord).inserted(bindingRecord.itemPromiseFromKnownSlot(slot),slotPrev.lastInSequence||slotPrev===slotsStart?null:handleForBinding(slotPrev,listBindingID),slotNext.firstInSequence||slotNext===slotListEnd?null:handleForBinding(slotNext,listBindingID))}}function changeSlot(slot){var itemOld=slot.item;prepareSlotItem(slot),forEachBindingRecordOfSlot(slot,function(bindingRecord,listBindingID){var handle=handleForBinding(slot,listBindingID);handlerToNotify(bindingRecord).changed(itemForBinding(slot.item,handle),itemForBinding(itemOld,handle))})}function moveSlot(slot,slotMoveBefore,mergeWithPrev,mergeWithNext,skipNotifications){var listBindingID,slotMoveAfter=slotMoveBefore.prev;if(slotMoveBefore===slot){if(!slot.firstInSequence||!mergeWithPrev)return;slotMoveBefore=slot.next}else if(slotMoveAfter===slot){if(!slot.lastInSequence||!mergeWithNext)return;slotMoveAfter=slot.prev}if(!skipNotifications){var bindingMapRecipients=insertionNotificationRecipients(slot,slotMoveAfter,slotMoveBefore,mergeWithPrev,mergeWithNext);for(listBindingID in bindingMapRecipients){var bindingRecord=bindingMapRecipients[listBindingID];handlerToNotify(bindingRecord).moved(bindingRecord.itemPromiseFromKnownSlot(slot),(slotMoveAfter.lastInSequence||slotMoveAfter===slot.prev)&&!mergeWithPrev||slotMoveAfter===slotsStart?null:handleForBinding(slotMoveAfter,listBindingID),(slotMoveBefore.firstInSequence||slotMoveBefore===slot.next)&&!mergeWithNext||slotMoveBefore===slotListEnd?null:handleForBinding(slotMoveBefore,listBindingID))}forEachBindingRecord(function(bindingRecord){bindingRecord.adjustCurrentSlot(slot)})}removeSlot(slot),insertAndMergeSlot(slot,slotMoveBefore,mergeWithPrev,mergeWithNext)}function deleteSlot(slot,mirage){completeFetchPromises(slot,!0),forEachBindingRecordOfSlot(slot,function(bindingRecord,listBindingID){handlerToNotify(bindingRecord).removed(handleForBinding(slot,listBindingID),mirage)}),forEachBindingRecord(function(bindingRecord){bindingRecord.adjustCurrentSlot(slot)}),removeSlotPermanently(slot)}function deleteMirageSequence(slot){for(;!slot.firstInSequence;)slot=slot.prev;var last;do{last=slot.lastInSequence;var slotNext=slot.next;deleteSlot(slot,!0),slot=slotNext}while(!last)}function adjustedIndex(slot){var undefinedIndex;if(!slot)return undefinedIndex;for(var delta=0;!slot.firstInSequence;)delta++,slot=slot.prev;return"number"==typeof slot.indexNew?slot.indexNew+delta:"number"==typeof slot.index?slot.index+delta:undefinedIndex}function updateNewIndicesAfterSlot(slot,indexDelta){for(slot=slot.next;slot;slot=slot.next)if(slot.firstInSequence){var indexNew=void 0!==slot.indexNew?slot.indexNew:slot.index;void 0!==indexNew&&(slot.indexNew=indexNew+indexDelta)}countDelta+=indexDelta,indexUpdateDeferred=!0,refreshInProgress?beginRefresh():currentRefreshID++}function updateNewIndices(slot,indexDelta){if(slot.firstInSequence){var indexNew;if(0>indexDelta)indexNew=slot.indexNew,void 0!==indexNew?delete slot.indexNew:indexNew=slot.index,slot.lastInSequence||(slot=slot.next,void 0!==indexNew&&(slot.indexNew=indexNew));else if(!slot.lastInSequence){var slotNext=slot.next;indexNew=slotNext.indexNew,void 0!==indexNew?delete slotNext.indexNew:indexNew=slotNext.index,void 0!==indexNew&&(slot.indexNew=indexNew)}}updateNewIndicesAfterSlot(slot,indexDelta)}function updateNewIndicesFromIndex(index,indexDelta){for(var slot=slotsStart;slot!==slotListEnd;slot=slot.next){var indexNew=slot.indexNew;if(void 0!==indexNew&&indexNew>=index){updateNewIndicesAfterSlot(slot,indexDelta);break}}}function updateIndices(){var slot,slotFirstInSequence,indexNew;for(slot=slotsStart;;slot=slot.next){if(slot.firstInSequence){if(slotFirstInSequence=slot,void 0!==slot.indexNew){if(indexNew=slot.indexNew,delete slot.indexNew,isNaN(indexNew))break}else indexNew=slot.index;slot!==slotsStart&&slot.prev.index===indexNew-1&&mergeSequences(slot.prev)}if(slot.lastInSequence)for(var index=indexNew,slotUpdate=slotFirstInSequence;slotUpdate!==slot.next;slotUpdate=slotUpdate.next)index!==slotUpdate.index&&changeSlotIndex(slotUpdate,index),+index===index&&index++;if(slot===slotListEnd)break}for(;slot!==slotsEnd;slot=slot.next)void 0!==slot.index&&slot!==slotListEnd&&changeSlotIndex(slot,void 0);indexUpdateDeferred=!1,countDelta&&+knownCount===knownCount&&(getCountPromise?getCountPromise.reset():changeCount(knownCount+countDelta),countDelta=0)}function createFetchPromise(slot,listenersProperty,listenerID,listBindingID,onComplete){if(slot.item)return new Promise(function(complete){onComplete?onComplete(complete,slot.item):complete(slot.item)});var listener={listBindingID:listBindingID,retained:!1};return slot[listenersProperty]||(slot[listenersProperty]={}),slot[listenersProperty][listenerID]=listener,listener.promise=new Promise(function(complete,error){listener.complete=onComplete?function(item){onComplete(complete,item)}:complete,listener.error=error},function(){for(;slot.slotMergedWith;)slot=slot.slotMergedWith;var fetchListeners=slot[listenersProperty];if(fetchListeners){if(delete fetchListeners[listenerID],Object.keys(fetchListeners).length>0)return;delete slot[listenersProperty]}releaseSlotIfUnrequested(slot)}),listener.promise}function completePromises(item,listeners){for(var listenerID in listeners)listeners[listenerID].complete(item)}function completeFetchPromises(slot,completeSynchronously){var fetchListeners=slot.fetchListeners,directFetchListeners=slot.directFetchListeners;if(fetchListeners||directFetchListeners){prepareSlotItem(slot);var item=slot.item,completeOrQueuePromises=function(listeners){completeSynchronously?completePromises(item,listeners):fetchCompleteCallbacks.push(function(){completePromises(item,listeners)})};directFetchListeners&&(slot.directFetchListeners=null,completeOrQueuePromises(directFetchListeners)),fetchListeners&&(slot.fetchListeners=null,completeOrQueuePromises(fetchListeners)),releaseSlotIfUnrequested(slot)}}function callFetchCompleteCallbacks(){var callbacks=fetchCompleteCallbacks;fetchCompleteCallbacks=[];for(var i=0,len=callbacks.length;len>i;i++)callbacks[i]()}function returnDirectFetchError(slot,error){var directFetchListeners=slot.directFetchListeners;if(directFetchListeners){slot.directFetchListeners=null;for(var listenerID in directFetchListeners)directFetchListeners[listenerID].error(error);releaseSlotIfUnrequested(slot)}}function requestSlot(slot){return slot.firstInSequence&&addSlotBefore(slot,indexMap),slot.lastInSequence&&addSlotAfter(slot,indexMap),slot.itemNew&&prepareSlotItem(slot),postFetch(),slot}function requestSlotBefore(slotNext){if(!slotNext.firstInSequence){var slotPrev=slotNext.prev;return slotPrev===slotsStart?null:requestSlot(slotPrev)}return requestSlot(addSlotBefore(slotNext,indexMap))}function requestSlotAfter(slotPrev){if(!slotPrev.lastInSequence){var slotNext=slotPrev.next;return slotNext===slotListEnd?null:requestSlot(slotNext)}return requestSlot(addSlotAfter(slotPrev,indexMap))}function itemDirectlyFromSlot(slot){return slot?createFetchPromise(slot,"directFetchListeners",(nextListenerID++).toString()):Promise.wrap(null)}function validateKey(key){if("string"!=typeof key||!key)throw new _ErrorFromName("WinJS.UI.ListDataSource.KeyIsInvalid",strings.keyIsInvalid)}function createSlotForKey(key){var slot=createPrimarySlotSequence(slotsEnd);return setSlotKey(slot,key),slot.keyRequested=!0,slot}function slotFromKey(key,hints){validateKey(key);var slot=keyMap[key];return slot||(slot=createSlotForKey(key),slot.hints=hints),requestSlot(slot)}function slotFromIndex(index){if("number"!=typeof index||0>index)throw new _ErrorFromName("WinJS.UI.ListDataSource.IndexIsInvalid",strings.indexIsInvalid);if(slotListEnd.index<=index)return null;var slot=indexMap[index];if(!slot){var slotNext=successorFromIndex(index,indexMap,slotsStart,slotListEnd);if(!slotNext)return null;slotNext===slotListEnd&&index>=slotListEnd&&changeSlotIndex(slotListEnd,void 0),slot=slotNext.prev.index===index-1?addSlotAfter(slotNext.prev,indexMap):slotNext.index===index+1?addSlotBefore(slotNext,indexMap):createPrimarySlotSequence(slotNext,index)}return slot.item||(slot.indexRequested=!0),requestSlot(slot)}function slotFromDescription(description){var slot=createPrimarySlotSequence(slotsEnd);return slot.description=description,requestSlot(slot)}function setStatus(statusNew){if(statusPending=statusNew,status!==statusPending){var dispatch=function(){statusChangePosted=!1,status!==statusPending&&(status=statusPending,that.dispatchEvent(statusChangedEvent,status))};statusPending===DataSourceStatus.failure?dispatch():statusChangePosted||(statusChangePosted=!0,_Global.setTimeout(dispatch,40))}}function slotFetchInProgress(slot){var fetchID=slot.fetchID;return fetchID&&fetchesInProgress[fetchID]}function setFetchID(slot,fetchID){slot.fetchID=fetchID}function newFetchID(){var fetchID=nextFetchID;return nextFetchID++,fetchesInProgress[fetchID]=!0,fetchID}function setFetchIDs(slot,countBefore,countAfter){var fetchID=newFetchID();setFetchID(slot,fetchID);for(var slotBefore=slot;!slotBefore.firstInSequence&&countBefore>0;)slotBefore=slotBefore.prev,countBefore--,setFetchID(slotBefore,fetchID);for(var slotAfter=slot;!slotAfter.lastInSequence&&countAfter>0;)slotAfter=slotAfter.next,countAfter--,setFetchID(slotAfter,fetchID);return fetchID}function addMarkers(fetchResult){var items=fetchResult.items,offset=fetchResult.offset,totalCount=fetchResult.totalCount,absoluteIndex=fetchResult.absoluteIndex,atStart=fetchResult.atStart,atEnd=fetchResult.atEnd;if(isNonNegativeNumber(absoluteIndex)){if(isNonNegativeNumber(totalCount)){var itemsLength=items.length;absoluteIndex-offset+itemsLength===totalCount&&(atEnd=!0)}offset===absoluteIndex&&(atStart=!0)}atStart&&(items.unshift(startMarker),fetchResult.offset++),atEnd&&items.push(endMarker)}function resultsValid(slot,refreshID,fetchID){return delete fetchesInProgress[fetchID],refreshID!==currentRefreshID||slotPermanentlyRemoved(slot)?(postFetch(),!1):!0}function fetchItems(slot,fetchID,promiseItems,index){var refreshID=currentRefreshID;promiseItems.then(function(fetchResult){if(!fetchResult.items||!fetchResult.items.length)return Promise.wrapError(new _ErrorFromName(FetchError.doesNotExist));var perfID="itemsFetched id="+fetchID+" count="+fetchResult.items.length;profilerMarkStart(perfID),resultsValid(slot,refreshID,fetchID)&&(+index===index&&(fetchResult.absoluteIndex=index),addMarkers(fetchResult),processResults(slot,fetchResult.items,fetchResult.offset,fetchResult.totalCount,fetchResult.absoluteIndex)),profilerMarkEnd(perfID)}).then(null,function(error){resultsValid(slot,refreshID,fetchID)&&processErrorResult(slot,error)})}function fetchItemsForIndex(indexRequested,slot,fetchID,promiseItems){var refreshID=currentRefreshID;promiseItems.then(function(fetchResult){if(!fetchResult.items||!fetchResult.items.length)return Promise.wrapError(new _ErrorFromName(FetchError.doesNotExist));var perfID="itemsFetched id="+fetchID+" count="+fetchResult.items.length;profilerMarkStart(perfID),resultsValid(slot,refreshID,fetchID)&&(fetchResult.absoluteIndex=indexRequested,addMarkers(fetchResult),processResultsForIndex(indexRequested,slot,fetchResult.items,fetchResult.offset,fetchResult.totalCount,fetchResult.absoluteIndex)),profilerMarkEnd(perfID)}).then(null,function(){resultsValid(slot,refreshID,fetchID)&&processErrorResultForIndex(indexRequested,slot,refreshID)})}function fetchItemsFromStart(slot,count){var fetchID=setFetchIDs(slot,0,count-1);itemsFromStart?fetchItems(slot,fetchID,itemsFromStart(fetchID,count),0):fetchItems(slot,fetchID,itemsFromIndex(fetchID,0,0,count-1),0)}function fetchItemsFromEnd(slot,count){var fetchID=setFetchIDs(slot,count-1,0);fetchItems(slot,fetchID,itemsFromEnd(fetchID,count))}function fetchItemsFromKey(slot,countBefore,countAfter){var fetchID=setFetchIDs(slot,countBefore,countAfter);fetchItems(slot,fetchID,itemsFromKey(fetchID,slot.key,countBefore,countAfter,slot.hints))}function fetchItemsFromIndex(slot,countBefore,countAfter){var index=slot.index;if(countBefore>index&&(countBefore=index),itemsFromIndex){var fetchID=setFetchIDs(slot,countBefore,countAfter);fetchItems(slot,fetchID,itemsFromIndex(fetchID,index,countBefore,countAfter),index)}else if(slot.key)fetchItemsFromKey(slot,countBefore,countAfter);else{var slotSearch,delta,slotClosest=slotsStart,closestDelta=index+1;for(slotSearch=slot.prev;slotSearch!==slotsStart;slotSearch=slotSearch.prev)if(void 0!==slotSearch.index&&slotSearch.key){delta=index-slotSearch.index,closestDelta>delta&&(closestDelta=delta,slotClosest=slotSearch);break}for(slotSearch=slot.next;slotSearch!==slotListEnd;slotSearch=slotSearch.next)if(void 0!==slotSearch.index&&slotSearch.key){delta=slotSearch.index-index,closestDelta>delta&&(closestDelta=delta,slotClosest=slotSearch);break}if(slotClosest===slotsStart){var fetchID=setFetchIDs(slot,0,index+1);fetchItemsForIndex(0,slot,fetchID,itemsFromStart(fetchID,index+1))}else{var fetchBefore=Math.max(slotClosest.index-index,0),fetchAfter=Math.max(index-slotClosest.index,0),fetchID=setFetchIDs(slotClosest,fetchBefore,fetchAfter);fetchItemsForIndex(slotClosest.index,slot,fetchID,itemsFromKey(fetchID,slotClosest.key,fetchBefore,fetchAfter,slot.hints))}}}function fetchItemsFromDescription(slot,countBefore,countAfter){var fetchID=setFetchIDs(slot,countBefore,countAfter);fetchItems(slot,fetchID,itemsFromDescription(fetchID,slot.description,countBefore,countAfter))}function fetchItemsForAllSlots(){if(!refreshInProgress){for(var slotFirstPlaceholder,placeholderCount,slotRequestedByKey,requestedKeyOffset,slotRequestedByDescription,requestedDescriptionOffset,slotRequestedByIndex,requestedIndexOffset,fetchInProgress=!1,fetchesInProgress=!1,slot=slotsStart.next;slot!==slotsEnd;){var slotNext=slot.next;if(slot!==slotListEnd&&isPlaceholder(slot)&&(fetchesInProgress=!0,slotFirstPlaceholder?placeholderCount++:(slotFirstPlaceholder=slot,placeholderCount=1),slotFetchInProgress(slot)&&(fetchInProgress=!0),slot.keyRequested&&!slotRequestedByKey&&(slotRequestedByKey=slot,requestedKeyOffset=placeholderCount-1),void 0===slot.description||slotRequestedByDescription||(slotRequestedByDescription=slot,requestedDescriptionOffset=placeholderCount-1),slot.indexRequested&&!slotRequestedByIndex&&(slotRequestedByIndex=slot,requestedIndexOffset=placeholderCount-1),slot.lastInSequence||slotNext===slotsEnd||!isPlaceholder(slotNext))){if(fetchInProgress)fetchInProgress=!1;else{if(resultsProcessed=!1,!slotFirstPlaceholder.firstInSequence&&slotFirstPlaceholder.prev.key&&itemsFromKey?fetchItemsFromKey(slotFirstPlaceholder.prev,0,placeholderCount):!slot.lastInSequence&&slotNext.key&&itemsFromKey?fetchItemsFromKey(slotNext,placeholderCount,0):slotFirstPlaceholder.prev!==slotsStart||slotFirstPlaceholder.firstInSequence||!itemsFromStart&&!itemsFromIndex?slotNext===slotListEnd&&!slot.lastInSequence&&itemsFromEnd?fetchItemsFromEnd(slot,placeholderCount):slotRequestedByKey?fetchItemsFromKey(slotRequestedByKey,requestedKeyOffset,placeholderCount-1-requestedKeyOffset):slotRequestedByDescription?fetchItemsFromDescription(slotRequestedByDescription,requestedDescriptionOffset,placeholderCount-1-requestedDescriptionOffset):slotRequestedByIndex?fetchItemsFromIndex(slotRequestedByIndex,requestedIndexOffset,placeholderCount-1-requestedIndexOffset):"number"==typeof slotFirstPlaceholder.index?fetchItemsFromIndex(slotFirstPlaceholder,placeholderCount-1,0):deleteMirageSequence(slotFirstPlaceholder):fetchItemsFromStart(slotFirstPlaceholder,placeholderCount),resultsProcessed)return void postFetch();if(refreshInProgress)return}slotFirstPlaceholder=slotRequestedByIndex=slotRequestedByKey=null}slot=slotNext}setStatus(fetchesInProgress?DataSourceStatus.waiting:DataSourceStatus.ready)}}function postFetch(){fetchesPosted||(fetchesPosted=!0,Scheduler.schedule(function(){fetchesPosted=!1,fetchItemsForAllSlots(),finishNotifications()},Scheduler.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function itemChanged(slot){var itemNew=slot.itemNew;if(!itemNew)return!1;var item=slot.item;for(var property in item)switch(property){case"data":break;default:if(item[property]!==itemNew[property])return!0}return listDataAdapter.compareByIdentity?item.data!==itemNew.data:slot.signature!==itemSignature(itemNew)}function changeSlotIfNecessary(slot){slotRequested(slot)?itemChanged(slot)?changeSlot(slot):slot.itemNew=null:slot.item=null}function updateSlotItem(slot){slot.item?changeSlotIfNecessary(slot):completeFetchPromises(slot)}function updateSlot(slot,item){slot.key||setSlotKey(slot,item.key),slot.itemNew=item,updateSlotItem(slot)}function sendMirageNotifications(slot,slotToDiscard,listBindingIDsToDelete){var bindingMap=slotToDiscard.bindingMap;if(bindingMap)for(var listBindingID in listBindingIDsToDelete)if(bindingMap[listBindingID]){var fetchListeners=slotToDiscard.fetchListeners;for(var listenerID in fetchListeners){var listener=fetchListeners[listenerID];listener.listBindingID===listBindingID&&listener.retained&&(delete fetchListeners[listenerID],listener.complete(null))}var bindingRecord=bindingMap[listBindingID].bindingRecord;handlerToNotify(bindingRecord).removed(handleForBinding(slotToDiscard,listBindingID),!0,handleForBinding(slot,listBindingID)),
slotToDiscard.bindingMap&&delete slotToDiscard.bindingMap[listBindingID]}}function mergeSlots(slot,slotToDiscard){if(slot.index!==slotToDiscard.index){var indexOld=slotToDiscard.index;slotToDiscard.index=slot.index,sendIndexChangedNotifications(slotToDiscard,indexOld)}slotToDiscard.slotMergedWith=slot;var bindingMap=slotToDiscard.bindingMap;for(var listBindingID in bindingMap){slot.bindingMap||(slot.bindingMap={});var slotBinding=bindingMap[listBindingID];slotBinding.handle||(slotBinding.handle=slotToDiscard.handle),handleMap[slotBinding.handle]=slot,slot.bindingMap[listBindingID]=slotBinding}forEachBindingRecord(function(bindingRecord){bindingRecord.adjustCurrentSlot(slotToDiscard,slot)});var item=slotToDiscard.itemNew||slotToDiscard.item;if(item&&(item=Object.create(item),defineCommonItemProperties(item,slot,slot.handle),updateSlot(slot,item)),slot.item)slotToDiscard.directFetchListeners&&fetchCompleteCallbacks.push(function(){completePromises(slot.item,slotToDiscard.directFetchListeners)}),slotToDiscard.fetchListeners&&fetchCompleteCallbacks.push(function(){completePromises(slot.item,slotToDiscard.fetchListeners)});else{var listenerID;for(listenerID in slotToDiscard.directFetchListeners)slot.directFetchListeners||(slot.directFetchListeners={}),slot.directFetchListeners[listenerID]=slotToDiscard.directFetchListeners[listenerID];for(listenerID in slotToDiscard.fetchListeners)slot.fetchListeners||(slot.fetchListeners={}),slot.fetchListeners[listenerID]=slotToDiscard.fetchListeners[listenerID]}slot.itemNew&&completeFetchPromises(slot),slotToDiscard.handle=(nextHandle++).toString(),splitSequence(slotToDiscard),removeSlotPermanently(slotToDiscard)}function mergeSlotsAndItem(slot,slotToDiscard,item){slotToDiscard&&slotToDiscard.key&&(item||(item=slotToDiscard.itemNew||slotToDiscard.item),delete slotToDiscard.key,delete keyMap[item.key],slotToDiscard.itemNew=null,slotToDiscard.item=null),item&&updateSlot(slot,item),slotToDiscard&&mergeSlots(slot,slotToDiscard)}function slotFromResult(result){if("object"!=typeof result)throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",strings.invalidItemReturned);if(result===startMarker)return slotsStart;if(result===endMarker)return slotListEnd;if(result.key)return _BaseUtils.validation&&validateKey(result.key),keyMap[result.key];throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",strings.invalidKeyReturned)}function matchSlot(slot,result){var slotExisting=slotFromResult(result);slotExisting===slot&&(slotExisting=null),slotExisting&&sendMirageNotifications(slot,slotExisting,slot.bindingMap),mergeSlotsAndItem(slot,slotExisting,result)}function promoteSlot(slot,item,index,insertionPoint){if(item&&slot.key&&slot.key!==item.key)return beginRefresh(),!1;var slotWithIndex=indexMap[index];if(slotWithIndex)if(slotWithIndex===slot)slotWithIndex=null;else{if(slotWithIndex.key&&(slot.key||item&&slotWithIndex.key!==item.key))return beginRefresh(),!1;if(!slot.key&&slotWithIndex.bindingMap)return!1}var slotWithKey;if(item)if(slotWithKey=keyMap[item.key],slotWithKey===slot)slotWithKey=null;else if(slotWithKey&&slotWithKey.bindingMap)return!1;return slotWithIndex?(sendMirageNotifications(slot,slotWithIndex,slot.bindingMap),delete indexMap[index],changeSlotIndex(slot,index),slot.prev.index===index-1&&mergeSequences(slot.prev),slot.next.index===index+1&&mergeSequences(slot),insertionPoint.slotNext=slotWithIndex.slotNext,item||(item=slotWithIndex.itemNew||slotWithIndex.item,item&&(slotWithKey=keyMap[item.key]))):changeSlotIndex(slot,index),slotWithKey&&slotWithIndex!==slotWithKey&&sendMirageNotifications(slot,slotWithKey,slot.bindingMap),mergeSlotsAndItem(slot,slotWithKey,item),slotWithIndex&&slotWithIndex!==slotWithKey&&mergeSlots(slot,slotWithIndex),!0}function mergeAdjacentSlot(slotExisting,slot,listBindingIDsToDelete){if(slot.key&&slotExisting.key&&slot.key!==slotExisting.key)return beginRefresh(),!1;for(var listBindingID in slotExisting.bindingMap)listBindingIDsToDelete[listBindingID]=!0;return sendMirageNotifications(slotExisting,slot,listBindingIDsToDelete),mergeSlotsAndItem(slotExisting,slot),!0}function mergeSlotsBefore(slot,slotExisting){for(var listBindingIDsToDelete={};slot;){var slotPrev=slot.firstInSequence?null:slot.prev;if(slotExisting.firstInSequence||slotExisting.prev!==slotsStart){if(slotExisting=slotExisting.firstInSequence?addSlotBefore(slotExisting,indexMap):slotExisting.prev,!mergeAdjacentSlot(slotExisting,slot,listBindingIDsToDelete))return}else deleteSlot(slot,!0);slot=slotPrev}}function mergeSlotsAfter(slot,slotExisting){for(var listBindingIDsToDelete={};slot;){var slotNext=slot.lastInSequence?null:slot.next;if(slotExisting.lastInSequence||slotExisting.next!==slotListEnd){if(slotExisting=slotExisting.lastInSequence?addSlotAfter(slotExisting,indexMap):slotExisting.next,!mergeAdjacentSlot(slotExisting,slot,listBindingIDsToDelete))return}else deleteSlot(slot,!0);slot=slotNext}}function mergeSequencePairs(sequencePairsToMerge){for(var i=0;i<sequencePairsToMerge.length;i++){var sequencePairToMerge=sequencePairsToMerge[i];mergeSlotsBefore(sequencePairToMerge.slotBeforeSequence,sequencePairToMerge.slotFirstInSequence),mergeSlotsAfter(sequencePairToMerge.slotAfterSequence,sequencePairToMerge.slotLastInSequence)}}function removeMirageIndices(countMax,indexFirstKnown){function removePlaceholdersAfterSlot(slotRemoveAfter){for(var slot2=slotListEnd.prev;!(slot2.index<countMax)&&slot2!==slotRemoveAfter;){var slotPrev2=slot2.prev;void 0!==slot2.index&&deleteSlot(slot2,!0),slot2=slotPrev2}placeholdersAtEnd=0}for(var placeholdersAtEnd=0,slot=slotListEnd.prev;!(slot.index<countMax)||placeholdersAtEnd>0;){var slotPrev=slot.prev;if(slot===slotsStart){removePlaceholdersAfterSlot(slotsStart);break}if(slot.key){if(slot.index>=countMax)return beginRefresh(),!1;if(!(slot.index>=indexFirstKnown))return itemsFromKey?fetchItemsFromKey(slot,0,placeholdersAtEnd):fetchItemsFromIndex(slot,0,placeholdersAtEnd),!1;removePlaceholdersAfterSlot(slot)}else slot.indexRequested||slot.firstInSequence?removePlaceholdersAfterSlot(slotPrev):placeholdersAtEnd++;slot=slotPrev}return!0}function processResults(slot,results,offset,count,index){var perfId="WinJS.UI.ListDataSource.processResults";return profilerMarkStart(perfId),index=validateIndexReturned(index),count=validateCountReturned(count),editsQueued?void profilerMarkEnd(perfId):(indexUpdateDeferred&&updateIndices(),!isNonNegativeNumber(count)&&count!==CountResult.unknown||count===knownCount||slotListEnd.firstInSequence?(resultsProcessed=!0,function(){var i,j,slotExisting,slotBefore,resultsCount=results.length;if("number"!=typeof index)for(i=0;resultsCount>i;i++)if(slotExisting=slotFromResult(results[i]),slotExisting&&void 0!==slotExisting.index){index=slotExisting.index+offset-i;break}"number"==typeof index&&results[resultsCount-1]===endMarker?count=index-offset+resultsCount-1:!isNonNegativeNumber(count)||void 0!==index&&null!==index||(index=count-(resultsCount-1)+offset),isNonNegativeNumber(count)&&!removeMirageIndices(count,index-offset)&&(count=void 0);var offsetMap=new Array(resultsCount);for(i=0;resultsCount>i;i++){var slotBestMatch=null;if(slotExisting=slotFromResult(results[i])){if(i>0&&!slotExisting.firstInSequence&&slotExisting.prev.key&&slotExisting.prev.key!==results[i-1].key||"number"==typeof index&&void 0!==slotExisting.index&&slotExisting.index!==index-offset+i)return void beginRefresh();(slotExisting===slotsStart||slotExisting===slotListEnd||slotExisting.bindingMap)&&(slotBestMatch=slotExisting)}if("number"==typeof index&&(slotExisting=indexMap[index-offset+i])){if(slotExisting.key&&slotExisting.key!==results[i].key)return void beginRefresh();!slotBestMatch&&slotExisting.bindingMap&&(slotBestMatch=slotExisting)}if(i===offset){if(slot.key&&slot.key!==results[i].key||"number"==typeof slot.index&&"number"==typeof index&&slot.index!==index)return void beginRefresh();slotBestMatch||(slotBestMatch=slot)}offsetMap[i]=slotBestMatch}for(i=0;resultsCount>i;i++)slotExisting=offsetMap[i],slotExisting&&void 0!==slotExisting.index&&slotExisting!==slotsStart&&slotExisting!==slotListEnd&&matchSlot(slotExisting,results[i]);var slotBeforeSequence,slotAfterSequence,sequencePairsToMerge=[],firstSequence=!0;for(i=0;resultsCount>i;i++)if(slotExisting=offsetMap[i],slotExisting&&slotExisting!==slotListEnd){var iLast=i;if(void 0===slotExisting.index){var insertionPoint={};promoteSlot(slotExisting,results[i],index-offset+i,insertionPoint);var result,slotFirstInSequence=slotExisting,slotLastInSequence=slotExisting;for(j=i-1;!slotFirstInSequence.firstInSequence&&(result=results[j],result!==startMarker);j--){var index2=index-offset+j;if(0>index2)break;if(!promoteSlot(slotFirstInSequence.prev,result,index2,insertionPoint))break;slotFirstInSequence=slotFirstInSequence.prev,j>=0&&(offsetMap[j]=slotFirstInSequence)}for(j=i+1;!slotLastInSequence.lastInSequence&&(result=results[j],result!==endMarker&&j!==count||slotLastInSequence.next===slotListEnd)&&(slotLastInSequence.next===slotListEnd||promoteSlot(slotLastInSequence.next,result,index-offset+j,insertionPoint))&&(slotLastInSequence=slotLastInSequence.next,resultsCount>j&&(offsetMap[j]=slotLastInSequence),iLast=j,slotLastInSequence!==slotListEnd);j++);if(slotBeforeSequence=slotFirstInSequence.firstInSequence?null:slotFirstInSequence.prev,slotAfterSequence=slotLastInSequence.lastInSequence?null:slotLastInSequence.next,slotBeforeSequence&&splitSequence(slotBeforeSequence),slotAfterSequence&&splitSequence(slotLastInSequence),"number"==typeof index){if(slotLastInSequence===slotListEnd)slotBeforeSequence&&moveSequenceAfter(slotListEnd,sequenceStart(slotBeforeSequence),slotBeforeSequence);else{var slotInsertBefore=insertionPoint.slotNext;slotInsertBefore||(slotInsertBefore=successorFromIndex(slotLastInSequence.index,indexMap,slotsStart,slotListEnd,!0)),moveSequenceBefore(slotInsertBefore,slotFirstInSequence,slotLastInSequence)}slotFirstInSequence.prev.index===slotFirstInSequence.index-1&&mergeSequences(slotFirstInSequence.prev),slotLastInSequence.next.index===slotLastInSequence.index+1&&mergeSequences(slotLastInSequence)}else firstSequence||(slotBefore=offsetMap[i-1],slotBefore&&(slotFirstInSequence.prev!==slotBefore&&(slotLastInSequence===slotListEnd?(slotBeforeSequence&&moveSequenceAfter(slotListEnd,sequenceStart(slotBeforeSequence),slotBeforeSequence),moveSequenceBefore(slotFirstInSequence,sequenceStart(slotBefore),slotBefore)):moveSequenceAfter(slotBefore,slotFirstInSequence,slotLastInSequence)),mergeSequences(slotBefore)));if(firstSequence=!1,refreshRequested)return;sequencePairsToMerge.push({slotBeforeSequence:slotBeforeSequence,slotFirstInSequence:slotFirstInSequence,slotLastInSequence:slotLastInSequence,slotAfterSequence:slotAfterSequence})}i!==offset||slotExisting===slot||slotPermanentlyRemoved(slot)||(slotBeforeSequence=slot.firstInSequence?null:slot.prev,slotAfterSequence=slot.lastInSequence?null:slot.next,sendMirageNotifications(slotExisting,slot,slotExisting.bindingMap),mergeSlots(slotExisting,slot),sequencePairsToMerge.push({slotBeforeSequence:slotBeforeSequence,slotFirstInSequence:slotExisting,slotLastInSequence:slotExisting,slotAfterSequence:slotAfterSequence})),i=iLast}for(isNonNegativeNumber(count)&&slotListEnd.index!==count&&changeSlotIndex(slotListEnd,count),mergeSequencePairs(sequencePairsToMerge),i=0;resultsCount>i;i++)if(slotExisting=offsetMap[i]){for(j=i-1;j>=0;j--){var slotAfter=offsetMap[j+1];matchSlot(offsetMap[j]=slotAfter.firstInSequence?addSlotBefore(offsetMap[j+1],indexMap):slotAfter.prev,results[j])}for(j=i+1;resultsCount>j;j++)slotBefore=offsetMap[j-1],slotExisting=offsetMap[j],slotExisting?slotExisting.firstInSequence&&(slotExisting.prev!==slotBefore&&moveSequenceAfter(slotBefore,slotExisting,sequenceEnd(slotExisting)),mergeSequences(slotBefore)):matchSlot(offsetMap[j]=slotBefore.lastInSequence?addSlotAfter(slotBefore,indexMap):slotBefore.next,results[j]);break}delete slot.description}(),refreshRequested||(void 0!==count&&count!==knownCount&&changeCount(count),postFetch()),finishNotifications(),callFetchCompleteCallbacks(),void profilerMarkEnd(perfId)):(beginRefresh(),void profilerMarkEnd(perfId)))}function processErrorResult(slot,error){switch(error.name){case FetchError.noResponse:setStatus(DataSourceStatus.failure),returnDirectFetchError(slot,error);break;case FetchError.doesNotExist:slot.indexRequested?removeMirageIndices(slot.index):(slot.keyRequested||slot.description)&&deleteMirageSequence(slot),finishNotifications(),beginRefresh()}}function processResultsForIndex(indexRequested,slot,results,offset,count,index){index=validateIndexReturned(index),count=validateCountReturned(count);var indexFirst=indexRequested-offset,resultsCount=results.length;if(slot.index>=indexFirst&&slot.index<indexFirst+resultsCount)processResults(slot,results,slot.index-indexFirst,count,slot.index);else if(offset===resultsCount-1&&indexRequested<slot.index||isNonNegativeNumber(count)&&count<=slot.index)processErrorResult(slot,new _ErrorFromName(FetchError.doesNotExist));else if(slot.index<indexFirst){var fetchID=setFetchIDs(slot,0,indexFirst-slot.index);fetchItemsForIndex(indexFirst,slot,fetchID,itemsFromKey(fetchID,results[0].key,indexFirst-slot.index,0))}else{var indexLast=indexFirst+resultsCount-1,fetchID=setFetchIDs(slot,slot.index-indexLast,0);fetchItemsForIndex(indexLast,slot,fetchID,itemsFromKey(fetchID,results[resultsCount-1].key,0,slot.index-indexLast))}}function processErrorResultForIndex(indexRequested,slot,error){switch(error.name){case FetchError.doesNotExist:indexRequested===slotsStart.index?(removeMirageIndices(0),processErrorResult(slot,error)):beginRefresh();break;default:processErrorResult(slot,error)}}function identifyRefreshCycle(){for(var start=0;start<refreshHistory.length&&"beginRefresh"!==refreshHistory[start].kind;start++);for(var end=start;end<refreshHistory.length&&"beginRefresh"!==refreshHistory[end].kind;end++);if(end>start&&end+(end-start)<refreshHistory.length){for(var match=!0,length=end-start,i=0;length>i;i++)if(refreshHistory[start+i].kind!==refreshHistory[end+i].kind){match=!1;break}if(match&&_Log.log){_Log.log(strings.refreshCycleIdentified,"winjs vds","error");for(var i=start;end>i;i++)_Log.log(""+(i-start)+": "+JSON.stringify(refreshHistory[i]),"winjs vds","error")}return match}}function resetRefreshState(){return++beginRefreshCount>MAX_BEGINREFRESH_COUNT&&identifyRefreshCycle()?void setStatus(DataSourceStatus.failure):(refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"beginRefresh"},refreshStart={firstInSequence:!0,lastInSequence:!0,index:-1},refreshEnd={firstInSequence:!0,lastInSequence:!0},refreshStart.next=refreshEnd,refreshEnd.prev=refreshStart,refreshItemsFetched=!1,refreshCount=void 0,keyFetchIDs={},refreshKeyMap={},refreshIndexMap={},refreshIndexMap[-1]=refreshStart,void(deletedKeys={}))}function beginRefresh(){if(!refreshRequested){if(refreshRequested=!0,setStatus(DataSourceStatus.waiting),waitForRefresh)return waitForRefresh=!1,void applyNextEdit();if(!editsQueued){var refreshID=++currentRefreshID;refreshInProgress=!0,refreshFetchesInProgress=0,Scheduler.schedule(function(){if(currentRefreshID===refreshID){refreshRequested=!1,resetRefreshState();for(var slot=slotsStart.next;slot!==slotsEnd;){var slotNext=slot.next;slotLive(slot)||slot===slotListEnd||deleteUnnecessarySlot(slot),slot=slotNext}startRefreshFetches()}},Scheduler.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function requestRefresh(){return refreshSignal=refreshSignal||new _Signal,beginRefresh(),refreshSignal.promise}function resultsValidForRefresh(refreshID,fetchID){return delete fetchesInProgress[fetchID],refreshID!==currentRefreshID?!1:(refreshFetchesInProgress--,!0)}function fetchItemsForRefresh(key,fromStart,fetchID,promiseItems,index){var refreshID=currentRefreshID;refreshFetchesInProgress++,promiseItems.then(function(fetchResult){if(!fetchResult.items||!fetchResult.items.length)return Promise.wrapError(new _ErrorFromName(FetchError.doesNotExist));var perfID="itemsFetched id="+fetchID+" count="+fetchResult.items.length;profilerMarkStart(perfID),resultsValidForRefresh(refreshID,fetchID)&&(addMarkers(fetchResult),processRefreshResults(key,fetchResult.items,fetchResult.offset,fetchResult.totalCount,"number"==typeof index?index:fetchResult.absoluteIndex)),profilerMarkEnd(perfID)}).then(null,function(error){resultsValidForRefresh(refreshID,fetchID)&&processRefreshErrorResult(key,fromStart,error)})}function refreshRange(slot,fetchID,countBefore,countAfter){if(itemsFromKey)fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromKey(fetchID,slot.key,countBefore,countAfter,slot.hints));else{var searchDelta=10,index=slot.index;refreshIndexMap[index]&&refreshIndexMap[index].firstInSequence?fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromIndex(fetchID,index-1,Math.min(countBefore+searchDelta,index)-1,countAfter+1+searchDelta),index-1):refreshIndexMap[index]&&refreshIndexMap[index].lastInSequence?fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromIndex(fetchID,index+1,Math.min(countBefore+searchDelta,index)+1,countAfter-1+searchDelta),index+1):fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromIndex(fetchID,index,Math.min(countBefore+searchDelta,index),countAfter+searchDelta),index)}}function refreshFirstItem(fetchID){itemsFromStart?fetchItemsForRefresh(null,!0,fetchID,itemsFromStart(fetchID,1),0):itemsFromIndex&&fetchItemsForRefresh(null,!0,fetchID,itemsFromIndex(fetchID,0,0,0),0)}function keyFetchInProgress(key){return fetchesInProgress[keyFetchIDs[key]]}function refreshRanges(slotFirst,allRanges){for(var slotFetchFirst,slotRefreshFirst,fetchID,refreshFetchExtra=3,refreshID=currentRefreshID,fetchCount=0,slot=slotFirst;slot!==slotsEnd;slot=slot.next){if(!slotFetchFirst&&slot.key&&!deletedKeys[slot.key]&&!keyFetchInProgress(slot.key)){var slotRefresh=refreshKeyMap[slot.key];(!slotRefresh||slotRefresh.firstInSequence||slotRefresh.lastInSequence)&&(slotFetchFirst=slot,slotRefreshFirst=slotRefresh,fetchID=newFetchID())}if(slotFetchFirst){var keyAlreadyFetched=keyFetchInProgress(slot.key);if(deletedKeys[slot.key]||refreshKeyMap[slot.key]||keyAlreadyFetched||(slot.key&&(keyFetchIDs[slot.key]=fetchID),fetchCount++),slot.lastInSequence||slot.next===slotListEnd||keyAlreadyFetched){if(refreshRange(slotFetchFirst,fetchID,!slotRefreshFirst||slotRefreshFirst.firstInSequence?refreshFetchExtra:0,fetchCount-1+refreshFetchExtra),!allRanges)break;slotFetchFirst=null,fetchCount=0}}else slot.key&&isPlaceholder(slot)&&!deletedKeys[slot.key]&&(refreshKeyMap[slot.key]||(fetchID=newFetchID(),fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromKey(fetchID,slot.key,1,1,slot.hints))))}0!==refreshFetchesInProgress||refreshItemsFetched||currentRefreshID!==refreshID||refreshFirstItem(newFetchID())}function startRefreshFetches(){var refreshID=currentRefreshID;do synchronousProgress=!1,reentrantContinue=!0,refreshRanges(slotsStart.next,!0),reentrantContinue=!1;while(0===refreshFetchesInProgress&&synchronousProgress&&currentRefreshID===refreshID&&refreshInProgress);0===refreshFetchesInProgress&&currentRefreshID===refreshID&&concludeRefresh()}function continueRefresh(key){var refreshID=currentRefreshID;if(key){var slotContinue=keyMap[key];slotContinue||(slotContinue=slotsStart.next);do synchronousRefresh=!1,reentrantRefresh=!0,refreshRanges(slotContinue,!1),reentrantRefresh=!1;while(synchronousRefresh&&currentRefreshID===refreshID&&refreshInProgress)}reentrantContinue?synchronousProgress=!0:0===refreshFetchesInProgress&&currentRefreshID===refreshID&&startRefreshFetches()}function slotRefreshFromResult(result){if("object"==typeof result&&result){if(result===startMarker)return refreshStart;if(result===endMarker)return refreshEnd;if(result.key)return refreshKeyMap[result.key];throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",strings.invalidKeyReturned)}throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",strings.invalidItemReturned)}function processRefreshSlotIndex(slot,expectedIndex){for(;void 0===slot.index;){if(setSlotIndex(slot,expectedIndex,refreshIndexMap),slot.firstInSequence)return!0;slot=slot.prev,expectedIndex--}return slot.index!==expectedIndex?(beginRefresh(),!1):!0}function setRefreshSlotResult(slotRefresh,result){slotRefresh.key=result.key,refreshKeyMap[slotRefresh.key]=slotRefresh,slotRefresh.item=result}function lastRefreshInsertionPoint(){for(var slotNext=refreshEnd;!slotNext.firstInSequence;)if(slotNext=slotNext.prev,slotNext===refreshStart)return null;return slotNext}function processRefreshResults(key,results,offset,count,index){index=validateIndexReturned(index),count=validateCountReturned(count);var keyPresent=!1;refreshItemsFetched=!0;var indexFirst=index-offset,result=results[0];result.key===key&&(keyPresent=!0);var slot=slotRefreshFromResult(result);if(slot){if(+indexFirst===indexFirst&&!processRefreshSlotIndex(slot,indexFirst))return}else{if(refreshIndexMap[indexFirst])return void beginRefresh();var slotPrev;if(void 0!==index&&(slotPrev=refreshIndexMap[indexFirst-1])){if(!slotPrev.lastInSequence)return void beginRefresh();slot=addSlotAfter(slotPrev,refreshIndexMap)}else{var slotSuccessor=+indexFirst===indexFirst?successorFromIndex(indexFirst,refreshIndexMap,refreshStart,refreshEnd):lastRefreshInsertionPoint(refreshStart,refreshEnd);if(!slotSuccessor)return void beginRefresh();slot=createSlotSequence(slotSuccessor,indexFirst,refreshIndexMap)}setRefreshSlotResult(slot,results[0])}for(var resultsCount=results.length,i=1;resultsCount>i;i++){result=results[i],result.key===key&&(keyPresent=!0);var slotNext=slotRefreshFromResult(result);if(slotNext){if(void 0!==slot.index&&!processRefreshSlotIndex(slotNext,slot.index+1))return;if(slotNext!==slot.next){if(!slot.lastInSequence||!slotNext.firstInSequence)return void beginRefresh();var slotLast=sequenceEnd(slotNext);if(slotLast!==refreshEnd)moveSequenceAfter(slot,slotNext,slotLast);else{var slotFirst=sequenceStart(slot);if(slotFirst===refreshStart)return void beginRefresh();moveSequenceBefore(slotNext,slotFirst,slot)}mergeSequences(slot)}else slot.lastInSequence&&mergeSequences(slot)}else{if(!slot.lastInSequence)return void beginRefresh();slotNext=addSlotAfter(slot,refreshIndexMap),setRefreshSlotResult(slotNext,result)}slot=slotNext}if(keyPresent||(deletedKeys[key]=!0),!isNonNegativeNumber(count)&&!refreshEnd.firstInSequence){var indexLast=refreshEnd.prev.index;void 0!==indexLast&&(count=indexLast+1)}if(isNonNegativeNumber(count)||count===CountResult.unknown){if(isNonNegativeNumber(refreshCount)){if(count!==refreshCount)return void beginRefresh()}else refreshCount=count;isNonNegativeNumber(refreshCount)&&!refreshIndexMap[refreshCount]&&setSlotIndex(refreshEnd,refreshCount,refreshIndexMap)}reentrantRefresh?synchronousRefresh=!0:continueRefresh(key)}function processRefreshErrorResult(key,fromStart,error){switch(error.name){case FetchError.noResponse:setStatus(DataSourceStatus.failure);break;case FetchError.doesNotExist:fromStart?(setSlotIndex(refreshEnd,0,refreshIndexMap),refreshCount=0,concludeRefresh()):(deletedKeys[key]=!0,reentrantRefresh?synchronousRefresh=!0:continueRefresh(key))}}function slotFromSlotRefresh(slotRefresh){return slotRefresh===refreshStart?slotsStart:slotRefresh===refreshEnd?slotListEnd:keyMap[slotRefresh.key]}function slotRefreshFromSlot(slot){return slot===slotsStart?refreshStart:slot===slotListEnd?refreshEnd:refreshKeyMap[slot.key]}function mergeSequencesForRefresh(slotPrev){mergeSequences(slotPrev),slotPrev.next.mergedForRefresh=!0}function copyRefreshSlotData(slotRefresh,slot){setSlotKey(slot,slotRefresh.key),slot.itemNew=slotRefresh.item}function addNewSlotFromRefresh(slotRefresh,slotNext,insertAfter){var slotNew=createPrimarySlot();copyRefreshSlotData(slotRefresh,slotNew),insertAndMergeSlot(slotNew,slotNext,insertAfter,!insertAfter);var index=slotRefresh.index;return+index!==index&&(index=insertAfter?slotNew.prev.index+1:slotNext.next.index-1),setSlotIndex(slotNew,index,indexMap),slotNew}function matchSlotForRefresh(slotExisting,slot,slotRefresh){slotExisting?(sendMirageNotifications(slotExisting,slot,slotExisting.bindingMap),mergeSlotsAndItem(slotExisting,slot,slotRefresh.item)):(copyRefreshSlotData(slotRefresh,slot),slot.indexRequested&&updateSlotItem(slot))}function updateSlotForRefresh(slotExisting,slot,slotRefresh){return slot.key?!1:(slotExisting?(slotRefresh.mergeWithPrev=!slot.firstInSequence,slotRefresh.mergeWithNext=!slot.lastInSequence):slotRefresh.stationary=!0,matchSlotForRefresh(slotExisting,slot,slotRefresh),!0)}function indexForRefresh(slot){var indexNew;if(slot.indexRequested)indexNew=slot.index;else{var slotRefresh=slotRefreshFromSlot(slot);slotRefresh&&(indexNew=slotRefresh.index)}return indexNew}function concludeRefresh(){beginRefreshCount=0,refreshHistory=new Array(100),refreshHistoryPos=-1,indexUpdateDeferred=!0,keyFetchIDs={};var i,j,slot,slotPrev,slotNext,slotBefore,slotAfter,slotRefresh,slotExisting,slotFirstInSequence,sequenceCountOld,sequenceOld,sequenceOldPrev,sequenceOldBestMatch,sequenceCountNew,sequenceNew,index,offset,sequencesOld=[],sequencesNew=[];for(sequenceCountNew=0,slotRefresh=refreshStart;slotRefresh;slotRefresh=slotRefresh.next)slotRefresh.sequenceNumber=sequenceCountNew,slotRefresh.firstInSequence&&(slotFirstInSequence=slotRefresh),slotRefresh.lastInSequence&&(sequencesNew[sequenceCountNew]={first:slotFirstInSequence,last:slotRefresh,matchingItems:0},sequenceCountNew++);for(lastSlotReleased=null,releasedSlots=0,slot=slotsStart.next;slot!==slotsEnd;)slotRefresh=refreshKeyMap[slot.key],slotNext=slot.next,slot!==slotListEnd&&(slotLive(slot)?slot.key&&!slotRefresh?deleteSlot(slot,!1):0===refreshCount||slot.indexRequested&&slot.index>=refreshCount?deleteSlot(slot,!0):slot.item||slot.keyRequested?slot.itemNew=slotRefresh.item:slot.key&&(slot.keyRequested||(delete keyMap[slot.key],delete slot.key),slot.itemNew=null):deleteUnnecessarySlot(slot)),slot=slotNext;for(slot=slotsStart.next;slot!==slotListEnd;)slotNext=slot.next,slot.indexRequested&&(slotRefresh=refreshIndexMap[slot.index],slotRefresh&&matchSlotForRefresh(slotFromSlotRefresh(slotRefresh),slot,slotRefresh)),slot=slotNext;var bestMatch,bestMatchCount,slotIndexRequested,sequenceIndexEnd,sequenceOldEnd,previousBestMatch=0,newSequenceCounts=[];for(sequenceCountOld=0,slot=slotsStart;slot!==slotsEnd;slot=slot.next){if(slot.firstInSequence)for(slotFirstInSequence=slot,slotIndexRequested=null,i=0;sequenceCountNew>i;i++)newSequenceCounts[i]=0;if(slot.indexRequested&&(slotIndexRequested=slot),slotRefresh=slotRefreshFromSlot(slot),slotRefresh&&newSequenceCounts[slotRefresh.sequenceNumber]++,slot.lastInSequence){for(bestMatchCount=0,i=previousBestMatch;sequenceCountNew>i;i++)bestMatchCount<newSequenceCounts[i]&&(bestMatchCount=newSequenceCounts[i],bestMatch=i);sequenceOld={first:slotFirstInSequence,last:slot,sequenceNew:bestMatchCount>0?sequencesNew[bestMatch]:void 0,matchingItems:bestMatchCount},slotIndexRequested&&(sequenceOld.indexRequested=!0,sequenceOld.stationarySlot=slotIndexRequested),sequencesOld[sequenceCountOld]=sequenceOld,slot===slotListEnd&&(sequenceIndexEnd=sequenceCountOld,sequenceOldEnd=sequenceOld),sequenceCountOld++,void 0!==sequencesNew[bestMatch].first.index&&(previousBestMatch=bestMatch)}}sequencesOld[0].sequenceNew!==sequencesNew[0]&&(splitSequence(slotsStart),sequencesOld[0].first=slotsStart.next,sequencesOld.unshift({first:slotsStart,last:slotsStart,sequenceNew:sequencesNew[0],matchingItems:1}),sequenceIndexEnd++,sequenceCountOld++);var listEndObserved=!slotListEnd.firstInSequence;for(sequenceOldEnd.sequenceNew!==sequencesNew[sequenceCountNew-1]&&(splitSequence(slotListEnd.prev),sequenceOldEnd.last=slotListEnd.prev,sequenceIndexEnd++,sequencesOld.splice(sequenceIndexEnd,0,{first:slotListEnd,last:slotListEnd,sequenceNew:sequencesNew[sequenceCountNew-1],matchingItems:1}),sequenceCountOld++,sequenceOldEnd=sequencesOld[sequenceIndexEnd]),i=0;sequenceCountOld>i;i++)sequenceNew=sequencesOld[i].sequenceNew,sequenceNew&&sequenceNew.matchingItems<sequencesOld[i].matchingItems&&(sequenceNew.matchingItems=sequencesOld[i].matchingItems,sequenceNew.sequenceOld=sequencesOld[i]);for(sequencesNew[sequenceCountNew-1].sequenceOld=sequenceOldEnd,sequenceOldEnd.stationarySlot=slotListEnd,sequencesNew[0].sequenceOld=sequencesOld[0],sequencesOld[0].stationarySlot=slotsStart,i=0;sequenceIndexEnd>=i;i++)sequenceOld=sequencesOld[i],sequenceOld.sequenceNew&&(sequenceOldBestMatch=sequenceOld.sequenceNew.sequenceOld)===sequenceOldPrev&&sequenceOldPrev.last!==slotListEnd?(mergeSequencesForRefresh(sequenceOldBestMatch.last),sequenceOldBestMatch.last=sequenceOld.last,delete sequencesOld[i]):sequenceOldPrev=sequenceOld;for(sequenceOldPrev=null,i=sequenceIndexEnd;i>=0;i--)sequenceOld=sequencesOld[i],sequenceOld&&(sequenceOld.sequenceNew&&(sequenceOldBestMatch=sequenceOld.sequenceNew.sequenceOld)===sequenceOldPrev&&sequenceOld.last!==slotListEnd?(mergeSequencesForRefresh(sequenceOld.last),sequenceOldBestMatch.first=sequenceOld.first,delete sequencesOld[i]):sequenceOldPrev=sequenceOld);listEndObserved&&delete slotListEnd.mergedForRefresh;var sequencePairsToMerge=[];for(i=sequenceIndexEnd+1;sequenceCountOld>i;i++)if(sequenceOld=sequencesOld[i],sequenceOld&&(!sequenceOld.sequenceNew||sequenceOld.sequenceNew.sequenceOld!==sequenceOld)){var orderPreserved=!0,slotRefreshFirst=null,slotRefreshLast=null,sequenceLength=0;for(slotRefresh=slotRefreshFromSlot(sequenceOld.first),slotRefresh&&(slotRefreshFirst=slotRefreshLast=slotRefresh,sequenceLength=1),slot=sequenceOld.first;slot!==sequenceOld.last;slot=slot.next){var slotRefreshNext=slotRefreshFromSlot(slot.next);if(slotRefresh&&slotRefreshNext&&(slotRefresh.lastInSequence||slotRefresh.next!==slotRefreshNext)){orderPreserved=!1;break}slotRefresh&&!slotRefreshFirst&&(slotRefreshFirst=slotRefreshLast=slotRefresh),slotRefreshNext&&slotRefreshFirst&&(slotRefreshLast=slotRefreshNext,sequenceLength++),slotRefresh=slotRefreshNext}if(orderPreserved&&slotRefreshFirst&&void 0!==slotRefreshFirst.index){var indexBefore;slotRefreshFirst.firstInSequence||(slotBefore=slotFromSlotRefresh(slotRefreshFirst.prev),slotBefore&&(indexBefore=slotBefore.index));var indexAfter;if(slotRefreshLast.lastInSequence||(slotAfter=slotFromSlotRefresh(slotRefreshLast.next),slotAfter&&(indexAfter=slotAfter.index)),(!slotAfter||slotAfter.lastInSequence||slotAfter.mergedForRefresh)&&(void 0===indexBefore||void 0===indexAfter||indexAfter-indexBefore-1>=sequenceLength)){for(sequenceOld.locationJustDetermined=!0,slotRefresh=slotRefreshFirst;slotRefresh.locationJustDetermined=!0,slotRefresh!==slotRefreshLast;slotRefresh=slotRefresh.next);var slotFirstInSequence=slotFromSlotRefresh(slotRefreshFirst),slotLastInSequence=slotFromSlotRefresh(slotRefreshLast);sequencePairsToMerge.push({slotBeforeSequence:slotFirstInSequence.firstInSequence?null:slotFirstInSequence.prev,slotFirstInSequence:slotFirstInSequence,slotLastInSequence:slotLastInSequence,slotAfterSequence:slotLastInSequence.lastInSequence?null:slotLastInSequence.next})}}}for(i=0;sequenceCountOld>i;i++)if(sequenceOld=sequencesOld[i],sequenceOld&&!sequenceOld.indexRequested&&!sequenceOld.locationJustDetermined&&(!sequenceOld.sequenceNew||sequenceOld.sequenceNew.sequenceOld!==sequenceOld)){sequenceOld.sequenceNew=null,slot=sequenceOld.first;var sequenceEndReached;do{if(sequenceEndReached=slot===sequenceOld.last,slotNext=slot.next,slot!==slotsStart&&slot!==slotListEnd&&slot!==slotsEnd&&!slot.item&&!slot.keyRequested)if(deleteSlot(slot,!0),sequenceOld.first===slot){if(sequenceOld.last===slot){delete sequencesOld[i];break}sequenceOld.first=slot.next}else sequenceOld.last===slot&&(sequenceOld.last=slot.prev);slot=slotNext}while(!sequenceEndReached)}for(i=0;sequenceCountNew>i;i++){for(sequenceNew=sequencesNew[i],slotRefresh=sequenceNew.first;!slotFromSlotRefresh(slotRefresh)&&!slotRefresh.lastInSequence;slotRefresh=slotRefresh.next);if(slotRefresh.lastInSequence&&!slotFromSlotRefresh(slotRefresh))sequenceNew.firstInner=sequenceNew.lastInner=null;else{
for(sequenceNew.firstInner=slotRefresh,slotRefresh=sequenceNew.last;!slotFromSlotRefresh(slotRefresh);slotRefresh=slotRefresh.prev);sequenceNew.lastInner=slotRefresh}}for(i=0;sequenceCountNew>i;i++)if(sequenceNew=sequencesNew[i],sequenceNew&&sequenceNew.firstInner&&(sequenceOld=sequenceNew.sequenceOld)){var ordinal=0;for(slot=sequenceOld.first;!0&&(slotRefresh=slotRefreshFromSlot(slot),slotRefresh&&slotRefresh.sequenceNumber===sequenceNew.firstInner.sequenceNumber&&(slotRefresh.ordinal=ordinal),!slot.lastInSequence);slot=slot.next,ordinal++);var piles=[];for(slotRefresh=sequenceNew.firstInner;!0;slotRefresh=slotRefresh.next){if(ordinal=slotRefresh.ordinal,void 0!==ordinal){for(var searchFirst=0,searchLast=piles.length-1;searchLast>=searchFirst;){var searchMidpoint=Math.floor(.5*(searchFirst+searchLast));piles[searchMidpoint].ordinal<ordinal?searchFirst=searchMidpoint+1:searchLast=searchMidpoint-1}piles[searchFirst]=slotRefresh,searchFirst>0&&(slotRefresh.predecessor=piles[searchFirst-1])}if(slotRefresh===sequenceNew.lastInner)break}var stationaryItems=[],stationaryItemCount=piles.length;for(slotRefresh=piles[stationaryItemCount-1],j=stationaryItemCount;j--;)slotRefresh.stationary=!0,stationaryItems[j]=slotRefresh,slotRefresh=slotRefresh.predecessor;sequenceOld.stationarySlot=slotFromSlotRefresh(stationaryItems[0]),slotRefresh=stationaryItems[0],slot=slotFromSlotRefresh(slotRefresh),slotPrev=slot.prev;for(var sequenceBoundaryReached=slot.firstInSequence;!slotRefresh.firstInSequence;)if(slotRefresh=slotRefresh.prev,slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;!sequenceBoundaryReached&&slotPrev!==slotsStart&&(slot=slotPrev,slotPrev=slot.prev,sequenceBoundaryReached=slot.firstInSequence,!updateSlotForRefresh(slotExisting,slot,slotRefresh)););for(j=0;stationaryItemCount-1>j;j++){slotRefresh=stationaryItems[j],slot=slotFromSlotRefresh(slotRefresh);var slotExisting,slotRefreshStop=stationaryItems[j+1],slotRefreshMergePoint=null,slotStop=slotFromSlotRefresh(slotRefreshStop);for(slotNext=slot.next,slotRefresh=slotRefresh.next;slotRefresh!==slotRefreshStop&&!slotRefreshMergePoint&&slot!==slotStop;slotRefresh=slotRefresh.next)if(slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;slotNext!==slotStop;){if(slotNext.mergedForRefresh){slotRefreshMergePoint=slotRefresh.prev;break}if(slot=slotNext,slotNext=slot.next,updateSlotForRefresh(slotExisting,slot,slotRefresh))break}if(slotRefreshMergePoint)for(slotPrev=slotStop.prev,slotRefresh=slotRefreshStop.prev;slotRefresh!==slotRefreshMergePoint&&slotStop!==slot;slotRefresh=slotRefresh.prev)if(slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;slotPrev!==slot&&(slotStop=slotPrev,slotPrev=slotStop.prev,!updateSlotForRefresh(slotExisting,slotStop,slotRefresh)););for(;slotNext!==slotStop;)slot=slotNext,slotNext=slot.next,slot!==slotsStart&&isPlaceholder(slot)&&!slot.keyRequested&&deleteSlot(slot)}for(slotRefresh=stationaryItems[stationaryItemCount-1],slot=slotFromSlotRefresh(slotRefresh),slotNext=slot.next,sequenceBoundaryReached=slot.lastInSequence;!slotRefresh.lastInSequence;)if(slotRefresh=slotRefresh.next,slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;!sequenceBoundaryReached&&slotNext!==slotListEnd&&(slot=slotNext,slotNext=slot.next,sequenceBoundaryReached=slot.lastInSequence,!updateSlotForRefresh(slotExisting,slot,slotRefresh)););}for(i=0;sequenceCountNew>i;i++)if(sequenceNew=sequencesNew[i],sequenceNew.firstInner)for(slotPrev=null,slotRefresh=sequenceNew.firstInner;!0;slotRefresh=slotRefresh.next){if(slot=slotFromSlotRefresh(slotRefresh)){if(!slotRefresh.stationary){var slotMoveBefore,mergeWithPrev=!1,mergeWithNext=!1;if(slotPrev)slotMoveBefore=slotPrev.next,mergeWithPrev=!0;else{var slotRefreshStationary;for(slotRefreshStationary=sequenceNew.firstInner;!slotRefreshStationary.stationary&&slotRefreshStationary!==sequenceNew.lastInner;slotRefreshStationary=slotRefreshStationary.next);if(slotRefreshStationary.stationary)slotMoveBefore=slotFromSlotRefresh(slotRefreshStationary),mergeWithNext=!0;else if(index=slotRefresh.index,0===index)slotMoveBefore=slotsStart.next,mergeWithPrev=!0;else if(void 0===index)slotMoveBefore=slotsEnd;else{slotMoveBefore=slotsStart.next;for(var lastSequenceStart=null;;){if(slotMoveBefore.firstInSequence&&(lastSequenceStart=slotMoveBefore),index<slotMoveBefore.index&&lastSequenceStart||slotMoveBefore===slotListEnd)break;slotMoveBefore=slotMoveBefore.next}!slotMoveBefore.firstInSequence&&lastSequenceStart&&(slotMoveBefore=lastSequenceStart)}}slot.mergedForRefresh&&(delete slot.mergedForRefresh,slot.lastInSequence||(slot.next.mergedForRefresh=!0)),mergeWithPrev=mergeWithPrev||slotRefresh.mergeWithPrev,mergeWithNext=mergeWithNext||slotRefresh.mergeWithNext;var skipNotifications=slotRefresh.locationJustDetermined;moveSlot(slot,slotMoveBefore,mergeWithPrev,mergeWithNext,skipNotifications),skipNotifications&&mergeWithNext&&(slotMoveBefore.mergedForRefresh=!0)}slotPrev=slot}if(slotRefresh===sequenceNew.lastInner)break}for(i=0;sequenceCountNew>i;i++)if(sequenceNew=sequencesNew[i],sequenceNew.firstInner)for(slotPrev=null,slotRefresh=sequenceNew.firstInner;!0;slotRefresh=slotRefresh.next){if(slot=slotFromSlotRefresh(slotRefresh),!slot){var slotInsertBefore;if(slotPrev)slotInsertBefore=slotPrev.next;else{var slotRefreshOld;for(slotRefreshOld=sequenceNew.firstInner;!slotFromSlotRefresh(slotRefreshOld);slotRefreshOld=slotRefreshOld.next);slotInsertBefore=slotFromSlotRefresh(slotRefreshOld)}slot=addNewSlotFromRefresh(slotRefresh,slotInsertBefore,!!slotPrev);var slotRefreshNext=slotRefreshFromSlot(slotInsertBefore);slotInsertBefore.mergedForRefresh||slotRefreshNext&&slotRefreshNext.locationJustDetermined||(prepareSlotItem(slot),sendInsertedNotification(slot))}if(slotPrev=slot,slotRefresh===sequenceNew.lastInner)break}indexMap=[];var indexFirst=-1;for(slot=slotsStart,offset=0;slot!==slotsEnd;offset++){var slotNext=slot.next;if(slot.firstInSequence&&(slotFirstInSequence=slot,offset=0),void 0===indexFirst){var indexNew=indexForRefresh(slot);void 0!==indexNew&&(indexFirst=indexNew-offset)}if(void 0!==indexFirst&&!slot.lastInSequence){var indexNewNext=indexForRefresh(slot.next);if(void 0!==indexNewNext&&indexNewNext!==indexFirst+offset+1){splitSequence(slot);for(var first=!0,slotMove=slot.next,lastInSequence=!1;!lastInSequence&&slotMove!==slotListEnd;){var slotMoveNext=slotMove.next;lastInSequence=slotMove.lastInSequence,moveSlot(slotMove,slotMoveNext,!first,!1),first=!1,slotMove=slotMoveNext}}}if(slot.lastInSequence){index=indexFirst;for(var slotUpdate=slotFirstInSequence;slotUpdate!==slotNext;){var slotUpdateNext=slotUpdate.next;if(index>=refreshCount&&slotUpdate!==slotListEnd)deleteSlot(slotUpdate,!0);else{var slotWithIndex=indexMap[index];index!==slotUpdate.index?(delete indexMap[index],changeSlotIndex(slotUpdate,index)):+index===index&&indexMap[index]!==slotUpdate&&(indexMap[index]=slotUpdate),slotUpdate.itemNew&&updateSlotItem(slotUpdate),slotWithIndex&&(slotUpdate.key?(sendMirageNotifications(slotUpdate,slotWithIndex,slotUpdate.bindingMap),mergeSlots(slotUpdate,slotWithIndex),+index===index&&(indexMap[index]=slotUpdate)):(sendMirageNotifications(slotWithIndex,slotUpdate,slotWithIndex.bindingMap),mergeSlots(slotWithIndex,slotUpdate),+index===index&&(indexMap[index]=slotWithIndex))),+index===index&&index++}slotUpdate=slotUpdateNext}indexFirst=void 0}slot=slotNext}var listEndReached,indexMax=-2;for(slot=slotsStart,offset=0;slot!==slotsEnd;offset++){var slotNext=slot.next;if(slot.firstInSequence&&(slotFirstInSequence=slot,offset=0),delete slot.mergedForRefresh,slot.lastInSequence)if(void 0===slotFirstInSequence.index){slotBefore=slotFirstInSequence.prev;var slotRefreshBefore;slotBefore&&(slotRefreshBefore=slotRefreshFromSlot(slotBefore))&&!slotRefreshBefore.lastInSequence&&(slotRefresh=slotRefreshFromSlot(slot))&&slotRefresh.prev===slotRefreshBefore?(moveSequenceAfter(slotBefore,slotFirstInSequence,slot),mergeSequences(slotBefore)):slot===slotListEnd||listEndReached||moveSequenceBefore(slotsEnd,slotFirstInSequence,slot)}else{if(indexMax<slot.index&&!listEndReached)indexMax=slot.index;else{for(slotAfter=slotsStart.next;slotAfter.index<slot.index;slotAfter=slotAfter.next);for(var slotMove=slotFirstInSequence;slotMove!==slotNext;){var slotMoveNext=slotMove.next;slotRefresh=slotRefreshFromSlot(slotMove),moveSlot(slotMove,slotAfter,slotAfter.prev.index===slotMove.index-1,slotAfter.index===slotMove.index+1,slotRefresh&&slotRefresh.locationJustDetermined),slotMove=slotMoveNext}}slotBefore=slotFirstInSequence.prev,slotBefore&&slotBefore.index===slotFirstInSequence.index-1&&mergeSequences(slotBefore)}slot===slotListEnd&&(listEndReached=!0),slot=slotNext}indexUpdateDeferred=!1,mergeSequencePairs(sequencePairsToMerge),void 0!==refreshCount&&refreshCount!==knownCount&&changeCount(refreshCount),finishNotifications();var fetchResults=[];for(i=0;sequenceCountNew>i;i++){sequenceNew=sequencesNew[i];var results=[];slot=null,offset=0;var slotOffset;for(slotRefresh=sequenceNew.first;!0&&(slotRefresh===refreshStart?results.push(startMarker):slotRefresh===refreshEnd?results.push(endMarker):(results.push(slotRefresh.item),slot||(slot=slotFromSlotRefresh(slotRefresh),slotOffset=offset)),!slotRefresh.lastInSequence);slotRefresh=slotRefresh.next,offset++);slot&&fetchResults.push({slot:slot,results:results,offset:slotOffset})}for(resetRefreshState(),refreshInProgress=!1,callFetchCompleteCallbacks(),i=0;i<fetchResults.length;i++){var fetchResult=fetchResults[i];processResults(fetchResult.slot,fetchResult.results,fetchResult.offset,knownCount,fetchResult.slot.index)}if(refreshSignal){var signal=refreshSignal;refreshSignal=null,signal.complete()}postFetch()}function queueEdit(applyEdit,editType,complete,error,keyUpdate,updateSlots,undo){var editQueueTail=editQueue.prev,edit={prev:editQueueTail,next:editQueue,applyEdit:applyEdit,editType:editType,complete:complete,error:error,keyUpdate:keyUpdate};editQueueTail.next=edit,editQueue.prev=edit,editsQueued=!0,(refreshRequested||refreshInProgress)&&(currentRefreshID++,refreshInProgress=!1,refreshRequested=!0),editQueue.next===edit&&applyNextEdit(),edit.failed||(updateSlots(),edit.undo=undo),editsInProgress||completeEdits()}function dequeueEdit(){firstEditInProgress=!1;var editNext=editQueue.next.next;editQueue.next=editNext,editNext.prev=editQueue}function discardEditQueue(){for(;editQueue.prev!==editQueue;){var editLast=editQueue.prev;editLast.error&&editLast.error(new _ErrorFromName(EditError.canceled)),editLast.undo&&!refreshRequested&&editLast.undo(),editQueue.prev=editLast.prev}editQueue.next=editQueue,editsInProgress=!1,completeEdits()}function attemptEdit(edit){function continueEdits(){waitForRefresh||(reentrant?synchronousEdit=!0:applyNextEdit())}function onEditComplete(item){if(item){var slot;if(keyUpdate&&keyUpdate.key!==item.key){var keyNew=item.key;if(edit.undo){if(slot=keyUpdate.slot){var keyOld=slot.key;keyOld&&delete keyMap[keyOld],setSlotKey(slot,keyNew),slot.itemNew=item,slot.item?(changeSlot(slot),finishNotifications()):completeFetchPromises(slot)}}else keyUpdate.key=keyNew}else edit.editType===EditType.change&&(slot.itemNew=item,reentrant||changeSlotIfNecessary(slot))}dequeueEdit(),edit.complete&&edit.complete(item),continueEdits()}function onEditError(error){switch(error.Name){case EditError.noResponse:return setStatus(DataSourceStatus.failure),waitForRefresh=!0,void(firstEditInProgress=!1);case EditError.notPermitted:break;case EditError.noLongerMeaningful:beginRefresh()}edit.failed=!0,dequeueEdit(),discardEditQueue(),edit.error&&edit.error(error),continueEdits()}if(!firstEditInProgress){var reentrant=!0,keyUpdate=edit.keyUpdate;listDataAdapter.beginEdits&&!beginEditsCalled&&(beginEditsCalled=!0,listDataAdapter.beginEdits()),firstEditInProgress=!0,edit.applyEdit().then(onEditComplete,onEditError),reentrant=!1}}function applyNextEdit(){for(;editQueue.next!==editQueue;)if(synchronousEdit=!1,attemptEdit(editQueue.next),!synchronousEdit)return;concludeEdits()}function completeEdits(){updateIndices(),finishNotifications(),callFetchCompleteCallbacks(),editQueue.next===editQueue&&concludeEdits()}function concludeEdits(){editsQueued=!1,listDataAdapter.endEdits&&beginEditsCalled&&!editsInProgress&&(beginEditsCalled=!1,listDataAdapter.endEdits()),refreshRequested?(refreshRequested=!1,beginRefresh()):postFetch()}function getSlotForEdit(key){return validateKey(key),keyMap[key]||createSlotForKey(key)}function insertNewSlot(key,itemNew,slotInsertBefore,mergeWithPrev,mergeWithNext){var slot=createPrimarySlot();return insertAndMergeSlot(slot,slotInsertBefore,mergeWithPrev,mergeWithNext),key&&setSlotKey(slot,key),slot.itemNew=itemNew,updateNewIndices(slot,1),editsInProgress||dataNotificationsInProgress||(slot.firstInSequence||"number"!=typeof slot.prev.index?slot.lastInSequence||"number"!=typeof slot.next.index||setSlotIndex(slot,slot.next.index-1,indexMap):setSlotIndex(slot,slot.prev.index+1,indexMap)),prepareSlotItem(slot),sendInsertedNotification(slot),slot}function insertItem(key,data,slotInsertBefore,append,applyEdit){var keyUpdate={key:key};return new Promise(function(complete,error){queueEdit(applyEdit,EditType.insert,complete,error,keyUpdate,function(){if(slotInsertBefore){var itemNew={key:keyUpdate.key,data:data};keyUpdate.slot=insertNewSlot(keyUpdate.key,itemNew,slotInsertBefore,append,!append)}},function(){var slot=keyUpdate.slot;slot&&(updateNewIndices(slot,-1),deleteSlot(slot,!1))})})}function moveItem(slot,slotMoveBefore,append,applyEdit){return new Promise(function(complete,error){var mergeAdjacent,slotNext,firstInSequence,lastInSequence;queueEdit(applyEdit,EditType.move,complete,error,null,function(){slotNext=slot.next,firstInSequence=slot.firstInSequence,lastInSequence=slot.lastInSequence;var slotPrev=slot.prev;mergeAdjacent="number"!=typeof slot.index&&(firstInSequence||!slotPrev.item)&&(lastInSequence||!slotNext.item),updateNewIndices(slot,-1),moveSlot(slot,slotMoveBefore,append,!append),updateNewIndices(slot,1),mergeAdjacent&&(splitSequence(slotPrev),firstInSequence||mergeSlotsBefore(slotPrev,slot),lastInSequence||mergeSlotsAfter(slotNext,slot))},function(){mergeAdjacent?beginRefresh():(updateNewIndices(slot,-1),moveSlot(slot,slotNext,!firstInSequence,!lastInSequence),updateNewIndices(slot,1))})})}function ListDataNotificationHandler(){function completeNotification(){dataNotificationsInProgress||(updateIndices(),finishNotifications(),callFetchCompleteCallbacks())}this.invalidateAll=function(){return 0===knownCount?(this.reload(),Promise.wrap()):requestRefresh()},this.reload=function(){getCountPromise&&getCountPromise.cancel(),refreshSignal&&refreshSignal.cancel();for(var slot=slotsStart.next;slot!==slotsEnd;slot=slot.next){var fetchListeners=slot.fetchListeners;for(var listenerID in fetchListeners)fetchListeners[listenerID].promise.cancel();var directFetchListeners=slot.directFetchListeners;for(var listenerID in directFetchListeners)directFetchListeners[listenerID].promise.cancel()}resetState(),forEachBindingRecord(function(bindingRecord){bindingRecord.notificationHandler&&bindingRecord.notificationHandler.reload()})},this.beginNotifications=function(){dataNotificationsInProgress=!0},this.inserted=function(newItem,previousKey,nextKey,index){if(editsQueued)beginRefresh();else{var key=newItem.key,slotPrev=keyMap[previousKey],slotNext=keyMap[nextKey],havePreviousKey="string"==typeof previousKey,haveNextKey="string"==typeof nextKey;if(havePreviousKey?slotNext&&!slotNext.firstInSequence&&(slotPrev=slotNext.prev):haveNextKey&&slotPrev&&!slotPrev.lastInSequence&&(slotNext=slotPrev.next),(havePreviousKey||haveNextKey)&&!slotPrev&&!slotNext&&slotsStart.next===slotListEnd)return void beginRefresh();if(keyMap[key])return void beginRefresh();if(slotPrev&&slotNext&&(slotPrev.next!==slotNext||slotPrev.lastInSequence||slotNext.firstInSequence))return void beginRefresh();if(slotPrev&&(slotPrev.keyRequested||slotPrev.indexRequested)||slotNext&&(slotNext.keyRequested||slotNext.indexRequested))return void beginRefresh();if(slotPrev||slotNext)insertNewSlot(key,newItem,slotNext?slotNext:slotPrev.next,!!slotPrev,!!slotNext);else if(slotsStart.next===slotListEnd)insertNewSlot(key,newItem,slotsStart.next,!0,!0);else{if(void 0===index)return void beginRefresh();updateNewIndicesFromIndex(index,1)}completeNotification()}},this.changed=function(item){if(editsQueued)beginRefresh();else{var key=item.key,slot=keyMap[key];slot&&(slot.keyRequested?beginRefresh():(slot.itemNew=item,slot.item&&(changeSlot(slot),completeNotification())))}},this.moved=function(item,previousKey,nextKey,oldIndex,newIndex){if(editsQueued)beginRefresh();else{var key=item.key,slot=keyMap[key],slotPrev=keyMap[previousKey],slotNext=keyMap[nextKey];slot&&slot.keyRequested||slotPrev&&slotPrev.keyRequested||slotNext&&slotNext.keyRequested?beginRefresh():slot?slotPrev&&slotNext&&(slotPrev.next!==slotNext||slotPrev.lastInSequence||slotNext.firstInSequence)?beginRefresh():slotPrev||slotNext?(updateNewIndices(slot,-1),moveSlot(slot,slotNext?slotNext:slotPrev.next,!!slotPrev,!!slotNext),updateNewIndices(slot,1),completeNotification()):(updateNewIndices(slot,-1),deleteSlot(slot,!1),void 0!==oldIndex&&(newIndex>oldIndex&&newIndex--,updateNewIndicesFromIndex(newIndex,1)),completeNotification()):slotPrev||slotNext?(void 0!==oldIndex&&(updateNewIndicesFromIndex(oldIndex,-1),newIndex>oldIndex&&newIndex--),this.inserted(item,previousKey,nextKey,newIndex)):void 0!==oldIndex&&(updateNewIndicesFromIndex(oldIndex,-1),newIndex>oldIndex&&newIndex--,updateNewIndicesFromIndex(newIndex,1),completeNotification())}},this.removed=function(key,index){if(editsQueued)beginRefresh();else{var slot;slot="string"==typeof key?keyMap[key]:indexMap[index],slot?slot.keyRequested?beginRefresh():(updateNewIndices(slot,-1),deleteSlot(slot,!1),completeNotification()):void 0!==index&&(updateNewIndicesFromIndex(index,-1),completeNotification())}},this.endNotifications=function(){dataNotificationsInProgress=!1,completeNotification()}}function resetState(){setStatus(DataSourceStatus.ready),getCountPromise=null,beginEditsCalled=!1,editsInProgress=!1,firstEditInProgress=!1,editQueue={},editQueue.next=editQueue,editQueue.prev=editQueue,editsQueued=!1,waitForRefresh=!1,countDelta=0,indexUpdateDeferred=!1,nextTempKey=0,fetchesInProgress={},fetchCompleteCallbacks=[],knownCount=CountResult.unknown,slotsStart={firstInSequence:!0,lastInSequence:!0,index:-1},slotListEnd={firstInSequence:!0,lastInSequence:!0},slotsEnd={firstInSequence:!0,lastInSequence:!0},slotsStart.next=slotListEnd,slotListEnd.prev=slotsStart,slotListEnd.next=slotsEnd,slotsEnd.prev=slotListEnd,handleMap={},keyMap={},indexMap={},indexMap[-1]=slotsStart,releasedSlots=0,lastSlotReleased=null,reduceReleasedSlotCountPosted=!1,refreshRequested=!1,refreshInProgress=!1,refreshSignal=null}var listDataNotificationHandler,cacheSize,status,statusPending,statusChangePosted,bindingMap,nextListBindingID,nextHandle,nextListenerID,getCountPromise,resultsProcessed,beginEditsCalled,editsInProgress,firstEditInProgress,editQueue,editsQueued,synchronousEdit,waitForRefresh,dataNotificationsInProgress,countDelta,indexUpdateDeferred,nextTempKey,currentRefreshID,fetchesPosted,nextFetchID,fetchesInProgress,fetchCompleteCallbacks,startMarker,endMarker,knownCount,slotsStart,slotListEnd,slotsEnd,handleMap,keyMap,indexMap,releasedSlots,lastSlotReleased,reduceReleasedSlotCountPosted,refreshRequested,refreshInProgress,refreshSignal,refreshFetchesInProgress,refreshItemsFetched,refreshCount,refreshStart,refreshEnd,keyFetchIDs,refreshKeyMap,refreshIndexMap,deletedKeys,synchronousProgress,reentrantContinue,synchronousRefresh,reentrantRefresh,itemsFromKey,itemsFromIndex,itemsFromStart,itemsFromEnd,itemsFromDescription,beginRefreshCount=0,refreshHistory=new Array(100),refreshHistoryPos=-1;listDataAdapter.itemsFromKey&&(itemsFromKey=function(fetchID,key,countBefore,countAfter,hints){var perfID="fetchItemsFromKey id="+fetchID+" key="+key+" countBefore="+countBefore+" countAfter="+countAfter;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromKey",key:key,countBefore:countBefore,countAfter:countAfter};var result=listDataAdapter.itemsFromKey(key,countBefore,countAfter,hints);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromIndex&&(itemsFromIndex=function(fetchID,index,countBefore,countAfter){var perfID="fetchItemsFromIndex id="+fetchID+" index="+index+" countBefore="+countBefore+" countAfter="+countAfter;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromIndex",index:index,countBefore:countBefore,countAfter:countAfter};var result=listDataAdapter.itemsFromIndex(index,countBefore,countAfter);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromStart&&(itemsFromStart=function(fetchID,count){var perfID="fetchItemsFromStart id="+fetchID+" count="+count;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromStart",count:count};var result=listDataAdapter.itemsFromStart(count);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromEnd&&(itemsFromEnd=function(fetchID,count){var perfID="fetchItemsFromEnd id="+fetchID+" count="+count;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromEnd",count:count};var result=listDataAdapter.itemsFromEnd(count);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromDescription&&(itemsFromDescription=function(fetchID,description,countBefore,countAfter){var perfID="fetchItemsFromDescription id="+fetchID+" desc="+description+" countBefore="+countBefore+" countAfter="+countAfter;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromDescription",description:description,countBefore:countBefore,countAfter:countAfter};var result=listDataAdapter.itemsFromDescription(description,countBefore,countAfter);return profilerMarkEnd(perfID),result});var dataSourceID=++uniqueID,that=this,EditType={insert:"insert",change:"change",move:"move",remove:"remove"};if(!listDataAdapter)throw new _ErrorFromName("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",strings.listDataAdapterIsInvalid);cacheSize=listDataAdapter.compareByIdentity?0:200,options&&"number"==typeof options.cacheSize&&(cacheSize=options.cacheSize),listDataAdapter.setNotificationHandler&&(listDataNotificationHandler=new ListDataNotificationHandler,listDataAdapter.setNotificationHandler(listDataNotificationHandler)),status=DataSourceStatus.ready,statusChangePosted=!1,bindingMap={},nextListBindingID=0,nextHandle=1,nextListenerID=0,currentRefreshID=0,fetchesPosted=!1,nextFetchID=1,startMarker={},endMarker={},resetState(),this.createListBinding=function(notificationHandler){function retainSlotForCursor(slot){slot&&slot.cursorCount++}function releaseSlotForCursor(slot){slot&&0===--slot.cursorCount&&releaseSlotIfUnrequested(slot)}function moveCursor(slot){retainSlotForCursor(slot),releaseSlotForCursor(slotCurrent),slotCurrent=slot}function adjustCurrentSlot(slot,slotNew){slot===slotCurrent&&(slotNew||(slotNew=!slotCurrent||slotCurrent.lastInSequence||slotCurrent.next===slotListEnd?null:slotCurrent.next),moveCursor(slotNew))}function releaseSlotFromListBinding(slot){var bindingMap=slot.bindingMap,bindingHandle=bindingMap[listBindingID].handle;delete slot.bindingMap[listBindingID];var releaseBindingMap=!0,releaseHandle=!0;for(var listBindingID2 in bindingMap)if(releaseBindingMap=!1,bindingHandle&&bindingMap[listBindingID2].handle===bindingHandle){releaseHandle=!1;break}bindingHandle&&releaseHandle&&delete handleMap[bindingHandle],releaseBindingMap&&(slot.bindingMap=null,releaseSlotIfUnrequested(slot))}function retainItem(slot,listenerID){slot.bindingMap||(slot.bindingMap={});var slotBinding=slot.bindingMap[listBindingID];if(slotBinding?slotBinding.count++:slot.bindingMap[listBindingID]={bindingRecord:bindingMap[listBindingID],count:1},slot.fetchListeners){var listener=slot.fetchListeners[listenerID];listener&&(listener.retained=!0)}}function releaseItem(handle){var slot=handleMap[handle];if(slot){var slotBinding=slot.bindingMap[listBindingID];if(0===--slotBinding.count){var fetchListeners=slot.fetchListeners;for(var listenerID in fetchListeners){var listener=fetchListeners[listenerID];listener.listBindingID===listBindingID&&(listener.retained=!1)}releaseSlotFromListBinding(slot)}}}function itemPromiseFromKnownSlot(slot){var handle=handleForBinding(slot,listBindingID),listenerID=(nextListenerID++).toString(),itemPromise=createFetchPromise(slot,"fetchListeners",listenerID,listBindingID,function(complete,item){complete(itemForBinding(item,handle))});return defineCommonItemProperties(itemPromise,slot,handle),notificationHandler&&(itemPromise.retain=function(){return listBinding._retainItem(slot,listenerID),itemPromise},itemPromise.release=function(){listBinding._releaseItem(handle)}),itemPromise}function itemPromiseFromSlot(slot){var itemPromise;return!released&&slot?itemPromise=itemPromiseFromKnownSlot(slot):(released?(itemPromise=new Promise(function(){}),itemPromise.cancel()):itemPromise=Promise.wrap(null),defineHandleProperty(itemPromise,null),notificationHandler&&(itemPromise.retain=function(){return itemPromise},itemPromise.release=function(){})),moveCursor(slot),itemPromise}var listBindingID=(nextListBindingID++).toString(),slotCurrent=null,released=!1;bindingMap[listBindingID]={notificationHandler:notificationHandler,notificationsSent:!1,adjustCurrentSlot:adjustCurrentSlot,itemPromiseFromKnownSlot:itemPromiseFromKnownSlot};var listBinding={_retainItem:function(slot,listenerID){retainItem(slot,listenerID)},_releaseItem:function(handle){releaseItem(handle)},jumpToItem:function(item){return itemPromiseFromSlot(item?handleMap[item.handle]:null)},current:function(){return itemPromiseFromSlot(slotCurrent)},previous:function(){return itemPromiseFromSlot(slotCurrent?requestSlotBefore(slotCurrent):null)},next:function(){return itemPromiseFromSlot(slotCurrent?requestSlotAfter(slotCurrent):null)},releaseItem:function(item){this._releaseItem(item.handle)},release:function(){released=!0,releaseSlotForCursor(slotCurrent),slotCurrent=null;for(var slot=slotsStart.next;slot!==slotsEnd;){var slotNext=slot.next,fetchListeners=slot.fetchListeners;for(var listenerID in fetchListeners){var listener=fetchListeners[listenerID];listener.listBindingID===listBindingID&&(listener.promise.cancel(),delete fetchListeners[listenerID])}slot.bindingMap&&slot.bindingMap[listBindingID]&&releaseSlotFromListBinding(slot),slot=slotNext}delete bindingMap[listBindingID]}};return(itemsFromStart||itemsFromIndex)&&(listBinding.first=function(){return itemPromiseFromSlot(requestSlotAfter(slotsStart))}),itemsFromEnd&&(listBinding.last=function(){return itemPromiseFromSlot(requestSlotBefore(slotListEnd))}),itemsFromKey&&(listBinding.fromKey=function(key,hints){return itemPromiseFromSlot(slotFromKey(key,hints))}),(itemsFromIndex||itemsFromStart&&itemsFromKey)&&(listBinding.fromIndex=function(index){return itemPromiseFromSlot(slotFromIndex(index))}),itemsFromDescription&&(listBinding.fromDescription=function(description){return itemPromiseFromSlot(slotFromDescription(description))}),listBinding},this.invalidateAll=function(){return requestRefresh()};var countedCancelation=function(incomingPromise,dataSource){var signal=new _Signal;incomingPromise.then(function(v){signal.complete(v)},function(e){signal.error(e)});var resultPromise=signal.promise.then(null,function(e){return"WinJS.UI.VirtualizedDataSource.resetCount"===e.name?(getCountPromise=null,incomingPromise=dataSource.getCount()):Promise.wrapError(e)}),count=0,currentGetCountPromise={get:function(){return count++,new Promise(function(c,e){resultPromise.then(c,e)},function(){0===--count&&(signal.promise.cancel(),incomingPromise.cancel(),currentGetCountPromise===getCountPromise&&(getCountPromise=null))})},reset:function(){signal.error(new _ErrorFromName("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){signal.promise.cancel(),incomingPromise.cancel(),currentGetCountPromise===getCountPromise&&(getCountPromise=null)}};return currentGetCountPromise};this.getCount=function(){if(listDataAdapter.getCount){var that=this;return Promise.wrap().then(function(){if(editsInProgress||editsQueued)return knownCount;var requestPromise;if(!getCountPromise){var relatedGetCountPromise;requestPromise=listDataAdapter.getCount();var synchronous;requestPromise.then(function(){getCountPromise===relatedGetCountPromise&&(getCountPromise=null),synchronous=!0},function(){getCountPromise===relatedGetCountPromise&&(getCountPromise=null),synchronous=!0}),countDelta=0,synchronous||(relatedGetCountPromise=getCountPromise=countedCancelation(requestPromise,that))}return getCountPromise?getCountPromise.get():requestPromise}).then(function(count){if(!isNonNegativeInteger(count)&&void 0!==count)throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",strings.invalidRequestedCountReturned);return count!==knownCount&&(knownCount===CountResult.unknown?knownCount=count:(changeCount(count),finishNotifications())),0===count&&(slotsStart.next!==slotListEnd||slotListEnd.next!==slotsEnd?beginRefresh():slotsStart.lastInSequence&&(mergeSequences(slotsStart),slotListEnd.index=0)),count}).then(null,function(error){return error.name===_UI.CountError.noResponse?(setStatus(DataSourceStatus.failure),knownCount):Promise.wrapError(error)})}return Promise.wrap(knownCount)},itemsFromKey&&(this.itemFromKey=function(key,hints){return itemDirectlyFromSlot(slotFromKey(key,hints))}),(itemsFromIndex||itemsFromStart&&itemsFromKey)&&(this.itemFromIndex=function(index){return itemDirectlyFromSlot(slotFromIndex(index))}),itemsFromDescription&&(this.itemFromDescription=function(description){return itemDirectlyFromSlot(slotFromDescription(description))}),this.beginEdits=function(){editsInProgress=!0},listDataAdapter.insertAtStart&&(this.insertAtStart=function(key,data){return insertItem(key,data,slotsStart.lastInSequence?null:slotsStart.next,!0,function(){return listDataAdapter.insertAtStart(key,data)})}),listDataAdapter.insertBefore&&(this.insertBefore=function(key,data,nextKey){var slotNext=getSlotForEdit(nextKey);return insertItem(key,data,slotNext,!1,function(){return listDataAdapter.insertBefore(key,data,nextKey,adjustedIndex(slotNext))})}),listDataAdapter.insertAfter&&(this.insertAfter=function(key,data,previousKey){var slotPrev=getSlotForEdit(previousKey);return insertItem(key,data,slotPrev?slotPrev.next:null,!0,function(){return listDataAdapter.insertAfter(key,data,previousKey,adjustedIndex(slotPrev))})}),listDataAdapter.insertAtEnd&&(this.insertAtEnd=function(key,data){return insertItem(key,data,slotListEnd.firstInSequence?null:slotListEnd,!1,function(){return listDataAdapter.insertAtEnd(key,data)})}),listDataAdapter.change&&(this.change=function(key,newData){var slot=getSlotForEdit(key);return new Promise(function(complete,error){var itemOld;queueEdit(function(){return listDataAdapter.change(key,newData,adjustedIndex(slot))},EditType.change,complete,error,null,function(){itemOld=slot.item,slot.itemNew={key:key,data:newData},itemOld?changeSlot(slot):completeFetchPromises(slot)},function(){itemOld?(slot.itemNew=itemOld,changeSlot(slot)):beginRefresh()})})}),listDataAdapter.moveToStart&&(this.moveToStart=function(key){var slot=getSlotForEdit(key);return moveItem(slot,slotsStart.next,!0,function(){return listDataAdapter.moveToStart(key,adjustedIndex(slot))})}),listDataAdapter.moveBefore&&(this.moveBefore=function(key,nextKey){var slot=getSlotForEdit(key),slotNext=getSlotForEdit(nextKey);return moveItem(slot,slotNext,!1,function(){return listDataAdapter.moveBefore(key,nextKey,adjustedIndex(slot),adjustedIndex(slotNext))})}),listDataAdapter.moveAfter&&(this.moveAfter=function(key,previousKey){
var slot=getSlotForEdit(key),slotPrev=getSlotForEdit(previousKey);return moveItem(slot,slotPrev.next,!0,function(){return listDataAdapter.moveAfter(key,previousKey,adjustedIndex(slot),adjustedIndex(slotPrev))})}),listDataAdapter.moveToEnd&&(this.moveToEnd=function(key){var slot=getSlotForEdit(key);return moveItem(slot,slotListEnd,!1,function(){return listDataAdapter.moveToEnd(key,adjustedIndex(slot))})}),listDataAdapter.remove&&(this.remove=function(key){validateKey(key);var slot=keyMap[key];return new Promise(function(complete,error){var slotNext,firstInSequence,lastInSequence;queueEdit(function(){return listDataAdapter.remove(key,adjustedIndex(slot))},EditType.remove,complete,error,null,function(){slot&&(slotNext=slot.next,firstInSequence=slot.firstInSequence,lastInSequence=slot.lastInSequence,updateNewIndices(slot,-1),deleteSlot(slot,!1))},function(){slot&&(reinsertSlot(slot,slotNext,!firstInSequence,!lastInSequence),updateNewIndices(slot,1),sendInsertedNotification(slot))})})}),this.endEdits=function(){editsInProgress=!1,completeEdits()}}var MAX_BEGINREFRESH_COUNT=100,uniqueID=1,DataSourceStatus=_UI.DataSourceStatus,CountResult=_UI.CountResult,FetchError=_UI.FetchError,EditError=_UI.EditError,strings={get listDataAdapterIsInvalid(){return"Invalid argument: listDataAdapter must be an object or an array."},get indexIsInvalid(){return"Invalid argument: index must be a non-negative integer."},get keyIsInvalid(){return"Invalid argument: key must be a string."},get invalidItemReturned(){return"Error: data adapter returned item that is not an object."},get invalidKeyReturned(){return"Error: data adapter returned item with undefined or null key."},get invalidIndexReturned(){return"Error: data adapter should return undefined, null or a non-negative integer for the index."},get invalidCountReturned(){return"Error: data adapter should return undefined, null, CountResult.unknown, or a non-negative integer for the count."},get invalidRequestedCountReturned(){return"Error: data adapter should return CountResult.unknown, CountResult.failure, or a non-negative integer for the count."},get refreshCycleIdentified(){return"refresh cycle found, likely data inconsistency"}},statusChangedEvent="statuschanged",VDS=_Base.Class.define(function(){},{_baseDataSourceConstructor:_baseDataSourceConstructor,_isVirtualizedDataSource:!0},{supportedForProcessing:!1});return _Base.Class.mix(VDS,_Events.eventMixin),VDS})})}),define("WinJS/VirtualizedDataSource/_GroupDataSource",["exports","../Core/_Base","../Core/_ErrorFromName","../Promise","../Scheduler","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(exports,_Base,_ErrorFromName,Promise,Scheduler,_UI,VirtualizedDataSource){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_GroupDataSource:_Base.Namespace._lazy(function(){function errorDoesNotExist(){return new _ErrorFromName(_UI.FetchError.doesNotExist)}function groupReady(group){return group&&group.firstReached&&group.lastReached}var batchSizeDefault=101,ListNotificationHandler=_Base.Class.define(function(groupDataAdapter){this._groupDataAdapter=groupDataAdapter},{beginNotifications:function(){},inserted:function(itemPromise,previousHandle,nextHandle){this._groupDataAdapter._inserted(itemPromise,previousHandle,nextHandle)},changed:function(newItem,oldItem){this._groupDataAdapter._changed(newItem,oldItem)},moved:function(itemPromise,previousHandle,nextHandle){this._groupDataAdapter._moved(itemPromise,previousHandle,nextHandle)},removed:function(handle,mirage){this._groupDataAdapter._removed(handle,mirage)},countChanged:function(newCount,oldCount){0===newCount&&0!==oldCount&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(handle,newIndex,oldIndex){this._groupDataAdapter._indexChanged(handle,newIndex,oldIndex)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),GroupDataAdapter=_Base.Class.define(function(listDataSource,groupKey,groupData,options){this._listBinding=listDataSource.createListBinding(new ListNotificationHandler(this)),this._groupKey=groupKey,this._groupData=groupData,this._initializeState(),this._batchSize=batchSizeDefault,this._count=null,options&&("number"==typeof options.groupCountEstimate&&(this._count=options.groupCountEstimate<0?null:Math.max(options.groupCountEstimate,1)),"number"==typeof options.batchSize&&(this._batchSize=options.batchSize+1)),this._listBinding.last&&(this.itemsFromEnd=function(count){var that=this;return this._fetchItems(function(){return that._lastGroup},function(failed){if(failed)return!1;var count=that._count;return+count!==count?!0:count>0?!0:void 0},function(){that._fetchBatch(that._listBinding.last(),that._batchSize-1,0)},count-1,0)})},{setNotificationHandler:function(notificationHandler){this._listDataNotificationHandler=notificationHandler},compareByIdentity:!0,itemsFromKey:function(key,countBefore,countAfter,hints){var that=this;return this._fetchItems(function(){return that._keyMap[key]},function(){var lastGroup=that._lastGroup;return lastGroup?+lastGroup.index!==lastGroup.index?!0:void 0:!0},function(){hints=hints||{};var itemPromise="string"==typeof hints.groupMemberKey&&that._listBinding.fromKey?that._listBinding.fromKey(hints.groupMemberKey):"number"==typeof hints.groupMemberIndex&&that._listBinding.fromIndex?that._listBinding.fromIndex(hints.groupMemberIndex):void 0!==hints.groupMemberDescription&&that._listBinding.fromDescription?that._listBinding.fromDescription(hints.groupMemberDescription):that._listBinding.first(),fetchBefore=Math.floor(.5*(that._batchSize-1));that._fetchBatch(itemPromise,fetchBefore,that._batchSize-1-fetchBefore)},countBefore,countAfter)},itemsFromIndex:function(index,countBefore,countAfter){var that=this;return this._fetchItems(function(){return that._indexMap[index]},function(){var lastGroup=that._lastGroup;return lastGroup?+lastGroup.index!==lastGroup.index?!0:index<=lastGroup.index?!0:void 0:!0},function(){that._fetchNextIndex()},countBefore,countAfter)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return Promise.wrap(this._count);var that=this,countPromise=new Promise(function(complete){var fetch={initialBatch:function(){that._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(failed){failed&&(that._count=0);var count=that._count;return"number"==typeof count?(complete(count),!0):!1}};that._fetchQueue.push(fetch),that._itemBatch||that._continueFetch(fetch)});return"number"==typeof this._count?Promise.wrap(this._count):countPromise},invalidateGroups:function(){this._beginRefresh(),this._initializeState()},_initializeState:function(){this._count=null,this._indexMax=null,this._keyMap={},this._indexMap={},this._lastGroup=null,this._handleMap={},this._fetchQueue=[],this._itemBatch=null,this._itemsToFetch=0,this._indicesChanged=!1},_releaseItem:function(item){delete this._handleMap[item.handle],this._listBinding.releaseItem(item)},_processBatch:function(){for(var previousItem=null,previousGroup=null,firstItemInGroup=null,itemsSinceStart=0,failed=!0,i=0;i<this._batchSize;i++){var item=this._itemBatch[i],groupKey=item?this._groupKey(item):null;if(item&&(failed=!1),previousGroup&&null!==groupKey&&groupKey===previousGroup.key)itemsSinceStart++,previousGroup.lastItem===previousItem?(previousGroup.lastItem.handle!==previousGroup.firstItem.handle&&this._releaseItem(previousGroup.lastItem),previousGroup.lastItem=item,this._handleMap[item.handle]=previousGroup,previousGroup.size++):previousGroup.firstItem===item&&(previousGroup.firstItem.handle!==previousGroup.lastItem.handle&&this._releaseItem(previousGroup.firstItem),previousGroup.firstItem=firstItemInGroup,this._handleMap[firstItemInGroup.handle]=previousGroup,previousGroup.size+=itemsSinceStart);else{var index=null;if(previousGroup&&(previousGroup.lastReached=!0,"number"==typeof previousGroup.index&&(index=previousGroup.index+1)),item){var group=this._keyMap[groupKey];if(group||(group={key:groupKey,data:this._groupData(item),firstItem:item,lastItem:item,size:1},this._keyMap[group.key]=group,this._handleMap[item.handle]=group),i>0&&(group.firstReached=!0,previousGroup||(index=0)),"number"!=typeof group.index&&"number"==typeof index){for(var group2=group;group2;group2=this._nextGroup(group2))group2.index=index,this._indexMap[index]=group2,index++;this._indexMax=index,"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}firstItemInGroup=item,itemsSinceStart=0,previousGroup=group}else previousGroup&&(this._lastGroup=previousGroup,"number"==typeof previousGroup.index&&(this._count=previousGroup.index+1),this._listDataNotificationHandler.invalidateAll(),previousGroup=null)}previousItem=item}var fetch;for(fetch=this._fetchQueue[0];fetch&&fetch.complete(failed);fetch=this._fetchQueue[0])this._fetchQueue.splice(0,1);if(fetch){var that=this;Scheduler.schedule(function(){that._continueFetch(fetch)},Scheduler.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")}else this._itemBatch=null},_processPromise:function(itemPromise,batchIndex){itemPromise.retain(),this._itemBatch[batchIndex]=itemPromise;var that=this;itemPromise.then(function(item){that._itemBatch[batchIndex]=item,0===--that._itemsToFetch&&that._processBatch()})},_fetchBatch:function(itemPromise,countBefore){this._itemBatch=new Array(this._batchSize),this._itemsToFetch=this._batchSize,this._processPromise(itemPromise,countBefore);var batchIndex;for(this._listBinding.jumpToItem(itemPromise),batchIndex=countBefore-1;batchIndex>=0;batchIndex--)this._processPromise(this._listBinding.previous(),batchIndex);for(this._listBinding.jumpToItem(itemPromise),batchIndex=countBefore+1;batchIndex<this._batchSize;batchIndex++)this._processPromise(this._listBinding.next(),batchIndex)},_fetchAdjacent:function(item,after){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(item.key):this._listBinding.fromIndex(item.index),after?0:this._batchSize-1,after?this._batchSize-1:0)},_fetchNextIndex:function(){var groupHighestIndex=this._indexMap[this._indexMax-1];groupHighestIndex?this._fetchAdjacent(groupHighestIndex.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(fetch){if(fetch.initialBatch)fetch.initialBatch(),fetch.initialBatch=null;else{var group=fetch.getGroup();if(group){var groupPrev,groupNext;group.firstReached?group.lastReached?fetch.countBefore>0&&0!==group.index&&!groupReady(groupPrev=this._previousGroup(group))?this._fetchAdjacent(groupPrev&&groupPrev.lastReached?groupPrev.firstItem:group.firstItem,!1):(groupNext=this._nextGroup(group),this._fetchAdjacent(groupNext&&groupNext.firstReached?groupNext.lastItem:group.lastItem,!0)):this._fetchAdjacent(group.lastItem,!0):this._fetchAdjacent(group.firstItem,!1)}else this._fetchNextIndex()}},_fetchComplete:function(group,countBefore,countAfter,firstRequest,complete){if(groupReady(group)){var groupPrev=this._previousGroup(group);if(firstRequest||groupReady(groupPrev)||0===group.index||0===countBefore){var groupNext=this._nextGroup(group);if(firstRequest||groupReady(groupNext)||this._lastGroup===group||0===countAfter){for(var countAvailableBefore=0,groupFirst=group;countBefore>countAvailableBefore&&(groupPrev=this._previousGroup(groupFirst),groupReady(groupPrev));)groupFirst=groupPrev,countAvailableBefore++;for(var countAvailableAfter=0,groupLast=group;countAfter>countAvailableAfter&&(groupNext=this._nextGroup(groupLast),groupReady(groupNext));)groupLast=groupNext,countAvailableAfter++;for(var len=countAvailableBefore+1+countAvailableAfter,items=new Array(len),i=0;len>i;i++){var item={key:groupFirst.key,data:groupFirst.data,firstItemKey:groupFirst.firstItem.key,groupSize:groupFirst.size},firstItemIndex=groupFirst.firstItem.index;"number"==typeof firstItemIndex&&(item.firstItemIndexHint=firstItemIndex),items[i]=item,groupFirst=this._nextGroup(groupFirst)}var result={items:items,offset:countAvailableBefore};return result.totalCount="number"==typeof this._count?this._count:_UI.CountResult.unknown,"number"==typeof group.index&&(result.absoluteIndex=group.index),groupLast===this._lastGroup&&(result.atEnd=!0),complete(result),!0}}}return!1},_fetchItems:function(getGroup,mayExist,fetchInitialBatch,countBefore,countAfter){var that=this;return new Promise(function(complete,error){function fetchComplete(failed){var group2=getGroup();return group2?that._fetchComplete(group2,countBefore,countAfter,firstRequest,complete,error):firstRequest&&!mayExist(failed)?(error(errorDoesNotExist()),!0):failureCount>2?(error(errorDoesNotExist()),!0):(failed?failureCount++:failureCount=0,!1)}var group=getGroup(),firstRequest=!group,failureCount=0;if(!fetchComplete()){var fetch={initialBatch:firstRequest?fetchInitialBatch:null,getGroup:getGroup,countBefore:countBefore,countAfter:countAfter,complete:fetchComplete};that._fetchQueue.push(fetch),that._itemBatch||that._continueFetch(fetch)}})},_previousGroup:function(group){return group&&group.firstReached?(this._listBinding.jumpToItem(group.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(group){return group&&group.lastReached?(this._listBinding.jumpToItem(group.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(group){this._count=null,this._lastGroup=null,"number"==typeof group.index&&(this._indexMax=group.index>0?group.index:null);for(var group2=group;group2&&"number"==typeof group2.index;group2=this._nextGroup(group2))delete this._indexMap[group2.index],group2.index=null},_releaseGroup:function(group){this._invalidateIndices(group),delete this._keyMap[group.key],this._lastGroup===group&&(this._lastGroup=null),group.firstItem!==group.lastItem&&this._releaseItem(group.firstItem),this._releaseItem(group.lastItem)},_beginRefresh:function(){if(this._fetchQueue=[],this._itemBatch){for(var i=0;i<this._batchSize;i++){var item=this._itemBatch[i];item&&(item.cancel&&item.cancel(),this._listBinding.releaseItem(item))}this._itemBatch=null}this._itemsToFetch=0,this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(item,previousHandle,nextHandle){var groupPrev=this._handleMap[previousHandle],groupNext=this._handleMap[nextHandle],groupKey=null;groupPrev&&(groupPrev.lastReached&&previousHandle===groupPrev.lastItem.handle&&(groupKey=this._groupKey(item))!==groupPrev.key?this._lastGroup===groupPrev&&(this._lastGroup=null,this._count=null):this._releaseGroup(groupPrev),this._beginRefresh()),groupNext&&groupNext!==groupPrev&&(this._invalidateIndices(groupNext),groupNext.firstReached&&nextHandle===groupNext.firstItem.handle&&(null!==groupKey?groupKey:this._groupKey(item))!==groupNext.key||this._releaseGroup(groupNext),this._beginRefresh())},_processRemoval:function(handle){var group=this._handleMap[handle];if(!group||handle!==group.firstItem.handle&&handle!==group.lastItem.handle){if(this._itemBatch)for(var i=0;i<this._batchSize;i++){var item=this._itemBatch[i];if(item&&item.handle===handle){this._beginRefresh();break}}}else this._releaseGroup(group),this._beginRefresh()},_inserted:function(itemPromise,previousHandle,nextHandle){var that=this;itemPromise.then(function(item){that._processInsertion(item,previousHandle,nextHandle)})},_changed:function(newItem,oldItem){var group=this._handleMap[newItem.handle];if(group&&newItem.handle===group.firstItem.handle&&(this._releaseGroup(group),this._beginRefresh()),this._groupKey(newItem)!==this._groupKey(oldItem)){this._listBinding.jumpToItem(newItem);var previousHandle=this._listBinding.previous().handle;this._listBinding.jumpToItem(newItem);var nextHandle=this._listBinding.next().handle;this._processRemoval(newItem.handle),this._processInsertion(newItem,previousHandle,nextHandle)}},_moved:function(itemPromise,previousHandle,nextHandle){this._processRemoval(itemPromise.handle);var that=this;itemPromise.then(function(item){that._processInsertion(item,previousHandle,nextHandle)})},_removed:function(handle,mirage){mirage||this._processRemoval(handle)},_indexChanged:function(handle,newIndex,oldIndex){"number"==typeof oldIndex&&(this._indicesChanged=!0)},_endNotifications:function(){if(this._indicesChanged){this._indicesChanged=!1;for(var key in this._keyMap){var group=this._keyMap[key];if(group.firstReached&&group.lastReached){var newSize=group.lastItem.index+1-group.firstItem.index;isNaN(newSize)||(group.size=newSize)}}this._beginRefresh()}},_reload:function(){this._initializeState(),this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return _Base.Class.derive(VirtualizedDataSource.VirtualizedDataSource,function(listDataSource,groupKey,groupData,options){var groupDataAdapter=new GroupDataAdapter(listDataSource,groupKey,groupData,options);this._baseDataSourceConstructor(groupDataAdapter),this.extensions={invalidateGroups:function(){groupDataAdapter.invalidateGroups()}}},{},{supportedForProcessing:!1})})})}),define("WinJS/VirtualizedDataSource/_GroupedItemDataSource",["../Core/_Base","./_GroupDataSource"],function(_Base,_GroupDataSource){"use strict";_Base.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(listDataSource,groupKey,groupData,options){function createGroupedItem(item){if(item){var groupedItem=Object.create(item);return groupedItem.groupKey=groupKey(item),groupData&&(groupedItem.groupData=groupData(item)),groupedItem}return null}function createGroupedItemPromise(itemPromise){var groupedItemPromise=Object.create(itemPromise);return groupedItemPromise.then=function(onComplete,onError,onCancel){return itemPromise.then(function(item){return onComplete(createGroupedItem(item))},onError,onCancel)},groupedItemPromise}var groupedItemDataSource=Object.create(listDataSource);groupedItemDataSource.createListBinding=function(notificationHandler){var groupedNotificationHandler;notificationHandler?(groupedNotificationHandler=Object.create(notificationHandler),groupedNotificationHandler.inserted=function(itemPromise,previousHandle,nextHandle){return notificationHandler.inserted(createGroupedItemPromise(itemPromise),previousHandle,nextHandle)},groupedNotificationHandler.changed=function(newItem,oldItem){return notificationHandler.changed(createGroupedItem(newItem),createGroupedItem(oldItem))},groupedNotificationHandler.moved=function(itemPromise,previousHandle,nextHandle){return notificationHandler.moved(createGroupedItemPromise(itemPromise),previousHandle,nextHandle)}):groupedNotificationHandler=null;for(var listBinding=listDataSource.createListBinding(groupedNotificationHandler),groupedItemListBinding=Object.create(listBinding),listBindingMethods=["first","last","fromDescription","jumpToItem","current"],i=0,len=listBindingMethods.length;len>i;i++)!function(listBindingMethod){listBinding[listBindingMethod]&&(groupedItemListBinding[listBindingMethod]=function(){return createGroupedItemPromise(listBinding[listBindingMethod].apply(listBinding,arguments))})}(listBindingMethods[i]);return listBinding.fromKey&&(groupedItemListBinding.fromKey=function(key){return createGroupedItemPromise(listBinding.fromKey(key))}),listBinding.fromIndex&&(groupedItemListBinding.fromIndex=function(index){return createGroupedItemPromise(listBinding.fromIndex(index))}),groupedItemListBinding.prev=function(){return createGroupedItemPromise(listBinding.prev())},groupedItemListBinding.next=function(){return createGroupedItemPromise(listBinding.next())},groupedItemListBinding};for(var listDataSourceMethods=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],i=0,len=listDataSourceMethods.length;len>i;i++)!function(listDataSourceMethod){listDataSource[listDataSourceMethod]&&(groupedItemDataSource[listDataSourceMethod]=function(){return createGroupedItemPromise(listDataSource[listDataSourceMethod].apply(listDataSource,arguments))})}(listDataSourceMethods[i]);["addEventListener","removeEventListener","dispatchEvent"].forEach(function(methodName){listDataSource[methodName]&&(groupedItemDataSource[methodName]=function(){return listDataSource[methodName].apply(listDataSource,arguments)})});var groupDataSource=null;return Object.defineProperty(groupedItemDataSource,"groups",{get:function(){return groupDataSource||(groupDataSource=new _GroupDataSource._GroupDataSource(listDataSource,groupKey,groupData,options)),groupDataSource},enumerable:!0,configurable:!0}),groupedItemDataSource}})}),define("WinJS/VirtualizedDataSource/_StorageDataSource",["exports","../Core/_WinRT","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_WriteProfilerMark","../Animations","../Promise","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(exports,_WinRT,_Global,_Base,_ErrorFromName,_WriteProfilerMark,Animations,Promise,_UI,VirtualizedDataSource){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{StorageDataSource:_Base.Namespace._lazy(function(){var StorageDataAdapter=_Base.Class.define(function(query,options){_WriteProfilerMark("WinJS.UI.StorageDataSource:constructor,StartTM");var library,mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.singleItem,size=256,flags=_WinRT.Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,delayLoad=!0;if("Pictures"===query?(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.picturesView,library=_WinRT.Windows.Storage.KnownFolders.picturesLibrary,size=190):"Music"===query?(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.musicView,library=_WinRT.Windows.Storage.KnownFolders.musicLibrary,size=256):"Documents"===query?(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.documentsView,library=_WinRT.Windows.Storage.KnownFolders.documentsLibrary,size=40):"Videos"===query&&(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.videosView,library=_WinRT.Windows.Storage.KnownFolders.videosLibrary,size=190),library){var queryOptions=new _WinRT.Windows.Storage.Search.QueryOptions;queryOptions.folderDepth=_WinRT.Windows.Storage.Search.FolderDepth.deep,queryOptions.indexerOption=_WinRT.Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=library.createFileQueryWithOptions(queryOptions)}else this._query=query;if(options){if("number"==typeof options.mode&&(mode=options.mode),"number"==typeof options.requestedThumbnailSize)size=Math.max(1,Math.min(options.requestedThumbnailSize,1024));else switch(mode){case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.picturesView:case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.videosView:size=190;break;case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.documentsView:case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.listView:size=40;break;case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.musicView:case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.singleItem:size=256}"number"==typeof options.thumbnailOptions&&(flags=options.thumbnailOptions),"boolean"==typeof options.waitForFileLoad&&(delayLoad=!options.waitForFileLoad)}this._loader=new _WinRT.Windows.Storage.BulkAccess.FileInformationFactory(this._query,mode,size,flags,delayLoad),this.compareByIdentity=!1,this.firstDataRequest=!0,_WriteProfilerMark("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(notificationHandler){this._notificationHandler=notificationHandler,this._query.addEventListener("contentschanged",function(){notificationHandler.invalidateAll()}),this._query.addEventListener("optionschanged",function(){notificationHandler.invalidateAll()})},itemsFromEnd:function(count){var that=this;return _WriteProfilerMark("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(totalCount){return 0===totalCount?Promise.wrapError(new _ErrorFromName(_UI.FetchError.doesNotExist)):that.itemsFromIndex(totalCount-1,Math.min(totalCount-1,count-1),1)})},itemsFromIndex:function(index,countBefore,countAfter){function listener(ev){that._notificationHandler.changed(that._item(ev.target))}countBefore+countAfter>64&&(countBefore=Math.min(countBefore,32),countAfter=64-(countBefore+1));var first=index-countBefore,count=countBefore+1+countAfter,that=this;that.firstDataRequest&&(that.firstDataRequest=!1,count=Math.max(count,32));var perfId="WinJS.UI.StorageDataSource:itemsFromIndex("+first+"-"+(first+count-1)+")";return _WriteProfilerMark(perfId+",StartTM"),this._loader.getItemsAsync(first,count).then(function(itemsVector){var vectorSize=itemsVector.size;if(countBefore>=vectorSize)return Promise.wrapError(new _ErrorFromName(_UI.FetchError.doesNotExist));var items=new Array(vectorSize),localItemsVector=new Array(vectorSize);itemsVector.getMany(0,localItemsVector);for(var i=0;vectorSize>i;i++)items[i]=that._item(localItemsVector[i]),localItemsVector[i].addEventListener("propertiesupdated",listener);var result={items:items,offset:countBefore,absoluteIndex:index};return count>vectorSize&&(result.totalCount=first+vectorSize),_WriteProfilerMark(perfId+",StopTM"),result})},itemsFromDescription:function(description,countBefore,countAfter){var that=this;return _WriteProfilerMark("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(description).then(function(index){return that.itemsFromIndex(index,countBefore,countAfter)})},getCount:function(){return _WriteProfilerMark("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(item){return item.folderRelativeId},_item:function(item){return{key:item.path||item.folderRelativeId,data:item}}},{supportedForProcessing:!1});return _Base.Class.derive(VirtualizedDataSource.VirtualizedDataSource,function(query,options){this._baseDataSourceConstructor(new StorageDataAdapter(query,options))},{},{loadThumbnail:function(item,image){var thumbnailUpdateHandler,thumbnailPromise,shouldRespondToThumbnailUpdate=!1;return new Promise(function(complete){var tagSupplied=image?!0:!1,processThumbnail=function(thumbnail){if(thumbnail){var url=_Global.URL.createObjectURL(thumbnail,{oneTimeOnly:!0});thumbnailPromise=thumbnailPromise?thumbnailPromise.then(function(image){return item.loadImage(url,image)}):item.loadImage(url,image).then(function(image){return item.isOnScreen().then(function(visible){var imagePromise;return visible&&tagSupplied?imagePromise=Animations.fadeIn(image).then(function(){return image}):(image.style.opacity=1,imagePromise=Promise.wrap(image)),imagePromise})}),thumbnail.type===_WinRT.Windows.Storage.FileProperties.ThumbnailType.icon||thumbnail.returnedSmallerCachedSize||(_WriteProfilerMark("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),item.data.removeEventListener("thumbnailupdated",thumbnailUpdateHandler),shouldRespondToThumbnailUpdate=!1,thumbnailPromise=thumbnailPromise.then(function(image){thumbnailUpdateHandler=null,thumbnailPromise=null,complete(image)}))}};thumbnailUpdateHandler=function(e){shouldRespondToThumbnailUpdate&&processThumbnail(e.target.thumbnail)},item.data.addEventListener("thumbnailupdated",thumbnailUpdateHandler),shouldRespondToThumbnailUpdate=!0,processThumbnail(item.data.thumbnail)},function(){item.data.removeEventListener("thumbnailupdated",thumbnailUpdateHandler),shouldRespondToThumbnailUpdate=!1,thumbnailUpdateHandler=null,thumbnailPromise&&(thumbnailPromise.cancel(),thumbnailPromise=null)})},supportedForProcessing:!1})})})}),define("WinJS/VirtualizedDataSource",["./VirtualizedDataSource/_VirtualizedDataSourceImpl","./VirtualizedDataSource/_GroupDataSource","./VirtualizedDataSource/_GroupedItemDataSource","./VirtualizedDataSource/_StorageDataSource"],function(){}),define("WinJS/Vui",["require","exports","./Core/_Global","./Utilities/_ElementUtilities"],function(require,exports,_Global,_ElementUtilities){function _handleListeningModeStateChanged(e){if(!e.defaultPrevented){var target=e.target,transitionHandler=Handlers[target.tagName];if(transitionHandler)switch(e.state){case ListeningModeStates.active:target[Properties.vuiData]||_ElementUtilities.hasClass(target,ClassNames.active)?(_ElementUtilities.removeClass(target,ClassNames.disambiguation),transitionHandler.reactivate(target,e.label)):(_ElementUtilities.addClass(target,ClassNames.active),transitionHandler.activate(target,e.label));break;case ListeningModeStates.disambiguation:_ElementUtilities.addClass(target,ClassNames.active),_ElementUtilities.addClass(target,ClassNames.disambiguation),transitionHandler.disambiguate(target,e.label);break;case ListeningModeStates.inactive:_ElementUtilities.removeClass(target,ClassNames.active),_ElementUtilities.removeClass(target,ClassNames.disambiguation),transitionHandler.deactivate(target)}}}var Handlers,Properties={vuiData:"_winVuiData"},ClassNames={active:"win-vui-active",disambiguation:"win-vui-disambiguation"},EventNames={ListeningModeStateChanged:"ListeningStateChanged"},ListeningModeStates={active:"active",disambiguation:"disambiguation",inactive:"inactive"};!function(Handlers){Handlers.BUTTON={activate:function(element,label){var vuiData={nodes:[],width:element.style.width,height:element.style.height},cs=_ElementUtilities._getComputedStyle(element);for(element.style.width=cs.width,element.style.height=cs.height;element.childNodes.length;)vuiData.nodes.push(element.removeChild(element.childNodes[0]));element[Properties.vuiData]=vuiData,element.textContent=label},disambiguate:function(element,label){element.textContent=label},reactivate:function(element,label){element.textContent=label},deactivate:function(element){element.innerHTML="";var vuiData=element[Properties.vuiData];element.style.width=vuiData.width,element.style.height=vuiData.height,vuiData.nodes.forEach(function(node){return element.appendChild(node)}),delete element[Properties.vuiData]}}}(Handlers||(Handlers={})),_Global.document&&_Global.document.addEventListener(EventNames.ListeningModeStateChanged,_handleListeningModeStateChanged)}),define("WinJS/_Accents",["require","exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Utilities/_ElementUtilities"],function(require,exports,_Global,_WinRT,_Base,_BaseUtils,_ElementUtilities){function createAccentRule(selector,props){rules.push({selector:selector,props:props}),scheduleWriteRules()}function scheduleWriteRules(){0!==rules.length&&-1===writeRulesTOHandle&&(writeRulesTOHandle=_BaseUtils._setImmediate(function(){writeRulesTOHandle=-1,cleanup();var inverseThemeSelector=isDarkTheme?Constants.lightThemeSelector:Constants.darkThemeSelector,inverseThemeHoverSelector=Constants.hoverSelector+" "+inverseThemeSelector,style=_Global.document.createElement("style");style.id=Constants.accentStyleId,style.textContent=rules.map(function(rule){var body="  "+rule.props.map(function(prop){return prop.name+": "+colors[prop.value]+";"}).join("\n  "),selectorSplit=rule.selector.split(",").map(function(str){return sanitizeSpaces(str)}),selector=selectorSplit.join(",\n"),css=selector+" {\n"+body+"\n}",isThemedColor=rule.props.some(function(prop){return 0!==prop.value});if(isThemedColor){var inverseBody="  "+rule.props.map(function(prop){return prop.name+": "+colors[prop.value?prop.value+3:prop.value]+";"}).join("\n  "),themedSelectors=[];selectorSplit.forEach(function(sel){if(-1!==sel.indexOf(Constants.hoverSelector)&&-1===sel.indexOf(inverseThemeHoverSelector)){themedSelectors.push(sel.replace(Constants.hoverSelector,inverseThemeHoverSelector));var selWithoutHover=sel.replace(Constants.hoverSelector,"").trim();-1!==CSSSelectorTokens.indexOf(selWithoutHover[0])&&themedSelectors.push(sel.replace(Constants.hoverSelector+" ",inverseThemeHoverSelector))}else themedSelectors.push(inverseThemeSelector+" "+sel),-1!==CSSSelectorTokens.indexOf(sel[0])&&themedSelectors.push(inverseThemeSelector+sel);css+="\n"+themedSelectors.join(",\n")+" {\n"+inverseBody+"\n}"})}return css}).join("\n"),_Global.document.head.appendChild(style)}))}function handleColorsChanged(){var uiColor=(_WinRT.Windows.UI.ViewManagement.UIColorType,
UISettings.getColorValue(_WinRT.Windows.UI.ViewManagement.UIColorType.accent)),accent=colorToString(uiColor,1);colors[0]!==accent&&(colors.length=0,colors.push(accent,colorToString(uiColor,isDarkTheme?.6:.4),colorToString(uiColor,isDarkTheme?.8:.6),colorToString(uiColor,isDarkTheme?.9:.7),colorToString(uiColor,isDarkTheme?.4:.6),colorToString(uiColor,isDarkTheme?.6:.8),colorToString(uiColor,isDarkTheme?.7:.9)),scheduleWriteRules())}function colorToString(color,alpha){return"rgba("+color.r+","+color.g+","+color.b+","+alpha+")"}function sanitizeSpaces(str){return str.replace(/  /g," ").replace(/  /g," ").trim()}function cleanup(){var style=_Global.document.head.querySelector("#"+Constants.accentStyleId);style&&style.parentNode.removeChild(style)}function _reset(){rules.length=0,cleanup()}var Constants={accentStyleId:"WinJSAccentsStyle",themeDetectionTag:"winjs-themedetection-tag",hoverSelector:"html.win-hoverable",lightThemeSelector:".win-ui-light",darkThemeSelector:".win-ui-dark"},CSSSelectorTokens=[".","#",":"],UISettings=null,colors=[],isDarkTheme=!1,rules=[],writeRulesTOHandle=-1;!function(ColorTypes){ColorTypes[ColorTypes.accent=0]="accent",ColorTypes[ColorTypes.listSelectRest=1]="listSelectRest",ColorTypes[ColorTypes.listSelectHover=2]="listSelectHover",ColorTypes[ColorTypes.listSelectPress=3]="listSelectPress",ColorTypes[ColorTypes._listSelectRestInverse=4]="_listSelectRestInverse",ColorTypes[ColorTypes._listSelectHoverInverse=5]="_listSelectHoverInverse",ColorTypes[ColorTypes._listSelectPressInverse=6]="_listSelectPressInverse"}(exports.ColorTypes||(exports.ColorTypes={}));var ColorTypes=exports.ColorTypes;exports.createAccentRule=createAccentRule;var tag=_Global.document.createElement(Constants.themeDetectionTag);_Global.document.head.appendChild(tag);var cs=_ElementUtilities._getComputedStyle(tag);isDarkTheme="0"===cs.opacity,tag.parentElement.removeChild(tag);try{UISettings=new _WinRT.Windows.UI.ViewManagement.UISettings,UISettings.addEventListener("colorvalueschanged",handleColorsChanged),handleColorsChanged()}catch(e){colors.push("rgb(0, 120, 215)","rgba(0, 120, 215, "+(isDarkTheme?"0.6":"0.4")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.8":"0.6")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.9":"0.7")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.4":"0.6")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.6":"0.8")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.7":"0.9")+")")}var toPublish={ColorTypes:ColorTypes,createAccentRule:createAccentRule,_colors:colors,_reset:_reset,_isDarkTheme:isDarkTheme};_Base.Namespace.define("WinJS.UI._Accents",toPublish)}),define("require-style",{load:function(id){throw new Error("Dynamic load not allowed: "+id)}}),define("require-style!less/styles-intrinsic",[],function(){}),define("require-style!less/colors-intrinsic",[],function(){}),define("WinJS/Controls/IntrinsicControls",["../Utilities/_Hoverable","../_Accents","require-style!less/styles-intrinsic","require-style!less/colors-intrinsic"],function(_Hoverable,_Accents){"use strict";_Accents.createAccentRule(".win-link,         .win-progress-bar,         .win-progress-ring,         .win-ring",[{name:"color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule("::selection,         .win-button.win-button-primary,         .win-dropdown option:checked,         select[multiple].win-dropdown option:checked",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-textbox:focus,         .win-textarea:focus,         .win-textbox:focus:hover,         .win-textarea:focus:hover",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-textbox::-ms-clear:hover:not(:active),         .win-textbox::-ms-reveal:hover:not(:active)",[{name:"color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-checkbox:checked::-ms-check,         .win-textbox::-ms-clear:active,         .win-textbox::-ms-reveal:active",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-progress-bar::-webkit-progress-value,         .win-progress-ring::-webkit-progress-value,         .win-ring::-webkit-progress-value",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-progress-bar:not(:indeterminate)::-moz-progress-bar,         .win-progress-ring:not(:indeterminate)::-moz-progress-bar,         .win-ring:not(:indeterminate)::-moz-progress-bar",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-checkbox:indeterminate::-ms-check,         .win-checkbox:hover:indeterminate::-ms-check,         .win-radio:checked::-ms-check",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-slider::-ms-thumb,         .win-slider::-ms-fill-lower",[{name:"background",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-slider::-webkit-slider-thumb",[{name:"background",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-slider::-moz-range-thumb",[{name:"background",value:_Accents.ColorTypes.accent}])}),define("WinJS/Controls/ItemContainer/_Constants",["exports","../../Core/_Base"],function(exports,_Base){"use strict";var members={};members._listViewClass="win-listview",members._viewportClass="win-viewport",members._rtlListViewClass="win-rtl",members._horizontalClass="win-horizontal",members._verticalClass="win-vertical",members._scrollableClass="win-surface",members._itemsContainerClass="win-itemscontainer",members._listHeaderContainerClass="win-headercontainer",members._listFooterContainerClass="win-footercontainer",members._padderClass="win-itemscontainer-padder",members._proxyClass="_win-proxy",members._itemClass="win-item",members._itemBoxClass="win-itembox",members._itemsBlockClass="win-itemsblock",members._containerClass="win-container",members._containerEvenClass="win-container-even",members._containerOddClass="win-container-odd",members._backdropClass="win-backdrop",members._footprintClass="win-footprint",members._groupsClass="win-groups",members._selectedClass="win-selected",members._selectionBorderClass="win-selectionborder",members._selectionBackgroundClass="win-selectionbackground",members._selectionCheckmarkClass="win-selectioncheckmark",members._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground",members._pressedClass="win-pressed",members._headerClass="win-groupheader",members._headerContainerClass="win-groupheadercontainer",members._groupLeaderClass="win-groupleader",members._progressClass="win-progress",members._revealedClass="win-revealed",members._itemFocusClass="win-focused",members._itemFocusOutlineClass="win-focusedoutline",members._zoomingXClass="win-zooming-x",members._zoomingYClass="win-zooming-y",members._listLayoutClass="win-listlayout",members._gridLayoutClass="win-gridlayout",members._headerPositionTopClass="win-headerpositiontop",members._headerPositionLeftClass="win-headerpositionleft",members._structuralNodesClass="win-structuralnodes",members._singleItemsBlockClass="win-single-itemsblock",members._uniformGridLayoutClass="win-uniformgridlayout",members._uniformListLayoutClass="win-uniformlistlayout",members._cellSpanningGridLayoutClass="win-cellspanninggridlayout",members._laidOutClass="win-laidout",members._nonDraggableClass="win-nondraggable",members._nonSelectableClass="win-nonselectable",members._dragOverClass="win-dragover",members._dragSourceClass="win-dragsource",members._clipClass="win-clip",members._selectionModeClass="win-selectionmode",members._noCSSGrid="win-nocssgrid",members._hidingSelectionMode="win-hidingselectionmode",members._hidingSelectionModeAnimationTimeout=250,members._INVALID_INDEX=-1,members._UNINITIALIZED=-1,members._LEFT_MSPOINTER_BUTTON=0,members._RIGHT_MSPOINTER_BUTTON=2,members._TAP_END_THRESHOLD=10,members._DEFAULT_PAGES_TO_LOAD=5,members._DEFAULT_PAGE_LOAD_THRESHOLD=2,members._MIN_AUTOSCROLL_RATE=150,members._MAX_AUTOSCROLL_RATE=1500,members._AUTOSCROLL_THRESHOLD=100,members._AUTOSCROLL_DELAY=50,members._DEFERRED_ACTION=250,members._DEFERRED_SCROLL_END=250,members._SELECTION_CHECKMARK="",members._LISTVIEW_PROGRESS_DELAY=2e3;var ScrollToPriority={uninitialized:0,low:1,medium:2,high:3},ViewChange={rebuild:0,remeasure:1,relayout:2,realize:3};members._ScrollToPriority=ScrollToPriority,members._ViewChange=ViewChange,_Base.Namespace._moduleDefine(exports,"WinJS.UI",members)}),define("WinJS/Controls/ItemContainer/_ItemEventsHandler",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","./_Constants"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_WriteProfilerMark,Animations,_TransitionAnimation,Promise,_ElementUtilities,_UI,_Constants){"use strict";var transformNames=_BaseUtils._browserStyleEquivalents.transform;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ItemEventsHandler:_Base.Namespace._lazy(function(){function createNodeWithClass(className,skipAriaHidden){var element=_Global.document.createElement("div");return element.className=className,skipAriaHidden||element.setAttribute("aria-hidden",!0),element}var PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",ItemEventsHandler=_Base.Class.define(function(site){this._site=site,this._work=[],this._animations={}},{dispose:function(){this._disposed||(this._disposed=!0,_ElementUtilities._removeEventListener(_Global,"pointerup",this._resetPointerDownStateBound),_ElementUtilities._removeEventListener(_Global,"pointercancel",this._resetPointerDownStateBound))},onPointerDown:function(eventObject){_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");var leftButton,rightButton,site=this._site,touchInput=eventObject.pointerType===PT_TOUCH;if(site.pressedElement=eventObject.target,_WinRT.Windows.UI.Input.PointerPoint){var currentPoint=this._getCurrentPoint(eventObject),pointProps=currentPoint.properties;touchInput||pointProps.isInverted||pointProps.isEraser||pointProps.isMiddleButtonPressed?leftButton=rightButton=!1:(rightButton=pointProps.isRightButtonPressed,leftButton=!rightButton&&pointProps.isLeftButtonPressed)}else leftButton=eventObject.button===_Constants._LEFT_MSPOINTER_BUTTON,rightButton=eventObject.button===_Constants._RIGHT_MSPOINTER_BUTTON;this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this),this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this),this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this);var isInteractive=this._isInteractive(eventObject.target),currentPressedIndex=site.indexForItemElement(eventObject.target),currentPressedHeaderIndex=site.indexForHeaderElement(eventObject.target),mustSetCapture=!isInteractive&&currentPressedIndex!==_Constants._INVALID_INDEX;if((touchInput||leftButton)&&this._site.pressedEntity.index===_Constants._INVALID_INDEX&&!isInteractive&&(currentPressedHeaderIndex===_Constants._INVALID_INDEX?this._site.pressedEntity={type:_UI.ObjectType.item,index:currentPressedIndex}:this._site.pressedEntity={type:_UI.ObjectType.groupHeader,index:currentPressedHeaderIndex},this._site.pressedEntity.index!==_Constants._INVALID_INDEX)){this._site.pressedPosition=_ElementUtilities._getCursorPos(eventObject);var allowed=site.verifySelectionAllowed(this._site.pressedEntity);this._canSelect=allowed.canSelect,this._canTapSelect=allowed.canTapSelect,this._site.pressedEntity.type===_UI.ObjectType.item?(this._site.pressedItemBox=site.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=site.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,eventObject),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),touchInput||(_ElementUtilities._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),_ElementUtilities._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(eventObject.target),_BaseUtils.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,eventObject)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),touchInput||(_ElementUtilities._addEventListener(_Global,"pointerup",this._resetPointerDownStateBound,!1),_ElementUtilities._addEventListener(_Global,"pointercancel",this._resetPointerDownStateBound,!1)),this._pointerId=eventObject.pointerId,this._pointerRightButton=rightButton}if(mustSetCapture&&touchInput)try{_ElementUtilities._setPointerCapture(site.canvasProxy,eventObject.pointerId)}catch(e){return void _WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type===_UI.ObjectType.item&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==_Constants._INVALID_INDEX&&site.selection._getFocused().index!==_Constants._INVALID_INDEX&&site.selection._pivot===_Constants._INVALID_INDEX&&(site.selection._pivot=site.selection._getFocused().index),_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(eventObject){this._site.pressedContainer&&this._pointerId===eventObject.pointerId&&this._togglePressed(!0,eventObject)},onPointerLeave:function(eventObject){this._site.pressedContainer&&this._pointerId===eventObject.pointerId&&this._togglePressed(!1,eventObject)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.style[transformNames.scriptName]="",this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),_ElementUtilities._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),_ElementUtilities._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(eventObject){if(!this._skipClick){var entity={type:_UI.ObjectType.item,index:this._site.indexForItemElement(eventObject.target)};if(entity.index===_Constants._INVALID_INDEX&&(entity.index=this._site.indexForHeaderElement(eventObject.target),entity.index!==_Constants._INVALID_INDEX&&(entity.type=_UI.ObjectType.groupHeader)),entity.index!==_Constants._INVALID_INDEX&&(_ElementUtilities.hasClass(eventObject.target,this._site.accessibleItemClass)||_ElementUtilities.hasClass(eventObject.target,_Constants._headerClass))){var allowed=this._site.verifySelectionAllowed(entity);allowed.canTapSelect&&this.handleTap(entity),this._site.fireInvokeEvent(entity,eventObject.target)}}},onPointerUp:function(eventObject){_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");var site=this._site;this._skipClick=!0;var that=this;_BaseUtils._yieldForEvents(function(){that._skipClick=!1});try{_ElementUtilities._releasePointerCapture(site.canvasProxy,eventObject.pointerId)}catch(e){}var touchInput=eventObject.pointerType===PT_TOUCH,releasedElement=this._releasedElement(eventObject),releasedIndex=site.indexForItemElement(releasedElement),releasedHeaderIndex=releasedElement&&_ElementUtilities.hasClass(releasedElement,_Constants._headerContainerClass)?site.indexForHeaderElement(site.pressedHeader):site.indexForHeaderElement(releasedElement);if(this._pointerId===eventObject.pointerId){var releasedEntity;if(releasedEntity=releasedHeaderIndex===_Constants._INVALID_INDEX?{type:_UI.ObjectType.item,index:releasedIndex}:{type:_UI.ObjectType.groupHeader,index:releasedHeaderIndex},this._resetPressedContainer(),this._site.pressedEntity.type===_UI.ObjectType.item&&releasedEntity.type===_UI.ObjectType.item&&this._site.pressedContainer&&this._site.pressedEntity.index===releasedEntity.index)if(eventObject.shiftKey||(site.selection._pivot=_Constants._INVALID_INDEX),eventObject.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&site.selection._pivot!==_Constants._INVALID_INDEX){var firstIndex=Math.min(this._site.pressedEntity.index,site.selection._pivot),lastIndex=Math.max(this._site.pressedEntity.index,site.selection._pivot),additive=this._pointerRightButton||eventObject.ctrlKey||site.tapBehavior===_UI.TapBehavior.toggleSelect;site.selectRange(firstIndex,lastIndex,additive)}}else eventObject.ctrlKey&&this.toggleSelectionIfAllowed(this._site.pressedEntity.index);if(this._site.pressedHeader||this._site.pressedContainer){var upPosition=_ElementUtilities._getCursorPos(eventObject),isTap=Math.abs(upPosition.left-this._site.pressedPosition.left)<=_Constants._TAP_END_THRESHOLD&&Math.abs(upPosition.top-this._site.pressedPosition.top)<=_Constants._TAP_END_THRESHOLD;this._pointerRightButton||eventObject.ctrlKey||eventObject.shiftKey||!(touchInput&&isTap||!touchInput&&this._site.pressedEntity.index===releasedEntity.index&&this._site.pressedEntity.type===releasedEntity.type)||(releasedEntity.type===_UI.ObjectType.groupHeader?(this._site.pressedHeader=site.headerAtIndex(releasedEntity.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=site.itemBoxAtIndex(releasedEntity.index),this._site.pressedContainer=site.containerAtIndex(releasedEntity.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader))}this._site.pressedEntity.index!==_Constants._INVALID_INDEX&&site.changeFocus(this._site.pressedEntity,!0,!1,!0),this.resetPointerDownState()}_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(eventObject){this._pointerId===eventObject.pointerId&&(_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(eventObject){this._pointerId===eventObject.pointerId&&(_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(eventObject){this._shouldSuppressContextMenu(eventObject.target)&&eventObject.preventDefault()},onMSHoldVisual:function(eventObject){this._shouldSuppressContextMenu(eventObject.target)&&eventObject.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},toggleSelectionIfAllowed:function(itemIndex){this._selectionAllowed(itemIndex)&&this._toggleItemSelection(itemIndex)},handleTap:function(entity){if(entity.type!==_UI.ObjectType.groupHeader){var site=this._site,selection=site.selection;this._selectionAllowed(entity.index)&&this._selectOnTap()&&(site.tapBehavior===_UI.TapBehavior.toggleSelect?this._toggleItemSelection(entity.index):site.selectionMode!==_UI.SelectionMode.multi&&selection._isIncluded(entity.index)||selection.set(entity.index))}},_toggleItemSelection:function(itemIndex){var site=this._site,selection=site.selection,selected=selection._isIncluded(itemIndex);site.selectionMode===_UI.SelectionMode.single?selected?selection.clear():selection.set(itemIndex):selected?selection.remove(itemIndex):selection.add(itemIndex)},_getCurrentPoint:function(eventObject){return _WinRT.Windows.UI.Input.PointerPoint.getCurrentPoint(eventObject.pointerId)},_containedInElementWithClass:function(element,className){if(element.parentNode)for(var matches=element.parentNode.querySelectorAll("."+className+", ."+className+" *"),i=0,len=matches.length;len>i;i++)if(matches[i]===element)return!0;return!1},_isSelected:function(index){return this._site.selection._isIncluded(index)},_isInteractive:function(element){return this._containedInElementWithClass(element,"win-interactive")},_shouldSuppressContextMenu:function(element){var containerElement=this._site.containerFromElement(element);return this._selectionAllowed()&&containerElement&&!this._isInteractive(element)},_togglePressed:function(add,eventObject){var isHeader=this._site.pressedEntity.type===_UI.ObjectType.groupHeader;(isHeader||!_ElementUtilities.hasClass(this._site.pressedItemBox,_Constants._nonSelectableClass))&&(this._staticMode(isHeader)||(add?_ElementUtilities.addClass(this._site.animatedElement,_Constants._pressedClass):_ElementUtilities.removeClass(this._site.animatedElement,_Constants._pressedClass)))},_resetPointerDownStateForPointerId:function(eventObject){this._pointerId===eventObject.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._site.pressedElement=null,_ElementUtilities._removeEventListener(_Global,"pointerup",this._resetPointerDownStateBound),_ElementUtilities._removeEventListener(_Global,"pointercancel",this._resetPointerDownStateBound),this._resetPressedContainer(),this._site.pressedContainer=null,this._site.animatedElement=null,this._site.pressedHeader=null,this._site.pressedItemBox=null,this._site.pressedEntity={type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},this._pointerId=null},_releasedElement:function(eventObject){return _Global.document.elementFromPoint(eventObject.clientX,eventObject.clientY)},_applyUIInBatches:function(work){function applyUI(){that._work.length>0?(that._flushUIBatches(),that._paintedThisFrame=_BaseUtils._requestAnimationFrame(applyUI.bind(that))):that._paintedThisFrame=null}var that=this;this._work.push(work),this._paintedThisFrame||applyUI()},_flushUIBatches:function(){if(this._work.length>0){var workItems=this._work;this._work=[];for(var i=0;i<workItems.length;i++)workItems[i]()}},_selectionAllowed:function(itemIndex){var item=void 0!==itemIndex?this._site.itemAtIndex(itemIndex):null,itemSelectable=!(item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass));return itemSelectable&&this._site.selectionMode!==_UI.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===_UI.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===_UI.TapBehavior.toggleSelect||this._site.tapBehavior===_UI.TapBehavior.directSelect},_staticMode:function(isHeader){return isHeader?this._site.headerTapBehavior===_UI.GroupHeaderTapBehavior.none:this._site.tapBehavior===_UI.TapBehavior.none&&this._site.selectionMode===_UI.SelectionMode.none}},{setAriaSelected:function(itemElement,isSelected){var ariaSelected="true"===itemElement.getAttribute("aria-selected");isSelected!==ariaSelected&&itemElement.setAttribute("aria-selected",isSelected)},renderSelection:function(itemBox,element,selected,aria,container){if(!ItemEventsHandler._selectionTemplate){ItemEventsHandler._selectionTemplate=[],ItemEventsHandler._selectionTemplate.push(createNodeWithClass(_Constants._selectionBackgroundClass)),ItemEventsHandler._selectionTemplate.push(createNodeWithClass(_Constants._selectionBorderClass)),ItemEventsHandler._selectionTemplate.push(createNodeWithClass(_Constants._selectionCheckmarkBackgroundClass));var checkmark=createNodeWithClass(_Constants._selectionCheckmarkClass);checkmark.textContent=_Constants._SELECTION_CHECKMARK,ItemEventsHandler._selectionTemplate.push(checkmark)}if(selected!==_ElementUtilities._isSelectionRendered(itemBox)){if(selected){itemBox.insertBefore(ItemEventsHandler._selectionTemplate[0].cloneNode(!0),itemBox.firstElementChild);for(var i=1,len=ItemEventsHandler._selectionTemplate.length;len>i;i++)itemBox.appendChild(ItemEventsHandler._selectionTemplate[i].cloneNode(!0))}else for(var nodes=itemBox.querySelectorAll(_ElementUtilities._selectionPartsSelector),i=0,len=nodes.length;len>i;i++)itemBox.removeChild(nodes[i]);_ElementUtilities[selected?"addClass":"removeClass"](itemBox,_Constants._selectedClass),container&&_ElementUtilities[selected?"addClass":"removeClass"](container,_Constants._selectedClass)}aria&&ItemEventsHandler.setAriaSelected(element,selected)}});return ItemEventsHandler})})}),define("WinJS/Controls/ListView/_SelectionManager",["exports","../../Core/_Global","../../Core/_Base","../../Promise","../../_Signal","../../Utilities/_UI","../ItemContainer/_Constants"],function(exports,_Global,_Base,Promise,_Signal,_UI,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ItemSet:_Base.Namespace._lazy(function(){var _ItemSet=_Base.Class.define(function(listView,ranges,count){this._listView=listView,this._ranges=ranges,this._itemsCount=count});return _ItemSet.prototype={getRanges:function(){for(var ranges=[],i=0,len=this._ranges.length;len>i;i++){var range=this._ranges[i];ranges.push({firstIndex:range.firstIndex,lastIndex:range.lastIndex,firstKey:range.firstKey,lastKey:range.lastKey})}return ranges},getItems:function(){return exports.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var count=0,i=0,len=this._ranges.length;len>i;i++){var range=this._ranges[i];count+=range.lastIndex-range.firstIndex+1}return count},getIndices:function(){for(var indices=[],i=0,len=this._ranges.length;len>i;i++)for(var range=this._ranges[i],n=range.firstIndex;n<=range.lastIndex;n++)indices.push(n);return indices}},_ItemSet}),getItemsFromRanges:function(dataSource,ranges){function getIndices(){for(var indices=[],i=0,len=ranges.length;len>i;i++)for(var range=ranges[i],j=range.firstIndex;j<=range.lastIndex;j++)indices.push(j);return Promise.wrap(indices)}var listBinding=dataSource.createListBinding(),promises=[];return getIndices().then(function(indices){for(var i=0;i<indices.length;i++)promises.push(listBinding.fromIndex(indices[i]));return Promise.join(promises).then(function(items){return listBinding.release(),items})})},_Selection:_Base.Namespace._lazy(function(){function isEverythingRange(ranges){return ranges&&0===ranges.firstIndex&&ranges.lastIndex===Number.MAX_VALUE}return _Base.Class.derive(exports._ItemSet,function(listView,indexesAndRanges){this._listView=listView,this._itemsCount=-1,this._ranges=[],indexesAndRanges&&this.set(indexesAndRanges)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],Promise.wrap()},set:function(items){if(isEverythingRange(items))return this.selectAll();this._releaseRanges(this._ranges),this._ranges=[];var that=this;return this._execute("_set",items).then(function(){return that._ranges.sort(function(left,right){return left.firstIndex-right.firstIndex}),that._ensureKeys()}).then(function(){return that._ensureCount()})},add:function(items){if(isEverythingRange(items))return this.selectAll();var that=this;return this._execute("_add",items).then(function(){return that._ensureKeys()}).then(function(){return that._ensureCount()})},remove:function(items){var that=this;return this._execute("_remove",items).then(function(){return that._ensureKeys()})},selectAll:function(){var that=this;return that._ensureCount().then(function(){if(that._itemsCount){var range={firstIndex:0,lastIndex:that._itemsCount-1};return that._retainRange(range),that._releaseRanges(that._ranges),that._ranges=[range],that._ensureKeys()}})},_execute:function(operation,items){function toRange(type,first,last){var retVal={};return retVal["first"+type]=first,retVal["last"+type]=last,retVal}function handleKeys(range){var binding=that._getListBinding(),promise=Promise.join([binding.fromKey(range.firstKey),binding.fromKey(range.lastKey)]).then(function(items){return items[0]&&items[1]&&(range.firstIndex=items[0].index,range.lastIndex=items[1].index,that[operation](range)),range});promises.push(promise)}for(var that=this,keysSupported=!!that._getListBinding().fromKey,array=Array.isArray(items)?items:[items],promises=[Promise.wrap()],i=0,len=array.length;len>i;i++){var item=array[i];"number"==typeof item?this[operation](toRange("Index",item,item)):item&&(keysSupported&&void 0!==item.key?handleKeys(toRange("Key",item.key,item.key)):keysSupported&&void 0!==item.firstKey&&void 0!==item.lastKey?handleKeys(toRange("Key",item.firstKey,item.lastKey)):void 0!==item.index&&"number"==typeof item.index?this[operation](toRange("Index",item.index,item.index)):void 0!==item.firstIndex&&void 0!==item.lastIndex&&"number"==typeof item.firstIndex&&"number"==typeof item.lastIndex&&this[operation](toRange("Index",item.firstIndex,item.lastIndex)))}return Promise.join(promises)},_set:function(range){this._retainRange(range),this._ranges.push(range)},_add:function(newRange){for(var range,inserted,mergeWithPrev,that=this,prev=null,merge=function(left,right){right.lastIndex>left.lastIndex&&(left.lastIndex=right.lastIndex,left.lastKey=right.lastKey,left.lastPromise&&left.lastPromise.release(),left.lastPromise=that._getListBinding().fromIndex(left.lastIndex).retain())},i=0,len=this._ranges.length;len>i;i++){if(range=this._ranges[i],newRange.firstIndex<range.firstIndex){mergeWithPrev=prev&&newRange.firstIndex<prev.lastIndex+1,mergeWithPrev?(inserted=i-1,merge(prev,newRange)):(this._insertRange(i,newRange),inserted=i);break}if(newRange.firstIndex===range.firstIndex){merge(range,newRange),inserted=i;break}prev=range}if(void 0===inserted){var last=this._ranges.length?this._ranges[this._ranges.length-1]:null,mergeWithLast=last&&newRange.firstIndex<last.lastIndex+1;mergeWithLast?merge(last,newRange):(this._retainRange(newRange),this._ranges.push(newRange))}else{for(prev=null,i=inserted+1,len=this._ranges.length;len>i;i++){if(range=this._ranges[i],newRange.lastIndex<range.firstIndex){mergeWithPrev=prev&&prev.lastIndex>newRange.lastIndex,mergeWithPrev&&merge(this._ranges[inserted],prev),this._removeRanges(inserted+1,i-inserted-1);break}if(newRange.lastIndex===range.firstIndex){merge(this._ranges[inserted],range),this._removeRanges(inserted+1,i-inserted);break}prev=range}i>=len&&(merge(this._ranges[inserted],this._ranges[len-1]),this._removeRanges(inserted+1,len-inserted-1))}},_remove:function(toRemove){function retainPromise(index){return that._getListBinding().fromIndex(index).retain()}for(var that=this,ranges=[],i=0,len=this._ranges.length;len>i;i++){var range=this._ranges[i];range.lastIndex<toRemove.firstIndex||range.firstIndex>toRemove.lastIndex?ranges.push(range):range.firstIndex<toRemove.firstIndex&&range.lastIndex>=toRemove.firstIndex&&range.lastIndex<=toRemove.lastIndex?(ranges.push({firstIndex:range.firstIndex,firstKey:range.firstKey,firstPromise:range.firstPromise,lastIndex:toRemove.firstIndex-1,lastPromise:retainPromise(toRemove.firstIndex-1)}),range.lastPromise.release()):range.lastIndex>toRemove.lastIndex&&range.firstIndex>=toRemove.firstIndex&&range.firstIndex<=toRemove.lastIndex?(ranges.push({firstIndex:toRemove.lastIndex+1,firstPromise:retainPromise(toRemove.lastIndex+1),lastIndex:range.lastIndex,lastKey:range.lastKey,lastPromise:range.lastPromise}),range.firstPromise.release()):range.firstIndex<toRemove.firstIndex&&range.lastIndex>toRemove.lastIndex?(ranges.push({firstIndex:range.firstIndex,firstKey:range.firstKey,firstPromise:range.firstPromise,lastIndex:toRemove.firstIndex-1,lastPromise:retainPromise(toRemove.firstIndex-1)}),ranges.push({firstIndex:toRemove.lastIndex+1,firstPromise:retainPromise(toRemove.lastIndex+1),lastIndex:range.lastIndex,lastKey:range.lastKey,lastPromise:range.lastPromise})):(range.firstPromise.release(),range.lastPromise.release())}this._ranges=ranges},_ensureKeys:function(){for(var promises=[Promise.wrap()],that=this,ensureKey=function(which,range){var keyProperty=which+"Key";if(range[keyProperty])return Promise.wrap();var promise=range[which+"Promise"];return promise.then(function(item){item&&(range[keyProperty]=item.key)}),promise},i=0,len=this._ranges.length;len>i;i++){var range=this._ranges[i];promises.push(ensureKey("first",range)),promises.push(ensureKey("last",range))}return Promise.join(promises).then(function(){that._ranges=that._ranges.filter(function(range){return range.firstKey&&range.lastKey})}),Promise.join(promises)},_mergeRanges:function(target,source){
target.lastIndex=source.lastIndex,target.lastKey=source.lastKey},_isIncluded:function(index){if(this.isEverything())return!0;for(var i=0,len=this._ranges.length;len>i;i++){var range=this._ranges[i];if(range.firstIndex<=index&&index<=range.lastIndex)return!0}return!1},_ensureCount:function(){var that=this;return this._listView._itemsCount().then(function(count){that._itemsCount=count})},_insertRange:function(index,newRange){this._retainRange(newRange),this._ranges.splice(index,0,newRange)},_removeRanges:function(index,howMany){for(var i=0;howMany>i;i++)this._releaseRange(this._ranges[index+i]);this._ranges.splice(index,howMany)},_retainRange:function(range){range.firstPromise||(range.firstPromise=this._getListBinding().fromIndex(range.firstIndex).retain()),range.lastPromise||(range.lastPromise=this._getListBinding().fromIndex(range.lastIndex).retain())},_retainRanges:function(){for(var i=0,len=this._ranges.length;len>i;i++)this._retainRange(this._ranges[i])},_releaseRange:function(range){range.firstPromise.release(),range.lastPromise.release()},_releaseRanges:function(ranges){for(var i=0,len=ranges.length;len>i;++i)this._releaseRange(ranges[i])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:_Base.Namespace._lazy(function(){var _SelectionManager=function(listView){this._listView=listView,this._selected=new exports._Selection(this._listView),this._pivot=_Constants._INVALID_INDEX,this._focused={type:_UI.ObjectType.item,index:0},this._pendingChange=Promise.wrap()};return _SelectionManager.prototype={count:function(){return this._selected.count()},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(items){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=new exports._Selection(that._listView);return newSelection.set(items).then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},clear:function(){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=new exports._Selection(that._listView);return newSelection.clear().then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},add:function(items){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=that._cloneSelection();return newSelection.add(items).then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},remove:function(items){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=that._cloneSelection();return newSelection.remove(items).then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},selectAll:function(){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=new exports._Selection(that._listView);return newSelection.selectAll().then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},_synchronize:function(signal){var that=this;return this._listView._versionManager.unlocked.then(function(){var currentPendingChange=that._pendingChange;return that._pendingChange=Promise.join([currentPendingChange,signal.promise]).then(function(){}),currentPendingChange})},_reset:function(){this._pivot=_Constants._INVALID_INDEX,this._setFocused({type:_UI.ObjectType.item,index:0},this._keyboardFocused()),this._pendingChange.cancel(),this._pendingChange=Promise.wrap(),this._selected.clear(),this._selected=new exports._Selection(this._listView)},_dispose:function(){this._selected.clear(),this._selected=null,this._listView=null},_set:function(newSelection){var that=this;return this._fireSelectionChanging(newSelection).then(function(approved){return approved?(that._selected.clear(),that._selected=newSelection,that._listView._updateSelection(),that._fireSelectionChanged()):newSelection.clear(),approved})},_fireSelectionChanging:function(newSelection){var eventObject=_Global.document.createEvent("CustomEvent"),newSelectionUpdated=Promise.wrap();eventObject.initCustomEvent("selectionchanging",!0,!0,{newSelection:newSelection,preventTapBehavior:function(){},setPromise:function(promise){newSelectionUpdated=promise}});var approved=this._listView._element.dispatchEvent(eventObject);return newSelectionUpdated.then(function(){return approved})},_fireSelectionChanged:function(){var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent("selectionchanged",!0,!1,null),this._listView._element.dispatchEvent(eventObject)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(entity,keyboardFocused){this._focused={type:entity.type,index:entity.index},this._focusedByKeyboard=keyboardFocused},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(count){this._selected._itemsCount=count},_isIncluded:function(index){return this._selected._isIncluded(index)},_cloneSelection:function(){var newSelection=new exports._Selection(this._listView);return newSelection._ranges=this._selected.getRanges(),newSelection._itemsCount=this._selected._itemsCount,newSelection._retainRanges(),newSelection}},_SelectionManager.supportedForProcessing=!1,_SelectionManager})})}),define("WinJS/Controls/ListView/_BrowseMode",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Animations","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_SelectionManager"],function(exports,_Global,_Base,_BaseUtils,Animations,Promise,_ElementUtilities,_UI,_Constants,_ItemEventsHandler,_SelectionManager){"use strict";var transformName=_BaseUtils._browserStyleEquivalents.transform.scriptName;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_SelectionMode:_Base.Namespace._lazy(function(){function clampToRange(first,last,x){return Math.max(first,Math.min(last,x))}function dispatchKeyboardNavigating(element,oldEntity,newEntity){var navigationEvent=_Global.document.createEvent("CustomEvent");return navigationEvent.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:oldEntity.index,oldFocusType:oldEntity.type,newFocus:newEntity.index,newFocusType:newEntity.type}),element.dispatchEvent(navigationEvent)}var _SelectionMode=_Base.Class.define(function(modeSite){this.inboundFocusHandled=!1,this._pressedContainer=null,this._pressedItemBox=null,this._pressedHeader=null,this._pressedEntity={type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},this._pressedPosition=null,this.initialize(modeSite)},{_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose(),this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(modeSite){function createArrowHandler(direction,clampToBounds){var handler=function(oldFocus){return modeSite._view.getAdjacent(oldFocus,direction)};return handler.clampToBounds=clampToBounds,handler}this.site=modeSite,this._keyboardNavigationHandlers={},this._keyboardAcceleratorHandlers={};var site=this.site,that=this;this._itemEventsHandler=new _ItemEventsHandler._ItemEventsHandler(Object.create({containerFromElement:function(element){return site._view.items.containerFrom(element)},indexForItemElement:function(element){return site._view.items.index(element)},indexForHeaderElement:function(element){return site._groups.index(element)},itemBoxAtIndex:function(index){return site._view.items.itemBoxAt(index)},itemAtIndex:function(index){return site._view.items.itemAt(index)},headerAtIndex:function(index){return site._groups.group(index).header},headerFromElement:function(element){return site._groups.headerFrom(element)},containerAtIndex:function(index){return site._view.items.containerAt(index)},isZombie:function(){return site._isZombie()},getItemPosition:function(entity){return site._getItemPosition(entity)},rtl:function(){return site._rtl()},fireInvokeEvent:function(entity,itemElement){return that._fireInvokeEvent(entity,itemElement)},verifySelectionAllowed:function(index){return that._verifySelectionAllowed(index)},changeFocus:function(newFocus,skipSelection,ctrlKeyDown,skipEnsureVisible,keyboardFocused){return site._changeFocus(newFocus,skipSelection,ctrlKeyDown,skipEnsureVisible,keyboardFocused)},selectRange:function(firstIndex,lastIndex,additive){return that._selectRange(firstIndex,lastIndex,additive)}},{pressedEntity:{enumerable:!0,get:function(){return that._pressedEntity},set:function(value){that._pressedEntity=value}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return that._pressedContainerScaleTransform},set:function(value){that._pressedContainerScaleTransform=value}},pressedContainer:{enumerable:!0,get:function(){return that._pressedContainer},set:function(value){that._pressedContainer=value}},pressedItemBox:{enumerable:!0,get:function(){return that._pressedItemBox},set:function(value){that._pressedItemBox=value}},pressedHeader:{enumerable:!0,get:function(){return that._pressedHeader},set:function(value){return that._pressedHeader=value}},pressedPosition:{enumerable:!0,get:function(){return that._pressedPosition},set:function(value){that._pressedPosition=value}},pressedElement:{enumerable:!0,set:function(value){that._pressedElement=value}},eventHandlerRoot:{enumerable:!0,get:function(){return site._viewport}},selectionMode:{enumerable:!0,get:function(){return site._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return _Constants._itemClass}},canvasProxy:{enumerable:!0,get:function(){return site._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return site._tap}},headerTapBehavior:{enumerable:!0,get:function(){return site._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return site.itemsDraggable||site.itemsReorderable}},selection:{enumerable:!0,get:function(){return site._selection}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));var Key=_ElementUtilities.Key;this._keyboardNavigationHandlers[Key.upArrow]=createArrowHandler(Key.upArrow),this._keyboardNavigationHandlers[Key.downArrow]=createArrowHandler(Key.downArrow),this._keyboardNavigationHandlers[Key.leftArrow]=createArrowHandler(Key.leftArrow),this._keyboardNavigationHandlers[Key.rightArrow]=createArrowHandler(Key.rightArrow),this._keyboardNavigationHandlers[Key.pageUp]=createArrowHandler(Key.pageUp,!0),this._keyboardNavigationHandlers[Key.pageDown]=createArrowHandler(Key.pageDown,!0),this._keyboardNavigationHandlers[Key.home]=function(oldFocus){return!that.site._header||oldFocus.type!==_UI.ObjectType.groupHeader&&oldFocus.type!==_UI.ObjectType.footer?Promise.wrap({type:oldFocus.type!==_UI.ObjectType.footer?oldFocus.type:_UI.ObjectType.groupHeader,index:0}):Promise.wrap({type:_UI.ObjectType.header,index:0})},this._keyboardNavigationHandlers[Key.end]=function(oldFocus){if(!that.site._footer||oldFocus.type!==_UI.ObjectType.groupHeader&&oldFocus.type!==_UI.ObjectType.header){if(oldFocus.type===_UI.ObjectType.groupHeader||oldFocus.type===_UI.ObjectType.header)return Promise.wrap({type:_UI.ObjectType.groupHeader,index:site._groups.length()-1});var lastIndex=that.site._view.lastItemIndex();return lastIndex>=0?Promise.wrap({type:oldFocus.type,index:lastIndex}):Promise.cancel}return Promise.wrap({type:_UI.ObjectType.footer,index:0})},this._keyboardAcceleratorHandlers[Key.a]=function(){that.site._multiSelection()&&that._selectAll()}},staticMode:function(){return this.site._tap===_UI.TapBehavior.none&&this.site._selectionMode===_UI.SelectionMode.none},itemUnrealized:function(index,itemBox){if(this._pressedEntity.type!==_UI.ObjectType.groupHeader&&(this._pressedEntity.index===index&&this._resetPointerDownState(),this._itemBeingDragged(index)))for(var i=this._draggedItemBoxes.length-1;i>=0;i--)this._draggedItemBoxes[i]===itemBox&&(_ElementUtilities.removeClass(itemBox,_Constants._dragSourceClass),this._draggedItemBoxes.splice(i,1))},_fireInvokeEvent:function(entity,itemElement){function fireInvokeEventImpl(dataSource,isHeader){var listBinding=dataSource.createListBinding(),promise=listBinding.fromIndex(entity.index),eventName=isHeader?"groupheaderinvoked":"iteminvoked";promise.done(function(){listBinding.release()});var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(eventName,!0,!0,isHeader?{groupHeaderPromise:promise,groupHeaderIndex:entity.index}:{itemPromise:promise,itemIndex:entity.index}),itemElement.dispatchEvent(eventObject)&&that.site._defaultInvoke(entity)}if(itemElement){var that=this;entity.type===_UI.ObjectType.groupHeader?this.site._groupHeaderTap===_UI.GroupHeaderTapBehavior.invoke&&entity.index!==_Constants._INVALID_INDEX&&fireInvokeEventImpl(this.site.groupDataSource,!0):this.site._tap===_UI.TapBehavior.none||entity.index===_Constants._INVALID_INDEX||this.site._isInSelectionMode()||fireInvokeEventImpl(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(entity){if(entity.type===_UI.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var itemIndex=entity.index,site=this.site,item=this.site._view.items.itemAt(itemIndex);if(!site._selectionAllowed()||!site._selectOnTap()||item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var selected=site._selection._isIncluded(itemIndex),single=!site._multiSelection(),newSelection=site._selection._cloneSelection();selected?single?newSelection.clear():newSelection.remove(itemIndex):single?newSelection.set(itemIndex):newSelection.add(itemIndex);var included,eventObject=_Global.document.createEvent("CustomEvent"),newSelectionUpdated=Promise.wrap(),completed=!1,preventTap=!1;eventObject.initCustomEvent("selectionchanging",!0,!0,{newSelection:newSelection,preventTapBehavior:function(){preventTap=!0},setPromise:function(promise){newSelectionUpdated=promise}});var defaultBehavior=site._element.dispatchEvent(eventObject);newSelectionUpdated.then(function(){completed=!0,included=newSelection._isIncluded(itemIndex),newSelection.clear()});var canSelect=defaultBehavior&&completed&&(selected||included);return{canSelect:canSelect,canTapSelect:canSelect&&!preventTap}},_containedInElementWithClass:function(element,className){if(element.parentNode)for(var matches=element.parentNode.querySelectorAll("."+className+", ."+className+" *"),i=0,len=matches.length;len>i;i++)if(matches[i]===element)return!0;return!1},_isDraggable:function(element){return!this._containedInElementWithClass(element,_Constants._nonDraggableClass)},_isInteractive:function(element){return this._containedInElementWithClass(element,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onPointerDown:function(eventObject){this._itemEventsHandler.onPointerDown(eventObject)},onclick:function(eventObject){this._itemEventsHandler.onClick(eventObject)},onPointerUp:function(eventObject){this._itemEventsHandler.onPointerUp(eventObject)},onPointerCancel:function(eventObject){this._itemEventsHandler.onPointerCancel(eventObject)},onLostPointerCapture:function(eventObject){this._itemEventsHandler.onLostPointerCapture(eventObject)},onContextMenu:function(eventObject){this._itemEventsHandler.onContextMenu(eventObject)},onMSHoldVisual:function(eventObject){this._itemEventsHandler.onMSHoldVisual(eventObject)},onDataChanged:function(eventObject){this._itemEventsHandler.onDataChanged(eventObject)},_removeTransform:function(element,transform){transform&&-1!==element.style[transformName].indexOf(transform)&&(element.style[transformName]=element.style[transformName].replace(transform,""))},_selectAll:function(){var unselectableRealizedItems=[];this.site._view.items.each(function(index,item){item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass)&&unselectableRealizedItems.push(index)}),this.site._selection.selectAll(),unselectableRealizedItems.length>0&&this.site._selection.remove(unselectableRealizedItems)},_selectRange:function(firstIndex,lastIndex,additive){for(var ranges=[],currentStartRange=-1,i=firstIndex;lastIndex>=i;i++){var item=this.site._view.items.itemAt(i);item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass)?-1!==currentStartRange&&(ranges.push({firstIndex:currentStartRange,lastIndex:i-1}),currentStartRange=-1):-1===currentStartRange&&(currentStartRange=i)}-1!==currentStartRange&&ranges.push({firstIndex:currentStartRange,lastIndex:lastIndex}),ranges.length>0&&this.site._selection[additive?"add":"set"](ranges)},onDragStart:function(eventObject){if(this._pressedEntity={type:_UI.ObjectType.item,index:this.site._view.items.index(eventObject.target)},this.site._selection._pivot=_Constants._INVALID_INDEX,this._pressedEntity.index===_Constants._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(eventObject.target)||this._pressedElement&&this._isInteractive(this._pressedElement))eventObject.preventDefault();else{this._dragging=!0,this._dragDataTransfer=eventObject.dataTransfer,this._pressedPosition=_ElementUtilities._getCursorPos(eventObject),this._dragInfo=null,this._lastEnteredElement=eventObject.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new _SelectionManager._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}]));var dropTarget=this.site.itemsReorderable,event=_Global.document.createEvent("CustomEvent");if(event.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:eventObject.dataTransfer,dragInfo:this._dragInfo}),eventObject.dataTransfer.setData("text",""),eventObject.dataTransfer.setDragImage){var pressedItemData=this.site._view.items.itemDataAt(this._pressedEntity.index);if(pressedItemData&&pressedItemData.container){var rect=pressedItemData.container.getBoundingClientRect();eventObject.dataTransfer.setDragImage(pressedItemData.container,eventObject.clientX-rect.left,eventObject.clientY-rect.top)}}this.site.element.dispatchEvent(event),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(eventObject.dataTransfer)&&(dropTarget=!0,this._dragUnderstood=!0)),dropTarget&&(this._addedDragOverClass=!0,_ElementUtilities.addClass(this.site._element,_Constants._dragOverClass)),this._draggedItemBoxes=[];var that=this,sourceElement=eventObject.target;sourceElement.addEventListener("dragend",function itemDragEnd(eventObject){sourceElement.removeEventListener("dragend",itemDragEnd),that.onDragEnd(eventObject)}),_BaseUtils._yieldForDomModification(function(){if(that._dragging)for(var indicesSelected=that._dragInfo.getIndices(),i=0,len=indicesSelected.length;len>i;i++){var itemData=that.site._view.items.itemDataAt(indicesSelected[i]);itemData&&itemData.itemBox&&that._addDragSourceClass(itemData.itemBox)}})}},onDragEnter:function(eventObject){var eventHandled=this._dragUnderstood;this._lastEnteredElement=eventObject.target,this._exitEventTimer&&(_Global.clearTimeout(this._exitEventTimer),this._exitEventTimer=0),this._firedDragEnter||this._fireDragEnterEvent(eventObject.dataTransfer)&&(eventHandled=!0),(eventHandled||this._dragging&&this.site.itemsReorderable)&&(eventObject.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,_ElementUtilities.addClass(this.site._element,_Constants._dragOverClass))),this._pointerLeftRegion=!1},onDragLeave:function(eventObject){eventObject.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo}),this.site.element.dispatchEvent(event)},_fireDragEnterEvent:function(dataTransfer){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:dataTransfer});var dropTarget=!this.site.element.dispatchEvent(event);return this._firedDragEnter=!0,dropTarget},_fireDragBetweenEvent:function(index,insertAfterIndex,dataTransfer){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent("itemdragbetween",!0,!0,{index:index,insertAfterIndex:insertAfterIndex,dataTransfer:dataTransfer}),this.site.element.dispatchEvent(event)},_fireDropEvent:function(index,insertAfterIndex,dataTransfer){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent("itemdragdrop",!0,!0,{index:index,insertAfterIndex:insertAfterIndex,dataTransfer:dataTransfer}),this.site.element.dispatchEvent(event)},_handleExitEvent:function(){this._exitEventTimer&&(_Global.clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var that=this;this._exitEventTimer=_Global.setTimeout(function(){if(!that.site._disposed&&that._pointerLeftRegion){if(that.site._layout.dragLeave&&that.site._layout.dragLeave(),that._pointerLeftRegion=!1,that._dragUnderstood=!1,that._lastEnteredElement=null,that._lastInsertPoint=null,that._dragBetweenDisabled=!1,that._firedDragEnter){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragleave",!0,!1,{}),that.site.element.dispatchEvent(event),that._firedDragEnter=!1}that._addedDragOverClass&&(that._addedDragOverClass=!1,_ElementUtilities.removeClass(that.site._element,_Constants._dragOverClass)),that._exitEventTimer=0,that._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(element,eventObject){var elementRect={left:0,top:0};try{elementRect=element.getBoundingClientRect()}catch(err){}var computedStyle=_ElementUtilities._getComputedStyle(element,null),paddingLeft=parseInt(computedStyle.paddingLeft),paddingTop=parseInt(computedStyle.paddingTop),borderLeft=parseInt(computedStyle.borderLeftWidth),borderTop=parseInt(computedStyle.borderTopWidth),clientX=eventObject.clientX,clientY=eventObject.clientY,position={x:+clientX===clientX?clientX-elementRect.left-paddingLeft-borderLeft:0,y:+clientY===clientY?clientY-elementRect.top-paddingTop-borderTop:0};return this.site._rtl()&&(position.x=elementRect.right-elementRect.left-position.x),position},_getPositionInCanvasSpace:function(eventObject){var scrollLeft=this.site._horizontal()?this.site.scrollPosition:0,scrollTop=this.site._horizontal()?0:this.site.scrollPosition,position=this._getEventPositionInElementSpace(this.site.element,eventObject);return{x:position.x+scrollLeft,y:position.y+scrollTop}},_itemBeingDragged:function(itemIndex){return this._dragging?this._draggingUnselectedItem&&this._dragInfo._isIncluded(itemIndex)||!this._draggingUnselectedItem&&this.site._isSelected(itemIndex):!1},_addDragSourceClass:function(itemBox){this._draggedItemBoxes.push(itemBox),_ElementUtilities.addClass(itemBox,_Constants._dragSourceClass),itemBox.parentNode&&_ElementUtilities.addClass(itemBox.parentNode,_Constants._footprintClass)},renderDragSourceOnRealizedItem:function(itemIndex,itemBox){this._itemBeingDragged(itemIndex)&&this._addDragSourceClass(itemBox)},onDragOver:function(eventObject){if(this._dragUnderstood){this._pointerLeftRegion=!1,eventObject.preventDefault();var cursorPositionInCanvas=this._getPositionInCanvasSpace(eventObject),cursorPositionInRoot=this._getEventPositionInElementSpace(this.site.element,eventObject);if(this._checkAutoScroll(cursorPositionInRoot.x,cursorPositionInRoot.y),this.site._layout.hitTest)if(this._autoScrollFrame)this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null);else{var insertPoint=this.site._view.hitTest(cursorPositionInCanvas.x,cursorPositionInCanvas.y);insertPoint.insertAfterIndex=clampToRange(-1,this.site._cachedCount-1,insertPoint.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===insertPoint.insertAfterIndex&&this._lastInsertPoint.index===insertPoint.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(insertPoint.index,insertPoint.insertAfterIndex,eventObject.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(cursorPositionInCanvas.x,cursorPositionInCanvas.y,this._dragInfo)),this._lastInsertPoint=insertPoint}}},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,_ElementUtilities.removeClass(this.site._element,_Constants._dragOverClass)),this._draggedItemBoxes){for(var i=0,len=this._draggedItemBoxes.length;len>i;i++)_ElementUtilities.removeClass(this._draggedItemBoxes[i],_Constants._dragSourceClass),this._draggedItemBoxes[i].parentNode&&_ElementUtilities.removeClass(this._draggedItemBoxes[i].parentNode,_Constants._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave(),this._dragging=!1,this._dragInfo=null,this._draggingUnselectedItem=!1,this._dragDataTransfer=null,this._lastInsertPoint=null,this._resetPointerDownState(),this._lastEnteredElement=null,this._dragBetweenDisabled=!1,this._firedDragEnter=!1,this._dragUnderstood=!1,this._stopAutoScroll()},onDragEnd:function(){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragend",!0,!1,{}),this.site.element.dispatchEvent(event),this._clearDragProperties()},_findFirstAvailableInsertPoint:function(selectedItems,startIndex,searchForwards){for(var indicesSelected=selectedItems.getIndices(),dropIndexInSelection=-1,count=this.site._cachedCount,selectionCount=indicesSelected.length,startIndexInSelection=-1,dropIndex=startIndex,i=0;selectionCount>i;i++)if(indicesSelected[i]===dropIndex){dropIndexInSelection=i,startIndexInSelection=i;break}for(;dropIndexInSelection>=0&&dropIndex>=0;)searchForwards?(dropIndex++,selectionCount>dropIndexInSelection&&indicesSelected[dropIndexInSelection+1]===dropIndex&&count>dropIndex?dropIndexInSelection++:dropIndex>=count?(searchForwards=!1,dropIndex=startIndex,dropIndexInSelection=startIndexInSelection):dropIndexInSelection=-1):(dropIndex--,dropIndexInSelection>0&&indicesSelected[dropIndexInSelection-1]===dropIndex?dropIndexInSelection--:dropIndexInSelection=-1);return dropIndex},_reorderItems:function(dropIndex,reorderedItems,reorderingUnselectedItem,useMoveBefore,ensureVisibleAtEnd){var site=this.site,updateSelection=function(items){reorderingUnselectedItem?site._selection.remove({key:items[0].key}):site._selection.set({firstKey:items[0].key,lastKey:items[items.length-1].key}),ensureVisibleAtEnd&&site.ensureVisible(site._selection._getFocused())};reorderedItems.getItems().then(function(items){var ds=site.itemDataSource;if(-1===dropIndex){ds.beginEdits();for(var i=items.length-1;i>=0;i--)ds.moveToStart(items[i].key);ds.endEdits(),updateSelection(items)}else{var listBinding=ds.createListBinding();listBinding.fromIndex(dropIndex).then(function(item){if(listBinding.release(),ds.beginEdits(),useMoveBefore)for(var i=0,len=items.length;len>i;i++)ds.moveBefore(items[i].key,item.key);else for(var i=items.length-1;i>=0;i--)ds.moveAfter(items[i].key,item.key);ds.endEdits(),updateSelection(items)})}})},onDrop:function(eventObject){if(this._draggedItemBoxes)for(var i=0,len=this._draggedItemBoxes.length;len>i;i++)this._draggedItemBoxes[i].parentNode&&_ElementUtilities.removeClass(this._draggedItemBoxes[i].parentNode,_Constants._footprintClass);if(!this._dragBetweenDisabled){var cursorPosition=this._getPositionInCanvasSpace(eventObject),dropLocation=this.site._view.hitTest(cursorPosition.x,cursorPosition.y),dropIndex=clampToRange(-1,this.site._cachedCount-1,dropLocation.insertAfterIndex),allowDrop=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===dropIndex&&this._lastInsertPoint.index===dropLocation.index||(allowDrop=this._fireDragBetweenEvent(dropLocation.index,dropIndex,eventObject.dataTransfer)),allowDrop&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(dropLocation.index,dropIndex,eventObject.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;dropIndex=this._findFirstAvailableInsertPoint(this._dragInfo,dropIndex,!1),this._reorderItems(dropIndex,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties(),eventObject.preventDefault()},_checkAutoScroll:function(x,y){var viewportSize=this.site._getViewportLength(),horizontal=this.site._horizontal(),cursorPositionInViewport=horizontal?x:y,canvasSize=this.site._viewport[horizontal?"scrollWidth":"scrollHeight"],scrollPosition=Math.floor(this.site.scrollPosition),travelRate=0;if(cursorPositionInViewport<_Constants._AUTOSCROLL_THRESHOLD?travelRate=cursorPositionInViewport-_Constants._AUTOSCROLL_THRESHOLD:cursorPositionInViewport>viewportSize-_Constants._AUTOSCROLL_THRESHOLD&&(travelRate=cursorPositionInViewport-(viewportSize-_Constants._AUTOSCROLL_THRESHOLD)),travelRate=Math.round(travelRate/_Constants._AUTOSCROLL_THRESHOLD*(_Constants._MAX_AUTOSCROLL_RATE-_Constants._MIN_AUTOSCROLL_RATE)),(0===scrollPosition&&0>travelRate||scrollPosition>=canvasSize-viewportSize&&travelRate>0)&&(travelRate=0),0===travelRate)this._autoScrollDelay&&(_Global.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);else if(!this._autoScrollDelay&&!this._autoScrollFrame){var that=this;this._autoScrollDelay=_Global.setTimeout(function(){if(that._autoScrollRate){that._lastDragTimeout=_BaseUtils._now();var nextFrame=function(){if(!that._autoScrollRate&&that._autoScrollFrame||that.site._disposed)that._stopAutoScroll();else{var currentTime=_BaseUtils._now(),delta=that._autoScrollRate*((currentTime-that._lastDragTimeout)/1e3);delta=0>delta?Math.min(-1,delta):Math.max(1,delta);var newScrollPos={};newScrollPos[that.site._scrollProperty]=that.site._viewportScrollPosition+delta,_ElementUtilities.setScrollPosition(that.site._viewport,newScrollPos),that._lastDragTimeout=currentTime,that._autoScrollFrame=_BaseUtils._requestAnimationFrame(nextFrame)}};that._autoScrollFrame=_BaseUtils._requestAnimationFrame(nextFrame)}},_Constants._AUTOSCROLL_DELAY)}this._autoScrollRate=travelRate},_stopAutoScroll:function(){this._autoScrollDelay&&(_Global.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0),this._autoScrollRate=0,this._autoScrollFrame=0},onKeyDown:function(eventObject){function setNewFocus(newEntity,skipSelection,clampToBounds){function setNewFocusImpl(maxIndex){var moveView=!0,invalidIndex=!1;if(clampToBounds?newEntity.index=Math.max(0,Math.min(maxIndex,newEntity.index)):(newEntity.index<0||newEntity.index>maxIndex)&&(invalidIndex=!0),!invalidIndex&&(oldEntity.index!==newEntity.index||oldEntity.type!==newEntity.type)){var changeFocus=dispatchKeyboardNavigating(site._element,oldEntity,newEntity);changeFocus&&(moveView=!1,that._setNewFocusItemOffsetPromise&&that._setNewFocusItemOffsetPromise.cancel(),site._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){return that._setNewFocusItemOffsetPromise=site._getItemOffset(oldEntity,!0).then(function(range){range=site._convertFromCanvasCoordinates(range);var oldItemOffscreen=range.end<=site.scrollPosition||range.begin>=site.scrollPosition+site._getViewportLength()-1;return that._setNewFocusItemOffsetPromise=site._getItemOffset(newEntity).then(function(range){that._setNewFocusItemOffsetPromise=null;var retVal={position:site.scrollPosition,direction:"right"};return oldItemOffscreen&&(site._selection._setFocused(newEntity,!0),range=site._convertFromCanvasCoordinates(range),newEntity.index>oldEntity.index?(retVal.direction="right",retVal.position=range.end-site._getViewportLength()):(retVal.direction="left",
retVal.position=range.begin)),site._changeFocus(newEntity,skipSelection,ctrlKeyDown,oldItemOffscreen,!0),oldItemOffscreen?retVal:Promise.cancel},function(error){return site._changeFocus(newEntity,skipSelection,ctrlKeyDown,!0,!0),Promise.wrapError(error)}),that._setNewFocusItemOffsetPromise},function(error){return site._changeFocus(newEntity,skipSelection,ctrlKeyDown,!0,!0),Promise.wrapError(error)}),that._setNewFocusItemOffsetPromise},!0))}return moveView&&(site._selection._setFocused(oldEntity,!0),site.ensureVisible(oldEntity)),invalidIndex?{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX}:newEntity}return newEntity.type===_UI.ObjectType.item?Promise.wrap(view.lastItemIndex()).then(setNewFocusImpl):newEntity.type===_UI.ObjectType.groupHeader?Promise.wrap(site._groups.length()-1).then(setNewFocusImpl):Promise.wrap(0).then(setNewFocusImpl)}var that=this,site=this.site,view=site._view,oldEntity=site._selection._getFocused(),handled=!0,ctrlKeyDown=eventObject.ctrlKey,Key=_ElementUtilities.Key,keyCode=eventObject.keyCode,rtl=site._rtl();if(!this._isInteractive(eventObject.target)){if(eventObject.ctrlKey&&!eventObject.altKey&&!eventObject.shiftKey&&this._keyboardAcceleratorHandlers[keyCode]&&this._keyboardAcceleratorHandlers[keyCode](),site.itemsReorderable&&!eventObject.ctrlKey&&eventObject.altKey&&eventObject.shiftKey&&oldEntity.type===_UI.ObjectType.item&&(keyCode===Key.leftArrow||keyCode===Key.rightArrow||keyCode===Key.upArrow||keyCode===Key.downArrow)){var selection=site._selection,focusedIndex=oldEntity.index,movingUnselectedItem=!1,processReorder=!0;if(!selection.isEverything()){if(!selection._isIncluded(focusedIndex)){var item=site._view.items.itemAt(focusedIndex);item&&_ElementUtilities.hasClass(item,_Constants._nonDraggableClass)?processReorder=!1:(movingUnselectedItem=!0,selection=new _SelectionManager._Selection(this.site,[{firstIndex:focusedIndex,lastIndex:focusedIndex}]))}if(processReorder){var dropIndex=focusedIndex;keyCode===Key.rightArrow?dropIndex+=rtl?-1:1:keyCode===Key.leftArrow?dropIndex+=rtl?1:-1:keyCode===Key.upArrow?dropIndex--:dropIndex++;var movingAhead=dropIndex>focusedIndex,searchForward=movingAhead;movingAhead&&dropIndex>=this.site._cachedCount&&(searchForward=!1,dropIndex=this.site._cachedCount-1),dropIndex=this._findFirstAvailableInsertPoint(selection,dropIndex,searchForward),dropIndex=Math.min(Math.max(-1,dropIndex),this.site._cachedCount-1);var reportedInsertAfterIndex=dropIndex-(movingAhead||-1===dropIndex?0:1),reportedIndex=dropIndex,groupsEnabled=this.site._groupsEnabled();if(groupsEnabled){var groups=this.site._groups,groupIndex=dropIndex>-1?groups.groupFromItem(dropIndex):0;movingAhead?groups.group(groupIndex).startIndex===dropIndex&&reportedInsertAfterIndex--:groupIndex<groups.length()-1&&dropIndex===groups.group(groupIndex+1).startIndex-1&&reportedInsertAfterIndex++}if(this._fireDragBetweenEvent(reportedIndex,reportedInsertAfterIndex,null)&&this._fireDropEvent(reportedIndex,reportedInsertAfterIndex,null)){if(groupsEnabled)return;this._reorderItems(dropIndex,selection,movingUnselectedItem,!movingAhead,!0)}}}}else if(eventObject.altKey)handled=!1;else if(this._keyboardNavigationHandlers[keyCode])this._keyboardNavigationHandlers[keyCode](oldEntity).then(function(newEntity){if(newEntity.index!==oldEntity.index||newEntity.type!==oldEntity.type){var clampToBounds=that._keyboardNavigationHandlers[keyCode].clampToBounds;newEntity.type!==_UI.ObjectType.groupHeader&&eventObject.shiftKey&&site._selectionAllowed()&&site._multiSelection()?(site._selection._pivot===_Constants._INVALID_INDEX&&(site._selection._pivot=oldEntity.index),setNewFocus(newEntity,!0,clampToBounds).then(function(newEntity){if(newEntity.index!==_Constants._INVALID_INDEX){var firstIndex=Math.min(newEntity.index,site._selection._pivot),lastIndex=Math.max(newEntity.index,site._selection._pivot),additive=eventObject.ctrlKey||site._tap===_UI.TapBehavior.toggleSelect;that._selectRange(firstIndex,lastIndex,additive)}})):(site._selection._pivot=_Constants._INVALID_INDEX,setNewFocus(newEntity,!1,clampToBounds))}else handled=!1});else if(eventObject.ctrlKey||keyCode!==Key.enter)oldEntity.type!==_UI.ObjectType.groupHeader&&(eventObject.ctrlKey&&keyCode===Key.enter||keyCode===Key.space)?(this._itemEventsHandler.toggleSelectionIfAllowed(oldEntity.index),site._changeFocus(oldEntity,!0,ctrlKeyDown,!1,!0)):keyCode===Key.escape&&site._selection.count()>0?(site._selection._pivot=_Constants._INVALID_INDEX,site._selection.clear()):handled=!1;else{var element=oldEntity.type===_UI.ObjectType.groupHeader?site._groups.group(oldEntity.index).header:site._view.items.itemBoxAt(oldEntity.index);if(element){oldEntity.type===_UI.ObjectType.groupHeader?(this._pressedHeader=element,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=element,this._pressedContainer=site._view.items.containerAt(oldEntity.index),this._pressedHeader=null);var allowed=this._verifySelectionAllowed(oldEntity);allowed.canTapSelect&&this._itemEventsHandler.handleTap(oldEntity),this._fireInvokeEvent(oldEntity,element)}}this._keyDownHandled=handled,handled&&(eventObject.stopPropagation(),eventObject.preventDefault())}keyCode===Key.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(eventObject){this._keyDownHandled&&(eventObject.stopPropagation(),eventObject.preventDefault())},onTabEntered:function(eventObject){if(0!==this.site._groups.length()||this.site._hasHeaderOrFooter){var site=this.site,focused=site._selection._getFocused(),forward=eventObject.detail,inboundFocus=!site._hasKeyboardFocus||eventObject.target===site._viewport;if(inboundFocus)if(this.inboundFocusHandled=!0,focused.index=focused.index===_Constants._INVALID_INDEX?0:focused.index,forward||!this.site._supportsGroupHeaderKeyboarding&&!this.site._hasHeaderOrFooter){var entity={type:_UI.ObjectType.item};focused.type===_UI.ObjectType.groupHeader?(entity.index=site._groupFocusCache.getIndexForGroup(focused.index),dispatchKeyboardNavigating(site._element,focused,entity)?site._changeFocus(entity,!0,!1,!1,!0):site._changeFocus(focused,!0,!1,!1,!0)):(entity.index=focused.type!==_UI.ObjectType.item?site._groupFocusCache.getLastFocusedItemIndex():focused.index,site._changeFocus(entity,!0,!1,!1,!0)),eventObject.preventDefault()}else{var entity={type:_UI.ObjectType.groupHeader};this.site._hasHeaderOrFooter?this.site._lastFocusedElementInGroupTrack.type===_UI.ObjectType.groupHeader&&this.site._supportsGroupHeaderKeyboarding?(entity.index=site._groups.groupFromItem(focused.index),dispatchKeyboardNavigating(site._element,focused,entity)?site._changeFocus(entity,!0,!1,!1,!0):site._changeFocus(focused,!0,!1,!1,!0)):(entity.type=this.site._lastFocusedElementInGroupTrack.type,entity.index=0,site._changeFocus(entity,!0,!1,!1,!0)):focused.type!==_UI.ObjectType.groupHeader&&this.site._supportsGroupHeaderKeyboarding?(entity.index=site._groups.groupFromItem(focused.index),dispatchKeyboardNavigating(site._element,focused,entity)?site._changeFocus(entity,!0,!1,!1,!0):site._changeFocus(focused,!0,!1,!1,!0)):(entity.index=focused.index,site._changeFocus(entity,!0,!1,!1,!0)),eventObject.preventDefault()}}},onTabExiting:function(eventObject){if(this.site._hasHeaderOrFooter||this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var site=this.site,focused=site._selection._getFocused(),forward=eventObject.detail;if(forward){var entity=null;if(focused.type===_UI.ObjectType.item){var lastType=this.site._lastFocusedElementInGroupTrack.type;if(lastType!==_UI.ObjectType.header&&lastType!==_UI.ObjectType.footer&&this.site._supportsGroupHeaderKeyboarding)var entity={type:_UI.ObjectType.groupHeader,index:site._groups.groupFromItem(focused.index)};else var entity={type:lastType===_UI.ObjectType.item?_UI.ObjectType.header:lastType,index:0}}entity&&dispatchKeyboardNavigating(site._element,focused,entity)&&(site._changeFocus(entity,!0,!1,!1,!0),eventObject.preventDefault())}else if(!forward&&focused.type!==_UI.ObjectType.item){var targetIndex=0;targetIndex=focused.type===_UI.ObjectType.groupHeader?site._groupFocusCache.getIndexForGroup(focused.index):focused.type===_UI.ObjectType.header?0:site._view.lastItemIndex();var entity={type:_UI.ObjectType.item,index:targetIndex};dispatchKeyboardNavigating(site._element,focused,entity)&&(site._changeFocus(entity,!0,!1,!1,!0),eventObject.preventDefault())}}}});return _SelectionMode})})}),define("WinJS/Controls/ListView/_ErrorMessages",["exports","../../Core/_Base","../../Core/_Resources"],function(exports,_Base,_Resources){"use strict";_Base.Namespace._moduleDefine(exports,null,{modeIsInvalid:{get:function(){return"Invalid argument: mode must be one of following values: 'none', 'single' or 'multi'."}},loadingBehaviorIsDeprecated:{get:function(){return"Invalid configuration: loadingBehavior is deprecated. The control will default this property to 'randomAccess'. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoad is deprecated. The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadThresholdIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoadThreshold is deprecated.  The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},automaticallyLoadPagesIsDeprecated:{get:function(){return"Invalid configuration: automaticallyLoadPages is deprecated. The control will default this property to false. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},invalidTemplate:{get:function(){return"Invalid template: Templates must be created before being passed to the ListView, and must contain a valid tree of elements."}},loadMorePagesIsDeprecated:{get:function(){return"loadMorePages is deprecated. Invoking this function will not have any effect. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},disableBackdropIsDeprecated:{get:function(){return"Invalid configuration: disableBackdrop is deprecated. Style: .win-listview .win-container.win-backdrop { background-color:transparent; } instead."}},backdropColorIsDeprecated:{get:function(){return"Invalid configuration: backdropColor is deprecated. Style: .win-listview .win-container.win-backdrop { rgba(155,155,155,0.23); } instead."}},itemInfoIsDeprecated:{get:function(){return"GridLayout.itemInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},groupInfoIsDeprecated:{get:function(){return"GridLayout.groupInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},resetItemIsDeprecated:{get:function(){return"resetItem may be altered or unavailable in future versions. Instead, mark the element as disposable using WinJS.Utilities.markDisposable."}},resetGroupHeaderIsDeprecated:{get:function(){return"resetGroupHeader may be altered or unavailable in future versions. Instead, mark the header element as disposable using WinJS.Utilities.markDisposable."}},maxRowsIsDeprecated:{get:function(){return"GridLayout.maxRows may be altered or unavailable in future versions. Instead, use the maximumRowsOrColumns property."}},swipeOrientationDeprecated:{get:function(){return"Invalid configuration: swipeOrientation is deprecated. The control will default this property to 'none'"}},swipeBehaviorDeprecated:{get:function(){return"Invalid configuration: swipeBehavior is deprecated. The control will default this property to 'none'"}}})}),define("WinJS/Controls/ListView/_GroupFocusCache",["exports","../../Core/_Base"],function(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_GroupFocusCache:_Base.Namespace._lazy(function(){return _Base.Class.define(function(listView){this._listView=listView,this.clear()},{updateCache:function(groupKey,itemKey,itemIndex){this._lastFocusedItemKey=itemKey,this._lastFocusedItemIndex=itemIndex,itemIndex=""+itemIndex,this._itemToIndex[itemKey]=itemIndex,this._groupToItem[groupKey]=itemKey},deleteItem:function(itemKey){if(itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemKey=null,this._lastFocusedItemIndex=0),this._itemToIndex[itemKey])for(var that=this,keys=Object.keys(this._groupToItem),i=0,len=keys.length;len>i;i++){var key=keys[i];if(that._groupToItem[key]===itemKey){that.deleteGroup(key);break}}},deleteGroup:function(groupKey){var itemKey=this._groupToItem[groupKey];itemKey&&delete this._itemToIndex[itemKey],delete this._groupToItem[groupKey]},updateItemIndex:function(itemKey,itemIndex){itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemIndex=itemIndex),this._itemToIndex[itemKey]&&(this._itemToIndex[itemKey]=""+itemIndex)},getIndexForGroup:function(groupIndex){var groupKey=this._listView._groups.group(groupIndex).key,itemKey=this._groupToItem[groupKey];return itemKey&&this._itemToIndex[itemKey]?+this._itemToIndex[itemKey]:this._listView._groups.fromKey(groupKey).group.startIndex},clear:function(){this._groupToItem={},this._itemToIndex={},this._lastFocusedItemIndex=0,this._lastFocusedItemKey=null},getLastFocusedItemIndex:function(){return this._lastFocusedItemIndex}})}),_UnsupportedGroupFocusCache:_Base.Namespace._lazy(function(){return _Base.Class.define(null,{updateCache:function(groupKey,itemKey,itemIndex){this._lastFocusedItemKey=itemKey,this._lastFocusedItemIndex=itemIndex},deleteItem:function(itemKey){itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemKey=null,this._lastFocusedItemIndex=0)},deleteGroup:function(){},updateItemIndex:function(itemKey,itemIndex){itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemIndex=itemIndex)},getIndexForGroup:function(){return 0},clear:function(){this._lastFocusedItemIndex=0,this._lastFocusedItemKey=null},getLastFocusedItemIndex:function(){return this._lastFocusedItemIndex}})})})}),define("WinJS/Controls/ListView/_GroupsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_ItemsManager","../../Utilities/_UI","../ItemContainer/_Constants"],function(exports,_Base,Promise,_Dispose,_ElementUtilities,_ItemsManager,_UI,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_GroupsContainerBase:_Base.Namespace._lazy(function(){return _Base.Class.define(function(){},{index:function(element){var header=this.headerFrom(element);if(header)for(var i=0,len=this.groups.length;len>i;i++)if(header===this.groups[i].header)return i;return _Constants._INVALID_INDEX},headerFrom:function(element){for(;element&&!_ElementUtilities.hasClass(element,_Constants._headerClass);)element=element.parentNode;return element},requestHeader:function(index){this._waitingHeaderRequests=this._waitingHeaderRequests||{},this._waitingHeaderRequests[index]||(this._waitingHeaderRequests[index]=[]);var that=this;return new Promise(function(complete){var group=that.groups[index];group&&group.header?complete(group.header):that._waitingHeaderRequests[index].push(complete)})},notify:function(index,header){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[index]){for(var requests=this._waitingHeaderRequests[index],i=0,len=requests.length;len>i;i++)requests[i](header);this._waitingHeaderRequests[index]=[]}},groupFromImpl:function(fromGroup,toGroup,comp){if(fromGroup>toGroup)return null;var center=fromGroup+Math.floor((toGroup-fromGroup)/2),centerGroup=this.groups[center];return comp(centerGroup,center)?this.groupFromImpl(fromGroup,center-1,comp):toGroup>center&&!comp(this.groups[center+1],center+1)?this.groupFromImpl(center+1,toGroup,comp):center},groupFrom:function(comp){if(this.groups.length>0){var lastGroupIndex=this.groups.length-1,lastGroup=this.groups[lastGroupIndex];return comp(lastGroup,lastGroupIndex)?this.groupFromImpl(0,this.groups.length-1,comp):lastGroupIndex}return null},groupFromItem:function(itemIndex){return this.groupFrom(function(group){return itemIndex<group.startIndex})},groupFromOffset:function(offset){return this.groupFrom(function(group){return offset<group.offset})},group:function(index){return this.groups[index]},length:function(){return this.groups.length},cleanUp:function(){if(this.listBinding){for(var i=0,len=this.groups.length;len>i;i++){var group=this.groups[i];group.userData&&this.listBinding.releaseItem(group.userData)}this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var that=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return Promise.join(that.pendingChanges)}).then(function(){return that._listView._ifZombieDispose()?Promise.cancel:void 0}).then(function(){that.ignoreChanges=!1},function(error){return that.ignoreChanges=!1,Promise.wrapError(error)})},fromKey:function(key){for(var i=0,len=this.groups.length;len>i;i++){var group=this.groups[i];if(group.key===key)return{group:group,index:i}}return null},fromHandle:function(handle){for(var i=0,len=this.groups.length;len>i;i++){var group=this.groups[i];if(group.handle===handle)return{group:group,index:i}}return null}})}),_UnvirtualizedGroupsContainer:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._GroupsContainerBase,function(listView,groupDataSource){this._listView=listView,this.groupDataSource=groupDataSource,this.groups=[],this.pendingChanges=[],this.dirty=!0;var that=this,notificationHandler={beginNotifications:function(){that._listView._versionManager.beginNotifications()},endNotifications:function(){that._listView._versionManager.endNotifications(),that._listView._ifZombieDispose()||!that.ignoreChanges&&that._listView._groupsChanged&&that._listView._scheduleUpdate()},indexChanged:function(){that._listView._versionManager.receivedNotification(),that._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(newCount){that._listView._versionManager.receivedNotification(),that._listView._writeProfilerMark("groupCountChanged("+newCount+"),info"),that._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(newItem){if(that._listView._versionManager.receivedNotification(),!that._listView._ifZombieDispose()){var groupEntry=that.fromKey(newItem.key);groupEntry&&(that._listView._writeProfilerMark("groupChanged("+groupEntry.index+"),info"),groupEntry.group.userData=newItem,groupEntry.group.startIndex=newItem.firstItemIndexHint,this.markToRemove(groupEntry.group)),this.scheduleUpdate()}},removed:function(itemHandle){if(that._listView._versionManager.receivedNotification(),that._listView._groupRemoved(itemHandle),!that._listView._ifZombieDispose()){var groupEntry=that.fromHandle(itemHandle);if(groupEntry){that._listView._writeProfilerMark("groupRemoved("+groupEntry.index+"),info"),that.groups.splice(groupEntry.index,1);var index=that.groups.indexOf(groupEntry.group,groupEntry.index);index>-1&&that.groups.splice(index,1),this.markToRemove(groupEntry.group)}this.scheduleUpdate()}},inserted:function(itemPromise,previousHandle,nextHandle){if(that._listView._versionManager.receivedNotification(),!that._listView._ifZombieDispose()){that._listView._writeProfilerMark("groupInserted,info");var notificationHandler=this;itemPromise.retain().then(function(item){var index;if(index=previousHandle||nextHandle||that.groups.length?notificationHandler.findIndex(previousHandle,nextHandle):0,-1!==index){var newGroup={key:item.key,startIndex:item.firstItemIndexHint,userData:item,handle:itemPromise.handle};that.groups.splice(index,0,newGroup)}notificationHandler.scheduleUpdate()}),that.pendingChanges.push(itemPromise)}},moved:function(itemPromise,previousHandle,nextHandle){if(that._listView._versionManager.receivedNotification(),!that._listView._ifZombieDispose()){that._listView._writeProfilerMark("groupMoved,info");var notificationHandler=this;itemPromise.then(function(item){var newIndex=notificationHandler.findIndex(previousHandle,nextHandle),groupEntry=that.fromKey(item.key);if(groupEntry)that.groups.splice(groupEntry.index,1),-1!==newIndex&&(groupEntry.index<newIndex&&newIndex--,groupEntry.group.key=item.key,groupEntry.group.userData=item,groupEntry.group.startIndex=item.firstItemIndexHint,that.groups.splice(newIndex,0,groupEntry.group));else if(-1!==newIndex){var newGroup={key:item.key,startIndex:item.firstItemIndexHint,userData:item,handle:itemPromise.handle};that.groups.splice(newIndex,0,newGroup),itemPromise.retain()}notificationHandler.scheduleUpdate()}),that.pendingChanges.push(itemPromise)}},reload:function(){that._listView._versionManager.receivedNotification(),that._listView._ifZombieDispose()||that._listView._processReload()},markToRemove:function(group){if(group.header){var header=group.header;group.header=null,group.left=-1,group.width=-1,group.decorator=null,group.tabIndex=-1,header.tabIndex=-1,that._listView._groupsToRemove[_ElementUtilities._uniqueID(header)]={group:group,header:header}}},scheduleUpdate:function(){that.dirty=!0,that.ignoreChanges||(that._listView._groupsChanged=!0)},findIndex:function(previousHandle,nextHandle){var groupEntry,index=-1;return previousHandle&&(groupEntry=that.fromHandle(previousHandle),groupEntry&&(index=groupEntry.index+1)),-1===index&&nextHandle&&(groupEntry=that.fromHandle(nextHandle),groupEntry&&(index=groupEntry.index)),index},removeElements:function(group){if(group.header){var parentNode=group.header.parentNode;parentNode&&(_Dispose.disposeSubTree(group.header),parentNode.removeChild(group.header)),group.header=null,group.left=-1,group.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(notificationHandler)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel(),this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var that=this;return this.initializePromise=this.groupDataSource.getCount().then(function(count){for(var promises=[],i=0;count>i;i++)promises.push(that.listBinding.fromIndex(i).retain());return Promise.join(promises)}).then(function(groups){that.groups=[];for(var i=0,len=groups.length;len>i;i++){var group=groups[i];that.groups.push({key:group.key,startIndex:group.firstItemIndexHint,handle:group.handle,userData:group})}that._listView._writeProfilerMark("GroupsContainer_initialize groups("+groups.length+"),info"),that._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(error){return that._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),Promise.wrapError(error)}),this.initializePromise},renderGroup:function(index){if(this._listView.groupHeaderTemplate){var group=this.groups[index];return Promise.wrap(this._listView._groupHeaderRenderer(Promise.wrap(group.userData))).then(_ItemsManager._normalizeRendererReturn)}return Promise.wrap(null)},setDomElement:function(index,headerElement){this.groups[index].header=headerElement,this.notify(index,headerElement)},removeElements:function(){for(var elements=this._listView._groupsToRemove||{},keys=Object.keys(elements),focusedItemPurged=!1,focused=this._listView._selection._getFocused(),i=0,len=keys.length;len>i;i++){var group=elements[keys[i]],header=group.header,groupData=group.group;if(focusedItemPurged||focused.type!==_UI.ObjectType.groupHeader||groupData.userData.index!==focused.index||(this._listView._unsetFocusOnItem(),focusedItemPurged=!0),header){var parentNode=header.parentNode;parentNode&&(_Dispose._disposeElement(header),parentNode.removeChild(header))}}focusedItemPurged&&this._listView._setFocusOnItem(focused),this._listView._groupsToRemove={}},resetGroups:function(){for(var groups=this.groups.slice(0),i=0,len=groups.length;len>i;i++){var group=groups[i];this.listBinding&&group.userData&&this.listBinding.releaseItem(group.userData)}this.groups.length=0,this.dirty=!0}})}),_NoGroups:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._GroupsContainerBase,function(listView){this._listView=listView,this.groups=[{startIndex:0}],this.dirty=!0},{synchronizeGroups:function(){return Promise.wrap()},addItem:function(){return Promise.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}],delete this.pinnedItem,delete this.pinnedOffset,this.dirty=!0},renderGroup:function(){return Promise.wrap(null)},ensureFirstGroup:function(){return Promise.wrap(this.groups[0])},groupOf:function(){return Promise.wrap(this.groups[0])},removeElements:function(){}})})})}),define("WinJS/Controls/ListView/_Helpers",["exports","../../Core/_Base","../ItemContainer/_Constants"],function(exports,_Base,_Constants){"use strict";function nodeListToArray(nodeList){return Array.prototype.slice.call(nodeList)}function repeat(strings,count){if("string"==typeof strings)return repeat([strings],count);var result=new Array(Math.floor(count/strings.length)+1).join(strings.join(""));return result+=strings.slice(0,count%strings.length).join("")}function stripedContainers(count,nextItemIndex){var containersMarkup,evenStripe=_Constants._containerEvenClass,oddStripe=_Constants._containerOddClass,stripes=nextItemIndex%2===0?[evenStripe,oddStripe]:[oddStripe,evenStripe],pairOfContainers=["<div class='win-container "+stripes[0]+" win-backdrop'></div>","<div class='win-container "+stripes[1]+" win-backdrop'></div>"];return containersMarkup=repeat(pairOfContainers,count)}_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_nodeListToArray:nodeListToArray,_repeat:repeat,_stripedContainers:stripedContainers})}),define("WinJS/Controls/ListView/_ItemsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_ElementUtilities","../ItemContainer/_Constants"],function(exports,_Base,Promise,_ElementUtilities,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ItemsContainer:_Base.Namespace._lazy(function(){var _ItemsContainer=function(site){this.site=site,this._itemData={},this.waitingItemRequests={}};return _ItemsContainer.prototype={requestItem:function(itemIndex){this.waitingItemRequests[itemIndex]||(this.waitingItemRequests[itemIndex]=[]);var that=this,promise=new Promise(function(complete){var itemData=that._itemData[itemIndex];itemData&&!itemData.detached&&itemData.element?complete(itemData.element):that.waitingItemRequests[itemIndex].push(complete)});return promise},removeItem:function(index){delete this._itemData[index]},removeItems:function(){this._itemData={},this.waitingItemRequests={}},setItemAt:function(itemIndex,itemData){this._itemData[itemIndex]=itemData,itemData.detached||this.notify(itemIndex,itemData)},notify:function(itemIndex,itemData){if(this.waitingItemRequests[itemIndex]){for(var requests=this.waitingItemRequests[itemIndex],i=0;i<requests.length;i++)requests[i](itemData.element);this.waitingItemRequests[itemIndex]=[]}},elementAvailable:function(itemIndex){var itemData=this._itemData[itemIndex];itemData.detached=!1,this.notify(itemIndex,itemData)},itemAt:function(itemIndex){var itemData=this._itemData[itemIndex];return itemData?itemData.element:null},itemDataAt:function(itemIndex){return this._itemData[itemIndex]},containerAt:function(itemIndex){var itemData=this._itemData[itemIndex];return itemData?itemData.container:null},itemBoxAt:function(itemIndex){var itemData=this._itemData[itemIndex];return itemData?itemData.itemBox:null},itemBoxFrom:function(element){for(;element&&!_ElementUtilities.hasClass(element,_Constants._itemBoxClass);)element=element.parentNode;return element},containerFrom:function(element){for(;element&&!_ElementUtilities.hasClass(element,_Constants._containerClass);)element=element.parentNode;return element},index:function(element){var item=this.containerFrom(element);if(item)for(var index in this._itemData)if(this._itemData[index].container===item)return parseInt(index,10);return _Constants._INVALID_INDEX},each:function(callback){for(var index in this._itemData)if(this._itemData.hasOwnProperty(index)){var itemData=this._itemData[index];callback(parseInt(index,10),itemData.element,itemData)}},eachIndex:function(callback){for(var index in this._itemData)if(callback(parseInt(index,10)))break},count:function(){return Object.keys(this._itemData).length}},_ItemsContainer})})}),define("WinJS/Controls/ListView/_Layouts",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations/_TransitionAnimation","../../Promise","../../Scheduler","../../_Signal","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","./_ErrorMessages"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,_WriteProfilerMark,_TransitionAnimation,Promise,Scheduler,_Signal,_Dispose,_ElementUtilities,_SafeHtml,_UI,_Constants,_ErrorMessages){"use strict";function uniqueCssClassName(prefix){return"_win-dynamic-"+prefix+"-"+nextCssClassId++}function flushDynamicCssRules(){var i,j,ruleSuffix,rules=layoutStyleElem.sheet.cssRules,classCount=staleClassNames.length;for(i=0;classCount>i;i++)for(ruleSuffix="."+staleClassNames[i]+" ",j=rules.length-1;j>=0;j--)-1!==rules[j].selectorText.indexOf(ruleSuffix)&&layoutStyleElem.sheet.deleteRule(j);staleClassNames=[]}function addDynamicCssRule(uniqueToken,site,selector,body){flushDynamicCssRules();var rule="."+_Constants._listViewClass+" ."+uniqueToken+" "+selector+" { "+body+"}",perfId="_addDynamicCssRule:"+uniqueToken+",info";site?site._writeProfilerMark(perfId):_WriteProfilerMark("WinJS.UI.ListView:Layout"+perfId),layoutStyleElem.sheet.insertRule(rule,0)}function deleteDynamicCssRule(uniqueToken){staleClassNames.push(uniqueToken)}function clampToRange(first,last,x){return Math.max(first,Math.min(last,x))}function getDimension(element,property){return _ElementUtilities.convertToPixels(element,_ElementUtilities._getComputedStyle(element,null)[property])}function getOuter(side,element){return getDimension(element,"margin"+side)+getDimension(element,"border"+side+"Width")+getDimension(element,"padding"+side)}function getOuterHeight(element){return getOuter("Top",element)+getOuter("Bottom",element)}function getOuterWidth(element){return getOuter("Left",element)+getOuter("Right",element)}function forEachContainer(itemsContainer,callback){if(itemsContainer.items)for(var i=0,len=itemsContainer.items.length;len>i;i++)callback(itemsContainer.items[i],i);else for(var b=0,index=0;b<itemsContainer.itemsBlocks.length;b++)for(var block=itemsContainer.itemsBlocks[b],i=0,len=block.items.length;len>i;i++)callback(block.items[i],index++)}function containerFromIndex(itemsContainer,index){if(0>index)return null;if(itemsContainer.items)return index<itemsContainer.items.length?itemsContainer.items[index]:null;var blockSize=itemsContainer.itemsBlocks[0].items.length,blockIndex=Math.floor(index/blockSize),offset=index%blockSize;return blockIndex<itemsContainer.itemsBlocks.length&&offset<itemsContainer.itemsBlocks[blockIndex].items.length?itemsContainer.itemsBlocks[blockIndex].items[offset]:null}function getItemsContainerTree(itemsContainer,tree){for(var itemsContainerTree,i=0,treeLength=tree.length;treeLength>i;i++)if(tree[i].itemsContainer.element===itemsContainer){itemsContainerTree=tree[i].itemsContainer;break}return itemsContainerTree}function getItemsContainerLength(itemsContainer){var blocksCount,itemsCount;return itemsContainer.itemsBlocks?(blocksCount=itemsContainer.itemsBlocks.length,itemsCount=blocksCount>0?itemsContainer.itemsBlocks[0].items.length*(blocksCount-1)+itemsContainer.itemsBlocks[blocksCount-1].items.length:0):itemsCount=itemsContainer.items.length,itemsCount}function getEnvironmentSupportInformation(site){if(!environmentDetails){var surface=_Global.document.createElement("div");surface.style.width="500px",surface.style.visibility="hidden";var flexRoot=_Global.document.createElement("div");
flexRoot.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",_SafeHtml.setInnerHTMLUnsafe(flexRoot,"<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div></div>"),surface.appendChild(flexRoot),site.viewport.insertBefore(surface,site.viewport.firstChild);var canMeasure=surface.offsetWidth>0,expectedWidth=200;canMeasure&&(environmentDetails={supportsCSSGrid:!!("-ms-grid-row"in _Global.document.documentElement.style),nestedFlexTooLarge:flexRoot.firstElementChild.offsetWidth>expectedWidth,nestedFlexTooSmall:flexRoot.firstElementChild.offsetWidth<expectedWidth}),site.readyToMeasure(),site.viewport.removeChild(surface)}return environmentDetails}function normalizeLayoutPromises(retVal){return Promise.is(retVal)?{realizedRangeComplete:retVal,layoutComplete:retVal}:"object"==typeof retVal&&retVal&&retVal.layoutComplete?retVal:{realizedRangeComplete:Promise.wrap(),layoutComplete:Promise.wrap()}}function getMargins(element){return{left:getDimension(element,"marginLeft"),right:getDimension(element,"marginRight"),top:getDimension(element,"marginTop"),bottom:getDimension(element,"marginBottom")}}var Key=_ElementUtilities.Key,uniqueID=_ElementUtilities._uniqueID,strings={get itemInfoIsInvalid(){return"Invalid argument: An itemInfo function must be provided which returns an object with numeric width and height properties."},get groupInfoResultIsInvalid(){return"Invalid result: groupInfo result for cell spanning groups must include the following numeric properties: cellWidth and cellHeight."}},layoutStyleElem=_Global.document.createElement("style");_Global.document.head.appendChild(layoutStyleElem);var nextCssClassId=0,staleClassNames=[],browserStyleEquivalents=_BaseUtils._browserStyleEquivalents,transformNames=browserStyleEquivalents.transform,transitionScriptName=_BaseUtils._browserStyleEquivalents.transition.scriptName,dragBetweenTransition=transformNames.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",dragBetweenDistance=12,environmentDetails=null;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Layout:_Base.Class.define(function(){}),_LayoutCommon:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(position){this._groupHeaderPosition=position,this._invalidateLayout()}},initialize:function(site,groupsEnabled){site._writeProfilerMark("Layout:initialize,info"),this._inListMode||_ElementUtilities.addClass(site.surface,_Constants._gridLayoutClass),this._backdropColorClassName&&_ElementUtilities.addClass(site.surface,this._backdropColorClassName),this._disableBackdropClassName&&_ElementUtilities.addClass(site.surface,this._disableBackdropClassName),this._groups=[],this._groupMap={},this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._site=site,this._groupsEnabled=groupsEnabled,this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(orientation){this._orientation=orientation,this._horizontal="horizontal"===orientation,this._invalidateLayout()}},uninitialize:function(){function cleanGroups(groups){var i,len=groups.length;for(i=0;len>i;i++)groups[i].cleanUp(!0)}var perfId="Layout:uninitialize,info";this._elementsToMeasure={},this._site?(this._site._writeProfilerMark(perfId),_ElementUtilities.removeClass(this._site.surface,_Constants._gridLayoutClass),_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionTopClass),_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionLeftClass),_ElementUtilities.removeClass(this._site.surface,_Constants._structuralNodesClass),_ElementUtilities.removeClass(this._site.surface,_Constants._singleItemsBlockClass),_ElementUtilities.removeClass(this._site.surface,_Constants._noCSSGrid),this._site.surface.style.cssText="",this._groups&&(cleanGroups(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._envInfo=null,this._backdropColorClassName&&(_ElementUtilities.removeClass(this._site.surface,this._backdropColorClassName),deleteDynamicCssRule(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(_ElementUtilities.removeClass(this._site.surface,this._disableBackdropClassName),deleteDynamicCssRule(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):_WriteProfilerMark("WinJS.UI.ListView:"+perfId)},numberOfItemsPerItemsBlock:{get:function(){function allGroupsAreUniform(){var i,groupCount=that._site.groupCount;for(i=0;groupCount>i;i++)if(that._isCellSpanning(i))return!1;return!0}var that=this;return that._measureItem(0).then(function(){return that._sizes.viewportContentSize!==that._getViewportCrossSize()&&that._viewportSizeChanged(that._getViewportCrossSize()),allGroupsAreUniform()?that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?(that._usingStructuralNodes=!0,Number.MAX_VALUE):(that._usingStructuralNodes=exports._LayoutCommon._barsPerItemsBlock>0,exports._LayoutCommon._barsPerItemsBlock*that._itemsPerBar):(that._usingStructuralNodes=!1,null)})}},layout:function(tree,changedRange,modifiedItems,modifiedGroups){function copyItemsContainerTree(itemsContainer){function copyItems(itemsContainer){if(that._usingStructuralNodes){var items=[];return itemsContainer.itemsBlocks.forEach(function(itemsBlock){items=items.concat(itemsBlock.items.slice(0))}),items}return itemsContainer.items.slice(0)}return{element:itemsContainer.element,items:copyItems(itemsContainer)}}function updateGroups(){function createGroup(groupInfo,itemsContainer){var GroupType=groupInfo.enableCellSpanning?Groups.CellSpanningGroup:Groups.UniformGroup;return new GroupType(that,itemsContainer)}var i,oldRealizedItemRange=that._groups.length>0?that._getRealizationRange():null,newGroups=[],prepared=[],cleanUpDom={},newGroupMap={},currentIndex=0,len=tree.length;for(i=0;len>i;i++){var oldChangedRealizedRangeInGroup=null,groupInfo=that._getGroupInfo(i),groupKey=that._site.groupFromIndex(i).key,oldGroup=that._groupMap[groupKey],wasCellSpanning=oldGroup instanceof Groups.CellSpanningGroup,isCellSpanning=groupInfo.enableCellSpanning;if(oldGroup)if(wasCellSpanning!==isCellSpanning)cleanUpDom[groupKey]=!0;else{var firstChangedIndexInGroup=Math.max(0,changedRange.firstIndex-oldGroup.startIndex),oldRealizedItemRangeInGroup=that._rangeForGroup(oldGroup,oldRealizedItemRange);oldRealizedItemRangeInGroup&&firstChangedIndexInGroup<=oldRealizedItemRangeInGroup.lastIndex&&(oldChangedRealizedRangeInGroup={firstIndex:Math.max(firstChangedIndexInGroup,oldRealizedItemRangeInGroup.firstIndex),lastIndex:oldRealizedItemRangeInGroup.lastIndex})}var prepareLayoutPromise,group=createGroup(groupInfo,tree[i].itemsContainer.element);prepareLayoutPromise=group.prepareLayoutWithCopyOfTree?group.prepareLayoutWithCopyOfTree(copyItemsContainerTree(tree[i].itemsContainer),oldChangedRealizedRangeInGroup,oldGroup,{groupInfo:groupInfo,startIndex:currentIndex}):group.prepareLayout(getItemsContainerLength(tree[i].itemsContainer),oldChangedRealizedRangeInGroup,oldGroup,{groupInfo:groupInfo,startIndex:currentIndex}),prepared.push(prepareLayoutPromise),currentIndex+=group.count,newGroups.push(group),newGroupMap[groupKey]=group}return Promise.join(prepared).then(function(){for(var currentOffset=0,i=0,len=newGroups.length;len>i;i++){var group=newGroups[i];group.offset=currentOffset,currentOffset+=that._getGroupSize(group)}Object.keys(that._groupMap).forEach(function(deletedKey){var skipDomCleanUp=!cleanUpDom[deletedKey];that._groupMap[deletedKey].cleanUp(skipDomCleanUp)}),that._groups=newGroups,that._groupMap=newGroupMap})}function layoutGroupContent(groupIndex,realizedItemRange,doRealizedRange){var beforeRealizedRange,group=that._groups[groupIndex],firstChangedIndexInGroup=Math.max(0,changedRange.firstIndex-group.startIndex),realizedItemRangeInGroup=that._rangeForGroup(group,realizedItemRange);return doRealizedRange?void group.layoutRealizedRange(firstChangedIndexInGroup,realizedItemRangeInGroup):(realizedItemRangeInGroup||(beforeRealizedRange=group.startIndex+group.count-1<realizedItemRange.firstIndex),group.layoutUnrealizedRange(firstChangedIndexInGroup,realizedItemRangeInGroup,beforeRealizedRange))}function layoutRealizedRange(){if(0!==that._groups.length){var i,realizedItemRange=that._getRealizationRange(),len=tree.length,firstChangedGroup=site.groupIndexFromItemIndex(changedRange.firstIndex);for(i=firstChangedGroup;len>i;i++)layoutGroupContent(i,realizedItemRange,!0),that._layoutGroup(i)}}function layoutUnrealizedRange(){if(0===that._groups.length)return Promise.wrap();var realizedItemRange=that._getRealizationRange(),lastGroupBefore=site.groupIndexFromItemIndex(realizedItemRange.firstIndex-1),firstGroupAfter=site.groupIndexFromItemIndex(realizedItemRange.lastIndex+1),firstChangedGroup=site.groupIndexFromItemIndex(changedRange.firstIndex),layoutPromises=[],groupCount=that._groups.length,stop=!1,before=lastGroupBefore,after=Math.max(firstChangedGroup,firstGroupAfter);for(after=Math.max(before+1,after);!stop;)stop=!0,before>=firstChangedGroup&&(layoutPromises.push(layoutGroupContent(before,realizedItemRange,!1)),stop=!1,before--),groupCount>after&&(layoutPromises.push(layoutGroupContent(after,realizedItemRange,!1)),stop=!1,after++);return Promise.join(layoutPromises)}var realizedRangePromise,that=this,site=that._site,layoutPerfId="Layout.layout",realizedRangePerfId=layoutPerfId+":realizedRange";return that._site._writeProfilerMark(layoutPerfId+",StartTM"),that._site._writeProfilerMark(realizedRangePerfId+",StartTM"),realizedRangePromise=that._measureItem(0).then(function(){return _ElementUtilities[that._usingStructuralNodes?"addClass":"removeClass"](that._site.surface,_Constants._structuralNodesClass),_ElementUtilities[that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?"addClass":"removeClass"](that._site.surface,_Constants._singleItemsBlockClass),that._sizes.viewportContentSize!==that._getViewportCrossSize()&&that._viewportSizeChanged(that._getViewportCrossSize()),that._cacheRemovedElements(modifiedItems,that._cachedItemRecords,that._cachedInsertedItemRecords,that._cachedRemovedItems,!1),that._cacheRemovedElements(modifiedGroups,that._cachedHeaderRecords,that._cachedInsertedHeaderRecords,that._cachedRemovedHeaders,!0),updateGroups()}).then(function(){that._syncDomWithGroupHeaderPosition(tree);var surfaceLength=0;if(that._groups.length>0){var lastGroup=that._groups[that._groups.length-1];surfaceLength=lastGroup.offset+that._getGroupSize(lastGroup)}that._horizontal?(that._groupsEnabled&&that._groupHeaderPosition===HeaderPosition.left?site.surface.style.cssText+=";height:"+that._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+that._sizes.headerContainerWidth+"px auto)["+tree.length+"]":site.surface.style.height=that._sizes.surfaceContentSize+"px",(that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall)&&(site.surface.style.width=surfaceLength+"px")):(that._groupsEnabled&&that._groupHeaderPosition===HeaderPosition.top?site.surface.style.cssText+=";width:"+that._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+that._sizes.headerContainerHeight+"px auto)["+tree.length+"]":site.surface.style.width=that._sizes.surfaceContentSize+"px",(that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall)&&(site.surface.style.height=surfaceLength+"px")),layoutRealizedRange(),that._layoutAnimations(modifiedItems,modifiedGroups),that._site._writeProfilerMark(realizedRangePerfId+":complete,info"),that._site._writeProfilerMark(realizedRangePerfId+",StopTM")},function(error){return that._site._writeProfilerMark(realizedRangePerfId+":canceled,info"),that._site._writeProfilerMark(realizedRangePerfId+",StopTM"),Promise.wrapError(error)}),that._layoutPromise=realizedRangePromise.then(function(){return layoutUnrealizedRange().then(function(){that._site._writeProfilerMark(layoutPerfId+":complete,info"),that._site._writeProfilerMark(layoutPerfId+",StopTM")},function(error){return that._site._writeProfilerMark(layoutPerfId+":canceled,info"),that._site._writeProfilerMark(layoutPerfId+",StopTM"),Promise.wrapError(error)})}),{realizedRangeComplete:realizedRangePromise,layoutComplete:that._layoutPromise}},itemsFromRange:function(firstPixel,lastPixel){return this._rangeContainsItems(firstPixel,lastPixel)?{firstIndex:this._firstItemFromRange(firstPixel),lastIndex:this._lastItemFromRange(lastPixel)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(currentItem,pressedKey){function handleArrowKeys(){var currentItemInGroup={type:currentItem.type,index:currentItem.index-group.startIndex},newItem=group.getAdjacent(currentItemInGroup,adjustedKey);if("boundary"===newItem){var prevGroup=that._groups[groupIndex-1],nextGroup=that._groups[groupIndex+1],lastGroupIndex=that._groups.length-1;if(adjustedKey===Key.leftArrow){if(0===groupIndex)return currentItem;if(prevGroup instanceof Groups.UniformGroup&&group instanceof Groups.UniformGroup){var coordinates=that._indexToCoordinate(currentItemInGroup.index),currentSlot=that._horizontal?coordinates.row:coordinates.column,indexOfLastBar=Math.floor((prevGroup.count-1)/that._itemsPerBar),startOfLastBar=indexOfLastBar*that._itemsPerBar;return{type:_UI.ObjectType.item,index:prevGroup.startIndex+Math.min(prevGroup.count-1,startOfLastBar+currentSlot)}}return{type:_UI.ObjectType.item,index:group.startIndex-1}}if(adjustedKey===Key.rightArrow){if(groupIndex===lastGroupIndex)return currentItem;if(group instanceof Groups.UniformGroup&&nextGroup instanceof Groups.UniformGroup){var coordinates=that._indexToCoordinate(currentItemInGroup.index),currentSlot=that._horizontal?coordinates.row:coordinates.column;return{type:_UI.ObjectType.item,index:nextGroup.startIndex+Math.min(nextGroup.count-1,currentSlot)}}return{type:_UI.ObjectType.item,index:nextGroup.startIndex}}return currentItem}return newItem.index+=group.startIndex,newItem}var that=this,groupIndex=that._site.groupIndexFromItemIndex(currentItem.index),group=that._groups[groupIndex],adjustedKey=that._adjustedKeyForOrientationAndBars(that._adjustedKeyForRTL(pressedKey),group instanceof Groups.CellSpanningGroup);if(currentItem.type||(currentItem.type=_UI.ObjectType.item),currentItem.type===_UI.ObjectType.item||pressedKey!==Key.pageUp&&pressedKey!==Key.pageDown){if(currentItem.type===_UI.ObjectType.header&&adjustedKey===Key.rightArrow)return{type:that._groupsEnabled?_UI.ObjectType.groupHeader:_UI.ObjectType.footer,index:0};if(currentItem.type===_UI.ObjectType.footer&&adjustedKey===Key.leftArrow)return{type:that._groupsEnabled?_UI.ObjectType.groupHeader:_UI.ObjectType.header,index:0};if(currentItem.type===_UI.ObjectType.groupHeader){if(adjustedKey===Key.leftArrow){var desiredIndex=currentItem.index-1;return desiredIndex=that._site.header?desiredIndex:Math.max(0,desiredIndex),{type:desiredIndex>-1?_UI.ObjectType.groupHeader:_UI.ObjectType.header,index:desiredIndex>-1?desiredIndex:0}}if(adjustedKey===Key.rightArrow){var desiredIndex=currentItem.index+1;return desiredIndex=that._site.header?desiredIndex:Math.min(that._groups.length-1,currentItem.index+1),{type:desiredIndex>=that._groups.length?_UI.ObjectType.header:_UI.ObjectType.groupHeader,index:desiredIndex>=that._groups.length?0:desiredIndex}}return currentItem}}else{var itemIndex=0;itemIndex=currentItem.type===_UI.ObjectType.groupHeader?that._groups[currentItem.index].startIndex:currentItem.type===_UI.ObjectType.header?0:that._groups[that._groups.length-1].count-1,currentItem={type:_UI.ObjectType.item,index:itemIndex}}switch(that._adjustedKeyForRTL(pressedKey)){case Key.upArrow:case Key.leftArrow:case Key.downArrow:case Key.rightArrow:return handleArrowKeys();default:return exports._LayoutCommon.prototype._getAdjacentForPageKeys.call(that,currentItem,pressedKey)}},hitTest:function(x,y){var result,sizes=this._sizes;x-=sizes.layoutOriginX,y-=sizes.layoutOriginY;var groupIndex=this._groupFromOffset(this._horizontal?x:y),group=this._groups[groupIndex];return this._horizontal?x-=group.offset:y-=group.offset,this._groupsEnabled&&(this._groupHeaderPosition===HeaderPosition.left?x-=sizes.headerContainerWidth:y-=sizes.headerContainerHeight),result=group.hitTest(x,y),result.index+=group.startIndex,result.insertAfterIndex+=group.startIndex,result},setupAnimations:function(){if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var realizationRange=this._getRealizationRange(),tree=this._site.tree,itemIndex=0,horizontal="horizontal"===this.orientation,i=0,treeLength=tree.length;treeLength>i;i++){var groupBundle=tree[i],groupHasAtleastOneItemRealized=!1,group=this._groups[i],groupIsCellSpanning=group instanceof Groups.CellSpanningGroup,groupOffset=group?group.offset:0;if(forEachContainer(groupBundle.itemsContainer,function(container,j){if(realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex&&(groupHasAtleastOneItemRealized=!0,!this._cachedItemRecords[itemIndex])){var itemPosition=this._getItemPositionForAnimations(itemIndex,i,j),row=itemPosition.row,column=itemPosition.column,left=itemPosition.left,top=itemPosition.top;this._cachedItemRecords[itemIndex]={oldRow:row,oldColumn:column,oldLeft:left,oldTop:top,width:itemPosition.width,height:itemPosition.height,element:container,inCellSpanningGroup:groupIsCellSpanning}}itemIndex++}.bind(this)),groupHasAtleastOneItemRealized){var groupIndex=i;if(!this._cachedHeaderRecords[groupIndex]){var headerPosition=this._getHeaderPositionForAnimations(groupIndex);this._cachedHeaderRecords[groupIndex]={oldLeft:headerPosition.left,oldTop:headerPosition.top,width:headerPosition.width,height:headerPosition.height,element:groupBundle.header}}this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)]||(this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)]={oldLeft:horizontal?groupOffset:0,left:horizontal?groupOffset:0,oldTop:horizontal?0:groupOffset,top:horizontal?0:groupOffset,element:groupBundle.itemsContainer.element})}}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(modifiedItems,modifiedGroups){if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM"),this._updateAnimationCache(modifiedItems,modifiedGroups);for(var realizationRange=this._getRealizationRange(),tree=this._site.tree,itemIndex=0,horizontal="horizontal"===this.orientation,i=0,treeLength=tree.length;treeLength>i;i++){var groupBundle=tree[i],group=this._groups[i],groupIsCellSpanning=group instanceof Groups.CellSpanningGroup,groupOffset=group?group.offset:0,groupMovementX=0,groupMovementY=0,cachedGroupRecord=this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)];cachedGroupRecord&&(horizontal?groupMovementX=cachedGroupRecord.oldLeft-groupOffset:groupMovementY=cachedGroupRecord.oldTop-groupOffset),forEachContainer(groupBundle.itemsContainer,function(container,j){if(realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex){var cachedItemRecord=this._cachedItemRecords[itemIndex];if(cachedItemRecord){var itemPosition=this._getItemPositionForAnimations(itemIndex,i,j),row=itemPosition.row,column=itemPosition.column,left=itemPosition.left,top=itemPosition.top;if(cachedItemRecord.inCellSpanningGroup=cachedItemRecord.inCellSpanningGroup||groupIsCellSpanning,cachedItemRecord.oldRow!==row||cachedItemRecord.oldColumn!==column||cachedItemRecord.oldTop!==top||cachedItemRecord.oldLeft!==left){cachedItemRecord.row=row,cachedItemRecord.column=column,cachedItemRecord.left=left,cachedItemRecord.top=top;var xOffset=cachedItemRecord.oldLeft-cachedItemRecord.left-groupMovementX,yOffset=cachedItemRecord.oldTop-cachedItemRecord.top-groupMovementY;if(xOffset=(this._site.rtl?-1:1)*xOffset,cachedItemRecord.xOffset=xOffset,cachedItemRecord.yOffset=yOffset,0!==xOffset||0!==yOffset){var element=cachedItemRecord.element;cachedItemRecord.needsToResetTransform=!0,element.style[transitionScriptName]="",element.style[transformNames.scriptName]="translate("+xOffset+"px,"+yOffset+"px)"}var itemsBlock=container.parentNode;_ElementUtilities.hasClass(itemsBlock,_Constants._itemsBlockClass)&&(this._animatingItemsBlocks[uniqueID(itemsBlock)]=itemsBlock)}}else this._cachedInsertedItemRecords[itemIndex]=container,container.style[transitionScriptName]="",container.style.opacity=0}itemIndex++}.bind(this));var groupIndex=i,cachedHeader=this._cachedHeaderRecords[groupIndex];if(cachedHeader){var headerPosition=this._getHeaderPositionForAnimations(groupIndex);if(cachedHeader.height=headerPosition.height,cachedHeader.width=headerPosition.width,cachedHeader.oldLeft!==headerPosition.left||cachedHeader.oldTop!==headerPosition.top){cachedHeader.left=headerPosition.left,cachedHeader.top=headerPosition.top;var xOffset=cachedHeader.oldLeft-cachedHeader.left,yOffset=cachedHeader.oldTop-cachedHeader.top;if(xOffset=(this._site.rtl?-1:1)*xOffset,0!==xOffset||0!==yOffset){cachedHeader.needsToResetTransform=!0;var headerContainer=cachedHeader.element;headerContainer.style[transitionScriptName]="",headerContainer.style[transformNames.scriptName]="translate("+xOffset+"px,"+yOffset+"px)"}}}if(cachedGroupRecord&&(horizontal&&cachedGroupRecord.left!==groupOffset||!horizontal&&cachedGroupRecord.top!==groupOffset)){var element=cachedGroupRecord.element;if(0===groupMovementX&&0===groupMovementY)cachedGroupRecord.needsToResetTransform&&(cachedGroupRecord.needsToResetTransform=!1,element.style[transformNames.scriptName]="");else{var groupOffsetX=(this._site.rtl?-1:1)*groupMovementX,groupOffsetY=groupMovementY;cachedGroupRecord.needsToResetTransform=!0,element.style[transitionScriptName]="",element.style[transformNames.scriptName]="translate("+groupOffsetX+"px, "+groupOffsetY+"px)"}}}if(this._inListMode||1===this._itemsPerBar)for(var itemsBlockKeys=Object.keys(this._animatingItemsBlocks),b=0,blockKeys=itemsBlockKeys.length;blockKeys>b;b++)this._animatingItemsBlocks[itemsBlockKeys[b]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function startAnimations(){if(removePhase(),hasMultisizeMove)cellSpanningFadeOutMove();else{if(that._itemsPerBar>1)for(var maxDistance=that._itemsPerBar*that._sizes.containerCrossSize+that._getHeaderSizeContentAdjustment()+that._sizes.containerMargins[horizontal?"top":site.rtl?"right":"left"]+(horizontal?that._sizes.layoutOriginY:that._sizes.layoutOriginX),i=0,len=itemMoveRecords.length;len>i;i++){var cachedItemRecord=itemMoveRecords[i];cachedItemRecord[oldReflowLayoutProperty]>cachedItemRecord[reflowLayoutProperty]?(upOutDist=Math.max(upOutDist,cachedItemRecord[oldReflowLayoutPosition]+cachedItemRecord[horizontal?"height":"width"]),upInDist=Math.max(upInDist,maxDistance-cachedItemRecord[reflowLayoutPosition]),hasReflow=!0,reflowItemRecords.push(cachedItemRecord)):cachedItemRecord[oldReflowLayoutProperty]<cachedItemRecord[reflowLayoutProperty]&&(downOutDist=Math.max(downOutDist,maxDistance-cachedItemRecord[oldReflowLayoutPosition]),downInDist=Math.max(downInDist,cachedItemRecord[reflowLayoutPosition]+cachedItemRecord[horizontal?"height":"width"]),reflowItemRecords.push(cachedItemRecord),hasReflow=!0)}site.rtl&&!horizontal&&(upOutDist*=-1,upInDist*=-1,downOutDist*=-1,downInDist*=-1),hasReflow?reflowPhase(that._itemsPerBar):directMovePhase()}}function waitForNextPhase(nextPhaseCallback){currentAnimationPromise=Promise.join(pendingTransitionPromises),currentAnimationPromise.done(function(){pendingTransitionPromises=[],animationSignal&&(exports.Layout._debugAnimations?_BaseUtils._requestAnimationFrame(function(){nextPhaseCallback()}):nextPhaseCallback())})}function removePhase(){if(removedElements.length){site._writeProfilerMark("Animation:setupRemoveAnimation,StartTM"),moveDelay+=60,addDelay+=60;var removeDuration=120;slowAnimations&&(removeDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(removedElements,[{property:"opacity",delay:removeDelay,duration:removeDuration,timing:"linear",to:0,skipStylesReset:!0}])),site._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function cellSpanningFadeOutMove(){site._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var moveElements=[],i=0,len=itemMoveRecords.length;len>i;i++){var cachedItemRecord=itemMoveRecords[i],container=cachedItemRecord.element;moveElements.push(container)}for(var i=0,len=moveRecords.length;len>i;i++){var cachedItemRecord=moveRecords[i],container=cachedItemRecord.element;moveElements.push(container)}var fadeOutDuration=120;slowAnimations&&(fadeOutDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(moveElements,{property:"opacity",delay:removeDelay,duration:fadeOutDuration,timing:"linear",to:0})),waitForNextPhase(cellSpanningFadeInMove),site._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function cellSpanningFadeInMove(){site._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM"),addDelay=0;for(var moveElements=[],i=0,len=itemMoveRecords.length;len>i;i++){var cachedItemRecord=itemMoveRecords[i],container=cachedItemRecord.element;container.style[transformNames.scriptName]="",moveElements.push(container)}for(var i=0,len=moveRecords.length;len>i;i++){var cachedItemRecord=moveRecords[i],container=cachedItemRecord.element;container.style[transformNames.scriptName]="",moveElements.push(container)}var fadeInDuration=120;slowAnimations&&(fadeInDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(moveElements,{property:"opacity",delay:addDelay,duration:fadeInDuration,timing:"linear",to:1})),site._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM"),addPhase()}function reflowPhase(itemsPerBar){site._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var itemContainersLastBarIndices={},i=0,len=reflowItemRecords.length;len>i;i++){var reflowItemRecord=reflowItemRecords[i],xOffset=reflowItemRecord.xOffset,yOffset=reflowItemRecord.yOffset;reflowItemRecord[oldReflowLayoutProperty]>reflowItemRecord[reflowLayoutProperty]?horizontal?yOffset-=upOutDist:xOffset-=upOutDist:reflowItemRecord[oldReflowLayoutProperty]<reflowItemRecord[reflowLayoutProperty]&&(horizontal?yOffset+=downOutDist:xOffset+=downOutDist);var container=reflowItemRecord.element;minOffset=Math.min(minOffset,horizontal?xOffset:yOffset),maxOffset=Math.max(maxOffset,horizontal?xOffset:yOffset);var itemsContainer=container.parentNode;_ElementUtilities.hasClass(itemsContainer,"win-itemscontainer")||(itemsContainer=itemsContainer.parentNode);var lastBarIndex=itemContainersLastBarIndices[uniqueID(itemsContainer)];if(!lastBarIndex){var count=getItemsContainerLength(getItemsContainerTree(itemsContainer,site.tree));itemContainersLastBarIndices[uniqueID(itemsContainer)]=lastBarIndex=Math.ceil(count/itemsPerBar)-1}reflowItemRecords[i][horizontal?"column":"row"]===lastBarIndex&&(itemContainersToExpand[uniqueID(itemsContainer)]=itemsContainer);var reflowDuration=80;slowAnimations&&(reflowDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(container,{property:transformNames.cssName,delay:moveDelay,duration:reflowDuration,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+xOffset+"px,"+yOffset+"px)"}))}for(var itemContainerKeys=Object.keys(itemContainersToExpand),i=0,len=itemContainerKeys.length;len>i;i++){var itemContainer=itemContainersToExpand[itemContainerKeys[i]];site.rtl&&horizontal?(itemContainer.style.paddingLeft=-1*minOffset+"px",itemContainer.style.marginLeft=minOffset+"px"):(itemContainer.style[horizontal?"paddingRight":"paddingBottom"]=maxOffset+"px",itemContainer.style[horizontal?"marginRight":"marginBottom"]="-"+maxOffset+"px")}for(var itemsBlockKeys=Object.keys(animatingItemsBlocks),i=0,len=itemsBlockKeys.length;len>i;i++)animatingItemsBlocks[itemsBlockKeys[i]].classList.add(_Constants._clipClass);waitForNextPhase(afterReflowPhase),site._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function cleanupItemsContainers(){for(var itemContainerKeys=Object.keys(itemContainersToExpand),i=0,len=itemContainerKeys.length;len>i;i++){var itemContainer=itemContainersToExpand[itemContainerKeys[i]];site.rtl&&horizontal?(itemContainer.style.paddingLeft="",itemContainer.style.marginLeft=""):(itemContainer.style[horizontal?"paddingRight":"paddingBottom"]="",itemContainer.style[horizontal?"marginRight":"marginBottom"]="")}itemContainersToExpand={};for(var itemsBlockKeys=Object.keys(animatingItemsBlocks),i=0,len=itemsBlockKeys.length;len>i;i++){var itemsBlock=animatingItemsBlocks[itemsBlockKeys[i]];itemsBlock.style.overflow="",itemsBlock.classList.remove(_Constants._clipClass)}}function afterReflowPhase(){site._writeProfilerMark("Animation:prepareReflowedItems,StartTM");for(var i=0,len=reflowItemRecords.length;len>i;i++){var reflowItemRecord=reflowItemRecords[i],xOffset=0,yOffset=0;reflowItemRecord[oldReflowLayoutProperty]>reflowItemRecord[reflowLayoutProperty]?horizontal?yOffset=upInDist:xOffset=upInDist:reflowItemRecord[oldReflowLayoutProperty]<reflowItemRecord[reflowLayoutProperty]&&(horizontal?yOffset=-1*downInDist:xOffset=-1*downInDist),reflowItemRecord.element.style[transitionScriptName]="",reflowItemRecord.element.style[transformNames.scriptName]="translate("+xOffset+"px,"+yOffset+"px)"}site._writeProfilerMark("Animation:prepareReflowedItems,StopTM"),exports.Layout._debugAnimations?_BaseUtils._requestAnimationFrame(function(){directMovePhase(!0)}):directMovePhase(!0)}function directMovePhase(fastMode){var duration=200;if(fastMode&&(duration=150,moveDelay=0,addDelay=0),slowAnimations&&(duration*=10),itemMoveRecords.length>0||moveRecords.length>0){site._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var moveElements=[],i=0,len=moveRecords.length;len>i;i++){var container=moveRecords[i].element;moveElements.push(container)}for(var i=0,len=itemMoveRecords.length;len>i;i++){var container=itemMoveRecords[i].element;moveElements.push(container)}pendingTransitionPromises.push(_TransitionAnimation.executeTransition(moveElements,{property:transformNames.cssName,delay:moveDelay,duration:duration,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""})),addDelay+=80,site._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}addPhase()}function addPhase(){if(insertedElements.length>0){site._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var addDuration=120;slowAnimations&&(addDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(insertedElements,[{property:"opacity",delay:addDelay,duration:addDuration,timing:"linear",to:1}])),site._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}waitForNextPhase(completePhase)}function completePhase(){site._writeProfilerMark("Animation:cleanupAnimations,StartTM"),cleanupItemsContainers();for(var i=0,len=removedElements.length;len>i;i++){var container=removedElements[i];container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container))}site._writeProfilerMark("Animation:cleanupAnimations,StopTM"),that._animationsRunning=null,animationSignal.complete()}var animationSignal=new _Signal;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),
animationSignal.complete(),animationSignal.promise;this._animationsRunning=animationSignal.promise;for(var slowAnimations=exports.Layout._debugAnimations||exports.Layout._slowAnimations,site=this._site,insertedElements=this._insertedElements,removedElements=this._removedElements,itemMoveRecords=this._itemMoveRecords,moveRecords=this._moveRecords,removeDelay=0,moveDelay=0,addDelay=0,currentAnimationPromise=null,pendingTransitionPromises=[],hasMultisizeMove=!1,hasReflow=!1,minOffset=0,maxOffset=0,itemContainersToExpand={},upOutDist=0,downOutDist=0,upInDist=0,downInDist=0,reflowItemRecords=[],horizontal="horizontal"===this.orientation,oldReflowLayoutProperty=horizontal?"oldColumn":"oldRow",reflowLayoutProperty=horizontal?"column":"row",oldReflowLayoutPosition=horizontal?"oldTop":"oldLeft",reflowLayoutPosition=horizontal?"top":"left",animatingItemsBlocks=this._animatingItemsBlocks,i=0,len=itemMoveRecords.length;len>i;i++){var cachedItemRecord=itemMoveRecords[i];if(cachedItemRecord.inCellSpanningGroup){hasMultisizeMove=!0;break}}var that=this;return exports.Layout._debugAnimations?_BaseUtils._requestAnimationFrame(function(){startAnimations()}):startAnimations(),this._resetAnimationCaches(!0),animationSignal.promise.then(null,function(){cleanupItemsContainers();for(var i=0,len=moveRecords.length;len>i;i++){var container=moveRecords[i].element;container.style[transformNames.scriptName]="",container.style.opacity=1}for(var i=0,len=itemMoveRecords.length;len>i;i++){var container=itemMoveRecords[i].element;container.style[transformNames.scriptName]="",container.style.opacity=1}for(var i=0,len=insertedElements.length;len>i;i++)insertedElements[i].style.opacity=1;for(var i=0,len=removedElements.length;len>i;i++){var container=removedElements[i];container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container))}this._animationsRunning=null,animationSignal=null,currentAnimationPromise&&currentAnimationPromise.cancel()}.bind(this)),animationSignal.promise},dragOver:function(x,y,dragInfo){var indicesAffected=this.hitTest(x,y),groupAffected=this._groups?this._site.groupIndexFromItemIndex(indicesAffected.index):0,itemsContainer=this._site.tree[groupAffected].itemsContainer,itemsCount=getItemsContainerLength(itemsContainer),indexOffset=this._groups?this._groups[groupAffected].startIndex:0,visibleRange=this._getVisibleRange();indicesAffected.index-=indexOffset,indicesAffected.insertAfterIndex-=indexOffset,visibleRange.firstIndex=Math.max(visibleRange.firstIndex-indexOffset-1,0),visibleRange.lastIndex=Math.min(visibleRange.lastIndex-indexOffset+1,itemsCount);var indexAfter=Math.max(Math.min(itemsCount-1,indicesAffected.insertAfterIndex),-1),indexBefore=Math.min(indexAfter+1,itemsCount);if(dragInfo){for(var i=indexAfter;i>=visibleRange.firstIndex;i--){if(!dragInfo._isIncluded(i+indexOffset)){indexAfter=i;break}i===visibleRange.firstIndex&&(indexAfter=-1)}for(var i=indexBefore;i<visibleRange.lastIndex;i++){if(!dragInfo._isIncluded(i+indexOffset)){indexBefore=i;break}i===visibleRange.lastIndex-1&&(indexBefore=itemsCount)}}var elementBefore=containerFromIndex(itemsContainer,indexBefore),elementAfter=containerFromIndex(itemsContainer,indexAfter);if(this._animatedDragItems)for(var i=0,len=this._animatedDragItems.length;len>i;i++){var item=this._animatedDragItems[i];item&&(item.style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,item.style[transformNames.scriptName]="")}this._animatedDragItems=[];var horizontal="horizontal"===this.orientation,inListMode=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[groupAffected]instanceof Groups.CellSpanningGroup&&(inListMode=1===this._groups[groupAffected]._slotsPerColumn);var horizontalTransform=0,verticalTransform=0;!horizontal&&!inListMode||horizontal&&inListMode?horizontalTransform=this._site.rtl?-dragBetweenDistance:dragBetweenDistance:verticalTransform=dragBetweenDistance,elementBefore&&(elementBefore.style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,elementBefore.style[transformNames.scriptName]="translate("+horizontalTransform+"px, "+verticalTransform+"px)",this._animatedDragItems.push(elementBefore)),elementAfter&&(elementAfter.style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,elementAfter.style[transformNames.scriptName]="translate("+-horizontalTransform+"px, -"+verticalTransform+"px)",this._animatedDragItems.push(elementAfter))},dragLeave:function(){if(this._animatedDragItems)for(var i=0,len=this._animatedDragItems.length;len>i;i++)this._animatedDragItems[i].style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,this._animatedDragItems[i].style[transformNames.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(value){value===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),value&&(this._itemsPerBar=Math.min(this._itemsPerBar,value)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=value,this._invalidateLayout())},_getItemPosition:function(itemIndex){if(this._groupsEnabled){var groupIndex=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(itemIndex)),group=this._groups[groupIndex],itemOfGroupIndex=itemIndex-group.startIndex;return this._getItemPositionForAnimations(itemIndex,groupIndex,itemOfGroupIndex)}return this._getItemPositionForAnimations(itemIndex,0,itemIndex)},_getRealizationRange:function(){var realizedRange=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(realizedRange.firstPixel),lastIndex:this._lastItemFromRange(realizedRange.lastPixel)}},_getVisibleRange:function(){var visibleRange=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(visibleRange.firstPixel),lastIndex:this._lastItemFromRange(visibleRange.lastPixel)}},_resetAnimationCaches:function(skipReset){if(!skipReset){this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords),this._resetStylesForRemovedRecords(this._cachedRemovedItems),this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var itemsBlockKeys=Object.keys(this._animatingItemsBlocks),i=0,len=itemsBlockKeys.length;len>i;i++){var itemsBlock=this._animatingItemsBlocks[itemsBlockKeys[i]];itemsBlock.style.overflow="",itemsBlock.classList.remove(_Constants._clipClass)}}this._cachedGroupRecords={},this._cachedItemRecords={},this._cachedHeaderRecords={},this._cachedInsertedItemRecords={},this._cachedInsertedHeaderRecords={},this._cachedRemovedItems=[],this._cachedRemovedHeaders=[],this._animatingItemsBlocks={}},_cacheRemovedElements:function(modifiedElements,cachedRecords,cachedInsertedRecords,removedElements,areHeaders){var leftStr="left";this._site.rtl&&(leftStr="right");var outerX,outerY;areHeaders?(outerX=this._sizes.headerContainerOuterX,outerY=this._sizes.headerContainerOuterY):(outerX=this._sizes.containerMargins[leftStr],outerY=this._sizes.containerMargins.top);for(var i=0,len=modifiedElements.length;len>i;i++){var modifiedElementLookup=modifiedElements[i];if(-1===modifiedElementLookup.newIndex){var container=modifiedElementLookup.element,cachedItemRecord=cachedRecords[modifiedElementLookup.oldIndex];cachedItemRecord&&(cachedItemRecord.element=container,delete cachedRecords[modifiedElementLookup.oldIndex],container.style.position="absolute",container.style[transitionScriptName]="",container.style.top=cachedItemRecord.oldTop-outerY+"px",container.style[leftStr]=cachedItemRecord.oldLeft-outerX+"px",container.style.width=cachedItemRecord.width+"px",container.style.height=cachedItemRecord.height+"px",container.style[transformNames.scriptName]="",this._site.surface.appendChild(container),removedElements.push(cachedItemRecord)),cachedInsertedRecords[modifiedElementLookup.oldIndex]&&delete cachedInsertedRecords[modifiedElementLookup.oldIndex]}}},_cacheInsertedElements:function(modifiedElements,cachedInsertedRecords,cachedRecords){for(var newCachedInsertedRecords={},i=0,len=modifiedElements.length;len>i;i++){var modifiedElementLookup=modifiedElements[i],wasInserted=cachedInsertedRecords[modifiedElementLookup.oldIndex];if(wasInserted&&delete cachedInsertedRecords[modifiedElementLookup.oldIndex],wasInserted||-1===modifiedElementLookup.oldIndex||modifiedElementLookup.moved){var cachedRecord=cachedRecords[modifiedElementLookup.newIndex];cachedRecord&&delete cachedRecords[modifiedElementLookup.newIndex];var modifiedElement=modifiedElementLookup.element;newCachedInsertedRecords[modifiedElementLookup.newIndex]=modifiedElement,modifiedElement.style[transitionScriptName]="",modifiedElement.style[transformNames.scriptName]="",modifiedElement.style.opacity=0}}for(var keys=Object.keys(cachedInsertedRecords),i=0,len=keys.length;len>i;i++)newCachedInsertedRecords[keys[i]]=cachedInsertedRecords[keys[i]];return newCachedInsertedRecords},_resetStylesForRecords:function(recordsHash){for(var recordKeys=Object.keys(recordsHash),i=0,len=recordKeys.length;len>i;i++){var record=recordsHash[recordKeys[i]];record.needsToResetTransform&&(record.element.style[transformNames.scriptName]="",record.needsToResetTransform=!1)}},_resetStylesForInsertedRecords:function(insertedRecords){for(var insertedRecordKeys=Object.keys(insertedRecords),i=0,len=insertedRecordKeys.length;len>i;i++){var insertedElement=insertedRecords[insertedRecordKeys[i]];insertedElement.style.opacity=1}},_resetStylesForRemovedRecords:function(removedElements){for(var i=0,len=removedElements.length;len>i;i++){var container=removedElements[i].element;container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container))}},_updateAnimationCache:function(modifiedItems,modifiedGroups){function updateIndicies(modifiedElements,cachedRecords){for(var updatedCachedRecords={},i=0,len=modifiedElements.length;len>i;i++){var modifiedElementLookup=modifiedElements[i],cachedRecord=cachedRecords[modifiedElementLookup.oldIndex];cachedRecord&&(updatedCachedRecords[modifiedElementLookup.newIndex]=cachedRecord,cachedRecord.element=modifiedElementLookup.element,delete cachedRecords[modifiedElementLookup.oldIndex])}for(var cachedRecordKeys=Object.keys(cachedRecords),i=0,len=cachedRecordKeys.length;len>i;i++){var key=cachedRecordKeys[i],record=cachedRecords[key];(!record.element||existingContainers[uniqueID(record.element)])&&(updatedCachedRecords[key]=record)}return updatedCachedRecords}this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var existingContainers={},realizationRange=this._getRealizationRange(),tree=this._site.tree,i=0,itemIndex=0,treeLength=tree.length;treeLength>i;i++)forEachContainer(tree[i].itemsContainer,function(container){realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex&&(existingContainers[uniqueID(container)]=!0),itemIndex++});this._cachedItemRecords=updateIndicies(modifiedItems,this._cachedItemRecords),this._cachedHeaderRecords=updateIndicies(modifiedGroups,this._cachedHeaderRecords),this._cachedInsertedItemRecords=this._cacheInsertedElements(modifiedItems,this._cachedInsertedItemRecords,this._cachedItemRecords),this._cachedInsertedHeaderRecords=this._cacheInsertedElements(modifiedGroups,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function filterRemovedElements(removedRecordArray,removedElementsArray){for(var i=0,len=removedRecordArray.length;len>i;i++){var removedItem=removedRecordArray[i],container=removedItem.element;removedItem[oldLeftStr]+removedItem[widthStr]-1<visibleFirstPixel||removedItem[oldLeftStr]>visibleLastPixel||!that._site.viewport.contains(container)?container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container)):removedElementsArray.push(container)}}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var that=this,oldLeftStr="horizontal"===this.orientation?"oldLeft":"oldTop",widthStr="horizontal"===this.orientation?"width":"height",visibleFirstPixel=this._site.scrollbarPos,visibleLastPixel=visibleFirstPixel+this._site.viewportSize[widthStr]-1;filterRemovedElements(this._cachedRemovedItems,this._removedElements),filterRemovedElements(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function filterInsertedElements(cachedInsertedRecords,insertedElementsArray){for(var recordKeys=Object.keys(cachedInsertedRecords),i=0,len=recordKeys.length;len>i;i++){var itemIndex=recordKeys[i],insertedRecord=cachedInsertedRecords[itemIndex];itemIndex<visibleRange.firstIndex||itemIndex>visibleRange.lastIndex||that._site.viewport.contains(insertedRecord.element)?insertedRecord.style.opacity=1:insertedElementsArray.push(insertedRecord)}}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var that=this,visibleRange=this._getVisibleRange();filterInsertedElements(this._cachedInsertedItemRecords,this._insertedElements),filterInsertedElements(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var that=this,oldLeftStr="horizontal"===this.orientation?"oldLeft":"oldTop",leftStr="horizontal"===this.orientation?"left":"top",widthStr="horizontal"===this.orientation?"width":"height",realizationRange=this._getRealizationRange(),visibleFirstPixel=this._site.scrollbarPos,visibleLastPixel=visibleFirstPixel+this._site.viewportSize[widthStr]-1;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var tree=this._site.tree,itemIndex=0,i=0,treeLength=tree.length;treeLength>i;i++){var groupBundle=tree[i],groupHasItemToAnimate=!1;forEachContainer(groupBundle.itemsContainer,function(){if(realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex){var cachedItemRecord=this._cachedItemRecords[itemIndex];if(cachedItemRecord){var shouldAnimate=(cachedItemRecord[oldLeftStr]+cachedItemRecord[widthStr]-1>=visibleFirstPixel&&cachedItemRecord[oldLeftStr]<=visibleLastPixel||cachedItemRecord[leftStr]+cachedItemRecord[widthStr]-1>=visibleFirstPixel&&cachedItemRecord[leftStr]<=visibleLastPixel)&&that._site.viewport.contains(cachedItemRecord.element);shouldAnimate&&(groupHasItemToAnimate=!0,cachedItemRecord.needsToResetTransform&&(this._itemMoveRecords.push(cachedItemRecord),delete this._cachedItemRecords[itemIndex]))}}itemIndex++}.bind(this));var groupIndex=i,cachedHeaderRecord=this._cachedHeaderRecords[groupIndex];cachedHeaderRecord&&groupHasItemToAnimate&&cachedHeaderRecord.needsToResetTransform&&(this._moveRecords.push(cachedHeaderRecord),delete this._cachedHeaderRecords[groupIndex]);var cachedGroupRecord=this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)];cachedGroupRecord&&groupHasItemToAnimate&&cachedGroupRecord.needsToResetTransform&&(this._moveRecords.push(cachedGroupRecord),delete this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)])}this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(itemIndex,groupIndex,itemOfGroupIndex){var group=this._groups[groupIndex],itemPosition=group.getItemPositionForAnimations(itemOfGroupIndex),groupOffset=this._groups[groupIndex]?this._groups[groupIndex].offset:0,headerWidth=this._groupsEnabled&&this._groupHeaderPosition===HeaderPosition.left?this._sizes.headerContainerWidth:0,headerHeight=this._groupsEnabled&&this._groupHeaderPosition===HeaderPosition.top?this._sizes.headerContainerHeight:0;return itemPosition.left+=this._sizes.layoutOriginX+headerWidth+this._sizes.itemsContainerOuterX,itemPosition.top+=this._sizes.layoutOriginY+headerHeight+this._sizes.itemsContainerOuterY,itemPosition[this._horizontal?"left":"top"]+=groupOffset,itemPosition},_getHeaderPositionForAnimations:function(groupIndex){var headerPosition;if(this._groupsEnabled){var width=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,height=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight;this._groupHeaderPosition!==HeaderPosition.left||this._horizontal?this._groupHeaderPosition===HeaderPosition.top&&this._horizontal&&(width=this._groups[groupIndex].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):height=this._groups[groupIndex].getItemsContainerSize()-this._sizes.headerContainerOuterHeight;var offsetX=this._horizontal?this._groups[groupIndex].offset:0,offsetY=this._horizontal?0:this._groups[groupIndex].offset;headerPosition={top:this._sizes.layoutOriginY+offsetY+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+offsetX+this._sizes.headerContainerOuterX,height:height,width:width}}else headerPosition={top:0,left:0,height:0,width:0};return headerPosition},_rangeContainsItems:function(firstPixel,lastPixel){if(0===this._groups.length)return!1;var lastGroup=this._groups[this._groups.length-1],lastPixelOfLayout=this._sizes.layoutOrigin+lastGroup.offset+this._getGroupSize(lastGroup)-1;return lastPixel>=0&&lastPixelOfLayout>=firstPixel},_itemFromOffset:function(offset,options){function assignItemMargins(offset){if(!options.wholeItem){var marginPropLast=that._horizontal?that._site.rtl?"right":"left":"top",marginPropFirst=that._horizontal?that._site.rtl?"left":"right":"bottom";return options.last?offset-that._sizes.containerMargins[marginPropLast]:offset+that._sizes.containerMargins[marginPropFirst]}return offset}function assignGroupMarginsAndHeaders(offset){return options.last?offset-that._getHeaderSizeGroupAdjustment()-that._sizes.itemsContainerOuterStart:offset}var that=this;if(0===this._groups.length)return 0;options=options||{},offset-=this._sizes.layoutOrigin,offset=assignItemMargins(offset);var groupIndex=this._groupFromOffset(assignGroupMarginsAndHeaders(offset)),group=this._groups[groupIndex];return offset-=group.offset,offset-=this._getHeaderSizeGroupAdjustment(),group.startIndex+group.itemFromOffset(offset,options)},_firstItemFromRange:function(firstPixel,options){return options=options||{},options.last=0,this._itemFromOffset(firstPixel,options)},_lastItemFromRange:function(lastPixel,options){return options=options||{},options.last=1,this._itemFromOffset(lastPixel,options)},_adjustedKeyForRTL:function(key){return this._site.rtl&&(key===Key.leftArrow?key=Key.rightArrow:key===Key.rightArrow&&(key=Key.leftArrow)),key},_adjustedKeyForOrientationAndBars:function(key,cellSpanningGroup){var newKey=key;if(cellSpanningGroup)return key;if(!this._horizontal)switch(newKey){case Key.leftArrow:newKey=Key.upArrow;break;case Key.rightArrow:newKey=Key.downArrow;break;case Key.upArrow:newKey=Key.leftArrow;break;case Key.downArrow:newKey=Key.rightArrow}return 1===this._itemsPerBar&&(newKey===Key.upArrow?newKey=Key.leftArrow:newKey===Key.downArrow&&(newKey=Key.rightArrow)),newKey},_getAdjacentForPageKeys:function(currentItem,pressedKey){var newFocus,containerMargins=this._sizes.containerMargins,marginSum="horizontal"===this.orientation?containerMargins.left+containerMargins.right:containerMargins.top+containerMargins.bottom,viewportLength=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],firstPixel=this._site.scrollbarPos,lastPixel=firstPixel+viewportLength-1-containerMargins["horizontal"===this.orientation?"right":"bottom"],firstIndex=this._firstItemFromRange(firstPixel,{wholeItem:!0}),lastIndex=this._lastItemFromRange(lastPixel,{wholeItem:!1}),currentItemPosition=this._getItemPosition(currentItem.index),offscreen=!1;if((currentItem.index<firstIndex||currentItem.index>lastIndex)&&(offscreen=!0,firstPixel="horizontal"===this.orientation?currentItemPosition.left-marginSum:currentItemPosition.top-marginSum,lastPixel=firstPixel+viewportLength-1,firstIndex=this._firstItemFromRange(firstPixel,{wholeItem:!0}),lastIndex=this._lastItemFromRange(lastPixel,{wholeItem:!1})),pressedKey===Key.pageUp){if(!offscreen&&firstIndex!==currentItem.index)return{type:_UI.ObjectType.item,index:firstIndex};var end;end="horizontal"===this.orientation?currentItemPosition.left+currentItemPosition.width+marginSum+containerMargins.left:currentItemPosition.top+currentItemPosition.height+marginSum+containerMargins.bottom;var firstIndexOnPrevPage=this._firstItemFromRange(end-viewportLength,{wholeItem:!0});newFocus=currentItem.index===firstIndexOnPrevPage?Math.max(0,currentItem.index-this._itemsPerBar):firstIndexOnPrevPage}else{if(!offscreen&&lastIndex!==currentItem.index)return{type:_UI.ObjectType.item,index:lastIndex};var start;start="horizontal"===this.orientation?currentItemPosition.left-marginSum-containerMargins.right:currentItemPosition.top-marginSum-containerMargins.bottom;var lastIndexOnNextPage=Math.max(0,this._lastItemFromRange(start+viewportLength-1,{wholeItem:!0}));newFocus=currentItem.index===lastIndexOnNextPage?currentItem.index+this._itemsPerBar:lastIndexOnNextPage}return{type:_UI.ObjectType.item,index:newFocus}},_isCellSpanning:function(groupIndex){var group=this._site.groupFromIndex(groupIndex),groupInfo=this._groupInfo;return groupInfo?!!("function"==typeof groupInfo?groupInfo(group):groupInfo).enableCellSpanning:!1},_getGroupInfo:function(groupIndex){var group=this._site.groupFromIndex(groupIndex),groupInfo=this._groupInfo,margins=this._sizes.containerMargins,adjustedInfo={enableCellSpanning:!1};if(groupInfo="function"==typeof groupInfo?groupInfo(group):groupInfo){if(groupInfo.enableCellSpanning&&(+groupInfo.cellWidth!==groupInfo.cellWidth||+groupInfo.cellHeight!==groupInfo.cellHeight))throw new _ErrorFromName("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",strings.groupInfoResultIsInvalid);adjustedInfo={enableCellSpanning:!!groupInfo.enableCellSpanning,cellWidth:groupInfo.cellWidth+margins.left+margins.right,cellHeight:groupInfo.cellHeight+margins.top+margins.bottom}}return adjustedInfo},_getItemInfo:function(itemIndex){var result;if(this._itemInfo&&"function"==typeof this._itemInfo)result=this._itemInfo(itemIndex);else{if(!this._useDefaultItemInfo)throw new _ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",strings.itemInfoIsInvalid);result=this._defaultItemInfo(itemIndex)}return Promise.as(result).then(function(size){if(!size||+size.width!==size.width||+size.height!==size.height)throw new _ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",strings.itemInfoIsInvalid);return size})},_defaultItemInfo:function(itemIndex){var that=this;return this._site.renderItem(this._site.itemFromIndex(itemIndex)).then(function(element){return that._elementsToMeasure[itemIndex]={element:element},that._measureElements()}).then(function(){var entry=that._elementsToMeasure[itemIndex],size={width:entry.width,height:entry.height};return delete that._elementsToMeasure[itemIndex],size},function(error){return delete that._elementsToMeasure[itemIndex],Promise.wrapError(error)})},_getGroupSize:function(group){var headerContainerMinSize=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===HeaderPosition.top?headerContainerMinSize=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==HeaderPosition.left||(headerContainerMinSize=this._sizes.headerContainerMinHeight)),Math.max(headerContainerMinSize,group.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(offset){return offset<this._groups[0].offset?0:this._groupFrom(function(group){return offset<group.offset})},_groupFromImpl:function(fromGroup,toGroup,comp){if(fromGroup>toGroup)return null;var center=fromGroup+Math.floor((toGroup-fromGroup)/2),centerGroup=this._groups[center];return comp(centerGroup,center)?this._groupFromImpl(fromGroup,center-1,comp):toGroup>center&&!comp(this._groups[center+1],center+1)?this._groupFromImpl(center+1,toGroup,comp):center},_groupFrom:function(comp){if(this._groups.length>0){var lastGroupIndex=this._groups.length-1,lastGroup=this._groups[lastGroupIndex];return comp(lastGroup,lastGroupIndex)?this._groupFromImpl(0,this._groups.length-1,comp):lastGroupIndex}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null),this._containerSizeClassName&&(_ElementUtilities.removeClass(this._site.surface,this._containerSizeClassName),deleteDynamicCssRule(this._containerSizeClassName),this._containerSizeClassName=null),this._sizes=null,this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var that=this;that._measuringElements=Scheduler.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){that._site._writeProfilerMark("_measureElements,StartTM");var surface=that._createMeasuringSurface(),itemsContainer=_Global.document.createElement("div"),site=that._site,measuringElements=that._measuringElements,elementsToMeasure=that._elementsToMeasure,stopMeasuring=!1;itemsContainer.className=_Constants._itemsContainerClass+" "+_Constants._laidOutClass,itemsContainer.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1";var len,i,keys=Object.keys(elementsToMeasure);for(i=0,len=keys.length;len>i;i++){var element=elementsToMeasure[keys[i]].element;element.style["-ms-grid-column"]=i+1,element.style["-ms-grid-row"]=i+1,itemsContainer.appendChild(element)}for(surface.appendChild(itemsContainer),site.viewport.insertBefore(surface,site.viewport.firstChild),measuringElements.then(null,function(){stopMeasuring=!0}),i=0,len=keys.length;len>i&&!stopMeasuring;i++){var entry=elementsToMeasure[keys[i]],item=entry.element.querySelector("."+_Constants._itemClass);entry.width=_ElementUtilities.getTotalWidth(item),entry.height=_ElementUtilities.getTotalHeight(item)}surface.parentNode&&surface.parentNode.removeChild(surface),measuringElements===that._measuringElements&&(that._measuringElements=null),site._writeProfilerMark("_measureElements,StopTM")},function(error){return that._measuringElements=null,Promise.wrapError(error)})}return this._measuringElements},_ensureEnvInfo:function(){return this._envInfo||(this._envInfo=getEnvironmentSupportInformation(this._site),this._envInfo&&!this._envInfo.supportsCSSGrid&&_ElementUtilities.addClass(this._site.surface,_Constants._noCSSGrid)),!!this._envInfo},_createMeasuringSurface:function(){var surface=_Global.document.createElement("div");return surface.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto;-ms-flex-align: start;-webkit-align-items: flex-start;align-items: flex-start",surface.className=_Constants._scrollableClass+" "+(this._inListMode?_Constants._listLayoutClass:_Constants._gridLayoutClass),this._envInfo.supportsCSSGrid||_ElementUtilities.addClass(surface,_Constants._noCSSGrid),this._groupsEnabled&&(this._groupHeaderPosition===HeaderPosition.top?_ElementUtilities.addClass(surface,_Constants._headerPositionTopClass):_ElementUtilities.addClass(surface,_Constants._headerPositionLeftClass)),surface},_measureItem:function(index){function measureItemImpl(index,itemPromise){var itemPromise,secondTry=!!itemPromise,elementPromises={},left=site.rtl?"right":"left";return site.itemCount.then(function(count){return!count||that._groupsEnabled&&!site.groupCount?Promise.cancel:(itemPromise=itemPromise||site.itemFromIndex(index),elementPromises.container=site.renderItem(itemPromise),that._groupsEnabled&&(elementPromises.headerContainer=site.renderHeader(that._site.groupFromIndex(site.groupIndexFromItemIndex(index)))),Promise.join(elementPromises))}).then(function(elements){function readMeasurementsFromDOM(){var horizontal=that._horizontal,groupsEnabled=that._groupsEnabled,stopMeasuring=!1;measuringPromise.then(null,function(){stopMeasuring=!0});var firstElementOnSurfaceMargins=getMargins(firstElementOnSurface),firstElementOnSurfaceOffsetX=site.rtl?site.viewport.offsetWidth-(firstElementOnSurface.offsetLeft+firstElementOnSurface.offsetWidth):firstElementOnSurface.offsetLeft,firstElementOnSurfaceOffsetY=firstElementOnSurface.offsetTop,sizes={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:getOuterHeight(surface),surfaceOuterWidth:getOuterWidth(surface),layoutOriginX:firstElementOnSurfaceOffsetX-firstElementOnSurfaceMargins[left],layoutOriginY:firstElementOnSurfaceOffsetY-firstElementOnSurfaceMargins.top,itemsContainerOuterHeight:getOuterHeight(itemsContainer),itemsContainerOuterWidth:getOuterWidth(itemsContainer),itemsContainerOuterX:getOuter(site.rtl?"Right":"Left",itemsContainer),itemsContainerOuterY:getOuter("Top",itemsContainer),itemsContainerMargins:getMargins(itemsContainer),itemBoxOuterHeight:getOuterHeight(itemBox),itemBoxOuterWidth:getOuterWidth(itemBox),containerOuterHeight:getOuterHeight(elements.container),containerOuterWidth:getOuterWidth(elements.container),emptyContainerContentHeight:_ElementUtilities.getContentHeight(emptyContainer),emptyContainerContentWidth:_ElementUtilities.getContentWidth(emptyContainer),containerMargins:getMargins(elements.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};site.header&&(sizes[horizontal?"layoutOriginX":"layoutOriginY"]+=_ElementUtilities[horizontal?"getTotalWidth":"getTotalHeight"](site.header)),groupsEnabled&&(sizes.headerContainerOuterX=getOuter(site.rtl?"Right":"Left",elements.headerContainer),sizes.headerContainerOuterY=getOuter("Top",elements.headerContainer),sizes.headerContainerOuterWidth=getOuterWidth(elements.headerContainer),sizes.headerContainerOuterHeight=getOuterHeight(elements.headerContainer),sizes.headerContainerWidth=_ElementUtilities.getTotalWidth(elements.headerContainer),sizes.headerContainerHeight=_ElementUtilities.getTotalHeight(elements.headerContainer),sizes.headerContainerMinWidth=getDimension(elements.headerContainer,"minWidth")+sizes.headerContainerOuterWidth,sizes.headerContainerMinHeight=getDimension(elements.headerContainer,"minHeight")+sizes.headerContainerOuterHeight);var measurements={sizes:sizes,viewportContentWidth:_ElementUtilities.getContentWidth(site.viewport),viewportContentHeight:_ElementUtilities.getContentHeight(site.viewport),containerContentWidth:_ElementUtilities.getContentWidth(elements.container),containerContentHeight:_ElementUtilities.getContentHeight(elements.container),containerWidth:_ElementUtilities.getTotalWidth(elements.container),containerHeight:_ElementUtilities.getTotalHeight(elements.container)};return measurements.viewportCrossSize=measurements[horizontal?"viewportContentHeight":"viewportContentWidth"],site.readyToMeasure(),stopMeasuring?null:measurements}function cleanUp(){surface.parentNode&&surface.parentNode.removeChild(surface)}var surface=that._createMeasuringSurface(),itemsContainer=_Global.document.createElement("div"),emptyContainer=_Global.document.createElement("div"),itemBox=elements.container.querySelector("."+_Constants._itemBoxClass),groupIndex=site.groupIndexFromItemIndex(index);emptyContainer.className=_Constants._containerClass,itemsContainer.className=_Constants._itemsContainerClass+" "+_Constants._laidOutClass;var itemsContainerRow=1,itemsContainerColumn=1,headerContainerRow=2,headerContainerColumn=2,firstElementOnSurface=itemsContainer,addHeaderFirst=!1;that._inListMode&&that._groupsEnabled&&(that._horizontal&&that._groupHeaderPosition===HeaderPosition.top?(itemsContainerRow=2,headerContainerColumn=1,
headerContainerRow=1,firstElementOnSurface=elements.headerContainer,addHeaderFirst=!0):that._horizontal||that._groupHeaderPosition!==HeaderPosition.left||(itemsContainerColumn=2,headerContainerColumn=1,headerContainerRow=1,firstElementOnSurface=elements.headerContainer,addHeaderFirst=!0)),itemsContainer.style.cssText+=";display: "+(that._inListMode?(that._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+itemsContainerColumn+";-ms-grid-row: "+itemsContainerRow,that._inListMode||(elements.container.style.display="inline-block"),that._groupsEnabled&&(elements.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+headerContainerColumn+";-ms-grid-row: "+headerContainerRow,_ElementUtilities.addClass(elements.headerContainer,_Constants._laidOutClass+" "+_Constants._groupLeaderClass),(that._groupHeaderPosition===HeaderPosition.top&&that._horizontal||that._groupHeaderPosition===HeaderPosition.left&&!that._horizontal)&&_ElementUtilities.addClass(itemsContainer,_Constants._groupLeaderClass)),addHeaderFirst&&surface.appendChild(elements.headerContainer),itemsContainer.appendChild(elements.container),itemsContainer.appendChild(emptyContainer),surface.appendChild(itemsContainer),!addHeaderFirst&&that._groupsEnabled&&surface.appendChild(elements.headerContainer),site.viewport.insertBefore(surface,site.viewport.firstChild);var measurements=readMeasurementsFromDOM();if(!measurements)return cleanUp(),Promise.cancel;if(that._horizontal&&0===measurements.viewportContentHeight||!that._horizontal&&0===measurements.viewportContentWidth)return cleanUp(),Promise.cancel;if(!(secondTry||that._isCellSpanning(groupIndex)||0!==measurements.containerContentWidth&&0!==measurements.containerContentHeight))return cleanUp(),itemPromise.then(function(){return measureItemImpl(index,itemPromise)});var sizes=that._sizes=measurements.sizes;if(Object.defineProperties(sizes,{surfaceOuterCrossSize:{get:function(){return that._horizontal?sizes.surfaceOuterHeight:sizes.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return that._horizontal?sizes.layoutOriginX:sizes.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return that._horizontal?sizes.itemsContainerOuterWidth:sizes.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return that._horizontal?sizes.itemsContainerOuterHeight:sizes.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return that._horizontal?sizes.itemsContainerOuterX:sizes.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return that._horizontal?sizes.itemsContainerOuterY:sizes.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return that._horizontal?sizes.containerHeight:sizes.containerWidth},enumerable:!0},containerSize:{get:function(){return that._horizontal?sizes.containerWidth:sizes.containerHeight},enumerable:!0}}),!that._isCellSpanning(groupIndex)){if(that._inListMode){var itemsContainerContentSize=measurements.viewportCrossSize-sizes.surfaceOuterCrossSize-that._getHeaderSizeContentAdjustment()-sizes.itemsContainerOuterCrossSize;that._horizontal?(sizes.containerHeight=itemsContainerContentSize,sizes.containerWidth=measurements.containerWidth):(sizes.containerHeight=measurements.containerHeight,sizes.containerWidth=itemsContainerContentSize)}else sizes.containerWidth=measurements.containerWidth,sizes.containerHeight=measurements.containerHeight;sizes.containerSizeLoaded=!0}that._createContainerStyleRule(),that._viewportSizeChanged(measurements.viewportCrossSize),cleanUp()})}var that=this,perfId="Layout:measureItem",site=that._site,measuringPromise=that._measuringPromise;if(!measuringPromise){site._writeProfilerMark(perfId+",StartTM");var promiseStoredSignal=new _Signal;that._measuringPromise=measuringPromise=promiseStoredSignal.promise.then(function(){return that._ensureEnvInfo()?measureItemImpl(index):Promise.cancel}).then(function(){site._writeProfilerMark(perfId+":complete,info"),site._writeProfilerMark(perfId+",StopTM")},function(error){return that._measuringPromise=null,site._writeProfilerMark(perfId+":canceled,info"),site._writeProfilerMark(perfId+",StopTM"),Promise.wrapError(error)}),promiseStoredSignal.complete()}return measuringPromise},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===HeaderPosition.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===HeaderPosition.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===HeaderPosition.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===HeaderPosition.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(viewportContentSize){var sizes=this._sizes;sizes.viewportContentSize=viewportContentSize,sizes.surfaceContentSize=viewportContentSize-sizes.surfaceOuterCrossSize,sizes.maxItemsContainerContentSize=sizes.surfaceContentSize-sizes.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment(),sizes.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(sizes.maxItemsContainerContentSize/sizes.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(sizes[this._horizontal?"containerHeight":"containerWidth"]=sizes.maxItemsContainerContentSize),this._itemsPerBar=1),this._resetAnimationCaches()},_createContainerStyleRule:function(){var sizes=this._sizes;if(!this._containerSizeClassName&&sizes.containerSizeLoaded&&(0===sizes.emptyContainerContentHeight||0===sizes.emptyContainerContentWidth)){var width=sizes.containerWidth-sizes.containerOuterWidth+"px",height=sizes.containerHeight-sizes.containerOuterHeight+"px";this._inListMode&&(this._horizontal?height="calc(100% - "+(sizes.containerMargins.top+sizes.containerMargins.bottom)+"px)":width="auto"),this._containerSizeClassName||(this._containerSizeClassName=uniqueCssClassName("containersize"),_ElementUtilities.addClass(this._site.surface,this._containerSizeClassName));var ruleSelector="."+_Constants._containerClass,ruleBody="width:"+width+";height:"+height+";";addDynamicCssRule(this._containerSizeClassName,this._site,ruleSelector,ruleBody)}},_ensureContainerSize:function(group){var sizes=this._sizes;if(sizes.containerSizeLoaded||this._ensuringContainerSize)return this._ensuringContainerSize?this._ensuringContainerSize:Promise.wrap();var promise;if(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo)promise=this._getItemInfo();else{var margins=sizes.containerMargins;promise=Promise.wrap({width:group.groupInfo.cellWidth-margins.left-margins.right,height:group.groupInfo.cellHeight-margins.top-margins.bottom})}var that=this;return this._ensuringContainerSize=promise.then(function(itemSize){sizes.containerSizeLoaded=!0,sizes.containerWidth=itemSize.width+sizes.itemBoxOuterWidth+sizes.containerOuterWidth,sizes.containerHeight=itemSize.height+sizes.itemBoxOuterHeight+sizes.containerOuterHeight,that._inListMode?that._itemsPerBar=1:(that._itemsPerBar=Math.floor(sizes.maxItemsContainerContentSize/sizes.containerCrossSize),that.maximumRowsOrColumns&&(that._itemsPerBar=Math.min(that._itemsPerBar,that.maximumRowsOrColumns)),that._itemsPerBar=Math.max(1,that._itemsPerBar)),that._createContainerStyleRule()}),promise.done(function(){that._ensuringContainerSize=null},function(){that._ensuringContainerSize=null}),promise},_indexToCoordinate:function(index,itemsPerBar){itemsPerBar=itemsPerBar||this._itemsPerBar;var bar=Math.floor(index/itemsPerBar);return this._horizontal?{column:bar,row:index-bar*itemsPerBar}:{row:bar,column:index-bar*itemsPerBar}},_rangeForGroup:function(group,range){var first=group.startIndex,last=first+group.count-1;return!range||range.firstIndex>last||range.lastIndex<first?null:{firstIndex:Math.max(0,range.firstIndex-first),lastIndex:Math.min(group.count-1,range.lastIndex-first)}},_syncDomWithGroupHeaderPosition:function(tree){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var i,len=tree.length;if(this._oldGroupHeaderPosition===HeaderPosition.top)if(_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionTopClass),this._horizontal)for(i=0;len>i;i++)tree[i].header.style.maxWidth="",_ElementUtilities.removeClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===HeaderPosition.left){if(_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionLeftClass),!this._horizontal)for(i=0;len>i;i++)tree[i].header.style.maxHeight="",_ElementUtilities.removeClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===HeaderPosition.top){if(_ElementUtilities.addClass(this._site.surface,_Constants._headerPositionTopClass),this._horizontal)for(i=0;len>i;i++)_ElementUtilities.addClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass)}else if(_ElementUtilities.addClass(this._site.surface,_Constants._headerPositionLeftClass),!this._horizontal)for(i=0;len>i;i++)_ElementUtilities.addClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(index){var group=this._groups[index],groupBundle=this._site.tree[index],headerContainer=groupBundle.header,itemsContainer=groupBundle.itemsContainer.element,sizes=this._sizes,groupCrossSize=group.getItemsContainerCrossSize();if(this._groupsEnabled){if(this._horizontal)if(this._groupHeaderPosition===HeaderPosition.top){var headerContainerMinContentWidth=sizes.headerContainerMinWidth-sizes.headerContainerOuterWidth,itemsContainerContentWidth=group.getItemsContainerSize()-sizes.headerContainerOuterWidth;headerContainer.style.maxWidth=Math.max(headerContainerMinContentWidth,itemsContainerContentWidth)+"px",this._envInfo.supportsCSSGrid?(headerContainer.style.msGridColumn=index+1,itemsContainer.style.msGridColumn=index+1):(headerContainer.style.height=sizes.headerContainerHeight-sizes.headerContainerOuterHeight+"px",itemsContainer.style.height=groupCrossSize-sizes.itemsContainerOuterHeight+"px",itemsContainer.style.marginBottom=sizes.itemsContainerMargins.bottom+(sizes.maxItemsContainerContentSize-groupCrossSize+sizes.itemsContainerOuterHeight)+"px"),_ElementUtilities.addClass(itemsContainer,_Constants._groupLeaderClass)}else this._envInfo.supportsCSSGrid?(headerContainer.style.msGridColumn=2*index+1,itemsContainer.style.msGridColumn=2*index+2):(headerContainer.style.width=sizes.headerContainerWidth-sizes.headerContainerOuterWidth+"px",headerContainer.style.height=groupCrossSize-sizes.headerContainerOuterHeight+"px",itemsContainer.style.height=groupCrossSize-sizes.itemsContainerOuterHeight+"px");else if(this._groupHeaderPosition===HeaderPosition.left){var headerContainerMinContentHeight=sizes.headerContainerMinHeight-sizes.headerContainerOuterHeight,itemsContainerContentHeight=group.getItemsContainerSize()-sizes.headerContainerOuterHeight;headerContainer.style.maxHeight=Math.max(headerContainerMinContentHeight,itemsContainerContentHeight)+"px",this._envInfo.supportsCSSGrid?(headerContainer.style.msGridRow=index+1,itemsContainer.style.msGridRow=index+1):(headerContainer.style.width=sizes.headerContainerWidth-sizes.headerContainerOuterWidth+"px",itemsContainer.style.width=groupCrossSize-sizes.itemsContainerOuterWidth+"px",itemsContainer.style["margin"+(this._site.rtl?"Left":"Right")]=sizes.itemsContainerMargins[this._site.rtl?"left":"right"]+(sizes.maxItemsContainerContentSize-groupCrossSize+sizes.itemsContainerOuterWidth)+"px"),_ElementUtilities.addClass(itemsContainer,_Constants._groupLeaderClass)}else headerContainer.style.msGridRow=2*index+1,this._inListMode?headerContainer.style.height=sizes.headerContainerHeight-sizes.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?itemsContainer.style.msGridRow=2*index+2:(headerContainer.style.height=sizes.headerContainerHeight-sizes.headerContainerOuterHeight+"px",headerContainer.style.width=groupCrossSize-sizes.headerContainerOuterWidth+"px",itemsContainer.style.width=groupCrossSize-sizes.itemsContainerOuterWidth+"px");_ElementUtilities.addClass(headerContainer,_Constants._laidOutClass+" "+_Constants._groupLeaderClass)}_ElementUtilities.addClass(itemsContainer,_Constants._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(value){if(_ElementUtilities._deprecated(_ErrorMessages.disableBackdropIsDeprecated),value=!!value,this._backdropDisabled!==value&&(this._backdropDisabled=value,this._disableBackdropClassName&&(deleteDynamicCssRule(this._disableBackdropClassName),this._site&&_ElementUtilities.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=uniqueCssClassName("disablebackdrop"),this._site&&_ElementUtilities.addClass(this._site.surface,this._disableBackdropClassName),value)){var ruleSelector=".win-container.win-backdrop",ruleBody="background-color:transparent;";addDynamicCssRule(this._disableBackdropClassName,this._site,ruleSelector,ruleBody)}}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(value){if(_ElementUtilities._deprecated(_ErrorMessages.backdropColorIsDeprecated),value&&this._backdropColor!==value){this._backdropColor=value,this._backdropColorClassName&&(deleteDynamicCssRule(this._backdropColorClassName),this._site&&_ElementUtilities.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null),this._backdropColorClassName=uniqueCssClassName("backdropcolor"),this._site&&_ElementUtilities.addClass(this._site.surface,this._backdropColorClassName);var ruleSelector=".win-container.win-backdrop",ruleBody="background-color:"+value+";";addDynamicCssRule(this._backdropColorClassName,this._site,ruleSelector,ruleBody)}}}})}),GridLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LegacyLayout,function(options){options=options||{},this.itemInfo=options.itemInfo,this.groupInfo=options.groupInfo,this._maxRowsOrColumns=0,this._useDefaultItemInfo=!0,this._elementsToMeasure={},this._groupHeaderPosition=options.groupHeaderPosition||HeaderPosition.top,this.orientation=options.orientation||"horizontal",options.maxRows&&(this.maxRows=+options.maxRows),options.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+options.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(value){this._setMaxRowsOrColumns(value)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(maxRows){_ElementUtilities._deprecated(_ErrorMessages.maxRowsIsDeprecated),this.maximumRowsOrColumns=maxRows}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(itemInfo){itemInfo&&_ElementUtilities._deprecated(_ErrorMessages.itemInfoIsDeprecated),this._itemInfo=itemInfo,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(groupInfo){groupInfo&&_ElementUtilities._deprecated(_ErrorMessages.groupInfoIsDeprecated),this._groupInfo=groupInfo,this._invalidateLayout()}}})})});var Groups=_Base.Namespace.defineWithParent(null,null,{UniformGroupBase:_Base.Namespace._lazy(function(){return _Base.Class.define(null,{cleanUp:function(){},itemFromOffset:function(offset,options){options=options||{};var sizes=this._layout._sizes;offset-=sizes.itemsContainerOuterStart,options.wholeItem&&(offset+=(options.last?-1:1)*(sizes.containerSize-1));var lastIndexOfGroup=this.count-1,lastBar=Math.floor(lastIndexOfGroup/this._layout._itemsPerBar),bar=clampToRange(0,lastBar,Math.floor(offset/sizes.containerSize)),index=(bar+options.last)*this._layout._itemsPerBar-options.last;return clampToRange(0,this.count-1,index)},hitTest:function(x,y){var horizontal=this._layout._horizontal,itemsPerBar=this._layout._itemsPerBar,useListSemantics=this._layout._inListMode||1===itemsPerBar,directionalLocation=horizontal?x:y,crossLocation=horizontal?y:x,sizes=this._layout._sizes;directionalLocation-=sizes.itemsContainerOuterStart,crossLocation-=sizes.itemsContainerOuterCrossStart;var insertAfterSlot,bar=Math.floor(directionalLocation/sizes.containerSize),slotInBar=clampToRange(0,itemsPerBar-1,Math.floor(crossLocation/sizes.containerCrossSize)),index=Math.max(-1,bar*itemsPerBar+slotInBar);if(insertAfterSlot=!horizontal&&useListSemantics||horizontal&&!useListSemantics?(y-sizes.containerHeight/2)/sizes.containerHeight:(x-sizes.containerWidth/2)/sizes.containerWidth,useListSemantics)return insertAfterSlot=Math.floor(insertAfterSlot),{index:index,insertAfterIndex:insertAfterSlot>=0&&index>=0?insertAfterSlot:-1};insertAfterSlot=clampToRange(-1,itemsPerBar-1,insertAfterSlot);var insertAfterIndex;return insertAfterIndex=0>insertAfterSlot?bar*itemsPerBar-1:bar*itemsPerBar+Math.floor(insertAfterSlot),{index:clampToRange(-1,this.count-1,index),insertAfterIndex:clampToRange(-1,this.count-1,insertAfterIndex)}},getAdjacent:function(currentItem,pressedKey){var newFocus,index=currentItem.index,currentBar=Math.floor(index/this._layout._itemsPerBar),currentSlot=index%this._layout._itemsPerBar;switch(pressedKey){case Key.upArrow:newFocus=0===currentSlot?"boundary":index-1;break;case Key.downArrow:var isLastIndexOfGroup=index===this.count-1,inLastSlot=this._layout._itemsPerBar>1&&currentSlot===this._layout._itemsPerBar-1;newFocus=isLastIndexOfGroup||inLastSlot?"boundary":index+1;break;case Key.leftArrow:newFocus=0===currentBar&&this._layout._itemsPerBar>1?"boundary":index-this._layout._itemsPerBar;break;case Key.rightArrow:var lastIndexOfGroup=this.count-1,lastBar=Math.floor(lastIndexOfGroup/this._layout._itemsPerBar);newFocus=currentBar===lastBar?"boundary":Math.min(index+this._layout._itemsPerBar,this.count-1)}return"boundary"===newFocus?newFocus:{type:_UI.ObjectType.item,index:newFocus}},getItemsContainerSize:function(){var sizes=this._layout._sizes,barCount=Math.ceil(this.count/this._layout._itemsPerBar);return barCount*sizes.containerSize+sizes.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var sizes=this._layout._sizes;return this._layout._itemsPerBar*sizes.containerCrossSize+sizes.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(itemIndex){var sizes=this._layout._sizes,leftStr=this._layout._site.rtl?"right":"left",containerMargins=this._layout._sizes.containerMargins,coordinates=this._layout._indexToCoordinate(itemIndex),itemPosition={row:coordinates.row,column:coordinates.column,top:containerMargins.top+coordinates.row*sizes.containerHeight,left:containerMargins[leftStr]+coordinates.column*sizes.containerWidth,height:sizes.containerHeight-sizes.containerMargins.top-sizes.containerMargins.bottom,width:sizes.containerWidth-sizes.containerMargins.left-sizes.containerMargins.right};return itemPosition}})}),UniformGroup:_Base.Namespace._lazy(function(){return _Base.Class.derive(Groups.UniformGroupBase,function(layout,itemsContainer){this._layout=layout,this._itemsContainer=itemsContainer,_ElementUtilities.addClass(this._itemsContainer,layout._inListMode?_Constants._uniformListLayoutClass:_Constants._uniformGridLayoutClass)},{cleanUp:function(skipDomCleanUp){skipDomCleanUp||(_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformGridLayoutClass),_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width=""),this._itemsContainer=null,this._layout=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayout:function(itemsCount,oldChangedRealizedRange,oldState,updatedProperties){return this.groupInfo=updatedProperties.groupInfo,this.startIndex=updatedProperties.startIndex,this.count=itemsCount,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var sizes=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-sizes.itemsContainerOuterSize+"px",this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?sizes.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*sizes.containerCrossSize+"px"},layoutUnrealizedRange:function(){return Promise.wrap()}})}),UniformFlowGroup:_Base.Namespace._lazy(function(){return _Base.Class.derive(Groups.UniformGroupBase,function(layout,tree){this._layout=layout,this._itemsContainer=tree.element,_ElementUtilities.addClass(this._itemsContainer,layout._inListMode?_Constants._uniformListLayoutClass:_Constants._uniformGridLayoutClass)},{cleanUp:function(skipDomCleanUp){skipDomCleanUp||(_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformListLayoutClass),_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info"),this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:_Base.Namespace._lazy(function(){return _Base.Class.define(function(layout,itemsContainer){this._layout=layout,this._itemsContainer=itemsContainer,_ElementUtilities.addClass(this._itemsContainer,_Constants._cellSpanningGridLayoutClass),this.resetMap()},{cleanUp:function(skipDomCleanUp){skipDomCleanUp||(this._cleanContainers(),_ElementUtilities.removeClass(this._itemsContainer,_Constants._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText=""),this._itemsContainer=null,this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this.resetMap(),this._slotsPerColumn=null,this._offScreenSlotsPerColumn=null,this._items=null,this._layout=null,this._containersToHide=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayoutWithCopyOfTree:function(tree,oldChangedRealizedRange,oldState,updatedProperties){var i,that=this;if(this._containersToHide={},oldChangedRealizedRange)for(i=oldChangedRealizedRange.firstIndex;i<=oldChangedRealizedRange.lastIndex;i++)this._containersToHide[uniqueID(oldState._items[i])]=oldState._items[i];this.groupInfo=updatedProperties.groupInfo,this.startIndex=updatedProperties.startIndex,this.count=tree.items.length,this._items=tree.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap();var itemInfoPromises=new Array(this.count);for(i=0;i<this.count;i++)itemInfoPromises[i]=this._layout._getItemInfo(this.startIndex+i);return Promise.join(itemInfoPromises).then(function(itemInfos){itemInfos.forEach(function(itemInfo,index){that.addItemToMap(index,itemInfo)})})},layoutRealizedRange:function(firstChangedIndex,realizedRange){if(realizedRange){var i,firstChangedRealizedIndex=Math.max(firstChangedIndex,realizedRange.firstIndex);for(i=firstChangedRealizedIndex;i<=realizedRange.lastIndex;i++)this._layoutItem(i),delete this._containersToHide[uniqueID(this._items[i])]}Object.keys(this._containersToHide).forEach(function(id){_ElementUtilities.removeClass(this._containersToHide[id],_Constants._laidOutClass)}.bind(this)),this._containersToHide={},this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(firstChangedIndex,realizedRange,beforeRealizedRange){var layoutJob,that=this;return that._layoutPromise=new Promise(function(complete){function completeLayout(){layoutJob=null,complete()}function schedule(fn){return Scheduler.schedule(fn,Scheduler.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}if(realizedRange){var stop=!1,before=realizedRange.firstIndex-1,after=Math.max(firstChangedIndex,realizedRange.lastIndex+1);after=Math.max(before+1,after),layoutJob=schedule(function unrealizedRangeWork(info){for(;!stop;){if(info.shouldYield)return void info.setWork(unrealizedRangeWork);stop=!0,before>=firstChangedIndex&&(that._layoutItem(before),before--,stop=!1),after<that.count&&(that._layoutItem(after),after++,stop=!1)}completeLayout()})}else if(beforeRealizedRange){var i=that.count-1;layoutJob=schedule(function beforeRealizedRangeWork(info){for(;i>=firstChangedIndex;i--){if(info.shouldYield)return void info.setWork(beforeRealizedRangeWork);that._layoutItem(i)}completeLayout()})}else{var i=firstChangedIndex;layoutJob=schedule(function afterRealizedRangeWork(info){for(;i<that.count;i++){if(info.shouldYield)return void info.setWork(afterRealizedRangeWork);that._layoutItem(i)}completeLayout()})}},function(){layoutJob&&layoutJob.cancel(),layoutJob=null}),that._layoutPromise},itemFromOffset:function(offset,options){options=options||{};var sizes=this._layout._sizes,margins=sizes.containerMargins;offset-=sizes.itemsContainerOuterX,offset-=(options.last?1:-1)*margins[options.last?"left":"right"];var value=this.indexFromOffset(offset,options.wholeItem,options.last).item;return clampToRange(0,this.count-1,value)},getAdjacent:function(currentItem,pressedKey){var index,originalIndex;index=originalIndex=currentItem.index;var newIndex,inMap,inMapIndex;inMapIndex=this.lastAdjacent===index?this.lastInMapIndex:this.findItem(index);do{var column=Math.floor(inMapIndex/this._slotsPerColumn),row=inMapIndex-column*this._slotsPerColumn,lastColumn=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(pressedKey){case Key.upArrow:if(!(row>0))return{type:_UI.ObjectType.item,index:originalIndex};inMapIndex--;break;case Key.downArrow:if(!(row+1<this._slotsPerColumn))return{type:_UI.ObjectType.item,index:originalIndex};inMapIndex++;break;case Key.leftArrow:inMapIndex=column>0?inMapIndex-this._slotsPerColumn:-1;break;case Key.rightArrow:inMapIndex=lastColumn>column?inMapIndex+this._slotsPerColumn:this.occupancyMap.length}inMap=inMapIndex>=0&&inMapIndex<this.occupancyMap.length,inMap&&(newIndex=this.occupancyMap[inMapIndex]?this.occupancyMap[inMapIndex].index:void 0)}while(inMap&&(index===newIndex||void 0===newIndex));return this.lastAdjacent=newIndex,this.lastInMapIndex=inMapIndex,inMap?{type:_UI.ObjectType.item,index:newIndex}:"boundary"},hitTest:function(x,y){var sizes=this._layout._sizes,itemIndex=0;if(x-=sizes.itemsContainerOuterX,y-=sizes.itemsContainerOuterY,this.occupancyMap.length>0){for(var result=this.indexFromOffset(x,!1,0),counter=Math.min(this._slotsPerColumn-1,Math.floor(y/this.groupInfo.cellHeight)),curr=result.index,lastValidIndex=curr;counter-- >0;)curr++,this.occupancyMap[curr]&&(lastValidIndex=curr);this.occupancyMap[lastValidIndex]||lastValidIndex--,itemIndex=this.occupancyMap[lastValidIndex].index}var itemSize=this.getItemSize(itemIndex),itemLeft=itemSize.column*this.groupInfo.cellWidth,itemTop=itemSize.row*this.groupInfo.cellHeight,useListSemantics=1===this._slotsPerColumn,insertAfterIndex=itemIndex;return(useListSemantics&&x<itemLeft+itemSize.contentWidth/2||!useListSemantics&&y<itemTop+itemSize.contentHeight/2)&&insertAfterIndex--,{type:_UI.ObjectType.item,index:clampToRange(0,this.count-1,itemIndex),insertAfterIndex:clampToRange(-1,this.count-1,insertAfterIndex)}},getItemsContainerSize:function(){var sizes=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+sizes.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var sizes=this._layout._sizes;return sizes.maxItemsContainerContentSize+sizes.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(itemIndex){var leftStr=this._layout._site.rtl?"right":"left",containerMargins=this._layout._sizes.containerMargins,coordinates=this.getItemSize(itemIndex),groupInfo=this.groupInfo,itemPosition={row:coordinates.row,column:coordinates.column,top:containerMargins.top+coordinates.row*groupInfo.cellHeight,left:containerMargins[leftStr]+coordinates.column*groupInfo.cellWidth,height:coordinates.contentHeight,width:coordinates.contentWidth};return itemPosition},_layoutItem:function(index){var entry=this.getItemSize(index);return this._items[index].style.cssText+=";-ms-grid-row:"+(entry.row+1)+";-ms-grid-column:"+(entry.column+1)+";-ms-grid-row-span:"+entry.rows+";-ms-grid-column-span:"+entry.columns+";height:"+entry.contentHeight+"px;width:"+entry.contentWidth+"px",_ElementUtilities.addClass(this._items[index],_Constants._laidOutClass),this._items[index]},_cleanContainers:function(){var i,items=this._items,len=items.length;for(i=0;len>i;i++)items[i].style.cssText="",_ElementUtilities.removeClass(items[i],_Constants._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var index=-1;return this.occupancyMap.forEach(function(item){item.index>index&&(index=item.index)}),index+1},coordinateToIndex:function(c,r){return c*this._slotsPerColumn+r},markSlotAsFull:function(index,itemEntry){for(var coordinates=this._layout._indexToCoordinate(index,this._slotsPerColumn),toRow=coordinates.row+itemEntry.rows,r=coordinates.row;toRow>r&&r<this._slotsPerColumn;r++)for(var c=coordinates.column,toColumn=coordinates.column+itemEntry.columns;toColumn>c;c++)this.occupancyMap[this.coordinateToIndex(c,r)]=itemEntry;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,toRow-this._slotsPerColumn)},isSlotEmpty:function(itemSize,row,column){for(var r=row,toRow=row+itemSize.rows;toRow>r;r++)for(var c=column,toColumn=column+itemSize.columns;toColumn>c;c++)if(r>=this._slotsPerColumn||void 0!==this.occupancyMap[this.coordinateToIndex(c,r)])return!1;return!0},findEmptySlot:function(startIndex,itemSize,newColumn){var coordinates=this._layout._indexToCoordinate(startIndex,this._slotsPerColumn),startRow=coordinates.row,lastColumn=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);if(newColumn){for(var c=coordinates.column+1;lastColumn>=c;c++)if(this.isSlotEmpty(itemSize,0,c))return this.coordinateToIndex(c,0)}else for(var c=coordinates.column;lastColumn>=c;c++){for(var r=startRow;r<this._slotsPerColumn;r++)if(this.isSlotEmpty(itemSize,r,c))return this.coordinateToIndex(c,r);startRow=0}return(lastColumn+1)*this._slotsPerColumn},findItem:function(index){for(var inMapIndex=index,len=this.occupancyMap.length;len>inMapIndex;inMapIndex++){var entry=this.occupancyMap[inMapIndex];if(entry&&entry.index===index)return inMapIndex}return inMapIndex},getItemSize:function(index){var inMapIndex=this.findItem(index),entry=this.occupancyMap[inMapIndex],coords=this._layout._indexToCoordinate(inMapIndex,this._slotsPerColumn);return index===entry.index?{row:coords.row,column:coords.column,contentWidth:entry.contentWidth,contentHeight:entry.contentHeight,columns:entry.columns,rows:entry.rows}:null},resetMap:function(){this.occupancyMap=[],this.lastAdded=0,this._offScreenSlotsPerColumn=0},addItemToMap:function(index,itemInfo){function add(mapEntry,newColumn){var inMapIndex=that.findEmptySlot(that.lastAdded,mapEntry,newColumn);that.lastAdded=inMapIndex,that.markSlotAsFull(inMapIndex,mapEntry);
}var that=this,groupInfo=that.groupInfo,margins=that._layout._sizes.containerMargins,mapEntry={index:index,contentWidth:itemInfo.width,contentHeight:itemInfo.height,columns:Math.max(1,Math.ceil((itemInfo.width+margins.left+margins.right)/groupInfo.cellWidth)),rows:Math.max(1,Math.ceil((itemInfo.height+margins.top+margins.bottom)/groupInfo.cellHeight))};add(mapEntry,itemInfo.newColumn)},indexFromOffset:function(adjustedOffset,wholeItem,last){var measuredWidth=0,lastItem=0,groupInfo=this.groupInfo,index=0;if(this.occupancyMap.length>0){if(lastItem=this.getOccupancyMapItemCount()-1,measuredWidth=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*groupInfo.cellWidth,measuredWidth>adjustedOffset){for(var counter=this._slotsPerColumn,index=(Math.max(0,Math.floor(adjustedOffset/groupInfo.cellWidth))+last)*this._slotsPerColumn-last;!this.occupancyMap[index]&&counter-- >0;)index+=last>0?-1:1;return{index:index,item:this.occupancyMap[index].index}}index=this.occupancyMap.length-1}return{index:index,item:lastItem+(Math.max(0,Math.floor((adjustedOffset-measuredWidth)/groupInfo.cellWidth))+last)*this._slotsPerColumn-last}}})})});_Base.Namespace._moduleDefine(exports,"WinJS.UI",{ListLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LegacyLayout,function(options){options=options||{},this._itemInfo={},this._groupInfo={},this._groupHeaderPosition=options.groupHeaderPosition||HeaderPosition.top,this._inListMode=!0,this.orientation=options.orientation||"vertical"},{initialize:function(site,groupsEnabled){_ElementUtilities.addClass(site.surface,_Constants._listLayoutClass),exports._LegacyLayout.prototype.initialize.call(this,site,groupsEnabled)},uninitialize:function(){this._site&&_ElementUtilities.removeClass(this._site.surface,_Constants._listLayoutClass),exports._LegacyLayout.prototype.uninitialize.call(this)},layout:function(tree,changedRange,modifiedItems,modifiedGroups){return this._groupsEnabled||this._horizontal?exports._LegacyLayout.prototype.layout.call(this,tree,changedRange,modifiedItems,modifiedGroups):this._layoutNonGroupedVerticalList(tree,changedRange,modifiedItems,modifiedGroups)},_layoutNonGroupedVerticalList:function(tree,changedRange,modifiedItems,modifiedGroups){var that=this,perfId="Layout:_layoutNonGroupedVerticalList";return that._site._writeProfilerMark(perfId+",StartTM"),this._layoutPromise=that._measureItem(0).then(function(){_ElementUtilities[that._usingStructuralNodes?"addClass":"removeClass"](that._site.surface,_Constants._structuralNodesClass),_ElementUtilities[that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?"addClass":"removeClass"](that._site.surface,_Constants._singleItemsBlockClass),that._sizes.viewportContentSize!==that._getViewportCrossSize()&&that._viewportSizeChanged(that._getViewportCrossSize()),that._cacheRemovedElements(modifiedItems,that._cachedItemRecords,that._cachedInsertedItemRecords,that._cachedRemovedItems,!1),that._cacheRemovedElements(modifiedGroups,that._cachedHeaderRecords,that._cachedInsertedHeaderRecords,that._cachedRemovedHeaders,!0);var itemsContainer=tree[0].itemsContainer,group=new Groups.UniformFlowGroup(that,itemsContainer);that._groups=[group],group.groupInfo={enableCellSpanning:!1},group.startIndex=0,group.count=getItemsContainerLength(itemsContainer),group.offset=0,group.layout(),that._site._writeProfilerMark(perfId+":setSurfaceWidth,info"),that._site.surface.style.width=that._sizes.surfaceContentSize+"px",that._layoutAnimations(modifiedItems,modifiedGroups),that._site._writeProfilerMark(perfId+":complete,info"),that._site._writeProfilerMark(perfId+",StopTM")},function(error){return that._site._writeProfilerMark(perfId+":canceled,info"),that._site._writeProfilerMark(perfId+",StopTM"),Promise.wrapError(error)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){var that=this;return this._measureItem(0).then(function(){return that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?(that._usingStructuralNodes=!0,Number.MAX_VALUE):(that._usingStructuralNodes=exports.ListLayout._numberOfItemsPerItemsBlock>0,exports.ListLayout._numberOfItemsPerItemsBlock)})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LayoutCommon,function(options){options=options||{},this._itemInfo=options.itemInfo,this._groupInfo=options.groupInfo,this._groupHeaderPosition=options.groupHeaderPosition||HeaderPosition.top,this._horizontal=!0,this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(value){this._setMaxRowsOrColumns(value)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(itemInfo){this._itemInfo=itemInfo,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(groupInfo){this._groupInfo=groupInfo,this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:_Base.Namespace._lazy(function(){return _Base.Class.define(function(layout){this.defaultAnimations=!0,this.initialize=function(site,groupsEnabled){layout.initialize(site,groupsEnabled)},this.hitTest=function(x,y){return layout.hitTest(x,y)},layout.uninitialize&&(this.uninitialize=function(){layout.uninitialize()}),"numberOfItemsPerItemsBlock"in layout&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return layout.numberOfItemsPerItemsBlock}}),layout._getItemPosition&&(this._getItemPosition=function(index){return layout._getItemPosition(index)}),layout.itemsFromRange&&(this.itemsFromRange=function(start,end){return layout.itemsFromRange(start,end)}),layout.getAdjacent&&(this.getAdjacent=function(currentItem,pressedKey){return layout.getAdjacent(currentItem,pressedKey)}),layout.dragOver&&(this.dragOver=function(x,y,dragInfo){return layout.dragOver(x,y,dragInfo)}),layout.dragLeave&&(this.dragLeave=function(){return layout.dragLeave()});var propertyDefinition={enumerable:!0,get:function(){return"vertical"}};if(void 0!==layout.orientation&&(propertyDefinition.get=function(){return layout.orientation},propertyDefinition.set=function(value){layout.orientation=value}),Object.defineProperty(this,"orientation",propertyDefinition),(layout.setupAnimations||layout.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return layout.setupAnimations()},this.executeAnimations=function(){return layout.executeAnimations()}),layout.layout)if(this.defaultAnimations){var that=this;this.layout=function(tree,changedRange,modifiedItems,modifiedGroups){var synchronous,promises=normalizeLayoutPromises(layout.layout(tree,changedRange,[],[]));return promises.realizedRangeComplete.then(function(){synchronous=!0}),synchronous&&that._layoutAnimations(modifiedItems,modifiedGroups),promises}}else this.layout=function(tree,changedRange,modifiedItems,modifiedGroups){return normalizeLayoutPromises(layout.layout(tree,changedRange,modifiedItems,modifiedGroups))}},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(tree,changedRange,modifiedItems,modifiedGroups){return this.defaultAnimations&&this._layoutAnimations(modifiedItems,modifiedGroups),normalizeLayoutPromises()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(currentItem,pressedKey){switch(pressedKey){case Key.pageUp:case Key.upArrow:case Key.leftArrow:return{type:currentItem.type,index:currentItem.index-1};case Key.downArrow:case Key.rightArrow:case Key.pageDown:return{type:currentItem.type,index:currentItem.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})});var HeaderPosition={left:"left",top:"top"};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{HeaderPosition:HeaderPosition,_getMargins:getMargins})}),define("WinJS/Controls/ListView/_VirtualizeContentsView",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_Helpers","./_ItemsContainer"],function(exports,_Global,_Base,_BaseUtils,Promise,_Signal,Scheduler,_Dispose,_ElementUtilities,_SafeHtml,_UI,_Constants,_ItemEventsHandler,_Helpers,_ItemsContainer){"use strict";function setFlow(from,to){_ElementUtilities._setAttribute(from,"aria-flowto",to.id),_ElementUtilities._setAttribute(to,"x-ms-aria-flowfrom",from.id)}_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_VirtualizeContentsView:_Base.Namespace._lazy(function(){function cooperativeQueueWorker(info){for(var work,workItems=info.job._workItems;workItems.length&&!info.shouldYield;)(work=workItems.shift())();info.setWork(cooperativeQueueWorker),workItems.length||info.job.pause()}function scheduleQueueJob(priority,name){var job=Scheduler.schedule(cooperativeQueueWorker,priority,null,name);return job._workItems=[],job.addWork=function(work,head){head?this._workItems.unshift(work):this._workItems.push(work),this.resume()},job.clearWork=function(){this._workItems.length=0},job.dispose=function(){this.cancel(),this._workItems.length=0},job}function shouldWaitForSeZo(listView){return listView._zooming||listView._pinching}function waitForSeZo(listView,timeout){return listView._isZombie()?Promise.wrap():shouldWaitForSeZo(listView)?(+timeout!==timeout&&(timeout=_VirtualizeContentsView._waitForSeZoTimeoutDuration),Promise.timeout(_VirtualizeContentsView._waitForSeZoIntervalDuration).then(function(){return timeout-=_VirtualizeContentsView._waitForSeZoIntervalDuration,0>=timeout?!0:waitForSeZo(listView,timeout)})):Promise.wrap()}function makeFunctor(scrollToFunctor){if("number"==typeof scrollToFunctor){var pos=scrollToFunctor;scrollToFunctor=function(){return{position:pos,direction:"right"}}}return scrollToFunctor}function nop(){}var _VirtualizeContentsView=_Base.Class.define(function(listView){this._listView=listView,this._forceRelayout=!1,this.maxLeadingPages=_BaseUtils._isiOS?_VirtualizeContentsView._iOSMaxLeadingPages:_VirtualizeContentsView._defaultPagesToPrefetch,this.maxTrailingPages=_BaseUtils._isiOS?_VirtualizeContentsView._iOSMaxTrailingPages:_VirtualizeContentsView._defaultPagesToPrefetch,this.items=new _ItemsContainer._ItemsContainer(listView),this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this.begin=0,this.end=0,this._realizePass=1,this._firstLayoutPass=!0,this._runningAnimations=null,this._renderCompletePromise=Promise.wrap(),this._state=new CreatedState(this),this._createLayoutSignal(),this._createTreeBuildingSignal(),this._layoutWork=null,this._onscreenJob=scheduleQueueJob(Scheduler.Priority.aboveNormal,"on-screen items"),this._frontOffscreenJob=scheduleQueueJob(Scheduler.Priority.normal,"front off-screen items"),this._backOffscreenJob=scheduleQueueJob(Scheduler.Priority.belowNormal,"back off-screen items"),this._scrollbarPos=0,this._direction="right",this._scrollToFunctor=makeFunctor(0)},{_dispose:function(){this.cleanUp(),this.items=null,this._renderCompletePromise&&this._renderCompletePromise.cancel(),this._renderCompletePromise=null,this._onscreenJob.dispose(),this._frontOffscreenJob.dispose(),this._backOffscreenJob.dispose()},_createItem:function(itemIndex,itemPromise,available,unavailable){this._listView._writeProfilerMark("createItem("+itemIndex+") "+this._getBoundingRectString(itemIndex)+",info");var that=this;that._listView._itemsManager._itemFromItemPromiseThrottled(itemPromise).done(function(element){element?available(itemIndex,element,that._listView._itemsManager._recordFromElement(element)):unavailable(itemIndex)},function(err){return unavailable(itemIndex),Promise.wrapError(err)})},_addItem:function(fragment,itemIndex,element,currentPass){if(this._realizePass===currentPass){var record=this._listView._itemsManager._recordFromElement(element);delete this._pendingItemPromises[record.itemPromise.handle],this.items.setItemAt(itemIndex,{itemBox:null,container:null,element:element,detached:!0,itemsManagerRecord:record})}},lastItemIndex:function(){return this.containers?this.containers.length-1:-1},_setSkipRealizationForChange:function(skip){skip?this._realizationLevel!==_VirtualizeContentsView._realizationLevel.realize&&(this._realizationLevel=_VirtualizeContentsView._realizationLevel.skip):this._realizationLevel=_VirtualizeContentsView._realizationLevel.realize},_realizeItems:function(fragment,begin,end,count,currentPass,scrollbarPos,direction,firstInView,lastInView,ignoreGaps){function itemIsReady(itemIndex,itemsManagerRecord){renderCompletePromises.push(Promise._cancelBlocker(itemsManagerRecord.renderComplete)),delivered(itemIndex)}function appendItemsToDom(startIndex,endIndex){function updateDraggable(itemData,element){itemData.updatedDraggableAttribute||!that._listView.itemsDraggable&&!that._listView.itemsReorderable||itemData.itemsManagerRecord.renderComplete.done(function(){that._realizePass===currentPass&&(_ElementUtilities.hasClass(element,_Constants._nonDraggableClass)||(itemData.itemBox.draggable=!0),itemData.updatedDraggableAttribute=!0)})}if(that._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!that._listView._isZombie()){var itemIndex,appendItemsCount=0,firstIndex=-1,lastIndex=-1;for(itemIndex=startIndex;endIndex>=itemIndex;itemIndex++){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var element=itemData.element,itemBox=itemData.itemBox;itemBox||(itemBox=that._listView._itemBoxTemplate.cloneNode(!0),itemData.itemBox=itemBox,itemBox.appendChild(element),_ElementUtilities.addClass(element,_Constants._itemClass),that._listView._setupAriaSelectionObserver(element),that._listView._isSelected(itemIndex)&&_ItemEventsHandler._ItemEventsHandler.renderSelection(itemBox,element,!0,!0),that._listView._currentMode().renderDragSourceOnRealizedItem(itemIndex,itemBox)),updateDraggable(itemData,element);var container=that.getContainer(itemIndex);itemBox.parentNode!==container&&(itemData.container=container,that._appendAndRestoreFocus(container,itemBox),appendItemsCount++,0>firstIndex&&(firstIndex=itemIndex),lastIndex=itemIndex,that._listView._isSelected(itemIndex)&&_ElementUtilities.addClass(container,_Constants._selectedClass),_ElementUtilities.removeClass(container,_Constants._backdropClass),that.items.elementAvailable(itemIndex))}}that._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM"),appendItemsCount>0&&(that._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+appendItemsCount+" ("+firstIndex+"-"+lastIndex+"),info"),that._reportElementsLevel(direction))}}function removeGaps(first,last,begin,end){function testGap(itemIndex,foundMissing){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var itemBox=itemData.itemBox;return itemBox&&itemBox.parentNode?foundMissing?(_ElementUtilities.addClass(itemBox.parentNode,_Constants._backdropClass),itemBox.parentNode.removeChild(itemBox),!0):!1:!0}return!0}if(!ignoreGaps){for(var foundMissing=!1;first>=begin;)foundMissing=testGap(first,foundMissing),first--;for(foundMissing=!1;end>=last;)foundMissing=testGap(last,foundMissing),last++}}function scheduleReadySignal(first,last,job,dir,head){function schedule(itemIndex){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var record=itemData.itemsManagerRecord;record.readyComplete||that._realizePass!==currentPass||job.addWork(function(){that._listView._isZombie()||record.pendingReady&&that._realizePass===currentPass&&(that._listView._writeProfilerMark("pendingReady("+itemIndex+"),info"),record.pendingReady())},head)}}for(var promises=[],i=first;last>=i;i++){var itemData=that.items.itemDataAt(i);itemData&&promises.push(itemData.itemsManagerRecord.itemPromise)}Promise.join(promises).then(function(){if("right"===dir)for(var i=first;last>=i;i++)schedule(i);else for(var i=last;i>=first;i--)schedule(i)})}function delivered(index){if(that._realizePass===currentPass){if(index>=firstInView&&lastInView>=index){if(0===--inViewCounter){if(appendItemsToDom(firstInView,lastInView),removeGaps(firstInView,lastInView,begin,end),that._firstLayoutPass){scheduleReadySignal(firstInView,lastInView,that._frontOffscreenJob,"right"===direction?"left":"right",!0);var entranceAnimation=Scheduler.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!that._listView._isZombie()){that._listView._writeProfilerMark("entranceAnimation,StartTM");var promise=that._listView._animateListEntrance(!that._firstEntranceAnimated);return that._firstEntranceAnimated=!0,promise}});that._runningAnimations=Promise.join([that._runningAnimations,entranceAnimation]),that._runningAnimations.done(function(){that._listView._writeProfilerMark("entranceAnimation,StopTM"),that._realizePass===currentPass&&(that._runningAnimations=null,entranceAnimationSignal.complete())}),that._firstLayoutPass=!1,that._listView._isCurrentZoomView&&Scheduler.requestDrain(that._onscreenJob.priority)}else scheduleReadySignal(firstInView,lastInView,that._frontOffscreenJob,direction),entranceAnimationSignal.complete();that._updateHeaders(that._listView._canvas,firstInView,lastInView+1).done(function(){viewportItemsRealized.complete()})}}else firstInView>index?(--leftOffscreenCount,leftOffscreenCount%inView===0&&appendItemsToDom(begin,firstInView-1),leftOffscreenCount||(that._updateHeaders(that._listView._canvas,begin,firstInView).done(function(){"right"!==direction&&frontItemsRealized.complete()}),scheduleReadySignal(begin,firstInView-1,"right"!==direction?that._frontOffscreenJob:that._backOffscreenJob,"left"))):index>lastInView&&(--rightOffscreenCount,rightOffscreenCount%inView===0&&appendItemsToDom(lastInView+1,end-1),rightOffscreenCount||(that._updateHeaders(that._listView._canvas,lastInView+1,end).then(function(){"right"===direction&&frontItemsRealized.complete()}),scheduleReadySignal(lastInView+1,end-1,"right"===direction?that._frontOffscreenJob:that._backOffscreenJob,"right")));counter--,0===counter&&(that._renderCompletePromise=Promise.join(renderCompletePromises).then(null,function(e){var error=Array.isArray(e)&&e.some(function(item){return item&&!(item instanceof Error&&"Canceled"===item.name)});return error?Promise.wrapError(e):void 0}),(that._headerRenderPromises||Promise.wrap()).done(function(){Scheduler.schedule(function(){that._listView._isZombie()?workCompleteSignal.cancel():workCompleteSignal.complete()},Math.min(that._onscreenJob.priority,that._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function newItemIsReady(itemIndex,element,itemsManagerRecord){if(that._realizePass===currentPass){var element=itemsManagerRecord.element;that._addItem(fragment,itemIndex,element,currentPass),itemIsReady(itemIndex,itemsManagerRecord)}}var perfId="_realizeItems("+begin+"-"+(end-1)+") visible("+firstInView+"-"+lastInView+")";this._listView._writeProfilerMark(perfId+",StartTM"),direction=direction||"right";var counter=end-begin,inView=lastInView-firstInView+1,inViewCounter=inView,rightOffscreenCount=end-lastInView-1,leftOffscreenCount=firstInView-begin,renderCompletePromises=[],entranceAnimationSignal=new _Signal,viewportItemsRealized=new _Signal,frontItemsRealized=new _Signal,that=this;if(counter>0){var createCount=0,updateCount=0,cleanCount=0;that.firstIndexDisplayed=firstInView,that.lastIndexDisplayed=lastInView;var isCurrentZoomView=that._listView._isCurrentZoomView;that._highPriorityRealize&&(that._firstLayoutPass||that._hasAnimationInViewportPending)?(that._highPriorityRealize=!1,that._onscreenJob.priority=Scheduler.Priority.high,that._frontOffscreenJob.priority=Scheduler.Priority.normal,that._backOffscreenJob.priority=Scheduler.Priority.belowNormal):that._highPriorityRealize?(that._highPriorityRealize=!1,that._onscreenJob.priority=Scheduler.Priority.high,that._frontOffscreenJob.priority=Scheduler.Priority.high-1,that._backOffscreenJob.priority=Scheduler.Priority.high-1):isCurrentZoomView?(that._onscreenJob.priority=Scheduler.Priority.aboveNormal,that._frontOffscreenJob.priority=Scheduler.Priority.normal,that._backOffscreenJob.priority=Scheduler.Priority.belowNormal):(that._onscreenJob.priority=Scheduler.Priority.belowNormal,that._frontOffscreenJob.priority=Scheduler.Priority.idle,that._backOffscreenJob.priority=Scheduler.Priority.idle);var workCompleteSignal=new _Signal,cancelToken=that._listView._versionManager.cancelOnNotification(workCompleteSignal.promise),queueStage1AfterStage0=function(job,record){record.startStage1&&record.stage0.then(function(){that._realizePass===currentPass&&record.startStage1&&job.addWork(record.startStage1)})},queueWork=function(job,itemIndex){var itemData=that.items.itemDataAt(itemIndex);if(!itemData){var itemPromise=that._listView._itemsManager._itemPromiseAtIndex(itemIndex);that._pendingItemPromises[itemPromise.handle]=itemPromise,delete that._previousRealizationPendingItemPromises[itemPromise.handle],job.addWork(function(){if(!that._listView._isZombie()&&(createCount++,that._createItem(itemIndex,itemPromise,newItemIsReady,delivered),!that._listView._isZombie()&&that._realizePass===currentPass&&itemPromise.handle)){var record=that._listView._itemsManager._recordFromHandle(itemPromise.handle);queueStage1AfterStage0(job,record)}})}},queueRight=function(job,first,last){for(var itemIndex=first;last>=itemIndex;itemIndex++)queueWork(job,itemIndex)},queueLeft=function(job,first,last){for(var itemIndex=last;itemIndex>=first;itemIndex--)queueWork(job,itemIndex)},handleExistingRange=function(job,first,last){for(var itemIndex=first;last>=itemIndex;itemIndex++){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var record=itemData.itemsManagerRecord;itemIsReady(itemIndex,record),updateCount++,queueStage1AfterStage0(job,record)}}};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{},this._pendingItemPromises={};var emptyFront;"left"===direction?(queueLeft(that._onscreenJob,firstInView,lastInView),queueLeft(that._frontOffscreenJob,begin,firstInView-1),emptyFront=begin>firstInView-1):(queueRight(that._onscreenJob,firstInView,lastInView),queueRight(that._frontOffscreenJob,lastInView+1,end-1),emptyFront=lastInView+1>end-1);for(var i=0,handles=Object.keys(this._previousRealizationPendingItemPromises),len=handles.length;len>i;i++){var handle=handles[i];that._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[handle])}this._previousRealizationPendingItemPromises={},handleExistingRange(that._onscreenJob,firstInView,lastInView),"left"===direction?handleExistingRange(that._frontOffscreenJob,begin,firstInView-1):handleExistingRange(that._frontOffscreenJob,lastInView+1,end-1);var showProgress=inViewCounter===lastInView-firstInView+1;return that._firstLayoutPass?that._listView._canvas.style.opacity=0:showProgress?that._listView._showProgressBar(that._listView._element,"50%","50%"):that._listView._hideProgressBar(),that._frontOffscreenJob.pause(),that._backOffscreenJob.pause(),viewportItemsRealized.promise.done(function(){that._frontOffscreenJob.resume(),emptyFront&&frontItemsRealized.complete()},function(){workCompleteSignal.cancel()}),frontItemsRealized.promise.done(function(){that._listView._writeProfilerMark("frontItemsRealized,info"),"left"===direction?(queueRight(that._backOffscreenJob,lastInView+1,end-1),handleExistingRange(that._backOffscreenJob,lastInView+1,end-1)):(queueLeft(that._backOffscreenJob,begin,firstInView-1),handleExistingRange(that._backOffscreenJob,begin,firstInView-1)),that._backOffscreenJob.resume()}),workCompleteSignal.promise.done(function(){that._listView._versionManager.clearCancelOnNotification(cancelToken),that._listView._writeProfilerMark(perfId+" complete(created:"+createCount+" updated:"+updateCount+"),info")},function(err){return that._listView._versionManager.clearCancelOnNotification(cancelToken),that._onscreenJob.clearWork(),that._frontOffscreenJob.clearWork(),that._backOffscreenJob.clearWork(),entranceAnimationSignal.cancel(),viewportItemsRealized.cancel(),that._listView._writeProfilerMark(perfId+" canceled(created:"+createCount+" updated:"+updateCount+" clean:"+cleanCount+"),info"),Promise.wrapError(err)}),that._listView._writeProfilerMark(perfId+",StopTM"),{viewportItemsRealized:viewportItemsRealized.promise,allItemsRealized:workCompleteSignal.promise,loadingCompleted:Promise.join([workCompleteSignal.promise,entranceAnimationSignal.promise]).then(function(){for(var promises=[],i=begin;end>i;i++){var itemData=that.items.itemDataAt(i);itemData&&promises.push(itemData.itemsManagerRecord.itemReadyPromise)}return Promise._cancelBlocker(Promise.join(promises))})}}return that._listView._writeProfilerMark(perfId+",StopTM"),{viewportItemsRealized:Promise.wrap(),allItemsRealized:Promise.wrap(),loadingCompleted:Promise.wrap()}},_setAnimationInViewportState:function(modifiedElements){if(this._hasAnimationInViewportPending=!1,modifiedElements&&modifiedElements.length>0)for(var viewportLength=this._listView._getViewportLength(),range=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+viewportLength-1),i=0,len=modifiedElements.length;len>i;i++){var modifiedElement=modifiedElements[i];if(modifiedElement.newIndex>=range.firstIndex&&modifiedElement.newIndex<=range.lastIndex&&modifiedElement.newIndex!==modifiedElement.oldIndex){this._hasAnimationInViewportPending=!0;break}}},_addHeader:function(fragment,groupIndex){var that=this;return this._listView._groups.renderGroup(groupIndex).then(function(header){if(header){header.element.tabIndex=0;var placeholder=that._getHeaderContainer(groupIndex);header.element.parentNode!==placeholder&&(placeholder.appendChild(header.element),_ElementUtilities.addClass(header.element,_Constants._headerClass)),that._listView._groups.setDomElement(groupIndex,header.element)}})},_updateHeaders:function(fragment,begin,end){function updateGroup(index){var group=that._listView._groups.group(index);if(group&&!group.header){var headerPromise=group.headerPromise;return headerPromise||(headerPromise=group.headerPromise=that._addHeader(fragment,index),headerPromise.done(function(){group.headerPromise=null},function(){group.headerPromise=null})),headerPromise}return Promise.wrap()}function done(){that._headerRenderPromises=null}var that=this;this._listView._groups.removeElements();var groupStart=this._listView._groups.groupFromItem(begin),groupIndex=groupStart,groupEnd=this._listView._groups.groupFromItem(end-1),realizationPromises=[];if(null!==groupIndex)for(;groupEnd>=groupIndex;groupIndex++)realizationPromises.push(updateGroup(groupIndex));return this._headerRenderPromises=Promise.join(realizationPromises,this._headerRenderPromises).then(done,done),this._headerRenderPromises||Promise.wrap()},_unrealizeItem:function(itemIndex){var focusedItemPurged,listView=this._listView;this._listView._writeProfilerMark("_unrealizeItem("+itemIndex+"),info");var focused=listView._selection._getFocused();focused.type===_UI.ObjectType.item&&focused.index===itemIndex&&(listView._unsetFocusOnItem(),focusedItemPurged=!0);var itemData=this.items.itemDataAt(itemIndex),item=itemData.element,itemBox=itemData.itemBox;itemBox&&itemBox.parentNode&&(_ElementUtilities.removeClass(itemBox.parentNode,_Constants._selectedClass),_ElementUtilities.removeClass(itemBox.parentNode,_Constants._footprintClass),_ElementUtilities.addClass(itemBox.parentNode,_Constants._backdropClass),itemBox.parentNode.removeChild(itemBox)),itemData.container=null,listView._currentMode().itemUnrealized&&listView._currentMode().itemUnrealized(itemIndex,itemBox),this.items.removeItem(itemIndex),itemData.removed||listView._itemsManager.releaseItem(item),_Dispose._disposeElement(item),focusedItemPurged&&listView._setFocusOnItem(listView._selection._getFocused())},_unrealizeGroup:function(group){var focusedItemPurged,headerElement=group.header,focused=this._listView._selection._getFocused();focused.type===_UI.ObjectType.groupHeader&&this._listView._groups.group(focused.index)===group&&(this._listView._unsetFocusOnItem(),focusedItemPurged=!0),headerElement.parentNode&&headerElement.parentNode.removeChild(headerElement),_Dispose._disposeElement(headerElement),group.header=null,group.left=-1,group.top=-1,focusedItemPurged&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(remove){var that=this,removedCount=0;this.items.eachIndex(function(index){return index<that.begin||index>=that.end?(that._unrealizeItem(index),remove&&++removedCount>=remove):void 0});var groups=this._listView._groups,beginGroup=groups.groupFromItem(this.begin);if(null!==beginGroup)for(var endGroup=groups.groupFromItem(this.end-1),i=0,len=groups.length();len>i;i++){var group=groups.group(i);(beginGroup>i||i>endGroup)&&group.header&&this._unrealizeGroup(group)}},_unrealizeExcessiveItems:function(){var realized=this.items.count(),needed=this.end-this.begin,approved=needed+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+realized+") approved("+approved+"),info"),realized>approved&&this._unrealizeItems(realized-approved)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var that=this;return waitForSeZo(this._listView).then(function(){function done(){that._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}if(that._listView._isZombie())return void done();var itemsToUnrealize=[];that.items.eachIndex(function(index){(index<that.begin||index>=that.end)&&itemsToUnrealize.push(index)}),that._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+itemsToUnrealize.length+"),info");var groupsToUnrealize=[],groups=that._listView._groups,beginGroup=groups.groupFromItem(that.begin);if(null!==beginGroup)for(var endGroup=groups.groupFromItem(that.end-1),i=0,len=groups.length();len>i;i++){var group=groups.group(i);(beginGroup>i||i>endGroup)&&group.header&&groupsToUnrealize.push(group)}if(itemsToUnrealize.length||groupsToUnrealize.length){var job,promise=new Promise(function(complete){function unrealizeWorker(info){if(!that._listView._isZombie()){for(var firstIndex=-1,lastIndex=-1,removeCount=0,zooming=shouldWaitForSeZo(that._listView);itemsToUnrealize.length&&!zooming&&!info.shouldYield;){var itemIndex=itemsToUnrealize.shift();that._unrealizeItem(itemIndex),removeCount++,0>firstIndex&&(firstIndex=itemIndex),lastIndex=itemIndex}for(that._listView._writeProfilerMark("unrealizeWorker removeItems:"+removeCount+" ("+firstIndex+"-"+lastIndex+"),info");groupsToUnrealize.length&&!zooming&&!info.shouldYield;)that._unrealizeGroup(groupsToUnrealize.shift());itemsToUnrealize.length||groupsToUnrealize.length?zooming?info.setPromise(waitForSeZo(that._listView).then(function(){return unrealizeWorker})):info.setWork(unrealizeWorker):complete()}}job=Scheduler.schedule(unrealizeWorker,Scheduler.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")});return promise.then(done,function(error){return job.cancel(),that._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),that._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),Promise.wrapError(error)})}return done(),Promise.wrap()})},_getBoundingRectString:function(itemIndex){var result;if(itemIndex>=0&&itemIndex<this.containers.length){var itemPos=this._listView._layout._getItemPosition(itemIndex);itemPos&&(result="["+itemPos.left+"; "+itemPos.top+"; "+itemPos.width+"; "+itemPos.height+" ]")}return result||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null),-1!==this.deferredActionCancelToken&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(timedOut){function done(){that._listView._writeProfilerMark("aria work,StopTM");
}function calcLastRealizedIndexInGroup(groupIndex){var groups=that._listView._groups,nextGroup=groups.group(groupIndex+1);return nextGroup?Math.min(nextGroup.startIndex-1,that.end-1):that.end-1}if(!this._listView._isZombie()){var that=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(count){if(!(count>0&&-1!==that.firstIndexDisplayed&&-1!==that.lastIndexDisplayed))return Promise.wrap();that._listView._writeProfilerMark("aria work,StartTM");var job,groups,startGroup,currentGroup,group,lastRealizedIndexInGroup,startMarker=that._listView._ariaStartMarker,endMarker=that._listView._ariaEndMarker,index=that.begin,item=that.items.itemAt(that.begin);return item?(_ElementUtilities._ensureId(item),that._listView._groupsEnabled()?(groups=that._listView._groups,startGroup=currentGroup=groups.groupFromItem(that.begin),group=groups.group(currentGroup),lastRealizedIndexInGroup=calcLastRealizedIndexInGroup(currentGroup),_ElementUtilities._ensureId(group.header),_ElementUtilities._setAttribute(group.header,"role",that._listView._headerRole),_ElementUtilities._setAttribute(group.header,"x-ms-aria-flowfrom",startMarker.id),setFlow(group.header,item),_ElementUtilities._setAttribute(group.header,"tabindex",that._listView._tabIndex)):_ElementUtilities._setAttribute(item,"x-ms-aria-flowfrom",startMarker.id),new Promise(function(completeJobPromise){var skipWait=timedOut;job=Scheduler.schedule(function ariaWorker(jobInfo){if(that._listView._isZombie())return void done();for(;index<that.end;index++){if(!skipWait&&shouldWaitForSeZo(that._listView))return void jobInfo.setPromise(waitForSeZo(that._listView).then(function(timedOut){return skipWait=timedOut,ariaWorker}));if(jobInfo.shouldYield)return void jobInfo.setWork(ariaWorker);item=that.items.itemAt(index);var nextItem=that.items.itemAt(index+1);if(nextItem&&_ElementUtilities._ensureId(nextItem),_ElementUtilities._setAttribute(item,"role",that._listView._itemRole),_ElementUtilities._setAttribute(item,"aria-setsize",count),_ElementUtilities._setAttribute(item,"aria-posinset",index+1),_ElementUtilities._setAttribute(item,"tabindex",that._listView._tabIndex),that._listView._groupsEnabled())if(index!==lastRealizedIndexInGroup&&nextItem)setFlow(item,nextItem);else{var nextGroup=groups.group(currentGroup+1);nextGroup&&nextGroup.header&&nextItem?(_ElementUtilities._setAttribute(nextGroup.header,"tabindex",that._listView._tabIndex),_ElementUtilities._setAttribute(nextGroup.header,"role",that._listView._headerRole),_ElementUtilities._ensureId(nextGroup.header),setFlow(item,nextGroup.header),setFlow(nextGroup.header,nextItem)):_ElementUtilities._setAttribute(item,"aria-flowto",endMarker.id),currentGroup++,group=nextGroup,lastRealizedIndexInGroup=calcLastRealizedIndexInGroup(currentGroup)}else nextItem?setFlow(item,nextItem):_ElementUtilities._setAttribute(item,"aria-flowto",endMarker.id);if(!nextItem)break}that._listView._fireAccessibilityAnnotationCompleteEvent(that.begin,index,startGroup,currentGroup-1),done(),completeJobPromise()},Scheduler.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){job.cancel(),done()})):void done()})}},_setupDeferredActions:function(){function cleanUp(){that._listView._isZombie()||(that.deferTimeout=null,that._listView._versionManager.clearCancelOnNotification(that.deferredActionCancelToken),that.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var that=this;this._clearDeferTimeout(),this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return Promise.timeout(_Constants._DEFERRED_ACTION)}).then(function(){return waitForSeZo(that._listView)}).then(function(timedOut){return that._setupAria(timedOut)}).then(cleanUp,function(error){return cleanUp(),Promise.wrapError(error)}),this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout),this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(listViewIsEmpty,firstIndexDisplayed,lastIndexDisplayed){function getFirstVisibleItem(){return that.items.itemAt(firstIndexDisplayed)}function getLastVisibleItem(){for(var i=lastIndexDisplayed;i>=firstIndexDisplayed;i--)if(that.items.itemAt(i))return that.items.itemAt(i);return null}var that=this;if(!this._listView._isZombie()){this._listView._createAriaMarkers();var firstVisibleItem,lastVisibleItem,startMarker=this._listView._ariaStartMarker,endMarker=this._listView._ariaEndMarker;if(-1!==firstIndexDisplayed&&-1!==lastIndexDisplayed&&lastIndexDisplayed>=firstIndexDisplayed&&(firstVisibleItem=getFirstVisibleItem(),lastVisibleItem=getLastVisibleItem()),!listViewIsEmpty&&firstVisibleItem&&lastVisibleItem){if(_ElementUtilities._ensureId(firstVisibleItem),_ElementUtilities._ensureId(lastVisibleItem),this._listView._groupsEnabled()){var groups=this._listView._groups,firstVisibleGroup=groups.group(groups.groupFromItem(firstIndexDisplayed));firstVisibleGroup.header&&(_ElementUtilities._ensureId(firstVisibleGroup.header),firstIndexDisplayed===firstVisibleGroup.startIndex?_ElementUtilities._setAttribute(startMarker,"aria-flowto",firstVisibleGroup.header.id):_ElementUtilities._setAttribute(startMarker,"aria-flowto",firstVisibleItem.id))}else _ElementUtilities._setAttribute(startMarker,"aria-flowto",firstVisibleItem.id);_ElementUtilities._setAttribute(endMarker,"x-ms-aria-flowfrom",lastVisibleItem.id)}else setFlow(startMarker,endMarker),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)}},updateAriaForAnnouncement:function(item,count){if(item!==this._listView.header&&item!==this._listView.footer){var index=-1,type=_UI.ObjectType.item;_ElementUtilities.hasClass(item,_Constants._headerClass)?(index=this._listView._groups.index(item),type=_UI.ObjectType.groupHeader,_ElementUtilities._setAttribute(item,"role",this._listView._headerRole),_ElementUtilities._setAttribute(item,"tabindex",this._listView._tabIndex)):(index=this.items.index(item),_ElementUtilities._setAttribute(item,"aria-setsize",count),_ElementUtilities._setAttribute(item,"aria-posinset",index+1),_ElementUtilities._setAttribute(item,"role",this._listView._itemRole),_ElementUtilities._setAttribute(item,"tabindex",this._listView._tabIndex)),type===_UI.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,index,index):this._listView._fireAccessibilityAnnotationCompleteEvent(index,index,-1,-1)}},_reportElementsLevel:function(direction){function elementsCount(first,last){for(var count=0,itemIndex=first;last>=itemIndex;itemIndex++){var itemData=items.itemDataAt(itemIndex);itemData&&itemData.container&&count++}return count}var level,items=this.items;level="right"===direction?Math.floor(100*elementsCount(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed)):Math.floor(100*elementsCount(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1)),this._listView._writeProfilerMark("elementsLevel level("+level+"),info")},_createHeaderContainer:function(insertAfter){return this._createSurfaceChild(_Constants._headerContainerClass,insertAfter)},_createItemsContainer:function(insertAfter){var itemsContainer=this._createSurfaceChild(_Constants._itemsContainerClass,insertAfter),padder=_Global.document.createElement("div");return padder.className=_Constants._padderClass,itemsContainer.appendChild(padder),itemsContainer},_ensureContainerInDOM:function(index){var container=this.containers[index];return container&&!this._listView._canvas.contains(container)?(this._forceItemsBlocksInDOM(index,index+1),!0):!1},_ensureItemsBlocksInDOM:function(begin,end){if(this._expandedRange){var oldBegin=this._expandedRange.first.index,oldEnd=this._expandedRange.last.index+1;oldBegin>=begin&&end>oldBegin?end=Math.max(end,oldEnd):oldEnd>begin&&end>=oldEnd&&(begin=Math.min(begin,oldBegin))}this._forceItemsBlocksInDOM(begin,end)},_removeRedundantItemsBlocks:function(){-1!==this.begin&&-1!==this.end&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");var that=this;return waitForSeZo(this._listView).then(function(){function done(){that._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(that._listView._isZombie())return void done();if(that._expandedRange&&-1!==that.begin&&-1!==that.end&&(that._expandedRange.first.index<that.begin||that._expandedRange.last.index+1>that.end)){var job,promise=new Promise(function(complete){function blocksCleanupWorker(info){if(!that._listView._isZombie()){for(var zooming=shouldWaitForSeZo(that._listView);that._expandedRange.first.index<that.begin&&!zooming&&!info.shouldYield;){var begin=Math.min(that.begin,that._expandedRange.first.index+that._blockSize*_VirtualizeContentsView._blocksToRelease);that._forceItemsBlocksInDOM(begin,that.end)}for(;that._expandedRange.last.index+1>that.end&&!zooming&&!info.shouldYield;){var end=Math.max(that.end,that._expandedRange.last.index-that._blockSize*_VirtualizeContentsView._blocksToRelease);that._forceItemsBlocksInDOM(that.begin,end)}that._expandedRange.first.index<that.begin||that._expandedRange.last.index+1>that.end?zooming?info.setPromise(waitForSeZo(that._listView).then(function(){return blocksCleanupWorker})):info.setWork(blocksCleanupWorker):complete()}}job=Scheduler.schedule(blocksCleanupWorker,Scheduler.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return promise.then(done,function(error){return job.cancel(),that._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),that._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),Promise.wrapError(error)})}return done(),Promise.wrap()})},_forceItemsBlocksInDOM:function(begin,end){function setPadder(itemsContainer,padding){var padder=itemsContainer.element.firstElementChild;padder.style[paddingProperty]=padding}function forEachBlock(callback){for(var g=0;g<that.tree.length;g++)for(var itemsContainer=that.tree[g].itemsContainer,b=0,len=itemsContainer.itemsBlocks.length;len>b;b++)if(callback(itemsContainer,itemsContainer.itemsBlocks[b]))return}function measureItemsBlock(itemsBlock){that._listView._writeProfilerMark("_itemsBlockExtent,StartTM"),that._listView._itemsBlockExtent=_ElementUtilities[that._listView._horizontal()?"getTotalWidth":"getTotalHeight"](itemsBlock.element),that._listView._writeProfilerMark("_itemsBlockExtent("+that._listView._itemsBlockExtent+"),info"),that._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function getItemsBlockExtent(){return-1===that._listView._itemsBlockExtent&&forEachBlock(function(itemsContainer,itemsBlock){return itemsBlock.items.length===that._blockSize&&itemsBlock.element.parentNode===itemsContainer.element?(measureItemsBlock(itemsBlock),!0):!1}),-1===that._listView._itemsBlockExtent&&forEachBlock(function(itemsContainer,itemsBlock){return itemsBlock.items.length===that._blockSize?(itemsContainer.element.appendChild(itemsBlock.element),measureItemsBlock(itemsBlock),itemsContainer.element.removeChild(itemsBlock.element),!0):!1}),that._listView._itemsBlockExtent}function removeBlocks(itemsContainer,begin,end){function remove(blockIndex){var block=itemsContainer.itemsBlocks[blockIndex];block&&block.element.parentNode===itemsContainer.element&&(itemsContainer.element.removeChild(block.element),removed++)}if(Array.isArray(begin))begin.forEach(remove);else for(var i=begin;end>i;i++)remove(i)}function addBlocks(itemsContainer,begin,end){for(var padder=itemsContainer.element.firstElementChild,previous=padder,i=begin;end>i;i++){var block=itemsContainer.itemsBlocks[i];block&&(block.element.parentNode!==itemsContainer.element&&(itemsContainer.element.insertBefore(block.element,previous.nextElementSibling),added++),previous=block.element)}}function collapseGroup(groupIndex){if(groupIndex<that.tree.length){that._listView._writeProfilerMark("collapseGroup("+groupIndex+"),info");var itemsContainer=that.tree[groupIndex].itemsContainer;removeBlocks(itemsContainer,0,itemsContainer.itemsBlocks.length),setPadder(itemsContainer,"")}}function expandGroup(groupIndex){if(groupIndex<that.tree.length){that._listView._writeProfilerMark("expandGroup("+groupIndex+"),info");var itemsContainer=that.tree[groupIndex].itemsContainer;addBlocks(itemsContainer,0,itemsContainer.itemsBlocks.length),setPadder(itemsContainer,"")}}function removedFromRange(oldRange,newRange){function expand(first,last){for(var array=[],i=first;last>=i;i++)array.push(i);return array}var newL=newRange[0],newR=newRange[1],oldL=oldRange[0],oldR=oldRange[1];return oldL>newR||newL>oldR?expand(oldL,oldR):newL>oldL&&oldR>newR?expand(oldL,newL-1).concat(expand(newR+1,oldR)):newL>oldL?expand(oldL,newL-1):oldR>newR?expand(newR+1,oldR):null}if(this._blockSize){var perfId="_forceItemsBlocksInDOM begin("+begin+") end("+end+"),";this._listView._writeProfilerMark(perfId+"StartTM");var that=this,added=0,removed=0,paddingProperty="padding"+(this._listView._horizontal()?"Left":"Top"),firstGroupIndex=this._listView._groups.groupFromItem(begin),lastGroupIndex=this._listView._groups.groupFromItem(end-1),firstGroup=this._listView._groups.group(firstGroupIndex),firstItemsContainer=that.tree[firstGroupIndex].itemsContainer,firstBlock=Math.floor((begin-firstGroup.startIndex)/this._blockSize),lastGroup=this._listView._groups.group(lastGroupIndex),lastItemsContainer=that.tree[lastGroupIndex].itemsContainer,lastBlock=Math.floor((end-1-lastGroup.startIndex)/this._blockSize);firstBlock&&-1===that._listView._itemsBlockExtent&&forEachBlock(function(itemsContainer,itemsBlock){return itemsBlock.items.length===that._blockSize&&itemsBlock.element.parentNode===itemsContainer.element?(measureItemsBlock(itemsBlock),!0):!1});var groupsToCollapse=this._expandedRange?removedFromRange([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[firstGroupIndex,lastGroupIndex]):null;if(groupsToCollapse&&groupsToCollapse.forEach(collapseGroup),this._expandedRange&&this._expandedRange.first.groupKey===firstGroup.key){var blocksToRemove=removedFromRange([this._expandedRange.first.block,Number.MAX_VALUE],[firstBlock,Number.MAX_VALUE]);blocksToRemove&&removeBlocks(firstItemsContainer,blocksToRemove)}else this._expandedRange&&firstGroupIndex>=this._expandedRange.first.groupIndex&&firstGroupIndex<=this._expandedRange.last.groupIndex&&removeBlocks(firstItemsContainer,0,firstBlock);if(firstGroupIndex!==lastGroupIndex?(addBlocks(firstItemsContainer,firstBlock,firstItemsContainer.itemsBlocks.length),addBlocks(lastItemsContainer,0,lastBlock+1)):addBlocks(firstItemsContainer,firstBlock,lastBlock+1),this._expandedRange&&this._expandedRange.last.groupKey===lastGroup.key){var blocksToRemove=removedFromRange([0,this._expandedRange.last.block],[0,lastBlock]);blocksToRemove&&removeBlocks(lastItemsContainer,blocksToRemove)}else this._expandedRange&&lastGroupIndex>=this._expandedRange.first.groupIndex&&lastGroupIndex<=this._expandedRange.last.groupIndex&&removeBlocks(lastItemsContainer,lastBlock+1,lastItemsContainer.itemsBlocks.length);setPadder(firstItemsContainer,firstBlock?firstBlock*getItemsBlockExtent()+"px":""),firstGroupIndex!==lastGroupIndex&&setPadder(lastItemsContainer,"");for(var i=firstGroupIndex+1;lastGroupIndex>i;i++)expandGroup(i);this._expandedRange={first:{index:begin,groupIndex:firstGroupIndex,groupKey:firstGroup.key,block:firstBlock},last:{index:end-1,groupIndex:lastGroupIndex,groupKey:lastGroup.key,block:lastBlock}},this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+firstGroupIndex+"-"+lastGroupIndex+") blocks("+firstBlock+"-"+lastBlock+") added("+added+") removed("+removed+"),info"),this._listView._writeProfilerMark(perfId+"StopTM")}},_realizePageImpl:function(){var that=this,perfId="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(perfId+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){that._listView._isZombie()||that._listView._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.low,that._listView.scrollPosition)}),this._listView._writeProfilerMark(perfId+",StopTM"),Promise.cancel):new Promise(function(c){function complete(){c(),renderingCompleteSignal.complete()}function viewPortPageRealized(){that._listView._hideProgressBar(),that._state.setLoadingState(that._listView._LoadingState.viewPortLoaded),that._executeAnimations&&that._setState(RealizingAnimatingState,renderingCompleteSignal.promise)}function pageRealized(count){that._updateAriaMarkers(0===count,that.firstIndexDisplayed,that.lastIndexDisplayed),that._state.setLoadingState&&that._state.setLoadingState(that._listView._LoadingState.itemsLoaded)}function finish(count){that._listView._clearInsertedItems(),that._listView._groups.removeElements(),viewPortPageRealized(),pageRealized(count),complete()}var renderingCompleteSignal=new _Signal;that._state.setLoadingState(that._listView._LoadingState.itemsLoading),that._firstLayoutPass&&that._listView._showProgressBar(that._listView._element,"50%","50%");var count=that.containers.length;if(count){var pagesBefore,pagesAfter,pagesToPrefetch=that.maxLeadingPages,pagesToRetain=that.maxTrailingPages,viewportLength=that._listView._getViewportLength();if(that._listView._zooming)pagesBefore=pagesAfter=0;else if(_VirtualizeContentsView._disableCustomPagesPrefetch)pagesBefore=pagesAfter=_VirtualizeContentsView._defaultPagesToPrefetch;else{pagesBefore="left"===that._direction?pagesToPrefetch:pagesToRetain;var pagesShortBehind=Math.max(0,pagesBefore-that._scrollbarPos/viewportLength);pagesAfter=Math.min(pagesToPrefetch,pagesShortBehind+("right"===that._direction?pagesToPrefetch:pagesToRetain))}var beginningOffset=Math.max(0,that._scrollbarPos-pagesBefore*viewportLength),endingOffset=that._scrollbarPos+(1+pagesAfter)*viewportLength,range=that._listView._layout.itemsFromRange(beginningOffset,endingOffset-1);if((range.firstIndex<0||range.firstIndex>=count)&&(range.lastIndex<0||range.lastIndex>=count))that.begin=-1,that.end=-1,that.firstIndexDisplayed=-1,that.lastIndexDisplayed=-1,finish(count);else{var begin=_ElementUtilities._clamp(range.firstIndex,0,count-1),end=_ElementUtilities._clamp(range.lastIndex+1,0,count),inView=that._listView._layout.itemsFromRange(that._scrollbarPos,that._scrollbarPos+viewportLength-1),firstInView=_ElementUtilities._clamp(inView.firstIndex,0,count-1),lastInView=_ElementUtilities._clamp(inView.lastIndex,0,count-1);if(that._realizationLevel!==_VirtualizeContentsView._realizationLevel.skip||that.lastRealizePass||firstInView!==that.firstIndexDisplayed||lastInView!==that.lastIndexDisplayed)if((that._forceRelayout||begin!==that.begin||end!==that.end||firstInView!==that.firstIndexDisplayed||lastInView!==that.lastIndexDisplayed)&&end>begin&&endingOffset>beginningOffset){that._listView._writeProfilerMark("realizePage currentInView("+firstInView+"-"+lastInView+") previousInView("+that.firstIndexDisplayed+"-"+that.lastIndexDisplayed+") change("+(firstInView-that.firstIndexDisplayed)+"),info"),that._cancelRealize();var currentPass=that._realizePass;that.begin=begin,that.end=end,that.firstIndexDisplayed=firstInView,that.lastIndexDisplayed=lastInView,that.deletesWithoutRealize=0,that._ensureItemsBlocksInDOM(that.begin,that.end);var realizeWork=that._realizeItems(that._listView._itemCanvas,that.begin,that.end,count,currentPass,that._scrollbarPos,that._direction,firstInView,lastInView,that._forceRelayout);that._forceRelayout=!1;var realizePassWork=realizeWork.viewportItemsRealized.then(function(){return viewPortPageRealized(),realizeWork.allItemsRealized}).then(function(){return that._realizePass===currentPass?that._updateHeaders(that._listView._canvas,that.begin,that.end).then(function(){pageRealized(count)}):void 0}).then(function(){return realizeWork.loadingCompleted}).then(function(){that._unrealizeExcessiveItems(),that.lastRealizePass=null,complete()},function(e){return that._realizePass===currentPass&&(that.lastRealizePass=null,that.begin=-1,that.end=-1),Promise.wrapError(e)});that.lastRealizePass=Promise.join([realizeWork.viewportItemsRealized,realizeWork.allItemsRealized,realizeWork.loadingCompleted,realizePassWork]),that._unrealizeExcessiveItems()}else that.lastRealizePass?that.lastRealizePass.then(complete):finish(count);else that.begin=begin,that.end=begin+Object.keys(that.items._itemData).length,that._updateHeaders(that._listView._canvas,that.begin,that.end).done(function(){that.lastRealizePass=null,finish(count)})}}else that.begin=-1,that.end=-1,that.firstIndexDisplayed=-1,that.lastIndexDisplayed=-1,finish(count);that._reportElementsLevel(that._direction),that._listView._writeProfilerMark(perfId+",StopTM")})},realizePage:function(scrollToFunctor,forceRelayout,scrollEndPromise,StateType){this._scrollToFunctor=makeFunctor(scrollToFunctor),this._forceRelayout=this._forceRelayout||forceRelayout,this._scrollEndPromise=scrollEndPromise,this._listView._writeProfilerMark(this._state.name+"_realizePage,info"),this._state.realizePage(StateType||RealizingState)},onScroll:function(scrollToFunctor,scrollEndPromise){this.realizePage(scrollToFunctor,!1,scrollEndPromise,ScrollingState)},reload:function(scrollToFunctor,highPriority){this._listView._isZombie()||(this._scrollToFunctor=makeFunctor(scrollToFunctor),this._forceRelayout=!0,this._highPriorityRealize=!!highPriority,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(scrollToFunctor){this._listView._isZombie()||(this._scrollToFunctor=makeFunctor(scrollToFunctor),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(newPosition){var that=this,currentMaxScroll=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return newPosition>currentMaxScroll?that._listView._itemsCount().then(function(count){return that.containers.length<count?Promise._cancelBlocker(that._creatingContainersWork&&that._creatingContainersWork.promise).then(function(){return that._getLayoutCompleted()}).then(function(){return newPosition}):newPosition}):Promise.wrap(newPosition)},waitForEntityPosition:function(entity){var that=this;return entity.type===_UI.ObjectType.header||entity.type===_UI.ObjectType.footer?Promise.wrap():(this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+entity.type+": "+entity.index+"),info"),Promise._cancelBlocker(this._state.waitForEntityPosition(entity).then(function(){return entity.type!==_UI.ObjectType.groupHeader&&entity.index>=that.containers.length||entity.type===_UI.ObjectType.groupHeader&&that._listView._groups.group(entity.index).startIndex>=that.containers.length?that._creatingContainersWork&&that._creatingContainersWork.promise:void 0}).then(function(){return that._getLayoutCompleted()})))},stopWork:function(stopTreeCreation){this._listView._writeProfilerMark(this._state.name+"_stop,info"),this._state.stop(stopTreeCreation),this._layoutWork&&this._layoutWork.cancel(),stopTreeCreation&&this._creatingContainersWork&&this._creatingContainersWork.cancel(),stopTreeCreation&&(this._state=new CreatedState(this))},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM"),(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0),this._clearDeferTimeout(),this._realizePass++,this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var last=this.lastRealizePass;last&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,last.cancel()),this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(unparent){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this._runningAnimations=null,this._executeAnimations=!1;var listView=this._listView;this._firstLayoutPass=!0,listView._unsetFocusOnItem(),listView._currentMode().onDataChanged&&listView._currentMode().onDataChanged(),this.items.each(function(index,item){unparent&&item.parentNode&&item.parentNode.parentNode&&item.parentNode.parentNode.removeChild(item.parentNode),listView._itemsManager.releaseItem(item),_Dispose._disposeElement(item)}),this.items.removeItems(),this._deferredReparenting=[],unparent&&listView._groups.removeElements(),listView._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new CreatedState(this),this.resetItems(),!this._listView._isZombie()){var listView=this._listView;listView._groups.resetGroups(),listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null}},cleanUp:function(){this.stopWork(!0),this._runningAnimations&&this._runningAnimations.cancel();var itemsManager=this._listView._itemsManager;this.items.each(function(index,item){itemsManager.releaseItem(item),_Dispose._disposeElement(item)}),this._listView._unsetFocusOnItem(),this.items.removeItems(),this._deferredReparenting=[],this._listView._groups.resetGroups(),this._listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null,this.destroyed=!0},getContainer:function(itemIndex){return this.containers[itemIndex]},_getHeaderContainer:function(groupIndex){return this.tree[groupIndex].header},_getGroups:function(count){if(this._listView._groupDataSource){var groupsContainer=this._listView._groups.groups,groups=[];if(count)for(var i=0,len=groupsContainer.length;len>i;i++){var group=groupsContainer[i],nextStartIndex=len>i+1?groupsContainer[i+1].startIndex:count;groups.push({key:group.key,size:nextStartIndex-group.startIndex})}return groups}return[{key:"-1",size:count}]},_createChunk:function(groups,count,chunkSize){function addToGroup(itemsContainer,groupSize){var children=itemsContainer.element.children,oldSize=children.length,toAdd=Math.min(groupSize-itemsContainer.items.length,chunkSize);_SafeHtml.insertAdjacentHTMLUnsafe(itemsContainer.element,"beforeend",_Helpers._repeat("<div class='win-container win-backdrop'></div>",toAdd));for(var i=0;toAdd>i;i++){var container=children[oldSize+i];itemsContainer.items.push(container),that.containers.push(container)}}function newGroup(group){var node={header:that._listView._groupDataSource?that._createHeaderContainer():null,itemsContainer:{element:that._createItemsContainer(),items:[]}};that.tree.push(node),that.keyToGroupIndex[group.key]=that.tree.length-1,addToGroup(node.itemsContainer,group.size)}var that=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=groups.length){var last=this.tree[this.tree.length-1],finalSize=groups[this.tree.length-1].size;if(last.itemsContainer.items.length<finalSize)return addToGroup(last.itemsContainer,finalSize),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<groups.length&&newGroup(groups[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(groups,count,blockSize,chunkSize){function addToGroup(itemsContainer,toAdd){var indexOfNextGroupItem,lastExistingBlock=itemsContainer.itemsBlocks.length?itemsContainer.itemsBlocks[itemsContainer.itemsBlocks.length-1]:null;if(toAdd=Math.min(toAdd,chunkSize),lastExistingBlock&&lastExistingBlock.items.length<blockSize){var emptySpotsToFill=Math.min(toAdd,blockSize-lastExistingBlock.items.length),sizeOfOldLastBlock=lastExistingBlock.items.length,indexOfNextGroupItem=(itemsContainer.itemsBlocks.length-1)*blockSize+sizeOfOldLastBlock,containersMarkup=_Helpers._stripedContainers(emptySpotsToFill,indexOfNextGroupItem);_SafeHtml.insertAdjacentHTMLUnsafe(lastExistingBlock.element,"beforeend",containersMarkup),children=lastExistingBlock.element.children;for(var j=0;emptySpotsToFill>j;j++){var child=children[sizeOfOldLastBlock+j];lastExistingBlock.items.push(child),that.containers.push(child)}toAdd-=emptySpotsToFill}indexOfNextGroupItem=itemsContainer.itemsBlocks.length*blockSize;var newBlocksCount=Math.floor(toAdd/blockSize),markup="",firstBlockFirstItemIndex=indexOfNextGroupItem,secondBlockFirstItemIndex=indexOfNextGroupItem+blockSize;if(newBlocksCount>0){var pairOfItemBlocks=["<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,firstBlockFirstItemIndex)+"</div>","<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,secondBlockFirstItemIndex)+"</div>"];markup=_Helpers._repeat(pairOfItemBlocks,newBlocksCount),indexOfNextGroupItem+=newBlocksCount*blockSize}var sizeOfNewLastBlock=toAdd%blockSize;sizeOfNewLastBlock>0&&(markup+="<div class='win-itemsblock'>"+_Helpers._stripedContainers(sizeOfNewLastBlock,indexOfNextGroupItem)+"</div>",indexOfNextGroupItem+=sizeOfNewLastBlock,newBlocksCount++);var blocksTemp=_Global.document.createElement("div");_SafeHtml.setInnerHTMLUnsafe(blocksTemp,markup);for(var children=blocksTemp.children,i=0;newBlocksCount>i;i++){var block=children[i],blockNode={element:block,items:_Helpers._nodeListToArray(block.children)};itemsContainer.itemsBlocks.push(blockNode);for(var n=0;n<blockNode.items.length;n++)that.containers.push(blockNode.items[n])}}function newGroup(group){var node={header:that._listView._groupDataSource?that._createHeaderContainer():null,itemsContainer:{element:that._createItemsContainer(),itemsBlocks:[]}};that.tree.push(node),that.keyToGroupIndex[group.key]=that.tree.length-1,addToGroup(node.itemsContainer,group.size)}var that=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=groups.length){var lastContainer=this.tree[this.tree.length-1].itemsContainer,finalSize=groups[this.tree.length-1].size,currentSize=0;if(lastContainer.itemsBlocks.length&&(currentSize=(lastContainer.itemsBlocks.length-1)*blockSize+lastContainer.itemsBlocks[lastContainer.itemsBlocks.length-1].items.length),finalSize>currentSize)return addToGroup(lastContainer,finalSize-currentSize),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<groups.length&&newGroup(groups[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var that=this,counter=0,skipWait=!1;return function work(info){that._listView._versionManager.locked?info.setPromise(that._listView._versionManager.unlocked.then(function(){return work})):that._listView._itemsCount().then(function(count){var zooming=!skipWait&&shouldWaitForSeZo(that._listView);if(zooming)info.setPromise(waitForSeZo(that._listView).then(function(timedOut){return skipWait=timedOut,work}));else{if(that._listView._isZombie())return;skipWait=!1;var end=_BaseUtils._now()+_VirtualizeContentsView._createContainersJobTimeslice,groups=that._getGroups(count),startLength=that.containers.length,realizedToEnd=that.end===that.containers.length,chunkSize=_VirtualizeContentsView._chunkSize;do that._blockSize?that._createChunkWithBlocks(groups,count,that._blockSize,chunkSize):that._createChunk(groups,count,chunkSize),counter++;while(that.containers.length<count&&_BaseUtils._now()<end);that._listView._writeProfilerMark("createContainers yields containers("+that.containers.length+"),info"),that._listView._affectedRange.add({start:startLength,end:that.containers.length},count),realizedToEnd?(that.stopWork(),that._listView._writeProfilerMark(that._state.name+"_relayout,info"),that._state.relayout()):(that._listView._writeProfilerMark(that._state.name+"_layoutNewContainers,info"),that._state.layoutNewContainers()),that.containers.length<count?info.setWork(work):(that._listView._writeProfilerMark("createContainers completed steps("+counter+"),info"),that._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return Scheduler.schedule(this._generateCreateContainersWorker(),Scheduler.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){
this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null;var count,that=this;return this._listView._itemsCount().then(function(c){return 0===c&&that._listView._hideProgressBar(),count=c,that._listView._writeProfilerMark("createContainers("+count+"),StartTM"),that._listView._groupDataSource?that._listView._groups.initialize():void 0}).then(function(){return that._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),count&&that._listView._groups.length()?that._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(blockSize){that._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+blockSize+"),info"),that._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM"),that._listView._resetCanvas(),that.tree=[],that.keyToGroupIndex={},that.containers=[],that._blockSize=blockSize;var stop,groups=that._getGroups(count),end=_BaseUtils._now()+_VirtualizeContentsView._maxTimePerCreateContainers,chunkSize=Math.min(_VirtualizeContentsView._startupChunkSize,_VirtualizeContentsView._chunkSize);do stop=blockSize?that._createChunkWithBlocks(groups,count,blockSize,chunkSize):that._createChunk(groups,count,chunkSize);while(_BaseUtils._now()<end&&that.containers.length<count&&!stop);if(that._listView._writeProfilerMark("createContainers created("+that.containers.length+"),info"),that._listView._affectedRange.add({start:0,end:that.containers.length},count),that.containers.length<count){var jobNode=that._scheduleLazyTreeCreation();that._creatingContainersWork.promise.done(null,function(){jobNode.cancel()})}else that._listView._writeProfilerMark("createContainers completed synchronously,info"),that._creatingContainersWork.complete();that._listView._writeProfilerMark("createContainers("+count+"),StopTM")})},_updateItemsBlocks:function(blockSize){function createNewBlock(){var element=_Global.document.createElement("div");return element.className=_Constants._itemsBlockClass,element}function updateGroup(itemsContainer,startIndex){function rebuildItemsContainer(){itemsContainer.itemsBlocks=null,itemsContainer.items=[];for(var i=0;itemsCount>i;i++){var container=that.containers[startIndex+i];itemsContainer.element.appendChild(container),itemsContainer.items.push(container)}}function rebuildItemsContainerWithBlocks(){itemsContainer.itemsBlocks=[{element:blockElements.length?blockElements.shift():createNewBlock(),items:[]}];for(var currentBlock=itemsContainer.itemsBlocks[0],i=0;itemsCount>i;i++){if(currentBlock.items.length===blockSize){var nextBlock=blockElements.length?blockElements.shift():createNewBlock();itemsContainer.itemsBlocks.push({element:nextBlock,items:[]}),currentBlock=itemsContainer.itemsBlocks[itemsContainer.itemsBlocks.length-1]}var container=that.containers[startIndex+i];currentBlock.element.appendChild(container),currentBlock.items.push(container)}itemsContainer.items=null}var b,blockElements=[],itemsCount=0,blocks=itemsContainer.itemsBlocks;if(blocks)for(b=0;b<blocks.length;b++)itemsCount+=blocks[b].items.length,blockElements.push(blocks[b].element);else itemsCount=itemsContainer.items.length;for(usingStructuralNodes?rebuildItemsContainerWithBlocks():rebuildItemsContainer(),b=0;b<blockElements.length;b++){var block=blockElements[b];block.parentNode===itemsContainer.element&&itemsContainer.element.removeChild(block)}return itemsCount}for(var that=this,usingStructuralNodes=!!blockSize,g=0,startIndex=0;g<this.tree.length;g++)startIndex+=updateGroup(this.tree[g].itemsContainer,startIndex);that._blockSize=blockSize},_layoutItems:function(){var that=this;return this._listView._itemsCount().then(function(){return Promise.as(that._listView._layout.numberOfItemsPerItemsBlock).then(function(blockSize){that._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+blockSize+"),info"),blockSize!==that._blockSize&&(that._updateItemsBlocks(blockSize),that._listView._itemsBlockExtent=-1);var changedRange,affectedRange=that._listView._affectedRange.get();return affectedRange&&(changedRange={firstIndex:Math.max(affectedRange.start-1,0),lastIndex:Math.min(that.containers.length-1,affectedRange.end)},changedRange.firstIndex<that.containers.length||0===that.containers.length)?that._listView._layout.layout(that.tree,changedRange,that._modifiedElements||[],that._modifiedGroups||[]):(that._listView._affectedRange.clear(),{realizedRangeComplete:Promise.wrap(),layoutComplete:Promise.wrap()})})})},updateTree:function(count,delta,modifiedElements){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(count,delta,modifiedElements)},_updateTreeImpl:function(count,delta,modifiedElements,skipUnrealizeItems){function removeElements(array){for(var i=0,len=array.length;len>i;i++){var itemBox=array[i];itemBox.parentNode.removeChild(itemBox)}}if(this._executeAnimations=!0,this._modifiedElements=modifiedElements,!modifiedElements.handled){modifiedElements.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM");var i,that=this;skipUnrealizeItems||this._unrealizeItems();for(var i=0,len=modifiedElements.length;len>i;i++)modifiedElements[i]._itemBox&&modifiedElements[i]._itemBox.parentNode&&_ElementUtilities.removeClass(modifiedElements[i]._itemBox.parentNode,_Constants._selectedClass);this.items.each(function(index,item,itemData){itemData.container&&_ElementUtilities.removeClass(itemData.container,_Constants._selectedClass),itemData.container&&_ElementUtilities.addClass(itemData.container,_Constants._backdropClass)});var removedGroups=this._listView._updateContainers(this._getGroups(count),count,delta,modifiedElements);removeElements(removedGroups.removedHeaders),removeElements(removedGroups.removedItemsContainers);for(var i=0,len=modifiedElements.length;len>i;i++){var modifiedElement=modifiedElements[i];if(-1!==modifiedElement.newIndex){if(modifiedElement.element=this.getContainer(modifiedElement.newIndex),!modifiedElement.element)throw"Container missing after updateContainers."}else _ElementUtilities.removeClass(modifiedElement.element,_Constants._backdropClass)}var activeElement=_Global.document.activeElement;this._listView._canvas.contains(activeElement)&&(this._requireFocusRestore=activeElement),this._deferredReparenting=[],this.items.each(function(index,item,itemData){var container=that.getContainer(index),itemBox=itemData.itemBox;itemBox&&container&&(itemData.container=container,itemBox.parentNode!==container&&(index>=that.firstIndexDisplayed&&index<=that.lastIndexDisplayed?that._appendAndRestoreFocus(container,itemBox):that._deferredReparenting.push({itemBox:itemBox,container:container})),_ElementUtilities.removeClass(container,_Constants._backdropClass),_ElementUtilities[that._listView.selection._isIncluded(index)?"addClass":"removeClass"](container,_Constants._selectedClass),!that._listView.selection._isIncluded(index)&&_ElementUtilities.hasClass(itemBox,_Constants._selectedClass)&&_ItemEventsHandler._ItemEventsHandler.renderSelection(itemBox,itemData.element,!1,!0))}),this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){if(this._deferredReparenting){var deferredCount=this._deferredReparenting.length;if(deferredCount>0){var perfId="_completeReparenting("+deferredCount+")";this._listView._writeProfilerMark(perfId+",StartTM");for(var deferredItem,i=0;deferredCount>i;i++)deferredItem=this._deferredReparenting[i],this._appendAndRestoreFocus(deferredItem.container,deferredItem.itemBox);this._deferredReparenting=[],this._listView._writeProfilerMark(perfId+",StopTM")}}this._requireFocusRestore=null},_appendAndRestoreFocus:function(container,itemBox){if(itemBox.parentNode!==container){var activeElement;if(this._requireFocusRestore&&(activeElement=_Global.document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===activeElement&&(container.contains(activeElement)||itemBox.contains(activeElement))&&(this._listView._unsetFocusOnItem(),activeElement=_Global.document.activeElement),_ElementUtilities.empty(container),container.appendChild(itemBox),this._requireFocusRestore&&activeElement===this._listView._keyboardEventsHelper){var focused=this._listView._selection._getFocused();focused.type===_UI.ObjectType.item&&this.items.itemBoxAt(focused.index)===itemBox&&(_ElementUtilities._setActive(this._requireFocusRestore),this._requireFocusRestore=null)}}},_startAnimations:function(){this._listView._writeProfilerMark("startAnimations,StartTM");var that=this;this._hasAnimationInViewportPending=!1;var animationPromise=Promise.as(this._listView._layout.executeAnimations()).then(function(){that._listView._writeProfilerMark("startAnimations,StopTM")});return animationPromise},_setState:function(NewStateType,arg){if(!this._listView._isZombie()){var prevStateName=this._state.name;this._state=new NewStateType(this,arg),this._listView._writeProfilerMark(this._state.name+"_enter from("+prevStateName+"),info"),this._state.enter()}},getAdjacent:function(currentFocus,direction){var that=this;return this.waitForEntityPosition(currentFocus).then(function(){return that._listView._layout.getAdjacent(currentFocus,direction)})},hitTest:function(x,y){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var retVal=this._listView._layout.hitTest(x,y);return retVal.index=_ElementUtilities._clamp(retVal.index,-1,this._listView._cachedCount-1,0),retVal.insertAfterIndex=_ElementUtilities._clamp(retVal.insertAfterIndex,-1,this._listView._cachedCount-1,0),retVal},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new _Signal;var that=this;this._creatingContainersWork.promise.done(function(){that._creatingContainersWork=null},function(){that._creatingContainersWork=null})}},_createLayoutSignal:function(){var that=this;this._layoutCompleted||(this._layoutCompleted=new _Signal,this._layoutCompleted.promise.done(function(){that._layoutCompleted=null},function(){that._layoutCompleted=null})),this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new _Signal,this._realizedRangeLaidOut.promise.done(function(){that._realizedRangeLaidOut=null},function(){that._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?Promise._cancelBlocker(this._layoutCompleted.promise):Promise.wrap()},_createSurfaceChild:function(className,insertAfter){var element=_Global.document.createElement("div");return element.className=className,this._listView._canvas.insertBefore(element,insertAfter?insertAfter.nextElementSibling:null),element},_executeScrollToFunctor:function(){var that=this;return Promise.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(scroll){that._scrollToFunctor=null,scroll=scroll||{},+scroll.position===scroll.position&&(that._scrollbarPos=scroll.position),that._direction=scroll.direction||"right"})}},{_defaultPagesToPrefetch:2,_iOSMaxLeadingPages:6,_iOSMaxTrailingPages:2,_disableCustomPagesPrefetch:!1,_waitForSeZoIntervalDuration:100,_waitForSeZoTimeoutDuration:500,_chunkSize:500,_startupChunkSize:100,_maxTimePerCreateContainers:5,_createContainersJobTimeslice:15,_blocksToRelease:10,_realizationLevel:{skip:"skip",realize:"realize",normal:"normal"}}),CreatedState=_Base.Class.define(function(view){this.view=view,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},stop:nop,realizePage:nop,rebuildTree:function(){this.view._setState(BuildingState)},relayout:function(){this.view._setState(BuildingState)},layoutNewContainers:nop,waitForEntityPosition:function(){return this.view._setState(BuildingState),this.view._getLayoutCompleted()},updateTree:nop}),BuildingState=_Base.Class.define(function(view){this.view=view},{name:"BuildingState",enter:function(){this.canceling=!1,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal();var that=this,promiseStoredSignal=new _Signal;this.promise=promiseStoredSignal.promise.then(function(){return that.view._createContainers()}).then(function(){that.view._setState(LayingoutState)},function(error){return that.canceling||(that.view._setState(CreatedState),that.view._listView._raiseViewComplete()),Promise.wrapError(error)}),promiseStoredSignal.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._setState(CreatedState)},realizePage:nop,rebuildTree:function(){this.canceling=!0,this.promise.cancel(),this.enter()},relayout:nop,layoutNewContainers:nop,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:nop}),LayingoutState=_Base.Class.define(function(view,NextStateType){this.view=view,this.nextStateType=NextStateType||RealizingState},{name:"LayingoutState",enter:function(){var that=this;this.canceling=!1,this.view._createLayoutSignal(),this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");var promiseStoredSignal=new _Signal;this.promise=promiseStoredSignal.promise.then(function(){return that.view._layoutItems()}).then(function(layoutPromises){return that.view._layoutWork=layoutPromises.layoutComplete,layoutPromises.realizedRangeComplete}).then(function(){that.view._listView._writeProfilerMark(that.name+"_enter_layoutItems,StopTM"),that.view._listView._clearInsertedItems(),that.view._setAnimationInViewportState(that.view._modifiedElements),that.view._modifiedElements=[],that.view._modifiedGroups=[],that.view._realizedRangeLaidOut.complete(),that.view._layoutWork.then(function(){that.view._listView._writeProfilerMark(that.name+"_enter_layoutCompleted,info"),that.view._listView._affectedRange.clear(),that.view._layoutCompleted.complete()}),that.canceling||that.view._setState(that.nextStateType)},function(error){return that.view._listView._writeProfilerMark(that.name+"_enter_layoutCanceled,info"),that.canceling||(that.view.firstIndexDisplayed=that.view.lastIndexDisplayed=-1,that.view._updateAriaMarkers(!0,that.view.firstIndexDisplayed,that.view.lastIndexDisplayed),that.view._setState(CompletedState)),Promise.wrapError(error)}),promiseStoredSignal.complete(),this.canceling&&this.promise.cancel()},cancelLayout:function(switchState){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info"),this.canceling=!0,this.promise&&this.promise.cancel(),switchState&&this.view._setState(LayoutCanceledState)},stop:function(){this.cancelLayout(!0)},realizePage:nop,rebuildTree:function(){this.cancelLayout(!1),this.view._setState(BuildingState)},relayout:function(){this.cancelLayout(!1),this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),LayoutCanceledState=_Base.Class.define(function(view){this.view=view},{name:"LayoutCanceledState",enter:nop,stop:nop,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(BuildingState)},relayout:function(){this.view._setState(LayingoutState)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),RealizingState=_Base.Class.define(function(view){this.view=view,this.nextState=UnrealizingState,this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var that=this,promiseStoredSignal=new _Signal;this.promise=promiseStoredSignal.promise.then(function(){return that.view._executeScrollToFunctor()}).then(function(){return that.relayoutNewContainers=!1,Promise._cancelBlocker(that.view._realizePageImpl())}).then(function(){that.view._state===that&&(that.view._completeUpdateTree(),that.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),that.view._setState(that.nextState))},function(error){return that.view._state!==that||that.canceling||(that.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),that.view._setState(CanceledState)),Promise.wrapError(error)}),promiseStoredSignal.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._cancelRealize(),this.view._setState(CanceledState)},realizePage:function(){this.canceling=!0,this.promise.cancel(),this.enter()},rebuildTree:function(){this.stop(),this.view._setState(BuildingState)},relayout:function(){this.stop(),this.view._setState(LayingoutState)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)},setLoadingState:function(state){this.view._listView._setViewState(state)}}),CanceledState=_Base.Class.define(function(view){this.view=view},{name:"CanceledState",enter:nop,stop:function(){this.view._cancelRealize()},realizePage:function(NewStateType){this.stop(),this.view._setState(NewStateType)},rebuildTree:function(){this.stop(),this.view._setState(BuildingState)},relayout:function(NextStateType){this.stop(),this.view._setState(LayingoutState,NextStateType)},layoutNewContainers:function(){this.relayout(CanceledState)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),ScrollingState=_Base.Class.derive(RealizingState,function(view){this.view=view,this.nextState=ScrollingPausedState,this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),ScrollingPausedState=_Base.Class.derive(CanceledState,function(view){this.view=view},{name:"ScrollingPausedState",enter:function(){var that=this;this.promise=Promise._cancelBlocker(this.view._scrollEndPromise).then(function(){that.view._setState(UnrealizingState)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()}}),UnrealizingState=_Base.Class.define(function(view){this.view=view},{name:"UnrealizingState",enter:function(){var that=this;this.promise=this.view._lazilyUnrealizeItems().then(function(){return that.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),that.view._renderCompletePromise}).then(function(){that.view._setState(CompletedState)})},stop:function(){this.view._cancelRealize(),this.promise.cancel(),this.view._setState(CanceledState)},realizePage:function(NewStateType){this.promise.cancel(),this.view._setState(NewStateType)},rebuildTree:function(){this.view._setState(BuildingState)},relayout:function(){this.view._setState(LayingoutState)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),RealizingAnimatingState=_Base.Class.define(function(view,realizePromise){this.view=view,this.realizePromise=realizePromise,this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var that=this;this.animating=!0,this.animatePromise=this.view._startAnimations(),this.animateSignal=new _Signal,this.view._executeAnimations=!1,this.animatePromise.done(function(){that.animating=!1,that.modifiedElements?(that.view._updateTreeImpl(that.count,that.delta,that.modifiedElements),that.modifiedElements=null,that.view._setState(CanceledState)):that.animateSignal.complete()},function(error){return that.animating=!1,Promise.wrapError(error)}),this._waitForRealize()},_waitForRealize:function(){var that=this;this.realizing=!0,this.realizePromise.done(function(){that.realizing=!1});var currentRealizeId=++this.realizeId;Promise.join([this.realizePromise,this.animateSignal.promise]).done(function(){currentRealizeId===that.realizeId&&(that.view._completeUpdateTree(),that.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),that.view._setState(UnrealizingState))})},stop:function(stopTreeCreation){this.realizePromise.cancel(),this.view._cancelRealize(),stopTreeCreation&&(this.animatePromise.cancel(),this.view._setState(CanceledState))},realizePage:function(){if(!this.modifiedElements){var that=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return Promise._cancelBlocker(that.view._realizePageImpl())}),this._waitForRealize()}},rebuildTree:function(){this.stop(!0),this.view._setState(BuildingState)},relayout:function(){this.stop(!0),this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null),this.view._setState(LayingoutState)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){if(this.animating){var previousModifiedElements=this.modifiedElements;return this.count=count,this.delta=delta,this.modifiedElements=modifiedElements,previousModifiedElements?Promise.cancel:this.animatePromise}return this.view._updateTreeImpl(count,delta,modifiedElements)},setLoadingState:function(state){this.view._listView._setViewState(state)}}),CompletedState=_Base.Class.derive(CanceledState,function(view){this.view=view},{name:"CompletedState",enter:function(){this._stopped=!1,this.view._setupDeferredActions(),this.view._realizationLevel=_VirtualizeContentsView._realizationLevel.normal,this.view._listView._raiseViewComplete(),this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(LayingoutNewContainersState)},stop:function(){this._stopped=!0,CanceledState.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._setState(LayingoutNewContainersState)},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements,!0)}}),LayingoutNewContainersState=_Base.Class.derive(CanceledState,function(view){this.view=view},{name:"LayingoutNewContainersState",enter:function(){var that=this;this.promise=Promise.join([this.view.deferTimeout,this.view._layoutWork]),this.promise.then(function(){that.view._relayoutInComplete=!1,that.relayout(CanceledState)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()},realizePage:function(NewStateType){this.stop(),this.view._setState(LayingoutState,NewStateType)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return _VirtualizeContentsView})})}),define("require-style!less/styles-listview",[],function(){}),define("require-style!less/colors-listview",[],function(){}),define("WinJS/Controls/ListView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../_Accents","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_SafeHtml","../Utilities/_TabContainer","../Utilities/_UI","../Utilities/_VersionManager","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler","./ListView/_BrowseMode","./ListView/_ErrorMessages","./ListView/_GroupFocusCache","./ListView/_GroupsContainer","./ListView/_Helpers","./ListView/_ItemsContainer","./ListView/_Layouts","./ListView/_SelectionManager","./ListView/_VirtualizeContentsView","require-style!less/styles-listview","require-style!less/colors-listview"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,_Accents,Animations,_TransitionAnimation,BindingList,Promise,Scheduler,_Signal,_Control,_Dispose,_ElementUtilities,_Hoverable,_ItemsManager,_SafeHtml,_TabContainer,_UI,_VersionManager,_Constants,_ItemEventsHandler,_BrowseMode,_ErrorMessages,_GroupFocusCache,_GroupsContainer,_Helpers,_ItemsContainer,_Layouts,_SelectionManager,_VirtualizeContentsView){"use strict";function disposeControls(){var temp=controlsToDispose;controlsToDispose=[],temp=temp.filter(function(c){return c._isZombie()?(c._dispose(),!1):!0}),controlsToDispose=controlsToDispose.concat(temp)}function scheduleForDispose(lv){controlsToDispose.push(lv),disposeControlTimeout&&disposeControlTimeout.cancel(),disposeControlTimeout=Promise.timeout(DISPOSE_TIMEOUT).then(disposeControls)}function getOffsetRight(element){return element.offsetParent?element.offsetParent.offsetWidth-element.offsetLeft-element.offsetWidth:0}_Accents.createAccentRule(".win-listview:not(.win-selectionstylefilled) .win-selectioncheckmarkbackground,         .win-itemcontainer:not(.win-selectionstylefilled) .win-selectioncheckmarkbackground",[{name:"border-color",value:_Accents.ColorTypes.accent},{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-listview:not(.win-selectionstylefilled) .win-container.win-selected .win-selectionborder,         .win-itemcontainer:not(.win-selectionstylefilled).win-container.win-selected .win-selectionborder",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-listview.win-selectionstylefilled .win-selected .win-selectionbackground,         .win-itemcontainer.win-selectionstylefilled.win-selected .win-selectionbackground",[{name:"background-color",value:_Accents.ColorTypes.accent}]);var disposeControlTimeout,transformNames=_BaseUtils._browserStyleEquivalents.transform,DISPOSE_TIMEOUT=1e3,controlsToDispose=[],uniqueID=_ElementUtilities._uniqueID,strings={get notCompatibleWithSemanticZoom(){return"ListView can only be used with SemanticZoom if randomAccess loading behavior is specified."},get listViewInvalidItem(){return"Item must provide index, key or description of corresponding item."},get listViewViewportAriaLabel(){return _Resources._getWinJSString("ui/listViewViewportAriaLabel").value}},requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,ListViewAnimationType={entrance:"entrance",contentTransition:"contentTransition"};_Base.Namespace.define("WinJS.UI",{ListViewAnimationType:ListViewAnimationType,ListView:_Base.Namespace._lazy(function(){var AffectedRange=_Base.Class.define(function(){this.clear()},{add:function(range,itemsCount){if(range._lastKnownSizeOfData=itemsCount,this._range){this._range.start=Math.min(this._range.start,range.start);var previousUnmodifiedItemsFromEnd=this._range._lastKnownSizeOfData-this._range.end,newUnmodifiedItemsFromEnd=range._lastKnownSizeOfData-range.end,finalUnmodifiedItemsFromEnd=Math.min(previousUnmodifiedItemsFromEnd,newUnmodifiedItemsFromEnd);this._range._lastKnownSizeOfData=range._lastKnownSizeOfData,this._range.end=this._range._lastKnownSizeOfData-finalUnmodifiedItemsFromEnd}else this._range=range},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),ZoomableView=_Base.Class.define(function(listView){this._listView=listView},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages){this._listView._configureForZoom(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages)},setCurrentItem:function(x,y){this._listView._setCurrentItem(x,y)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(item,position){return this._listView._positionItem(item,position)},endZoom:function(isCurrentView){this._listView._endZoom(isCurrentView)},pinching:{get:function(){return this._listView._pinching},set:function(value){this._listView._pinching=value}}}),ListView=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("div"),this._id=element.id||"",this._writeProfilerMark("constructor,StartTM"),options=options||{},element.winControl=this,_ElementUtilities.addClass(element,"win-disposable"),this._affectedRange=new AffectedRange,this._mutationObserver=new _ElementUtilities._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=element,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=_Constants._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._lastFocusedElementInGroupTrack={type:_UI.ObjectType.item,index:-1},this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1},this._viewportWidth=_Constants._UNINITIALIZED,this._viewportHeight=_Constants._UNINITIALIZED,this._manipulationState=_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new _GroupFocusCache._UnsupportedGroupFocusCache,this._viewChange=_Constants._ViewChange.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new _VirtualizeContentsView._VirtualizeContentsView(this),this._selection=new _SelectionManager._SelectionManager(this),this._createTemplates(),this._groupHeaderRenderer=_ItemsManager._trivialHtmlRenderer,this._itemRenderer=_ItemsManager._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,options.itemDataSource)this._dataSource=options.itemDataSource;else{var list=new BindingList.List;this._dataSource=list.dataSource}this._selectionMode=_UI.SelectionMode.multi,this._tap=_UI.TapBehavior.invokeOnly,this._groupHeaderTap=_UI.GroupHeaderTapBehavior.invoke,this._mode=new _BrowseMode._SelectionMode(this),this._groups=new _GroupsContainer._NoGroups(this),this._updateItemsAriaRoles(),this._updateGroupHeadersAriaRoles(),this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._element.tabIndex=-1,this._tabManager.tabIndex=this._tabIndex,"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative"),this._updateItemsManager(),options.layout||this._updateLayout(new _Layouts.GridLayout),this._attachEvents(),this._runningInit=!0,_Control.setOptions(this,options),this._runningInit=!1,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(layoutObject){this._updateLayout(layoutObject),this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},maxLeadingPages:{get:function(){return this._view.maxLeadingPages},set:function(value){this._view.maxLeadingPages=Math.max(0,Math.floor(value))}},maxTrailingPages:{get:function(){return this._view.maxTrailingPages},set:function(value){this._view.maxTrailingPages=Math.max(0,Math.floor(value))}},pagesToLoad:{get:function(){return 2*_VirtualizeContentsView._VirtualizeContentsView._defaultPagesToPrefetch+1},set:function(){_ElementUtilities._deprecated(_ErrorMessages.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){_ElementUtilities._deprecated(_ErrorMessages.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(newValue){function groupStatusChanged(eventObject){eventObject.detail===_UI.DataSourceStatus.failure&&(that.itemDataSource=null,that.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");
var that=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",groupStatusChanged,!1),this._groupDataSource=newValue,this._groupFocusCache=newValue&&this._supportsGroupHeaderKeyboarding?new _GroupFocusCache._GroupFocusCache(this):new _GroupFocusCache._UnsupportedGroupFocusCache,this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",groupStatusChanged,!1),this._createGroupsContainer(),this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1,this._groupDataSource?_ElementUtilities.addClass(this._element,_Constants._groupsClass):_ElementUtilities.removeClass(this._element,_Constants._groupsClass),this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){_ElementUtilities._deprecated(_ErrorMessages.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){_ElementUtilities._deprecated(_ErrorMessages.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(newMode){if("string"==typeof newMode&&newMode.match(/^(none|single|multi)$/)){if(_BaseUtils.isPhone&&newMode===_UI.SelectionMode.single)return;return this._selectionMode=newMode,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),void this._configureSelectionMode()}throw new _ErrorFromName("WinJS.UI.ListView.ModeIsInvalid",_ErrorMessages.modeIsInvalid)}},tapBehavior:{get:function(){return this._tap},set:function(tap){_BaseUtils.isPhone&&tap===_UI.TapBehavior.directSelect||(this._tap=tap,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(tap){this._groupHeaderTap=tap,this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return"none"},set:function(value){_ElementUtilities._deprecated(_ErrorMessages.swipeBehaviorDeprecated)}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(newData){this._writeProfilerMark("set_itemDataSource,info"),this._dataSource=newData||(new BindingList.List).dataSource,this._groupFocusCache.clear(),this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(newRenderer){this._setRenderer(newRenderer,!1),this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(release){_ElementUtilities._deprecated(_ErrorMessages.resetItemIsDeprecated),this._itemRelease=release}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(newRenderer){this._setRenderer(newRenderer,!0),this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(release){_ElementUtilities._deprecated(_ErrorMessages.resetGroupHeaderIsDeprecated),this._groupHeaderRelease=release}},header:{get:function(){return this._header},set:function(newHeader){_ElementUtilities.empty(this._headerContainer),this._header=newHeader,newHeader&&(this._header.tabIndex=this._tabIndex,this._headerContainer.appendChild(newHeader));var currentFocus=this._selection._getFocused();if(currentFocus.type===_UI.ObjectType.header){var targetEntity=currentFocus;newHeader||(targetEntity={type:_UI.ObjectType.item,index:0}),this._hasKeyboardFocus?this._changeFocus(targetEntity,!0,!1,!0):this._changeFocusPassively(targetEntity)}this.recalculateItemPosition(),this._raiseHeaderFooterVisibilityEvent()}},footer:{get:function(){return this._footer},set:function(newFooter){_ElementUtilities.empty(this._footerContainer),this._footer=newFooter,newFooter&&(this._footer.tabIndex=this._tabIndex,this._footerContainer.appendChild(newFooter));var currentFocus=this._selection._getFocused();if(currentFocus.type===_UI.ObjectType.footer){var targetEntity=currentFocus;newFooter||(targetEntity={type:_UI.ObjectType.item,index:0}),this._hasKeyboardFocus?this._changeFocus(targetEntity,!0,!1,!0):this._changeFocusPassively(targetEntity)}this.recalculateItemPosition(),this._raiseHeaderFooterVisibilityEvent()}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(itemIndex){if(!(0>itemIndex)){this._writeProfilerMark("set_indexOfFirstVisible("+itemIndex+"),info"),this._raiseViewLoading(!0);var that=this;this._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){var range;return that._entityInRange({type:_UI.ObjectType.item,index:itemIndex}).then(function(validated){return validated.inRange?that._getItemOffset({type:_UI.ObjectType.item,index:validated.index}).then(function(r){return range=r,that._ensureFirstColumnRange(_UI.ObjectType.item)}).then(function(){return range=that._correctRangeInFirstColumn(range,_UI.ObjectType.item),range=that._convertFromCanvasCoordinates(range),that._view.waitForValidScrollPosition(range.begin)}).then(function(begin){var direction=begin<that._lastScrollPosition?"left":"right",max=that._viewport[that._scrollLength]-that._getViewportLength();return begin=_ElementUtilities._clamp(begin,0,max),{position:begin,direction:direction}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var focused=this._selection._getFocused(),retVal={index:focused.index,type:focused.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1};if(focused.type===_UI.ObjectType.groupHeader){var group=this._groups.group(focused.index);group&&(retVal.key=group.key,retVal.showFocus=!(!group.header||!_ElementUtilities.hasClass(group.header,_Constants._itemFocusClass)))}else if(focused.type===_UI.ObjectType.item){var item=this._view.items.itemAt(focused.index);if(item){var record=this._itemsManager._recordFromElement(item);retVal.key=record.item&&record.item.key,retVal.showFocus=!!item.parentNode.querySelector("."+_Constants._itemFocusOutlineClass)}}return retVal},set:function(data){function setItemFocused(item,isInTree,entity){var drawKeyboardFocus=!!data.showFocus&&that._hasKeyboardFocus;that._unsetFocusOnItem(isInTree),that._selection._setFocused(entity,drawKeyboardFocus),that._hasKeyboardFocus?(that._keyboardFocusInbound=drawKeyboardFocus,that._setFocusOnItem(entity)):that._tabManager.childFocus=isInTree?item:null,entity.type!==_UI.ObjectType.groupHeader&&(that._updateFocusCache(entity.index),that._updater&&(that._updater.newSelectionPivot=entity.index,that._updater.oldSelectionPivot=-1),that._selection._pivot=entity.index)}this._hasKeyboardFocus=data.hasFocus||this._hasKeyboardFocus,data.type||(data.type=_UI.ObjectType.item);var that=this;if(data.key&&(data.type===_UI.ObjectType.item&&this._dataSource.itemFromKey||data.type===_UI.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)){this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel();var dataSource=data.type===_UI.ObjectType.groupHeader?this._groupDataSource:this._dataSource;this.oldCurrentItemKeyFetch=dataSource.itemFromKey(data.key).then(function(item){if(that.oldCurrentItemKeyFetch=null,item){var element=data.type===_UI.ObjectType.groupHeader?that._groups.group(item.index).header:that._view.items.itemAt(item.index);setItemFocused(element,!!element,{type:data.type,index:item.index})}})}else{var element;if(data.type===_UI.ObjectType.header||data.type===_UI.ObjectType.footer)element=data.type===_UI.ObjectType.header?this._header:this._footer,setItemFocused(element,!!element,{type:data.type,index:data.index});else if(void 0!==data.index){if(data.type===_UI.ObjectType.groupHeader){var group=that._groups.group(data.index);element=group&&group.header}else element=that._view.items.itemAt(data.index);setItemFocused(element,!!element,{type:data.type,index:data.index})}}}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new ZoomableView(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(value){_BaseUtils.isPhone||this._dragSource!==value&&(this._dragSource=value,this._setDraggable())}},itemsReorderable:{get:function(){return this._reorderable},set:function(value){_BaseUtils.isPhone||this._reorderable!==value&&(this._reorderable=value,this._setDraggable())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(value){this._maxDeferredItemCleanup=Math.max(0,+value||0)}},dispose:function(){this._dispose()},elementFromIndex:function(itemIndex){return this._view.items.itemAt(itemIndex)},indexOfElement:function(element){return this._view.items.index(element)},ensureVisible:function(value){var type=_UI.ObjectType.item,itemIndex=value;if(+value!==value&&(type=value.type,itemIndex=value.index),this._writeProfilerMark("ensureVisible("+type+": "+itemIndex+"),info"),!(0>itemIndex)){this._raiseViewLoading(!0);var that=this;this._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){var range;return that._entityInRange({type:type,index:itemIndex}).then(function(validated){return validated.inRange?that._getItemOffset({type:type,index:validated.index}).then(function(r){return range=r,that._ensureFirstColumnRange(type)}).then(function(){range=that._correctRangeInFirstColumn(range,type);var viewportLength=that._getViewportLength(),left=that._viewportScrollPosition,right=left+viewportLength,newPosition=that._viewportScrollPosition,entityWidth=range.end-range.begin;range=that._convertFromCanvasCoordinates(range);var handled=!1;if(type===_UI.ObjectType.groupHeader&&left<=range.begin){var header=that._groups.group(validated.index).header;if(header){var headerEnd,margins=_Layouts._getMargins(header);if(that._horizontalLayout){var rtl=that._rtl(),headerStart=rtl?getOffsetRight(header)-margins.right:header.offsetLeft-margins.left;headerEnd=headerStart+header.offsetWidth+(rtl?margins.left:margins.right)}else headerEnd=header.offsetTop+header.offsetHeight+margins.top;handled=right>=headerEnd}}handled||(entityWidth>=right-left?newPosition=range.begin:range.begin<left?newPosition=range.begin:range.end>right&&(newPosition=range.end-viewportLength));var direction=newPosition<that._lastScrollPosition?"left":"right",max=that._viewport[that._scrollLength]-viewportLength;return newPosition=_ElementUtilities._clamp(newPosition,0,max),{position:newPosition,direction:direction}}):{position:0,direction:"left"}})},!0)}},loadMorePages:function(){_ElementUtilities._deprecated(_ErrorMessages.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info"),this._forceLayoutImpl(_Constants._ViewChange.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info"),this._forceLayoutImpl(_Constants._ViewChange.remeasure)},_entityInRange:function(entity){if(entity.type===_UI.ObjectType.item)return this._itemsCount().then(function(itemsCount){var index=_ElementUtilities._clamp(entity.index,0,itemsCount-1);return{inRange:index>=0&&itemsCount>index,index:index}});if(entity.type===_UI.ObjectType.groupHeader){var index=_ElementUtilities._clamp(entity.index,0,this._groups.length()-1);return Promise.wrap({inRange:index>=0&&index<this._groups.length(),index:index})}return Promise.wrap({inRange:!0,index:0})},_forceLayoutImpl:function(viewChange){var that=this;this._versionManager.unlocked.then(function(){that._writeProfilerMark("_forceLayoutImpl viewChange("+viewChange+"),info"),that._cancelAsyncViewWork(),that._pendingLayoutReset=!0,that._resizeViewport(),that._batchViewUpdates(viewChange,_Constants._ScrollToPriority.low,function(){return{position:that._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){var selectionModeClass=_Constants._selectionModeClass,hidingSelectionModeClass=_Constants._hidingSelectionMode;if(this._isInSelectionMode())_ElementUtilities.addClass(this._canvas,selectionModeClass),_ElementUtilities.removeClass(this._canvas,hidingSelectionModeClass);else{if(_ElementUtilities.hasClass(this._canvas,selectionModeClass)){var that=this;_Global.setTimeout(function(){_Global.setTimeout(function(){_ElementUtilities.removeClass(that._canvas,hidingSelectionModeClass)},_Constants._hidingSelectionModeAnimationTimeout)},50),_ElementUtilities.addClass(this._canvas,hidingSelectionModeClass)}_ElementUtilities.removeClass(this._canvas,selectionModeClass)}},_lastScrollPosition:{get:function(){return this._lastScrollPositionValue},set:function(position){if(0===position)this._lastDirection="right",this._direction="right",this._lastScrollPositionValue=0;else{var currentDirection=position<this._lastScrollPositionValue?"left":"right";this._direction=this._scrollDirection(position),this._lastDirection=currentDirection,this._lastScrollPositionValue=position}}},_hasHeaderOrFooter:{get:function(){return!(!this._header&&!this._footer)}},_getHeaderOrFooterFromElement:function(element){return this._header&&this._header.contains(element)?this._header:this._footer&&this._footer.contains(element)?this._footer:null},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=_ElementUtilities.getScrollPosition(this._viewport)[this._scrollProperty],this._currentScrollPosition},set:function(value){var newScrollPos={};newScrollPos[this._scrollProperty]=value,_ElementUtilities.setScrollPosition(this._viewport,newScrollPos),this._currentScrollPosition=value}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(value){var transformX=this._horizontal()?this._rtl()?-value:value:0,transformY=this._horizontal()?0:value;0!==value?this._canvas.style[transformNames.scriptName]="translate( "+transformX+"px, "+transformY+"px)":this._canvas.style[transformNames.scriptName]="",this._canvasStartValue=value}},scrollPosition:{get:function(){return this._viewportScrollPosition},set:function(newPosition){var that=this;this._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){return that._view.waitForValidScrollPosition(newPosition).then(function(){var max=that._viewport[that._scrollLength]-that._getViewportLength();newPosition=_ElementUtilities._clamp(newPosition,0,max);var direction=newPosition<that._lastScrollPosition?"left":"right";return{position:newPosition,direction:direction}})},!0)}},_setRenderer:function(newRenderer,isGroupHeaderRenderer){var renderer;if(newRenderer){if("function"==typeof newRenderer)renderer=newRenderer;else if("object"==typeof newRenderer){if(_BaseUtils.validation&&!newRenderer.renderItem)throw new _ErrorFromName("WinJS.UI.ListView.invalidTemplate",_ErrorMessages.invalidTemplate);renderer=newRenderer.renderItem}}else{if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.UI.ListView.invalidTemplate",_ErrorMessages.invalidTemplate);renderer=_ItemsManager.trivialHtmlRenderer}renderer&&(isGroupHeaderRenderer?this._groupHeaderRenderer=renderer:this._itemRenderer=renderer)},_renderWithoutReuse:function(itemPromise,oldElement){oldElement&&_Dispose._disposeElement(oldElement);var templateResult=this._itemRenderer(itemPromise);if(templateResult.then)return templateResult.then(function(element){return element.tabIndex=0,element});var element=templateResult.element||templateResult;return element.tabIndex=0,templateResult},_isInsertedItem:function(itemPromise){return!!this._insertedItems[itemPromise.handle]},_clearInsertedItems:function(){for(var keys=Object.keys(this._insertedItems),i=0,len=keys.length;len>i;i++)this._insertedItems[keys[i]].release();this._insertedItems={},this._modifiedElements=[],this._countDifference=0},_cancelAsyncViewWork:function(stopTreeCreation){this._view.stopWork(stopTreeCreation)},_updateView:function(){function resetCache(){that._itemsBlockExtent=-1,that._firstItemRange=null,that._firstHeaderRange=null,that._itemMargins=null,that._headerMargins=null,that._canvasMargins=null,that._cachedRTL=null,that._rtl()}function functorWrapper(){that._scrollToPriority=_Constants._ScrollToPriority.uninitialized;var setScrollbarPosition=that._setScrollbarPosition;that._setScrollbarPosition=!1;var position="number"==typeof that._scrollToFunctor?{position:that._scrollToFunctor}:that._scrollToFunctor();return Promise.as(position).then(function(scroll){return scroll=scroll||{},setScrollbarPosition&&+scroll.position===scroll.position&&(that._lastScrollPosition=scroll.position,that._viewportScrollPosition=scroll.position),scroll},function(error){return that._setScrollbarPosition|=setScrollbarPosition,Promise.wrapError(error)})}if(!this._isZombie()){var that=this,viewChange=this._viewChange;this._viewChange=_Constants._ViewChange.realize,viewChange===_Constants._ViewChange.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),resetCache(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(functorWrapper,!0),this._setFocusOnItem(this._selection._getFocused()),this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1}):viewChange===_Constants._ViewChange.remeasure?(this._view.resetItems(!0),this._resetLayout(),resetCache(),this._view.refresh(functorWrapper),this._setFocusOnItem(this._selection._getFocused()),this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1}):viewChange===_Constants._ViewChange.relayout?(this._pendingLayoutReset&&(this._resetLayout(),resetCache()),this._view.refresh(functorWrapper)):(this._view.onScroll(functorWrapper),this._raiseHeaderFooterVisibilityEvent())}},_batchViewUpdates:function(viewChange,scrollToPriority,positionFunctor,setScrollbarPosition,skipFadeout){if(this._viewChange=Math.min(this._viewChange,viewChange),(null===this._scrollToFunctor||scrollToPriority>=this._scrollToPriority)&&(this._scrollToPriority=scrollToPriority,this._scrollToFunctor=positionFunctor),this._setScrollbarPosition|=!!setScrollbarPosition,!this._batchingViewUpdates){this._raiseViewLoading();var that=this;this._batchingViewUpdatesSignal=new _Signal,this._batchingViewUpdates=Promise.any([this._batchingViewUpdatesSignal.promise,Scheduler.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){return that._isZombie()?void 0:that._viewChange!==_Constants._ViewChange.rebuild||that._firstTimeDisplayed||0===Object.keys(that._view.items._itemData).length||skipFadeout?void 0:that._fadeOutViewport()}).then(function(){that._batchingViewUpdates=null,that._batchingViewUpdatesSignal=null,that._updateView(),that._firstTimeDisplayed=!1},function(){that._batchingViewUpdates=null,that._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetCanvas:function(){if(!this._disposed){var newCanvas=_Global.document.createElement("div");newCanvas.className=this._canvas.className,this._viewport.replaceChild(newCanvas,this._canvas),this._canvas=newCanvas,this._groupsToRemove={},this._canvas.appendChild(this._canvasProxy)}},_setupInternalTree:function(){_ElementUtilities.addClass(this._element,_Constants._listViewClass),_ElementUtilities[this._rtl()?"addClass":"removeClass"](this._element,_Constants._rtlListViewClass),this._element.innerHTML='<div tabIndex="-1" role="group" class="'+_Constants._viewportClass+" "+_Constants._horizontalClass+'"><div></div><div class="'+_Constants._scrollableClass+'"><div class="'+_Constants._proxyClass+'"></div></div><div></div><div></div></div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;width:0px;height:0px;" tabindex="-1"></div>',this._viewport=this._element.firstElementChild,this._headerContainer=this._viewport.firstElementChild,_ElementUtilities.addClass(this._headerContainer,_Constants._listHeaderContainerClass),this._canvas=this._headerContainer.nextElementSibling,this._footerContainer=this._canvas.nextElementSibling,_ElementUtilities.addClass(this._footerContainer,_Constants._listFooterContainerClass),this._canvasProxy=this._canvas.firstElementChild,this._deleteWrapper=this._canvas.nextElementSibling,this._keyboardEventsHelper=this._viewport.nextElementSibling,this._tabIndex=_ElementUtilities.getTabIndex(this._element),this._tabIndex<0&&(this._tabIndex=0),this._tabManager=new _TabContainer.TabContainer(this._viewport),this._tabManager.tabIndex=this._tabIndex,this._progressBar=_Global.document.createElement("progress"),_ElementUtilities.addClass(this._progressBar,_Constants._progressClass),_ElementUtilities.addClass(this._progressBar,"win-progress-ring"),this._progressBar.style.position="absolute",this._progressBar.max=100},_unsetFocusOnItem:function(newFocusExists){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus),this._isZombie()||(newFocusExists||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,_Global.document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,_ElementUtilities._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(entity){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var that=this,setFocusOnItemImpl=function(item){that._isZombie()||(that._tabManager.childFocus!==item&&(that._tabManager.childFocus=item),that._focusRequest=null,that._hasKeyboardFocus&&!that._itemFocused&&(that._selection._keyboardFocused()&&that._drawFocusRectangle(item),(entity.type===_UI.ObjectType.groupHeader||entity.type===_UI.ObjectType.item)&&that._view.updateAriaForAnnouncement(item,entity.type===_UI.ObjectType.groupHeader?that._groups.length():that._cachedCount),that._itemFocused=!0,_ElementUtilities._setActive(item)))};entity.type===_UI.ObjectType.item?this._focusRequest=this._view.items.requestItem(entity.index):entity.type===_UI.ObjectType.groupHeader?this._focusRequest=this._groups.requestHeader(entity.index):this._focusRequest=Promise.wrap(entity.type===_UI.ObjectType.header?this._header:this._footer),this._focusRequest.then(setFocusOnItemImpl)}},_attachEvents:function(){function listViewHandler(eventName,caseSensitive,capture){return{name:caseSensitive?eventName:eventName.toLowerCase(),handler:function(eventObject){that["_on"+eventName](eventObject)},capture:capture}}function modeHandler(eventName,caseSensitive,capture){return{capture:capture,name:caseSensitive?eventName:eventName.toLowerCase(),handler:function(eventObject){var currentMode=that._mode,name="on"+eventName;!that._disposed&&currentMode[name]&&currentMode[name](eventObject)}}}function observerHandler(handlerName,attributesFilter){return{handler:function(listOfChanges){that["_on"+handlerName](listOfChanges)},filter:attributesFilter}}var that=this,elementObservers=[observerHandler("PropertyChange",["dir","style","tabindex"])];this._cachedStyleDir=this._element.style.direction,elementObservers.forEach(function(elementObserver){new _ElementUtilities._MutationObserver(elementObserver.handler).observe(that._element,{attributes:!0,attributeFilter:elementObserver.filter})});var events=[modeHandler("PointerDown"),modeHandler("click",!1),modeHandler("PointerUp"),modeHandler("LostPointerCapture"),modeHandler("MSHoldVisual",!0),modeHandler("PointerCancel",!0),modeHandler("DragStart"),modeHandler("DragOver"),modeHandler("DragEnter"),modeHandler("DragLeave"),modeHandler("Drop"),modeHandler("ContextMenu")];events.forEach(function(eventHandler){_ElementUtilities._addEventListener(that._viewport,eventHandler.name,eventHandler.handler,!!eventHandler.capture)});var elementEvents=[listViewHandler("FocusIn",!1,!1),listViewHandler("FocusOut",!1,!1),modeHandler("KeyDown"),modeHandler("KeyUp"),listViewHandler("MSElementResize",!1,!1)];elementEvents.forEach(function(eventHandler){_ElementUtilities._addEventListener(that._element,eventHandler.name,eventHandler.handler,!!eventHandler.capture)}),this._onMSElementResizeBound=this._onMSElementResize.bind(this),_ElementUtilities._resizeNotifier.subscribe(this._element,this._onMSElementResizeBound);var initiallyParented=_Global.document.body.contains(this._element);_ElementUtilities._addInsertedNotifier(this._element),this._element.addEventListener("WinJSNodeInserted",function(event){return initiallyParented?void(initiallyParented=!1):void that._onMSElementResizeBound(event)},!1);var viewportEvents=[listViewHandler("MSManipulationStateChanged",!0),listViewHandler("Scroll")];viewportEvents.forEach(function(viewportEvent){that._viewport.addEventListener(viewportEvent.name,viewportEvent.handler,!1)}),this._viewport.addEventListener("onTabEnter",this._onTabEnter.bind(this)),this._viewport.addEventListener("onTabExit",this._onTabExit.bind(this)),this._viewport.addEventListener("onTabEntered",function(e){that._mode.onTabEntered(e)}),this._viewport.addEventListener("onTabExiting",function(e){that._mode.onTabExiting(e)})},_updateItemsManager:function(){function statusChanged(eventObject){eventObject.detail===_UI.DataSourceStatus.failure&&(that.itemDataSource=null,that.groupDataSource=null)}var that=this,notificationHandler={beginNotifications:function(){},changed:function(newItem,oldItem){if(!that._ifZombieDispose()){that._createUpdater();var elementInfo=that._updater.elements[uniqueID(oldItem)];if(elementInfo){var selected=that.selection._isIncluded(elementInfo.index);if(selected&&(that._updater.updateDrag=!0),oldItem!==newItem){if((that._tabManager.childFocus===oldItem||that._updater.newFocusedItem===oldItem)&&(that._updater.newFocusedItem=newItem,that._tabManager.childFocus=null),elementInfo.itemBox){_ElementUtilities.addClass(newItem,_Constants._itemClass),that._setupAriaSelectionObserver(newItem);var next=oldItem.nextElementSibling;elementInfo.itemBox.removeChild(oldItem),elementInfo.itemBox.insertBefore(newItem,next)}that._setAriaSelected(newItem,selected),that._view.items.setItemAt(elementInfo.newIndex,{element:newItem,itemBox:elementInfo.itemBox,container:elementInfo.container,itemsManagerRecord:elementInfo.itemsManagerRecord}),delete that._updater.elements[uniqueID(oldItem)],_Dispose._disposeElement(oldItem),that._updater.elements[uniqueID(newItem)]={item:newItem,container:elementInfo.container,itemBox:elementInfo.itemBox,index:elementInfo.index,newIndex:elementInfo.newIndex,itemsManagerRecord:elementInfo.itemsManagerRecord}}else elementInfo.itemBox&&elementInfo.container&&(_ItemEventsHandler._ItemEventsHandler.renderSelection(elementInfo.itemBox,newItem,selected,!0),_ElementUtilities[selected?"addClass":"removeClass"](elementInfo.container,_Constants._selectedClass));that._updater.changed=!0}for(var i=0,len=that._notificationHandlers.length;len>i;i++)that._notificationHandlers[i].changed(newItem,oldItem);that._writeProfilerMark("changed,info")}},removed:function(item,mirage,handle){function removeFromSelection(index){that._updater.updateDrag=!0,that._currentMode()._dragging&&that._currentMode()._draggingUnselectedItem&&that._currentMode()._dragInfo._isIncluded(index)&&(that._updater.newDragInfo=new _SelectionManager._Selection(that,[]));var firstRange=that._updater.selectionFirst[index],lastRange=that._updater.selectionLast[index],range=firstRange||lastRange;range&&(delete that._updater.selectionFirst[range.oldFirstIndex],delete that._updater.selectionLast[range.oldLastIndex],that._updater.selectionChanged=!0)}if(!that._ifZombieDispose()){that._createUpdater();var insertedItem=that._insertedItems[handle];insertedItem&&delete that._insertedItems[handle];var index;if(item){var elementInfo=that._updater.elements[uniqueID(item)],itemObject=that._itemsManager.itemObject(item);if(itemObject&&that._groupFocusCache.deleteItem(itemObject.key),elementInfo){if(index=elementInfo.index,elementInfo.itemBox){var itemBox=elementInfo.itemBox,oddStripe=_Constants._containerOddClass,evenStripe=_Constants._containerEvenClass,containerStripe=_ElementUtilities.hasClass(itemBox.parentElement,evenStripe)?evenStripe:oddStripe;that._updater.removed.push({index:index,itemBox:itemBox,containerStripe:containerStripe})}that._updater.deletesCount++;var itemData=that._view.items.itemDataAt(index);itemData.removed=!0,delete that._updater.elements[uniqueID(item)]}else index=itemObject&&itemObject.index;that._updater.oldFocus.type!==_UI.ObjectType.groupHeader&&that._updater.oldFocus.index===index&&(that._updater.newFocus.index=index,that._updater.focusedItemRemoved=!0),removeFromSelection(index)}else index=that._updater.selectionHandles[handle],index===+index&&removeFromSelection(index);that._writeProfilerMark("removed("+index+"),info"),that._updater.changed=!0}},updateAffectedRange:function(newerRange){that._itemsCount().then(function(count){var containerCount=that._view.containers?that._view.containers.length:0;newerRange.start=Math.min(newerRange.start,containerCount),that._affectedRange.add(newerRange,count)}),that._createUpdater(),that._updater.changed=!0},indexChanged:function(item,newIndex,oldIndex){if(!that._ifZombieDispose()){if(that._createUpdater(),item){var itemObject=that._itemsManager.itemObject(item);itemObject&&that._groupFocusCache.updateItemIndex(itemObject.key,newIndex);var elementInfo=that._updater.elements[uniqueID(item)];elementInfo&&(elementInfo.newIndex=newIndex,that._updater.changed=!0),that._updater.itemsMoved=!0}that._currentMode()._dragging&&that._currentMode()._draggingUnselectedItem&&that._currentMode()._dragInfo._isIncluded(oldIndex)&&(that._updater.newDragInfo=new _SelectionManager._Selection(that,[{firstIndex:newIndex,lastIndex:newIndex}]),that._updater.updateDrag=!0),that._updater.oldFocus.type!==_UI.ObjectType.groupHeader&&that._updater.oldFocus.index===oldIndex&&(that._updater.newFocus.index=newIndex,that._updater.changed=!0),that._updater.oldSelectionPivot===oldIndex&&(that._updater.newSelectionPivot=newIndex,that._updater.changed=!0);var range=that._updater.selectionFirst[oldIndex];range&&(range.newFirstIndex=newIndex,that._updater.changed=!0,that._updater.selectionChanged=!0,that._updater.updateDrag=!0),range=that._updater.selectionLast[oldIndex],range&&(range.newLastIndex=newIndex,that._updater.changed=!0,that._updater.selectionChanged=!0,that._updater.updateDrag=!0)}},endNotifications:function(){that._update()},inserted:function(itemPromise){that._ifZombieDispose()||(that._writeProfilerMark("inserted,info"),that._createUpdater(),that._updater.changed=!0,itemPromise.retain(),that._updater.insertsCount++,that._insertedItems[itemPromise.handle]=itemPromise)},moved:function(item,previous,next,itemPromise){if(!that._ifZombieDispose()){if(that._createUpdater(),that._updater.movesCount++,item){that._updater.itemsMoved=!0;var elementInfo=that._updater.elements[uniqueID(item)];elementInfo&&(elementInfo.moved=!0)}var index=that._updater.selectionHandles[itemPromise.handle];if(index===+index){that._updater.updateDrag=!0,that._updater.selectionChanged=!0,that._updater.changed=!0;var firstRange=that._updater.selectionFirst[index],lastRange=that._updater.selectionLast[index],range=firstRange||lastRange;range&&range.oldFirstIndex!==range.oldLastIndex&&(delete that._updater.selectionFirst[range.oldFirstIndex],delete that._updater.selectionLast[range.oldLastIndex])}that._writeProfilerMark("moved("+index+"),info");
}},countChanged:function(newCount,oldCount){that._ifZombieDispose()||(that._writeProfilerMark("countChanged("+newCount+"),info"),that._cachedCount=newCount,that._createUpdater(),that._view.lastIndexDisplayed+1===oldCount&&(that._updater.changed=!0),that._updater.countDifference+=newCount-oldCount)},reload:function(){that._ifZombieDispose()||(that._writeProfilerMark("reload,info"),that._processReload())}};this._versionManager&&this._versionManager._dispose(),this._versionManager=new _VersionManager._VersionManager,this._updater=null;var ranges=this._selection.getRanges();this._selection._selected.clear(),this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",statusChanged,!1),this._clearInsertedItems(),this._itemsManager.release()),this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null),this._cachedCount=_Constants._UNINITIALIZED,this._itemsManager=_ItemsManager._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),notificationHandler,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(index){return index>=that.indexOfFirstVisible&&index<=that.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id}),this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",statusChanged,!1),this._selection._selected.set(ranges)},_processReload:function(){this._affectedRange.addAll(),this._cancelAsyncViewWork(!0),this._currentMode()._dragging&&this._currentMode()._clearDragProperties(),this._groupFocusCache.clear(),this._selection._reset(),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.low,this.scrollPosition)},_createUpdater:function(){if(!this._updater){this.itemDataSource._isVirtualizedDataSource&&this._affectedRange.addAll(),this._versionManager.beginUpdating(),this._cancelAsyncViewWork();var updater={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},newSelectionPivot:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},newFocus:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(index,item,itemData){updater.elements[uniqueID(item)]={item:item,container:itemData.container,itemBox:itemData.itemBox,index:index,newIndex:index,itemsManagerRecord:itemData.itemsManagerRecord,detached:itemData.detached}});for(var selection=this._selection._selected._ranges,i=0,len=selection.length;len>i;i++){var range=selection[i],newRange={newFirstIndex:selection[i].firstIndex,oldFirstIndex:selection[i].firstIndex,newLastIndex:selection[i].lastIndex,oldLastIndex:selection[i].lastIndex};updater.selectionFirst[newRange.oldFirstIndex]=newRange,updater.selectionLast[newRange.oldLastIndex]=newRange,updater.selectionHandles[range.firstPromise.handle]=newRange.oldFirstIndex,updater.selectionHandles[range.lastPromise.handle]=newRange.oldLastIndex}updater.oldSelectionPivot=this._selection._pivot,updater.newSelectionPivot=updater.oldSelectionPivot,updater.oldFocus=this._selection._getFocused(),updater.newFocus=this._selection._getFocused(),this._updater=updater}},_synchronize:function(){var updater=this._updater;if(this._updater=null,this._groupsChanged=!1,this._countDifference=this._countDifference||0,updater&&updater.changed){updater.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved(),updater.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(updater.removed.map(function(node){return node.itemBox})),(updater.itemsMoved||updater.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations(),this._currentMode().onDataChanged&&this._currentMode().onDataChanged();var newSelection=[];for(var i in updater.selectionFirst)if(updater.selectionFirst.hasOwnProperty(i)){var range=updater.selectionFirst[i];updater.selectionChanged=updater.selectionChanged||range.newLastIndex-range.newFirstIndex!==range.oldLastIndex-range.oldFirstIndex,range.newFirstIndex<=range.newLastIndex&&newSelection.push({firstIndex:range.newFirstIndex,lastIndex:range.newLastIndex})}if(updater.selectionChanged){var newSelectionItems=new _SelectionManager._Selection(this,newSelection);this._selection._fireSelectionChanging(newSelectionItems),this._selection._selected.set(newSelection),this._selection._fireSelectionChanged(),newSelectionItems.clear()}else this._selection._selected.set(newSelection);this._selection._updateCount(this._cachedCount),updater.newSelectionPivot=Math.min(this._cachedCount-1,updater.newSelectionPivot),this._selection._pivot=updater.newSelectionPivot>=0?updater.newSelectionPivot:_Constants._INVALID_INDEX,updater.newFocus.type!==_UI.ObjectType.groupHeader&&(updater.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,updater.newFocus.index))),this._selection._setFocused(updater.newFocus,this._selection._keyboardFocused());var previousModifiedElements=this._modifiedElements||[],previousModifiedElementsHash={};for(this._modifiedElements=[],this._countDifference+=updater.countDifference,i=0;i<previousModifiedElements.length;i++){var modifiedElement=previousModifiedElements[i];-1===modifiedElement.newIndex?this._modifiedElements.push(modifiedElement):previousModifiedElementsHash[modifiedElement.newIndex]=modifiedElement}for(i=0;i<updater.removed.length;i++){var removed=updater.removed[i],modifiedElement=previousModifiedElementsHash[removed.index];modifiedElement?delete previousModifiedElementsHash[removed.index]:modifiedElement={oldIndex:removed.index},modifiedElement.newIndex=-1,modifiedElement._removalHandled||(modifiedElement._itemBox=removed.itemBox,modifiedElement._containerStripe=removed.containerStripe),this._modifiedElements.push(modifiedElement)}var insertedKeys=Object.keys(this._insertedItems);for(i=0;i<insertedKeys.length;i++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[insertedKeys[i]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");var newItems={};for(i in updater.elements)if(updater.elements.hasOwnProperty(i)){var elementInfo=updater.elements[i];newItems[elementInfo.newIndex]={element:elementInfo.item,container:elementInfo.container,itemBox:elementInfo.itemBox,itemsManagerRecord:elementInfo.itemsManagerRecord,detached:elementInfo.detached};var modifiedElement=previousModifiedElementsHash[elementInfo.index];modifiedElement?(delete previousModifiedElementsHash[elementInfo.index],modifiedElement.newIndex=elementInfo.newIndex):modifiedElement={oldIndex:elementInfo.index,newIndex:elementInfo.newIndex},modifiedElement.moved=elementInfo.moved,this._modifiedElements.push(modifiedElement)}this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM");var previousIndices=Object.keys(previousModifiedElementsHash);for(i=0;i<previousIndices.length;i++){var key=previousIndices[i],modifiedElement=previousModifiedElementsHash[key];-1!==modifiedElement.oldIndex&&this._modifiedElements.push(modifiedElement)}this._view.items._itemData=newItems,updater.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?updater.newDragInfo&&(this._currentMode()._dragInfo=updater.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),updater.focusedItemRemoved||this._focusRequest&&updater.oldFocus.index!==updater.newFocus.index||updater.oldFocus.type!==updater.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):updater.newFocusedItem&&(this._hasKeyboardFocus=updater.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused()));var that=this;return this._groups.synchronizeGroups().then(function(){return updater.newFocus.type===_UI.ObjectType.groupHeader&&(updater.newFocus.index=Math.min(that._groups.length()-1,updater.newFocus.index),updater.newFocus.index<0&&(updater.newFocus={type:_UI.ObjectType.item,index:0}),that._selection._setFocused(updater.newFocus,that._selection._keyboardFocused())),that._versionManager.endUpdating(),updater.deletesCount>0&&that._updateDeleteWrapperSize(),that._view.updateTree(that._cachedCount,that._countDifference,that._modifiedElements)}).then(function(){return that._lastScrollPosition})}this._countDifference+=updater?updater.countDifference:0;var that=this;return this._groups.synchronizeGroups().then(function(){return updater&&that._versionManager.endUpdating(),that._view.updateTree(that._cachedCount,that._countDifference,that._modifiedElements)}).then(function(){return that.scrollPosition})},_updateDeleteWrapperSize:function(clear){var sizeProperty=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+sizeProperty]=(clear?0:this.scrollPosition+this._getViewportSize()[sizeProperty])+"px"},_verifyRealizationNeededForChange:function(){var skipRealization=!1,totalInViewport=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),deletesOnly=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference);if(deletesOnly&&this._updater.elements)for(var elementsKeys=Object.keys(this._updater.elements),i=0,len=elementsKeys.length;len>i;i++){var element=this._updater.elements[elementsKeys[i]],delta=element.index-element.newIndex;if(0>delta||delta>this._updater.deletesCount){deletesOnly=!1;break}}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0,deletesOnly&&this._view.lastIndexDisplayed<this._view.end-totalInViewport&&this._updater.deletesCount+this._view.deletesWithoutRealize<totalInViewport?(skipRealization=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0,this._view._setSkipRealizationForChange(skipRealization)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var that=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(scrollbarPos){that._writeProfilerMark("update,StopTM"),that._batchViewUpdates(_Constants._ViewChange.relayout,_Constants._ScrollToPriority.low,scrollbarPos).complete()})):this._batchViewUpdates(_Constants._ViewChange.relayout,_Constants._ScrollToPriority.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var that=this;this._updateJob=Scheduler.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){that._updateJob&&that._update()}),this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp(),this._groupDataSource?this._groups=new _GroupsContainer._UnvirtualizedGroupsContainer(this,this._groupDataSource):this._groups=new _GroupsContainer._NoGroups(this)},_createLayoutSite:function(){var that=this;return Object.create({invalidateLayout:function(){that._pendingLayoutReset=!0;var orientationChanged="horizontal"===that._layout.orientation!==that._horizontalLayout;that._affectedRange.addAll(),that._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.low,orientationChanged?0:that.scrollPosition,!1,!0)},itemFromIndex:function(itemIndex){return that._itemsManager._itemPromiseAtIndex(itemIndex)},groupFromIndex:function(groupIndex){return that._groupsEnabled()?groupIndex<that._groups.length()?that._groups.group(groupIndex).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(itemIndex){return itemIndex=Math.max(0,itemIndex),that._groups.groupFromItem(itemIndex)},renderItem:function(itemPromise){return Promise._cancelBlocker(that._itemsManager._itemFromItemPromise(itemPromise)).then(function(element){if(element){var record=that._itemsManager._recordFromElement(element);record.pendingReady&&record.pendingReady(),element=element.cloneNode(!0),_ElementUtilities.addClass(element,_Constants._itemClass);var itemBox=_Global.document.createElement("div");_ElementUtilities.addClass(itemBox,_Constants._itemBoxClass),itemBox.appendChild(element);var container=_Global.document.createElement("div");return _ElementUtilities.addClass(container,_Constants._containerClass),container.appendChild(itemBox),container}return Promise.cancel})},renderHeader:function(group){var rendered=_ItemsManager._normalizeRendererReturn(that.groupHeaderTemplate(Promise.wrap(group)));return rendered.then(function(headerRecord){_ElementUtilities.addClass(headerRecord.element,_Constants._headerClass);var container=_Global.document.createElement("div");return _ElementUtilities.addClass(container,_Constants._headerContainerClass),container.appendChild(headerRecord.element),container})},readyToMeasure:function(){that._getViewportLength(),that._getCanvasMargins()},_isZombie:function(){return that._isZombie()},_writeProfilerMark:function(text){that._writeProfilerMark(text)}},{_itemsManager:{enumerable:!0,get:function(){return that._itemsManager}},rtl:{enumerable:!0,get:function(){return that._rtl()}},surface:{enumerable:!0,get:function(){return that._canvas}},viewport:{enumerable:!0,get:function(){return that._viewport}},scrollbarPos:{enumerable:!0,get:function(){return that.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return that._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return that.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return that._animationsDisabled()}},tree:{enumerable:!0,get:function(){return that._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,that.scrollPosition-2*that._getViewportLength()),lastPixel:that.scrollPosition+3*that._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:that.scrollPosition,lastPixel:that.scrollPosition+that._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return that._itemsCount()}},groupCount:{enumerable:!0,get:function(){return that._groups.length()}},header:{enumerable:!0,get:function(){return that.header}},footer:{enumerable:!0,get:function(){return that.footer}}})},_initializeLayout:function(){this._affectedRange.addAll();var layoutSite=this._createLayoutSite();return this._layout.initialize(layoutSite,this._groupsEnabled()),"horizontal"===this._layout.orientation},_resetLayoutOrientation:function(resetScrollPosition){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",_ElementUtilities.addClass(this._viewport,_Constants._horizontalClass),_ElementUtilities.removeClass(this._viewport,_Constants._verticalClass),resetScrollPosition&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",_ElementUtilities.addClass(this._viewport,_Constants._verticalClass),_ElementUtilities.removeClass(this._viewport,_Constants._horizontalClass),resetScrollPosition&&_ElementUtilities.setScrollPosition(this._viewport,{scrollLeft:0}))},_resetLayout:function(){this._pendingLayoutReset=!1,this._affectedRange.addAll(),this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(layoutObject){var hadPreviousLayout=!1;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),hadPreviousLayout=!0);var layoutImpl;if(layoutObject&&"function"==typeof layoutObject.type){var LayoutCtor=requireSupportedForProcessing(layoutObject.type);layoutImpl=new LayoutCtor(layoutObject)}else layoutImpl=layoutObject&&layoutObject.initialize?layoutObject:new _Layouts.GridLayout(layoutObject);hadPreviousLayout&&this._resetCanvas(),this._layoutImpl=layoutImpl,this._layout=new _Layouts._LayoutWrapper(layoutImpl),hadPreviousLayout&&this._unsetFocusOnItem(),this._setFocusOnItem({type:_UI.ObjectType.item,index:0}),this._selection._setFocused({type:_UI.ObjectType.item,index:0}),this._lastFocusedElementInGroupTrack={type:_UI.ObjectType.item,index:-1},this._headerContainer.style.opacity=0,this._footerContainer.style.opacity=0,this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation(hadPreviousLayout),hadPreviousLayout&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setDraggable:function(){var dragEnabled=this.itemsDraggable||this.itemsReorderable;this._view.items.each(function(index,item,itemData){itemData.itemBox&&(itemData.itemBox.draggable=dragEnabled&&!_ElementUtilities.hasClass(item,_Constants._nonDraggableClass))})},_resizeViewport:function(){this._viewportWidth=_Constants._UNINITIALIZED,this._viewportHeight=_Constants._UNINITIALIZED},_onMSElementResize:function(){this._writeProfilerMark("_onMSElementResize,info"),Scheduler.schedule(function(){if(!this._isZombie()&&this._viewportWidth!==_Constants._UNINITIALIZED&&this._viewportHeight!==_Constants._UNINITIALIZED){var newWidth=this._element.offsetWidth,newHeight=this._element.offsetHeight;if(this._previousWidth!==newWidth||this._previousHeight!==newHeight){this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+newWidth+"x"+newHeight+"),info"),this._previousWidth=newWidth,this._previousHeight=newHeight,this._resizeViewport();var that=this;this._affectedRange.addAll(),this._batchViewUpdates(_Constants._ViewChange.relayout,_Constants._ScrollToPriority.low,function(){return{position:that.scrollPosition,direction:"right"}})}}},Scheduler.Priority.max,this,"WinJS.UI.ListView._onMSElementResize")},_onFocusIn:function(event){function moveFocusToItem(keyboardFocused){that._changeFocus(that._selection._getFocused(),!0,!1,!1,keyboardFocused)}this._hasKeyboardFocus=!0;var that=this;if(event.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?moveFocusToItem(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(event.target===this._element)moveFocusToItem();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);var items=this._view.items,entity={},element=this._getHeaderOrFooterFromElement(event.target),winItem=null;if(element?(entity.index=0,entity.type=element===this._header?_UI.ObjectType.header:_UI.ObjectType.footer,this._lastFocusedElementInGroupTrack=entity):(element=this._groups.headerFrom(event.target),element?(entity.type=_UI.ObjectType.groupHeader,entity.index=this._groups.index(element),this._lastFocusedElementInGroupTrack=entity):(entity.index=items.index(event.target),entity.type=_UI.ObjectType.item,element=items.itemBoxAt(entity.index),winItem=items.itemAt(entity.index))),entity.index!==_Constants._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(entity.type===_UI.ObjectType.groupHeader&&event.target===element||entity.type===_UI.ObjectType.item&&event.target.parentNode===element)&&this._drawFocusRectangle(element),this._tabManager.childFocus!==element&&this._tabManager.childFocus!==winItem&&(this._selection._setFocused(entity,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,entity.type===_UI.ObjectType.item&&(element=items.itemAt(entity.index)),this._tabManager.childFocus=element,that._updater))){var elementInfo=that._updater.elements[uniqueID(element)],focusIndex=entity.index;elementInfo&&elementInfo.newIndex&&(focusIndex=elementInfo.newIndex),that._updater.oldFocus={type:entity.type,index:focusIndex},that._updater.newFocus={type:entity.type,index:focusIndex}}}},_onFocusOut:function(event){if(!this._disposed){this._hasKeyboardFocus=!1,this._itemFocused=!1;var element=this._view.items.itemBoxFrom(event.target)||this._groups.headerFrom(event.target);element&&this._clearFocusRectangle(element)}},_onMSManipulationStateChanged:function(ev){function done(){that._manipulationEndSignal=null}var that=this;this._manipulationState=ev.currentState,that._writeProfilerMark("_onMSManipulationStateChanged state("+ev.currentState+"),info"),this._manipulationState===_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new _Signal,this._manipulationEndSignal.promise.done(done,done)),this._manipulationState===_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){if(!this._isZombie()){var currentScrollPosition=this._viewportScrollPosition;if(currentScrollPosition!==this._lastScrollPosition){this._pendingScroll=_BaseUtils._requestAnimationFrame(this._checkScroller.bind(this)),currentScrollPosition=Math.max(0,currentScrollPosition);var direction=this._scrollDirection(currentScrollPosition);this._lastScrollPosition=currentScrollPosition,this._raiseViewLoading(!0),this._raiseHeaderFooterVisibilityEvent();var that=this;this._view.onScroll(function(){return{position:that._lastScrollPosition,direction:direction}},this._manipulationEndSignal?this._manipulationEndSignal.promise:Promise.timeout(_Constants._DEFERRED_SCROLL_END))}else this._pendingScroll=null}},_scrollDirection:function(currentScrollPosition){var currentDirection=currentScrollPosition<this._lastScrollPosition?"left":"right";return currentDirection===this._lastDirection?currentDirection:this._direction},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(list){var that=this;list.forEach(function(record){var dirChanged=!1;if("dir"===record.attributeName?dirChanged=!0:"style"===record.attributeName&&(dirChanged=that._cachedStyleDir!==record.target.style.direction),dirChanged&&(that._cachedStyleDir=record.target.style.direction,that._cachedRTL=null,_ElementUtilities[that._rtl()?"addClass":"removeClass"](that._element,_Constants._rtlListViewClass),that._lastScrollPosition=0,that._viewportScrollPosition=0,that.forceLayout()),"tabIndex"===record.attributeName){var newTabIndex=that._element.tabIndex;newTabIndex>=0&&(that._view.items.each(function(index,item){item.tabIndex=newTabIndex}),that._header&&(that._header.tabIndex=newTabIndex),that._footer&&(that._footer.tabIndex=newTabIndex),that._tabIndex=newTabIndex,that._tabManager.tabIndex=newTabIndex,that._element.tabIndex=-1)}})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=_Layouts._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(coordinates,conversionCallback){function fix(field,offset){void 0!==coordinates[field]&&(coordinates[field]=conversionCallback(coordinates[field],offset))}var offset;return this._horizontal()?(offset=this._getCanvasMargins()[this._rtl()?"right":"left"],fix("left",offset)):(offset=this._getCanvasMargins().top,fix("top",offset)),fix("begin",offset),fix("end",offset),coordinates},_convertFromCanvasCoordinates:function(coordinates){return this._convertCoordinatesByCanvasMargins(coordinates,function(coordinate,canvasMargin){return coordinate+canvasMargin})},_convertToCanvasCoordinates:function(coordinates){return this._convertCoordinatesByCanvasMargins(coordinates,function(coordinate,canvasMargin){return coordinate-canvasMargin})},_getViewportSize:function(){return(this._viewportWidth===_Constants._UNINITIALIZED||this._viewportHeight===_Constants._UNINITIALIZED)&&(this._viewportWidth=Math.max(0,_ElementUtilities.getContentWidth(this._element)),this._viewportHeight=Math.max(0,_ElementUtilities.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function cleanUp(){that._itemsCountPromise=null}var that=this;if(this._cachedCount!==_Constants._UNINITIALIZED)return Promise.wrap(this._cachedCount);var retVal;return this._itemsCountPromise?retVal=this._itemsCountPromise:(retVal=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(count){return count===_UI.CountResult.unknown&&(count=0),that._cachedCount=count,that._selection._updateCount(that._cachedCount),count},function(){return Promise.cancel}),this._itemsCountPromise.then(cleanUp,cleanUp)),retVal},_isSelected:function(index){return this._selection._isIncluded(index)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(scrolling){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!scrolling),this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_raiseHeaderFooterVisibilityEvent:function(){var that=this,elementInViewport=function(element){if(!element)return!1;var scrollPosition=that._lastScrollPosition,elementPosition=element[that._horizontal()?"offsetLeft":"offsetTop"],elementLength=element[that._horizontal()?"offsetWidth":"offsetHeight"];return elementPosition+elementLength>scrollPosition&&elementPosition<scrollPosition+that._getViewportLength()},raiseVisibilityEvent=function(eventName,visible){var visibilityEvent=_Global.document.createEvent("CustomEvent");visibilityEvent.initCustomEvent(eventName,!0,!0,{visible:visible}),that._element.dispatchEvent(visibilityEvent)},headerInView=!!this._header&&elementInViewport(this._headerContainer),footerInView=!!this._footer&&elementInViewport(this._footerContainer);this._headerFooterVisibilityStatus.headerVisible!==headerInView&&(this._headerFooterVisibilityStatus.headerVisible=headerInView,raiseVisibilityEvent("headervisibilitychanged",headerInView)),this._headerFooterVisibilityStatus.footerVisible!==footerInView&&(this._headerFooterVisibilityStatus.footerVisible=footerInView,raiseVisibilityEvent("footervisibilitychanged",footerInView))},_setViewState:function(state){if(state!==this._loadingState){var detail={scrolling:!1};switch(state){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(scheduleForDispose(this),this._scheduledForDispose=!0),this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:detail={scrolling:this._scrolling},this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded),this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+state+",info"),this._loadingState=state;var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent("loadingstatechanged",!0,!1,detail),this._element.dispatchEvent(eventObject)}},_createTemplates:function(){function createNodeWithClass(className,skipAriaHidden){var element=_Global.document.createElement("div");return element.className=className,skipAriaHidden||element.setAttribute("aria-hidden",!0),element}this._itemBoxTemplate=createNodeWithClass(_Constants._itemBoxClass,!0)},_updateSelection:function(){var indices=this._selection.getIndices(),selectAll=this._selection.isEverything(),selectionMap={};if(!selectAll)for(var i=0,len=indices.length;len>i;i++){var index=indices[i];selectionMap[index]=!0}this._view.items.each(function(index,element,itemData){if(itemData.itemBox){var selected=selectAll||!!selectionMap[index];_ItemEventsHandler._ItemEventsHandler.renderSelection(itemData.itemBox,element,selected,!0),itemData.container&&_ElementUtilities[selected?"addClass":"removeClass"](itemData.container,_Constants._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(parent,x,y){var progressBar=this._progressBar,progressStyle=progressBar.style;if(!progressBar.parentNode){this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel();var that=this;this._progressIndicatorDelayTimer=Promise.timeout(_Constants._LISTVIEW_PROGRESS_DELAY).then(function(){that._isZombie()||(parent.appendChild(progressBar),Animations.fadeIn(progressBar),that._progressIndicatorDelayTimer=null)})}progressStyle[this._rtl()?"right":"left"]=x,progressStyle.top=y},_hideProgressBar:function(){this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);var progressBar=this._progressBar;if(progressBar.parentNode&&!this._fadingProgressBar){this._fadingProgressBar=!0;var that=this;Animations.fadeOut(progressBar).then(function(){progressBar.parentNode&&progressBar.parentNode.removeChild(progressBar),that._fadingProgressBar=!1})}},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(isZoomedOut,isCurrentView,triggerZoom){if(_BaseUtils.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new _ErrorFromName("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",strings.notCompatibleWithSemanticZoom);this._isZoomedOut=isZoomedOut,this._disableEntranceAnimation=!isCurrentView,this._isCurrentZoomView=isCurrentView,this._triggerZoom=triggerZoom},_setCurrentItem:function(x,y){this._rtl()&&(x=this._viewportWidth-x),this._horizontal()?x+=this.scrollPosition:y+=this.scrollPosition;var result=this._view.hitTest(x,y),entity={type:result.type?result.type:_UI.ObjectType.item,index:result.index};entity.index>=0&&(this._hasKeyboardFocus?this._changeFocus(entity,!0,!1,!0):this._changeFocusPassively(entity))},_getCurrentItem:function(){var focused=this._selection._getFocused();focused.type===_UI.ObjectType.groupHeader?focused={type:_UI.ObjectType.item,index:this._groups.group(focused.index).startIndex}:focused.type!==_UI.ObjectType.item&&(focused={type:_UI.ObjectType.item,index:focused.type===_UI.ObjectType.header?0:this._cachedCount}),"number"!=typeof focused.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),focused=this._selection._getFocused());var that=this,promisePosition=this._getItemOffsetPosition(focused.index).then(function(posCanvas){var scrollOffset=that._canvasStart;return posCanvas[that._startProperty]+=scrollOffset,posCanvas});return Promise.join({item:this._dataSource.itemFromIndex(focused.index),position:promisePosition})},_animateItemsForPhoneZoom:function(){function rowStaggerDelay(minRow,rows,delayBetweenRows){return function(index){return(rows[index]-minRow)*delayBetweenRows}}function clearTransform(){for(var i=0,len=containersOnScreen.length;len>i;i++)containersOnScreen[i].style[transformNames.scriptName]=""}for(var containersOnScreen=[],itemRows=[],promises=[],minRow=Number.MAX_VALUE,that=this,i=this._view.firstIndexDisplayed,len=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);len>i;i++)promises.push(this._view.waitForEntityPosition({type:_UI.ObjectType.item,index:i}).then(function(){containersOnScreen.push(that._view.items.containerAt(i));var itemRow=0;if(that.layout._getItemPosition){var itemPosition=that.layout._getItemPosition(i);itemPosition.row&&(itemRow=itemPosition.row)}itemRows.push(itemRow),minRow=Math.min(itemRow,minRow);
}));return Promise.join(promises).then(function(){return(0===containersOnScreen.length?Promise.wrap():_TransitionAnimation.executeTransition(containersOnScreen,{property:transformNames.cssName,delay:rowStaggerDelay(minRow,itemRows,30),duration:100,timing:"ease-in-out",from:that._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:that._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(clearTransform,clearTransform)}).then(clearTransform,clearTransform)},_beginZoom:function(){this._zooming=!0;var zoomPromise=null;if(_BaseUtils.isPhone){if(this._isZoomedOut)if(this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView){var that=this,animationComplete=function(){that._zoomAnimationPromise=null};this._zoomAnimationPromise=zoomPromise=this._animateItemsForPhoneZoom().then(animationComplete,animationComplete)}else this._zoomAnimationPromise=new _Signal,zoomPromise=this._zoomAnimationPromise.promise}else{var horizontal=this._horizontal(),scrollOffset=-this.scrollPosition;_ElementUtilities.addClass(this._viewport,horizontal?_Constants._zoomingXClass:_Constants._zoomingYClass),this._canvasStart=scrollOffset,_ElementUtilities.addClass(this._viewport,horizontal?_Constants._zoomingYClass:_Constants._zoomingXClass)}return zoomPromise},_positionItem:function(item,position){function positionItemAtIndex(index){return that._getItemOffsetPosition(index).then(function(posCanvas){var scrollPosition,horizontal=that._horizontal(),canvasSize=that._viewport[horizontal?"scrollWidth":"scrollHeight"],viewportSize=horizontal?that._viewportWidth:that._viewportHeight,headerSizeProp=horizontal?"headerContainerWidth":"headerContainerHeight",layoutSizes=that.layout._sizes,headerSize=0;layoutSizes&&layoutSizes[headerSizeProp]&&(headerSize=layoutSizes[headerSizeProp]);var start=_BaseUtils.isPhone?headerSize:position[that._startProperty],startMax=viewportSize-(horizontal?posCanvas.width:posCanvas.height);start=Math.max(0,Math.min(startMax,start)),scrollPosition=posCanvas[that._startProperty]-start;var adjustedScrollPosition=Math.max(0,Math.min(canvasSize-viewportSize,scrollPosition)),scrollAdjustment=adjustedScrollPosition-scrollPosition;scrollPosition=adjustedScrollPosition;var entity={type:_UI.ObjectType.item,index:index};if(that._hasKeyboardFocus?that._changeFocus(entity,!0):that._changeFocusPassively(entity),that._raiseViewLoading(!0),_BaseUtils.isPhone)that._viewportScrollPosition=scrollPosition;else{var scrollOffset=-scrollPosition;that._canvasStart=scrollOffset}if(that._view.realizePage(scrollPosition,!0),_BaseUtils.isPhone&&that._isZoomedOut){var animationComplete=function(){that._zoomAnimationPromise&&that._zoomAnimationPromise.complete&&that._zoomAnimationPromise.complete(),that._zoomAnimationPromise=null};that._animateItemsForPhoneZoom().then(animationComplete,animationComplete)}return horizontal?{x:scrollAdjustment,y:0}:{x:0,y:scrollAdjustment}})}var that=this,itemIndex=0;if(item&&(itemIndex=this._isZoomedOut?item.groupIndexHint:item.firstItemIndexHint),"number"==typeof itemIndex)return positionItemAtIndex(itemIndex);var itemPromise,key=this._isZoomedOut?item.groupKey:item.firstItemKey;if("string"==typeof key&&this._dataSource.itemFromKey)itemPromise=this._dataSource.itemFromKey(key,this._isZoomedOut?{groupMemberKey:item.key,groupMemberIndex:item.index}:null);else{var description=this._isZoomedOut?item.groupDescription:item.firstItemDescription;if(_BaseUtils.validation&&void 0===description)throw new _ErrorFromName("WinJS.UI.ListView.InvalidItem",strings.listViewInvalidItem);itemPromise=this._dataSource.itemFromDescription(description)}return itemPromise.then(function(item){return positionItemAtIndex(item.index)})},_endZoom:function(isCurrentView){if(!this._isZombie()){if(!_BaseUtils.isPhone){var scrollOffset=this._canvasStart;_ElementUtilities.removeClass(this._viewport,_Constants._zoomingYClass),_ElementUtilities.removeClass(this._viewport,_Constants._zoomingXClass),this._canvasStart=0,this._viewportScrollPosition=-scrollOffset}this._disableEntranceAnimation=!isCurrentView,this._isCurrentZoomView=isCurrentView,this._zooming=!1,this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(index){var that=this;return this._getItemOffset({type:_UI.ObjectType.item,index:index}).then(function(position){return that._ensureFirstColumnRange(_UI.ObjectType.item).then(function(){return position=that._correctRangeInFirstColumn(position,_UI.ObjectType.item),position=that._convertFromCanvasCoordinates(position),that._horizontal()?(position.left=position.begin,position.width=position.end-position.begin,position.height=position.totalHeight):(position.top=position.begin,position.height=position.end-position.begin,position.width=position.totalWidth),position})})},_groupRemoved:function(key){this._groupFocusCache.deleteGroup(key)},_updateFocusCache:function(itemIndex){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var that=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(itemIndex).then(function(){that._updateFocusCacheItemRequest=null;var itemData=that._view.items.itemDataAt(itemIndex),groupIndex=that._groups.groupFromItem(itemIndex),groupKey=that._groups.group(groupIndex).key;itemData.itemsManagerRecord.item&&that._groupFocusCache.updateCache(groupKey,itemData.itemsManagerRecord.item.key,itemIndex)})},_changeFocus:function(newFocus,skipSelection,ctrlKeyDown,skipEnsureVisible,keyboardFocused){if(!this._isZombie()){var targetItem;if(newFocus.type===_UI.ObjectType.item)targetItem=this._view.items.itemAt(newFocus.index),!skipSelection&&targetItem&&_ElementUtilities.hasClass(targetItem,_Constants._nonSelectableClass)&&(skipSelection=!0),this._updateFocusCache(newFocus.index);else if(newFocus.type===_UI.ObjectType.groupHeader){this._lastFocusedElementInGroupTrack=newFocus;var group=this._groups.group(newFocus.index);targetItem=group&&group.header}else this._lastFocusedElementInGroupTrack=newFocus,targetItem=newFocus.type===_UI.ObjectType.footer?this._footer:this._header;this._unsetFocusOnItem(!!targetItem),this._hasKeyboardFocus=!0,this._selection._setFocused(newFocus,keyboardFocused),skipEnsureVisible||this.ensureVisible(newFocus),!skipSelection&&this._selectFocused(ctrlKeyDown)&&this._selection.set(newFocus.index),this._setFocusOnItem(newFocus)}},_changeFocusPassively:function(newFocus){var targetItem;switch(newFocus.type){case _UI.ObjectType.item:targetItem=this._view.items.itemAt(newFocus.index),this._updateFocusCache(newFocus.index);break;case _UI.ObjectType.groupHeader:this._lastFocusedElementInGroupTrack=newFocus;var group=this._groups.group(newFocus.index);targetItem=group&&group.header;break;case _UI.ObjectType.header:this._lastFocusedElementInGroupTrack=newFocus,targetItem=this._header;break;case _UI.ObjectType.footer:this._lastFocusedElementInGroupTrack=newFocus,targetItem=this._footer}this._unsetFocusOnItem(!!targetItem),this._selection._setFocused(newFocus),this._setFocusOnItem(newFocus)},_drawFocusRectangle:function(item){if(item!==this._header&&item!==this._footer)if(_ElementUtilities.hasClass(item,_Constants._headerClass))_ElementUtilities.addClass(item,_Constants._itemFocusClass);else{var itemBox=this._view.items.itemBoxFrom(item);if(itemBox.querySelector("."+_Constants._itemFocusOutlineClass))return;_ElementUtilities.addClass(itemBox,_Constants._itemFocusClass);var outline=_Global.document.createElement("div");outline.className=_Constants._itemFocusOutlineClass,itemBox.appendChild(outline)}},_clearFocusRectangle:function(item){if(item&&!this._isZombie()&&item!==this._header&&item!==this._footer){var itemBox=this._view.items.itemBoxFrom(item);if(itemBox){_ElementUtilities.removeClass(itemBox,_Constants._itemFocusClass);var outline=itemBox.querySelector("."+_Constants._itemFocusOutlineClass);outline&&outline.parentNode.removeChild(outline)}else{var header=this._groups.headerFrom(item);header&&_ElementUtilities.removeClass(header,_Constants._itemFocusClass)}}},_defaultInvoke:function(entity){(this._isZoomedOut||_BaseUtils.isPhone&&this._triggerZoom&&entity.type===_UI.ObjectType.groupHeader)&&(this._changeFocusPassively(entity),this._triggerZoom())},_selectionAllowed:function(itemIndex){var item=void 0!==itemIndex?this.elementFromIndex(itemIndex):null,itemSelectable=!(item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass));return itemSelectable&&this._selectionMode!==_UI.SelectionMode.none},_multiSelection:function(){return this._selectionMode===_UI.SelectionMode.multi},_isInSelectionMode:function(){return this.tapBehavior===_UI.TapBehavior.toggleSelect&&this.selectionMode===_UI.SelectionMode.multi},_selectOnTap:function(){return this._tap===_UI.TapBehavior.toggleSelect||this._tap===_UI.TapBehavior.directSelect},_selectFocused:function(ctrlKeyDown){return this._tap===_UI.TapBehavior.directSelect&&this._selectionMode===_UI.SelectionMode.multi&&!ctrlKeyDown},_dispose:function(){if(!this._disposed){this._disposed=!0;var clear=function(e){e&&(e.textContent="")};_ElementUtilities._resizeNotifier.unsubscribe(this._element,this._onMSElementResizeBound),this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),clear(this._viewport),clear(this._canvas),clear(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null;var index=controlsToDispose.indexOf(this);index>=0&&controlsToDispose.splice(index,1)}},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&_Global.document.body.contains(this.element))},_ifZombieDispose:function(){var zombie=this._isZombie();return zombie&&!this._disposed&&scheduleForDispose(this),zombie},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight?!0:!_TransitionAnimation.isAnimationEnabled()},_fadeOutViewport:function(){var that=this;return new Promise(function(complete){if(that._animationsDisabled())return void complete();if(!that._fadingViewportOut){that._waitingEntranceAnimationPromise&&(that._waitingEntranceAnimationPromise.cancel(),that._waitingEntranceAnimationPromise=null);var eventDetails=that._fireAnimationEvent(ListViewAnimationType.contentTransition);that._firedAnimationEvent=!0,eventDetails.prevented?(that._disableEntranceAnimation=!0,that._viewport.style.opacity=1,complete()):(that._fadingViewportOut=!0,that._viewport.style.overflow="hidden",Animations.fadeOut(that._viewport).then(function(){that._isZombie()||(that._fadingViewportOut=!1,that._viewport.style.opacity=1,complete())}))}})},_animateListEntrance:function(firstTime){function resetViewOpacity(){that._canvas.style.opacity=1,that._headerContainer.style.opacity=1,that._footerContainer.style.opacity=1,that._viewport.style.overflow="",that._raiseHeaderFooterVisibilityEvent()}var eventDetails={prevented:!1,animationPromise:Promise.wrap()},that=this;return this._raiseHeaderFooterVisibilityEvent(),this._disableEntranceAnimation||this._animationsDisabled()?(resetViewOpacity(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),Promise.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:eventDetails=this._fireAnimationEvent(ListViewAnimationType.entrance),eventDetails.prevented||_BaseUtils.isPhone?(resetViewOpacity(),Promise.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,this._viewport.style.overflow="hidden",this._headerContainer.style.opacity=1,this._footerContainer.style.opacity=1,this._waitingEntranceAnimationPromise=eventDetails.animationPromise.then(function(){return that._isZombie()?void 0:(that._canvas.style.opacity=1,Animations.enterContent(that._viewport).then(function(){that._isZombie()||(that._waitingEntranceAnimationPromise=null,that._viewport.style.overflow="")}))}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(type){var animationEvent=_Global.document.createEvent("CustomEvent"),animationPromise=Promise.wrap();animationEvent.initCustomEvent("contentanimating",!0,!0,{type:type}),type===ListViewAnimationType.entrance&&(animationEvent.detail.setPromise=function(delayPromise){animationPromise=delayPromise});var prevented=!this._element.dispatchEvent(animationEvent);return{prevented:prevented,animationPromise:animationPromise}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",strings.listViewViewportAriaLabel),this._ariaStartMarker||(this._ariaStartMarker=_Global.document.createElement("div"),this._ariaStartMarker.id=uniqueID(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild)),this._ariaEndMarker||(this._ariaEndMarker=_Global.document.createElement("div"),this._ariaEndMarker.id=uniqueID(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var expectedListRole,expectedItemRole,that=this,listRole=this._element.getAttribute("role");this._currentMode().staticMode()?(expectedListRole="list",expectedItemRole="listitem"):(expectedListRole="listbox",expectedItemRole="option"),(listRole!==expectedListRole||this._itemRole!==expectedItemRole)&&(this._element.setAttribute("role",expectedListRole),this._itemRole=expectedItemRole,this._view.items.each(function(index,itemElement){itemElement.setAttribute("role",that._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var headerRole=this.groupHeaderTapBehavior===_UI.GroupHeaderTapBehavior.none?"separator":"link";if(this._headerRole!==headerRole){this._headerRole=headerRole;for(var i=0,len=this._groups.length();len>i;i++){var header=this._groups.group(i).header;header&&header.setAttribute("role",this._headerRole)}}},_setAriaSelected:function(itemElement,isSelected){var ariaSelected="true"===itemElement.getAttribute("aria-selected");isSelected!==ariaSelected&&itemElement.setAttribute("aria-selected",isSelected)},_setupAriaSelectionObserver:function(item){item._mutationObserver||(this._mutationObserver.observe(item,{attributes:!0,attributeFilter:["aria-selected"]}),item._mutationObserver=!0)},_itemPropertyChange:function(list){function revertAriaSelected(items){items.forEach(function(entry){entry.item.setAttribute("aria-selected",!entry.selected)})}if(!this._isZombie()){for(var that=this,singleSelection=that._selectionMode===_UI.SelectionMode.single,changedItems=[],unselectableItems=[],i=0,len=list.length;len>i;i++){var item=list[i].target,itemBox=that._view.items.itemBoxFrom(item),selected="true"===item.getAttribute("aria-selected");if(itemBox&&selected!==_ElementUtilities._isSelectionRendered(itemBox)){var index=that._view.items.index(itemBox),entry={index:index,item:item,selected:selected};(that._selectionAllowed(index)?changedItems:unselectableItems).push(entry)}}if(changedItems.length>0){var signal=new _Signal;that.selection._synchronize(signal).then(function(){var newSelection=that.selection._cloneSelection();return changedItems.forEach(function(entry){entry.selected?newSelection[singleSelection?"set":"add"](entry.index):newSelection.remove(entry.index)}),that.selection._set(newSelection)}).then(function(approved){that._isZombie()||approved||revertAriaSelected(changedItems),signal.complete()})}revertAriaSelected(unselectableItems)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(entity,preserveItemsBlocks){var that=this;return this._view.waitForEntityPosition(entity).then(function(){var container,alreadyCorrectedForCanvasMargins=that._zooming&&0!==that._canvasStart;switch(entity.type){case _UI.ObjectType.item:container=that._view.getContainer(entity.index);break;case _UI.ObjectType.groupHeader:container=that._view._getHeaderContainer(entity.index);break;case _UI.ObjectType.header:alreadyCorrectedForCanvasMargins=!0,container=that._headerContainer;break;case _UI.ObjectType.footer:alreadyCorrectedForCanvasMargins=!0,container=that._footerContainer}if(container){that._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info");var itemsBlockFrom,itemsBlockTo;that._view._expandedRange?(itemsBlockFrom=that._view._expandedRange.first.index,itemsBlockTo=that._view._expandedRange.last.index):preserveItemsBlocks=!1,entity.type===_UI.ObjectType.item?(preserveItemsBlocks=!!preserveItemsBlocks,preserveItemsBlocks&=that._view._ensureContainerInDOM(entity.index)):preserveItemsBlocks=!1;var margins=that._getItemMargins(entity.type),position={left:that._rtl()?getOffsetRight(container)-margins.right:container.offsetLeft-margins.left,top:container.offsetTop-margins.top,totalWidth:_ElementUtilities.getTotalWidth(container),totalHeight:_ElementUtilities.getTotalHeight(container),contentWidth:_ElementUtilities.getContentWidth(container),contentHeight:_ElementUtilities.getContentHeight(container)};return preserveItemsBlocks&&that._view._forceItemsBlocksInDOM(itemsBlockFrom,itemsBlockTo+1),alreadyCorrectedForCanvasMargins?position:that._convertToCanvasCoordinates(position)}return Promise.cancel})},_getItemOffset:function(entity,preserveItemsBlocks){var that=this;return this._getItemPosition(entity,preserveItemsBlocks).then(function(pos){var margins=that._getItemMargins(entity.type);if(that._horizontal()){var rtl=that._rtl();pos.begin=pos.left-margins[rtl?"left":"right"],pos.end=pos.left+pos.totalWidth+margins[rtl?"right":"left"]}else pos.begin=pos.top-margins.bottom,pos.end=pos.top+pos.totalHeight+margins.top;return pos})},_getItemMargins:function(type){type=type||_UI.ObjectType.item;var that=this,calculateMargins=function(className){var cleanup,item=that._canvas.querySelector("."+className);item||(item=_Global.document.createElement("div"),_ElementUtilities.addClass(item,className),that._viewport.appendChild(item),cleanup=!0);var margins=_Layouts._getMargins(item);return cleanup&&that._viewport.removeChild(item),margins};return type===_UI.ObjectType.item?this._itemMargins?this._itemMargins:this._itemMargins=calculateMargins(_Constants._containerClass):type===_UI.ObjectType.groupHeader?this._headerMargins?this._headerMargins:this._headerMargins=calculateMargins(_Constants._headerContainerClass):(this._headerFooterMargins||(this._headerFooterMargins={headerMargins:calculateMargins(_Constants._listHeaderContainerClass),footerMargins:calculateMargins(_Constants._listFooterContainerClass)}),this._headerFooterMargins[type===_UI.ObjectType.header?"headerMargins":"footerMargins"])},_fireAccessibilityAnnotationCompleteEvent:function(firstIndex,lastIndex,firstHeaderIndex,lastHeaderIndex){var detail={firstIndex:firstIndex,lastIndex:lastIndex,firstHeaderIndex:+firstHeaderIndex||-1,lastHeaderIndex:+lastHeaderIndex||-1},eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent("accessibilityannotationcomplete",!0,!1,detail),this._element.dispatchEvent(eventObject)},_ensureFirstColumnRange:function(type){if(type===_UI.ObjectType.header||type===_UI.ObjectType.footer)return Promise.wrap();var propName=type===_UI.ObjectType.item?"_firstItemRange":"_firstHeaderRange";if(this[propName])return Promise.wrap();var that=this;return this._getItemOffset({type:type,index:0},!0).then(function(firstRange){that[propName]=firstRange})},_correctRangeInFirstColumn:function(range,type){if(type===_UI.ObjectType.header||type===_UI.ObjectType.footer)return range;var firstRange=type===_UI.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return firstRange.begin===range.begin&&(this._horizontal()?range.begin=-this._getCanvasMargins()[this._rtl()?"right":"left"]:range.begin=-this._getCanvasMargins().top),range},_updateContainers:function(groups,count,containersDelta,modifiedElements){function createContainer(){var element=_Global.document.createElement("div");return element.className=_Constants._containerClass,element}function updateExistingGroupWithBlocks(groupNode,firstItem,newSize){firstItem+newSize>maxContainers&&(newSize=maxContainers-firstItem);var children,itemsContainer=groupNode.itemsContainer,blocks=itemsContainer.itemsBlocks,blockSize=that._view._blockSize,lastBlock=blocks.length?blocks[blocks.length-1]:null,indexOfNextGroupItem=blocks.length?(blocks.length-1)*blockSize+lastBlock.items.length:0,delta=newSize-indexOfNextGroupItem;if(delta>0){var sizeOfOldLastBlock,toAdd=delta;if(lastBlock&&lastBlock.items.length<blockSize){var emptySpotsToFill=Math.min(toAdd,blockSize-lastBlock.items.length);sizeOfOldLastBlock=lastBlock.items.length;var containersMarkup=_Helpers._stripedContainers(emptySpotsToFill,indexOfNextGroupItem);_SafeHtml.insertAdjacentHTMLUnsafe(lastBlock.element,"beforeend",containersMarkup),children=lastBlock.element.children;for(var j=0;emptySpotsToFill>j;j++)lastBlock.items.push(children[sizeOfOldLastBlock+j]);toAdd-=emptySpotsToFill}indexOfNextGroupItem=blocks.length*blockSize;var newBlocksCount=Math.floor(toAdd/blockSize),markup="",firstBlockFirstItemIndex=indexOfNextGroupItem,secondBlockFirstItemIndex=indexOfNextGroupItem+blockSize;if(newBlocksCount>0){var pairOfItemBlocks=["<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,firstBlockFirstItemIndex)+"</div>","<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,secondBlockFirstItemIndex)+"</div>"];markup=_Helpers._repeat(pairOfItemBlocks,newBlocksCount),indexOfNextGroupItem+=newBlocksCount*blockSize}var sizeOfNewLastBlock=toAdd%blockSize;sizeOfNewLastBlock>0&&(markup+="<div class='win-itemsblock'>"+_Helpers._stripedContainers(sizeOfNewLastBlock,indexOfNextGroupItem)+"</div>",indexOfNextGroupItem+=sizeOfNewLastBlock,newBlocksCount++);var blocksTemp=_Global.document.createElement("div");_SafeHtml.setInnerHTMLUnsafe(blocksTemp,markup);for(var children=blocksTemp.children,j=0;newBlocksCount>j;j++){var block=children[j],blockNode={element:block,items:_Helpers._nodeListToArray(block.children)};blocks.push(blockNode)}}else if(0>delta)for(var n=delta;0>n;n++){var container=lastBlock.items.pop();!that._view._requireFocusRestore&&container.contains(_Global.document.activeElement)&&(that._view._requireFocusRestore=_Global.document.activeElement,that._unsetFocusOnItem()),lastBlock.element.removeChild(container),removedContainers.push(container),lastBlock.items.length||(itemsContainer.element===lastBlock.element.parentNode&&itemsContainer.element.removeChild(lastBlock.element),blocks.pop(),lastBlock=blocks[blocks.length-1])}for(var j=0,len=blocks.length;len>j;j++)for(var block=blocks[j],n=0;n<block.items.length;n++)newContainers.push(block.items[n])}function addInserted(groupNode,firstItemIndex,newSize){for(var added=modifiedElements.filter(function(entry){return-1===entry.oldIndex&&entry.newIndex>=firstItemIndex&&entry.newIndex<firstItemIndex+newSize}).sort(function(left,right){return left.newIndex-right.newIndex}),itemsContainer=groupNode.itemsContainer,i=0,len=added.length;len>i;i++){var entry=added[i],offset=entry.newIndex-firstItemIndex,container=createContainer(),next=offset<itemsContainer.items.length?itemsContainer.items[offset]:null;itemsContainer.items.splice(offset,0,container),itemsContainer.element.insertBefore(container,next)}}function updateExistingGroup(groupNode,firstItem,newSize){firstItem+newSize>maxContainers&&(newSize=maxContainers-firstItem);var itemsContainer=groupNode.itemsContainer,delta=newSize-itemsContainer.items.length;if(delta>0){var children=itemsContainer.element.children,oldSize=children.length;_SafeHtml.insertAdjacentHTMLUnsafe(itemsContainer.element,"beforeend",_Helpers._repeat("<div class='win-container win-backdrop'></div>",delta));for(var n=0;delta>n;n++){var container=children[oldSize+n];itemsContainer.items.push(container)}}for(var n=delta;0>n;n++){var container=itemsContainer.items.pop();itemsContainer.element.removeChild(container),removedContainers.push(container)}for(var n=0,len=itemsContainer.items.length;len>n;n++)newContainers.push(itemsContainer.items[n])}function addNewGroup(groupInfo,firstItem){var header=that._view._createHeaderContainer(prevElement),groupNode={header:header,itemsContainer:{element:that._view._createItemsContainer(header)}};return groupNode.itemsContainer[that._view._blockSize?"itemsBlocks":"items"]=[],that._view._blockSize?updateExistingGroupWithBlocks(groupNode,firstItem,groupInfo.size):updateExistingGroup(groupNode,firstItem,groupInfo.size),groupNode}function shift(groupNode,oldFirstItemIndex,currentFirstItemIndex,newSize){for(var firstShifted,delta,currentLast=currentFirstItemIndex+newSize-1,i=0,len=modifiedElements.length;len>i;i++){var entry=modifiedElements[i];entry.newIndex>=currentFirstItemIndex&&entry.newIndex<=currentLast&&-1!==entry.oldIndex&&(firstShifted!==+firstShifted||entry.newIndex<firstShifted)&&(firstShifted=entry.newIndex,delta=entry.newIndex-entry.oldIndex)}if(firstShifted===+firstShifted){var addedBeforeShift=0;for(i=0,len=modifiedElements.length;len>i;i++){var entry=modifiedElements[i];entry.newIndex>=currentFirstItemIndex&&entry.newIndex<firstShifted&&-1===entry.oldIndex&&addedBeforeShift++}var removedBeforeShift=0,oldFirstShifted=firstShifted-delta;for(i=0,len=modifiedElements.length;len>i;i++){var entry=modifiedElements[i];entry.oldIndex>=oldFirstItemIndex&&entry.oldIndex<oldFirstShifted&&-1===entry.newIndex&&removedBeforeShift++}delta+=removedBeforeShift,delta-=addedBeforeShift,delta-=currentFirstItemIndex-oldFirstItemIndex;var itemsContainer=groupNode.itemsContainer;if(delta>0){var children=itemsContainer.element.children;_SafeHtml.insertAdjacentHTMLUnsafe(itemsContainer.element,"afterBegin",_Helpers._repeat("<div class='win-container win-backdrop'></div>",delta));for(var n=0;delta>n;n++){var container=children[n];itemsContainer.items.splice(n,0,container)}}for(var n=delta;0>n;n++){var container=itemsContainer.items.shift();itemsContainer.element.removeChild(container)}delta&&that._affectedRange.add({start:currentFirstItemIndex,end:currentFirstItemIndex+newSize},count)}}function flatIndexToGroupIndex(index){for(var firstItem=0,i=0,len=that._view.tree.length;len>i;i++){var group=that._view.tree[i],size=group.itemsContainer.items.length,lastItem=firstItem+size-1;if(index>=firstItem&&lastItem>=index)return{group:i,item:index-firstItem};firstItem+=size}}var maxContainers,that=this,containerCountAfterEdits=this._view.containers.length+containersDelta,asyncContainerCreationInProgress=count>containerCountAfterEdits;if(asyncContainerCreationInProgress){for(var countInsertedInRealizedRange=0,i=0;i<modifiedElements.length;i++)-1===modifiedElements[i].oldIndex&&countInsertedInRealizedRange++;maxContainers=this._view.containers.length+countInsertedInRealizedRange}else maxContainers=count;var newTree=[],newKeyToGroupIndex={},newContainers=[],removedContainers=[],oldFirstItem=[],firstItem=0;if(!that._view._blockSize)for(var i=0,len=this._view.tree.length;len>i;i++)oldFirstItem.push(firstItem),firstItem+=this._view.tree[i].itemsContainer.items.length;if(!that._view._blockSize)for(var removed=modifiedElements.filter(function(entry){return-1===entry.newIndex&&!entry._removalHandled}).sort(function(left,right){return right.oldIndex-left.oldIndex}),i=0,len=removed.length;len>i;i++){var entry=removed[i];entry._removalHandled=!0;var itemBox=entry._itemBox;entry._itemBox=null;var groupIndex=flatIndexToGroupIndex(entry.oldIndex),group=this._view.tree[groupIndex.group],container=group.itemsContainer.items[groupIndex.item];container.parentNode.removeChild(container),_ElementUtilities.hasClass(itemBox,_Constants._selectedClass)&&_ElementUtilities.addClass(container,_Constants._selectedClass),group.itemsContainer.items.splice(groupIndex.item,1),entry.element=container}this._view._modifiedGroups=[];var prevElement=this._canvasProxy;firstItem=0;for(var i=0,len=groups.length;len>i&&(!this._groupsEnabled()||maxContainers>firstItem);i++){var groupInfo=groups[i],existingGroupIndex=this._view.keyToGroupIndex[groupInfo.key],existingGroup=this._view.tree[existingGroupIndex];if(existingGroup)that._view._blockSize?updateExistingGroupWithBlocks(existingGroup,firstItem,groupInfo.size):(shift(existingGroup,oldFirstItem[existingGroupIndex],firstItem,groupInfo.size),addInserted(existingGroup,firstItem,groupInfo.size),updateExistingGroup(existingGroup,firstItem,groupInfo.size)),newTree.push(existingGroup),newKeyToGroupIndex[groupInfo.key]=newTree.length-1,delete this._view.keyToGroupIndex[groupInfo.key],prevElement=existingGroup.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:existingGroupIndex,newIndex:newTree.length-1,element:existingGroup.header});else{var newGroup=addNewGroup(groupInfo,firstItem);newTree.push(newGroup),newKeyToGroupIndex[groupInfo.key]=newTree.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:newTree.length-1,element:newGroup.header}),prevElement=newGroup.itemsContainer.element}firstItem+=groupInfo.size}for(var removedItemsContainers=[],removedHeaders=[],removedGroups=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],i=0,len=removedGroups.length;len>i;i++){var groupIndex=this._view.keyToGroupIndex[removedGroups[i]],groupNode=this._view.tree[groupIndex];if(removedHeaders.push(groupNode.header),removedItemsContainers.push(groupNode.itemsContainer.element),this._view._blockSize)for(var b=0;b<groupNode.itemsContainer.itemsBlocks.length;b++)for(var block=groupNode.itemsContainer.itemsBlocks[b],n=0;n<block.items.length;n++)removedContainers.push(block.items[n]);else for(var n=0;n<groupNode.itemsContainer.items.length;n++)removedContainers.push(groupNode.itemsContainer.items[n]);this._view._modifiedGroups.push({oldIndex:groupIndex,newIndex:-1,element:groupNode.header})}for(var i=0,len=modifiedElements.length;len>i;i++)if(-1===modifiedElements[i].newIndex&&!modifiedElements[i]._removalHandled){modifiedElements[i]._removalHandled=!0;var itemBox=modifiedElements[i]._itemBox;modifiedElements[i]._itemBox=null;var container;removedContainers.length?(container=removedContainers.pop(),_ElementUtilities.empty(container)):container=createContainer(),_ElementUtilities.hasClass(itemBox,_Constants._selectedClass)&&_ElementUtilities.addClass(container,_Constants._selectedClass),modifiedElements._containerStripe===_Constants._containerEvenClass?(_ElementUtilities.addClass(container,_Constants._containerEvenClass),_ElementUtilities.removeClass(container,_Constants._containerOddClass)):(_ElementUtilities.addClass(container,_Constants._containerOddClass),_ElementUtilities.removeClass(container,_Constants._containerEvenClass)),container.appendChild(itemBox),modifiedElements[i].element=container}return this._view.tree=newTree,this._view.keyToGroupIndex=newKeyToGroupIndex,this._view.containers=newContainers,{removedHeaders:removedHeaders,removedItemsContainers:removedItemsContainers}},_writeProfilerMark:function(text){var message="WinJS.UI.ListView:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"listviewprofiler")}},{triggerDispose:function(){disposeControls()}});return _Base.Class.mix(ListView,_Events.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","headervisibilitychanged","footervisibilitychanged","accessibilityannotationcomplete")),_Base.Class.mix(ListView,_Control.DOMEventMixin),
ListView})})}),define("WinJS/Controls/FlipView/_Constants",[],function(){"use strict";var members={};return members.datasourceCountChangedEvent="datasourcecountchanged",members.pageVisibilityChangedEvent="pagevisibilitychanged",members.pageSelectedEvent="pageselected",members.pageCompletedEvent="pagecompleted",members}),define("WinJS/Controls/FlipView/_PageManager",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_TabContainer","./_Constants"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Log,_Resources,_WriteProfilerMark,Animations,Promise,_Signal,Scheduler,_Dispose,_ElementUtilities,_TabContainer,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_FlipPageManager:_Base.Namespace._lazy(function(){function isFlipper(element){var control=element.winControl;return control&&control._isFlipView?!0:!1}function flipperPropertyChanged(list){list.forEach(function(record){var element=record.target;element.winControl&&element.tabIndex>=0&&(element.winControl._pageManager._updateTabIndex(element.tabIndex),element.tabIndex=-1);var that=element.winControl;if(that&&that._isFlipView){var dirChanged=!1;"dir"===record.attributeName?dirChanged=!0:"style"===record.attributeName&&(dirChanged=that._cachedStyleDir!==element.style.direction),dirChanged&&(that._cachedStyleDir=element.style.direction,that._pageManager._rtl="rtl"===_ElementUtilities._getComputedStyle(that._pageManager._flipperDiv,null).direction,that._pageManager.resized())}})}var uniqueID=_ElementUtilities._uniqueID,styleEquivalents=_BaseUtils._browserStyleEquivalents,leftBufferAmount=50,itemSelectedEventDelay=250,strings={get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"}},_FlipPageManager=_Base.Class.define(function(flipperDiv,panningDiv,panningDivContainer,itemsManager,itemSpacing,environmentSupportsTouch,buttonVisibilityHandler){this._visibleElements=[],this._flipperDiv=flipperDiv,this._panningDiv=panningDiv,this._panningDivContainer=panningDivContainer,this._buttonVisibilityHandler=buttonVisibilityHandler,this._currentPage=null,this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._flipperDiv,null).direction,this._itemsManager=itemsManager,this._itemSpacing=itemSpacing,this._tabIndex=_ElementUtilities.getTabIndex(flipperDiv),this._tabIndex<0&&(this._tabIndex=0),panningDiv.tabIndex=-1,flipperDiv.tabIndex=-1,this._tabManager=new _TabContainer.TabContainer(this._panningDivContainer),this._tabManager.tabIndex=this._tabIndex,this._lastSelectedPage=null,this._lastSelectedElement=null,this._bufferSize=_FlipPageManager.flipPageBufferCount,this._cachedSize=-1,this._environmentSupportsTouch=environmentSupportsTouch;var that=this;this._panningDiv.addEventListener("keydown",function(event){that._blockTabs&&event.keyCode===_ElementUtilities.Key.tab&&(event.stopImmediatePropagation(),event.preventDefault())},!0),_ElementUtilities._addEventListener(this._flipperDiv,"focusin",function(event){event.target===that._flipperDiv&&that._currentPage.element&&_ElementUtilities._setActive(that._currentPage.element)},!1),new _ElementUtilities._MutationObserver(flipperPropertyChanged).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]}),this._cachedStyleDir=this._flipperDiv.style.direction,this._handleManipulationStateChangedBound=this._handleManipulationStateChanged.bind(this),this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(_BaseUtils._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0)},{initialize:function(initialIndex,isHorizontal){var currPage=null;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._isHorizontal=isHorizontal,!this._currentPage){this._bufferAriaStartMarker=_Global.document.createElement("div"),this._bufferAriaStartMarker.id=uniqueID(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),currPage=this._currentPage,this._panningDiv.appendChild(currPage.pageRoot);for(var pagesToInit=2*this._bufferSize,i=0;pagesToInit>i;i++)currPage=this._createFlipPage(currPage,this),this._panningDiv.appendChild(currPage.pageRoot);this._bufferAriaEndMarker=_Global.document.createElement("div"),this._bufferAriaEndMarker.id=uniqueID(this._bufferAriaEndMarker),this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev,this._itemsManager&&this.setNewItemsManager(this._itemsManager,initialIndex)},dispose:function(){var curPage=this._currentPage,tmpPage=curPage;do _Dispose._disposeElement(tmpPage.element),tmpPage=tmpPage.next;while(tmpPage!==curPage)},setOrientation:function(isHorizontal){if(this._notificationsEndedSignal){var that=this;return void this._notificationsEndedSignal.promise.done(function(){that._notificationsEndedSignal=null,that.setOrientation(isHorizontal)})}if(isHorizontal!==this._isHorizontal){this._isOrientationChanging=!0,this._isHorizontal?_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollLeft:this._getItemStart(this._currentPage),scrollTop:0}):_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollLeft:0,scrollTop:this._getItemStart(this._currentPage)}),this._isHorizontal=isHorizontal;var containerStyle=this._panningDivContainer.style;containerStyle.overflowX="hidden",containerStyle.overflowY="hidden";var that=this;_BaseUtils._requestAnimationFrame(function(){that._isOrientationChanging=!1,that._forEachPage(function(curr){var currStyle=curr.pageRoot.style;currStyle.left="0px",currStyle.top="0px"}),containerStyle.overflowX=that._isHorizontal&&that._environmentSupportsTouch?"scroll":"hidden",containerStyle.overflowY=that._isHorizontal||!that._environmentSupportsTouch?"hidden":"scroll",that._ensureCentered()})}},resetState:function(initialIndex){if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==initialIndex){var indexValid=this.jumpToIndex(initialIndex,!0);if(!indexValid&&_BaseUtils.validation)throw new _ErrorFromName("WinJS.UI.FlipView.BadCurrentPage",strings.badCurrentPage);return indexValid}_Dispose.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0);var that=this,work=Promise.wrap(!0);return this._itemsManager&&(work=that._itemsManager._firstItem().then(function(e){return that._currentPage.setElement(e),that._fetchPreviousItems(!0).then(function(){return that._fetchNextItems()}).then(function(){that._setButtonStates()})})),work.then(function(){that._tabManager.childFocus=that._currentPage.element,that._ensureCentered(),that._itemSettledOn()})},setNewItemsManager:function(manager,initialIndex){this._itemsManager=manager;var that=this;return this.resetState(initialIndex).then(function(){0!==initialIndex&&(that._tabManager.childFocus=that._currentPage.element,that._ensureCentered(),that._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var index=0,element=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return element&&(index=this._getElementIndex(element)),index},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._hasFocus&&(this._hadFocus=!0),this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var newPos=this._getViewportStart(),bufferEnd=this._lastScrollPos>newPos?this._getTailOfBuffer():this._getHeadOfBuffer();if(newPos!==this._lastScrollPos){for(;this._currentPage.element&&this._getItemStart(this._currentPage)>newPos&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(bufferEnd.prev),bufferEnd=bufferEnd.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=newPos&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(bufferEnd.next),bufferEnd=bufferEnd.next;this._setButtonStates(),this._checkElementVisibility(!1),this._blockTabs=!0,this._lastScrollPos=newPos,this._currentPage.element&&(this._tabManager.childFocus=this._currentPage.element),this._setListEnds(),!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(real,placeholder){var that=this;if(this._forEachPage(function(curr){return curr.element===placeholder?(curr===that._currentPage||curr===that._currentPage.next?that._changeFlipPage(curr,placeholder,real):curr.setElement(real,!0),!0):void 0}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var animatingElements=this._navigationAnimationRecord.elementContainers,i=0,len=animatingElements.length;len>i;i++)animatingElements[i].element===placeholder&&(that._changeFlipPage(animatingElements[i],placeholder,real),animatingElements[i].element=real);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var that=this;this._forEachPage(function(curr){curr.pageRoot.style.width=that._panningDivContainerOffsetWidth+"px",curr.pageRoot.style.height=that._panningDivContainerOffsetHeight+"px"}),this._ensureCentered(),this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(index,forceJump){if(!forceJump){if(!this._itemsManager||!this._currentPage.element||0>index)return Promise.wrap(!1);var currIndex=this._getElementIndex(this._currentPage.element),distance=Math.abs(index-currIndex);if(0===distance)return Promise.wrap(!1)}var tail=Promise.wrap(!0),that=this;return tail=tail.then(function(){var itemPromise=that._itemsManager._itemPromiseAtIndex(index);return Promise.join({element:that._itemsManager._itemFromItemPromise(itemPromise),item:itemPromise}).then(function(v){var elementAtIndex=v.element;return that._resetBuffer(elementAtIndex,forceJump),elementAtIndex?(that._currentPage.setElement(elementAtIndex),that._fetchNextItems().then(function(){return that._fetchPreviousItems(!0)}).then(function(){return!0})):!1})}),tail=tail.then(function(v){return that._setButtonStates(),v})},startAnimatedNavigation:function(goForward,cancelAnimationCallback,completionCallback){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element){var outgoingPage=this._currentPage,incomingPage=goForward?this._currentPage.next:this._currentPage.prev;if(incomingPage.element){this._hasFocus&&_ElementUtilities._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=goForward,this._navigationAnimationRecord.cancelAnimationCallback=cancelAnimationCallback,this._navigationAnimationRecord.completionCallback=completionCallback,this._navigationAnimationRecord.oldCurrentPage=outgoingPage,this._navigationAnimationRecord.newCurrentPage=incomingPage;var outgoingElement=outgoingPage.element,incomingElement=incomingPage.element;this._navigationAnimationRecord.newCurrentElement=incomingElement,outgoingPage.setElement(null,!0),outgoingPage.elementUniqueID=uniqueID(outgoingElement),incomingPage.setElement(null,!0),incomingPage.elementUniqueID=uniqueID(incomingElement);var outgoingFlipPage=this._createDiscardablePage(outgoingElement),incomingFlipPage=this._createDiscardablePage(incomingElement);return outgoingFlipPage.pageRoot.itemIndex=this._getElementIndex(outgoingElement),incomingFlipPage.pageRoot.itemIndex=outgoingFlipPage.pageRoot.itemIndex+(goForward?1:-1),outgoingFlipPage.pageRoot.style.position="absolute",incomingFlipPage.pageRoot.style.position="absolute",outgoingFlipPage.pageRoot.style.zIndex=1,incomingFlipPage.pageRoot.style.zIndex=2,this._setItemStart(outgoingFlipPage,0),this._setItemStart(incomingFlipPage,0),this._blockTabs=!0,this._visibleElements.push(incomingElement),this._announceElementVisible(incomingElement),this._navigationAnimationRecord.elementContainers=[outgoingFlipPage,incomingFlipPage],{outgoing:outgoingFlipPage,incoming:incomingFlipPage}}}return null},endAnimatedNavigation:function(goForward,outgoing,incoming){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var outgoingRemoved=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,outgoing);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,incoming),outgoingRemoved||this._setViewportStart(this._getItemStart(goForward?this._currentPage.next:this._currentPage.prev)),this._navigationAnimationRecord=null,this._itemSettledOn()}},startAnimatedJump:function(index,cancelAnimationCallback,completionCallback){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._hasFocus&&(this._hadFocus=!0),this._currentPage.element){var oldElement=this._currentPage.element,oldIndex=this._getElementIndex(oldElement),that=this;return that.jumpToIndex(index).then(function(v){if(!v)return null;if(that._navigationAnimationRecord={},that._navigationAnimationRecord.cancelAnimationCallback=cancelAnimationCallback,that._navigationAnimationRecord.completionCallback=completionCallback,that._navigationAnimationRecord.oldCurrentPage=null,that._forEachPage(function(curr){return curr.element===oldElement?(that._navigationAnimationRecord.oldCurrentPage=curr,!0):void 0}),that._navigationAnimationRecord.newCurrentPage=that._currentPage,that._navigationAnimationRecord.newCurrentPage===that._navigationAnimationRecord.oldCurrentPage)return null;var newElement=that._currentPage.element;that._navigationAnimationRecord.newCurrentElement=newElement,that._currentPage.setElement(null,!0),that._currentPage.elementUniqueID=uniqueID(newElement),that._navigationAnimationRecord.oldCurrentPage&&that._navigationAnimationRecord.oldCurrentPage.setElement(null,!0);var oldFlipPage=that._createDiscardablePage(oldElement),newFlipPage=that._createDiscardablePage(newElement);return oldFlipPage.pageRoot.itemIndex=oldIndex,newFlipPage.pageRoot.itemIndex=index,oldFlipPage.pageRoot.style.position="absolute",newFlipPage.pageRoot.style.position="absolute",oldFlipPage.pageRoot.style.zIndex=1,newFlipPage.pageRoot.style.zIndex=2,that._setItemStart(oldFlipPage,0),that._setItemStart(newFlipPage,that._itemSize(that._currentPage)),that._visibleElements.push(newElement),that._announceElementVisible(newElement),that._navigationAnimationRecord.elementContainers=[oldFlipPage,newFlipPage],that._blockTabs=!0,{oldPage:oldFlipPage,newPage:newFlipPage}})}return Promise.wrap(null)},simulateMouseWheelScroll:function(ev){if(!this._environmentSupportsTouch&&!this._waitingForMouseScroll){var wheelingForward;wheelingForward="number"==typeof ev.deltaY?(ev.deltaX||ev.deltaY)>0:ev.wheelDelta<0;var targetPage=wheelingForward?this._currentPage.next:this._currentPage.prev;if(targetPage.element){var zoomToContent={contentX:0,contentY:0,viewportX:0,viewportY:0};zoomToContent[this._isHorizontal?"contentX":"contentY"]=this._getItemStart(targetPage),_ElementUtilities._zoomTo(this._panningDivContainer,zoomToContent),this._waitingForMouseScroll=!0,_Global.setTimeout(function(){this._waitingForMouseScroll=!1}.bind(this),_ElementUtilities._zoomToDuration+100)}}},endAnimatedJump:function(oldCurr,newCurr){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info"),this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(oldCurr.element,!0):oldCurr.element.parentNode&&oldCurr.element.parentNode.removeChild(oldCurr.element),this._navigationAnimationRecord.newCurrentPage.setElement(newCurr.element,!0),this._navigationAnimationRecord=null,this._ensureCentered(),this._itemSettledOn()},inserted:function(element,prev,next,animateInsertion){this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var curr=this._prevMarker,passedCurrent=!1,elementSuccessfullyPlaced=!1;if(animateInsertion&&(this._createAnimationRecord(uniqueID(element),null),this._getAnimationRecord(element).inserted=!0),prev){do{if(curr===this._currentPage&&(passedCurrent=!0),curr.elementUniqueID===uniqueID(prev)){elementSuccessfullyPlaced=!0;var temp,pageShifted=curr,lastElementMoved=element,lastElementMovedUniqueID=uniqueID(element);if(passedCurrent)for(;pageShifted.next!==this._prevMarker;)temp=pageShifted.next.element,lastElementMovedUniqueID=pageShifted.next.elementUniqueID,pageShifted.next.setElement(lastElementMoved,!0),!lastElementMoved&&lastElementMovedUniqueID&&(pageShifted.next.elementUniqueID=lastElementMovedUniqueID),lastElementMoved=temp,pageShifted=pageShifted.next;else for(curr.elementUniqueID===curr.next.elementUniqueID&&curr.elementUniqueID&&(pageShifted=curr.next);pageShifted.next!==this._prevMarker;)temp=pageShifted.element,lastElementMovedUniqueID=pageShifted.elementUniqueID,pageShifted.setElement(lastElementMoved,!0),!lastElementMoved&&lastElementMovedUniqueID&&(pageShifted.elementUniqueID=lastElementMovedUniqueID),lastElementMoved=temp,pageShifted=pageShifted.prev;if(lastElementMoved){var reused=!1;this._forEachPage(function(curr){return uniqueID(lastElementMoved)===curr.elementUniqueID?(reused=!0,!0):void 0}),reused||this._releaseElementIfNotAnimated(lastElementMoved)}break}curr=curr.next}while(curr!==this._prevMarker)}else if(next){for(;curr.next!==this._prevMarker&&curr.elementUniqueID!==uniqueID(next);)curr===this._currentPage&&(passedCurrent=!0),curr=curr.next;curr.elementUniqueID===uniqueID(next)&&curr!==this._prevMarker?(curr.prev.setElement(element),elementSuccessfullyPlaced=!0):this._releaseElementIfNotAnimated(element)}else this._currentPage.setElement(element);this._getAnimationRecord(element).successfullyMoved=elementSuccessfullyPlaced,this._setButtonStates()},changed:function(newVal,element){this._writeProfilerMark("WinJS.UI.FlipView:changed,info");var that=this;if(this._forEachPage(function(curr){if(curr.elementUniqueID===uniqueID(element)){var record=that._animationRecords[curr.elementUniqueID];return record.changed=!0,record.oldElement=element,record.newElement=newVal,curr.element=newVal,curr.elementUniqueID=uniqueID(newVal),that._animationRecords[uniqueID(newVal)]=record,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(var i=0,len=this._navigationAnimationRecord.elementContainers.length;len>i;i++){var page=this._navigationAnimationRecord.elementContainers[i];page&&page.elementUniqueID===uniqueID(element)&&(page.element=newVal,page.elementUniqueID=uniqueID(newVal))}var newElement=this._navigationAnimationRecord.newCurrentElement;newElement&&uniqueID(newElement)===uniqueID(element)&&(this._navigationAnimationRecord.newCurrentElement=newVal)}},moved:function(element,prev,next){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var record=this._getAnimationRecord(element);record||(record=this._createAnimationRecord(uniqueID(element))),record.moved=!0,this.removed(element,!1,!1),prev||next?this.inserted(element,prev,next,!1):record.successfullyMoved=!1},removed:function(element,mirage,animateRemoval){this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var that=this,prevMarker=this._prevMarker,work=Promise.wrap();if(mirage){var clearNext=!1;return this._forEachPage(function(curr){(curr.elementUniqueID===uniqueID(element)||clearNext)&&(curr.setElement(null,!0),clearNext=!0)}),void this._setButtonStates()}if(animateRemoval){var record=this._getAnimationRecord(element);record&&(record.removed=!0)}if(this._currentPage.elementUniqueID===uniqueID(element))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(prevMarker.elementUniqueID===uniqueID(element))prevMarker.next.element?work=this._itemsManager._previousItem(prevMarker.next.element).then(function(e){return e===element&&(e=that._itemsManager._previousItem(e)),e}).then(function(e){prevMarker.setElement(e,!0)}):prevMarker.setElement(null,!0);else if(prevMarker.prev.elementUniqueID===uniqueID(element))prevMarker.prev.prev&&prevMarker.prev.prev.element?work=this._itemsManager._nextItem(prevMarker.prev.prev.element).then(function(e){return e===element&&(e=that._itemsManager._nextItem(e)),e}).then(function(e){prevMarker.prev.setElement(e,!0)}):prevMarker.prev.setElement(null,!0);else{for(var curr=this._currentPage.prev,handled=!1;curr!==prevMarker&&!handled;)curr.elementUniqueID===uniqueID(element)&&(this._shiftRight(curr),handled=!0),curr=curr.prev;for(curr=this._currentPage.next;curr!==prevMarker&&!handled;)curr.elementUniqueID===uniqueID(element)&&(this._shiftLeft(curr),handled=!0),curr=curr.next}return work.then(function(){that._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info"),this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(space){this._itemSpacing=space,this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM"),this._logBuffer(),this._notificationsStarted=this._notificationsStarted||0,this._notificationsStarted++,this._notificationsEndedSignal=new _Signal,this._temporaryKeys=[],this._animationRecords={};var that=this;this._forEachPage(function(curr){that._createAnimationRecord(curr.elementUniqueID,curr)}),this._animationRecords.currentPage=this._currentPage.element,this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var that=this;this._endNotificationsWork&&this._endNotificationsWork.cancel(),this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function flipPageFromElement(element){var flipPage=null;return that._forEachPage(function(curr){return curr.element===element?(flipPage=curr,!0):void 0}),flipPage}function animateOldViewportItemRemoved(record,item){that._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var removedPage=that._createDiscardablePage(item);that._setItemStart(removedPage,record.originalLocation),animationPromises.push(that._deleteFlipPage(removedPage))}function animateOldViewportItemMoved(record,item){that._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");var movedPage,newLocation=record.originalLocation;if(record.successfullyMoved)movedPage=flipPageFromElement(item),newLocation=record.newLocation;else{movedPage=that._createDiscardablePage(item);var indexMovedTo=that._getElementIndex(item),newCurrentIndex=that._currentPage.element?that._getElementIndex(that._currentPage.element):0;newLocation+=newCurrentIndex>indexMovedTo?-100*that._bufferSize:100*that._bufferSize}movedPage&&(that._setItemStart(movedPage,record.originalLocation),animationPromises.push(that._moveFlipPage(movedPage,function(){that._setItemStart(movedPage,newLocation)})))}function joinAnimationPromises(){return 0===animationPromises.length&&animationPromises.push(Promise.wrap()),Promise.join(animationPromises)}var animationPromises=[];that._forEachPage(function(curr){var record=that._getAnimationRecord(curr.element);record&&(record.changed&&(record.oldElement.removedFromChange=!0,animationPromises.push(that._changeFlipPage(curr,record.oldElement,record.newElement))),record.newLocation=curr.location,that._setItemStart(curr,record.originalLocation),record.inserted&&(curr.elementRoot.style.opacity=0))});var oldCurrent=that._animationRecords.currentPage,oldCurrentRecord=that._getAnimationRecord(oldCurrent),oldNext=that._animationRecords.nextPage,oldNextRecord=that._getAnimationRecord(oldNext);oldCurrentRecord&&oldCurrentRecord.changed&&(oldCurrent=oldCurrentRecord.newElement),oldNextRecord&&oldNextRecord.changed&&(oldNext=oldNextRecord.newElement),(oldCurrent!==that._currentPage.element||oldNext!==that._currentPage.next.element)&&(oldCurrentRecord&&oldCurrentRecord.removed&&animateOldViewportItemRemoved(oldCurrentRecord,oldCurrent),oldNextRecord&&oldNextRecord.removed&&animateOldViewportItemRemoved(oldNextRecord,oldNext)),that._blockTabs=!0,joinAnimationPromises().then(function(){animationPromises=[],oldCurrentRecord&&oldCurrentRecord.moved&&animateOldViewportItemMoved(oldCurrentRecord,oldCurrent),oldNextRecord&&oldNextRecord.moved&&animateOldViewportItemMoved(oldNextRecord,oldNext);var newCurrRecord=that._getAnimationRecord(that._currentPage.element),newNextRecord=that._getAnimationRecord(that._currentPage.next.element);that._forEachPage(function(curr){var record=that._getAnimationRecord(curr.element);record&&(record.inserted?record!==newCurrRecord&&record!==newNextRecord&&(curr.elementRoot.style.opacity=1):record.originalLocation!==record.newLocation&&(record!==oldCurrentRecord&&record!==oldNextRecord||record===oldCurrentRecord&&!oldCurrentRecord.moved||record===oldNextRecord&&!oldNextRecord.moved)&&animationPromises.push(that._moveFlipPage(curr,function(){that._setItemStart(curr,record.newLocation)})))}),joinAnimationPromises().then(function(){animationPromises=[],newCurrRecord&&newCurrRecord.inserted&&animationPromises.push(that._insertFlipPage(that._currentPage)),newNextRecord&&newNextRecord.inserted&&animationPromises.push(that._insertFlipPage(that._currentPage.next)),joinAnimationPromises().then(function(){that._checkElementVisibility(!1),that._itemSettledOn(),that._setListEnds(),that._notificationsStarted--,0===that._notificationsStarted&&that._notificationsEndedSignal.complete(),that._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM"),that._logBuffer(),that._endNotificationsWork=null})})})})},disableTouchFeatures:function(){this._environmentSupportsTouch=!1;var panningContainerStyle=this._panningDivContainer.style;this._panningDivContainer.removeEventListener(_BaseUtils._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0),panningContainerStyle.overflowX="hidden",panningContainerStyle.overflowY="hidden";var panningContainerPropertiesToClear=["scroll-snap-type","scroll-snap-points-x","scroll-snap-points-y","scroll-limit-x-min","scroll-limit-x-max","scroll-limit-y-min","scroll-limit-y-max"];panningContainerPropertiesToClear.forEach(function(propertyName){var platformPropertyName=styleEquivalents[propertyName];platformPropertyName&&(panningContainerStyle[platformPropertyName.scriptName]="")})},_hasFocus:{get:function(){return this._flipperDiv.contains(_Global.document.activeElement)}},_timeoutPageSelection:function(){var that=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=Promise.timeout(itemSelectedEventDelay).then(function(){that._itemSettledOn()})},_updateTabIndex:function(newIndex){this._forEachPage(function(curr){curr.element&&(curr.element.tabIndex=newIndex)}),this._tabIndex=newIndex,this._tabManager.tabIndex=newIndex},_releaseElementIfNotAnimated:function(element){var animatedRecord=this._getAnimationRecord(element);animatedRecord&&(animatedRecord.changed||animatedRecord.inserted||animatedRecord.moved||animatedRecord.removed)||this._itemsManager.releaseItem(element)},_getAnimationRecord:function(element){return element?this._animationRecords[uniqueID(element)]:null},_createAnimationRecord:function(elementUniqueID,flipPage){if(elementUniqueID){var record=this._animationRecords[elementUniqueID]={removed:!1,changed:!1,inserted:!1};return flipPage&&(record.originalLocation=flipPage.location),record}},_writeProfilerMark:function(message){_WriteProfilerMark(message),this._flipperDiv.winControl.constructor._enabledDebug&&_Log.log&&_Log.log(message,null,"flipviewdebug")},_getElementIndex:function(element){var index=0;try{index=this._itemsManager.itemObject(element).index}catch(e){}return index},_resetBuffer:function(elementToSave,skipReleases){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var head=this._currentPage,curr=head;do curr.element&&curr.element===elementToSave||skipReleases?curr.setElement(null,!0):curr.setElement(null),curr=curr.next;while(curr!==head)},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(prevElement){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var newPage=this._createFlipPage(prevElement,this);return this._panningDiv.appendChild(newPage.pageRoot),newPage},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var tail=Promise.wrap(this._currentPage),that=this,i=0;i<this._bufferSize;i++)tail=tail.then(function(curr){return curr.next===that._prevMarker&&that._insertNewFlipPage(curr),curr.element?that._itemsManager._nextItem(curr.element).then(function(element){return curr.next.setElement(element),curr.next}):(curr.next.setElement(null),curr.next)});return tail},_fetchOneNext:function(target){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info");var prevElement=target.prev.element;if(this._prevMarker===target&&(this._prevMarker=this._prevMarker.next),!prevElement)return void target.setElement(null);var that=this;return this._itemsManager._nextItem(prevElement).then(function(element){target.setElement(element),that._movePageAhead(target.prev,target)})},_fetchPreviousItems:function(setPrevMarker){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var that=this,tail=Promise.wrap(this._currentPage),i=0;i<this._bufferSize;i++)tail=tail.then(function(curr){return curr.element?that._itemsManager._previousItem(curr.element).then(function(element){return curr.prev.setElement(element),curr.prev}):(curr.prev.setElement(null),curr.prev)});return tail.then(function(curr){setPrevMarker&&(that._prevMarker=curr)})},_fetchOnePrevious:function(target){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info");var nextElement=target.next.element;if(this._prevMarker===target.next&&(this._prevMarker=this._prevMarker.prev),!nextElement)return target.setElement(null),Promise.wrap();var that=this;return this._itemsManager._previousItem(nextElement).then(function(element){target.setElement(element),that._movePageBehind(target.next,target)})},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton(),this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(delayBoundariesSet){this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._setItemStart(this._currentPage,leftBufferAmount*this._viewportSize());for(var curr=this._currentPage;curr!==this._prevMarker;)this._movePageBehind(curr,curr.prev),curr=curr.prev;for(curr=this._currentPage;curr.next!==this._prevMarker;)this._movePageAhead(curr,curr.next),curr=curr.next;var boundariesSet=!1;this._lastScrollPos&&!delayBoundariesSet&&(this._setListEnds(),boundariesSet=!0),this._lastScrollPos=this._getItemStart(this._currentPage),this._setViewportStart(this._lastScrollPos),this._checkElementVisibility(!0),this._setupSnapPoints(),boundariesSet||this._setListEnds()},_ensureBufferConsistency:function(){var that=this,currentElement=this._currentPage.element;if(!currentElement)return Promise.wrap();var refreshBuffer=!1,seenUniqueIDs={},seenLocations={};this._forEachPage(function(page){if(page&&page.elementUniqueID){if(seenUniqueIDs[page.elementUniqueID])return refreshBuffer=!0,!0;if(seenUniqueIDs[page.elementUniqueID]=!0,page.location>0){if(seenLocations[page.location])return refreshBuffer=!0,
!0;seenLocations[page.location]=!0}}});var animationKeys=Object.keys(this._animationRecords);return animationKeys.forEach(function(key){var record=that._animationRecords[key];record&&(record.changed||record.inserted||record.moved||record.removed)&&(refreshBuffer=!0)}),refreshBuffer?(this._resetBuffer(null,!0),this._currentPage.setElement(currentElement),this._fetchNextItems().then(function(){return that._fetchPreviousItems(!0)}).then(function(){that._ensureCentered()})):Promise.wrap()},_shiftLeft:function(startingPoint){this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info");for(var curr=startingPoint,nextEl=null;curr!==this._prevMarker&&curr.next!==this._prevMarker;)nextEl=curr.next.element,!nextEl&&curr.next.elementUniqueID&&(curr.elementUniqueID=curr.next.elementUniqueID),curr.next.setElement(null,!0),curr.setElement(nextEl,!0),curr=curr.next;if(curr!==this._prevMarker&&curr.prev.element){var that=this;return this._itemsManager._nextItem(curr.prev.element).then(function(element){curr.setElement(element),that._createAnimationRecord(curr.elementUniqueID,curr)})}},_logBuffer:function(){if(this._flipperDiv.winControl.constructor._enabledDebug){_Log.log&&_Log.log(this._currentPage.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"	"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log(this._currentPage.next.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"	"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log("> "+this._currentPage.elementUniqueID+"	@:"+this._currentPage.location+(this._currentPage.element?"	"+this._currentPage.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log(this._currentPage.next.elementUniqueID+"	@:"+this._currentPage.next.location+(this._currentPage.next.element?"	"+this._currentPage.next.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log(this._currentPage.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"	"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var keys=Object.keys(this._itemsManager._elementMap),bufferKeys=[];this._forEachPage(function(page){page&&page.elementUniqueID&&bufferKeys.push(page.elementUniqueID)}),_Log.log&&_Log.log("itemsmanager  = ["+keys.join(" ")+"] flipview ["+bufferKeys.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(startingPoint){this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info");for(var curr=startingPoint,prevEl=null;curr!==this._prevMarker;)prevEl=curr.prev.element,!prevEl&&curr.prev.elementUniqueID&&(curr.elementUniqueID=curr.prev.elementUniqueID),curr.prev.setElement(null,!0),curr.setElement(prevEl,!0),curr=curr.prev;if(curr.next.element){var that=this;return this._itemsManager._previousItem(curr.next.element).then(function(element){curr.setElement(element),that._createAnimationRecord(curr.elementUniqueID,curr)})}},_checkElementVisibility:function(viewWasReset){var i,len;if(viewWasReset){var currentElement=this._currentPage.element;for(i=0,len=this._visibleElements.length;len>i;i++)this._visibleElements[i]!==currentElement&&this._announceElementInvisible(this._visibleElements[i]);this._visibleElements=[],currentElement&&(this._visibleElements.push(currentElement),this._announceElementVisible(currentElement))}else{for(i=0,len=this._visibleElements.length;len>i;i++)(!this._visibleElements[i].parentNode||this._visibleElements[i].removedFromChange)&&this._announceElementInvisible(this._visibleElements[i]);this._visibleElements=[];var that=this;this._forEachPage(function(curr){var element=curr.element;element&&(that._itemInView(curr)?(that._visibleElements.push(element),that._announceElementVisible(element)):that._announceElementInvisible(element))})}},_announceElementVisible:function(element){if(element&&!element.visible){element.visible=!0;var event=_Global.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info"),event.initCustomEvent(_Constants.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0}),element.dispatchEvent(event)}},_announceElementInvisible:function(element){if(element&&element.visible){element.visible=!1;var addedToDomForEvent=!1;element.parentNode||(addedToDomForEvent=!0,this._panningDivContainer.appendChild(element));var event=_Global.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),event.initCustomEvent(_Constants.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),element.dispatchEvent(event),addedToDomForEvent&&this._panningDivContainer.removeChild(element)}},_createDiscardablePage:function(content){var pageDivs=this._createPageContainer(),page={pageRoot:pageDivs.root,elementRoot:pageDivs.elementContainer,discardable:!0,element:content,elementUniqueID:uniqueID(content),discard:function(){page.pageRoot.parentNode&&page.pageRoot.parentNode.removeChild(page.pageRoot),page.element.parentNode&&page.element.parentNode.removeChild(page.element)}};return page.pageRoot.style.top="0px",page.elementRoot.appendChild(content),this._panningDiv.appendChild(page.pageRoot),page},_createPageContainer:function(){var width=this._panningDivContainerOffsetWidth,height=this._panningDivContainerOffsetHeight,parentDiv=_Global.document.createElement("div"),pageStyle=parentDiv.style,flexBox=_Global.document.createElement("div");return flexBox.className="win-item",pageStyle.position="absolute",pageStyle.overflow="hidden",pageStyle.width=width+"px",pageStyle.height=height+"px",parentDiv.appendChild(flexBox),{root:parentDiv,elementContainer:flexBox}},_createFlipPage:function(prev,manager){var page={};page.element=null,page.elementUniqueID=null,prev?(page.prev=prev,page.next=prev.next,page.next.prev=page,prev.next=page):(page.next=page,page.prev=page);var pageContainer=this._createPageContainer();return page.elementRoot=pageContainer.elementContainer,page.elementRoot.style.msOverflowStyle="auto",page.pageRoot=pageContainer.root,page.setElement=function(element,isReplacement){if(void 0===element&&(element=null),element===page.element)return void(element||(page.elementUniqueID=null));if(page.element&&(isReplacement||(manager._itemsManager.releaseItem(page.element),_Dispose._disposeElement(page.element))),page.element=element,page.elementUniqueID=element?uniqueID(element):null,_ElementUtilities.empty(page.elementRoot),page.element){if(page===manager._currentPage&&(manager._tabManager.childFocus=element),!isFlipper(page.element)){page.element.tabIndex=manager._tabIndex,page.element.setAttribute("role","option"),page.element.setAttribute("aria-selected",!1),page.element.id||(page.element.id=uniqueID(page.element));var setFlowAttribute=function(source,target,attributeName){source.setAttribute(attributeName,target.id)},isEnd=!page.next.element||page===manager._prevMarker.prev;isEnd&&(setFlowAttribute(page.element,manager._bufferAriaEndMarker,"aria-flowto"),setFlowAttribute(manager._bufferAriaEndMarker,page.element,"x-ms-aria-flowfrom")),page!==manager._prevMarker&&page.prev.element&&(setFlowAttribute(page.prev.element,page.element,"aria-flowto"),setFlowAttribute(page.element,page.prev.element,"x-ms-aria-flowfrom")),page.next!==manager._prevMarker&&page.next.element&&(setFlowAttribute(page.element,page.next.element,"aria-flowto"),setFlowAttribute(page.next.element,page.element,"x-ms-aria-flowfrom")),page.prev.element||setFlowAttribute(page.element,manager._bufferAriaStartMarker,"x-ms-aria-flowfrom")}page.elementRoot.appendChild(page.element)}},page},_itemInView:function(flipPage){return this._itemEnd(flipPage)>this._getViewportStart()&&this._getItemStart(flipPage)<this._viewportEnd()},_getViewportStart:function(){return this._panningDivContainer.parentNode?this._isHorizontal?_ElementUtilities.getScrollPosition(this._panningDivContainer).scrollLeft:_ElementUtilities.getScrollPosition(this._panningDivContainer).scrollTop:void 0},_setViewportStart:function(newValue){this._panningDivContainer.parentNode&&(this._isHorizontal?_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollLeft:newValue}):_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollTop:newValue}))},_viewportEnd:function(){var element=this._panningDivContainer;return this._isHorizontal?this._rtl?this._getViewportStart()+this._panningDivContainerOffsetWidth:_ElementUtilities.getScrollPosition(element).scrollLeft+this._panningDivContainerOffsetWidth:element.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_getItemStart:function(flipPage){return flipPage.location},_setItemStart:function(flipPage,newValue){void 0!==newValue&&(this._isHorizontal?flipPage.pageRoot.style.left=(this._rtl?-newValue:newValue)+"px":flipPage.pageRoot.style.top=newValue+"px",flipPage.location=newValue)},_itemEnd:function(flipPage){return(this._isHorizontal?flipPage.location+this._panningDivContainerOffsetWidth:flipPage.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(referencePage,pageToPlace){var delta=this._itemSize(referencePage)+this._itemSpacing;this._setItemStart(pageToPlace,this._getItemStart(referencePage)+delta)},_movePageBehind:function(referencePage,pageToPlace){var delta=this._itemSize(referencePage)+this._itemSpacing;this._setItemStart(pageToPlace,this._getItemStart(referencePage)-delta)},_setupSnapPoints:function(){if(this._environmentSupportsTouch){var containerStyle=this._panningDivContainer.style;containerStyle[styleEquivalents["scroll-snap-type"].scriptName]="mandatory";var viewportSize=this._viewportSize(),snapInterval=viewportSize+this._itemSpacing,propertyName="scroll-snap-points",startSnap=0,currPos=this._getItemStart(this._currentPage);startSnap=currPos%(viewportSize+this._itemSpacing),containerStyle[styleEquivalents[this._isHorizontal?propertyName+"-x":propertyName+"-y"].scriptName]="snapInterval("+startSnap+"px, "+snapInterval+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var containerStyle=this._panningDivContainer.style,startScroll=0,endScroll=0,startNonEmptyPage=this._getTailOfBuffer(),endNonEmptyPage=this._getHeadOfBuffer(),startBoundaryStyle=styleEquivalents["scroll-limit-"+(this._isHorizontal?"x-min":"y-min")].scriptName,endBoundaryStyle=styleEquivalents["scroll-limit-"+(this._isHorizontal?"x-max":"y-max")].scriptName;!endNonEmptyPage.element&&(endNonEmptyPage=endNonEmptyPage.prev,endNonEmptyPage!==this._prevMarker.prev););for(;!startNonEmptyPage.element&&(startNonEmptyPage=startNonEmptyPage.next,startNonEmptyPage!==this._prevMarker););endScroll=this._getItemStart(endNonEmptyPage),startScroll=this._getItemStart(startNonEmptyPage),containerStyle[startBoundaryStyle]=startScroll+"px",containerStyle[endBoundaryStyle]=endScroll+"px"}},_viewportOnItemStart:function(){return this._getItemStart(this._currentPage)===this._getViewportStart()},_restoreAnimatedElement:function(oldPage,discardablePage){var removed=!0;return oldPage.elementUniqueID!==uniqueID(discardablePage.element)||oldPage.element?this._forEachPage(function(curr){curr.elementUniqueID!==discardablePage.elementUniqueID||curr.element||(curr.setElement(discardablePage.element,!0),removed=!1)}):(oldPage.setElement(discardablePage.element,!0),removed=!1),removed},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var that=this;_BaseUtils._setImmediate(function(){that._viewportOnItemStart()&&(that._blockTabs=!1,that._currentPage.element&&that._lastSelectedElement!==that._currentPage.element&&(that._lastSelectedPage&&that._lastSelectedPage.element&&!isFlipper(that._lastSelectedPage.element)&&that._lastSelectedPage.element.setAttribute("aria-selected",!1),that._lastSelectedPage=that._currentPage,that._lastSelectedElement=that._currentPage.element,isFlipper(that._currentPage.element)||that._currentPage.element.setAttribute("aria-selected",!0),Scheduler.schedule(function(){if(that._currentPage.element){(that._hasFocus||that._hadFocus)&&(that._hadFocus=!1,_ElementUtilities._setActive(that._currentPage.element),that._tabManager.childFocus=that._currentPage.element);var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(_Constants.pageSelectedEvent,!0,!1,{source:that._flipperDiv}),that._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),that._currentPage.element.dispatchEvent(event);var originalElement=that._currentPage.element;if(originalElement){var record=that._itemsManager._recordFromElement(originalElement,!0);record&&record.renderComplete.then(function(){originalElement===that._currentPage.element&&(that._currentPage.element.setAttribute("aria-setsize",that._cachedSize),that._currentPage.element.setAttribute("aria-posinset",that.currentIndex()+1),that._bufferAriaStartMarker.setAttribute("aria-flowto",that._currentPage.element.id),event=_Global.document.createEvent("CustomEvent"),event.initCustomEvent(_Constants.pageCompletedEvent,!0,!1,{source:that._flipperDiv}),that._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),that._currentPage.element.dispatchEvent(event))})}}},Scheduler.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent")))})},_forEachPage:function(callback){var curr=this._prevMarker;do{if(callback(curr))break;curr=curr.next}while(curr!==this._prevMarker)},_changeFlipPage:function(page,oldElement,newElement){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info"),page.element=null,page.setElement?page.setElement(newElement,!0):(oldElement.parentNode.removeChild(oldElement),page.elementRoot.appendChild(newElement));var style=oldElement.style;return style.position="absolute",style.left="0px",style.top="0px",style.opacity=1,page.pageRoot.appendChild(oldElement),oldElement.style.left=Math.max(0,(page.pageRoot.offsetWidth-oldElement.offsetWidth)/2)+"px",oldElement.style.top=Math.max(0,(page.pageRoot.offsetHeight-oldElement.offsetHeight)/2)+"px",Animations.fadeOut(oldElement).then(function(){oldElement.parentNode&&oldElement.parentNode.removeChild(oldElement)})},_deleteFlipPage:function(page){_WriteProfilerMark("WinJS.UI.FlipView:_deleteFlipPage,info"),page.elementRoot.style.opacity=0;var animation=Animations.createDeleteFromListAnimation([page.elementRoot]),that=this;return animation.execute().then(function(){page.discardable&&(page.discard(),that._itemsManager.releaseItem(page.element))})},_insertFlipPage:function(page){_WriteProfilerMark("WinJS.UI.FlipView:_insertFlipPage,info"),page.elementRoot.style.opacity=1;var animation=Animations.createAddToListAnimation([page.elementRoot]);return animation.execute().then(function(){page.discardable&&page.discard()})},_moveFlipPage:function(page,move){_WriteProfilerMark("WinJS.UI.FlipView:_moveFlipPage,info");var animation=Animations.createRepositionAnimation(page.pageRoot);move();var that=this;return animation.execute().then(function(){if(page.discardable){page.discard();var animationRecord=that._getAnimationRecord(page.element);animationRecord&&!animationRecord.successfullyMoved&&that._itemsManager.releaseItem(page.element)}})},_handleManipulationStateChanged:function(event){this._manipulationState=event.currentState,0===event.currentState&&event.target===this._panningDivContainer&&(this._itemSettledOn(),this._ensureCentered())}},{supportedForProcessing:!1});return _FlipPageManager.flipPageBufferCount=2,_FlipPageManager})})}),define("require-style!less/styles-flipview",[],function(){}),define("require-style!less/colors-flipview",[],function(){}),define("WinJS/Controls/FlipView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_UI","./FlipView/_Constants","./FlipView/_PageManager","require-style!less/styles-flipview","require-style!less/colors-flipview"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,_TransitionAnimation,BindingList,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Hoverable,_ItemsManager,_UI,_Constants,_PageManager){"use strict";_Base.Namespace.define("WinJS.UI",{FlipView:_Base.Namespace._lazy(function(){function flipViewPropertyChanged(list){var that=list[0].target.winControl;that&&that instanceof FlipView&&list.some(function(record){return"dir"===record.attributeName?!0:"style"===record.attributeName?that._cachedStyleDir!==record.target.style.direction:!1})&&(that._cachedStyleDir=that._flipviewDiv.style.direction,that._rtl="rtl"===_ElementUtilities._getComputedStyle(that._flipviewDiv,null).direction,that._setupOrientation())}function flipviewResized(e){var that=e.target&&e.target.winControl;that&&that instanceof FlipView&&(_WriteProfilerMark("WinJS.UI.FlipView:resize,StartTM"),that._resize())}var navButtonClass="win-navbutton",flipViewClass="win-flipview",navButtonLeftClass="win-navleft",navButtonRightClass="win-navright",navButtonTopClass="win-navtop",navButtonBottomClass="win-navbottom",previousButtonLabel="Previous",nextButtonLabel="Next",buttonFadeDelay=3e3,avoidTrapDelay=500,leftArrowGlyph="&#57570;",rightArrowGlyph="&#57571;",topArrowGlyph="&#57572;",bottomArrowGlyph="&#57573;",animationMoveDelta=40,strings={get badAxis(){return"Invalid argument: orientation must be a string, either 'horizontal' or 'vertical'"},get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"},get noitemsManagerForCount(){return"Invalid operation: can't get count if no dataSource has been set"},get badItemSpacingAmount(){return"Invalid argument: itemSpacing must be a number greater than or equal to zero"},get navigationDuringStateChange(){return"Error: After changing itemDataSource or itemTemplate, any navigation in the FlipView control should be delayed until the pageselected event is fired."},get panningContainerAriaLabel(){return _Resources._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},FlipView=_Base.Class.define(function(element,options){_WriteProfilerMark("WinJS.UI.FlipView:constructor,StartTM"),this._disposed=!1,element=element||_Global.document.createElement("div");var isHorizontal=!0,dataSource=null,itemRenderer=_ItemsManager._trivialHtmlRenderer,initialIndex=0,itemSpacing=0;if(options){if(options.orientation&&"string"==typeof options.orientation)switch(options.orientation.toLowerCase()){case"horizontal":isHorizontal=!0;break;case"vertical":isHorizontal=!1}options.currentPage&&(initialIndex=options.currentPage>>0,initialIndex=0>initialIndex?0:initialIndex),options.itemDataSource&&(dataSource=options.itemDataSource),options.itemTemplate&&(itemRenderer=this._getItemRenderer(options.itemTemplate)),options.itemSpacing&&(itemSpacing=options.itemSpacing>>0,itemSpacing=0>itemSpacing?0:itemSpacing)}if(!dataSource){var list=new BindingList.List;dataSource=list.dataSource}_ElementUtilities.empty(element),this._flipviewDiv=element,element.winControl=this,_Control._setOptions(this,options,!0),this._initializeFlipView(element,isHorizontal,dataSource,itemRenderer,initialIndex,itemSpacing),_ElementUtilities.addClass(element,"win-disposable"),this._avoidTrappingTime=0,this._windowWheelHandlerBound=this._windowWheelHandler.bind(this),_ElementUtilities._globalListener.addEventListener(element,"wheel",this._windowWheelHandlerBound),_ElementUtilities._globalListener.addEventListener(element,"mousewheel",this._windowWheelHandlerBound),_WriteProfilerMark("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){_WriteProfilerMark("WinJS.UI.FlipView:dispose,StopTM"),this._disposed||(_ElementUtilities._globalListener.removeEventListener(this._flipviewDiv,"wheel",this._windowWheelHandlerBound),_ElementUtilities._globalListener.removeEventListener(this._flipviewDiv,"mousewheel",this._windowWheelHandlerBound),_ElementUtilities._resizeNotifier.unsubscribe(this._flipviewDiv,flipviewResized),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){_WriteProfilerMark("WinJS.UI.FlipView:next,info");var cancelAnimationCallback=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,cancelAnimationCallback)},previous:function(){_WriteProfilerMark("WinJS.UI.FlipView:prev,info");var cancelAnimationCallback=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,cancelAnimationCallback)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(index){if(_WriteProfilerMark("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal){var that=this;return void this._pageManager._notificationsEndedSignal.promise.done(function(){that._pageManager._notificationsEndedSignal=null,that.currentPage=index})}if(!this._animating||this._cancelAnimation())if(index>>=0,index=0>index?0:index,this._refreshTimer)this._indexAfterRefresh=index;else{this._pageManager._cachedSize>0?index=Math.min(this._pageManager._cachedSize-1,index):0===this._pageManager._cachedSize&&(index=0);var that=this;if(this._jumpingToIndex===index)return;var clearJumpToIndex=function(){that._jumpingToIndex=null};this._jumpingToIndex=index;var jumpAnimation=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),cancelAnimationCallback=this._jumpAnimation?null:this._cancelDefaultAnimation,completionCallback=function(){that._completeJump()};this._pageManager.startAnimatedJump(index,cancelAnimationCallback,completionCallback).then(function(elements){if(elements){that._animationsStarted();var currElement=elements.oldPage.pageRoot,newCurrElement=elements.newPage.pageRoot;that._contentDiv.appendChild(currElement),that._contentDiv.appendChild(newCurrElement),that._completeJumpPending=!0,jumpAnimation(currElement,newCurrElement).then(function(){that._completeJumpPending&&(completionCallback(),_WriteProfilerMark("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(clearJumpToIndex,clearJumpToIndex)}else clearJumpToIndex()},clearJumpToIndex)}}},orientation:{get:function(){return this._axisAsString()},set:function(orientation){_WriteProfilerMark("WinJS.UI.FlipView:set_orientation,info");var isHorizontal="horizontal"===orientation;isHorizontal!==this._isHorizontal&&(this._isHorizontal=isHorizontal,this._setupOrientation(),this._pageManager.setOrientation(this._isHorizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(dataSource){_WriteProfilerMark("WinJS.UI.FlipView:set_itemDataSource,info"),this._dataSourceAfterRefresh=dataSource||(new BindingList.List).dataSource,this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(itemTemplate){_WriteProfilerMark("WinJS.UI.FlipView:set_itemTemplate,info"),this._itemRendererAfterRefresh=this._getItemRenderer(itemTemplate),this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(spacing){_WriteProfilerMark("WinJS.UI.FlipView:set_itemSpacing,info"),spacing>>=0,spacing=0>spacing?0:spacing,this._pageManager.setItemSpacing(spacing)}},count:function(){_WriteProfilerMark("WinJS.UI.FlipView:count,info");var that=this;return new Promise(function(complete,error){that._itemsManager?that._pageManager._cachedSize===_UI.CountResult.unknown||that._pageManager._cachedSize>=0?complete(that._pageManager._cachedSize):that._dataSource.getCount().then(function(count){that._pageManager._cachedSize=count,complete(count)}):error(FlipView.noitemsManagerForCount)})},setCustomAnimations:function(animations){_WriteProfilerMark("WinJS.UI.FlipView:setCustomAnimations,info"),void 0!==animations.next&&(this._nextAnimation=animations.next),void 0!==animations.previous&&(this._prevAnimation=animations.previous),void 0!==animations.jump&&(this._jumpAnimation=animations.jump)},forceLayout:function(){_WriteProfilerMark("WinJS.UI.FlipView:forceLayout,info"),this._pageManager.resized()},_initializeFlipView:function(element,isHorizontal,dataSource,itemRenderer,initialIndex,itemSpacing){function setUpButton(button){button.setAttribute("aria-hidden",!0),button.style.visibility="hidden",button.style.opacity=0,button.tabIndex=-1,button.style.zIndex=1e3}function handleShowButtons(e){if(e.pointerType!==PT_TOUCH){if(that._touchInteraction=!1,e.screenX===that._lastMouseX&&e.screenY===that._lastMouseY)return;that._lastMouseX=e.screenX,that._lastMouseY=e.screenY,that._mouseInViewport=!0,that._fadeInButton("prev"),that._fadeInButton("next"),that._fadeOutButtons()}}function handlePointerDown(e){e.pointerType===PT_TOUCH?(that._mouseInViewport=!1,that._touchInteraction=!0,that._fadeOutButtons(!0)):(that._touchInteraction=!1,that._isInteractive(e.target)||0!==(4&e.buttons)&&(e.stopPropagation(),e.preventDefault()))}function handlePointerUp(e){e.pointerType!==PT_TOUCH&&(that._touchInteraction=!1)}var that=this,flipViewInitialized=!1;this._flipviewDiv=element,_ElementUtilities.addClass(this._flipviewDiv,flipViewClass),this._contentDiv=_Global.document.createElement("div"),this._panningDivContainer=_Global.document.createElement("div"),this._panningDivContainer.className="win-surface",this._panningDiv=_Global.document.createElement("div"),this._prevButton=_Global.document.createElement("button"),this._nextButton=_Global.document.createElement("button"),this._isHorizontal=isHorizontal,this._dataSource=dataSource,this._itemRenderer=itemRenderer,this._itemsManager=null,this._pageManager=null;for(var stylesRequiredForFullFeatureMode=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],allFeaturesSupported=!0,styleEquivalents=_BaseUtils._browserStyleEquivalents,i=0,len=stylesRequiredForFullFeatureMode.length;len>i;i++)allFeaturesSupported=allFeaturesSupported&&!!styleEquivalents[stylesRequiredForFullFeatureMode[i]];allFeaturesSupported=allFeaturesSupported&&!!_BaseUtils._browserEventEquivalents.manipulationStateChanged,allFeaturesSupported=allFeaturesSupported&&_ElementUtilities._supportsSnapPoints,this._environmentSupportsTouch=allFeaturesSupported;var accName=this._flipviewDiv.getAttribute("aria-label");accName||this._flipviewDiv.setAttribute("aria-label",""),this._flipviewDiv.setAttribute("role","listbox"),this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden"),this._contentDiv.style.position="relative",this._contentDiv.style.zIndex=0,this._contentDiv.style.width="100%",this._contentDiv.style.height="100%",this._panningDiv.style.position="relative",this._panningDivContainer.style.position="relative",this._panningDivContainer.style.width="100%",this._panningDivContainer.style.height="100%",this._panningDivContainer.setAttribute("role","group"),this._panningDivContainer.setAttribute("aria-label",strings.panningContainerAriaLabel),this._contentDiv.appendChild(this._panningDivContainer),this._flipviewDiv.appendChild(this._contentDiv),this._panningDiv.style.width="100%",this._panningDiv.style.height="100%",this._setupOrientation(),setUpButton(this._prevButton),setUpButton(this._nextButton),this._prevButton.setAttribute("aria-label",previousButtonLabel),this._nextButton.setAttribute("aria-label",nextButtonLabel),this._prevButton.setAttribute("type","button"),this._nextButton.setAttribute("type","button"),this._panningDivContainer.appendChild(this._panningDiv),this._contentDiv.appendChild(this._prevButton),this._contentDiv.appendChild(this._nextButton),this._itemsManagerCallback={inserted:function(itemPromise,previousHandle,nextHandle){that._itemsManager._itemFromPromise(itemPromise).then(function(element){var previous=that._itemsManager._elementFromHandle(previousHandle),next=that._itemsManager._elementFromHandle(nextHandle);that._pageManager.inserted(element,previous,next,!0)})},countChanged:function(newCount,oldCount){that._pageManager._cachedSize=newCount,oldCount!==_UI.CountResult.unknown&&that._fireDatasourceCountChangedEvent()},changed:function(newElement,oldElement){that._pageManager.changed(newElement,oldElement)},moved:function(element,prev,next,itemPromise){var elementReady=function(element){that._pageManager.moved(element,prev,next)};element?elementReady(element):that._itemsManager._itemFromPromise(itemPromise).then(elementReady)},removed:function(element,mirage){element&&that._pageManager.removed(element,mirage,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){that._cancelAnimation(),that._pageManager.notificationsStarted()},endNotifications:function(){that._pageManager.notificationsEnded()},itemAvailable:function(real,placeholder){that._pageManager.itemRetrieved(real,placeholder)},reload:function(){that._pageManager.reload()}},this._dataSource&&(this._itemsManager=_ItemsManager._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv})),this._pageManager=new _PageManager._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,itemSpacing,this._environmentSupportsTouch,{hidePreviousButton:function(){that._hasPrevContent=!1,that._fadeOutButton("prev"),that._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){that._hasPrevContent=!0,that._fadeInButton("prev"),that._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){that._hasNextContent=!1,that._fadeOutButton("next"),that._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){that._hasNextContent=!0,that._fadeInButton("next"),that._nextButton.setAttribute("aria-hidden",!1)}}),this._pageManager.initialize(initialIndex,this._isHorizontal),this._dataSource.getCount().then(function(count){that._pageManager._cachedSize=count}),this._prevButton.addEventListener("click",function(){that.previous()},!1),this._nextButton.addEventListener("click",function(){that.next()},!1),new _ElementUtilities._MutationObserver(flipViewPropertyChanged).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]}),this._cachedStyleDir=this._flipviewDiv.style.direction,this._flipviewDiv.addEventListener("mselementresize",flipviewResized),_ElementUtilities._resizeNotifier.subscribe(this._flipviewDiv,flipviewResized),this._contentDiv.addEventListener("mouseleave",function(){that._mouseInViewport=!1},!1);var PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._environmentSupportsTouch&&(_ElementUtilities._addEventListener(this._contentDiv,"pointerdown",handlePointerDown,!1),_ElementUtilities._addEventListener(this._contentDiv,"pointermove",handleShowButtons,!1),_ElementUtilities._addEventListener(this._contentDiv,"pointerup",handlePointerUp,!1)),this._panningDivContainer.addEventListener("scroll",function(){that._scrollPosChanged()},!1),this._panningDiv.addEventListener("blur",function(){that._touchInteraction||that._fadeOutButtons()},!0);var initiallyParented=_Global.document.body.contains(this._flipviewDiv);_ElementUtilities._addInsertedNotifier(this._flipviewDiv),this._flipviewDiv.addEventListener("WinJSNodeInserted",function(event){return initiallyParented?void(initiallyParented=!1):void that._pageManager.resized()},!1),this._flipviewDiv.addEventListener("keydown",function(event){if(!that._disposed){var cancelBubbleIfHandled=!0;if(!that._isInteractive(event.target)){
var Key=_ElementUtilities.Key,handled=!1;if(that._isHorizontal)switch(event.keyCode){case Key.leftArrow:!that._rtl&&that.currentPage>0?(that.previous(),handled=!0):that._rtl&&that.currentPage<that._pageManager._cachedSize-1&&(that.next(),handled=!0);break;case Key.pageUp:that.currentPage>0&&(that.previous(),handled=!0);break;case Key.rightArrow:!that._rtl&&that.currentPage<that._pageManager._cachedSize-1?(that.next(),handled=!0):that._rtl&&that.currentPage>0&&(that.previous(),handled=!0);break;case Key.pageDown:that.currentPage<that._pageManager._cachedSize-1&&(that.next(),handled=!0);break;case Key.upArrow:case Key.downArrow:handled=!0,cancelBubbleIfHandled=!1}else switch(event.keyCode){case Key.upArrow:case Key.pageUp:that.currentPage>0&&(that.previous(),handled=!0);break;case Key.downArrow:case Key.pageDown:that.currentPage<that._pageManager._cachedSize-1&&(that.next(),handled=!0);break;case Key.space:handled=!0}switch(event.keyCode){case Key.home:that.currentPage=0,handled=!0;break;case Key.end:that._pageManager._cachedSize>0&&(that.currentPage=that._pageManager._cachedSize-1),handled=!0}if(handled)return event.preventDefault(),cancelBubbleIfHandled&&event.stopPropagation(),!0}}},!1),flipViewInitialized=!0},_windowWheelHandler:function(ev){if(!this._disposed){ev=ev.detail.originalEvent;var wheelWithinFlipper=ev.target&&(this._flipviewDiv.contains(ev.target)||this._flipviewDiv===ev.target),that=this,now=_BaseUtils._now(),withinAvoidTime=this._avoidTrappingTime>now;(!wheelWithinFlipper||withinAvoidTime)&&(this._avoidTrappingTime=now+avoidTrapDelay),wheelWithinFlipper&&withinAvoidTime?(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",_BaseUtils._yieldForDomModification(function(){that._pageManager._ensureCentered(),that._isHorizontal?(that._panningDivContainer.style.overflowX=that._environmentSupportsTouch?"scroll":"hidden",that._panningDivContainer.style.overflowY="hidden"):(that._panningDivContainer.style.overflowY=that._environmentSupportsTouch?"scroll":"hidden",that._panningDivContainer.style.overflowX="hidden")})):wheelWithinFlipper&&this._pageManager.simulateMouseWheelScroll(ev)}},_isInteractive:function(element){if(element.parentNode)for(var matches=element.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),i=0,len=matches.length;len>i;i++)if(matches[i]===element)return!0;return!1},_refreshHandler:function(){var dataSource=this._dataSourceAfterRefresh||this._dataSource,renderer=this._itemRendererAfterRefresh||this._itemRenderer,initialIndex=this._indexAfterRefresh||0;this._setDatasource(dataSource,renderer,initialIndex),this._dataSourceAfterRefresh=null,this._itemRendererAfterRefresh=null,this._indexAfterRefresh=0,this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var that=this;this._refreshTimer=!0,Scheduler.schedule(function(){that._refreshTimer&&!that._disposed&&that._refreshHandler()},Scheduler.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(itemTemplate){var itemRenderer=null;if("function"==typeof itemTemplate){var itemPromise=new Promise(function(){}),itemTemplateResult=itemTemplate(itemPromise);itemRenderer=itemTemplateResult.element?"object"==typeof itemTemplateResult.element&&"function"==typeof itemTemplateResult.element.then?function(itemPromise){var elementRoot=_Global.document.createElement("div");return elementRoot.className="win-template",_Dispose.markDisposable(elementRoot),{element:elementRoot,renderComplete:itemTemplate(itemPromise).element.then(function(element){elementRoot.appendChild(element)})}}:itemTemplate:function(itemPromise){var elementRoot=_Global.document.createElement("div");return elementRoot.className="win-template",_Dispose.markDisposable(elementRoot),{element:elementRoot,renderComplete:itemPromise.then(function(){return Promise.as(itemTemplate(itemPromise)).then(function(element){elementRoot.appendChild(element)})})}}}else"object"==typeof itemTemplate&&(itemRenderer=itemTemplate.renderItem);return itemRenderer},_navigate:function(goForward,cancelAnimationCallback){if(_BaseUtils.validation&&this._refreshTimer)throw new _ErrorFromName("WinJS.UI.FlipView.NavigationDuringStateChange",strings.navigationDuringStateChange);if(this._animating||(this._animatingForward=goForward),this._goForward=goForward,this._animating&&!this._cancelAnimation())return!1;var that=this,customAnimation=goForward?this._nextAnimation:this._prevAnimation,animation=customAnimation?customAnimation:this._defaultAnimation.bind(this),completionCallback=function(goForward){that._completeNavigation(goForward)},elements=this._pageManager.startAnimatedNavigation(goForward,cancelAnimationCallback,completionCallback);if(elements){this._animationsStarted();var outgoingElement=elements.outgoing.pageRoot,incomingElement=elements.incoming.pageRoot;return this._contentDiv.appendChild(outgoingElement),this._contentDiv.appendChild(incomingElement),this._completeNavigationPending=!0,animation(outgoingElement,incomingElement).then(function(){that._completeNavigationPending&&completionCallback(that._goForward)}).done(),!0}return!1},_cancelDefaultAnimation:function(outgoingElement,incomingElement){outgoingElement.style.opacity=0,incomingElement.style.animationName="",incomingElement.style.opacity=1},_cancelAnimation:function(){if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback){var cancelCallback=this._pageManager._navigationAnimationRecord.cancelAnimationCallback;if(cancelCallback&&(cancelCallback=cancelCallback.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var outgoingPage=this._pageManager._navigationAnimationRecord.elementContainers[0],incomingPage=this._pageManager._navigationAnimationRecord.elementContainers[1],outgoingElement=outgoingPage.pageRoot,incomingElement=incomingPage.pageRoot;return cancelCallback&&cancelCallback(outgoingElement,incomingElement),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}}return!1},_completeNavigation:function(goForward){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var outgoingPage=this._pageManager._navigationAnimationRecord.elementContainers[0],incomingPage=this._pageManager._navigationAnimationRecord.elementContainers[1],outgoingElement=outgoingPage.pageRoot,incomingElement=incomingPage.pageRoot;outgoingElement.parentNode&&outgoingElement.parentNode.removeChild(outgoingElement),incomingElement.parentNode&&incomingElement.parentNode.removeChild(incomingElement),this._pageManager.endAnimatedNavigation(goForward,outgoingPage,incomingPage),this._fadeOutButtons(),this._scrollPosChanged(),this._pageManager._ensureCentered(!0),this._animationsFinished()}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var outgoingPage=this._pageManager._navigationAnimationRecord.elementContainers[0],incomingPage=this._pageManager._navigationAnimationRecord.elementContainers[1],outgoingElement=outgoingPage.pageRoot,incomingElement=incomingPage.pageRoot;outgoingElement.parentNode&&outgoingElement.parentNode.removeChild(outgoingElement),incomingElement.parentNode&&incomingElement.parentNode.removeChild(incomingElement),this._pageManager.endAnimatedJump(outgoingPage,incomingPage),this._animationsFinished()}this._completeJumpPending=!1}},_resize:function(){this._pageManager.resized()},_setCurrentIndex:function(index){return this._pageManager.jumpToIndex(index)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(source,template,index){this._animating&&this._cancelAnimation();var initialIndex=0;void 0!==index&&(initialIndex=index),this._dataSource=source,this._itemRenderer=template;var oldItemsManager=this._itemsManager;this._itemsManager=_ItemsManager._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}),this._dataSource=this._itemsManager.dataSource;var that=this;this._dataSource.getCount().then(function(count){that._pageManager._cachedSize=count}),this._pageManager.setNewItemsManager(this._itemsManager,initialIndex),oldItemsManager&&oldItemsManager.release()},_fireDatasourceCountChangedEvent:function(){var that=this;Scheduler.schedule(function(){var event=_Global.document.createEvent("Event");event.initEvent(FlipView.datasourceCountChangedEvent,!0,!0),_WriteProfilerMark("WinJS.UI.FlipView:dataSourceCountChangedEvent,info"),that._flipviewDiv.dispatchEvent(event)},Scheduler.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._disposed||this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._isHorizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._isHorizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowY="hidden";var rtl="rtl"===_ElementUtilities._getComputedStyle(this._flipviewDiv,null).direction;this._rtl=rtl,rtl?(this._prevButton.className=navButtonClass+" "+navButtonRightClass,this._nextButton.className=navButtonClass+" "+navButtonLeftClass):(this._prevButton.className=navButtonClass+" "+navButtonLeftClass,this._nextButton.className=navButtonClass+" "+navButtonRightClass),this._prevButton.innerHTML=rtl?rightArrowGlyph:leftArrowGlyph,this._nextButton.innerHTML=rtl?leftArrowGlyph:rightArrowGlyph}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=navButtonClass+" "+navButtonTopClass,this._nextButton.className=navButtonClass+" "+navButtonBottomClass,this._prevButton.innerHTML=topArrowGlyph,this._nextButton.innerHTML=bottomArrowGlyph;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(button,forceShow){(this._mouseInViewport||forceShow||!this._environmentSupportsTouch)&&("next"===button&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===button&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(button){var that=this;return"next"===button?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=Animations.fadeOut(this._nextButton).then(function(){that._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=Animations.fadeOut(this._prevButton).then(function(){that._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(immediately){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var that=this;this._buttonFadePromise=(immediately?Promise.wrap():Promise.timeout(_TransitionAnimation._animationTimeAdjustment(buttonFadeDelay))).then(function(){that._fadeOutButton("prev"),that._fadeOutButton("next"),that._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(curr,next){var incomingPageMove={};next.style.left="0px",next.style.top="0px",next.style.opacity=0;var pageDirection=curr.itemIndex>next.itemIndex?-animationMoveDelta:animationMoveDelta;incomingPageMove.left=(this._isHorizontal?this._rtl?-pageDirection:pageDirection:0)+"px",incomingPageMove.top=(this._isHorizontal?0:pageDirection)+"px";var fadeOutPromise=Animations.fadeOut(curr),enterContentPromise=Animations.enterContent(next,[incomingPageMove],{mechanism:"transition"});return Promise.join([fadeOutPromise,enterContentPromise])},_fadeInFromCurrentValue:function(shown){return _TransitionAnimation.executeTransition(shown,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}},_Constants);return _Base.Class.mix(FlipView,_Events.createEventProperties(FlipView.datasourceCountChangedEvent,FlipView.pageVisibilityChangedEvent,FlipView.pageSelectedEvent,FlipView.pageCompletedEvent)),_Base.Class.mix(FlipView,_Control.DOMEventMixin),FlipView})})}),define("WinJS/Controls/ItemContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Utilities/_UI","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Hoverable,_KeyboardBehavior,_UI,_Constants,_ItemEventsHandler){"use strict";var createEvent=_Events._createEventProperty,eventNames={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{ItemContainer:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get swipeOrientationDeprecated(){return"Invalid configuration: swipeOrientation is deprecated. The control will default this property to 'none'"},get swipeBehaviorDeprecated(){return"Invalid configuration: swipeBehavior is deprecated. The control will default this property to 'none'"}},ItemContainer=_Base.Class.define(function(element,options){function eventHandler(eventName,caseSensitive,capture){return{name:caseSensitive?eventName:eventName.toLowerCase(),handler:function(eventObject){that["_on"+eventName](eventObject)},capture:capture}}if(element=element||_Global.document.createElement("DIV"),this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.ItemContainer.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(element,"win-disposable"),this._selectionMode=_UI.SelectionMode.single,this._draggable=!1,this._pressedEntity={type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},this.tapBehavior=_UI.TapBehavior.invokeOnly,_ElementUtilities.addClass(this.element,ItemContainer._ClassName.itemContainer+" "+_Constants._containerClass),this._setupInternalTree(),this._selection=new exports._SingleItemSelectionManager(element,this._itemBox),this._setTabIndex(),_Control.setOptions(this,options),this._mutationObserver=new _ElementUtilities._MutationObserver(this._itemPropertyChange.bind(this)),this._mutationObserver.observe(element,{attributes:!0,attributeFilter:["aria-selected"]}),this._setAriaRole();var that=this;this.selectionDisabled||Scheduler.schedule(function(){that._setDirectionClass()},Scheduler.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize"),this._itemEventsHandler=new _ItemEventsHandler._ItemEventsHandler(Object.create({containerFromElement:function(){return that.element},indexForItemElement:function(){return 1},indexForHeaderElement:function(){return _Constants._INVALID_INDEX},itemBoxAtIndex:function(){return that._itemBox},itemAtIndex:function(){return that.element},headerAtIndex:function(){return null},containerAtIndex:function(){return that.element},isZombie:function(){return this._disposed},getItemPosition:function(){return that._getItemPosition()},rtl:function(){return that._rtl()},fireInvokeEvent:function(){that._fireInvokeEvent()},verifySelectionAllowed:function(){return that._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(firstIndex,lastIndex){return that._selection.set({firstIndex:firstIndex,lastIndex:lastIndex})}},{pressedEntity:{get:function(){return that._pressedEntity},set:function(value){that._pressedEntity=value}},pressedElement:{enumerable:!0,set:function(value){that._pressedElement=value}},eventHandlerRoot:{enumerable:!0,get:function(){return that.element}},selectionMode:{enumerable:!0,get:function(){return that._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return _Constants._containerClass}},canvasProxy:{enumerable:!0,get:function(){return that._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return that._tapBehavior}},draggable:{enumerable:!0,get:function(){return that._draggable}},selection:{enumerable:!0,get:function(){return that._selection}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));var events=[eventHandler("PointerDown"),eventHandler("Click"),eventHandler("PointerUp"),eventHandler("PointerCancel"),eventHandler("LostPointerCapture"),eventHandler("ContextMenu"),eventHandler("MSHoldVisual",!0),eventHandler("FocusIn"),eventHandler("FocusOut"),eventHandler("DragStart"),eventHandler("DragEnd"),eventHandler("KeyDown")];events.forEach(function(eventHandler){_ElementUtilities._addEventListener(that.element,eventHandler.name,eventHandler.handler,!!eventHandler.capture)}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(value){_BaseUtils.isPhone||this._draggable!==value&&(this._draggable=value,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(value){this._selection.selected!==value&&(this._selection.selected=value)}},swipeOrientation:{get:function(){return"none"},set:function(value){_ElementUtilities._deprecated(strings.swipeOrientationDeprecated)}},tapBehavior:{get:function(){return this._tapBehavior},set:function(value){_BaseUtils.isPhone&&value===_UI.TapBehavior.directSelect||(this._tapBehavior=value,this._setAriaRole())}},swipeBehavior:{get:function(){return"none"},set:function(value){_ElementUtilities._deprecated(strings.swipeBehaviorDeprecated)}},selectionDisabled:{get:function(){return this._selectionMode===_UI.SelectionMode.none},set:function(value){value?this._selectionMode=_UI.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=_UI.SelectionMode.single),this._setAriaRole()}},oninvoked:createEvent(eventNames.invoked),onselectionchanging:createEvent(eventNames.selectionchanging),onselectionchanged:createEvent(eventNames.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),_Dispose.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(eventObject){this._itemEventsHandler.onMSManipulationStateChanged(eventObject)},_onPointerDown:function(eventObject){this._itemEventsHandler.onPointerDown(eventObject)},_onClick:function(eventObject){this._itemEventsHandler.onClick(eventObject)},_onPointerUp:function(eventObject){_ElementUtilities.hasClass(this._itemBox,_Constants._itemFocusClass)&&this._onFocusOut(eventObject),this._itemEventsHandler.onPointerUp(eventObject)},_onPointerCancel:function(eventObject){this._itemEventsHandler.onPointerCancel(eventObject)},_onLostPointerCapture:function(eventObject){this._itemEventsHandler.onLostPointerCapture(eventObject)},_onContextMenu:function(eventObject){this._itemEventsHandler.onContextMenu(eventObject)},_onMSHoldVisual:function(eventObject){this._itemEventsHandler.onMSHoldVisual(eventObject)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+_Constants._itemFocusOutlineClass)&&_KeyboardBehavior._keyboardSeenLast){_ElementUtilities.addClass(this._itemBox,_Constants._itemFocusClass);var outline=_Global.document.createElement("div");outline.className=_Constants._itemFocusOutlineClass,this._itemBox.appendChild(outline)}},_onFocusOut:function(){_ElementUtilities.removeClass(this._itemBox,_Constants._itemFocusClass);var outline=this._itemBox.querySelector("."+_Constants._itemFocusOutlineClass);outline&&outline.parentNode.removeChild(outline)},_onDragStart:function(eventObject){if(this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement))eventObject.preventDefault();else{this._dragging=!0;var that=this;if(eventObject.dataTransfer.setData("text",""),eventObject.dataTransfer.setDragImage){var rect=this.element.getBoundingClientRect();eventObject.dataTransfer.setDragImage(this.element,eventObject.clientX-rect.left,eventObject.clientY-rect.top)}_BaseUtils._yieldForDomModification(function(){that._dragging&&_ElementUtilities.addClass(that._itemBox,_Constants._dragSourceClass)})}},_onDragEnd:function(){this._dragging=!1,_ElementUtilities.removeClass(this._itemBox,_Constants._dragSourceClass),this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(eventObject){if(!this._itemEventsHandler._isInteractive(eventObject.target)){var Key=_ElementUtilities.Key,keyCode=eventObject.keyCode,handled=!1;if(eventObject.ctrlKey||keyCode!==Key.enter)eventObject.ctrlKey&&keyCode===Key.enter||keyCode===Key.space?this.selectionDisabled||(this.selected=!this.selected,handled=_ElementUtilities._setActive(this.element)):keyCode===Key.escape&&this.selected&&(this.selected=!1,handled=!0);else{var allowed=this._verifySelectionAllowed();allowed.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),handled=!0}handled&&(eventObject.stopPropagation(),eventObject.preventDefault())}},_setTabIndex:function(){var currentTabIndex=this.element.getAttribute("tabindex");currentTabIndex||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===_ElementUtilities._getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){_ElementUtilities[this._rtl()?"addClass":"removeClass"](this.element,_Constants._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===_ElementUtilities._getComputedStyle(this.element,null).direction,this._setDirectionClass()},_getItemPosition:function(){var container=this.element;return container?Promise.wrap({left:this._rtl()?container.offsetParent.offsetWidth-container.offsetLeft-container.offsetWidth:container.offsetLeft,top:container.offsetTop,totalWidth:_ElementUtilities.getTotalWidth(container),totalHeight:_ElementUtilities.getTotalHeight(container),contentWidth:_ElementUtilities.getContentWidth(container),contentHeight:_ElementUtilities.getContentHeight(container)}):Promise.cancel},_itemPropertyChange:function(list){if(!this._disposed){var container=list[0].target,ariaSelected="true"===container.getAttribute("aria-selected");ariaSelected!==_ElementUtilities._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?_ElementUtilities._setAttribute(container,"aria-selected",!ariaSelected):(this.selected=ariaSelected,ariaSelected!==this.selected&&_ElementUtilities._setAttribute(container,"aria-selected",!ariaSelected)))}},_updateDraggableAttribute:function(){this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode!==_UI.SelectionMode.none&&this._tapBehavior===_UI.TapBehavior.toggleSelect){var canSelect=this._selection.fireSelectionChanging();return{canSelect:canSelect,canTapSelect:canSelect&&this._tapBehavior===_UI.TapBehavior.toggleSelect}}return{canSelect:!1,canTapSelect:!1}},_setupInternalTree:function(){var item=_Global.document.createElement("div");item.className=_Constants._itemClass,this._captureProxy=_Global.document.createElement("div"),this._itemBox=_Global.document.createElement("div"),this._itemBox.className=_Constants._itemBoxClass;for(var child=this.element.firstChild;child;){var sibling=child.nextSibling;item.appendChild(child),child=sibling}this.element.appendChild(this._itemBox),this._itemBox.appendChild(item),this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==_UI.TapBehavior.none){var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(eventNames.invoked,!0,!1,{}),this.element.dispatchEvent(eventObject)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var defaultItemRole;defaultItemRole=this.tapBehavior===_UI.TapBehavior.none&&this.selectionDisabled?"listitem":"option",_ElementUtilities._setAttribute(this.element,"role",defaultItemRole)}},_writeProfilerMark:function(text){var message="WinJS.UI.ItemContainer:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return _Base.Class.mix(ItemContainer,_Control.DOMEventMixin),ItemContainer}),_SingleItemSelectionManager:_Base.Namespace._lazy(function(){return _Base.Class.define(function(element,itemBox){this._selected=!1,this._element=element,this._itemBox=itemBox},{selected:{get:function(){return this._selected},set:function(value){value=!!value,this._selected!==value&&this.fireSelectionChanging()&&(this._selected=value,_ItemEventsHandler._ItemEventsHandler.renderSelection(this._itemBox,this._element,value,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventNames.selectionchanging,!0,!0,{}),this._element.dispatchEvent(eventObject)},fireSelectionChanged:function(){var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(eventNames.selectionchanged,!0,!1,{}),this._element.dispatchEvent(eventObject)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX}}})})})}),define("WinJS/Controls/Repeater",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../BindingList","../BindingTemplate","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable"],function(exports,_Global,_Base,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,BindingList,BindingTemplate,Promise,_Control,_Dispose,_ElementUtilities,_Hoverable){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Repeater:_Base.Namespace._lazy(function(){function stringifyItem(dataItem){var itemElement=_Global.document.createElement("div");return itemElement.textContent=JSON.stringify(dataItem),itemElement}var ITEMSLOADED="itemsloaded",ITEMCHANGING="itemchanging",ITEMCHANGED="itemchanged",ITEMINSERTING="iteminserting",ITEMINSERTED="iteminserted",ITEMMOVING="itemmoving",ITEMMOVED="itemmoved",ITEMREMOVING="itemremoving",ITEMREMOVED="itemremoved",ITEMSRELOADING="itemsreloading",ITEMSRELOADED="itemsreloaded",createEvent=_Events._createEventProperty,strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get asynchronousRender(){return"Top level items must render synchronously"},get repeaterReentrancy(){return"Cannot modify Repeater data until Repeater has commited previous modification."}},Repeater=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.Repeater.DuplicateConstruction",strings.duplicateConstruction);this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),options=options||{},_ElementUtilities.addClass(this._element,"win-repeater win-disposable"),this._render=null,this._modifying=!1,this._disposed=!1,this._element.winControl=this,this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var inlineTemplate=this._extractInlineTemplate();this._initializing=!0,this.template=options.template||inlineTemplate,this.data=options.data,this._initializing=!1,_Control._setOptions(this,options,!0),this._repeatedDOM=[],this._renderAllItems(),this.dispatchEvent(ITEMSLOADED,{}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(data){this._writeProfilerMark("data.set,StartTM"),this._data&&this._removeDataListeners(),this._data=data||new BindingList.List,this._addDataListeners(),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(ITEMSLOADED,{})),this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(template){this._writeProfilerMark("template.set,StartTM"),this._template=template||stringifyItem,this._render=_ElementUtilities._syncRenderer(this._template,this.element.tagName),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(ITEMSLOADED,{})),this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(index){return this._repeatedDOM[index]},dispose:function(){if(!this._disposed){this._disposed=!0,this._removeDataListeners(),this._data=null,this._template=null;for(var i=0,len=this._repeatedDOM.length;len>i;i++)_Dispose._disposeElement(this._repeatedDOM[i])}},onitemsloaded:createEvent(ITEMSLOADED),onitemchanging:createEvent(ITEMCHANGING),onitemchanged:createEvent(ITEMCHANGED),oniteminserting:createEvent(ITEMINSERTING),oniteminserted:createEvent(ITEMINSERTED),onitemmoving:createEvent(ITEMMOVING),onitemmoved:createEvent(ITEMMOVED),onitemremoving:createEvent(ITEMREMOVING),onitemremoved:createEvent(ITEMREMOVED),onitemsreloading:createEvent(ITEMSRELOADING),onitemsreloaded:createEvent(ITEMSRELOADED),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var templateElement=_Global.document.createElement(this._element.tagName);this._element.firstElementChild;)templateElement.appendChild(this._element.firstElementChild);return new BindingTemplate.Template(templateElement,{extractChild:!0})}},_renderAllItems:function(){for(var fragment=_Global.document.createDocumentFragment(),i=0,len=this._data.length;len>i;i++){var renderedItem=this._render(this._data.getAt(i));if(!renderedItem)throw new _ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",strings.asynchronousRender);fragment.appendChild(renderedItem),this._repeatedDOM.push(renderedItem)}this._element.appendChild(fragment)},_reloadRepeater:function(shouldDisposeElements){this._unloadRepeatedDOM(shouldDisposeElements),this._repeatedDOM=[],this._renderAllItems()},_unloadRepeatedDOM:function(shouldDisposeElements){for(var i=0,len=this._repeatedDOM.length;len>i;i++){var element=this._repeatedDOM[i];shouldDisposeElements&&_Dispose._disposeElement(element),element.parentElement===this._element&&this._element.removeChild(element)}},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(eventName){
this._data.addEventListener(eventName,this._dataListeners[eventName],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new _ErrorFromName("WinJS.UI.Repeater.RepeaterModificationReentrancy",strings.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(eventName){this._data.removeEventListener(eventName,this._dataListeners[eventName],!1)}.bind(this))},_dataItemChangedHandler:function(eventInfo){this._beginModification();var animationPromise,root=this._element,index=eventInfo.detail.index,renderedItem=this._render(eventInfo.detail.newValue);if(!renderedItem)throw new _ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",strings.asynchronousRender);this._repeatedDOM[index]&&(eventInfo.detail.oldElement=this._repeatedDOM[index]),eventInfo.detail.newElement=renderedItem,eventInfo.detail.setPromise=function(delayPromise){animationPromise=delayPromise},this._writeProfilerMark(ITEMCHANGING+",info"),this.dispatchEvent(ITEMCHANGING,eventInfo.detail);var oldItem=null;index<this._repeatedDOM.length?(oldItem=this._repeatedDOM[index],root.replaceChild(renderedItem,oldItem),this._repeatedDOM[index]=renderedItem):(root.appendChild(renderedItem),this._repeatedDOM.push(renderedItem)),this._endModification(),this._writeProfilerMark(ITEMCHANGED+",info"),this.dispatchEvent(ITEMCHANGED,eventInfo.detail),oldItem&&Promise.as(animationPromise).done(function(){_Dispose._disposeElement(oldItem)}.bind(this))},_dataItemInsertedHandler:function(eventInfo){this._beginModification();var index=eventInfo.detail.index,renderedItem=this._render(eventInfo.detail.value);if(!renderedItem)throw new _ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",strings.asynchronousRender);var root=this._element;if(eventInfo.detail.affectedElement=renderedItem,this._writeProfilerMark(ITEMINSERTING+",info"),this.dispatchEvent(ITEMINSERTING,eventInfo.detail),index<this._repeatedDOM.length){var nextSibling=this._repeatedDOM[index];root.insertBefore(renderedItem,nextSibling)}else root.appendChild(renderedItem);this._repeatedDOM.splice(index,0,renderedItem),this._endModification(),this._writeProfilerMark(ITEMINSERTED+",info"),this.dispatchEvent(ITEMINSERTED,eventInfo.detail)},_dataItemMovedHandler:function(eventInfo){this._beginModification();var movingItem=this._repeatedDOM[eventInfo.detail.oldIndex];if(eventInfo.detail.affectedElement=movingItem,this._writeProfilerMark(ITEMMOVING+",info"),this.dispatchEvent(ITEMMOVING,eventInfo.detail),this._repeatedDOM.splice(eventInfo.detail.oldIndex,1)[0],movingItem.parentNode.removeChild(movingItem),eventInfo.detail.newIndex<this._data.length-1){var nextSibling=this._repeatedDOM[eventInfo.detail.newIndex];this._element.insertBefore(movingItem,nextSibling),this._repeatedDOM.splice(eventInfo.detail.newIndex,0,movingItem)}else this._repeatedDOM.push(movingItem),this._element.appendChild(movingItem);this._endModification(),this._writeProfilerMark(ITEMMOVED+",info"),this.dispatchEvent(ITEMMOVED,eventInfo.detail)},_dataItemRemovedHandler:function(eventInfo){this._beginModification();var animationPromise,oldItem=this._repeatedDOM[eventInfo.detail.index],eventDetail={affectedElement:oldItem,index:eventInfo.detail.index,item:eventInfo.detail.item};eventDetail.setPromise=function(delayPromise){animationPromise=delayPromise},this._writeProfilerMark(ITEMREMOVING+",info"),this.dispatchEvent(ITEMREMOVING,eventDetail),oldItem.parentNode.removeChild(oldItem),this._repeatedDOM.splice(eventInfo.detail.index,1),this._endModification(),this._writeProfilerMark(ITEMREMOVED+",info"),this.dispatchEvent(ITEMREMOVED,eventDetail),Promise.as(animationPromise).done(function(){_Dispose._disposeElement(oldItem)}.bind(this))},_dataReloadHandler:function(){this._beginModification();var animationPromise,shallowCopyBefore=this._repeatedDOM.slice(0),eventDetail={affectedElements:shallowCopyBefore};eventDetail.setPromise=function(delayPromise){animationPromise=delayPromise},this._writeProfilerMark(ITEMSRELOADING+",info"),this.dispatchEvent(ITEMSRELOADING,eventDetail),this._reloadRepeater(!1);var shallowCopyAfter=this._repeatedDOM.slice(0);this._endModification(),this._writeProfilerMark(ITEMSRELOADED+",info"),this.dispatchEvent(ITEMSRELOADED,{affectedElements:shallowCopyAfter}),Promise.as(animationPromise).done(function(){for(var i=0,len=shallowCopyBefore.length;len>i;i++)_Dispose._disposeElement(shallowCopyBefore[i])}.bind(this))},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.Repeater:"+this._id+":"+text)}},{isDeclarativeControlContainer:!0});return _Base.Class.mix(Repeater,_Control.DOMEventMixin),Repeater})})}),define("require-style!less/styles-datetimepicker",[],function(){}),define("WinJS/Controls/DatePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/styles-datetimepicker"],function(_Global,_WinRT,_Base,_BaseUtils,_Events,_Resources,_Control,_ElementUtilities,_Hoverable,_Select){"use strict";_Base.Namespace.define("WinJS.UI",{DatePicker:_Base.Namespace._lazy(function(){function newFormatter(pattern,calendar,defaultPattern){var dtf=_WinRT.Windows.Globalization.DateTimeFormatting;pattern=pattern?pattern:defaultPattern;var c=new dtf.DateTimeFormatter(pattern);return calendar?new dtf.DateTimeFormatter(pattern,c.languages,c.geographicRegion,calendar,c.clock):c}function formatCacheLookup(pattern,calendar,defaultPattern){var pat=yearFormatCache[pattern];pat||(pat=yearFormatCache[pattern]={});var cal=pat[calendar];cal||(cal=pat[calendar]={});var def=cal[defaultPattern];return def||(def=cal[defaultPattern]={},def.formatter=newFormatter(pattern,calendar,defaultPattern),def.years={}),def}function formatYear(pattern,calendar,defaultPattern,datePatterns,order,cal){var cache=formatCacheLookup(pattern,calendar,defaultPattern),y=cache.years[cal.year+"-"+cal.era];return y||(y=cache.formatter.format(cal.getDateTime()),cache.years[cal.year+"-"+cal.era]=y),y}function formatMonth(pattern,calendar,defaultPattern,cal){var cache=formatCacheLookup(pattern,calendar,defaultPattern);return cache.formatter.format(cal.getDateTime())}function formatDay(pattern,calendar,defaultPattern,cal){var cache=formatCacheLookup(pattern,calendar,defaultPattern);return cache.formatter.format(cal.getDateTime())}function newCal(calendar){var glob=_WinRT.Windows.Globalization,c=new glob.Calendar;return calendar?new glob.Calendar(c.languages,calendar,c.getClock()):c}function yearDiff(start,end){var yearCount=0;if(start.era===end.era)yearCount=end.year-start.year;else for(;start.era!==end.era||start.year!==end.year;)yearCount++,start.addYears(1);return yearCount}var DEFAULT_DAY_PATTERN="day",DEFAULT_MONTH_PATTERN="{month.full}",DEFAULT_YEAR_PATTERN="year.full",strings={get ariaLabel(){return _Resources._getWinJSString("ui/datePicker").value},get selectDay(){return _Resources._getWinJSString("ui/selectDay").value},get selectMonth(){return _Resources._getWinJSString("ui/selectMonth").value},get selectYear(){return _Resources._getWinJSString("ui/selectYear").value}},yearFormatCache={},DatePicker=_Base.Class.define(function(element,options){this._currentDate=new Date,this._minYear=this._currentDate.getFullYear()-100,this._maxYear=this._currentDate.getFullYear()+100,this._datePatterns={date:null,month:null,year:null},element=element||_Global.document.createElement("div"),_ElementUtilities.addClass(element,"win-disposable"),element.winControl=this;var label=element.getAttribute("aria-label");label||element.setAttribute("aria-label",strings.ariaLabel),this._init(element),_Control.setOptions(this,options)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._dateElement.setAttribute("aria-label",strings.selectDay),this._monthElement.setAttribute("aria-label",strings.selectMonth),this._yearElement.setAttribute("aria-label",strings.selectYear)},_addControlsInOrder:function(){var e=this._domElement,that=this,orderIndex=0;that._information.order.forEach(function(s){switch(s){case"month":e.appendChild(that._monthElement),_ElementUtilities.addClass(that._monthElement,"win-order"+orderIndex++);break;case"date":e.appendChild(that._dateElement),_ElementUtilities.addClass(that._dateElement,"win-order"+orderIndex++);break;case"year":e.appendChild(that._yearElement),_ElementUtilities.addClass(that._yearElement,"win-order"+orderIndex++)}})},_createControlElements:function(){this._monthElement=_Global.document.createElement("select"),this._monthElement.className="win-datepicker-month win-dropdown",this._dateElement=_Global.document.createElement("select"),this._dateElement.className="win-datepicker-date win-dropdown",this._yearElement=_Global.document.createElement("select"),this._yearElement.className="win-datepicker-year win-dropdown"},_createControls:function(){var info=this._information,index=info.getIndex(this.current);info.forceLanguage&&(this._domElement.setAttribute("lang",info.forceLanguage),this._domElement.setAttribute("dir",info.isRTL?"rtl":"ltr")),this._yearControl=new _Select._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:index.year}),this._monthControl=new _Select._Select(this._monthElement,{dataSource:this._information.months(index.year),disabled:this.disabled,index:index.month}),this._dateControl=new _Select._Select(this._dateElement,{dataSource:this._information.dates(index.year,index.month),disabled:this.disabled,index:index.date}),this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(value){this._calendar=value,this._setElement(this._domElement)}},current:{get:function(){var d=this._currentDate,y=d.getFullYear();return new Date(Math.max(Math.min(this.maxYear,y),this.minYear),d.getMonth(),d.getDate(),12,0,0,0)},set:function(value){var newDate;"string"==typeof value?(newDate=new Date(Date.parse(value)),newDate.setHours(12,0,0,0)):newDate=value;var oldDate=this._currentDate;oldDate!==newDate&&(this._currentDate=newDate,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(value){this._disabled!==value&&(this._disabled=value,this._yearControl&&(this._monthControl.setDisabled(value),this._dateControl.setDisabled(value),this._yearControl.setDisabled(value)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(value){this._datePatterns.date!==value&&(this._datePatterns.date=value,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(element){this._domElement=this._domElement||element,this._domElement&&(_ElementUtilities.empty(this._domElement),_ElementUtilities.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(value){this._minYear!==value&&(this._minYear=value,value>this._maxYear&&(this._maxYear=value),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var index={year:this._information.years.getLength()-1};return index.month=this._information.months(index.year).getLength()-1,index.date=this._information.dates(index.year,index.month).getLength()-1,this._information.getDate(index).getFullYear()},set:function(value){this._maxYear!==value&&(this._maxYear=value,value<this._minYear&&(this._minYear=value),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(value){this._datePatterns.month!==value&&(this._datePatterns.month=value,this._init())}},_updateInformation:function(){var min=new Date(this._minYear,0,1,12,0,0),max=new Date(this._maxYear,11,31,12,0,0);min.setFullYear(this._minYear),max.setFullYear(this._maxYear),this._information=DatePicker.getInformation(min,max,this._calendar,this._datePatterns)},_init:function(element){this._setElement(element)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var index=this._information.getIndex(this.current);this._yearControl.index=index.year,this._monthControl.dataSource=this._information.months(index.year),this._monthControl.index=index.month,this._dateControl.dataSource=this._information.dates(index.year,index.month),this._dateControl.index=index.date}},_wireupEvents:function(){function changed(){that._currentDate=that._information.getDate({year:that._yearControl.index,month:that._monthControl.index,date:that._dateControl.index},that._currentDate);var index=that._information.getIndex(that._currentDate);that._monthControl.dataSource=that._information.months(index.year),that._monthControl.index=index.month,that._dateControl.dataSource=that._information.dates(index.year,index.month),that._dateControl.index=index.date}var that=this;this._dateElement.addEventListener("change",changed,!1),this._monthElement.addEventListener("change",changed,!1),this._yearElement.addEventListener("change",changed,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(value){this._datePatterns.year!==value&&(this._datePatterns.year=value,this._init())}}},{_getInformationWinRT:function(startDate,endDate,calendar,datePatterns){function clamp(date){return new Date(Math.min(new Date(Math.max(minDateTime,date)),maxDateTime))}datePatterns=datePatterns||{date:DEFAULT_DAY_PATTERN,month:DEFAULT_MONTH_PATTERN,year:DEFAULT_YEAR_PATTERN};var tempCal=newCal(calendar),monthCal=newCal(calendar),dayCal=newCal(calendar);tempCal.setToMin();var minDateTime=tempCal.getDateTime();tempCal.setToMax();var maxDateTime=tempCal.getDateTime();tempCal.hour=12,startDate=clamp(startDate),endDate=clamp(endDate),tempCal.setDateTime(endDate);var end={year:tempCal.year,era:tempCal.era};tempCal.setDateTime(startDate);var yearLen=0;yearLen=yearDiff(tempCal,end)+1;var dateformat=formatCacheLookup("day month.full year",calendar).formatter,localdatepattern=dateformat.patterns[0],isRTL=8207===localdatepattern.charCodeAt(0),order=["date","month","year"],indexes={month:localdatepattern.indexOf("{month"),date:localdatepattern.indexOf("{day"),year:localdatepattern.indexOf("{year")};order.sort(function(a,b){return indexes[a]<indexes[b]?-1:indexes[a]>indexes[b]?1:0});var yearSource=function(){return{getLength:function(){return yearLen},getValue:function(index){return tempCal.setDateTime(startDate),tempCal.addYears(index),formatYear(datePatterns.year,calendar,DEFAULT_YEAR_PATTERN,datePatterns,order,tempCal)}}}(),monthSource=function(yearIndex){return monthCal.setDateTime(startDate),monthCal.addYears(yearIndex),{getLength:function(){return monthCal.numberOfMonthsInThisYear},getValue:function(index){return monthCal.month=monthCal.firstMonthInThisYear,monthCal.addMonths(index),formatMonth(datePatterns.month,calendar,DEFAULT_MONTH_PATTERN,monthCal)}}},dateSource=function(yearIndex,monthIndex){return dayCal.setDateTime(startDate),dayCal.addYears(yearIndex),dayCal.month=dayCal.firstMonthInThisYear,dayCal.addMonths(monthIndex),dayCal.day=dayCal.firstDayInThisMonth,{getLength:function(){return dayCal.numberOfDaysInThisMonth},getValue:function(index){return dayCal.day=dayCal.firstDayInThisMonth,dayCal.addDays(index),formatDay(datePatterns.date,calendar,DEFAULT_DAY_PATTERN,dayCal)}}};return{isRTL:isRTL,forceLanguage:dateformat.resolvedLanguage,order:order,getDate:function(index,lastDate){var lastCal;lastDate&&(tempCal.setDateTime(lastDate),lastCal={year:tempCal.year,month:tempCal.month,day:tempCal.day});var c=tempCal;c.setDateTime(startDate),c.addYears(index.year);var guessMonth;c.firstMonthInThisYear>c.lastMonthInThisYear?(guessMonth=index.month+c.firstMonthInThisYear>c.numberOfMonthsInThisYear?index.month+c.firstMonthInThisYear-c.numberOfMonthsInThisYear:index.month+c.firstMonthInThisYear,lastCal&&lastCal.year!==c.year&&(guessMonth=Math.max(Math.min(lastCal.month,c.numberOfMonthsInThisYear),1))):guessMonth=lastCal&&lastCal.year!==c.year?Math.max(Math.min(lastCal.month,c.firstMonthInThisYear+c.numberOfMonthsInThisYear-1),c.firstMonthInThisYear):Math.max(Math.min(index.month+c.firstMonthInThisYear,c.firstMonthInThisYear+c.numberOfMonthsInThisYear-1),c.firstMonthInThisYear),c.month=guessMonth;var guessDay=Math.max(Math.min(index.date+c.firstDayInThisMonth,c.firstDayInThisMonth+c.numberOfDaysInThisMonth-1),c.firstDayInThisMonth);return!lastCal||lastCal.year===c.year&&lastCal.month===c.month||(guessDay=Math.max(Math.min(lastCal.day,c.firstDayInThisMonth+c.numberOfDaysInThisMonth-1),c.firstDayInThisMonth)),c.day=c.firstDayInThisMonth,c.addDays(guessDay-c.firstDayInThisMonth),c.getDateTime()},getIndex:function(date){var curDate=clamp(date);tempCal.setDateTime(curDate);var cur={year:tempCal.year,era:tempCal.era},yearIndex=0;tempCal.setDateTime(startDate),tempCal.month=1,yearIndex=yearDiff(tempCal,cur),tempCal.setDateTime(curDate);var monthIndex=tempCal.month-tempCal.firstMonthInThisYear;0>monthIndex&&(monthIndex=tempCal.month-tempCal.firstMonthInThisYear+tempCal.numberOfMonthsInThisYear);var dateIndex=tempCal.day-tempCal.firstDayInThisMonth,index={year:yearIndex,month:monthIndex,date:dateIndex};return index},years:yearSource,months:monthSource,dates:dateSource}},_getInformationJS:function(startDate,endDate){var minYear=startDate.getFullYear(),maxYear=endDate.getFullYear(),yearSource={getLength:function(){return Math.max(0,maxYear-minYear+1)},getValue:function(index){return minYear+index}},months=["January","February","March","April","May","June","July","August","September","October","November","December"],monthSource=function(){return{getLength:function(){return months.length},getValue:function(index){return months[index]},getMonthNumber:function(index){return Math.min(index,months.length-1)}}},dateSource=function(yearIndex,monthIndex){var temp=new Date,year=yearSource.getValue(yearIndex),month=monthIndex+1;temp.setFullYear(year,month,0);var maxValue=temp.getDate();return{getLength:function(){return maxValue},getValue:function(index){return""+(index+1)},getDateNumber:function(index){return Math.min(index+1,maxValue)}}};return{order:["month","date","year"],getDate:function(index){return new Date(yearSource.getValue(index.year),monthSource(index.year).getMonthNumber(index.month),dateSource(index.year,index.month).getDateNumber(index.date),12,0)},getIndex:function(date){var yearIndex=0,year=date.getFullYear();yearIndex=minYear>year?0:year>this.maxYear?yearSource.getLength()-1:date.getFullYear()-minYear;var monthIndex=Math.min(date.getMonth(),monthSource(yearIndex).getLength()),dateIndex=Math.min(date.getDate()-1,dateSource(yearIndex,monthIndex).getLength());return{year:yearIndex,month:monthIndex,date:dateIndex}},years:yearSource,months:monthSource,dates:dateSource}}});return _WinRT.Windows.Globalization.Calendar&&_WinRT.Windows.Globalization.DateTimeFormatting?DatePicker.getInformation=DatePicker._getInformationWinRT:DatePicker.getInformation=DatePicker._getInformationJS,_Base.Class.mix(DatePicker,_Events.createEventProperties("change")),_Base.Class.mix(DatePicker,_Control.DOMEventMixin),DatePicker})})}),define("WinJS/Controls/TimePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/styles-datetimepicker"],function(_Global,_WinRT,_Base,_BaseUtils,_Events,_Resources,_Control,_ElementUtilities,_Hoverable,_Select){"use strict";_Base.Namespace.define("WinJS.UI",{TimePicker:_Base.Namespace._lazy(function(){var DEFAULT_MINUTE_PATTERN="{minute.integer(2)}",DEFAULT_HOUR_PATTERN="{hour.integer(1)}",DEFAULT_PERIOD_PATTERN="{period.abbreviated(2)}",strings={get ariaLabel(){return _Resources._getWinJSString("ui/timePicker").value},get selectHour(){return _Resources._getWinJSString("ui/selectHour").value},get selectMinute(){return _Resources._getWinJSString("ui/selectMinute").value},get selectAMPM(){return _Resources._getWinJSString("ui/selectAMPM").value}},areTimesEqual=function(date1,date2){return date1.getHours()===date2.getHours()&&date1.getMinutes()===date2.getMinutes()},TimePicker=_Base.Class.define(function(element,options){this._currentTime=TimePicker._sentinelDate(),element=element||_Global.document.createElement("div"),_ElementUtilities.addClass(element,"win-disposable"),element.winControl=this;var label=element.getAttribute("aria-label");label||element.setAttribute("aria-label",strings.ariaLabel),this._timePatterns={minute:null,hour:null,period:null},this._init(element),_Control.setOptions(this,options)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._hourElement.setAttribute("aria-label",strings.selectHour),this._minuteElement.setAttribute("aria-label",strings.selectMinute),this._ampmElement&&this._ampmElement.setAttribute("aria-label",strings.selectAMPM)},_addControlsInOrder:function(info){var that=this;info.order.forEach(function(s,index){switch(s){case"hour":that._domElement.appendChild(that._hourElement),_ElementUtilities.addClass(that._hourElement,"win-order"+index);break;case"minute":that._domElement.appendChild(that._minuteElement),_ElementUtilities.addClass(that._minuteElement,"win-order"+index);break;case"period":that._ampmElement&&(that._domElement.appendChild(that._ampmElement),_ElementUtilities.addClass(that._ampmElement,"win-order"+index))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(value){this._clock!==value&&(this._clock=value,this._init())}},current:{get:function(){var cur=this._currentTime;if(cur){var time=TimePicker._sentinelDate();return time.setHours(cur.getHours()),time.setMinutes(this._getMinutesIndex(cur)*this.minuteIncrement),time.setSeconds(0),time.setMilliseconds(0),time}return cur},set:function(value){var newTime;"string"==typeof value?(newTime=TimePicker._sentinelDate(),newTime.setTime(Date.parse(newTime.toDateString()+" "+value))):(newTime=TimePicker._sentinelDate(),newTime.setHours(value.getHours()),newTime.setMinutes(value.getMinutes()));var oldTime=this._currentTime;areTimesEqual(oldTime,newTime)||(this._currentTime=newTime,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(value){this._disabled!==value&&(this._disabled=value,this._hourControl&&(this._hourControl.setDisabled(value),this._minuteControl.setDisabled(value)),this._ampmControl&&this._ampmControl.setDisabled(value))}},element:{get:function(){return this._domElement}},_init:function(element){this._setElement(element),this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(value){this._timePatterns.hour!==value&&(this._timePatterns.hour=value,this._init())}},_getHoursAmpm:function(time){var hours24=time.getHours();return this._ampmElement?0===hours24?{hours:12,ampm:0}:12>hours24?{hours:hours24,ampm:0}:{hours:hours24-12,ampm:1}:{hours:hours24}},_getHoursIndex:function(hours){return this._ampmElement&&12===hours?0:hours},_getMinutesIndex:function(time){return parseInt(time.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(value){this._minuteIncrement!==value&&(this._minuteIncrement=value,this._init())}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(value){this._timePatterns.minute!==value&&(this._timePatterns.minute=value,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(value){this._timePatterns.period!==value&&(this._timePatterns.period=value,this._init())}},_setElement:function(element){if(this._domElement=this._domElement||element,this._domElement){var info=TimePicker.getInformation(this.clock,this.minuteIncrement,this._timePatterns);this._information=info,info.forceLanguage&&(this._domElement.setAttribute("lang",info.forceLanguage),this._domElement.setAttribute("dir",info.isRTL?"rtl":"ltr")),_ElementUtilities.empty(this._domElement),_ElementUtilities.addClass(this._domElement,"win-timepicker"),this._hourElement=_Global.document.createElement("select"),_ElementUtilities.addClass(this._hourElement,"win-timepicker-hour win-dropdown"),this._minuteElement=_Global.document.createElement("select"),_ElementUtilities.addClass(this._minuteElement,"win-timepicker-minute win-dropdown"),this._ampmElement=null,"12HourClock"===info.clock&&(this._ampmElement=_Global.document.createElement("select"),_ElementUtilities.addClass(this._ampmElement,"win-timepicker-period win-dropdown")),this._addControlsInOrder(info);var hoursAmpm=this._getHoursAmpm(this.current);this._hourControl=new _Select._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(hoursAmpm.hours)}),this._minuteControl=new _Select._Select(this._minuteElement,{dataSource:info.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new _Select._Select(this._ampmElement,{dataSource:info.periods,disabled:this.disabled,index:hoursAmpm.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes()}},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var hoursAmpm=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=hoursAmpm.ampm),this._hourControl.index=this._getHoursIndex(hoursAmpm.hours),this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var hoursAmpm=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=hoursAmpm.ampm),this._hourControl&&(this._hourControl.index=this._getHoursIndex(hoursAmpm.hours),this._minuteControl.index=this._getMinutesIndex(this.current))},_wireupEvents:function(){var that=this,fixupHour=function(){var hour=that._hourControl.index;return that._ampmElement&&1===that._ampmControl.index&&12!==hour&&(hour+=12),hour},changed=function(){var hour=fixupHour();that._currentTime.setHours(hour),that._currentTime.setMinutes(that._minuteControl.index*that.minuteIncrement)};this._hourElement.addEventListener("change",changed,!1),this._minuteElement.addEventListener("change",changed,!1),this._ampmElement&&this._ampmElement.addEventListener("change",changed,!1)}},{_sentinelDate:function(){var current=new Date;return new Date(2011,6,15,current.getHours(),current.getMinutes())},_getInformationWinRT:function(clock,minuteIncrement,timePatterns){var newFormatter=function(pattern,defaultPattern){var dtf=_WinRT.Windows.Globalization.DateTimeFormatting;pattern=pattern?pattern:defaultPattern;var formatter=new dtf.DateTimeFormatter(pattern);return clock&&(formatter=dtf.DateTimeFormatter(pattern,formatter.languages,formatter.geographicRegion,formatter.calendar,clock)),formatter},glob=_WinRT.Windows.Globalization,calendar=new glob.Calendar;clock&&(calendar=new glob.Calendar(calendar.languages,calendar.getCalendarSystem(),clock)),calendar.setDateTime(TimePicker._sentinelDate());var computedClock=calendar.getClock(),numberOfHours=24;numberOfHours=calendar.numberOfHoursInThisPeriod;var periods=function(){var periodFormatter=newFormatter(timePatterns.period,DEFAULT_PERIOD_PATTERN);return{getLength:function(){return 2},getValue:function(index){var date=TimePicker._sentinelDate();if(0===index){date.setHours(1);var am=periodFormatter.format(date);return am}if(1===index){date.setHours(13);var pm=periodFormatter.format(date);return pm}return null}}}(),minutes=function(){var minuteFormatter=newFormatter(timePatterns.minute,DEFAULT_MINUTE_PATTERN),now=TimePicker._sentinelDate();return{getLength:function(){return 60/minuteIncrement},getValue:function(index){var display=index*minuteIncrement;return now.setMinutes(display),minuteFormatter.format(now)}}}(),hours=function(){var hourFormatter=newFormatter(timePatterns.hour,DEFAULT_HOUR_PATTERN),now=TimePicker._sentinelDate();return{getLength:function(){return numberOfHours},getValue:function(index){return now.setHours(index),hourFormatter.format(now)}}}(),hourMinuteFormatter=newFormatter("hour minute"),pattern=hourMinuteFormatter.patterns[0],order=["hour","minute"],indexes={period:pattern.indexOf("{period"),hour:pattern.indexOf("{hour"),minute:pattern.indexOf("{minute")};indexes.period>-1&&order.push("period");var DateTimeFormatter=_WinRT.Windows.Globalization.DateTimeFormatting.DateTimeFormatter,dtf=new DateTimeFormatter("month.full",_WinRT.Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),pat=dtf.patterns[0],isRTL=8207===pat.charCodeAt(0);if(isRTL){var temp=indexes.hour;indexes.hour=indexes.minute,indexes.minute=temp}return order.sort(function(a,b){return indexes[a]<indexes[b]?-1:indexes[a]>indexes[b]?1:0}),{minutes:minutes,hours:hours,clock:computedClock,periods:periods,order:order,forceLanguage:hourMinuteFormatter.resolvedLanguage,isRTL:isRTL}},_getInformationJS:function(clock,minuteIncrement){var hours=[12,1,2,3,4,5,6,7,8,9,10,11],minutes={};minutes.getLength=function(){return 60/minuteIncrement},minutes.getValue=function(index){var display=index*minuteIncrement;return 10>display?"0"+display.toString():display.toString()};var order=["hour","minute","period"];return"24HourClock"===clock&&(hours=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],order=["hour","minute"]),{minutes:minutes,hours:hours,clock:clock||"12HourClock",periods:["AM","PM"],order:order}}});return _WinRT.Windows.Globalization.DateTimeFormatting&&_WinRT.Windows.Globalization.Calendar&&_WinRT.Windows.Globalization.ApplicationLanguages?TimePicker.getInformation=TimePicker._getInformationWinRT:TimePicker.getInformation=TimePicker._getInformationJS,_Base.Class.mix(TimePicker,_Events.createEventProperties("change")),_Base.Class.mix(TimePicker,_Control.DOMEventMixin),TimePicker})})}),define("require-style!less/styles-backbutton",[],function(){}),define("require-style!less/colors-backbutton",[],function(){}),define("WinJS/Controls/BackButton",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources","../Navigation","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-backbutton","require-style!less/colors-backbutton"],function(exports,_Global,_Base,_ErrorFromName,_Resources,Navigation,_Control,_ElementUtilities,_Hoverable){"use strict";var Key=_ElementUtilities.Key,navigationBackButtonClass="win-navigation-backbutton",glyphClass="win-back",MOUSE_BACK_BUTTON=3,singleton=function(){function hookUpBackButtonGlobalEventHandlers(){_Global.addEventListener("keyup",backButtonGlobalKeyUpHandler,!1),_ElementUtilities._addEventListener(_Global,"pointerup",backButtonGlobalMSPointerUpHandler,!1)}function unHookBackButtonGlobalEventHandlers(){_Global.removeEventListener("keyup",backButtonGlobalKeyUpHandler,!1),_ElementUtilities._removeEventListener(_Global,"pointerup",backButtonGlobalMSPointerUpHandler,!1)}function backButtonGlobalKeyUpHandler(event){(event.keyCode===Key.leftArrow&&event.altKey&&!event.shiftKey&&!event.ctrlKey||event.keyCode===Key.browserBack)&&(Navigation.back(),
event.preventDefault())}function backButtonGlobalMSPointerUpHandler(event){event.button===MOUSE_BACK_BUTTON&&Navigation.back()}var backButtonReferenceCount=0;return{addRef:function(){0===backButtonReferenceCount&&hookUpBackButtonGlobalEventHandlers(),backButtonReferenceCount++},release:function(){backButtonReferenceCount>0&&(backButtonReferenceCount--,0===backButtonReferenceCount&&unHookBackButtonGlobalEventHandlers())},getCount:function(){return backButtonReferenceCount}}}();_Base.Namespace._moduleDefine(exports,"WinJS.UI",{BackButton:_Base.Namespace._lazy(function(){var strings={get ariaLabel(){return _Resources._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},BackButton=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.BackButton.DuplicateConstruction",strings.duplicateConstruction);this._element=element||_Global.document.createElement("button"),options=options||{},this._initializeButton(),this._disposed=!1,this._element.winControl=this,_Control.setOptions(this,options),this._buttonClickHandler=this._handleBackButtonClick.bind(this),this._element.addEventListener("click",this._buttonClickHandler,!1),this._navigatedHandler=this._handleNavigatedEvent.bind(this),Navigation.addEventListener("navigated",this._navigatedHandler,!1),singleton.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,Navigation.removeEventListener("navigated",this._navigatedHandler,!1),singleton.release())},refresh:function(){Navigation.canGoBack?this._element.disabled=!1:this._element.disabled=!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.BackButton.BadButtonElement",strings.badButtonElement);_ElementUtilities.addClass(this._element,navigationBackButtonClass),_ElementUtilities.addClass(this._element,"win-disposable"),this._element.innerHTML='<span class="'+glyphClass+'"></span>',this.refresh(),this._element.setAttribute("aria-label",strings.ariaLabel),this._element.setAttribute("title",strings.ariaLabel),this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){Navigation.back()}});return BackButton._getReferenceCount=function(){return singleton.getCount()},_Base.Class.mix(BackButton,_Control.DOMEventMixin),BackButton})})}),define("require-style!less/styles-tooltip",[],function(){}),define("require-style!less/colors-tooltip",[],function(){}),define("WinJS/Controls/Tooltip",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Animations","../Animations/_TransitionAnimation","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-tooltip","require-style!less/colors-tooltip"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_Events,Animations,_TransitionAnimation,_Control,_Dispose,_ElementUtilities,_Hoverable){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Tooltip:_Base.Namespace._lazy(function(){function isInvokeEvent(eventType,pointerType){return"pointerdown"===eventType?pointerType===PT_TOUCH:eventType in EVENTS_INVOKE}function isDismissEvent(eventType,pointerType){return"pointerdown"===eventType?pointerType!==PT_TOUCH:eventType in EVENTS_DISMISS}var lastCloseTime=0,Key=_ElementUtilities.Key,DEFAULT_PLACEMENT="top",DELAY_INITIAL_TOUCH_SHORT=_TransitionAnimation._animationTimeAdjustment(400),DELAY_INITIAL_TOUCH_LONG=_TransitionAnimation._animationTimeAdjustment(1200),DEFAULT_MOUSE_HOVER_TIME=_TransitionAnimation._animationTimeAdjustment(400),DEFAULT_MESSAGE_DURATION=_TransitionAnimation._animationTimeAdjustment(5e3),DELAY_RESHOW_NONINFOTIP_TOUCH=_TransitionAnimation._animationTimeAdjustment(0),DELAY_RESHOW_NONINFOTIP_NONTOUCH=_TransitionAnimation._animationTimeAdjustment(600),DELAY_RESHOW_INFOTIP_TOUCH=_TransitionAnimation._animationTimeAdjustment(400),DELAY_RESHOW_INFOTIP_NONTOUCH=_TransitionAnimation._animationTimeAdjustment(600),RESHOW_THRESHOLD=_TransitionAnimation._animationTimeAdjustment(200),HIDE_DELAY_MAX=_TransitionAnimation._animationTimeAdjustment(3e5),OFFSET_KEYBOARD=12,OFFSET_MOUSE=20,OFFSET_TOUCH=45,OFFSET_PROGRAMMATIC_TOUCH=20,OFFSET_PROGRAMMATIC_NONTOUCH=12,SAFETY_NET_GAP=1,PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",EVENTS_INVOKE={keyup:"",pointerover:"",pointerdown:""},EVENTS_UPDATE={pointermove:""},EVENTS_DISMISS={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},EVENTS_BY_CHILD={pointerover:"",pointerout:""},msTooltip="win-tooltip",msTooltipPhantom="win-tooltip-phantom",mouseHoverTime=DEFAULT_MOUSE_HOVER_TIME,nonInfoTooltipNonTouchShowDelay=2*mouseHoverTime,infoTooltipNonTouchShowDelay=2.5*mouseHoverTime,messageDuration=DEFAULT_MESSAGE_DURATION,isLeftHanded=!1,hasInitWinRTSettings=!1,createEvent=_Events._createEventProperty;return _Base.Class.define(function(anchorElement,options){anchorElement=anchorElement||_Global.document.createElement("div");var tooltip=_ElementUtilities.data(anchorElement).tooltip;if(tooltip)return tooltip;if(!hasInitWinRTSettings&&_WinRT.Windows.UI.ViewManagement.UISettings){var uiSettings=new _WinRT.Windows.UI.ViewManagement.UISettings;mouseHoverTime=_TransitionAnimation._animationTimeAdjustment(uiSettings.mouseHoverTime),nonInfoTooltipNonTouchShowDelay=2*mouseHoverTime,infoTooltipNonTouchShowDelay=2.5*mouseHoverTime,messageDuration=_TransitionAnimation._animationTimeAdjustment(1e3*uiSettings.messageDuration);var handedness=uiSettings.handPreference;isLeftHanded=handedness===_WinRT.Windows.UI.ViewManagement.HandPreference.leftHanded}hasInitWinRTSettings=!0,this._disposed=!1,this._placement=DEFAULT_PLACEMENT,this._infotip=!1,this._innerHTML=null,this._contentElement=null,this._extraClass=null,this._lastContentType="html",this._anchorElement=anchorElement,this._domElement=null,this._phantomDiv=null,this._triggerByOpen=!1,this._eventListenerRemoveStack=[],this._lastKeyOrBlurEvent=null,this._currentKeyOrBlurEvent=null,anchorElement.winControl=this,_ElementUtilities.addClass(anchorElement,"win-disposable"),anchorElement.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title")),_Control.setOptions(this,options),this._events(),_ElementUtilities.data(anchorElement).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(value){if(this._innerHTML=value,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=value,this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(value){if(this._contentElement=value,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="",this._domElement.appendChild(this._contentElement),this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(value){"top"!==value&&"bottom"!==value&&"left"!==value&&"right"!==value&&(value=DEFAULT_PLACEMENT),this._placement=value,this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(value){this._infotip=!!value}},extraClass:{get:function(){return this._extraClass},set:function(value){this._extraClass=value}},onbeforeopen:createEvent("beforeopen"),onopened:createEvent("opened"),onbeforeclose:createEvent("beforeclose"),onclosed:createEvent("closed"),dispose:function(){if(!this._disposed){this._disposed=!0,_Dispose.disposeSubTree(this.element);for(var i=0,len=this._eventListenerRemoveStack.length;len>i;i++)this._eventListenerRemoveStack[i]();this._onDismiss();var data=_ElementUtilities.data(this._anchorElement);data&&delete data.tooltip}},addEventListener:function(eventName,eventCallBack,capture){if(this._anchorElement){this._anchorElement.addEventListener(eventName,eventCallBack,capture);var that=this;this._eventListenerRemoveStack.push(function(){that._anchorElement.removeEventListener(eventName,eventCallBack,capture)})}},removeEventListener:function(eventName,eventCallBack,capture){this._anchorElement&&this._anchorElement.removeEventListener(eventName,eventCallBack,capture)},open:function(type){switch(this._triggerByOpen=!0,"touch"!==type&&"mouseover"!==type&&"mousedown"!==type&&"keyboard"!==type&&(type="default"),type){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(_Dispose.disposeSubTree(this._domElement),_Global.document.body.removeChild(this._domElement),this._domElement=null,_Global.document.body.removeChild(this._phantomDiv),this._phantomDiv=null)},_createTooltipDOM:function(){this._cleanUpDOM(),this._domElement=_Global.document.createElement("div");var id=_ElementUtilities._uniqueID(this._domElement);this._domElement.setAttribute("id",id);var computedStyle=_ElementUtilities._getComputedStyle(this._anchorElement,null),elemStyle=this._domElement.style;elemStyle.direction=computedStyle.direction,elemStyle.writingMode=computedStyle["writing-mode"],this._domElement.setAttribute("tabindex",-1),this._domElement.setAttribute("role","tooltip"),this._anchorElement.setAttribute("aria-describedby",id),"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML,_Global.document.body.appendChild(this._domElement),_ElementUtilities.addClass(this._domElement,msTooltip),this._extraClass&&_ElementUtilities.addClass(this._domElement,this._extraClass),this._phantomDiv=_Global.document.createElement("div"),this._phantomDiv.setAttribute("tabindex",-1),_Global.document.body.appendChild(this._phantomDiv),_ElementUtilities.addClass(this._phantomDiv,msTooltipPhantom);var zIndex=_ElementUtilities._getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=zIndex},_raiseEvent:function(type,eventProperties){if(this._anchorElement){var customEvent=_Global.document.createEvent("CustomEvent");customEvent.initCustomEvent(type,!1,!1,eventProperties),this._anchorElement.dispatchEvent(customEvent)}},_captureLastKeyBlurOrPointerOverEvent:function(event){switch(this._lastKeyOrBlurEvent=this._currentKeyOrBlurEvent,event.type){case"keyup":event.keyCode===Key.shift?this._currentKeyOrBlurEvent=null:this._currentKeyOrBlurEvent="keyboard";break;case"focusout":this._currentKeyOrBlurEvent=null}},_registerEventToListener:function(element,eventType){var that=this,handler=function(event){that._captureLastKeyBlurOrPointerOverEvent(event),that._handleEvent(event)};_ElementUtilities._addEventListener(element,eventType,handler,!1),this._eventListenerRemoveStack.push(function(){_ElementUtilities._removeEventListener(element,eventType,handler,!1)})},_events:function(){for(var eventType in EVENTS_INVOKE)this._registerEventToListener(this._anchorElement,eventType);for(var eventType in EVENTS_UPDATE)this._registerEventToListener(this._anchorElement,eventType);for(eventType in EVENTS_DISMISS)this._registerEventToListener(this._anchorElement,eventType);this._registerEventToListener(this._anchorElement,"contextmenu"),this._registerEventToListener(this._anchorElement,"MSHoldVisual")},_handleEvent:function(event){var eventType=event._normalizedType||event.type;if(!this._triggerByOpen){if(eventType in EVENTS_BY_CHILD&&_ElementUtilities.eventWithinElement(this._anchorElement,event))return;if(isInvokeEvent(eventType,event.pointerType))if(event.pointerType===PT_TOUCH)this._isShown||(this._showTrigger="touch"),this._onInvoke("touch","never",event);else{if(this._skipMouseOver&&event.pointerType===PT_MOUSE&&"pointerover"===eventType)return void(this._skipMouseOver=!1);var type="key"===eventType.substring(0,3)?"keyboard":"mouse";this._isShown||(this._showTrigger=type),this._onInvoke(type,"auto",event)}else if(eventType in EVENTS_UPDATE)this._contactPoint={x:event.clientX,y:event.clientY};else if(isDismissEvent(eventType,event.pointerType)){var eventTrigger;if(event.pointerType===PT_TOUCH){if("pointerup"===eventType){this._skipMouseOver=!0;var that=this;_BaseUtils._yieldForEvents(function(){that._skipMouseOver=!1})}eventTrigger="touch"}else eventTrigger="key"===eventType.substring(0,3)?"keyboard":"mouse";if("focusout"!==eventType&&eventTrigger!==this._showTrigger)return;this._onDismiss()}else("contextmenu"===eventType||"MSHoldVisual"===eventType)&&event.preventDefault()}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var that=this,delay=this._infotip?Math.min(3*messageDuration,HIDE_DELAY_MAX):messageDuration;this._hideDelayTimer=this._setTimeout(function(){that._onDismiss()},delay)}},_onHideAnimationEnd:function(){_Global.document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._cleanUpDOM(),this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby"),lastCloseTime=(new Date).getTime(),this._triggerByOpen=!1,this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(type){var value;if(this._useAnimation=!0,"nodelay"===type)value=0,this._useAnimation=!1;else{var curTime=(new Date).getTime();RESHOW_THRESHOLD>=curTime-lastCloseTime?(value="touch"===type?this._infotip?DELAY_RESHOW_INFOTIP_TOUCH:DELAY_RESHOW_NONINFOTIP_TOUCH:this._infotip?DELAY_RESHOW_INFOTIP_NONTOUCH:DELAY_RESHOW_NONINFOTIP_NONTOUCH,this._useAnimation=!1):value="touch"===type?this._infotip?DELAY_INITIAL_TOUCH_LONG:DELAY_INITIAL_TOUCH_SHORT:this._infotip?infoTooltipNonTouchShowDelay:nonInfoTooltipNonTouchShowDelay}return value},_getAnchorPositionFromElementWindowCoord:function(){var rect=this._anchorElement.getBoundingClientRect();return{x:rect.left,y:rect.top,width:rect.width,height:rect.height}},_getAnchorPositionFromPointerWindowCoord:function(contactPoint){return{x:contactPoint.x,y:contactPoint.y,width:1,height:1}},_canPositionOnSide:function(placement,viewport,anchor,tip){var availWidth=0,availHeight=0;switch(placement){case"top":availWidth=tip.width+this._offset,availHeight=anchor.y;break;case"bottom":availWidth=tip.width+this._offset,availHeight=viewport.height-anchor.y-anchor.height;break;case"left":availWidth=anchor.x,availHeight=tip.height+this._offset;break;case"right":availWidth=viewport.width-anchor.x-anchor.width,availHeight=tip.height+this._offset}return availWidth>=tip.width+this._offset&&availHeight>=tip.height+this._offset},_positionOnSide:function(placement,viewport,anchor,tip){var left=0,top=0;switch(placement){case"top":case"bottom":left=anchor.x+anchor.width/2-tip.width/2,left=Math.min(Math.max(left,0),viewport.width-tip.width-SAFETY_NET_GAP),top="top"===placement?anchor.y-tip.height-this._offset:anchor.y+anchor.height+this._offset;break;case"left":case"right":top=anchor.y+anchor.height/2-tip.height/2,top=Math.min(Math.max(top,0),viewport.height-tip.height-SAFETY_NET_GAP),left="left"===placement?anchor.x-tip.width-this._offset:anchor.x+anchor.width+this._offset}this._domElement.style.left=left+"px",this._domElement.style.top=top+"px",this._phantomDiv.style.left=left+"px",this._phantomDiv.style.top=top+"px",this._phantomDiv.style.width=tip.width+"px",this._phantomDiv.style.height=tip.height+"px"},_position:function(contactType){var viewport={width:0,height:0},anchor={x:0,y:0,width:0,height:0},tip={width:0,height:0};viewport.width=_Global.document.documentElement.clientWidth,viewport.height=_Global.document.documentElement.clientHeight,"tb-rl"===_ElementUtilities._getComputedStyle(_Global.document.body,null)["writing-mode"]&&(viewport.width=_Global.document.documentElement.clientHeight,viewport.height=_Global.document.documentElement.clientWidth),anchor=!this._contactPoint||"touch"!==contactType&&"mouse"!==contactType?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint),tip.width=this._domElement.offsetWidth,tip.height=this._domElement.offsetHeight;var fallback_order={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};isLeftHanded&&(fallback_order.top[2]="right",fallback_order.top[3]="left",fallback_order.bottom[2]="right",fallback_order.bottom[3]="left");for(var order=fallback_order[this._placement],length=order.length,i=0;length>i;i++)if(i===length-1||this._canPositionOnSide(order[i],viewport,anchor,tip)){this._positionOnSide(order[i],viewport,anchor,tip);break}return order[i]},_showTooltip:function(contactType){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),_Global.document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var that=this;this._removeTooltip=function(event){for(var current=that._anchorElement;current;){if(event.target===current){_Global.document.body.removeEventListener("DOMNodeRemoved",that._removeTooltip,!1),that._cleanUpDOM();break}current=current.parentNode}},_Global.document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._createTooltipDOM(),this._position(contactType),this._useAnimation?Animations.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(type,hide,event){if(this._shouldDismiss=!1,!this._isShown&&(!event||"keyup"!==event.type||"keyboard"!==this._lastKeyOrBlurEvent&&(this._lastKeyOrBlurEvent||event.keyCode===Key.tab))){this._hideDelay=hide,this._contactPoint=null,event?(this._contactPoint={x:event.clientX,y:event.clientY},"touch"===type?this._offset=OFFSET_TOUCH:"keyboard"===type?this._offset=OFFSET_KEYBOARD:this._offset=OFFSET_MOUSE):"touch"===type?this._offset=OFFSET_PROGRAMMATIC_TOUCH:this._offset=OFFSET_PROGRAMMATIC_NONTOUCH,this._clearTimeout(this._delayTimer),this._clearTimeout(this._hideDelayTimer);var delay=this._decideOnDelay(type);if(delay>0){var that=this;this._delayTimer=this._setTimeout(function(){that._showTooltip(type)},delay)}else this._showTooltip(type)}},_onDismiss:function(){this._shouldDismiss=!0,this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?Animations.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))},_setTimeout:function(callback,delay){return _Global.setTimeout(callback,delay)},_clearTimeout:function(id){_Global.clearTimeout(id)}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return DELAY_INITIAL_TOUCH_SHORT}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return DELAY_INITIAL_TOUCH_LONG}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return DEFAULT_MOUSE_HOVER_TIME}},_DEFAULT_MESSAGE_DURATION:{get:function(){return DEFAULT_MESSAGE_DURATION}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return DELAY_RESHOW_NONINFOTIP_TOUCH}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return DELAY_RESHOW_NONINFOTIP_NONTOUCH}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return DELAY_RESHOW_INFOTIP_TOUCH}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return DELAY_RESHOW_INFOTIP_NONTOUCH}},_RESHOW_THRESHOLD:{get:function(){return RESHOW_THRESHOLD}},_HIDE_DELAY_MAX:{get:function(){return HIDE_DELAY_MAX}}})})})}),define("require-style!less/styles-rating",[],function(){}),define("require-style!less/colors-rating",[],function(){}),define("WinJS/Controls/Rating",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_SafeHtml","./Tooltip","require-style!less/styles-rating","require-style!less/colors-rating"],function(_Global,_Base,_ErrorFromName,_Events,_Resources,_Accents,_Control,_ElementUtilities,_Hoverable,_SafeHtml,Tooltip){"use strict";_Accents.createAccentRule(".win-rating .win-star.win-user.win-full, .win-rating .win-star.win-user.win-full.win-disabled",[{name:"color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{Rating:_Base.Namespace._lazy(function(){var createEvent=_Events._createEventProperty,strings={get averageRating(){return _Resources._getWinJSString("ui/averageRating").value},get clearYourRating(){return _Resources._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return _Resources._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return"Invalid argument: tooltipStrings must be null or an array of strings."},get unrated(){return _Resources._getWinJSString("ui/unrated").value},get userRating(){return _Resources._getWinJSString("ui/userRating").value}},DEFAULT_MAX_RATING=5,DEFAULT_DISABLED=!1,CANCEL="cancel",CHANGE="change",PREVIEW_CHANGE="previewchange",MOUSE_LBUTTON=0,PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",PT_PEN=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",hiddenAverageRatingCss="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; -webkit-flex: none; flex: none; display: none",msRating="win-rating",msRatingEmpty="win-star win-empty",msRatingAverageEmpty="win-star win-average win-empty",msRatingAverageFull="win-star win-average win-full",msRatingUserEmpty="win-star win-user win-empty",msRatingUserFull="win-star win-user win-full",msRatingTentativeEmpty="win-star win-tentative win-empty",msRatingTentativeFull="win-star win-tentative win-full",msRatingDisabled="win-disabled",msAverage="win-average",msUser="win-user";return _Base.Class.define(function(element,options){this._disposed=!1,element=element||_Global.document.createElement("div"),options=options||{},this._element=element,_ElementUtilities.addClass(this._element,"win-disposable"),this._userRating=0,this._averageRating=0,this._disabled=DEFAULT_DISABLED,this._enableClear=!0,this._tooltipStrings=[],this._controlUpdateNeeded=!1,this._setControlSize(options.maxRating),options.tooltipStrings||this._updateTooltips(null),_Control.setOptions(this,options),this._controlUpdateNeeded=!0,this._forceLayout(),_ElementUtilities._addInsertedNotifier(this._element),element.winControl=this,this._events()},{maxRating:{get:function(){return this._maxRating},set:function(value){this._setControlSize(value),this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(value){this._userRating=Math.max(0,Math.min(Number(value)>>0,this._maxRating)),this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(value){this._averageRating=Number(value)<1?0:Math.min(Number(value)||0,this._maxRating),this._averageRatingElement&&this._ensureAverageMSStarRating(),this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(value){this._disabled=!!value,this._disabled&&this._clearTooltips(),this._updateTabIndex(),this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(value){this._enableClear=!!value,this._setAriaValueMin(),this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(value){if("object"!=typeof value)throw new _ErrorFromName("WinJS.UI.Rating.TooltipStringsIsInvalid",strings.tooltipStringsIsInvalid);this._updateTooltips(value),this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:createEvent(CANCEL),onchange:createEvent(CHANGE),onpreviewchange:createEvent(PREVIEW_CHANGE),dispose:function(){if(!this._disposed){this._disposed=!0;for(var i=0;i<this._toolTips.length;i++)this._toolTips[i].dispose();this._toolTips=null}},addEventListener:function(eventName,eventCallBack,capture){this._element.addEventListener(eventName,eventCallBack,capture)},removeEventListener:function(eventName,eventCallBack,capture){return this._element.removeEventListener(eventName,eventCallBack,capture)},_forceLayout:function(){if(this._controlUpdateNeeded){var updateNeeded=!1;this._updateControl=function(){updateNeeded=!0},this.userRating=this._userRating,this.averageRating=this._averageRating,this._lastEventWasChange=!1,this._lastEventWasCancel=!1,this._tentativeRating=-1,this._captured=!1,this._pointerDownFocus=!1,this._elements=[],this._toolTips=[],this._clearElement=null,this._averageRatingElement=null,this._elementWidth=null,this._elementPadding=null,this._elementBorder=null,this._floatingValue=0,this._createControl(),this._setAccessibilityProperties(),delete this._updateControl,updateNeeded&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=hiddenAverageRatingCss)},_createControl:function(){_ElementUtilities.addClass(this._element,msRating);var html="";this._averageRatingHidden=!0;for(var i=0;i<=this._maxRating;i++)html=i===this._maxRating?html+"<div class='"+msRatingAverageFull+"' style='"+hiddenAverageRatingCss+"'></div>":html+"<div class='"+msRatingUserEmpty+"'></div>";_SafeHtml.setInnerHTMLUnsafe(this._element,html);for(var oneStar=this._element.firstElementChild,i=0;oneStar;)this._elements[i]=oneStar,i<this._maxRating&&(_ElementUtilities.data(oneStar).msStarRating=i+1),oneStar=oneStar.nextElementSibling,i++;this._averageRatingElement=this._elements[this._maxRating],this._ensureAverageMSStarRating(),this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider"),this._element.setAttribute("aria-valuemax",this._maxRating),this._setAriaValueMin(),this._updateAccessibilityRestState()},_getText:function(number){var string=this._tooltipStrings[number];if(string){var tempDiv=_Global.document.createElement("div");return tempDiv.innerHTML=string,tempDiv.textContent}return number===this._maxRating?strings.clearYourRating:number+1},_updateAccessibilityRestState:function(){var element=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),element.setAttribute("aria-readOnly",this._disabled),0!==this._userRating?(element.setAttribute("aria-valuenow",this._userRating),element.setAttribute("aria-label",strings.userRating),element.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(element.setAttribute("aria-valuenow",this._averageRating),element.setAttribute("aria-label",strings.averageRating),element.setAttribute("aria-valuetext",this._averageRating)):(element.setAttribute("aria-valuenow",strings.unrated),element.setAttribute("aria-label",strings.userRating),element.setAttribute("aria-valuetext",strings.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var element=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),element.setAttribute("aria-readOnly",this._disabled),this._tentativeRating>0?(element.setAttribute("aria-label",strings.tentativeRating),element.setAttribute("aria-valuenow",this._tentativeRating),element.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(element.setAttribute("aria-valuenow",strings.unrated),element.setAttribute("aria-label",strings.tentativeRating),element.setAttribute("aria-valuetext",this._getText(this._maxRating))):(element.setAttribute("aria-valuenow",strings.unrated),element.setAttribute("aria-label",strings.tentativeRating),element.setAttribute("aria-valuetext",strings.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var i=0;i<this._maxRating;i++)this._toolTips[i]=new Tooltip.Tooltip(this._elements[i])},_decrementRating:function(){this._closeTooltip();var firePreviewChange=!0;this._tentativeRating<=0?firePreviewChange=!1:(this._tentativeRating>0?this._tentativeRating--:-1===this._tentativeRating&&(0!==this._userRating&&this._userRating>0?this._tentativeRating=this._userRating-1:this._tentativeRating=0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,firePreviewChange=!1)),this._showTentativeRating(firePreviewChange,"keyboard")},_events:function(){function ratingHandler(eventName){return{name:eventName,lowerCaseName:eventName.toLowerCase(),handler:function(event){var fn=that["_on"+eventName];fn&&fn.apply(that,[event])}}}var i,that=this,eventsRegisteredInLowerCase=[ratingHandler("KeyDown"),ratingHandler("FocusOut"),ratingHandler("FocusIn"),ratingHandler("PointerCancel"),ratingHandler("PointerDown"),ratingHandler("PointerMove"),ratingHandler("PointerOver"),ratingHandler("PointerUp"),ratingHandler("PointerOut")],events=[ratingHandler("WinJSNodeInserted")];for(i=0;i<eventsRegisteredInLowerCase.length;++i)_ElementUtilities._addEventListener(this._element,eventsRegisteredInLowerCase[i].lowerCaseName,eventsRegisteredInLowerCase[i].handler,!1);for(i=0;i<events.length;++i)this._element.addEventListener(events[i].name,events[i].handler,!1);this._ariaValueNowMutationObserver=new _ElementUtilities._MutationObserver(this._ariaValueNowChanged.bind(this)),this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onWinJSNodeInserted:function(){this._recalculateStarProperties(),this._updateControl()},_recalculateStarProperties:function(){var j=0;1===this._averageRating&&(j=1);var style=_ElementUtilities._getComputedStyle(this._elements[j]);this._elementWidth=style.width,"rtl"===_ElementUtilities._getComputedStyle(this._element).direction?(this._elementPadding=style.paddingRight,this._elementBorder=style.borderRight):(this._elementPadding=style.paddingLeft,this._elementBorder=style.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var firePreviewChange=!0;(this._tentativeRating<0||this._tentativeRating>=this._maxRating)&&(firePreviewChange=!1),-1!==this._tentativeRating?this._tentativeRating<this._maxRating&&this._tentativeRating++:0!==this._userRating?this._userRating<this._maxRating?this._tentativeRating=this._userRating+1:this._tentativeRating=this._maxRating:this._tentativeRating=1,this._showTentativeRating(firePreviewChange,"keyboard")},_ariaValueNowChanged:function(){if(!this._disabled){var attrNode=this._element.getAttributeNode("aria-valuenow");if(null!==attrNode){var value=Number(attrNode.nodeValue);this.userRating!==value&&(this.userRating=value,this._tentativeRating=this._userRating,this._raiseEvent(CHANGE,this._userRating))}}},_onPointerCancel:function(){this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(CANCEL,null),this._captured=!1},_onPointerDown:function(eventObject){(eventObject.pointerType!==PT_MOUSE||eventObject.button===MOUSE_LBUTTON)&&(this._captured||(this._pointerDownAt={x:eventObject.clientX,y:eventObject.clientY},this._pointerDownFocus=!0,this._disabled||(_ElementUtilities._setPointerCapture(this._element,eventObject.pointerId),this._captured=!0,eventObject.pointerType===PT_TOUCH?(this._tentativeRating=_ElementUtilities.data(eventObject.target).msStarRating||0,
this._setStarClasses(msRatingTentativeFull,this._tentativeRating,msRatingTentativeEmpty),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(PREVIEW_CHANGE,this._tentativeRating)):this._openTooltip("mousedown"))))},_onCapturedPointerMove:function(eventObject,tooltipType){var star,pointerAt=this._pointerDownAt||{x:eventObject.clientX,y:eventObject.clientY},hit=_ElementUtilities._elementsFromPoint(eventObject.clientX,pointerAt.y);if(hit)for(var i=0,len=hit.length;len>i;i++){var item=hit[i];if("tooltip"===item.getAttribute("role"))return;if(_ElementUtilities.hasClass(item,"win-star")){star=item;break}}var starNum;if(star&&star.parentElement===this._element)starNum=_ElementUtilities.data(star).msStarRating||0;else{var left=0,right=this.maxRating;"rtl"===_ElementUtilities._getComputedStyle(this._element).direction&&(left=right,right=0),starNum=eventObject.clientX<pointerAt.x?left:right}var firePreviewChange=!1,newTentativeRating=Math.min(Math.ceil(starNum),this._maxRating);0!==newTentativeRating||this._enableClear||(newTentativeRating=1),newTentativeRating!==this._tentativeRating&&(this._closeTooltip(),firePreviewChange=!0),this._tentativeRating=newTentativeRating,this._showTentativeRating(firePreviewChange,tooltipType),eventObject.preventDefault()},_onPointerMove:function(eventObject){this._captured&&(eventObject.pointerType===PT_TOUCH?this._onCapturedPointerMove(eventObject,"touch"):this._onCapturedPointerMove(eventObject,"mousedown"))},_onPointerOver:function(eventObject){this._disabled||eventObject.pointerType!==PT_PEN&&eventObject.pointerType!==PT_MOUSE||this._onCapturedPointerMove(eventObject,"mouseover")},_onPointerUp:function(eventObject){this._captured&&(_ElementUtilities._releasePointerCapture(this._element,eventObject.pointerId),this._captured=!1,this._onUserRatingChanged()),this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(CANCEL,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var i=0;i<this._maxRating;i++)this._elements[i].className=msRatingTentativeEmpty;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(PREVIEW_CHANGE,this._userRating):this._raiseEvent(PREVIEW_CHANGE,0),this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(eventObject){var Key=_ElementUtilities.Key,keyCode=eventObject.keyCode,rtlString=_ElementUtilities._getComputedStyle(this._element).direction,handled=!0;switch(keyCode){case Key.enter:this._onUserRatingChanged();break;case Key.tab:this._onUserRatingChanged(),handled=!1;break;case Key.escape:this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(CANCEL,null);break;case Key.leftArrow:"rtl"===rtlString&&this._tentativeRating<this.maxRating?this._incrementRating():"rtl"!==rtlString&&this._tentativeRating>0?this._decrementRating():handled=!1;break;case Key.upArrow:this._tentativeRating<this.maxRating?this._incrementRating():handled=!1;break;case Key.rightArrow:"rtl"===rtlString&&this._tentativeRating>0?this._decrementRating():"rtl"!==rtlString&&this._tentativeRating<this.maxRating?this._incrementRating():handled=!1;break;case Key.downArrow:this._tentativeRating>0?this._decrementRating():handled=!1;break;default:var number=0;if(keyCode>=Key.num0&&keyCode<=Key.num9?number=Key.num0:keyCode>=Key.numPad0&&keyCode<=Key.numPad9&&(number=Key.numPad0),number>0){var firePreviewChange=!1,newTentativeRating=Math.min(keyCode-number,this._maxRating);0!==newTentativeRating||this._enableClear||(newTentativeRating=1),newTentativeRating!==this._tentativeRating&&(this._closeTooltip(),firePreviewChange=!0),this._tentativeRating=newTentativeRating,this._showTentativeRating(firePreviewChange,"keyboard")}else handled=!1}handled&&(eventObject.stopPropagation(),eventObject.preventDefault())},_onPointerOut:function(eventObject){this._captured||_ElementUtilities.eventWithinElement(this._element,eventObject)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(CANCEL,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(CHANGE,this._userRating)))},_raiseEvent:function(eventName,tentativeRating){if(!this._disabled&&(this._lastEventWasChange=eventName===CHANGE,this._lastEventWasCancel=eventName===CANCEL,_Global.document.createEvent)){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(eventName,!1,!1,{tentativeRating:tentativeRating}),this._element.dispatchEvent(event)}},_resetNextElement:function(prevState){if(null!==this._averageRatingElement.nextSibling){_ElementUtilities._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1,shrink:1});var style=this._averageRatingElement.nextSibling.style,direction=_ElementUtilities._getComputedStyle(this._element).direction;prevState&&(direction="rtl"===direction?"ltr":"rtl"),"rtl"===direction?(style.paddingRight=this._elementPadding,style.borderRight=this._elementBorder,style.direction="rtl"):(style.paddingLeft=this._elementPadding,style.borderLeft=this._elementBorder,style.direction="ltr"),style.backgroundPosition="left",style.backgroundSize="100% 100%",style.width=this._resizeStringValue(this._elementWidth,1,style.width)}},_resetAverageStar:function(prevState){this._resetNextElement(prevState),this._hideAverageRating()},_resizeStringValue:function(string,factor,curString){var number=parseFloat(string);if(isNaN(number))return null!==curString?curString:string;var unit=string.substring(number.toString(10).length);return number*=factor,number+unit},_setControlSize:function(value){var maxRating=(Number(value)||DEFAULT_MAX_RATING)>>0;this._maxRating=maxRating>0?maxRating:DEFAULT_MAX_RATING},_updateTooltips:function(value){var i,max=0;if(null!==value)for(max=value.length<=this._maxRating+1?value.length:this._maxRating+1,i=0;max>i;i++)this._tooltipStrings[i]=value[i];else{for(i=0;i<this._maxRating;i++)this._tooltipStrings[i]=i+1;this._tooltipStrings[this._maxRating]=strings.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(classNameBeforeThreshold,threshold,classNameAfterThreshold){for(var i=0;i<this._maxRating;i++)threshold>i?this._elements[i].className=classNameBeforeThreshold:this._elements[i].className=classNameAfterThreshold},_updateAverageStar:function(){var style=this._averageRatingElement.style,nextStyle=this._averageRatingElement.nextSibling.style;"rtl"===_ElementUtilities._getComputedStyle(this._element).direction?(style.backgroundPosition="right",style.paddingRight=this._elementPadding,style.borderRight=this._elementBorder,nextStyle.paddingRight="0px",nextStyle.borderRight="0px",nextStyle.direction="ltr"):(style.backgroundPosition="left",nextStyle.backgroundPosition="right",style.paddingLeft=this._elementPadding,style.borderLeft=this._elementBorder,nextStyle.paddingLeft="0px",nextStyle.borderLeft="0px",nextStyle.direction="rtl"),_ElementUtilities._setFlexStyle(this._averageRatingElement,{grow:this._floatingValue,shrink:this._floatingValue}),style.width=this._resizeStringValue(this._elementWidth,this._floatingValue,style.width),style.backgroundSize=100/this._floatingValue+"% 100%",style.display=_ElementUtilities._getComputedStyle(this._averageRatingElement.nextSibling).display,this._averageRatingHidden=!1,_ElementUtilities._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1-this._floatingValue,shrink:1-this._floatingValue}),nextStyle.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,nextStyle.width),nextStyle.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip(),this._tentativeRating=-1,this._disabled||this._updateControl(),this._updateAccessibilityRestState()},_showTentativeRating:function(firePreviewChange,tooltipType){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(msRatingTentativeFull,this._tentativeRating,msRatingTentativeEmpty),this._hideAverageStar()),this._updateAccessibilityHoverState(),firePreviewChange&&(this._openTooltip(tooltipType),this._raiseEvent(PREVIEW_CHANGE,this._tentativeRating))},_openTooltip:function(tooltipType){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(tooltipType);else if(0===this._tentativeRating){this._clearElement=_Global.document.createElement("div");var distance=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===_ElementUtilities._getComputedStyle(this._element).direction&&(distance*=-1),this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+distance+"px; top:0px;",this._elements[0].appendChild(this._clearElement),this._toolTips[this._maxRating]=new Tooltip.Tooltip(this._clearElement),this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating],this._toolTips[this._maxRating].open(tooltipType)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var i=0;i<this._maxRating;i++)this._toolTips[i].innerHTML=null},_appendClass:function(classNameToBeAdded){for(var i=0;i<=this._maxRating;i++)_ElementUtilities.addClass(this._elements[i],classNameToBeAdded)},_setClasses:function(classNameBeforeThreshold,threshold,classNameAfterThreshold){for(var i=0;i<this._maxRating;i++)threshold>i?this._elements[i].className=classNameBeforeThreshold:this._elements[i].className=classNameAfterThreshold},_ensureAverageMSStarRating:function(){_ElementUtilities.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating){this._setClasses(msRatingAverageFull,this._averageRating-1,msRatingAverageEmpty),this._averageRatingElement.className=msRatingAverageFull;for(var i=0;i<this._maxRating;i++)if(i<this._averageRating&&i+1>=this._averageRating){this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[i]),this._floatingValue=this._averageRating-i;var elementStyle=_ElementUtilities._getComputedStyle(this._elements[i]);this._elementWidth=elementStyle.width,"rtl"===_ElementUtilities._getComputedStyle(this._element).direction?(this._elementPadding=elementStyle.paddingRight,this._elementBorder=elementStyle.borderRight):(this._elementPadding=elementStyle.paddingLeft,this._elementBorder=elementStyle.borderLeft),this._updateAverageStar()}}0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(msRatingUserFull,this._userRating,msRatingUserEmpty),this._resetAverageStar(!1)),0===this._userRating&&0===this._averageRating&&(this._setClasses(msRatingEmpty,this._maxRating),this._resetAverageStar(!1)),this.disabled&&this._appendClass(msRatingDisabled),0!==this._averageRating&&0===this._userRating?this._appendClass(msAverage):this._appendClass(msUser),this._updateAccessibilityRestState()}}})})})}),define("require-style!less/styles-toggleswitch",[],function(){}),define("require-style!less/colors-toggleswitch",[],function(){}),define("WinJS/Controls/ToggleSwitch",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/styles-toggleswitch","require-style!less/colors-toggleswitch"],function(_Global,_Base,_BaseUtils,_Events,_Resources,_Accents,_Control,_ElementUtilities){"use strict";_Accents.createAccentRule(".win-toggleswitch-on .win-toggleswitch-track",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule("html.win-hoverable .win-toggleswitch-on:not(.win-toggleswitch-disabled):not(.win-toggleswitch-pressed) .win-toggleswitch-clickregion:hover .win-toggleswitch-track",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]),_Base.Namespace.define("WinJS.UI",{ToggleSwitch:_Base.Namespace._lazy(function(){var classContainer="win-toggleswitch",classHeader="win-toggleswitch-header",classClick="win-toggleswitch-clickregion",classTrack="win-toggleswitch-track",classThumb="win-toggleswitch-thumb",classValues="win-toggleswitch-values",classValue="win-toggleswitch-value",classValueOn="win-toggleswitch-value-on",classValueOff="win-toggleswitch-value-off",classDescription="win-toggleswitch-description",classOn="win-toggleswitch-on",classOff="win-toggleswitch-off",classDisabled="win-toggleswitch-disabled",classEnabled="win-toggleswitch-enabled",classDragging="win-toggleswitch-dragging",classPressed="win-toggleswitch-pressed",strings={get on(){return _Resources._getWinJSString("ui/on").value},get off(){return _Resources._getWinJSString("ui/off").value}},Toggle=_Base.Class.define(function(element,options){element=element||_Global.document.createElement("div"),this._domElement=element,_ElementUtilities.addClass(this._domElement,classContainer),this._domElement.innerHTML=['<div class="'+classHeader+'"></div>','<div class="'+classClick+'">','   <div class="'+classTrack+'">','       <div class="'+classThumb+'"></div>',"   </div>",'   <div class="'+classValues+'">','      <div class="'+classValue+" "+classValueOn+'"></div>','      <div class="'+classValue+" "+classValueOff+'"></div>',"   </div>","</div>",'<div class="'+classDescription+'"></div>'].join("\n"),this._headerElement=this._domElement.firstElementChild,this._clickElement=this._headerElement.nextElementSibling,this._trackElement=this._clickElement.firstElementChild,this._thumbElement=this._trackElement.firstElementChild,this._labelsElement=this._trackElement.nextElementSibling,this._labelOnElement=this._labelsElement.firstElementChild,this._labelOffElement=this._labelOnElement.nextElementSibling,this._descriptionElement=this._clickElement.nextElementSibling,this._headerElement.setAttribute("aria-hidden",!0),this._labelsElement.setAttribute("aria-hidden",!0),this._headerElement.setAttribute("id",_ElementUtilities._uniqueID(this._headerElement)),this._domElement.setAttribute("aria-labelledby",this._headerElement.id),this._domElement.setAttribute("role","checkbox"),this._domElement.winControl=this,_ElementUtilities.addClass(this._domElement,"win-disposable"),this._domElement.addEventListener("keydown",this._keyDownHandler.bind(this)),_ElementUtilities._addEventListener(this._clickElement,"pointerdown",this._pointerDownHandler.bind(this)),_ElementUtilities._addEventListener(this._clickElement,"pointercancel",this._pointerCancelHandler.bind(this)),this._boundPointerMove=this._pointerMoveHandler.bind(this),this._boundPointerUp=this._pointerUpHandler.bind(this),this._mutationObserver=new _ElementUtilities._MutationObserver(this._ariaChangedHandler.bind(this)),this._mutationObserver.observe(this._domElement,{attributes:!0,attributeFilter:["aria-checked"]}),this._dragX=0,this._dragging=!1,this.checked=!1,this.disabled=!1,this.labelOn=strings.on,this.labelOff=strings.off,_Control.setOptions(this,options)},{element:{get:function(){return this._domElement}},checked:{get:function(){return this._checked},set:function(value){value=!!value,value!==this.checked&&(this._checked=value,this._domElement.setAttribute("aria-checked",value),value?(_ElementUtilities.addClass(this._domElement,classOn),_ElementUtilities.removeClass(this._domElement,classOff)):(_ElementUtilities.addClass(this._domElement,classOff),_ElementUtilities.removeClass(this._domElement,classOn)),this.dispatchEvent("change"))}},disabled:{get:function(){return this._disabled},set:function(value){value=!!value,value!==this._disabled&&(value?(_ElementUtilities.addClass(this._domElement,classDisabled),_ElementUtilities.removeClass(this._domElement,classEnabled)):(_ElementUtilities.removeClass(this._domElement,classDisabled),_ElementUtilities.addClass(this._domElement,classEnabled)),this._disabled=value,this._domElement.setAttribute("aria-disabled",value),this._domElement.setAttribute("tabIndex",value?-1:0))}},labelOn:{get:function(){return this._labelOnElement.innerHTML},set:function(value){this._labelOnElement.innerHTML=value}},labelOff:{get:function(){return this._labelOffElement.innerHTML},set:function(value){this._labelOffElement.innerHTML=value}},title:{get:function(){return this._headerElement.innerHTML},set:function(value){this._headerElement.innerHTML=value}},onchange:_Events._createEventProperty("change"),dispose:function(){this._disposed||(this._disposed=!0)},_ariaChangedHandler:function(){var value=this._domElement.getAttribute("aria-checked");value="true"===value?!0:!1,this.checked=value},_keyDownHandler:function(e){this.disabled||(e.keyCode===_ElementUtilities.Key.space&&(e.preventDefault(),this.checked=!this.checked),(e.keyCode===_ElementUtilities.Key.rightArrow||e.keyCode===_ElementUtilities.Key.upArrow)&&(e.preventDefault(),this.checked=!0),(e.keyCode===_ElementUtilities.Key.leftArrow||e.keyCode===_ElementUtilities.Key.downArrow)&&(e.preventDefault(),this.checked=!1))},_pointerDownHandler:function(e){this.disabled||this._mousedown||(e.preventDefault(),this._mousedown=!0,this._dragXStart=e.pageX-this._trackElement.getBoundingClientRect().left,this._dragX=this._dragXStart,this._dragging=!1,_ElementUtilities.addClass(this._domElement,classPressed),_ElementUtilities._globalListener.addEventListener(this._domElement,"pointermove",this._boundPointerMove,!0),_ElementUtilities._globalListener.addEventListener(this._domElement,"pointerup",this._boundPointerUp,!0),e.pointerType===_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH&&_ElementUtilities._setPointerCapture(this._domElement,e.pointerId))},_pointerCancelHandler:function(e){this._resetPressedState(),e.pointerType===_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH&&_ElementUtilities._releasePointerCapture(this._domElement,e.pointerId)},_pointerUpHandler:function(e){if(!this.disabled&&this._mousedown){e=e.detail.originalEvent,e.preventDefault();var trackRect=this._trackElement.getBoundingClientRect(),thumbRect=this._thumbElement.getBoundingClientRect(),isRTL="rtl"===_ElementUtilities._getComputedStyle(this._domElement).direction;if(this._dragging){var maxX=trackRect.width-thumbRect.width;this.checked=isRTL?this._dragX<maxX/2:this._dragX>=maxX/2,this._dragging=!1,_ElementUtilities.removeClass(this._domElement,classDragging)}else this.checked=!this.checked;this._resetPressedState()}},_pointerMoveHandler:function(e){if(!this.disabled&&this._mousedown){e=e.detail.originalEvent,e.preventDefault();var trackRect=this._trackElement.getBoundingClientRect(),localMouseX=e.pageX-trackRect.left;if(!(localMouseX>trackRect.width)){var thumbRect=this._thumbElement.getBoundingClientRect(),maxX=trackRect.width-thumbRect.width-6;this._dragX=Math.min(maxX,localMouseX-thumbRect.width/2),this._dragX=Math.max(2,this._dragX),!this._dragging&&Math.abs(localMouseX-this._dragXStart)>3&&(this._dragging=!0,_ElementUtilities.addClass(this._domElement,classDragging)),this._thumbElement.style.left=this._dragX+"px"}}},_resetPressedState:function(){this._mousedown=!1,this._thumbElement.style.left="",_ElementUtilities.removeClass(this._domElement,classPressed),_ElementUtilities._globalListener.removeEventListener(this._domElement,"pointermove",this._boundPointerMove,!0),_ElementUtilities._globalListener.removeEventListener(this._domElement,"pointerup",this._boundPointerUp,!0)}});return _Base.Class.mix(Toggle,_Control.DOMEventMixin),Toggle})})}),define("require-style!less/styles-semanticzoom",[],function(){}),define("require-style!less/colors-semanticzoom",[],function(){}),define("WinJS/Controls/SemanticZoom",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","require-style!less/styles-semanticzoom","require-style!less/colors-semanticzoom"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,_TransitionAnimation,ControlProcessor,Promise,_Control,_Dispose,_ElementUtilities,_ElementListUtilities,_Hoverable){"use strict";_Base.Namespace.define("WinJS.UI",{SemanticZoom:_Base.Namespace._lazy(function(){function identity(item){return item}function buildTransition(prop,duration,timing){return prop+" "+_TransitionAnimation._animationTimeAdjustment(duration)+"s "+timing+" "+_TransitionAnimation._libraryDelay+"ms"}function outgoingElementTransition(){return buildTransition(transformNames.cssName,outgoingScaleTransitionDuration,"ease-in-out")+", "+buildTransition("opacity",outgoingOpacityTransitionDuration,"ease-in-out")}function incomingElementTransition(){return buildTransition(transformNames.cssName,incomingScaleTransitionDuration,"ease-in-out")+", "+buildTransition("opacity",incomingOpacityTransitionDuration,"ease-in-out")}function bounceInTransition(){return buildTransition(transformNames.cssName,bounceInDuration,easeOutBezier)}function bounceBackTransition(){return buildTransition(transformNames.cssName,bounceBackDuration,easeOutBezier)}function getDimension(element,property){return _ElementUtilities.convertToPixels(element,property)}function scaleElement(element,scale){_TransitionAnimation.isAnimationEnabled()&&(element.style[transformNames.scriptName]="scale("+scale+")")}function onSemanticZoomResize(ev){var control=ev.target&&ev.target.winControl;control&&!control._resizing&&control._onResize()}function onSemanticZoomPropertyChanged(list){var control=list[0].target&&list[0].target.winControl;control&&control instanceof SemanticZoom&&control._onPropertyChanged()}var browserStyleEquivalents=_BaseUtils._browserStyleEquivalents,strings={get invalidZoomFactor(){return"Invalid zoomFactor"}},sezoButtonClass="win-semanticzoom-button",sezoButtonLocationClass="win-semanticzoom-button-location",sezoButtonShowDuration=3e3,sezoButtonMouseMoveThreshold=8,semanticZoomClass="win-semanticzoom",zoomedInElementClass="win-semanticzoom-zoomedinview",zoomedOutElementClass="win-semanticzoom-zoomedoutview",zoomChangedEvent="zoomchanged",bounceFactor=1.05,defaultZoomFactor=.65,maxZoomFactor=.8,minZoomFactor=.2,canvasSizeMax=4096,outgoingOpacityTransitionDuration=.333,incomingOpacityTransitionDuration=.333,outgoingScaleTransitionDuration=.333,incomingScaleTransitionDuration=.333,zoomAnimationDuration=1e3*outgoingOpacityTransitionDuration,zoomAnimationTTFFBuffer=50,bounceInDuration=.333,bounceBackDuration=.333,easeOutBezier="cubic-bezier(0.1,0.9,0.2,1)",transformNames=browserStyleEquivalents.transform,transitionScriptName=browserStyleEquivalents.transition.scriptName,pinchDistanceCount=2,zoomOutGestureDistanceChangeFactor=.2,zoomInGestureDistanceChangeFactor=.45,zoomAnimationTimeout=1e3,eventTimeoutDelay=50,PinchDirection={none:0,zoomedIn:1,zoomedOut:2},PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",PT_PEN=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",origin={x:0,y:0},SemanticZoom=_Base.Class.define(function(element,options){this._disposed=!1;var that=this,isPhone=_BaseUtils.isPhone;this._element=element,this._element.winControl=this,_ElementUtilities.addClass(this._element,"win-disposable"),_ElementUtilities.addClass(this._element,semanticZoomClass),this._element.setAttribute("role","ms-semanticzoomcontainer");var ariaLabel=this._element.getAttribute("aria-label");if(ariaLabel||this._element.setAttribute("aria-label",""),options=options||{},this._zoomedOut=!!options.zoomedOut||!!options.initiallyZoomedOut||!1,this._enableButton=!isPhone,isPhone||void 0===options.enableButton||(this._enableButton=!!options.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=_ElementUtilities._clamp(options.zoomFactor,minZoomFactor,maxZoomFactor,defaultZoomFactor),this.zoomedInItem=options.zoomedInItem,this.zoomedOutItem=options.zoomedOutItem,_BaseUtils.validation&&options._zoomFactor&&options._zoomFactor!==this._zoomFactor)throw new _ErrorFromName("WinJS.UI.SemanticZoom.InvalidZoomFactor",strings.invalidZoomFactor);this._locked=!!options.locked,this._zoomInProgress=!1,this._isBouncingIn=!1,this._isBouncing=!1,this._zooming=!1,this._aligning=!1,this._gesturing=!1,this._gestureEnding=!1,this._buttonShown=!1,this._shouldFakeTouchCancel="TouchEvent"in _Global,this._initialize(),this._configure();var initiallyParented=_Global.document.body.contains(this._element);_ElementUtilities._addInsertedNotifier(this._element),this._element.addEventListener("WinJSNodeInserted",function(event){return initiallyParented?void(initiallyParented=!1):void onSemanticZoomResize(event)},!1),this._element.addEventListener("mselementresize",onSemanticZoomResize),_ElementUtilities._resizeNotifier.subscribe(this._element,onSemanticZoomResize),new _ElementUtilities._MutationObserver(onSemanticZoomPropertyChanged).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]}),isPhone||(this._element.addEventListener("wheel",this._onWheel.bind(this),!0),this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords()),this._onResizeImpl(),_Control._setOptions(this,options,!0),that._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(value){var newValue=!!value;this._enableButton===newValue||_BaseUtils.isPhone||(this._enableButton=newValue,newValue?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(value){this._zoom(!!value,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&_BaseUtils.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(value){var oldValue=this._zoomFactor,newValue=_ElementUtilities._clamp(value,minZoomFactor,maxZoomFactor,defaultZoomFactor);oldValue!==newValue&&(this._zoomFactor=newValue,this._onResize())}},locked:{get:function(){return this._locked},set:function(value){this._locked=!!value,value?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(value){this._zoomedInItem=value||identity}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(value){this._zoomedOutItem=value||identity}},dispose:function(){this._disposed||(this._disposed=!0,_ElementUtilities._resizeNotifier.unsubscribe(this._element,onSemanticZoomResize),_Dispose._disposeElement(this._elementIn),_Dispose._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var children=_ElementListUtilities.children(this._element);this._elementIn=children[0],this._elementOut=children[1],this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px",ControlProcessor.processAll(this._elementIn),ControlProcessor.processAll(this._elementOut),this._viewIn=this._elementIn.winControl.zoomableView,this._viewOut=this._elementOut.winControl.zoomableView,this._element.removeChild(this._elementOut),this._element.removeChild(this._elementIn),this._element.innerHTML="",this._cropViewport=_Global.document.createElement("div"),this._element.appendChild(this._cropViewport),this._viewportIn=_Global.document.createElement("div"),this._opticalViewportIn=_Global.document.createElement("div"),this._viewportOut=_Global.document.createElement("div"),this._opticalViewportOut=_Global.document.createElement("div"),this._opticalViewportIn.appendChild(this._viewportIn),this._opticalViewportOut.appendChild(this._viewportOut),this._cropViewport.appendChild(this._opticalViewportIn),this._cropViewport.appendChild(this._opticalViewportOut),this._canvasIn=_Global.document.createElement("div"),this._canvasOut=_Global.document.createElement("div"),this._viewportIn.appendChild(this._canvasIn),this._viewportOut.appendChild(this._canvasOut),this._canvasIn.appendChild(this._elementIn),this._canvasOut.appendChild(this._elementOut),this._enableButton&&this._createSemanticZoomButton(),this._hiddenElement=_Global.document.createElement("div"),this._hiddenElement.tabIndex=-1,this._hiddenElement.visibility="hidden",this._hiddenElement.setAttribute("aria-hidden","true"),this._element.appendChild(this._hiddenElement),_ElementUtilities.addClass(this._elementIn,zoomedInElementClass),_ElementUtilities.addClass(this._elementOut,zoomedOutElementClass),this._setLayout(this._element,"relative","hidden"),this._setLayout(this._cropViewport,"absolute","hidden"),this._setLayout(this._opticalViewportIn,"absolute","auto"),this._setLayout(this._opticalViewportOut,"absolute","auto"),this._setLayout(this._viewportIn,"absolute","hidden"),this._setLayout(this._viewportOut,"absolute","hidden"),this._setLayout(this._canvasIn,"absolute","hidden"),this._setLayout(this._canvasOut,"absolute","hidden"),this._setupOpticalViewport(this._opticalViewportIn),this._setupOpticalViewport(this._opticalViewportOut),this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._elementIn.style.position="absolute",this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=_Global.document.createElement("button"),this._sezoButton.setAttribute("type","button"),this._sezoButton.className=sezoButtonClass+" "+sezoButtonLocationClass+" win-button",this._sezoButton.tabIndex=-1,this._sezoButton.style.visibility="hidden",this._sezoButton.setAttribute("aria-hidden",!0),this._element.appendChild(this._sezoButton),this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1),this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null);
},_configure:function(){var axisIn=this._viewIn.getPanAxis(),axisOut=this._viewOut.getPanAxis(),isPhone=_BaseUtils.isPhone;if(this._pansHorizontallyIn="horizontal"===axisIn||"both"===axisIn,this._pansVerticallyIn="vertical"===axisIn||"both"===axisIn,this._pansHorizontallyOut="horizontal"===axisOut||"both"===axisOut,this._pansVerticallyOut="vertical"===axisOut||"both"===axisOut,!this._zoomInProgress){var pagesToPrefetchIn=1/this._zoomFactor-1,pagesToPrefetchOut=bounceFactor-1;this._setLayout(this._elementIn,"absolute","visible"),this._setLayout(this._elementOut,"absolute","visible"),this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),pagesToPrefetchIn),this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),pagesToPrefetchOut),this._pinching=!1,this._pinchGesture=0,this._canvasLeftIn=0,this._canvasTopIn=0,this._canvasLeftOut=0,this._canvasTopOut=0,isPhone||(this._zoomedOut?scaleElement(this._canvasIn,this._zoomFactor):scaleElement(this._canvasOut,1/this._zoomFactor));var styleViewportIn=this._opticalViewportIn.style,styleViewportOut=this._opticalViewportOut.style,styleCanvasIn=this._canvasIn.style,styleCanvasOut=this._canvasOut.style;styleCanvasIn.opacity=this._zoomedOut&&!isPhone?0:1,styleCanvasOut.opacity=this._zoomedOut?1:0,isPhone&&(styleCanvasIn.zIndex=1,styleCanvasOut.zIndex=2),_TransitionAnimation.isAnimationEnabled()&&!isPhone&&(styleViewportIn[browserStyleEquivalents["transition-property"].scriptName]=transformNames.cssName,styleViewportIn[browserStyleEquivalents["transition-duration"].scriptName]="0s",styleViewportIn[browserStyleEquivalents["transition-timing-function"].scriptName]="linear",styleViewportOut[browserStyleEquivalents["transition-property"].scriptName]=transformNames.cssName,styleViewportOut[browserStyleEquivalents["transition-duration"].scriptName]="0s",styleViewportOut[browserStyleEquivalents["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var newValue=this._element.getAttribute("aria-checked"),zoomedOut="true"===newValue;this._zoomedOut!==zoomedOut&&(this.zoomedOut=zoomedOut)},_onResizeImpl:function(){this._resizing=this._resizing||0,this._resizing++;try{var positionElement=function(element,left,top,width,height){var style=element.style;style.left=left+"px",style.top=top+"px",style.width=width+"px",style.height=height+"px"},sezoComputedStyle=_ElementUtilities._getComputedStyle(this._element,null),computedWidth=parseFloat(sezoComputedStyle.width),computedHeight=parseFloat(sezoComputedStyle.height),sezoPaddingLeft=getDimension(this._element,sezoComputedStyle.paddingLeft),sezoPaddingRight=getDimension(this._element,sezoComputedStyle.paddingRight),sezoPaddingTop=getDimension(this._element,sezoComputedStyle.paddingTop),sezoPaddingBottom=getDimension(this._element,sezoComputedStyle.paddingBottom),viewportWidth=computedWidth-sezoPaddingLeft-sezoPaddingRight,viewportHeight=computedHeight-sezoPaddingTop-sezoPaddingBottom,scaleFactor=1/this._zoomFactor;if(this._viewportWidth===viewportWidth&&this._viewportHeight===viewportHeight)return;this._sezoClientHeight=computedHeight,this._sezoClientWidth=computedWidth,this._viewportWidth=viewportWidth,this._viewportHeight=viewportHeight,this._configure();var multiplierIn=2*scaleFactor-1,canvasInWidth=Math.min(canvasSizeMax,(this._pansHorizontallyIn?multiplierIn:1)*viewportWidth),canvasInHeight=Math.min(canvasSizeMax,(this._pansVerticallyIn?multiplierIn:1)*viewportHeight);this._canvasLeftIn=.5*(canvasInWidth-viewportWidth),this._canvasTopIn=.5*(canvasInHeight-viewportHeight),positionElement(this._cropViewport,sezoPaddingLeft,sezoPaddingTop,viewportWidth,viewportHeight),positionElement(this._viewportIn,0,0,viewportWidth,viewportHeight),positionElement(this._opticalViewportIn,0,0,viewportWidth,viewportHeight),positionElement(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,canvasInWidth,canvasInHeight),positionElement(this._elementIn,this._canvasLeftIn,this._canvasTopIn,viewportWidth,viewportHeight);var multiplierOut=2*bounceFactor-1,canvasOutWidth=(this._pansHorizontallyOut?multiplierOut:1)*viewportWidth,canvasOutHeight=(this._pansVerticallyOut?multiplierOut:1)*viewportHeight;this._canvasLeftOut=.5*(canvasOutWidth-viewportWidth),this._canvasTopOut=.5*(canvasOutHeight-viewportHeight),positionElement(this._viewportOut,0,0,viewportWidth,viewportHeight),positionElement(this._opticalViewportOut,0,0,viewportWidth,viewportHeight),positionElement(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,canvasOutWidth,canvasOutHeight),positionElement(this._elementOut,this._canvasLeftOut,this._canvasTopOut,viewportWidth,viewportHeight)}finally{this._resizing--}},_onResize:function(){this._onResizeImpl()},_onMouseMove:function(ev){return this._zooming||!this._lastMouseX&&!this._lastMouseY||ev.screenX===this._lastMouseX&&ev.screenY===this._lastMouseY?(this._lastMouseX=ev.screenX,void(this._lastMouseY=ev.screenY)):void(Math.abs(ev.screenX-this._lastMouseX)<=sezoButtonMouseMoveThreshold&&Math.abs(ev.screenY-this._lastMouseY)<=sezoButtonMouseMoveThreshold||(this._lastMouseX=ev.screenX,this._lastMouseY=ev.screenY,this._displayButton()))},_displayButton:function(){if(_Hoverable.isHoverable){_Global.clearTimeout(this._dismissButtonTimer),this._showSemanticZoomButton();var that=this;this._dismissButtonTimer=_Global.setTimeout(function(){that._hideSemanticZoomButton()},_TransitionAnimation._animationTimeAdjustment(sezoButtonShowDuration))}},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(Animations.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(immediately){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(immediately)this._sezoButton.style.visibility="hidden";else{var that=this;Animations.fadeOut(this._sezoButton).then(function(){that._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(ev){ev.target!==this.element&&this._hideSemanticZoomButton(!0)},_onWheel:function(ev){ev.ctrlKey&&(this._zoom(ev.deltaY>0,this._getPointerLocation(ev)),ev.stopPropagation(),ev.preventDefault())},_onMouseWheel:function(ev){ev.ctrlKey&&(this._zoom(ev.wheelDelta<0,this._getPointerLocation(ev)),ev.stopPropagation(),ev.preventDefault())},_onPenHover:function(ev){ev.pointerType===PT_PEN&&0===ev.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton(),this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(ev){var handled=!1;if(ev.ctrlKey){var Key=_ElementUtilities.Key;switch(ev.keyCode){case Key.add:case Key.equal:case 61:this._zoom(!1),handled=!0;break;case Key.subtract:case Key.dash:case 173:this._zoom(!0),handled=!0}}handled&&(ev.stopPropagation(),ev.preventDefault())},_createPointerRecord:function(ev,fireCancelOnPinch){var location=this._getPointerLocation(ev),newRecord={};return newRecord.startX=newRecord.currentX=location.x,newRecord.startY=newRecord.currentY=location.y,newRecord.fireCancelOnPinch=fireCancelOnPinch,this._pointerRecords[ev.pointerId]=newRecord,this._pointerCount=Object.keys(this._pointerRecords).length,newRecord},_deletePointerRecord:function(id){var record=this._pointerRecords[id];return delete this._pointerRecords[id],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),record},_fakeCancelOnPointer:function(ev){var touchEvent=_Global.document.createEvent("UIEvent");touchEvent.initUIEvent("touchcancel",!0,!0,_Global,0),touchEvent.touches=ev.touches,touchEvent.targetTouches=ev.targetTouches,touchEvent.changedTouches=[ev._currentTouch],touchEvent._fakedBySemanticZoom=!0,ev.target.dispatchEvent(touchEvent)},_handlePointerDown:function(ev){this._createPointerRecord(ev,!1);for(var contactKeys=Object.keys(this._pointerRecords),i=0,len=contactKeys.length;len>i;i++)try{_ElementUtilities._setPointerCapture(this._hiddenElement,contactKeys[i]||0)}catch(e){return void this._resetPointerRecords()}ev.stopImmediatePropagation(),ev.preventDefault()},_handleFirstPointerDown:function(ev){this._resetPointerRecords(),this._createPointerRecord(ev,this._shouldFakeTouchCancel),this._startedZoomedOut=this._zoomedOut},_onClick:function(ev){ev.target!==this._element&&this._isBouncing&&ev.stopImmediatePropagation()},_onPointerDown:function(ev){ev.pointerType===PT_TOUCH&&(0===this._pointerCount?this._handleFirstPointerDown(ev):this._handlePointerDown(ev))},_onPointerMove:function(ev){function distance(startX,startY,endX,endY){return Math.sqrt((endX-startX)*(endX-startX)+(endY-startY)*(endY-startY))}function midpoint(point1,point2){return{x:.5*(point1.currentX+point2.currentX)|0,y:.5*(point1.currentY+point2.currentY)|0}}if(ev.pointerType===PT_MOUSE||ev.pointerType===PT_PEN)return void this._onMouseMove(ev);if(ev.pointerType===PT_TOUCH){var pointerRecord=this._pointerRecords[ev.pointerId],location=this._getPointerLocation(ev);if(pointerRecord){if(pointerRecord.currentX=location.x,pointerRecord.currentY=location.y,2===this._pointerCount){this._pinching=!0;var contactKeys=Object.keys(this._pointerRecords),point1=this._pointerRecords[contactKeys[0]],point2=this._pointerRecords[contactKeys[1]];this._currentMidPoint=midpoint(point1,point2);var contactDistance=distance(point1.currentX,point1.currentY,point2.currentX,point2.currentY),that=this,processPinchGesture=function(zoomingOut){var pinchDirection=zoomingOut?PinchDirection.zoomedOut:PinchDirection.zoomedIn,gestureReversed=zoomingOut?that._pinchedDirection===PinchDirection.zoomedIn&&!that._zoomingOut:that._pinchedDirection===PinchDirection.zoomedOut&&that._zoomingOut,canZoomInGesturedDirection=zoomingOut?!that._zoomedOut:that._zoomedOut;if(that._pinchedDirection===PinchDirection.none)canZoomInGesturedDirection?(that._isBouncingIn=!1,that._zoom(zoomingOut,midpoint(point1,point2),!0),that._pinchedDirection=pinchDirection):that._isBouncingIn||that._playBounce(!0,midpoint(point1,point2));else if(gestureReversed){var deltaFromStart=that._lastPinchDistance/that._lastPinchStartDistance,deltaFromLast=that._lastLastPinchDistance/that._lastPinchDistance;(zoomingOut&&deltaFromStart>zoomOutGestureDistanceChangeFactor||!zoomingOut&&deltaFromLast>zoomInGestureDistanceChangeFactor)&&(that._zoom(zoomingOut,midpoint(point1,point2),!0),that._pinchedDirection=pinchDirection)}};this._updatePinchDistanceRecords(contactDistance),this._pinchDistanceCount>=pinchDistanceCount&&(this._zooming||this._isBouncing||(_WriteProfilerMark("WinJS.UI.SemanticZoom:EndPinchDetection,info"),processPinchGesture(this._lastPinchDirection===PinchDirection.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(pointerRecord.fireCancelOnPinch&&(this._fakeCancelOnPointer(ev,pointerRecord),pointerRecord.fireCancelOnPinch=!1),ev.stopImmediatePropagation(),ev.preventDefault()),2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}}},_onPointerOut:function(ev){ev.pointerType===PT_TOUCH&&ev.target===this._element&&this._completePointerUp(ev,!1)},_onPointerUp:function(ev){this._releasePointerCapture(ev),this._completePointerUp(ev,!0),this._completeZoomingIfTimeout()},_onPointerCancel:function(ev){ev._fakedBySemanticZoom||(this._releasePointerCapture(ev),this._completePointerUp(ev,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(ev){var pointerRecord=this._pointerRecords[ev.pointerId];pointerRecord&&(pointerRecord.dirty=!1)},_onLostPointerCapture:function(ev){var pointerRecord=this._pointerRecords[ev.pointerId];if(pointerRecord){pointerRecord.dirty=!0;var that=this;Promise.timeout(eventTimeoutDelay).then(function(){pointerRecord.dirty&&that._completePointerUp(ev,!1)})}},_onMSContentZoom:function(ev){var sourceElement=ev.target;if(sourceElement===this._opticalViewportIn||sourceElement===this._opticalViewportOut){var zoomingOut=sourceElement.msContentZoomFactor<.995,zoomingIn=sourceElement.msContentZoomFactor>1.005;!zoomingOut||this._zoomedOut||this._zoomingOut?zoomingIn&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0}},_updatePinchDistanceRecords:function(contactDistance){function updatePinchDirection(direction){that._lastPinchDirection===direction?that._pinchDistanceCount++:(that._pinchGesture++,that._pinchDistanceCount=0,that._lastPinchStartDistance=contactDistance),that._lastPinchDirection=direction,that._lastPinchDistance=contactDistance,that._lastLastPinchDistance=that._lastPinchDistance}var that=this;-1===this._lastPinchDistance?(_WriteProfilerMark("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=contactDistance):this._lastPinchDistance!==contactDistance&&updatePinchDirection(this._lastPinchDistance>contactDistance?PinchDirection.zoomedOut:PinchDirection.zoomedIn)},_zoomFromCurrent:function(zoomOut){this._zoom(zoomOut,null,!1,!0)},_zoom:function(zoomOut,zoomCenter,gesture,centerOnCurrent,skipAlignment){if(_WriteProfilerMark("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+zoomOut+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!gesture)return;zoomOut!==this._zoomingOut&&this._startAnimations(zoomOut)}else if(zoomOut!==this._zoomedOut){this._zooming=!0,this._aligning=!0,this._gesturing=!!gesture,zoomCenter&&(zoomOut?this._viewIn:this._viewOut).setCurrentItem(zoomCenter.x,zoomCenter.y),this._zoomInProgress=!0,(zoomOut?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible",zoomOut&&_BaseUtils.isPhone&&(this._canvasOut.style.opacity=1);var promiseIn=this._viewIn.beginZoom(),promiseOut=this._viewOut.beginZoom(),beginZoomPromises=null;if((promiseIn||promiseOut)&&_BaseUtils.isPhone&&(beginZoomPromises=Promise.join([promiseIn,promiseOut])),centerOnCurrent&&!skipAlignment){var that=this;(zoomOut?this._viewIn:this._viewOut).getCurrentItem().then(function(current){var position=current.position;that._prepareForZoom(zoomOut,{x:that._rtl()?that._sezoClientWidth-position.left-.5*position.width:position.left+.5*position.width,y:position.top+.5*position.height},Promise.wrap(current),beginZoomPromises)})}else this._prepareForZoom(zoomOut,zoomCenter||{},null,beginZoomPromises,skipAlignment)}},_prepareForZoom:function(zoomOut,zoomCenter,completedCurrentItem,customViewAnimationPromise,skipAlignment){function setZoomCenters(adjustmentIn,adjustmentOut){that._canvasIn.style[browserStyleEquivalents["transform-origin"].scriptName]=that._canvasLeftIn+centerX-adjustmentIn.x+"px "+(that._canvasTopIn+centerY-adjustmentIn.y)+"px",that._canvasOut.style[browserStyleEquivalents["transform-origin"].scriptName]=that._canvasLeftOut+centerX-adjustmentOut.x+"px "+(that._canvasTopOut+centerY-adjustmentOut.y)+"px"}_WriteProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var that=this,centerX=zoomCenter.x,centerY=zoomCenter.y;"number"==typeof centerX&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(centerX=.5*this._sezoClientWidth),"number"==typeof centerY&&this._pansVerticallyIn&&this._pansVerticallyOut||(centerY=.5*this._sezoClientHeight),setZoomCenters(origin,origin),skipAlignment?this._aligning=!1:this._alignViewsPromise=this._alignViews(zoomOut,centerX,centerY,completedCurrentItem).then(function(){that._aligning=!1,that._gestureEnding=!1,that._alignViewsPromise=null,that._zooming||that._gesturing||that._completeZoom()}),this._zoomingOut=zoomOut,_ElementUtilities._getComputedStyle(this._canvasIn).opacity,_ElementUtilities._getComputedStyle(this._canvasOut).opacity,_WriteProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StopTM"),this._startAnimations(zoomOut,customViewAnimationPromise)},_alignViews:function(zoomOut,centerX,centerY,completedCurrentItem){var multiplier=1-this._zoomFactor,rtl=this._rtl(),offsetLeft=multiplier*(rtl?this._viewportWidth-centerX:centerX),offsetTop=multiplier*centerY,that=this;if(zoomOut){var item=completedCurrentItem||this._viewIn.getCurrentItem();if(item)return item.then(function(current){var positionIn=current.position,positionOut={left:positionIn.left*that._zoomFactor+offsetLeft,top:positionIn.top*that._zoomFactor+offsetTop,width:positionIn.width*that._zoomFactor,height:positionIn.height*that._zoomFactor};return that._viewOut.positionItem(that._zoomedOutItem(current.item),positionOut)})}else{var item2=completedCurrentItem||this._viewOut.getCurrentItem();if(item2)return item2.then(function(current){var positionOut=current.position,positionIn={left:(positionOut.left-offsetLeft)/that._zoomFactor,top:(positionOut.top-offsetTop)/that._zoomFactor,width:positionOut.width/that._zoomFactor,height:positionOut.height/that._zoomFactor};return that._viewIn.positionItem(that._zoomedInItem(current.item),positionIn)})}return new Promise(function(c){c({x:0,y:0})})},_startAnimations:function(zoomOut,customViewAnimationPromise){this._zoomingOut=zoomOut;var isPhone=_BaseUtils.isPhone;if(_TransitionAnimation.isAnimationEnabled()&&!isPhone&&(_WriteProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[transitionScriptName]=zoomOut?outgoingElementTransition():incomingElementTransition(),this._canvasOut.style[transitionScriptName]=zoomOut?incomingElementTransition():outgoingElementTransition()),isPhone||(scaleElement(this._canvasIn,zoomOut?this._zoomFactor:1),scaleElement(this._canvasOut,zoomOut?1:1/this._zoomFactor)),this._canvasIn.style.opacity=zoomOut&&!isPhone?0:1,(!isPhone||zoomOut)&&(this._canvasOut.style.opacity=zoomOut?1:0),_TransitionAnimation.isAnimationEnabled())if(customViewAnimationPromise){var that=this,onComplete=function(){that._canvasIn.style[transformNames.scriptName]="",that._canvasOut.style[transformNames.scriptName]="",that._onZoomAnimationComplete()};customViewAnimationPromise.then(onComplete,onComplete)}else this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),_TransitionAnimation._animationTimeAdjustment(zoomAnimationDuration));else this._zooming=!1,this._canvasIn.style[transformNames.scriptName]="",this._canvasOut.style[transformNames.scriptName]="",this._completeZoom()},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){_WriteProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM"),this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(ev){return this._disposed?void 0:ev.target!==this._canvasOut&&ev.target!==this._canvasIn||!this._isBouncing?void(ev.target===this._canvasIn&&ev.propertyName===transformNames.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(timer){timer&&_Global.clearTimeout(timer)},_completePointerUp:function(ev,stopPropagation){if(!this._disposed){var id=ev.pointerId,pointerRecord=this._pointerRecords[id];if(pointerRecord&&(this._deletePointerRecord(id),this._isBouncingIn&&this._playBounce(!1),stopPropagation&&this._pinchedDirection!==PinchDirection.none&&ev.stopImmediatePropagation(),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==PinchDirection.none&&this._pinchDistanceCount<pinchDistanceCount)return this._zoom(this._lastPinchDirection===PinchDirection.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==PinchDirection.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom()),this._pinchGesture=0,this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(callback,delay){var that=this;that._TTFFTimer=_Global.setTimeout(function(){this._disposed||(that._TTFFTimer=_Global.setTimeout(callback,delay))},zoomAnimationTTFFBuffer)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var that=this;(this._zoomInProgress||this._isBouncing)&&(that._completeZoomTimer=_Global.setTimeout(function(){that._completeZoom()},_TransitionAnimation._animationTimeAdjustment(zoomAnimationTimeout)))}},_completeZoom:function(){if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);if(this._zoomInProgress){_WriteProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!_BaseUtils.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1;var zoomChanged=!1;if(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),zoomChanged=!0),this._setVisibility(),zoomChanged){var ev=_Global.document.createEvent("CustomEvent");ev.initCustomEvent(zoomChangedEvent,!0,!0,this._zoomedOut),this._element.dispatchEvent(ev),this._isActive&&_ElementUtilities._setActive(this._zoomedOut?this._elementOut:this._elementIn)}_WriteProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info")}}},_isActive:function(){var active=_Global.document.activeElement;return this._element===active||this._element.contains(active)},_setLayout:function(element,position,overflow){var style=element.style;style.position=position,style.overflow=overflow},_setupOpticalViewport:function(viewport){viewport.style["-ms-overflow-style"]="none",_BaseUtils.isPhone||(viewport.style["-ms-content-zooming"]="zoom",viewport.style["-ms-content-zoom-limit-min"]="99%",viewport.style["-ms-content-zoom-limit-max"]="101%",viewport.style["-ms-content-zoom-snap-points"]="snapList(100%)",viewport.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function setVisibility(element,isVisible){element.style.visibility=isVisible?"visible":"hidden"}setVisibility(this._opticalViewportIn,!this._zoomedOut||_BaseUtils.isPhone),setVisibility(this._opticalViewportOut,this._zoomedOut),this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut),this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=PinchDirection.none,this._pointerCount=0,this._pointerRecords={},this._resetPinchDistanceRecords()},_releasePointerCapture:function(ev){var id=ev.pointerId;try{_ElementUtilities._releasePointerCapture(this._hiddenElement,id)}catch(e){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var that=this;this._recordResetPromise=Promise.timeout(eventTimeoutDelay).then(function(){0===that._pointerCount&&(that._resetPointerRecords(),that._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=PinchDirection.none,this._lastPinchDistance=-1,this._lastLastPinchDistance=-1,this._pinchDistanceCount=0,this._currentMidPoint=null},_getPointerLocation:function(ev){var sezoBox={left:0,top:0};try{sezoBox=this._element.getBoundingClientRect()}catch(err){}var sezoComputedStyle=_ElementUtilities._getComputedStyle(this._element,null),sezoPaddingLeft=getDimension(this._element,sezoComputedStyle.paddingLeft),sezoPaddingTop=getDimension(this._element,sezoComputedStyle.paddingTop),sezoBorderLeft=getDimension(this._element,sezoComputedStyle.borderLeftWidth);return{x:+ev.clientX===ev.clientX?ev.clientX-sezoBox.left-sezoPaddingLeft-sezoBorderLeft:0,y:+ev.clientY===ev.clientY?ev.clientY-sezoBox.top-sezoPaddingTop-sezoPaddingTop:0}},_playBounce:function(beginBounce,center){if(_TransitionAnimation.isAnimationEnabled()&&this._isBouncingIn!==beginBounce){this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._isBouncing=!0,this._isBouncingIn=beginBounce,beginBounce?this._bounceCenter=center:this._aligned=!0;var targetElement=this._zoomedOut?this._canvasOut:this._canvasIn,adjustmentX=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,adjustmentY=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;targetElement.style[browserStyleEquivalents["transform-origin"].scriptName]=adjustmentX+this._bounceCenter.x+"px "+(adjustmentY+this._bounceCenter.y)+"px",targetElement.style[transitionScriptName]=beginBounce?bounceInTransition():bounceBackTransition(),this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();var scale=beginBounce?this._zoomedOut?2-bounceFactor:bounceFactor:1;scaleElement(targetElement,scale),this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),_TransitionAnimation._animationTimeAdjustment(zoomAnimationDuration))}},_rtl:function(){return"rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction},_pinching:{set:function(value){this._viewIn.pinching=value,this._viewOut.pinching=value}}});return _Base.Class.mix(SemanticZoom,_Events.createEventProperties("zoomchanged")),_Base.Class.mix(SemanticZoom,_Control.DOMEventMixin),SemanticZoom})})}),define("WinJS/Controls/Pivot/_Constants",["require","exports"],function(require,exports){exports._ClassNames={pivot:"win-pivot",pivotCustomHeaders:"win-pivot-customheaders",pivotLocked:"win-pivot-locked",pivotTitle:"win-pivot-title",pivotHeaderArea:"win-pivot-header-area",pivotHeaderLeftCustom:"win-pivot-header-leftcustom",pivotHeaderRightCustom:"win-pivot-header-rightcustom",pivotHeaderItems:"win-pivot-header-items",pivotHeaders:"win-pivot-headers",pivotHeader:"win-pivot-header",pivotHeaderSelected:"win-pivot-header-selected",pivotViewport:"win-pivot-viewport",pivotSurface:"win-pivot-surface",pivotNoSnap:"win-pivot-nosnap",pivotNavButton:"win-pivot-navbutton",pivotNavButtonPrev:"win-pivot-navbutton-prev",pivotNavButtonNext:"win-pivot-navbutton-next",pivotShowNavButtons:"win-pivot-shownavbuttons",pivotInputTypeMouse:"win-pivot-mouse",pivotInputTypeTouch:"win-pivot-touch",pivotDisableContentSwipeNavigation:"win-pivot-disablecontentswipenavigation"}}),define("WinJS/Controls/Pivot/_Item",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Constants"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,ControlProcessor,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{PivotItem:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},PivotItem=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.PivotItem.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,PivotItem._ClassName.pivotItem),_ElementUtilities.addClass(this.element,"win-disposable"),this._element.setAttribute("role","tabpanel"),this._contentElement=_Global.document.createElement("DIV"),this._contentElement.className=PivotItem._ClassName.pivotItemContent,element.appendChild(this._contentElement);for(var elementToMove=this.element.firstChild;elementToMove!==this._contentElement;){var nextElement=elementToMove.nextSibling;this._contentElement.appendChild(elementToMove),elementToMove=nextElement}this._processors=[ControlProcessor.processAll],_Control.setOptions(this,options)},{element:{get:function(){return this._element}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(value){this._header=value,this._parentPivot&&this._parentPivot._headersState.handleHeaderChanged(this)}},_parentPivot:{get:function(){for(var el=this._element;el&&!_ElementUtilities.hasClass(el,_Constants._ClassNames.pivot);)el=el.parentNode;return el&&el.winControl}},_process:function(){var that=this;return this._processors&&this._processors.push(function(){return Scheduler.schedulePromiseAboveNormal()}),this._processed=(this._processors||[]).reduce(function(promise,processor){return promise.then(function(){return processor(that.contentElement)})},this._processed||Promise.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,_Dispose.disposeSubTree(this.contentElement))}},{_ClassName:{pivotItem:"win-pivot-item",pivotItemContent:"win-pivot-item-content"},isDeclarativeControlContainer:_BaseUtils.markSupportedForProcessing(function(item,callback){callback!==ControlProcessor.processAll&&(item._processors=item._processors||[],item._processors.push(callback),item._processed&&item._process())})});return PivotItem})})}),define("require-style!less/styles-pivot",[],function(){}),define("require-style!less/colors-pivot",[],function(){});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("WinJS/Controls/Pivot/_Pivot",["require","exports","../../Core/_Global","../../Animations","../../BindingList","../../ControlProcessor","../../Promise","../../Scheduler","../../Core/_Base","../../Core/_BaseUtils","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Utilities/_Hoverable","../../Utilities/_KeyboardBehavior","../../Core/_Log","../../Core/_Resources","../../Animations/_TransitionAnimation","../../Core/_WriteProfilerMark","./_Constants"],function(require,exports,_Global,Animations,BindingList,ControlProcessor,Promise,Scheduler,_Base,_BaseUtils,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Hoverable,_KeyboardBehavior,_Log,_Resources,_TransitionAnimation,_WriteProfilerMark,_Constants){function pivotDefaultHeaderTemplate(item){var element=_Global.document.createTextNode("object"==typeof item.header?JSON.stringify(item.header):""+item.header);return element}_Hoverable.isHoverable,require(["require-style!less/styles-pivot"]),require(["require-style!less/colors-pivot"]);var _EventNames={selectionChanged:"selectionchanged",itemAnimationStart:"itemanimationstart",itemAnimationEnd:"itemanimationend"},strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateItem(){return _Resources._getWinJSString("ui/duplicateItem").value},get invalidContent(){return"Invalid content: Pivot content must be made up of PivotItems."},get pivotAriaLabel(){return _Resources._getWinJSString("ui/pivotAriaLabel").value},get pivotViewportAriaLabel(){return _Resources._getWinJSString("ui/pivotViewportAriaLabel").value}},supportsSnap=!!(_ElementUtilities._supportsSnapPoints&&"inertiaDestinationX"in _Global.MSManipulationEvent.prototype),PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",Keys=_ElementUtilities.Key,_headerSlideAnimationDuration=250,_invalidMeasurement=-1,Pivot=function(){function Pivot(element,options){if(void 0===options&&(options={}),this._disposed=!1,this._firstLoad=!0,this._hidePivotItemAnimation=Promise.wrap(),this._loadPromise=Promise.wrap(),this._pendingRefresh=!1,this._selectedIndex=0,this._showPivotItemAnimation=Promise.wrap(),this._slideHeadersAnimation=Promise.wrap(),element=element||_Global.document.createElement("DIV"),element.winControl)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateConstruction",strings.duplicateConstruction);this._handleItemChanged=this._handleItemChanged.bind(this),this._handleItemInserted=this._handleItemInserted.bind(this),
this._handleItemMoved=this._handleItemMoved.bind(this),this._handleItemRemoved=this._handleItemRemoved.bind(this),this._handleItemReload=this._handleItemReload.bind(this),this._resizeHandler=this._resizeHandler.bind(this),this._updatePointerType=this._updatePointerType.bind(this),this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),element.winControl=this,this._element=element,this._element.setAttribute("role","tablist"),this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",strings.pivotAriaLabel),_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivot),_ElementUtilities.addClass(this.element,"win-disposable"),_ElementUtilities._addEventListener(this.element,"pointerenter",this._updatePointerType),_ElementUtilities._addEventListener(this.element,"pointerout",this._updatePointerType),this._titleElement=_Global.document.createElement("DIV"),this._titleElement.style.display="none",_ElementUtilities.addClass(this._titleElement,_Constants._ClassNames.pivotTitle),this._element.appendChild(this._titleElement),this._headerAreaElement=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._headerAreaElement,_Constants._ClassNames.pivotHeaderArea),this._element.appendChild(this._headerAreaElement),this._headerItemsElement=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._headerItemsElement,_Constants._ClassNames.pivotHeaderItems),this._headerAreaElement.appendChild(this._headerItemsElement),this._headerItemsElWidth=null,this._headersContainerElement=_Global.document.createElement("DIV"),this._headersContainerElement.tabIndex=0,_ElementUtilities.addClass(this._headersContainerElement,_Constants._ClassNames.pivotHeaders),this._headersContainerElement.addEventListener("keydown",this._headersKeyDown.bind(this)),_ElementUtilities._addEventListener(this._headersContainerElement,"pointerenter",this._showNavButtons.bind(this)),_ElementUtilities._addEventListener(this._headersContainerElement,"pointerout",this._hideNavButtons.bind(this)),this._headerItemsElement.appendChild(this._headersContainerElement),this._element.addEventListener("click",this._elementClickedHandler.bind(this)),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._headersContainerElement),this._customLeftHeader=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._customLeftHeader,_Constants._ClassNames.pivotHeaderLeftCustom),this._headerAreaElement.insertBefore(this._customLeftHeader,this._headerAreaElement.children[0]),this._customRightHeader=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._customRightHeader,_Constants._ClassNames.pivotHeaderRightCustom),this._headerAreaElement.appendChild(this._customRightHeader),this._viewportElement=_Global.document.createElement("DIV"),this._viewportElement.className=_Constants._ClassNames.pivotViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",strings.pivotViewportAriaLabel),this.element.addEventListener("mselementresize",this._resizeHandler),_ElementUtilities._resizeNotifier.subscribe(this.element,this._resizeHandler),this._viewportElWidth=null,this._surfaceElement=_Global.document.createElement("DIV"),this._surfaceElement.className=_Constants._ClassNames.pivotSurface,this._viewportElement.appendChild(this._surfaceElement),this._headersState=new HeaderStateBase(this),supportsSnap?this._viewportElement.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)):(_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivotNoSnap),_ElementUtilities._addEventListener(this._element,"pointerdown",this._elementPointerDownHandler.bind(this)),_ElementUtilities._addEventListener(this._element,"pointerup",this._elementPointerUpHandler.bind(this))),this._parse(),options=_BaseUtils._shallowCopy(options),options.items&&(this.items=options.items,delete options.items),_Control.setOptions(this,options),this._refresh(),this._writeProfilerMark("constructor,StopTM")}return Object.defineProperty(Pivot.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"customLeftHeader",{get:function(){return this._customLeftHeader.firstElementChild},set:function(value){_ElementUtilities.empty(this._customLeftHeader),value?(this._customLeftHeader.appendChild(value),_ElementUtilities.addClass(this._element,_Constants._ClassNames.pivotCustomHeaders)):this._customLeftHeader.children.length||this._customRightHeader.childNodes.length||_ElementUtilities.removeClass(this._element,_Constants._ClassNames.pivotCustomHeaders),this.forceLayout()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"customRightHeader",{get:function(){return this._customRightHeader.firstElementChild},set:function(value){_ElementUtilities.empty(this._customRightHeader),value?(this._customRightHeader.appendChild(value),_ElementUtilities.addClass(this._element,_Constants._ClassNames.pivotCustomHeaders)):this._customLeftHeader.children.length||this._customRightHeader.childNodes.length||_ElementUtilities.removeClass(this._element,_Constants._ClassNames.pivotCustomHeaders),this.forceLayout()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"locked",{get:function(){return _ElementUtilities.hasClass(this.element,_Constants._ClassNames.pivotLocked)},set:function(value){_ElementUtilities[value?"addClass":"removeClass"](this.element,_Constants._ClassNames.pivotLocked),value&&this._hideNavButtons()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"items",{get:function(){return this._pendingItems?this._pendingItems:this._items},set:function(value){this._pendingItems=value,this._refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"title",{get:function(){return this._titleElement.textContent},set:function(value){value?(this._titleElement.style.display="block",this._titleElement.textContent=value):(this._titleElement.style.display="none",this._titleElement.textContent="")},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"selectedIndex",{get:function(){return 0===this.items.length?-1:this._selectedIndex},set:function(value){value>=0&&value<this.items.length&&(this._pendingRefresh?this._selectedIndex=value:this._loadItem(value))},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"selectedItem",{get:function(){return this.items.getAt(this.selectedIndex)},set:function(value){var index=this.items.indexOf(value);-1!==index&&(this.selectedIndex=index)},enumerable:!0,configurable:!0}),Pivot.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,this._updateEvents(this._items,null),_ElementUtilities._resizeNotifier.unsubscribe(this.element,this._resizeHandler),this._headersState.exit(),_Dispose._disposeElement(this._headersContainerElement);for(var i=0,len=this.items.length;len>i;i++)this.items.getAt(i).dispose()}},Pivot.prototype.forceLayout=function(){this._disposed||this._resizeHandler()},Pivot.prototype._applyProperties=function(){function attachItems(pivot){for(var i=0,len=pivot.items.length;len>i;i++){var item=pivot._items.getAt(i);if(item.element.parentNode===pivot._surfaceElement)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateItem",strings.duplicateItem);item.element.style.display="none",pivot._surfaceElement.appendChild(item.element)}}if(!this._disposed){if(this._pendingItems){for(this._updateEvents(this._items,this._pendingItems),this._items=this._pendingItems,this._pendingItems=null;this.element.firstElementChild!==this._titleElement;){var toRemove=this.element.firstElementChild;toRemove.parentNode.removeChild(toRemove)}_ElementUtilities.empty(this._surfaceElement)}attachItems(this),this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction,this._headersState.refreshHeadersState(!0),this._pendingRefresh=!1,this._firstLoad=!0,this.selectedIndex=this._selectedIndex,this._firstLoad=!1,this._recenterViewport()}},Pivot.prototype._parse=function(){for(var pivotItems=[],pivotItemEl=this.element.firstElementChild;pivotItemEl!==this._titleElement;){ControlProcessor.processAll(pivotItemEl);var pivotItemContent=pivotItemEl.winControl;if(!pivotItemContent)throw new _ErrorFromName("WinJS.UI.Pivot.InvalidContent",strings.invalidContent);pivotItems.push(pivotItemContent);var nextItemEl=pivotItemEl.nextElementSibling;pivotItemEl=nextItemEl}this.items=new BindingList.List(pivotItems)},Pivot.prototype._refresh=function(){this._pendingRefresh||(this._pendingRefresh=!0,Scheduler.schedule(this._applyProperties.bind(this),Scheduler.Priority.high))},Pivot.prototype._resizeHandler=function(){if(!this._disposed&&!this._pendingRefresh){var oldViewportWidth=this._getViewportWidth(),oldHeaderItemsWidth=this._getHeaderItemsWidth();this._invalidateMeasures(),oldViewportWidth!==this._getViewportWidth()||oldHeaderItemsWidth!==this._getHeaderItemsWidth()?(_Log.log&&_Log.log("_resizeHandler, viewport from:"+oldViewportWidth+" to: "+this._getViewportWidth()),_Log.log&&_Log.log("_resizeHandler, headers from:"+oldHeaderItemsWidth+" to: "+this._getHeaderItemsWidth()),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._recenterViewport(),this._headersState.handleResize()):_Log.log&&_Log.log("_resizeHandler worthless resize")}},Pivot.prototype._activateHeader=function(headerElement){if(!this.locked){var index=this._items.indexOf(headerElement._item);index!==this.selectedIndex?this._headersState.activateHeader(headerElement):_ElementUtilities._setActiveFirstFocusableElement(this.selectedItem.element)}},Pivot.prototype._goNext=function(){this.selectedIndex<this._items.length-1?this.selectedIndex++:this.selectedIndex=0},Pivot.prototype._goPrevious=function(){this._animateToPrevious=!0,this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this._items.length-1,this._animateToPrevious=!1},Pivot.prototype._loadItem=function(index){var _this=this;this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction,this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation.cancel();var goPrev=this._animateToPrevious,newItem=this._items.getAt(index),skipAnimation=this._firstLoad,thisLoadPromise=this._loadPromise=this._loadPromise.then(function(){var oldItem=_this._items.getAt(_this.selectedIndex);oldItem&&_this._hidePivotItem(oldItem.element,goPrev,skipAnimation);var oldIndex=_this._selectedIndex;_this._selectedIndex=index;var selectionChangedDetail={index:index,direction:goPrev?"backwards":"forward",item:newItem};return _this._fireEvent(_EventNames.selectionChanged,!0,!1,selectionChangedDetail),_this._headersState.handleNavigation(goPrev,index,oldIndex),Promise.join([newItem._process(),_this._hidePivotItemAnimation,Promise.timeout()]).then(function(){return _this._disposed||_this._loadPromise!==thisLoadPromise?void 0:(_this._recenterViewport(),_this._showPivotItem(newItem.element,goPrev,skipAnimation).then(function(){_this._disposed||_this._loadPromise!==thisLoadPromise||(_this._loadPromise=Promise.wrap(),_this._writeProfilerMark("itemAnimationStop,info"),_this._fireEvent(_EventNames.itemAnimationEnd,!0,!1,null))}))})})},Pivot.prototype._recenterViewport=function(){_ElementUtilities.setScrollPosition(this._viewportElement,{scrollLeft:this._getViewportWidth()}),this.selectedItem&&(this.selectedItem.element.style[this._getDirectionAccessor()]=this._getViewportWidth()+"px")},Pivot.prototype._fireEvent=function(type,canBubble,cancelable,detail){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(type,!!canBubble,!!cancelable,detail),this.element.dispatchEvent(event)},Pivot.prototype._getDirectionAccessor=function(){return this._rtl?"right":"left"},Pivot.prototype._getHeaderItemsWidth=function(){return this._headerItemsElWidth||(this._headerItemsElWidth=parseFloat(_ElementUtilities._getComputedStyle(this._headerItemsElement).width)),this._headerItemsElWidth||_invalidMeasurement},Pivot.prototype._getViewportWidth=function(){return this._viewportElWidth||(this._viewportElWidth=parseFloat(_ElementUtilities._getComputedStyle(this._viewportElement).width),supportsSnap&&(this._viewportElement.style[_BaseUtils._browserStyleEquivalents["scroll-snap-points-x"].scriptName]="snapInterval(0%, "+Math.ceil(this._viewportElWidth)+"px)")),this._viewportElWidth||_invalidMeasurement},Pivot.prototype._invalidateMeasures=function(){this._viewportElWidth=this._headerItemsElWidth=null},Pivot.prototype._updateEvents=function(oldItems,newItems){oldItems&&(oldItems.removeEventListener("itemchanged",this._handleItemChanged),oldItems.removeEventListener("iteminserted",this._handleItemInserted),oldItems.removeEventListener("itemmoved",this._handleItemMoved),oldItems.removeEventListener("itemremoved",this._handleItemRemoved),oldItems.removeEventListener("reload",this._handleItemReload)),newItems&&(newItems.addEventListener("itemchanged",this._handleItemChanged),newItems.addEventListener("iteminserted",this._handleItemInserted),newItems.addEventListener("itemmoved",this._handleItemMoved),newItems.addEventListener("itemremoved",this._handleItemRemoved),newItems.addEventListener("reload",this._handleItemReload))},Pivot.prototype._writeProfilerMark=function(text){var message="WinJS.UI.Pivot:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"pivotprofiler")},Pivot.prototype._handleItemChanged=function(ev){if(!this._pendingItems){var index=ev.detail.index,newItem=ev.detail.newValue,oldItem=ev.detail.oldValue;if(newItem.element!==oldItem.element){if(newItem.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateItem",strings.duplicateItem);newItem.element.style.display="none",this._surfaceElement.insertBefore(newItem.element,oldItem.element),this._surfaceElement.removeChild(oldItem.element),index===this.selectedIndex&&(this.selectedIndex=index)}this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._handleItemInserted=function(ev){if(!this._pendingItems){var index=ev.detail.index,item=ev.detail.value;if(item.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateItem",strings.duplicateItem);item.element.style.display="none",index<this.items.length-1?this._surfaceElement.insertBefore(item.element,this.items.getAt(index+1).element):this._surfaceElement.appendChild(item.element),index<=this.selectedIndex&&this._selectedIndex++,1===this._items.length&&(this.selectedIndex=0),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._handleItemMoved=function(ev){if(!this._pendingItems){var oldIndex=ev.detail.oldIndex,newIndex=ev.detail.newIndex,item=ev.detail.value;newIndex<this.items.length-1?this._surfaceElement.insertBefore(item.element,this.items.getAt(newIndex+1).element):this._surfaceElement.appendChild(item.element),oldIndex<this.selectedIndex&&newIndex>=this.selectedIndex?this._selectedIndex--:newIndex>this.selectedIndex&&oldIndex<=this.selectedIndex?this._selectedIndex++:oldIndex===this.selectedIndex&&(this.selectedIndex=this.selectedIndex),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._handleItemReload=function(){this.items=this.items},Pivot.prototype._handleItemRemoved=function(ev){if(!this._pendingItems){var item=ev.detail.value,index=ev.detail.index;this._surfaceElement.removeChild(item.element),index<this.selectedIndex?this._selectedIndex--:index===this._selectedIndex&&(this.selectedIndex=Math.min(this.items.length-1,this._selectedIndex)),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._elementClickedHandler=function(e){if(this.locked||this._navigationHandled)return void(this._navigationHandled=!1);var header,src=e.target;if(_ElementUtilities.hasClass(src,_Constants._ClassNames.pivotHeader))header=src;else{var hitSrcElement=!1,hitTargets=_ElementUtilities._elementsFromPoint(e.clientX,e.clientY);if(hitTargets&&hitTargets[0]===this._viewportElement)for(var i=0,len=hitTargets.length;len>i;i++)hitTargets[i]===src&&(hitSrcElement=!0),_ElementUtilities.hasClass(hitTargets[i],_Constants._ClassNames.pivotHeader)&&(header=hitTargets[i]);hitSrcElement||(header=null)}header&&this._activateHeader(header)},Pivot.prototype._elementPointerDownHandler=function(e){if(!supportsSnap){var element=e.target;this._elementPointerDownPoint={x:e.clientX,y:e.clientY,type:e.pointerType||"mouse",time:Date.now(),inHeaders:this._headersContainerElement.contains(element)}}},Pivot.prototype._elementPointerUpHandler=function(e){if(!this._elementPointerDownPoint||this.locked)return void(this._elementPointerDownPoint=null);var element=e.target,filterDistance=32,dyDxThresholdRatio=.4,dy=Math.abs(e.clientY-this._elementPointerDownPoint.y),dx=e.clientX-this._elementPointerDownPoint.x,thresholdY=Math.abs(dx*dyDxThresholdRatio),doSwipeDetection=thresholdY>dy&&Math.abs(dx)>filterDistance&&(!_ElementUtilities._supportsTouchDetection||this._elementPointerDownPoint.type===e.pointerType&&e.pointerType===PT_TOUCH)&&(!this.element.classList.contains(_Constants._ClassNames.pivotDisableContentSwipeNavigation)||this._elementPointerDownPoint.inHeaders&&this._headersContainerElement.contains(element));if(this._navigationHandled=!1,doSwipeDetection){var dt=Date.now()-this._elementPointerDownPoint.time;dx*=Math.max(1,Math.pow(350/dt,2)),dx=this._rtl?-dx:dx;var vwDiv4=this._getViewportWidth()/4;-vwDiv4>dx?(this._goNext(),this._navigationHandled=!0):dx>vwDiv4&&(this._goPrevious(),this._navigationHandled=!0)}if(!this._navigationHandled){for(;null!==element&&!_ElementUtilities.hasClass(element,_Constants._ClassNames.pivotHeader);)element=element.parentElement;null!==element&&(this._activateHeader(element),this._navigationHandled=!0)}this._elementPointerDownPoint=null},Pivot.prototype._headersKeyDown=function(e){this.locked||(e.keyCode===Keys.leftArrow||e.keyCode===Keys.pageUp?(this._rtl?this._goNext():this._goPrevious(),e.preventDefault()):(e.keyCode===Keys.rightArrow||e.keyCode===Keys.pageDown)&&(this._rtl?this._goPrevious():this._goNext(),e.preventDefault()))},Pivot.prototype._hideNavButtons=function(e){e&&this._headersContainerElement.contains(e.relatedTarget)||_ElementUtilities.removeClass(this._headersContainerElement,_Constants._ClassNames.pivotShowNavButtons)},Pivot.prototype._hidePivotItem=function(element,goPrevious,skipAnimation){return skipAnimation||!_TransitionAnimation.isAnimationEnabled()?(element.style.display="none",this._hidePivotItemAnimation=Promise.wrap(),this._hidePivotItemAnimation):(this._hidePivotItemAnimation=_TransitionAnimation.executeTransition(element,{property:"opacity",delay:0,duration:67,timing:"linear",from:"",to:"0"}).then(function(){element.style.display="none"}),this._hidePivotItemAnimation)},Pivot.prototype._MSManipulationStateChangedHandler=function(e){if(e.target===this._viewportElement&&e.currentState===_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_INERTIA){var delta=e.inertiaDestinationX-this._getViewportWidth();delta>0?this._goNext():0>delta&&this._goPrevious()}},Pivot.prototype._updatePointerType=function(e){this._pointerType!==(e.pointerType||PT_MOUSE)&&(this._pointerType=e.pointerType||PT_MOUSE,this._pointerType===PT_TOUCH?(_ElementUtilities.removeClass(this.element,_Constants._ClassNames.pivotInputTypeMouse),_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivotInputTypeTouch),this._hideNavButtons()):(_ElementUtilities.removeClass(this.element,_Constants._ClassNames.pivotInputTypeTouch),_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivotInputTypeMouse)))},Pivot.prototype._showNavButtons=function(e){this.locked||e&&e.pointerType===PT_TOUCH||_ElementUtilities.addClass(this._headersContainerElement,_Constants._ClassNames.pivotShowNavButtons)},Pivot.prototype._showPivotItem=function(element,goPrevious,skipAnimation){function filterOnScreen(element){var elementBoundingClientRect=element.getBoundingClientRect();return elementBoundingClientRect.top<viewportBoundingClientRect.bottom&&elementBoundingClientRect.bottom>viewportBoundingClientRect.top}if(this._writeProfilerMark("itemAnimationStart,info"),this._fireEvent(_EventNames.itemAnimationStart,!0,!1,null),element.style.display="",skipAnimation||!_TransitionAnimation.isAnimationEnabled())return element.style.opacity="",this._showPivotItemAnimation=Promise.wrap(),this._showPivotItemAnimation;var negativeTransform=this._rtl?!goPrevious:goPrevious,viewportBoundingClientRect=this._viewportElement.getBoundingClientRect(),slideGroup1Els=element.querySelectorAll(".win-pivot-slide1"),slideGroup2Els=element.querySelectorAll(".win-pivot-slide2"),slideGroup3Els=element.querySelectorAll(".win-pivot-slide3");return slideGroup1Els=Array.prototype.filter.call(slideGroup1Els,filterOnScreen),slideGroup2Els=Array.prototype.filter.call(slideGroup2Els,filterOnScreen),slideGroup3Els=Array.prototype.filter.call(slideGroup3Els,filterOnScreen),this._showPivotItemAnimation=Promise.join([_TransitionAnimation.executeTransition(element,{property:"opacity",delay:0,duration:333,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"0",to:""}),_TransitionAnimation.executeTransition(element,{property:_BaseUtils._browserStyleEquivalents.transform.cssName,delay:0,duration:767,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"translateX("+(negativeTransform?"-20px":"20px")+")",to:""}),Animations[negativeTransform?"slideRightIn":"slideLeftIn"](null,slideGroup1Els,slideGroup2Els,slideGroup3Els)]),this._showPivotItemAnimation},Pivot.supportedForProcessing=!0,Pivot._ClassNames=_Constants._ClassNames,Pivot._EventNames=_EventNames,Pivot}();exports.Pivot=Pivot;var HeaderStateBase=function(){function HeaderStateBase(pivot){this.pivot=pivot}return HeaderStateBase.prototype.exit=function(){},HeaderStateBase.prototype.render=function(goPrevious){},HeaderStateBase.prototype.activateHeader=function(header){},HeaderStateBase.prototype.handleNavigation=function(goPrevious,index,oldIndex){},HeaderStateBase.prototype.handleResize=function(){},HeaderStateBase.prototype.handleHeaderChanged=function(pivotItem){},HeaderStateBase.prototype.getCumulativeHeaderWidth=function(index){if(0===index)return 0;for(var originalLength=this.pivot._headersContainerElement.children.length,i=0;index>i;i++){var header=this.renderHeader(i,!1);this.pivot._headersContainerElement.appendChild(header)}var width=0,leftElement=this.pivot._rtl?this.pivot._headersContainerElement.lastElementChild:this.pivot._headersContainerElement.children[originalLength],rightElement=this.pivot._rtl?this.pivot._headersContainerElement.children[originalLength]:this.pivot._headersContainerElement.lastElementChild;width=rightElement.offsetLeft+rightElement.offsetWidth-leftElement.offsetLeft,width+=2*HeaderStateBase.headerHorizontalMargin;for(var i=0;index>i;i++)this.pivot._headersContainerElement.removeChild(this.pivot._headersContainerElement.lastElementChild);return width},HeaderStateBase.prototype.refreshHeadersState=function(invalidateCache){invalidateCache&&(this.cachedHeaderWidth=0);var width=this.cachedHeaderWidth||this.getCumulativeHeaderWidth(this.pivot.items.length);this.cachedHeaderWidth=width,width>this.pivot._getHeaderItemsWidth()&&!(this.pivot._headersState instanceof HeaderStateOverflow)?(this.exit(),this.pivot._headersState=new HeaderStateOverflow(this.pivot)):width<=this.pivot._getHeaderItemsWidth()&&!(this.pivot._headersState instanceof HeaderStateStatic)&&(this.exit(),this.pivot._headersState=new HeaderStateStatic(this.pivot))},HeaderStateBase.prototype.renderHeader=function(index,aria){function ariaSelectedMutated(){that.pivot._disposed||that.pivot._headersContainerElement.contains(headerContainerEl)&&index!==that.pivot.selectedIndex&&"true"===headerContainerEl.getAttribute("aria-selected")&&(that.pivot.selectedIndex=index)}var that=this,template=_ElementUtilities._syncRenderer(pivotDefaultHeaderTemplate),item=this.pivot.items.getAt(index),headerContainerEl=_Global.document.createElement("BUTTON");return headerContainerEl.tabIndex=-1,headerContainerEl.setAttribute("type","button"),headerContainerEl.style.marginLeft=headerContainerEl.style.marginRight=HeaderStateBase.headerHorizontalMargin+"px",_ElementUtilities.addClass(headerContainerEl,_Constants._ClassNames.pivotHeader),headerContainerEl._item=item,headerContainerEl._pivotItemIndex=index,template(item,headerContainerEl),aria&&(headerContainerEl.setAttribute("aria-selected",""+(index===this.pivot.selectedIndex)),headerContainerEl.setAttribute("role","tab"),new _ElementUtilities._MutationObserver(ariaSelectedMutated).observe(headerContainerEl,{attributes:!0,attributeFilter:["aria-selected"]})),headerContainerEl},HeaderStateBase.prototype.updateHeader=function(item){var index=this.pivot.items.indexOf(item),headerElement=this.pivot._headersContainerElement.children[index];headerElement.innerHTML="";var template=_ElementUtilities._syncRenderer(pivotDefaultHeaderTemplate);template(item,headerElement)},HeaderStateBase.prototype.setActiveHeader=function(newSelectedHeader){var focusWasInHeaders=!1,currentSelectedHeader=this.pivot._headersContainerElement.querySelector("."+_Constants._ClassNames.pivotHeaderSelected);currentSelectedHeader&&(currentSelectedHeader.classList.remove(_Constants._ClassNames.pivotHeaderSelected),currentSelectedHeader.setAttribute("aria-selected","false"),focusWasInHeaders=this.pivot._headersContainerElement.contains(_Global.document.activeElement)),newSelectedHeader.classList.add(_Constants._ClassNames.pivotHeaderSelected),newSelectedHeader.setAttribute("aria-selected","true"),focusWasInHeaders&&this.pivot._headersContainerElement.focus()},HeaderStateBase.headersContainerLeadingMargin=12,HeaderStateBase.headerHorizontalMargin=12,HeaderStateBase}(),HeaderStateStatic=function(_super){function HeaderStateStatic(pivot){if(_super.call(this,pivot),this._firstRender=!0,this._transitionAnimation=Promise.wrap(),pivot._headersContainerElement.children.length&&_TransitionAnimation.isAnimationEnabled()){var selectedHeader=pivot._headersContainerElement.querySelector("."+_Constants._ClassNames.pivotHeaderSelected),start=0,end=0;pivot._rtl?(start=selectedHeader.offsetLeft+selectedHeader.offsetWidth+HeaderStateBase.headerHorizontalMargin,end=pivot._getHeaderItemsWidth()-this.getCumulativeHeaderWidth(pivot.selectedIndex)-HeaderStateBase.headersContainerLeadingMargin,end+=parseFloat(pivot._headersContainerElement.style.marginLeft)):(start=selectedHeader.offsetLeft,start+=parseFloat(pivot._headersContainerElement.style.marginLeft),end=this.getCumulativeHeaderWidth(pivot.selectedIndex)+HeaderStateBase.headersContainerLeadingMargin+HeaderStateBase.headerHorizontalMargin);var offset=start-end;this.render();for(var transformProperty=_BaseUtils._browserStyleEquivalents.transform.cssName,transformValue="translateX("+offset+"px)",i=0,l=pivot._headersContainerElement.children.length;l>i;i++)pivot._headersContainerElement.children[i].style[transformProperty]=transformValue;this._transitionAnimation=_TransitionAnimation.executeTransition(pivot._headersContainerElement.querySelectorAll("."+_Constants._ClassNames.pivotHeader),{property:transformProperty,delay:0,duration:_headerSlideAnimationDuration,timing:"ease-out",to:""})}else this.render()}return __extends(HeaderStateStatic,_super),HeaderStateStatic.prototype.exit=function(){this._transitionAnimation.cancel()},HeaderStateStatic.prototype.render=function(){var pivot=this.pivot;if(!pivot._pendingRefresh&&pivot._items){if(_Dispose._disposeElement(pivot._headersContainerElement),_ElementUtilities.empty(pivot._headersContainerElement),pivot._rtl?(pivot._headersContainerElement.style.marginLeft="0px",pivot._headersContainerElement.style.marginRight=HeaderStateBase.headersContainerLeadingMargin+"px"):(pivot._headersContainerElement.style.marginLeft=HeaderStateBase.headersContainerLeadingMargin+"px",pivot._headersContainerElement.style.marginRight="0px"),pivot._viewportElement.style.overflow=1===pivot.items.length?"hidden":"",pivot.items.length)for(var i=0;i<pivot.items.length;i++){var header=this.renderHeader(i,!0);pivot._headersContainerElement.appendChild(header),i===pivot.selectedIndex&&header.classList.add(_Constants._ClassNames.pivotHeaderSelected)}this._firstRender=!1}},HeaderStateStatic.prototype.activateHeader=function(headerElement){this.setActiveHeader(headerElement),this.pivot._animateToPrevious=headerElement._pivotItemIndex<this.pivot.selectedIndex,this.pivot.selectedIndex=headerElement._pivotItemIndex,this.pivot._animateToPrevious=!1},HeaderStateStatic.prototype.handleNavigation=function(goPrevious,index,oldIndex){this._firstRender&&this.render(),this.setActiveHeader(this.pivot._headersContainerElement.children[index])},HeaderStateStatic.prototype.handleResize=function(){this.refreshHeadersState(!1)},HeaderStateStatic.prototype.handleHeaderChanged=function(pivotItem){this.updateHeader(pivotItem),this.refreshHeadersState(!0)},HeaderStateStatic}(HeaderStateBase),HeaderStateOverflow=function(_super){function HeaderStateOverflow(pivot){if(_super.call(this,pivot),this._blocked=!1,this._firstRender=!0,this._transitionAnimation=Promise.wrap(),pivot._slideHeadersAnimation=Promise.wrap(),pivot._headersContainerElement.children.length&&_TransitionAnimation.isAnimationEnabled()){var that=this,done=function(){that._blocked=!1,that.render()};this._blocked=!0;var selectedHeader=pivot._headersContainerElement.querySelector("."+_Constants._ClassNames.pivotHeaderSelected),start=0,end=0;pivot._rtl?(start=pivot._getHeaderItemsWidth()-HeaderStateBase.headersContainerLeadingMargin,end=selectedHeader.offsetLeft,end+=HeaderStateBase.headerHorizontalMargin,end+=selectedHeader.offsetWidth,end+=parseFloat(pivot._headersContainerElement.style.marginLeft)):(start=HeaderStateBase.headersContainerLeadingMargin,end=selectedHeader.offsetLeft,end-=HeaderStateBase.headerHorizontalMargin,end+=parseFloat(pivot._headersContainerElement.style.marginLeft));for(var offset=start-end,i=0;i<pivot.selectedIndex;i++)pivot._headersContainerElement.appendChild(pivot._headersContainerElement.children[i].cloneNode(!0));var transformProperty=_BaseUtils._browserStyleEquivalents.transform.cssName;this._transitionAnimation=_TransitionAnimation.executeTransition(pivot._headersContainerElement.querySelectorAll("."+_Constants._ClassNames.pivotHeader),{property:transformProperty,delay:0,duration:_headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+offset+"px)"}).then(done,done)}else this.render()}return __extends(HeaderStateOverflow,_super),HeaderStateOverflow.prototype.exit=function(){this._transitionAnimation.cancel(),this.pivot._slideHeadersAnimation.cancel()},HeaderStateOverflow.prototype.render=function(goPrevious){var pivot=this.pivot;if(!this._blocked&&!pivot._pendingRefresh&&pivot._items){var restoreFocus=pivot._headersContainerElement.contains(_Global.document.activeElement);if(_Dispose._disposeElement(pivot._headersContainerElement),_ElementUtilities.empty(pivot._headersContainerElement),1===pivot._items.length){var header=this.renderHeader(0,!0);header.classList.add(_Constants._ClassNames.pivotHeaderSelected),pivot._headersContainerElement.appendChild(header),pivot._viewportElement.style.overflow="hidden",pivot._headersContainerElement.style.marginLeft="0px",pivot._headersContainerElement.style.marginRight="0px"}else if(pivot._items.length>1){var numberOfHeadersToRender=pivot._items.length+(goPrevious?2:1),maxHeaderWidth=.8*pivot._getHeaderItemsWidth(),indexToRender=pivot.selectedIndex-1;pivot._viewportElement.style.overflow&&(pivot._viewportElement.style.overflow="");for(var i=0;numberOfHeadersToRender>i;i++){-1===indexToRender?indexToRender=pivot._items.length-1:indexToRender===pivot._items.length&&(indexToRender=0);
var header=this.renderHeader(indexToRender,!0);pivot._headersContainerElement.appendChild(header),header.offsetWidth>maxHeaderWidth&&(header.style.textOverflow="ellipsis",header.style.width=maxHeaderWidth+"px"),indexToRender===pivot.selectedIndex&&header.classList.add(_Constants._ClassNames.pivotHeaderSelected),indexToRender++}if(!pivot._firstLoad&&!this._firstRender){var start,end;goPrevious?(start="",end="0"):(start="0",end="");var lastHeader=pivot._headersContainerElement.children[numberOfHeadersToRender-1];lastHeader.style.opacity=start;var lastHeaderFadeInDuration=.167;lastHeader.style[_BaseUtils._browserStyleEquivalents.transition.scriptName]="opacity "+_TransitionAnimation._animationTimeAdjustment(lastHeaderFadeInDuration)+"s",_ElementUtilities._getComputedStyle(lastHeader).opacity,lastHeader.style.opacity=end}pivot._headersContainerElement.children[0].setAttribute("aria-hidden","true"),pivot._headersContainerElement.style.marginLeft="0px",pivot._headersContainerElement.style.marginRight="0px";var leadingMargin=pivot._rtl?"marginRight":"marginLeft",firstHeader=pivot._headersContainerElement.children[0],leadingSpace=_ElementUtilities.getTotalWidth(firstHeader)-HeaderStateBase.headersContainerLeadingMargin;if(firstHeader!==pivot._headersContainerElement.children[0])return;pivot._headersContainerElement.style[leadingMargin]=-1*leadingSpace+"px",pivot._prevButton=_Global.document.createElement("button"),pivot._prevButton.setAttribute("type","button"),_ElementUtilities.addClass(pivot._prevButton,_Constants._ClassNames.pivotNavButton),_ElementUtilities.addClass(pivot._prevButton,_Constants._ClassNames.pivotNavButtonPrev),pivot._prevButton.addEventListener("click",function(){pivot.locked||(pivot._rtl?pivot._goNext():pivot._goPrevious())}),pivot._headersContainerElement.appendChild(pivot._prevButton),pivot._prevButton.style.left=pivot._rtl?"0px":leadingSpace+"px",pivot._nextButton=_Global.document.createElement("button"),pivot._nextButton.setAttribute("type","button"),_ElementUtilities.addClass(pivot._nextButton,_Constants._ClassNames.pivotNavButton),_ElementUtilities.addClass(pivot._nextButton,_Constants._ClassNames.pivotNavButtonNext),pivot._nextButton.addEventListener("click",function(){pivot.locked||(pivot._rtl?pivot._goPrevious():pivot._goNext())}),pivot._headersContainerElement.appendChild(pivot._nextButton),pivot._nextButton.style.right=pivot._rtl?leadingSpace+"px":"0px"}pivot._headersContainerElement.children.length>1?1:0;restoreFocus&&pivot._headersContainerElement.focus(),this._firstRender=!1}},HeaderStateOverflow.prototype.activateHeader=function(headerElement){headerElement.previousSibling&&(this.pivot.selectedIndex=headerElement._pivotItemIndex)},HeaderStateOverflow.prototype.handleNavigation=function(goPrevious,index,oldIndex){function offset(element){return rtl?element.offsetParent.offsetWidth-element.offsetLeft-element.offsetWidth:element.offsetLeft}function headerCleanup(){pivot._disposed||(that.render(goPrevious),pivot._slideHeadersAnimation=Promise.wrap())}var that=this,pivot=this.pivot;if(this._blocked||0>index||pivot._firstLoad)return void this.render(goPrevious);var targetHeader;if(goPrevious?targetHeader=pivot._headersContainerElement.children[0]:(oldIndex>index&&(index+=pivot._items.length),targetHeader=pivot._headersContainerElement.children[1+index-oldIndex]),!targetHeader)return void this.render(goPrevious);_ElementUtilities.removeClass(pivot._headersContainerElement.children[1],_Constants._ClassNames.pivotHeaderSelected),_ElementUtilities.addClass(targetHeader,_Constants._ClassNames.pivotHeaderSelected);var rtl=pivot._rtl,endPosition=offset(pivot._headersContainerElement.children[1])-offset(targetHeader);rtl&&(endPosition*=-1);var headerAnimation;headerAnimation=_TransitionAnimation.isAnimationEnabled()?_TransitionAnimation.executeTransition(pivot._headersContainerElement.querySelectorAll("."+_Constants._ClassNames.pivotHeader),{property:_BaseUtils._browserStyleEquivalents.transform.cssName,delay:0,duration:_headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+endPosition+"px)"}):Promise.wrap(),pivot._slideHeadersAnimation=headerAnimation.then(headerCleanup,headerCleanup)},HeaderStateOverflow.prototype.handleResize=function(){this.refreshHeadersState(!1)},HeaderStateOverflow.prototype.handleHeaderChanged=function(pivotItem){this.render(),this.refreshHeadersState(!0)},HeaderStateOverflow}(HeaderStateBase);_Base.Class.mix(Pivot,_Events.createEventProperties(_EventNames.itemAnimationEnd,_EventNames.itemAnimationStart,_EventNames.selectionChanged)),_Base.Class.mix(Pivot,_Control.DOMEventMixin)}),define("WinJS/Controls/Pivot",["require","exports","../Core/_Base","./Pivot/_Item"],function(require,exports,_Base,_Item){_Item.touch;var module=null;_Base.Namespace.define("WinJS.UI",{Pivot:{get:function(){return module||require(["./Pivot/_Pivot"],function(m){module=m}),module.Pivot}}})}),define("WinJS/Controls/Hub/_Section",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,ControlProcessor,Promise,_Control,_Dispose,_ElementUtilities,_KeyboardBehavior){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{HubSection:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get seeMore(){return _Resources._getWinJSString("ui/seeMore").value}},HubSection=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.HubSection.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,HubSection._ClassName.hubSection),_ElementUtilities.addClass(this.element,"win-disposable"),this._headerElement=_Global.document.createElement("DIV"),this._headerElement.className=HubSection._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+HubSection._ClassName.hubSectionInteractive+" "+HubSection._ClassName.hubSectionHeaderTabStop+'"><div class="'+HubSection._ClassName.hubSectionHeaderWrapper+'" tabindex="-1"><h2 class="win-type-subheader '+HubSection._ClassName.hubSectionHeaderContent+'"></h2><span class="'+HubSection._ClassName.hubSectionHeaderChevron+' win-type-body">'+strings.seeMore+"</span></div></button>",this._headerTabStopElement=this._headerElement.firstElementChild,this._headerWrapperElement=this._headerTabStopElement.firstElementChild,this._headerContentElement=this._headerWrapperElement.firstElementChild,this._headerChevronElement=this._headerWrapperElement.lastElementChild,element.appendChild(this._headerElement),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._headerElement),this._contentElement=_Global.document.createElement("DIV"),this._contentElement.className=HubSection._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",element.appendChild(this._contentElement);for(var elementToMove=this.element.firstChild;elementToMove!==this._headerElement;){var nextElement=elementToMove.nextSibling;this._contentElement.appendChild(elementToMove),elementToMove=nextElement}this._processors=[ControlProcessor.processAll],_Control.setOptions(this,options)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(value){this._isHeaderStatic=value,this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),_ElementUtilities.removeClass(this._headerTabStopElement,HubSection._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),_ElementUtilities.addClass(this._headerTabStopElement,HubSection._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(value){this._header=value,this._renderHeader()}},_setHeaderTemplate:function(template){this._template=_ElementUtilities._syncRenderer(template),this._renderHeader()},_renderHeader:function(){this._template&&(_Dispose._disposeElement(this._headerContentElement),_ElementUtilities.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var that=this;return this._processed=(this._processors||[]).reduce(function(promise,processor){return promise.then(function(){return processor(that.contentElement)})},this._processed||Promise.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,_Dispose._disposeElement(this._headerContentElement),_Dispose.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionHeaderWrapper:"win-hub-section-header-wrapper",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},isDeclarativeControlContainer:_BaseUtils.markSupportedForProcessing(function(section,callback){callback!==ControlProcessor.processAll&&(section._processors=section._processors||[],section._processors.push(callback),section._processed&&section._process())})});return HubSection})})}),define("require-style!less/styles-hub",[],function(){}),define("require-style!less/colors-hub",[],function(){}),define("WinJS/Controls/Hub",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../_Accents","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../_Signal","../Scheduler","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_UI","./Hub/_Section","require-style!less/styles-hub","require-style!less/colors-hub"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,_Accents,Animations,_TransitionAnimation,BindingList,ControlProcessor,Promise,_Signal,Scheduler,_Control,_ElementUtilities,_Hoverable,_UI,_Section){"use strict";_Accents.createAccentRule(".win-semanticzoom-zoomedoutview .win-hub-section-header-interactive .win-hub-section-header-content,             .win-hub-section-header-interactive .win-hub-section-header-chevron",[{name:"color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{Hub:_Base.Namespace._lazy(function(){function hubDefaultHeaderTemplate(section){var element=_Global.document.createTextNode("object"==typeof section.header?JSON.stringify(section.header):""+section.header);return element}var Key=_ElementUtilities.Key,createEvent=_Events._createEventProperty,eventNames={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},progressDelay=500,verticalNames={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},rtlHorizontalNames={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},ltrHorizontalNames={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},Hub=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateConstruction",strings.duplicateConstruction);this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this),_Global.addEventListener("keydown",this._windowKeyDownHandlerBound),element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,Hub._ClassName.hub),_ElementUtilities.addClass(this.element,"win-disposable"),this._viewportElement=_Global.document.createElement("DIV"),this._viewportElement.className=Hub._ClassName.hubViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",strings.hubViewportAriaLabel),this._surfaceElement=_Global.document.createElement("DIV"),this._surfaceElement.className=Hub._ClassName.hubSurface,this._viewportElement.appendChild(this._surfaceElement),this._visible=!1,this._viewportElement.style.opacity=0,options.orientation||(this._orientation=_UI.Orientation.horizontal,_ElementUtilities.addClass(this.element,Hub._ClassName.hubHorizontal)),this._fireEntrance=!0,this._animateEntrance=!0,this._loadId=0,this.runningAnimations=new Promise.wrap,this._currentIndexForSezo=0,this._parse(),_Control.setOptions(this,options),_ElementUtilities._addEventListener(this.element,"focusin",this._focusin.bind(this),!1),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this.element.addEventListener("click",this._clickHandler.bind(this)),this._resizeHandlerBound=this._resizeHandler.bind(this),this.element.addEventListener("mselementresize",this._resizeHandlerBound),_ElementUtilities._resizeNotifier.subscribe(this.element,this._resizeHandlerBound),this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._surfaceElement.addEventListener("mselementresize",this._contentResizeHandler.bind(this)),this._handleSectionChangedBind=this._handleSectionChanged.bind(this),this._handleSectionInsertedBind=this._handleSectionInserted.bind(this),this._handleSectionMovedBind=this._handleSectionMoved.bind(this),this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this),this._handleSectionReloadBind=this._handleSectionReload.bind(this),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(value){if(value!==this._orientation){if(this._measured=!1,this._names){var newScrollPos={};newScrollPos[this._names.scrollPos]=0,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}value===_UI.Orientation.vertical?(_ElementUtilities.removeClass(this.element,Hub._ClassName.hubHorizontal),_ElementUtilities.addClass(this.element,Hub._ClassName.hubVertical)):(value=_UI.Orientation.horizontal,_ElementUtilities.removeClass(this.element,Hub._ClassName.hubVertical),_ElementUtilities.addClass(this.element,Hub._ClassName.hubHorizontal)),this._orientation=value,Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle)}}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(value){var resetScrollPosition=!this._pendingSections;this._pendingSections=value,this._refresh(),resetScrollPosition&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=hubDefaultHeaderTemplate),this._headerTemplate)},set:function(value){this._pendingHeaderTemplate=value||hubDefaultHeaderTemplate,this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(value){if(value=Math.max(0,value),this._pendingRefresh)this._pendingScrollLocation=value,this._pendingSectionOnScreen=null;else{this._measure();var targetScrollPos=Math.max(0,Math.min(this._scrollLength-this._viewportSize,value));this._scrollPosition=targetScrollPos;var newScrollPos={};newScrollPos[this._names.scrollPos]=targetScrollPos,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}}},sectionOnScreen:{get:function(){if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;this._measure();for(var i=0;i<this._sectionSizes.length;i++){var sectionSize=this._sectionSizes[i];if(sectionSize.offset+sectionSize.size-sectionSize.borderEnd-sectionSize.paddingEnd>this._scrollPosition+this._startSpacer+sectionSize.borderStart+sectionSize.paddingStart)return i}return-1},set:function(value){value=Math.max(0,value),this._pendingRefresh?(this._pendingSectionOnScreen=value,this._pendingScrollLocation=null):(this._measure(),value>=0&&value<this._sectionSizes.length&&this._scrollToSection(value))}},indexOfFirstVisible:{get:function(){this._measure();for(var i=0;i<this._sectionSizes.length;i++){var sectionSize=this._sectionSizes[i];if(sectionSize.offset+sectionSize.size-sectionSize.borderEnd-sectionSize.paddingEnd>this._scrollPosition)return i}return-1}},indexOfLastVisible:{get:function(){this._measure();for(var i=this._sectionSizes.length-1;i>=0;i--){var sectionSize=this._sectionSizes[i];if(sectionSize.offset+sectionSize.paddingStart+sectionSize.borderStart<this._scrollPosition+this._viewportSize)return i}return-1}},onheaderinvoked:createEvent(eventNames.headerInvoked),onloadingstatechanged:createEvent(eventNames.loadingStateChanged),oncontentanimating:createEvent(eventNames.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(Hub.LoadingState.loading),this._pendingRefresh=!0,Scheduler.schedule(this._refreshImpl.bind(this),Scheduler.Priority.high))},_refreshImpl:function(){if(!this._disposed){var fadeOutAnimation=Promise.wrap();if(this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,_TransitionAnimation.isAnimationEnabled()))){var animateTransition=this._fireEvent(Hub._EventName.contentAnimating,{type:Hub.AnimationType.contentTransition});animateTransition&&(this._viewportElement.style["-ms-overflow-style"]="none",fadeOutAnimation=Animations.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=animateTransition}fadeOutAnimation.done(this._applyProperties.bind(this))}},_applyProperties:function(){if(!this._disposed){this._pendingRefresh=!1;var needsToLoadSections=!1;if(this._pendingSections){for(needsToLoadSections=!0,this._updateEvents(this._sections,this._pendingSections),this._sections=this._pendingSections,this._pendingSections=null;this.element.firstElementChild!==this._viewportElement;){var toRemove=this.element.firstElementChild;toRemove.parentNode.removeChild(toRemove)}_ElementUtilities.empty(this._surfaceElement)}this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null),this._assignHeaderTemplate(),needsToLoadSections&&this._attachSections(),+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:+this._pendingScrollLocation===this._pendingScrollLocation?this.scrollPosition=this._pendingScrollLocation:this.scrollPosition=0,this._pendingSectionOnScreen=null,this._pendingScrollLocation=null,this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionChanged:function(ev){if(!this._pendingSections){var newSection=ev.detail.newValue,oldSection=ev.detail.oldValue;if(newSection._setHeaderTemplate(this.headerTemplate),newSection.element!==oldSection.element){if(newSection.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateSection",strings.duplicateSection);this._surfaceElement.insertBefore(newSection.element,oldSection.element),this._surfaceElement.removeChild(oldSection.element),this._measured=!1,this._setState(Hub.LoadingState.loading),this._loadSections()}}},_handleSectionInserted:function(ev){if(!this._pendingSections){var index=ev.detail.index,section=ev.detail.value;section._animation&&section._animation.cancel();var animation,result=this._fireEvent(Hub._EventName.contentAnimating,{type:Hub.AnimationType.insert,index:index,section:section});if(result){for(var affectedElements=[],i=index+1;i<this.sections.length;i++)affectedElements.push(this.sections.getAt(i).element);animation=new Animations._createUpdateListAnimation([section.element],[],affectedElements)}if(section.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateSection",strings.duplicateSection);if(section._setHeaderTemplate(this.headerTemplate),index<this.sections.length-1?this._surfaceElement.insertBefore(section.element,this.sections.getAt(index+1).element):this._surfaceElement.appendChild(section.element),this._measured=!1,animation){var insertAnimation=animation.execute();this.runningAnimations=Promise.join([this.runningAnimations,insertAnimation])}this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionMoved:function(ev){if(!this._pendingSections){var newIndex=ev.detail.newIndex,section=ev.detail.value;newIndex<this.sections.length-1?this._surfaceElement.insertBefore(section.element,this.sections.getAt(newIndex+1).element):this._surfaceElement.appendChild(section.element),this._measured=!1,this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionRemoved:function(ev){if(!this._pendingSections){var section=ev.detail.value,index=ev.detail.index,animationPromise=Promise.wrap(),result=this._fireEvent(Hub._EventName.contentAnimating,{type:Hub.AnimationType.remove,index:index,section:section});if(result){for(var affectedElements=[],i=index;i<this.sections.length;i++)affectedElements.push(this.sections.getAt(i).element);var animation=new Animations._createUpdateListAnimation([],[section.element],affectedElements);this._measure();var offsetTop=section.element.offsetTop,offsetLeft=section.element.offsetLeft;section.element.style.position="absolute",section.element.style.top=offsetTop,section.element.style.left=offsetLeft,section.element.style.opacity=0,this._measured=!1,animationPromise=animation.execute().then(function(){section.element.style.position="",section.element.style.top="",section.element.style.left="",section.element.style.opacity=1}.bind(this))}animationPromise.done(function(){this._disposed||(this._surfaceElement.removeChild(section.element),this._measured=!1)}.bind(this)),section._animation=animationPromise,this.runningAnimations=Promise.join([this.runningAnimations,animationPromise]),this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(oldSections,newSections){oldSections&&(oldSections.removeEventListener("itemchanged",this._handleSectionChangedBind),oldSections.removeEventListener("iteminserted",this._handleSectionInsertedBind),oldSections.removeEventListener("itemmoved",this._handleSectionMovedBind),oldSections.removeEventListener("itemremoved",this._handleSectionRemovedBind),oldSections.removeEventListener("reload",this._handleSectionReloadBind)),newSections&&(newSections.addEventListener("itemchanged",this._handleSectionChangedBind),newSections.addEventListener("iteminserted",this._handleSectionInsertedBind),newSections.addEventListener("itemmoved",this._handleSectionMovedBind),newSections.addEventListener("itemremoved",this._handleSectionRemovedBind),newSections.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){this._measured=!1;for(var i=0;i<this.sections.length;i++){var section=this._sections.getAt(i);if(section._animation&&section._animation.cancel(),section.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateSection",strings.duplicateSection);this._surfaceElement.appendChild(section.element)}},_assignHeaderTemplate:function(){this._measured=!1;for(var i=0;i<this.sections.length;i++){var section=this._sections.getAt(i);section._setHeaderTemplate(this.headerTemplate)}},_loadSection:function(index){var section=this._sections.getAt(index);return section._process().then(function(){var style=section.contentElement.style;""!==style.visibility&&(style.visibility="")})},_loadSections:function(){function loadNextSectionAfterPromise(promise){promise.then(function(){Scheduler.schedule(loadNextSection,Scheduler.Priority.idle)})}function loadNextSection(){if(loadId===that._loadId&&!that._disposed)if(sectionIndicesToLoad.length){var index=sectionIndicesToLoad.shift(),loadedPromise=that._loadSection(index);loadNextSectionAfterPromise(loadedPromise)}else allSectionsLoadedSignal.complete()}this._loadId++;var loadId=this._loadId,that=this,onScreenItemsAnimatedPromise=Promise.wrap(),sectionIndicesToLoad=[],allSectionsLoadedPromise=Promise.wrap();if(this._showProgressPromise||(this._showProgressPromise=Promise.timeout(progressDelay).then(function(){this._disposed||(this._progressBar||(this._progressBar=_Global.document.createElement("progress"),_ElementUtilities.addClass(this._progressBar,Hub._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){var allSectionsLoadedSignal=new _Signal;allSectionsLoadedPromise=allSectionsLoadedSignal.promise;for(var synchronousProcessPromises=[],start=Math.max(0,this.indexOfFirstVisible),end=Math.max(0,this.indexOfLastVisible),i=start;end>=i;i++)synchronousProcessPromises.push(this._loadSection(i));for(start--,end++;start>=0||end<this.sections.length;)end<this.sections.length&&(sectionIndicesToLoad.push(end),end++),start>=0&&(sectionIndicesToLoad.push(start),start--);var onScreenSectionsLoadedPromise=Promise.join(synchronousProcessPromises);onScreenSectionsLoadedPromise.done(function(){loadId!==this._loadId||that._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),Scheduler.schedule(function(){if(loadId===this._loadId&&!that._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&_TransitionAnimation.isAnimationEnabled()){var eventDetail={type:Hub.AnimationType.entrance};(!this._fireEntrance||this._fireEvent(Hub._EventName.contentAnimating,eventDetail))&&(this._viewportElement.style["-ms-overflow-style"]="none",onScreenItemsAnimatedPromise=Animations.enterContent(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]="",this._viewportElement.onmousewheel=function(){}}.bind(this)))}this._element===_Global.document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},Scheduler.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this)),loadNextSectionAfterPromise(onScreenSectionsLoadedPromise)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);Promise.join([this.runningAnimations,onScreenItemsAnimatedPromise,allSectionsLoadedPromise]).done(function(){loadId!==this._loadId||that._disposed||(this.runningAnimations=Promise.wrap(),this._measured&&this._scrollLength!==this._viewportElement[this._names.scrollSize]&&(this._measured=!1),this._setState(Hub.LoadingState.complete),Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(state){if(state!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+state+",info"),this._loadingState=state;var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(Hub._EventName.loadingStateChanged,!0,!1,{loadingState:state}),this._element.dispatchEvent(eventObject)}},_parse:function(){for(var hubSections=[],hubSectionEl=this.element.firstElementChild;hubSectionEl!==this._viewportElement;){ControlProcessor.processAll(hubSectionEl);var hubSectionContent=hubSectionEl.winControl;if(!hubSectionContent)throw new _ErrorFromName("WinJS.UI.Hub.InvalidContent",strings.invalidContent);hubSections.push(hubSectionContent);var nextSectionEl=hubSectionEl.nextElementSibling;hubSectionEl=nextSectionEl}this.sections=new BindingList.List(hubSections)},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(type,!0,!0,detail),this.element.dispatchEvent(event)},_findHeaderTabStop:function(element){if(element.parentNode&&_ElementUtilities._matchesSelector(element,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!_ElementUtilities.hasClass(element,"win-hub-section-header-tabstop");)element=element.parentElement;return element}return null},_isInteractive:function(element){for(;element&&element!==_Global.document.body;){if(_ElementUtilities.hasClass(element,"win-interactive"))return!0;element=element.parentElement}return!1},_clickHandler:function(ev){var headerTabStopElement=this._findHeaderTabStop(ev.target);if(headerTabStopElement&&!this._isInteractive(ev.target)){var section=headerTabStopElement.parentElement.parentElement.winControl;if(!section.isHeaderStatic){var sectionIndex=this.sections.indexOf(section);this._fireEvent(Hub._EventName.headerInvoked,{index:sectionIndex,section:section})}}},_resizeHandler:function(){this._measured=!1,Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle)},_contentResizeHandler:function(){this._measured=!1,Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle)},_scrollHandler:function(){this._measured=!1,this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=_BaseUtils._requestAnimationFrame(function(){this._pendingScrollHandler=null,this._pendingSections||this.loadingState!==Hub.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){if(!this._measured||0===this._scrollLength){this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction,this.orientation===_UI.Orientation.vertical?this._names=verticalNames:this._rtl?this._names=rtlHorizontalNames:this._names=ltrHorizontalNames,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=_ElementUtilities.getScrollPosition(this._viewportElement)[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize];var surfaceElementComputedStyle=_ElementUtilities._getComputedStyle(this._surfaceElement);this._startSpacer=parseFloat(surfaceElementComputedStyle[this._names.marginStart])+parseFloat(surfaceElementComputedStyle[this._names.borderStart])+parseFloat(surfaceElementComputedStyle[this._names.paddingStart]),this._endSpacer=parseFloat(surfaceElementComputedStyle[this._names.marginEnd])+parseFloat(surfaceElementComputedStyle[this._names.borderEnd])+parseFloat(surfaceElementComputedStyle[this._names.paddingEnd]),this._sectionSizes=[];for(var i=0;i<this.sections.length;i++){var section=this.sections.getAt(i),computedSectionStyle=_ElementUtilities._getComputedStyle(section.element);
this._sectionSizes[i]={offset:section.element[this._names.offsetPos],size:section.element[this._names.offsetSize],marginStart:parseFloat(computedSectionStyle[this._names.marginStart]),marginEnd:parseFloat(computedSectionStyle[this._names.marginEnd]),borderStart:parseFloat(computedSectionStyle[this._names.borderStart]),borderEnd:parseFloat(computedSectionStyle[this._names.borderEnd]),paddingStart:parseFloat(computedSectionStyle[this._names.paddingStart]),paddingEnd:parseFloat(computedSectionStyle[this._names.paddingEnd])},this._rtl&&this.orientation===_UI.Orientation.horizontal&&(this._sectionSizes[i].offset=this._viewportSize-(this._sectionSizes[i].offset+this._sectionSizes[i].size))}this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){this._writeProfilerMark("updateSnapList,StartTM"),this._measure();for(var snapList="snapList(",i=0;i<this._sectionSizes.length;i++){i>0&&(snapList+=",");var sectionSize=this._sectionSizes[i];snapList+=sectionSize.offset-sectionSize.marginStart-this._startSpacer+"px"}snapList+=")";var snapListY="",snapListX="";this.orientation===_UI.Orientation.vertical?snapListY=snapList:snapListX=snapList,this._lastSnapPointY!==snapListY&&(this._lastSnapPointY=snapListY,this._viewportElement.style["-ms-scroll-snap-points-y"]=snapListY),this._lastSnapPointX!==snapListX&&(this._lastSnapPointX=snapListX,this._viewportElement.style["-ms-scroll-snap-points-x"]=snapListX),this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(index,withAnimation){this._measure();var sectionSize=this._sectionSizes[index],scrollPositionToShowStartMargin=Math.min(this._scrollLength-this._viewportSize,sectionSize.offset-sectionSize.marginStart-this._startSpacer);this._scrollTo(scrollPositionToShowStartMargin,withAnimation)},_ensureVisible:function(index,withAnimation){this._measure();var targetScrollPos=this._ensureVisibleMath(index,this._scrollPosition);this._scrollTo(targetScrollPos,withAnimation)},_ensureVisibleMath:function(index,targetScrollPos){this._measure();var sectionSize=this._sectionSizes[index],scrollPositionToShowStartMargin=Math.min(this._scrollLength-this._viewportSize,sectionSize.offset-sectionSize.marginStart-this._startSpacer),scrollPositionToShowEndMargin=Math.max(0,sectionSize.offset+sectionSize.size+sectionSize.marginEnd+this._endSpacer-this._viewportSize+1);return targetScrollPos>scrollPositionToShowStartMargin?targetScrollPos=scrollPositionToShowStartMargin:scrollPositionToShowEndMargin>targetScrollPos&&(targetScrollPos=Math.min(scrollPositionToShowStartMargin,scrollPositionToShowEndMargin)),targetScrollPos},_scrollTo:function(scrollPos,withAnimation){if(this._scrollPosition=scrollPos,withAnimation)this.orientation===_UI.Orientation.vertical?_ElementUtilities._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):_ElementUtilities._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0});else{var newScrollPos={};newScrollPos[this._names.scrollPos]=this._scrollPosition,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}},_windowKeyDownHandler:function(ev){if(ev.keyCode===Key.tab){this._tabSeenLast=!0;var that=this;_BaseUtils._yieldForEvents(function(){that._tabSeenLast=!1})}},_focusin:function(ev){if(this._tabSeenLast){var headerTabStopElement=this._findHeaderTabStop(ev.target);if(headerTabStopElement&&!this._isInteractive(ev.target)){var sectionIndex=this.sections.indexOf(headerTabStopElement.parentElement.parentElement.winControl);sectionIndex>-1&&this._ensureVisible(sectionIndex,!0)}}for(var sectionElement=ev.target;sectionElement&&!_ElementUtilities.hasClass(sectionElement,_Section.HubSection._ClassName.hubSection);)sectionElement=sectionElement.parentElement;if(sectionElement){var sectionIndex=this.sections.indexOf(sectionElement.winControl);sectionIndex>-1&&(this._currentIndexForSezo=sectionIndex)}if(ev.target===this.element){var indexToFocus;+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(indexToFocus=this._sectionToFocus,this._sectionToFocus=null):indexToFocus=this.sectionOnScreen,this._moveFocusIn(indexToFocus)}},_moveFocusIn:function(indexToFocus){if(indexToFocus>=0){for(var i=indexToFocus;i<this.sections.length;i++){var section=this.sections.getAt(i),focusAttempt=_ElementUtilities._trySetActive(section._headerTabStopElement,this._viewportElement);if(focusAttempt)return;if(_ElementUtilities._setActiveFirstFocusableElement(section.contentElement,this._viewportElement))return}for(var i=indexToFocus-1;i>=0;i--){var section=this.sections.getAt(i);if(_ElementUtilities._setActiveFirstFocusableElement(section.contentElement,this._viewportElement))return;var focusAttempt=_ElementUtilities._trySetActive(section._headerTabStopElement,this._viewportElement);if(focusAttempt)return}}},_keyDownHandler:function(ev){if(!this._isInteractive(ev.target)&&!_ElementUtilities._hasCursorKeysBehaviors(ev.target)){var leftKey=this._rtl?Key.rightArrow:Key.leftArrow,rightKey=this._rtl?Key.leftArrow:Key.rightArrow;if(ev.keyCode===Key.upArrow||ev.keyCode===Key.downArrow||ev.keyCode===Key.leftArrow||ev.keyCode===Key.rightArrow||ev.keyCode===Key.pageUp||ev.keyCode===Key.pageDown){var headerTabStopElement=this._findHeaderTabStop(ev.target);if(headerTabStopElement){var targetSectionIndex,currentSection=this.sections.indexOf(headerTabStopElement.parentElement.parentElement.winControl),useEnsureVisible=!1;if(ev.keyCode===Key.pageDown||this.orientation===_UI.Orientation.horizontal&&ev.keyCode===rightKey||this.orientation===_UI.Orientation.vertical&&ev.keyCode===Key.downArrow){for(var i=currentSection+1;i<this.sections.length;i++)if(this._tryFocus(i)){targetSectionIndex=i;break}}else if(ev.keyCode===Key.pageUp||this.orientation===_UI.Orientation.horizontal&&ev.keyCode===leftKey||this.orientation===_UI.Orientation.vertical&&ev.keyCode===Key.upArrow)for(var i=currentSection-1;i>=0;i--)if(this._tryFocus(i)){targetSectionIndex=i;break}(ev.keyCode===Key.upArrow||ev.keyCode===Key.downArrow||ev.keyCode===Key.leftArrow||ev.keyCode===Key.rightArrow)&&(useEnsureVisible=!0),+targetSectionIndex===targetSectionIndex&&(useEnsureVisible?this._ensureVisible(targetSectionIndex,!0):this._scrollToSection(targetSectionIndex,!0),ev.preventDefault())}}else if(ev.keyCode===Key.home||ev.keyCode===Key.end){this._measure();var maxScrollPos=Math.max(0,this._scrollLength-this._viewportSize);this._scrollTo(ev.keyCode===Key.home?0:maxScrollPos,!0),ev.preventDefault()}}},_tryFocus:function(index){var targetSection=this.sections.getAt(index);return _ElementUtilities._setActive(targetSection._headerTabStopElement,this._viewportElement),_Global.document.activeElement===targetSection._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new ZoomableView(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===_UI.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(x,y){var offset;offset=this.orientation===_UI.Orientation.horizontal?x:y,this._measure(),offset+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1;for(var i=1;i<this._sectionSizes.length;i++){var sectionSize=this._sectionSizes[i];if(sectionSize.offset-sectionSize.marginStart>offset){this._currentIndexForSezo=i-1;break}}},_getCurrentItem:function(){var itemPosition;if(this._sectionSizes.length>0){this._measure();var index=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),sectionSize=this._sectionSizes[index];itemPosition=this.orientation===_UI.Orientation.horizontal?{left:Math.max(0,sectionSize.offset-sectionSize.marginStart-this._scrollPosition),top:0,width:sectionSize.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,sectionSize.offset-sectionSize.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:sectionSize.size};var section=this.sections.getAt(index);return Promise.wrap({item:{data:section,index:index,groupIndexHint:index},position:itemPosition})}},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(item,position){if(item.index>=0&&item.index<this._sectionSizes.length){this._measure();var offsetFromViewport,sectionSize=this._sectionSizes[item.index];offsetFromViewport=this.orientation===_UI.Orientation.horizontal?position.left:position.top,this._sectionToFocus=item.index;var targetScrollPosition=sectionSize.offset-offsetFromViewport,targetScrollPosition=this._ensureVisibleMath(item.index,targetScrollPosition);this._scrollPosition=targetScrollPosition;var newScrollPos={};newScrollPos[this._names.scrollPos]=this._scrollPosition,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(text){var message="WinJS.UI.Hub:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0,_Global.removeEventListener("keydown",this._windowKeyDownHandlerBound),_ElementUtilities._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound),this._updateEvents(this._sections);for(var i=0;i<this.sections.length;i++)this.sections.getAt(i).dispose()}}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:eventNames.contentAnimating,headerInvoked:eventNames.headerInvoked,loadingStateChanged:eventNames.loadingStateChanged}});_Base.Class.mix(Hub,_Control.DOMEventMixin);var ZoomableView=_Base.Class.define(function(hub){this._hub=hub},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages){this._hub._configureForZoom(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages)},setCurrentItem:function(x,y){this._hub._setCurrentItem(x,y)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(item,position){return this._hub._positionItem(item,position)},endZoom:function(isCurrentView){this._hub._endZoom(isCurrentView)}}),strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateSection(){return"Hub duplicate sections: Each HubSection must be unique"},get invalidContent(){return"Invalid content: Hub content must be made up of HubSections."},get hubViewportAriaLabel(){return _Resources._getWinJSString("ui/hubViewportAriaLabel").value}};return Hub})})}),define("require-style!less/styles-lightdismissservice",[],function(){});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("WinJS/_LightDismissService",["require","exports","./Application","./Core/_Base","./Core/_BaseUtils","./Utilities/_ElementUtilities","./Core/_Global","./Utilities/_KeyboardBehavior","./Core/_Log","./Core/_Resources"],function(require,exports,Application,_Base,_BaseUtils,_ElementUtilities,_Global,_KeyboardBehavior,_Log,_Resources){require(["require-style!less/styles-lightdismissservice"]);var baseZIndex=1e3,Strings={get closeOverlay(){return _Resources._getWinJSString("ui/closeOverlay").value}};exports._ClassNames={_clickEater:"win-clickeater"};exports.LightDismissalReasons={tap:"tap",lostFocus:"lostFocus",escape:"escape",hardwareBackButton:"hardwareBackButton",windowResize:"windowResize",windowBlur:"windowBlur"},exports.DismissalPolicies={light:function(info){switch(info.reason){case exports.LightDismissalReasons.tap:case exports.LightDismissalReasons.escape:return info.active?!0:(info.stopPropagation(),!1);case exports.LightDismissalReasons.hardwareBackButton:return info.active?(info.preventDefault(),!0):(info.stopPropagation(),!1);case exports.LightDismissalReasons.lostFocus:case exports.LightDismissalReasons.windowResize:case exports.LightDismissalReasons.windowBlur:return!0}},modal:function(info){switch(info.stopPropagation(),info.reason){case exports.LightDismissalReasons.tap:case exports.LightDismissalReasons.lostFocus:case exports.LightDismissalReasons.windowResize:case exports.LightDismissalReasons.windowBlur:return!1;case exports.LightDismissalReasons.escape:return info.active;case exports.LightDismissalReasons.hardwareBackButton:return info.preventDefault(),info.active}},sticky:function(info){return info.stopPropagation(),!1}};var KeyboardInfoType={keyDown:"keyDown",keyUp:"keyUp",keyPress:"keyPress"},AbstractDismissableElement=function(){function AbstractDismissableElement(args){this.element=args.element,this.element.tabIndex=args.tabIndex,this.onLightDismiss=args.onLightDismiss,args.onTakeFocus&&(this.onTakeFocus=args.onTakeFocus),args.onShouldLightDismiss&&(this.onShouldLightDismiss=args.onShouldLightDismiss),this._ldeOnKeyDownBound=this._ldeOnKeyDown.bind(this),this._ldeOnKeyUpBound=this._ldeOnKeyUp.bind(this),this._ldeOnKeyPressBound=this._ldeOnKeyPress.bind(this)}return AbstractDismissableElement.prototype.restoreFocus=function(){var activeElement=_Global.document.activeElement;if(activeElement&&this.containsElement(activeElement))return this._ldeCurrentFocus=activeElement,!0;var useSetActive=!_KeyboardBehavior._keyboardSeenLast;return this._ldeCurrentFocus&&this.containsElement(this._ldeCurrentFocus)&&_ElementUtilities._tryFocusOnAnyElement(this._ldeCurrentFocus,useSetActive)},AbstractDismissableElement.prototype._ldeOnKeyDown=function(eventObject){this._ldeService.keyDown(this,eventObject)},AbstractDismissableElement.prototype._ldeOnKeyUp=function(eventObject){this._ldeService.keyUp(this,eventObject)},AbstractDismissableElement.prototype._ldeOnKeyPress=function(eventObject){this._ldeService.keyPress(this,eventObject)},AbstractDismissableElement.prototype.setZIndex=function(zIndex){this.element.style.zIndex=zIndex},AbstractDismissableElement.prototype.getZIndexCount=function(){return 1},AbstractDismissableElement.prototype.containsElement=function(element){return this.element.contains(element)},AbstractDismissableElement.prototype.onTakeFocus=function(useSetActive){this.restoreFocus()||_ElementUtilities._focusFirstFocusableElement(this.element,useSetActive)||_ElementUtilities._tryFocusOnAnyElement(this.element,useSetActive)},AbstractDismissableElement.prototype.onFocus=function(element){this._ldeCurrentFocus=element},AbstractDismissableElement.prototype.onShow=function(service){this._ldeService=service,this.element.addEventListener("keydown",this._ldeOnKeyDownBound),this.element.addEventListener("keyup",this._ldeOnKeyUpBound),this.element.addEventListener("keypress",this._ldeOnKeyPressBound)},AbstractDismissableElement.prototype.onHide=function(){this._ldeCurrentFocus=null,this._ldeService=null,this.element.removeEventListener("keydown",this._ldeOnKeyDownBound),this.element.removeEventListener("keyup",this._ldeOnKeyUpBound),this.element.removeEventListener("keypress",this._ldeOnKeyPressBound)},AbstractDismissableElement.prototype.onKeyInStack=function(info){},AbstractDismissableElement.prototype.onShouldLightDismiss=function(info){return!1},AbstractDismissableElement.prototype.onLightDismiss=function(info){},AbstractDismissableElement}(),LightDismissableElement=function(_super){function LightDismissableElement(){_super.apply(this,arguments)}return __extends(LightDismissableElement,_super),LightDismissableElement.prototype.onKeyInStack=function(info){},LightDismissableElement.prototype.onShouldLightDismiss=function(info){return exports.DismissalPolicies.light(info)},LightDismissableElement}(AbstractDismissableElement);exports.LightDismissableElement=LightDismissableElement;var ModalElement=function(_super){function ModalElement(){_super.apply(this,arguments)}return __extends(ModalElement,_super),ModalElement.prototype.onKeyInStack=function(info){info.stopPropagation()},ModalElement.prototype.onShouldLightDismiss=function(info){return exports.DismissalPolicies.modal(info)},ModalElement}(AbstractDismissableElement);exports.ModalElement=ModalElement;var LightDismissableBody=function(){function LightDismissableBody(){}return LightDismissableBody.prototype.setZIndex=function(zIndex){},LightDismissableBody.prototype.getZIndexCount=function(){return 1},LightDismissableBody.prototype.containsElement=function(element){return _Global.document.body.contains(element)},LightDismissableBody.prototype.onTakeFocus=function(useSetActive){this.currentFocus&&this.containsElement(this.currentFocus)&&_ElementUtilities._tryFocusOnAnyElement(this.currentFocus,useSetActive)},LightDismissableBody.prototype.onFocus=function(element){this.currentFocus=element},LightDismissableBody.prototype.onShow=function(service){},LightDismissableBody.prototype.onHide=function(){this.currentFocus=null},LightDismissableBody.prototype.onKeyInStack=function(info){},LightDismissableBody.prototype.onShouldLightDismiss=function(info){return!1},LightDismissableBody.prototype.onLightDismiss=function(info){},LightDismissableBody}(),LightDismissService=function(){function LightDismissService(){this._debug=!1,this._clients=[],this._notifying=!1,this._bodyClient=new LightDismissableBody,this._updateDom_rendered={serviceActive:!1},this._clickEaterEl=this._createClickEater(),this._onBeforeRequestingFocusOnKeyboardInputBound=this._onBeforeRequestingFocusOnKeyboardInput.bind(this),this._onFocusInBound=this._onFocusIn.bind(this),this._onKeyDownBound=this._onKeyDown.bind(this),this._onWindowResizeBound=this._onWindowResize.bind(this),this._onClickEaterPointerUpBound=this._onClickEaterPointerUp.bind(this),this._onClickEaterPointerCancelBound=this._onClickEaterPointerCancel.bind(this),Application.addEventListener("backclick",this._onBackClick.bind(this)),_Global.window.addEventListener("blur",this._onWindowBlur.bind(this)),this.shown(this._bodyClient)}return LightDismissService.prototype.shown=function(client){var index=this._clients.indexOf(client);-1===index&&(this._clients.push(client),client.onShow(this),this._updateDom())},LightDismissService.prototype.hidden=function(client){var index=this._clients.indexOf(client);-1!==index&&(this._clients.splice(index,1),client.setZIndex(""),client.onHide(),this._updateDom())},LightDismissService.prototype.updated=function(client){this._updateDom()},LightDismissService.prototype.keyDown=function(client,eventObject){eventObject.keyCode===_ElementUtilities.Key.escape?this._escapePressed(eventObject):this._dispatchKeyboardEvent(client,KeyboardInfoType.keyDown,eventObject)},LightDismissService.prototype.keyUp=function(client,eventObject){this._dispatchKeyboardEvent(client,KeyboardInfoType.keyUp,eventObject)},LightDismissService.prototype.keyPress=function(client,eventObject){this._dispatchKeyboardEvent(client,KeyboardInfoType.keyPress,eventObject)},LightDismissService.prototype.isShown=function(client){return-1!==this._clients.indexOf(client)},LightDismissService.prototype.isTopmost=function(client){return client===this._clients[this._clients.length-1]},LightDismissService.prototype._setDebug=function(debug){this._debug=debug},LightDismissService.prototype._updateDom=function(options){options=options||{};var activeDismissableNeedsFocus=!!options.activeDismissableNeedsFocus,rendered=this._updateDom_rendered;if(!this._notifying){var serviceActive=this._clients.length>1;if(serviceActive!==rendered.serviceActive){if(serviceActive)Application.addEventListener("beforerequestingfocusonkeyboardinput",this._onBeforeRequestingFocusOnKeyboardInputBound),_ElementUtilities._addEventListener(_Global.document.documentElement,"focusin",this._onFocusInBound),_Global.document.documentElement.addEventListener("keydown",this._onKeyDownBound),_Global.window.addEventListener("resize",this._onWindowResizeBound),this._bodyClient.currentFocus=_Global.document.activeElement,_Global.document.body.appendChild(this._clickEaterEl);else{Application.removeEventListener("beforerequestingfocusonkeyboardinput",this._onBeforeRequestingFocusOnKeyboardInputBound),_ElementUtilities._removeEventListener(_Global.document.documentElement,"focusin",this._onFocusInBound),_Global.document.documentElement.removeEventListener("keydown",this._onKeyDownBound),_Global.window.removeEventListener("resize",this._onWindowResizeBound);var parent=this._clickEaterEl.parentNode;parent&&parent.removeChild(this._clickEaterEl)}rendered.serviceActive=serviceActive}var zIndexGap=0,lastUsedZIndex=baseZIndex+1;this._clients.forEach(function(c,i){var currentZIndex=lastUsedZIndex+zIndexGap;c.setZIndex(""+currentZIndex),lastUsedZIndex=currentZIndex,zIndexGap=c.getZIndexCount()+1}),serviceActive&&(this._clickEaterEl.style.zIndex=""+(lastUsedZIndex-1));var activeDismissable=this._clients.length>0?this._clients[this._clients.length-1]:null;if(this._activeDismissable!==activeDismissable&&(this._activeDismissable=activeDismissable,activeDismissableNeedsFocus=!0),activeDismissableNeedsFocus){var useSetActive=!_KeyboardBehavior._keyboardSeenLast;this._activeDismissable&&this._activeDismissable.onTakeFocus(useSetActive)}}},LightDismissService.prototype._dispatchKeyboardEvent=function(client,keyboardInfoType,eventObject){var index=this._clients.indexOf(client);if(-1!==index)for(var info={type:keyboardInfoType,keyCode:eventObject.keyCode,propagationStopped:!1,stopPropagation:function(){this.propagationStopped=!0,eventObject.stopPropagation()}},clients=this._clients.slice(0,index+1),i=clients.length-1;i>=0&&!info.propagationStopped;i--)clients[i].onKeyInStack(info)},LightDismissService.prototype._dispatchLightDismiss=function(reason,clients,options){if(this._notifying)return void(_Log.log&&_Log.log('_LightDismissService ignored dismiss trigger to avoid re-entrancy: "'+reason+'"',"winjs _LightDismissService","warning"));if(clients=clients||this._clients.slice(0),0!==clients.length){this._notifying=!0;for(var lightDismissInfo={reason:reason,active:!1,_stop:!1,stopPropagation:function(){this._stop=!0},_doDefault:!0,preventDefault:function(){this._doDefault=!1}},i=clients.length-1;i>=0&&!lightDismissInfo._stop;i--)lightDismissInfo.active=this._activeDismissable===clients[i],clients[i].onShouldLightDismiss(lightDismissInfo)&&clients[i].onLightDismiss(lightDismissInfo);return this._notifying=!1,this._updateDom(options),lightDismissInfo._doDefault}},LightDismissService.prototype._onBeforeRequestingFocusOnKeyboardInput=function(eventObject){return!0},LightDismissService.prototype._clickEaterTapped=function(){this._dispatchLightDismiss(exports.LightDismissalReasons.tap)},LightDismissService.prototype._onFocusIn=function(eventObject){for(var target=eventObject.target,i=this._clients.length-1;i>=0&&!this._clients[i].containsElement(target);i--);-1!==i&&this._clients[i].onFocus(target),i+1<this._clients.length&&this._dispatchLightDismiss(exports.LightDismissalReasons.lostFocus,this._clients.slice(i+1),{activeDismissableNeedsFocus:!0})},LightDismissService.prototype._onKeyDown=function(eventObject){eventObject.keyCode===_ElementUtilities.Key.escape&&this._escapePressed(eventObject)},LightDismissService.prototype._escapePressed=function(eventObject){eventObject.preventDefault(),eventObject.stopPropagation(),this._dispatchLightDismiss(exports.LightDismissalReasons.escape)},LightDismissService.prototype._onBackClick=function(eventObject){var doDefault=this._dispatchLightDismiss(exports.LightDismissalReasons.hardwareBackButton);return!doDefault},LightDismissService.prototype._onWindowResize=function(eventObject){this._dispatchLightDismiss(exports.LightDismissalReasons.windowResize)},LightDismissService.prototype._onWindowBlur=function(eventObject){if(!this._debug)if(_Global.document.hasFocus()){var active=_Global.document.activeElement;active&&"IFRAME"===active.tagName&&!active.msLightDismissBlur&&(active.addEventListener("blur",this._onWindowBlur.bind(this),!1),active.msLightDismissBlur=!0)}else this._dispatchLightDismiss(exports.LightDismissalReasons.windowBlur)},LightDismissService.prototype._createClickEater=function(){var clickEater=_Global.document.createElement("section");return clickEater.className=exports._ClassNames._clickEater,_ElementUtilities._addEventListener(clickEater,"pointerdown",this._onClickEaterPointerDown.bind(this),!0),clickEater.addEventListener("click",this._onClickEaterClick.bind(this),!0),clickEater.setAttribute("role","menuitem"),clickEater.setAttribute("aria-label",Strings.closeOverlay),clickEater.setAttribute("unselectable","on"),clickEater},LightDismissService.prototype._onClickEaterPointerDown=function(eventObject){eventObject.stopPropagation(),eventObject.preventDefault(),this._clickEaterPointerId=eventObject.pointerId,this._registeredClickEaterCleanUp||(_ElementUtilities._addEventListener(_Global.window,"pointerup",this._onClickEaterPointerUpBound),_ElementUtilities._addEventListener(_Global.window,"pointercancel",this._onClickEaterPointerCancelBound),this._registeredClickEaterCleanUp=!0)},LightDismissService.prototype._onClickEaterPointerUp=function(eventObject){var _this=this;if(eventObject.stopPropagation(),eventObject.preventDefault(),eventObject.pointerId===this._clickEaterPointerId){this._resetClickEaterPointerState();var element=_Global.document.elementFromPoint(eventObject.clientX,eventObject.clientY);element===this._clickEaterEl&&(this._skipClickEaterClick=!0,_BaseUtils._yieldForEvents(function(){_this._skipClickEaterClick=!1}),this._clickEaterTapped())}},LightDismissService.prototype._onClickEaterClick=function(eventObject){eventObject.stopPropagation(),eventObject.preventDefault(),this._skipClickEaterClick||this._clickEaterTapped()},LightDismissService.prototype._onClickEaterPointerCancel=function(eventObject){eventObject.pointerId===this._clickEaterPointerId&&this._resetClickEaterPointerState()},LightDismissService.prototype._resetClickEaterPointerState=function(){this._registeredClickEaterCleanUp&&(_ElementUtilities._removeEventListener(_Global.window,"pointerup",this._onClickEaterPointerUpBound),_ElementUtilities._removeEventListener(_Global.window,"pointercancel",this._onClickEaterPointerCancelBound)),this._clickEaterPointerId=null,this._registeredClickEaterCleanUp=!1},LightDismissService}(),service=new LightDismissService;exports.shown=service.shown.bind(service),exports.hidden=service.hidden.bind(service),exports.updated=service.updated.bind(service),exports.isShown=service.isShown.bind(service),exports.isTopmost=service.isTopmost.bind(service),exports.keyDown=service.keyDown.bind(service),exports.keyUp=service.keyUp.bind(service),exports.keyPress=service.keyPress.bind(service),exports._clickEaterTapped=service._clickEaterTapped.bind(service),exports._onBackClick=service._onBackClick.bind(service),exports._setDebug=service._setDebug.bind(service),_Base.Namespace.define("WinJS.UI._LightDismissService",{shown:exports.shown,hidden:exports.hidden,updated:exports.updated,isShown:exports.isShown,isTopmost:exports.isTopmost,keyDown:exports.keyDown,keyUp:exports.keyUp,keyPress:exports.keyPress,_clickEaterTapped:exports._clickEaterTapped,_onBackClick:exports._onBackClick,_setDebug:exports._setDebug,LightDismissableElement:LightDismissableElement,DismissalPolicies:exports.DismissalPolicies,LightDismissalReasons:exports.LightDismissalReasons,_ClassNames:exports._ClassNames,_service:service})}),define("WinJS/Controls/_LegacyAppBar/_Constants",["exports","../../Core/_Base"],function(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,null,{appBarClass:"win-navbar",firstDivClass:"win-firstdiv",finalDivClass:"win-finaldiv",invokeButtonClass:"win-navbar-invokebutton",ellipsisClass:"win-navbar-ellipsis",primaryCommandsClass:"win-primarygroup",secondaryCommandsClass:"win-secondarygroup",commandLayoutClass:"win-commandlayout",menuLayoutClass:"win-menulayout",topClass:"win-top",bottomClass:"win-bottom",showingClass:"win-navbar-opening",shownClass:"win-navbar-opened",hidingClass:"win-navbar-closing",hiddenClass:"win-navbar-closed",compactClass:"win-navbar-compact",minimalClass:"win-navbar-minimal",menuContainerClass:"win-navbar-menu",appBarPlacementTop:"top",appBarPlacementBottom:"bottom",appBarLayoutCustom:"custom",appBarLayoutCommands:"commands",appBarLayoutMenu:"menu",appBarInvokeButtonWidth:32,typeSeparator:"separator",typeContent:"content",typeButton:"button",typeToggle:"toggle",typeFlyout:"flyout",appBarCommandClass:"win-command",appBarCommandGlobalClass:"win-global",appBarCommandSelectionClass:"win-selection",commandHiddenClass:"win-command-hidden",sectionSelection:"selection",sectionGlobal:"global",sectionPrimary:"primary",sectionSecondary:"secondary",menuCommandClass:"win-command",menuCommandButtonClass:"win-command-button",menuCommandToggleClass:"win-command-toggle",menuCommandFlyoutClass:"win-command-flyout",menuCommandFlyoutActivatedClass:"win-command-flyout-activated",menuCommandSeparatorClass:"win-command-separator",_menuCommandInvokedEvent:"_invoked",menuClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",menuContainsFlyoutCommandClass:"win-menu-containsflyoutcommand",menuMouseSpacingClass:"win-menu-mousespacing",menuTouchSpacingClass:"win-menu-touchspacing",menuCommandHoverDelay:400,overlayClass:"win-overlay",flyoutClass:"win-flyout",flyoutLightClass:"win-ui-light",settingsFlyoutClass:"win-settingsflyout",scrollsClass:"win-scrolls",pinToRightEdge:-1,pinToBottomEdge:-1,separatorWidth:34,buttonWidth:68,narrowClass:"win-narrow",wideClass:"win-wide",_visualViewportClass:"win-visualviewport-space",commandPropertyMutated:"_commandpropertymutated",commandVisibilityChanged:"commandvisibilitychanged"})}),define("WinJS/Utilities/_KeyboardInfo",["require","exports","../Core/_BaseCoreUtils","../Core/_Global","../Core/_WinRT"],function(require,exports,_BaseCoreUtils,_Global,_WinRT){"use strict";var _Constants={visualViewportClass:"win-visualviewport-space",scrollTimeout:150};exports._KeyboardInfo,exports._KeyboardInfo={get _visible(){try{return _WinRT.Windows.UI.ViewManagement.InputPane&&_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(e){return!1}},get _extraOccluded(){var occluded=0;return!exports._KeyboardInfo._isResized&&_WinRT.Windows.UI.ViewManagement.InputPane&&(occluded=_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height),occluded},get _isResized(){var heightRatio=_Global.document.documentElement.clientHeight/_Global.innerHeight,widthRatio=_Global.document.documentElement.clientWidth/_Global.innerWidth;return.99>widthRatio/heightRatio},get _visibleDocBottom(){return exports._KeyboardInfo._visibleDocTop+exports._KeyboardInfo._visibleDocHeight},get _visibleDocHeight(){return exports._KeyboardInfo._visualViewportHeight-exports._KeyboardInfo._extraOccluded},get _visibleDocTop(){return 0},get _visibleDocBottomOffset(){return exports._KeyboardInfo._extraOccluded},get _visualViewportHeight(){var boundingRect=exports._KeyboardInfo._visualViewportSpace;return boundingRect.height},get _visualViewportWidth(){var boundingRect=exports._KeyboardInfo._visualViewportSpace;return boundingRect.width},get _visualViewportSpace(){var visualViewportSpace=_Global.document.body.querySelector("."+_Constants.visualViewportClass);return visualViewportSpace||(visualViewportSpace=_Global.document.createElement("DIV"),visualViewportSpace.className=_Constants.visualViewportClass,_Global.document.body.appendChild(visualViewportSpace)),visualViewportSpace.getBoundingClientRect()},get _animationShowLength(){if(_BaseCoreUtils.hasWinRT){if(_WinRT.Windows.UI.Core.AnimationMetrics){for(var a=_WinRT.Windows.UI.Core.AnimationMetrics,animationDescription=new a.AnimationDescription(a.AnimationEffect.showPanel,a.AnimationEffectTarget.primary),animations=animationDescription.animations,max=0,i=0;i<animations.size;i++){
var animation=animations[i];max=Math.max(max,animation.delay+animation.duration)}return max}var animationDuration=300,animationDelay=50;return animationDelay+animationDuration}return 0},get _scrollTimeout(){return _Constants.scrollTimeout},get _layoutViewportCoords(){var topOffset=_Global.window.pageYOffset-_Global.document.documentElement.scrollTop,bottomOffset=_Global.document.documentElement.clientHeight-(topOffset+this._visibleDocHeight);return{visibleDocTop:topOffset,visibleDocBottom:bottomOffset}}}}),define("require-style!less/styles-overlay",[],function(){}),define("require-style!less/colors-overlay",[],function(){}),define("WinJS/Controls/Flyout/_Overlay",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Core/_WriteProfilerMark","../../_Accents","../../Animations","../../Application","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardInfo","../_LegacyAppBar/_Constants","require-style!less/styles-overlay","require-style!less/colors-overlay"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,_Accents,Animations,Application,ControlProcessor,Promise,Scheduler,_Control,_ElementUtilities,_KeyboardInfo,_Constants){"use strict";_Accents.createAccentRule("button[aria-checked=true].win-command:before,         .win-menu-containsflyoutcommand button.win-command-flyout-activated:before",[{name:"background-color",value:_Accents.ColorTypes.accent},{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-flyout, .win-settingsflyout",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_Overlay:_Base.Namespace._lazy(function(){function _allOverlaysCallback(event,nameOfFunctionCall,stopImmediatePropagationWhenHandled){var elements=_Global.document.querySelectorAll("."+_Constants.overlayClass);if(elements)for(var len=elements.length,i=0;len>i;i++){var element=elements[i],overlay=element.winControl;if(!overlay._disposed&&overlay){var handled=overlay[nameOfFunctionCall](event);if(stopImmediatePropagationWhenHandled&&handled)return handled}}}function _resolveElements(elements){if(!elements)return[];"string"!=typeof elements&&elements&&elements.length||(elements=[elements]);var i,realElements=[];for(i=0;i<elements.length;i++)if(elements[i])if("string"==typeof elements[i]){var element=_Global.document.getElementById(elements[i]);element&&realElements.push(element)}else elements[i].element?realElements.push(elements[i].element):realElements.push(elements[i]);return realElements}var _GlobalListener=_Base.Class.define(function(){this._currentState=_GlobalListener.states.off,this._inputPaneShowing=this._inputPaneShowing.bind(this),this._inputPaneHiding=this._inputPaneHiding.bind(this),this._documentScroll=this._documentScroll.bind(this),this._windowResized=this._windowResized.bind(this)},{initialize:function(){this._toggleListeners(_GlobalListener.states.on)},reset:function(){this._toggleListeners(_GlobalListener.states.off),this._toggleListeners(_GlobalListener.states.on)},_inputPaneShowing:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_showingKeyboard,StartTM"),_allOverlaysCallback(event,"_showingKeyboard"),_WriteProfilerMark(_GlobalListener.profilerString+"_showingKeyboard,StopTM")},_inputPaneHiding:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_hidingKeyboard,StartTM"),_allOverlaysCallback(event,"_hidingKeyboard"),_WriteProfilerMark(_GlobalListener.profilerString+"_hidingKeyboard,StopTM")},_documentScroll:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_checkScrollPosition,StartTM"),_allOverlaysCallback(event,"_checkScrollPosition"),_WriteProfilerMark(_GlobalListener.profilerString+"_checkScrollPosition,StopTM")},_windowResized:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_baseResize,StartTM"),_allOverlaysCallback(event,"_baseResize"),_WriteProfilerMark(_GlobalListener.profilerString+"_baseResize,StopTM")},_toggleListeners:function(newState){var listenerOperation;if(this._currentState!==newState){if(newState===_GlobalListener.states.on?listenerOperation="addEventListener":newState===_GlobalListener.states.off&&(listenerOperation="removeEventListener"),_WinRT.Windows.UI.ViewManagement.InputPane){var inputPane=_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView();inputPane[listenerOperation]("showing",this._inputPaneShowing,!1),inputPane[listenerOperation]("hiding",this._inputPaneHiding,!1),_Global.document[listenerOperation]("scroll",this._documentScroll,!1)}_Global.addEventListener("resize",this._windowResized,!1),this._currentState=newState}}},{profilerString:{get:function(){return"WinJS.UI._Overlay Global Listener:"}},states:{get:function(){return{off:0,on:1}}}}),strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get mustContainCommands(){return"Invalid HTML: AppBars/Menus must contain only AppBarCommands/MenuCommands"},get closeOverlay(){return _Resources._getWinJSString("ui/closeOverlay").value}},_Overlay=_Base.Class.define(function(element,options){this._baseOverlayConstructor(element,options)},{_baseOverlayConstructor:function(element,options){this._disposed=!1,element||(element=_Global.document.createElement("div"));var overlay=element.winControl;if(overlay)throw new _ErrorFromName("WinJS.UI._Overlay.DuplicateConstruction",strings.duplicateConstruction);this._element||(this._element=element),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),this._sticky=!1,this._doNext="",this._element.style.visibility="hidden",this._element.style.opacity=0,element.winControl=this,_ElementUtilities.addClass(this._element,_Constants.overlayClass),_ElementUtilities.addClass(this._element,"win-disposable");var unselectable=this._element.getAttribute("unselectable");(null===unselectable||void 0===unselectable)&&this._element.setAttribute("unselectable","on"),this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut,this._animationPromise=Promise.as(),this._queuedToShow=[],this._queuedToHide=[],this._queuedCommandAnimation=!1,options&&_Control.setOptions(this,options),_Overlay._globalEventListeners.initialize()},element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},_show:function(){this._baseShow()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext},set:function(hidden){var currentlyHidden=this.hidden;!hidden&&currentlyHidden?this.show():hidden&&!currentlyHidden&&this.hide()}},addEventListener:function(type,listener,useCapture){return this._element.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){return this._element.removeEventListener(type,listener,useCapture)},_baseShow:function(){if(this._animating||this._needToHandleHidingKeyboard)return this._doNext="show",!1;if("visible"!==this._element.style.visibility){this._element.winAnimating="showing",this._element.style.display="",this._element.style.visibility="hidden",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._beforeShow(),this._sendEvent(_Overlay.beforeShow),this._ensurePosition();var that=this;return this._animationPromise=this._currentAnimateIn().then(function(){that._baseEndShow()},function(){that._baseEndShow()}),!0}return!1},_beforeShow:function(){},_ensurePosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="","show"===this._doNext&&(this._doNext=""),this._sendEvent(_Overlay.afterShow),this._writeProfilerMark("show,StopTM"),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_baseHide:function(){if(this._animating)return this._doNext="hide",!1;if(this._needToHandleHidingKeyboard&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(_Overlay.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var that=this;this._animationPromise=this._currentAnimateOut().then(function(){that._baseEndHide()},function(){that._baseEndHide()})}return!0}return!1},_baseEndHide:function(){this._disposed||(this._beforeEndHide(),this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._afterHide(),this._sendEvent(_Overlay.afterHide),this._writeProfilerMark("hide,StopTM"),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_beforeEndHide:function(){},_afterHide:function(){},_checkDoNext:function(){this._animating||this._needToHandleHidingKeyboard||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",_ElementUtilities._getComputedStyle(this._element,null).opacity,Animations.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,_ElementUtilities._getComputedStyle(this._element,null).opacity,Animations.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(eventName,detail){if(!this._disposed){var event=_Global.document.createEvent("CustomEvent");event.initEvent(eventName,!0,!0,detail||{}),this._element.dispatchEvent(event)}},_showCommands:function(commands,immediate){var showHide=this._resolveCommands(commands);this._showAndHideCommands(showHide.commands,[],immediate)},_hideCommands:function(commands,immediate){var showHide=this._resolveCommands(commands);this._showAndHideCommands([],showHide.commands,immediate)},_showOnlyCommands:function(commands,immediate){var showHide=this._resolveCommands(commands);this._showAndHideCommands(showHide.commands,showHide.others,immediate)},_showAndHideCommands:function(showCommands,hideCommands,immediate){immediate||this.hidden&&!this._animating?(this._showAndHideFast(showCommands,hideCommands),this._removeFromQueue(showCommands,this._queuedToShow),this._removeFromQueue(hideCommands,this._queuedToHide)):(this._updateAnimateQueue(showCommands,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(hideCommands,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(commands,queue){var count;for(count=0;count<commands.length;count++){var countQ;for(countQ=0;countQ<queue.length;countQ++)if(queue[countQ]===commands[count]){queue.splice(countQ,1);break}}},_updateAnimateQueue:function(addCommands,toQueue,fromQueue){if(!this._disposed){var count;for(count=0;count<addCommands.length;count++){var countQ;for(countQ=0;countQ<toQueue.length&&toQueue[countQ]!==addCommands[count];countQ++);for(countQ===toQueue.length&&(toQueue[countQ]=addCommands[count]),countQ=0;countQ<fromQueue.length;countQ++)if(fromQueue[countQ]===addCommands[count]){fromQueue.splice(countQ,1);break}}this._queuedCommandAnimation||(this._animating||Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(showCommands,hideCommands){var count,command;for(count=0;count<showCommands.length;count++)command=showCommands[count],command&&command.style&&(command.style.visibility="",command.style.display="");for(count=0;count<hideCommands.length;count++)command=hideCommands[count],command&&command.style&&(command.style.visibility="hidden",command.style.display="none");this._commandsUpdated()},_showAndHideQueue:function(){if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{var count,showCommands=this._queuedToShow,hideCommands=this._queuedToHide,siblings=this._findSiblings(showCommands.concat(hideCommands));for(count=0;count<showCommands.length;count++)showCommands[count]&&showCommands[count].style&&_Global.document.body.contains(showCommands[count])?"hidden"!==showCommands[count].style.visibility&&"0"!==showCommands[count].style.opacity&&(siblings.push(showCommands[count]),showCommands.splice(count,1),count--):(showCommands.splice(count,1),count--);for(count=0;count<hideCommands.length;count++)hideCommands[count]&&hideCommands[count].style&&_Global.document.body.contains(hideCommands[count])&&"hidden"!==hideCommands[count].style.visibility&&"0"!==hideCommands[count].style.opacity||(hideCommands.splice(count,1),count--);var commandsAnimationPromise=this._baseBeginAnimateCommands(showCommands,hideCommands,siblings),that=this;commandsAnimationPromise?commandsAnimationPromise.done(function(){that._baseEndAnimateCommands(hideCommands)},function(){that._baseEndAnimateCommands(hideCommands)}):Scheduler.schedule(function(){that._baseEndAnimateCommands([])},Scheduler.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[],this._queuedToHide=[]},_baseBeginAnimateCommands:function(showCommands,hideCommands,siblings){this._beginAnimateCommands(showCommands,hideCommands,this._getVisibleCommands(siblings));var showAnimated=null,hideAnimated=null;hideCommands.length>0&&(hideAnimated=Animations.createDeleteFromListAnimation(hideCommands,0===showCommands.length?siblings:void 0)),showCommands.length>0&&(showAnimated=Animations.createAddToListAnimation(showCommands,siblings));for(var count=0,len=hideCommands.length;len>count;count++){var rectangle=hideCommands[count].getBoundingClientRect(),style=_ElementUtilities._getComputedStyle(hideCommands[count]);hideCommands[count].style.top=rectangle.top-parseFloat(style.marginTop)+"px",hideCommands[count].style.left=rectangle.left-parseFloat(style.marginLeft)+"px",hideCommands[count].style.opacity=0,hideCommands[count].style.position="fixed"}this._element.winAnimating="rearranging";var promise=null;for(hideAnimated&&(promise=hideAnimated.execute()),count=0;count<showCommands.length;count++)showCommands[count].style.visibility="",showCommands[count].style.display="",showCommands[count].style.opacity=1;if(showAnimated){var newPromise=showAnimated.execute();promise=promise?Promise.join([promise,newPromise]):newPromise}return promise},_beginAnimateCommands:function(){},_getVisibleCommands:function(commandSubSet){var command,commands=commandSubSet,visibleCommands=[];commands||(commands=this.element.querySelectorAll(".win-command"));for(var i=0,len=commands.length;len>i;i++)command=commands[i].winControl||commands[i],command.hidden||visibleCommands.push(command);return visibleCommands},_baseEndAnimateCommands:function(hideCommands){if(!this._disposed){var count;for(count=0;count<hideCommands.length;count++)hideCommands[count].style.position="",hideCommands[count].style.top="",hideCommands[count].style.left="",hideCommands[count].getBoundingClientRect(),hideCommands[count].style.visibility="hidden",hideCommands[count].style.display="none",hideCommands[count].style.opacity=1;this._element.winAnimating="",this._endAnimateCommands(),this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(commands){commands=_resolveElements(commands);var result={};result.commands=[],result.others=[];var countAll,countIn,allCommands=this.element.querySelectorAll(".win-command");for(countAll=0;countAll<allCommands.length;countAll++){var found=!1;for(countIn=0;countIn<commands.length;countIn++)if(commands[countIn]===allCommands[countAll]){result.commands.push(allCommands[countAll]),commands.splice(countIn,1),found=!0;break}found||result.others.push(allCommands[countAll])}return result},_findSiblings:function(commands){var countAll,countIn,siblings=[],allCommands=this.element.querySelectorAll(".win-command");for(countAll=0;countAll<allCommands.length;countAll++){var found=!1;for(countIn=0;countIn<commands.length;countIn++)if(commands[countIn]===allCommands[countAll]){commands.splice(countIn,1),found=!0;break}found||siblings.push(allCommands[countAll])}return siblings},_baseResize:function(event){this._resize(event)},_hideOrDismiss:function(){var element=this._element;element&&_ElementUtilities.hasClass(element,_Constants.settingsFlyoutClass)?this._dismiss():element&&_ElementUtilities.hasClass(element,_Constants.appBarClass)?this.close():this.hide()},_resize:function(){},_commandsUpdated:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(element,type){for(var children=element.children,commands=new Array(children.length),i=0;i<children.length;i++){if(!_ElementUtilities.hasClass(children[i],"win-command")&&children[i].getAttribute("data-win-control")!==type)throw new _ErrorFromName("WinJS.UI._Overlay.MustContainCommands",strings.mustContainCommands);ControlProcessor.processAll(children[i]),commands[i]=children[i].winControl}return commands},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||_Overlay._trySetActive(this._element)},_focusOnLastFocusableElement:function(){if(this._element.firstElementChild){var oldFirstTabIndex=this._element.firstElementChild.tabIndex,oldLastTabIndex=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var tabResult=_ElementUtilities._focusLastFocusableElement(this._element);return tabResult&&_Overlay._trySelect(_Global.document.activeElement),this._element.firstElementChild.tabIndex=oldFirstTabIndex,this._element.lastElementChild.tabIndex=oldLastTabIndex,tabResult}return!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||_Overlay._trySetActive(this._element)},_focusOnFirstFocusableElement:function(useSetActive,scroller){if(this._element.firstElementChild){var oldFirstTabIndex=this._element.firstElementChild.tabIndex,oldLastTabIndex=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var tabResult=_ElementUtilities._focusFirstFocusableElement(this._element,useSetActive,scroller);return tabResult&&_Overlay._trySelect(_Global.document.activeElement),this._element.firstElementChild.tabIndex=oldFirstTabIndex,this._element.lastElementChild.tabIndex=oldLastTabIndex,tabResult}return!1},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI._Overlay:"+this._id+":"+text)}},{_isFlyoutVisible:function(){for(var flyouts=_Global.document.querySelectorAll("."+_Constants.flyoutClass),i=0;i<flyouts.length;i++){var flyoutControl=flyouts[i].winControl;if(flyoutControl&&!flyoutControl.hidden)return!0}return!1},_trySetActive:function(element,scroller){return element&&_Global.document.body&&_Global.document.body.contains(element)&&_ElementUtilities._setActive(element,scroller)?element===_Global.document.activeElement:!1},_trySelect:function(element){try{element&&element.select&&element.select()}catch(e){}},_sizeOfDocument:function(){return{width:_Global.document.documentElement.offsetWidth,height:_Global.document.documentElement.offsetHeight}},_getParentControlUsingClassName:function(element,className){for(;element&&element!==_Global.document.body;){if(_ElementUtilities.hasClass(element,className))return element.winControl;element=element.parentNode}return null},_globalEventListeners:new _GlobalListener,_hideAppBars:function(bars,keyboardInvoked){var allBarsAnimationPromises=bars.map(function(bar){return bar.close(),bar._animationPromise});return Promise.join(allBarsAnimationPromises)},_showAppBars:function(bars,keyboardInvoked){var allBarsAnimationPromises=bars.map(function(bar){return bar._show(),bar._animationPromise});return Promise.join(allBarsAnimationPromises)},_keyboardInfo:_KeyboardInfo._KeyboardInfo,_scrollTimeout:_KeyboardInfo._KeyboardInfo._scrollTimeout,beforeShow:"beforeshow",beforeHide:"beforehide",afterShow:"aftershow",afterHide:"afterhide",commonstrings:{get cannotChangeCommandsWhenVisible(){return"Invalid argument: You must call hide() before changing {0} commands"},get cannotChangeHiddenProperty(){return"Unable to set hidden property while parent {0} is visible."}}});return _Base.Class.mix(_Overlay,_Control.DOMEventMixin),_Overlay})})}),define("WinJS/Controls/Flyout",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../_Signal","../_LightDismissService","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_KeyboardBehavior","../Utilities/_Hoverable","./_LegacyAppBar/_Constants","./Flyout/_Overlay"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Animations,_Signal,_LightDismissService,_Dispose,_ElementUtilities,_KeyboardBehavior,_Hoverable,_Constants,_Overlay){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Flyout:_Base.Namespace._lazy(function(){function getDimension(element,property){return _ElementUtilities.convertToPixels(element,_ElementUtilities._getComputedStyle(element,null)[property])}function measureElement(element){return{marginTop:getDimension(element,"marginTop"),marginBottom:getDimension(element,"marginBottom"),marginLeft:getDimension(element,"marginLeft"),marginRight:getDimension(element,"marginRight"),totalWidth:_ElementUtilities.getTotalWidth(element),totalHeight:_ElementUtilities.getTotalHeight(element),contentWidth:_ElementUtilities.getContentWidth(element),contentHeight:_ElementUtilities.getContentHeight(element)}}var Key=_ElementUtilities.Key,strings={get ariaLabel(){return _Resources._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return"Invalid argument: Flyout anchor element not found in DOM."},get badPlacement(){return"Invalid argument: Flyout placement should be 'top' (default), 'bottom', 'left', 'right', 'auto', 'autohorizontal', or 'autovertical'."},get badAlignment(){return"Invalid argument: Flyout alignment should be 'center' (default), 'left', or 'right'."},get noCoordinates(){return"Invalid argument: Flyout coordinates must contain a valid x,y pair."}},createEvent=_Events._createEventProperty,_LightDismissableLayer=_Base.Class.define(function(onLightDismiss){this._onLightDismiss=onLightDismiss,this._currentlyFocusedClient=null,this._clients=[]},{shown:function(client){client._focusable=!0;var index=this._clients.indexOf(client);-1===index&&(this._clients.push(client),client.onShow(this),_LightDismissService.isShown(this)?(_LightDismissService.updated(this),this._activateTopFocusableClientIfNeeded()):_LightDismissService.shown(this))},hiding:function(client){var index=this._clients.indexOf(client);-1!==index&&(this._clients[index]._focusable=!1,this._activateTopFocusableClientIfNeeded())},hidden:function(client){var index=this._clients.indexOf(client);-1!==index&&(this._clients.splice(index,1),client.setZIndex(""),client.onHide(),0===this._clients.length?_LightDismissService.hidden(this):(_LightDismissService.updated(this),this._activateTopFocusableClientIfNeeded()))},keyDown:function(client,eventObject){_LightDismissService.keyDown(this,eventObject)},keyUp:function(client,eventObject){_LightDismissService.keyUp(this,eventObject)},keyPress:function(client,eventObject){_LightDismissService.keyPress(this,eventObject)},clients:{get:function(){return this._clients}},_clientForElement:function(element){for(var i=this._clients.length-1;i>=0;i--)if(this._clients[i].containsElement(element))return this._clients[i];return null},_focusableClientForElement:function(element){for(var i=this._clients.length-1;i>=0;i--)if(this._clients[i]._focusable&&this._clients[i].containsElement(element))return this._clients[i];return null},_getTopmostFocusableClient:function(){for(var i=this._clients.length-1;i>=0;i--){var client=this._clients[i];if(client&&client._focusable)return client}return null},_activateTopFocusableClientIfNeeded:function(){var topClient=this._getTopmostFocusableClient();if(topClient&&_LightDismissService.isTopmost(this)){var useSetActive=!_KeyboardBehavior._keyboardSeenLast;topClient.onTakeFocus(useSetActive)}},setZIndex:function(zIndex){this._clients.forEach(function(client,index){client.setZIndex(zIndex+index)},this)},getZIndexCount:function(){return this._clients.length},containsElement:function(element){return!!this._clientForElement(element)},onTakeFocus:function(useSetActive){var client=this._focusableClientForElement(_Global.document.activeElement);!client&&-1!==this._clients.indexOf(this._currentlyFocusedClient)&&this._currentlyFocusedClient._focusable&&(client=this._currentlyFocusedClient),client||(client=this._getTopmostFocusableClient()),this._currentlyFocusedClient=client,client&&client.onTakeFocus(useSetActive)},onFocus:function(element){this._currentlyFocusedClient=this._clientForElement(element),this._currentlyFocusedClient&&this._currentlyFocusedClient.onFocus(element)},onShow:function(service){},onHide:function(){this._currentlyFocusedClient=null},onKeyInStack:function(info){var index=this._clients.indexOf(this._currentlyFocusedClient);if(-1!==index)for(var clients=this._clients.slice(0,index+1),i=clients.length-1;i>=0&&!info.propagationStopped;i--)clients[i]._focusable&&clients[i].onKeyInStack(info)},onShouldLightDismiss:function(info){return _LightDismissService.DismissalPolicies.light(info)},onLightDismiss:function(info){this._onLightDismiss(info)}}),_CascadeManager=_Base.Class.define(function(){var that=this;this._dismissableLayer=new _LightDismissableLayer(function(info){info.reason===_LightDismissService.LightDismissalReasons.escape?that.collapseFlyout(that.getAt(that.length-1)):that.collapseAll()}),this._cascadingStack=[],this._handleKeyDownInCascade_bound=this._handleKeyDownInCascade.bind(this),this._inputType=null},{appendFlyout:function(flyoutToAdd){if(_Log.log&&this.reentrancyLock&&_Log.log("_CascadeManager is attempting to append a Flyout through reentrancy.","winjs _CascadeManager","error"),this.indexOf(flyoutToAdd)<0){var collapseFn=this.collapseAll;if(flyoutToAdd._positionRequest instanceof PositionRequests.AnchorPositioning){var indexOfParentFlyout=this.indexOfElement(flyoutToAdd._positionRequest.anchor);indexOfParentFlyout>=0&&(collapseFn=function(){this.collapseFlyout(this.getAt(indexOfParentFlyout+1))})}collapseFn.call(this),flyoutToAdd.element.addEventListener("keydown",this._handleKeyDownInCascade_bound,!1),this._cascadingStack.push(flyoutToAdd)}},collapseFlyout:function(flyout){if(!this.reentrancyLock&&flyout&&this.indexOf(flyout)>=0){this.reentrancyLock=!0;var signal=new _Signal;this.unlocked=signal.promise;for(var subFlyout;this.length&&flyout!==subFlyout;)subFlyout=this._cascadingStack.pop(),subFlyout.element.removeEventListener("keydown",this._handleKeyDownInCascade_bound,!1),subFlyout._hide();0===this._cascadingStack.length&&(this._inputType=null),this.reentrancyLock=!1,this.unlocked=null,signal.complete()}},flyoutShown:function(flyout){this._dismissableLayer.shown(flyout._dismissable)},flyoutHiding:function(flyout){this._dismissableLayer.hiding(flyout._dismissable)},flyoutHidden:function(flyout){this._dismissableLayer.hidden(flyout._dismissable)},collapseAll:function(){var headFlyout=this.getAt(0);headFlyout&&this.collapseFlyout(headFlyout)},indexOf:function(flyout){return this._cascadingStack.indexOf(flyout)},indexOfElement:function(el){for(var indexOfAssociatedFlyout=-1,i=0,len=this.length;len>i;i++){var currentFlyout=this.getAt(i);if(currentFlyout.element.contains(el)){indexOfAssociatedFlyout=i;break}}return indexOfAssociatedFlyout},length:{get:function(){return this._cascadingStack.length}},getAt:function(index){return this._cascadingStack[index]},handleFocusIntoFlyout:function(event){var index=this.indexOfElement(event.target);if(index>=0){var subFlyout=this.getAt(index+1);this.collapseFlyout(subFlyout)}},inputType:{get:function(){return this._inputType||(this._inputType=_KeyboardBehavior._lastInputType),this._inputType}},dismissableLayer:{get:function(){return this._dismissableLayer}},_handleKeyDownInCascade:function(event){var rtl="rtl"===_ElementUtilities._getComputedStyle(event.target).direction,leftKey=rtl?Key.rightArrow:Key.leftArrow,target=event.target;if(event.keyCode===leftKey){var index=this.indexOfElement(target);if(index>=1){var subFlyout=this.getAt(index);this.collapseFlyout(subFlyout),event.preventDefault()}}else(event.keyCode===Key.alt||event.keyCode===Key.F10)&&this.collapseAll()}}),AnimationOffsets={top:{top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},bottom:{top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},left:{top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},right:{top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"}},PositionRequests={AnchorPositioning:_Base.Class.define(function(anchor,placement,alignment){if("string"==typeof anchor?anchor=_Global.document.getElementById(anchor):anchor&&anchor.element&&(anchor=anchor.element),!anchor)throw new _ErrorFromName("WinJS.UI.Flyout.NoAnchor",strings.noAnchor);this.anchor=anchor,this.placement=placement,this.alignment=alignment},{getTopLeft:function(flyoutMeasurements,isRtl){function configureVerticalWithScroll(anchorBorderBox){topHasMoreRoom(anchorBorderBox)?(nextContentHeight=spaceAbove(anchorBorderBox)-verticalMarginBorderPadding,nextTop=_Overlay._Overlay._keyboardInfo._visibleDocTop,nextAnimOffset=AnimationOffsets.top):(nextContentHeight=spaceBelow(anchorBorderBox)-verticalMarginBorderPadding,nextTop=_Constants.pinToBottomEdge,nextAnimOffset=AnimationOffsets.bottom),doesScroll=!0}function fitsVerticallyWithCenteredAnchor(anchorBorderBox,flyoutMeasurements){return(_Overlay._Overlay._keyboardInfo._visibleDocHeight-anchorBorderBox.height)/2>=flyoutMeasurements.totalHeight}function spaceAbove(anchorBorderBox){return anchorBorderBox.top-_Overlay._Overlay._keyboardInfo._visibleDocTop}function spaceBelow(anchorBorderBox){return _Overlay._Overlay._keyboardInfo._visibleDocBottom-anchorBorderBox.bottom}function topHasMoreRoom(anchorBorderBox){return spaceAbove(anchorBorderBox)>spaceBelow(anchorBorderBox)}function fitTop(bottomConstraint,flyoutMeasurements){return nextTop=bottomConstraint-flyoutMeasurements.totalHeight,nextAnimOffset=AnimationOffsets.top,nextTop>=_Overlay._Overlay._keyboardInfo._visibleDocTop&&nextTop+flyoutMeasurements.totalHeight<=_Overlay._Overlay._keyboardInfo._visibleDocBottom}function fitBottom(topConstraint,flyoutMeasurements){return nextTop=topConstraint,nextAnimOffset=AnimationOffsets.bottom,nextTop>=_Overlay._Overlay._keyboardInfo._visibleDocTop&&nextTop+flyoutMeasurements.totalHeight<=_Overlay._Overlay._keyboardInfo._visibleDocBottom}function fitLeft(leftConstraint,flyoutMeasurements){return nextLeft=leftConstraint-flyoutMeasurements.totalWidth,nextAnimOffset=AnimationOffsets.left,nextLeft>=0&&nextLeft+flyoutMeasurements.totalWidth<=_Overlay._Overlay._keyboardInfo._visualViewportWidth}function fitRight(rightConstraint,flyoutMeasurements){return nextLeft=rightConstraint,nextAnimOffset=AnimationOffsets.right,nextLeft>=0&&nextLeft+flyoutMeasurements.totalWidth<=_Overlay._Overlay._keyboardInfo._visualViewportWidth}function centerVertically(anchorBorderBox,flyoutMeasurements){nextTop=anchorBorderBox.top+anchorBorderBox.height/2-flyoutMeasurements.totalHeight/2,
nextTop<_Overlay._Overlay._keyboardInfo._visibleDocTop?nextTop=_Overlay._Overlay._keyboardInfo._visibleDocTop:nextTop+flyoutMeasurements.totalHeight>=_Overlay._Overlay._keyboardInfo._visibleDocBottom&&(nextTop=_Constants.pinToBottomEdge)}function alignHorizontally(anchorBorderBox,flyoutMeasurements,alignment){if("center"===alignment)nextLeft=anchorBorderBox.left+anchorBorderBox.width/2-flyoutMeasurements.totalWidth/2;else if("left"===alignment)nextLeft=anchorBorderBox.left;else{if("right"!==alignment)throw new _ErrorFromName("WinJS.UI.Flyout.BadAlignment",strings.badAlignment);nextLeft=anchorBorderBox.right-flyoutMeasurements.totalWidth}0>nextLeft?nextLeft=0:nextLeft+flyoutMeasurements.totalWidth>=_Overlay._Overlay._keyboardInfo._visualViewportWidth&&(nextLeft=_Constants.pinToRightEdge)}var anchorBorderBox;try{anchorBorderBox=this.anchor.getBoundingClientRect()}catch(e){throw new _ErrorFromName("WinJS.UI.Flyout.NoAnchor",strings.noAnchor)}var nextLeft,nextTop,doesScroll,nextAnimOffset,verticalMarginBorderPadding=flyoutMeasurements.totalHeight-flyoutMeasurements.contentHeight,nextContentHeight=flyoutMeasurements.contentHeight,currentAlignment=this.alignment;switch(this.placement){case"top":fitTop(anchorBorderBox.top,flyoutMeasurements)||(nextTop=_Overlay._Overlay._keyboardInfo._visibleDocTop,doesScroll=!0,nextContentHeight=spaceAbove(anchorBorderBox)-verticalMarginBorderPadding),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment);break;case"bottom":fitBottom(anchorBorderBox.bottom,flyoutMeasurements)||(nextTop=_Constants.pinToBottomEdge,doesScroll=!0,nextContentHeight=spaceBelow(anchorBorderBox)-verticalMarginBorderPadding),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment);break;case"left":fitLeft(anchorBorderBox.left,flyoutMeasurements)||(nextLeft=0),centerVertically(anchorBorderBox,flyoutMeasurements);break;case"right":fitRight(anchorBorderBox.right,flyoutMeasurements)||(nextLeft=_Constants.pinToRightEdge),centerVertically(anchorBorderBox,flyoutMeasurements);break;case"autovertical":fitTop(anchorBorderBox.top,flyoutMeasurements)||fitBottom(anchorBorderBox.bottom,flyoutMeasurements)||configureVerticalWithScroll(anchorBorderBox),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment);break;case"autohorizontal":fitLeft(anchorBorderBox.left,flyoutMeasurements)||fitRight(anchorBorderBox.right,flyoutMeasurements)||(nextLeft=_Constants.pinToRightEdge),centerVertically(anchorBorderBox,flyoutMeasurements);break;case"auto":fitsVerticallyWithCenteredAnchor(anchorBorderBox,flyoutMeasurements)?(fitTop(anchorBorderBox.top,flyoutMeasurements)||fitBottom(anchorBorderBox.bottom,flyoutMeasurements),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment)):fitLeft(anchorBorderBox.left,flyoutMeasurements)||fitRight(anchorBorderBox.right,flyoutMeasurements)?centerVertically(anchorBorderBox,flyoutMeasurements):(configureVerticalWithScroll(anchorBorderBox),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment));break;case"_cascade":fitBottom(anchorBorderBox.top-flyoutMeasurements.marginTop,flyoutMeasurements)||fitTop(anchorBorderBox.bottom+flyoutMeasurements.marginBottom,flyoutMeasurements)||centerVertically(anchorBorderBox,flyoutMeasurements);var horizontalOverlap=3,beginRight=anchorBorderBox.right-flyoutMeasurements.marginLeft-horizontalOverlap,beginLeft=anchorBorderBox.left+flyoutMeasurements.marginRight+horizontalOverlap;isRtl?fitLeft(beginLeft,flyoutMeasurements)||fitRight(beginRight,flyoutMeasurements)||(nextLeft=0,nextAnimOffset=AnimationOffsets.left):fitRight(beginRight,flyoutMeasurements)||fitLeft(beginLeft,flyoutMeasurements)||(nextLeft=_Constants.pinToRightEdge,nextAnimOffset=AnimationOffsets.right);break;default:throw new _ErrorFromName("WinJS.UI.Flyout.BadPlacement",strings.badPlacement)}return{left:nextLeft,top:nextTop,animOffset:nextAnimOffset,doesScroll:doesScroll,contentHeight:nextContentHeight,verticalMarginBorderPadding:verticalMarginBorderPadding}}}),CoordinatePositioning:_Base.Class.define(function(coordinates){if(coordinates.clientX===+coordinates.clientX&&coordinates.clientY===+coordinates.clientY){var temp=coordinates;coordinates={x:temp.clientX,y:temp.clientY}}else if(coordinates.x!==+coordinates.x||coordinates.y!==+coordinates.y)throw new _ErrorFromName("WinJS.UI.Flyout.NoCoordinates",strings.noCoordinates);this.coordinates=coordinates},{getTopLeft:function(flyoutMeasurements,isRtl){var currentCoordinates=this.coordinates,widthOfBorderBox=flyoutMeasurements.totalWidth-flyoutMeasurements.marginLeft-flyoutMeasurements.marginRight,adjustForRTL=isRtl?widthOfBorderBox:0,verticalMarginBorderPadding=flyoutMeasurements.totalHeight-flyoutMeasurements.contentHeight,nextContentHeight=flyoutMeasurements.contentHeight,nextTop=currentCoordinates.y-flyoutMeasurements.marginTop,nextLeft=currentCoordinates.x-flyoutMeasurements.marginLeft-adjustForRTL;return 0>nextTop?nextTop=0:nextTop+flyoutMeasurements.totalHeight>_Overlay._Overlay._keyboardInfo._visibleDocBottom&&(nextTop=_Constants.pinToBottomEdge),0>nextLeft?nextLeft=0:nextLeft+flyoutMeasurements.totalWidth>_Overlay._Overlay._keyboardInfo._visualViewportWidth&&(nextLeft=_Constants.pinToRightEdge),{left:nextLeft,top:nextTop,verticalMarginBorderPadding:verticalMarginBorderPadding,contentHeight:nextContentHeight,doesScroll:!1,animOffset:AnimationOffsets.top}}})},Flyout=_Base.Class.derive(_Overlay._Overlay,function(element,options){options=options||{},this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,options);var _elms=this._element.getElementsByTagName("*"),firstDiv=this._addFirstDiv();firstDiv.tabIndex=_ElementUtilities._getLowestTabIndexInList(_elms);var finalDiv=this._addFinalDiv();return finalDiv.tabIndex=_ElementUtilities._getHighestTabIndexInList(_elms),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(element,options){this._placement="auto",this._alignment="center",this._baseOverlayConstructor(element,options),this._element.style.visibilty="hidden",this._element.style.display="none",_ElementUtilities.addClass(this._element,_Constants.flyoutClass);var that=this;this._dismissable=new _LightDismissService.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){that.hide()},onTakeFocus:function(useSetActive){that._dismissable.restoreFocus()||(_ElementUtilities.hasClass(that.element,_Constants.menuClass)?_Overlay._Overlay._trySetActive(that._element):that._focusOnFirstFocusableElementOrThis())}});var role=this._element.getAttribute("role");(null===role||""===role||void 0===role)&&(_ElementUtilities.hasClass(this._element,_Constants.menuClass)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));var label=this._element.getAttribute("aria-label");(null===label||""===label||void 0===label)&&this._element.setAttribute("aria-label",strings.ariaLabel),this._currentAnimateIn=this._flyoutAnimateIn,this._currentAnimateOut=this._flyoutAnimateOut,_ElementUtilities._addEventListener(this.element,"focusin",this._handleFocusIn.bind(this),!1)},anchor:{get:function(){return this._anchor},set:function(value){this._anchor=value}},placement:{get:function(){return this._placement},set:function(value){if("top"!==value&&"bottom"!==value&&"left"!==value&&"right"!==value&&"auto"!==value&&"autohorizontal"!==value&&"autovertical"!==value)throw new _ErrorFromName("WinJS.UI.Flyout.BadPlacement",strings.badPlacement);this._placement=value}},alignment:{get:function(){return this._alignment},set:function(value){if("right"!==value&&"left"!==value&&"center"!==value)throw new _ErrorFromName("WinJS.UI.Flyout.BadAlignment",strings.badAlignment);this._alignment=value}},disabled:{get:function(){return!!this._element.disabled},set:function(value){value=!!value;var oldValue=!!this._element.disabled;oldValue!==value&&(this._element.disabled=value,!this.hidden&&this._element.disabled&&this.hide())}},onbeforeshow:createEvent(_Overlay._Overlay.beforeShow),onaftershow:createEvent(_Overlay._Overlay.afterShow),onbeforehide:createEvent(_Overlay._Overlay.beforeHide),onafterhide:createEvent(_Overlay._Overlay.afterHide),_dispose:function(){_Dispose.disposeSubTree(this.element),this._hide(),Flyout._cascadeManager.flyoutHidden(this),this.anchor=null},show:function(anchor,placement,alignment){this._writeProfilerMark("show,StartTM"),this._positionRequest=new PositionRequests.AnchorPositioning(anchor||this._anchor,placement||this._placement,alignment||this._alignment),this._show()},_show:function(){this._baseFlyoutShow()},showAt:function(coordinates){this._writeProfilerMark("show,StartTM"),this._positionRequest=new PositionRequests.CoordinatePositioning(coordinates),this._show()},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){Flyout._cascadeManager.collapseFlyout(this),this._baseHide()&&Flyout._cascadeManager.flyoutHiding(this)},_beforeEndHide:function(){Flyout._cascadeManager.flyoutHidden(this)},_baseFlyoutShow:function(){if(!this.disabled&&!this._disposed)if(Flyout._cascadeManager.appendFlyout(this),this._element.winAnimating)this._doNext="show";else if(Flyout._cascadeManager.reentrancyLock){this._doNext="show";var that=this;Flyout._cascadeManager.unlocked.then(function(){that._checkDoNext()})}else if(this._baseShow()){if(!_ElementUtilities.hasClass(this.element,"win-menu")){var _elms=this._element.getElementsByTagName("*"),firstDiv=this.element.querySelectorAll(".win-first");this.element.children.length&&!_ElementUtilities.hasClass(this.element.children[0],_Constants.firstDivClass)&&(firstDiv&&firstDiv.length>0&&firstDiv.item(0).parentNode.removeChild(firstDiv.item(0)),firstDiv=this._addFirstDiv()),firstDiv.tabIndex=_ElementUtilities._getLowestTabIndexInList(_elms);var finalDiv=this.element.querySelectorAll(".win-final");_ElementUtilities.hasClass(this.element.children[this.element.children.length-1],_Constants.finalDivClass)||(finalDiv&&finalDiv.length>0&&finalDiv.item(0).parentNode.removeChild(finalDiv.item(0)),finalDiv=this._addFinalDiv()),finalDiv.tabIndex=_ElementUtilities._getHighestTabIndexInList(_elms)}Flyout._cascadeManager.flyoutShown(this)}},_lightDismiss:function(){Flyout._cascadeManager.collapseAll()},_ensurePosition:function(){this._keyboardMovedUs=!1,this._clearAdjustedStyles(),this._setAlignment();var flyoutMeasurements=measureElement(this._element),isRtl="rtl"===_ElementUtilities._getComputedStyle(this._element).direction;this._currentPosition=this._positionRequest.getTopLeft(flyoutMeasurements,isRtl),this._currentPosition.top<0?(this._element.style.bottom=_Overlay._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=this._currentPosition.top+"px",this._element.style.bottom="auto"),this._currentPosition.left<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._currentPosition.left+"px",this._element.style.right="auto"),this._currentPosition.doesScroll&&(_ElementUtilities.addClass(this._element,_Constants.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._currentPosition.contentHeight+"px"),_Overlay._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_clearAdjustedStyles:function(){this._element.style.top="0px",this._element.style.bottom="auto",this._element.style.left="0px",this._element.style.right="auto",_ElementUtilities.removeClass(this._element,_Constants.scrollsClass),null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null),_ElementUtilities.removeClass(this._element,"win-rightalign"),_ElementUtilities.removeClass(this._element,"win-leftalign")},_setAlignment:function(){switch(this._positionRequest.alignment){case"left":_ElementUtilities.addClass(this._element,"win-leftalign");break;case"right":_ElementUtilities.addClass(this._element,"win-rightalign")}},_showingKeyboard:function(event){if(!this.hidden&&(event.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var that=this;_Global.setTimeout(function(){that._adjustForKeyboard(),that._baseAnimateIn()},_Overlay._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._needToHandleHidingKeyboard){var that=this;_BaseUtils._setImmediate(function(){(!that.hidden||that._animating)&&that._ensurePosition()}),this._needToHandleHidingKeyboard=!1}},_checkKeyboardFit:function(){var keyboardMovedUs=!1,viewportHeight=_Overlay._Overlay._keyboardInfo._visibleDocHeight,adjustedMarginBoxHeight=this._currentPosition.contentHeight+this._currentPosition.verticalMarginBorderPadding;adjustedMarginBoxHeight>viewportHeight?(keyboardMovedUs=!0,this._currentPosition.top=_Constants.pinToBottomEdge,this._currentPosition.contentHeight=viewportHeight-this._currentPosition.verticalMarginBorderPadding,this._currentPosition.doesScroll=!0):this._currentPosition.top>=0&&this._currentPosition.top+adjustedMarginBoxHeight>_Overlay._Overlay._keyboardInfo._visibleDocBottom?(this._currentPosition.top=_Constants.pinToBottomEdge,keyboardMovedUs=!0):this._currentPosition.top===_Constants.pinToBottomEdge&&(keyboardMovedUs=!0),this._keyboardMovedUs=keyboardMovedUs},_adjustForKeyboard:function(){this._currentPosition.doesScroll&&(this._lastMaxHeight||(_ElementUtilities.addClass(this._element,_Constants.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._currentPosition.contentHeight+"px"),this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(_Overlay._Overlay._keyboardInfo._isResized)this._needToHandleHidingKeyboard=!0;else{var that=this;_BaseUtils._setImmediate(function(){(!that.hidden||that._animating)&&that._ensurePosition()})}},_checkScrollPosition:function(showing){(!this.hidden||showing)&&(this._currentPosition.top<0?(this._element.style.bottom=_Overlay._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=this._currentPosition.top+"px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",Animations.showPopup(this._element,this._currentPosition.animOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,Animations.hidePopup(this._element,this._currentPosition.animOffset))},_hideAllOtherFlyouts:function(thisFlyout){for(var flyouts=_Global.document.querySelectorAll("."+_Constants.flyoutClass),i=0;i<flyouts.length;i++){var flyoutControl=flyouts[i].winControl;flyoutControl&&!flyoutControl.hidden&&flyoutControl!==thisFlyout&&flyoutControl.hide()}},_handleKeyDown:function(event){event.keyCode!==Key.space&&event.keyCode!==Key.enter||this!==_Global.document.activeElement?!event.shiftKey||event.keyCode!==Key.tab||this!==_Global.document.activeElement||event.altKey||event.ctrlKey||event.metaKey||(event.preventDefault(),event.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(event.preventDefault(),event.stopPropagation(),this.winControl.hide())},_handleFocusIn:function(event){this.element.contains(event.relatedTarget)||Flyout._cascadeManager.handleFocusIntoFlyout(event)},_addFirstDiv:function(){var firstDiv=_Global.document.createElement("div");firstDiv.className=_Constants.firstDivClass,firstDiv.style.display="inline",firstDiv.setAttribute("role","menuitem"),firstDiv.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(firstDiv,this._element.children[0]):this._element.appendChild(firstDiv);var that=this;return _ElementUtilities._addEventListener(firstDiv,"focusin",function(){that._focusOnLastFocusableElementOrThis()},!1),firstDiv},_addFinalDiv:function(){var finalDiv=_Global.document.createElement("div");finalDiv.className=_Constants.finalDivClass,finalDiv.style.display="inline",finalDiv.setAttribute("role","menuitem"),finalDiv.setAttribute("aria-hidden","true"),this._element.appendChild(finalDiv);var that=this;return _ElementUtilities._addEventListener(finalDiv,"focusin",function(){that._focusOnFirstFocusableElementOrThis()},!1),finalDiv},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.Flyout:"+this._id+":"+text)}},{_cascadeManager:new _CascadeManager});return Flyout})})}),define("WinJS/Controls/CommandingSurface/_Constants",["require","exports"],function(require,exports){exports.ClassNames={controlCssClass:"win-commandingsurface",disposableCssClass:"win-disposable",tabStopClass:"win-commandingsurface-tabstop",contentClass:"win-commandingsurface-content",actionAreaCssClass:"win-commandingsurface-actionarea",actionAreaContainerCssClass:"win-commandingsurface-actionareacontainer",overflowButtonCssClass:"win-commandingsurface-overflowbutton",spacerCssClass:"win-commandingsurface-spacer",ellipsisCssClass:"win-commandingsurface-ellipsis",overflowAreaCssClass:"win-commandingsurface-overflowarea",overflowAreaContainerCssClass:"win-commandingsurface-overflowareacontainer",contentFlyoutCssClass:"win-commandingsurface-contentflyout",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",insetOutlineClass:"win-commandingsurface-insetoutline",openingClass:"win-commandingsurface-opening",openedClass:"win-commandingsurface-opened",closingClass:"win-commandingsurface-closing",closedClass:"win-commandingsurface-closed",noneClass:"win-commandingsurface-closeddisplaynone",minimalClass:"win-commandingsurface-closeddisplayminimal",compactClass:"win-commandingsurface-closeddisplaycompact",fullClass:"win-commandingsurface-closeddisplayfull",overflowTopClass:"win-commandingsurface-overflowtop",overflowBottomClass:"win-commandingsurface-overflowbottom",commandHiddenClass:"win-commandingsurface-command-hidden",commandPrimaryOverflownPolicyClass:"win-commandingsurface-command-primary-overflown",commandSecondaryOverflownPolicyClass:"win-commandingsurface-command-secondary-overflown",commandSeparatorHiddenPolicyClass:"win-commandingsurface-command-separator-hidden"},exports.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",commandPropertyMutated:"_commandpropertymutated"},exports.actionAreaCommandWidth=68,exports.actionAreaSeparatorWidth=34,exports.actionAreaOverflowButtonWidth=32,exports.overflowCommandHeight=44,exports.overflowSeparatorHeight=12,exports.controlMinWidth=exports.actionAreaOverflowButtonWidth,exports.overflowAreaMaxWidth=480,exports.heightOfMinimal=24,exports.heightOfCompact=48,exports.contentMenuCommandDefaultLabel="Custom content",exports.defaultClosedDisplayMode="compact",exports.defaultOpened=!1,exports.defaultOverflowDirection="bottom",exports.typeSeparator="separator",exports.typeContent="content",exports.typeButton="button",exports.typeToggle="toggle",exports.typeFlyout="flyout",exports.commandSelector=".win-command",exports.primaryCommandSection="primary",exports.secondaryCommandSection="secondary"}),define("WinJS/Controls/ToolBar/_Constants",["require","exports","../CommandingSurface/_Constants"],function(require,exports,_CommandingSurfaceConstants){exports.ClassNames={controlCssClass:"win-toolbar",disposableCssClass:"win-disposable",actionAreaCssClass:"win-toolbar-actionarea",overflowButtonCssClass:"win-toolbar-overflowbutton",spacerCssClass:"win-toolbar-spacer",ellipsisCssClass:"win-toolbar-ellipsis",overflowAreaCssClass:"win-toolbar-overflowarea",contentFlyoutCssClass:"win-toolbar-contentflyout",emptytoolbarCssClass:"win-toolbar-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",openedClass:"win-toolbar-opened",closedClass:"win-toolbar-closed",compactClass:"win-toolbar-closeddisplaycompact",fullClass:"win-toolbar-closeddisplayfull",overflowTopClass:"win-toolbar-overflowtop",overflowBottomClass:"win-toolbar-overflowbottom",placeHolderCssClass:"win-toolbar-placeholder"},exports.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},exports.OverflowDirection={top:"top",bottom:"bottom"},exports.overflowAreaMaxWidth=_CommandingSurfaceConstants.overflowAreaMaxWidth,exports.controlMinWidth=_CommandingSurfaceConstants.controlMinWidth,exports.defaultClosedDisplayMode="compact",exports.defaultOpened=!1,exports.typeSeparator="separator",exports.typeContent="content",exports.typeButton="button",exports.typeToggle="toggle",exports.typeFlyout="flyout",exports.commandSelector=".win-command",exports.primaryCommandSection="primary",exports.secondaryCommandSection="secondary"}),define("WinJS/Controls/AppBar/_Icon",["exports","../../Core/_Base","../../Core/_Resources"],function(exports,_Base,_Resources){"use strict";var glyphs=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview","hamburger"],icons=glyphs.reduce(function(fixedIcons,item){return fixedIcons[item]={get:function(){return _Resources._getWinJSString("ui/appBarIcons/"+item).value}},fixedIcons},{});_Base.Namespace._moduleDefine(exports,"WinJS.UI.AppBarIcon",icons)}),define("WinJS/Controls/AppBar/_Command",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../Flyout/_Overlay","../Tooltip","../_LegacyAppBar/_Constants","./_Icon"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_Control,_Dispose,_ElementUtilities,_Overlay,Tooltip,_Constants,_Icon){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{AppBarCommand:_Base.Namespace._lazy(function(){function _handleClick(event){var command=this.winControl;if(command){if(command._type===_Constants.typeToggle)command.selected=!command.selected;else if(command._type===_Constants.typeFlyout&&command._flyout){var flyout=command._flyout;"string"==typeof flyout&&(flyout=_Global.document.getElementById(flyout)),flyout.show||(flyout=flyout.winControl),flyout&&flyout.show&&flyout.show(this,"autovertical")}command.onclick&&command.onclick(event)}}function makeObservable(command,propertyName){var _value=command[propertyName],proto=command.constructor.prototype,originalDesc=getPropertyDescriptor(proto,propertyName)||{},getter=originalDesc.get.bind(command)||function(){return _value},setter=originalDesc.set.bind(command)||function(value){_value=value};Object.defineProperty(command,propertyName,{get:function(){return getter()},set:function(value){var oldValue=getter();setter(value);var newValue=getter();this._disposed||oldValue===value||oldValue===newValue||command._disposed||command._propertyMutations.dispatchEvent(_Constants.commandPropertyMutated,{command:command,propertyName:propertyName,oldValue:oldValue,newValue:newValue})}})}function getPropertyDescriptor(obj,propertyName){for(var desc=null;obj&&!desc;)desc=Object.getOwnPropertyDescriptor(obj,propertyName),obj=Object.getPrototypeOf(obj);return desc}var PropertyMutations=_Base.Class.define(function(){this._observer=_BaseUtils._merge({},_Events.eventMixin)},{bind:function(callback){this._observer.addEventListener(_Constants.commandPropertyMutated,callback)},unbind:function(callback){this._observer.removeEventListener(_Constants.commandPropertyMutated,callback)},dispatchEvent:function(type,detail){this._observer.dispatchEvent(type,detail)}}),strings={get ariaLabel(){return _Resources._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badDivElement(){return"Invalid argument: For a content command, the element must be null or a div element"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"},get badPriority(){return"Invalid argument: the priority of an {0} must be a non-negative integer"}},AppBarCommand=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.AppBarCommand.DuplicateConstruction",strings.duplicateConstruction);if(this._disposed=!1,options||(options={}),options.type||(this._type=_Constants.typeButton),options.section=options.section||_Constants.sectionPrimary,this._element=element,options.type===_Constants.typeContent?this._createContent():options.type===_Constants.typeSeparator?this._createSeparator():this._createButton(),_ElementUtilities.addClass(this._element,"win-disposable"),this._element.winControl=this,_ElementUtilities.addClass(this._element,_Constants.appBarCommandClass),options.onclick&&(this.onclick=options.onclick),options.onclick=_handleClick,_Control.setOptions(this,options),this._type!==_Constants.typeToggle||options.selected||(this.selected=!1),this._type!==_Constants.typeSeparator){var role=this._element.getAttribute("role");(null===role||""===role||void 0===role)&&(role=this._type===_Constants.typeToggle?"checkbox":this._type===_Constants.typeContent?"group":"menuitem",this._element.setAttribute("role",role),this._type===_Constants.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var label=this._element.getAttribute("aria-label");(null===label||""===label||void 0===label)&&this._element.setAttribute("aria-label",strings.ariaLabel)}this._propertyMutations=new PropertyMutations;var that=this;ObservablePropertyWhiteList.forEach(function(propertyName){makeObservable(that,propertyName)})},{id:{get:function(){return this._element.id},set:function(value){value&&!this._element.id&&(this._element.id=value)}},type:{get:function(){return this._type},set:function(value){this._type||(value!==_Constants.typeContent&&value!==_Constants.typeFlyout&&value!==_Constants.typeToggle&&value!==_Constants.typeSeparator?this._type=_Constants.typeButton:this._type=value)}},label:{get:function(){return this._label},set:function(value){this._label=value,this._labelSpan&&(this._labelSpan.textContent=this.label),!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label),this._element.setAttribute("aria-label",this.label),this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(value){this._icon=_Icon[value]||value,this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",_ElementUtilities.addClass(this._imageSpan,"win-commandglyph")):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",_ElementUtilities.removeClass(this._imageSpan,"win-commandglyph")))}},onclick:{get:function(){return this._onclick},set:function(value){if(value&&"function"!=typeof value)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadClick",_Resources._formatString(strings.badClick,"AppBarCommand"));this._onclick=value}},priority:{get:function(){return this._priority},set:function(value){if(!(void 0===value||"number"==typeof value&&value>=0))throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadPriority",_Resources._formatString(strings.badPriority,"AppBarCommand"));this._priority=value}},flyout:{get:function(){var flyout=this._flyout;return"string"==typeof flyout&&(flyout=_Global.document.getElementById(flyout)),flyout&&!flyout.element&&flyout.winControl&&(flyout=flyout.winControl),flyout},set:function(value){var id=value;id&&"string"!=typeof id&&(id.element&&(id=id.element),id&&(id.id?id=id.id:(id.id=_ElementUtilities._uniqueID(id),id=id.id))),"string"==typeof id&&this._element.setAttribute("aria-owns",id),this._flyout=value}},section:{get:function(){return this._section},set:function(value){(!this._section||_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled)&&this._setSection(value)}},tooltip:{get:function(){return this._tooltip},set:function(value){this._tooltip=value,this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip),this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(value){this._element.setAttribute("aria-checked",value)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(value){this._element.disabled=value}},hidden:{get:function(){return _ElementUtilities.hasClass(this._element,_Constants.commandHiddenClass)},set:function(value){if(value!==this.hidden){var wasHidden=this.hidden;value?_ElementUtilities.addClass(this._element,_Constants.commandHiddenClass):_ElementUtilities.removeClass(this._element,_Constants.commandHiddenClass),this._sendEvent(_Constants.commandVisibilityChanged)||(wasHidden?_ElementUtilities.addClass(this._element,_Constants.commandHiddenClass):_ElementUtilities.removeClass(this._element,_Constants.commandHiddenClass))}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(element){this._firstElementFocus=element===this.element?null:element,this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(element){this._lastElementFocus=element===this.element?null:element,this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,
this._tooltipControl&&this._tooltipControl.dispose(),this._type===_Constants.typeContent&&_Dispose.disposeSubTree(this.element))},addEventListener:function(type,listener,useCapture){return this._element.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){return this._element.removeEventListener(type,listener,useCapture)},extraClass:{get:function(){return this._extraClass},set:function(value){this._extraClass&&_ElementUtilities.removeClass(this._element,this._extraClass),this._extraClass=value,_ElementUtilities.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadDivElement",strings.badDivElement)}else this._element=_Global.document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadHrElement",strings.badHrElement)}else this._element=_Global.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadButtonElement",strings.badButtonElement);var type=this._element.getAttribute("type");(null===type||""===type||void 0===type)&&this._element.setAttribute("type","button"),this._element.innerHTML=""}else this._element=_Global.document.createElement("button");this._element.type="button",this._iconSpan=_Global.document.createElement("span"),this._iconSpan.setAttribute("aria-hidden","true"),this._iconSpan.className="win-commandicon",this._iconSpan.tabIndex=-1,this._element.appendChild(this._iconSpan),this._imageSpan=_Global.document.createElement("span"),this._imageSpan.setAttribute("aria-hidden","true"),this._imageSpan.className="win-commandimage",this._imageSpan.tabIndex=-1,this._iconSpan.appendChild(this._imageSpan),this._labelSpan=_Global.document.createElement("span"),this._labelSpan.setAttribute("aria-hidden","true"),this._labelSpan.className="win-label",this._labelSpan.tabIndex=-1,this._element.appendChild(this._labelSpan),this._tooltipControl=new Tooltip.Tooltip(this._element);var that=this;this._tooltipControl.addEventListener("beforeopen",function(){that._hideIfFullSize&&!_Overlay._Overlay._getParentControlUsingClassName(that._element.parentElement,_Constants.reducedClass)&&that._tooltipControl.close()},!1)},_setSection:function(section){section||(section=_Constants.sectionPrimary),this._section&&(this._section===_Constants.sectionGlobal?_ElementUtilities.removeClass(this._element,_Constants.appBarCommandGlobalClass):this.section===_Constants.sectionSelection&&_ElementUtilities.removeClass(this._element,_Constants.appBarCommandSelectionClass)),this._section=section,section===_Constants.sectionGlobal?_ElementUtilities.addClass(this._element,_Constants.appBarCommandGlobalClass):section===_Constants.sectionSelection&&_ElementUtilities.addClass(this._element,_Constants.appBarCommandSelectionClass)},_updateTabStop:function(){this._firstElementFocus||this._lastElementFocus?this.element.tabIndex=-1:this.element.tabIndex=0},_isFocusable:function(){return!this.hidden&&this._type!==_Constants.typeSeparator&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)},_sendEvent:function(eventName,detail){if(!this._disposed){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(eventName,!0,!0,detail||{}),this._element.dispatchEvent(event)}}}),ObservablePropertyWhiteList=["label","disabled","flyout","extraClass","selected","onclick","hidden"];return AppBarCommand})}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Command:_Base.Namespace._lazy(function(){return exports.AppBarCommand})})}),define("WinJS/Controls/Menu/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Promise","../../Utilities/_Control","../../Utilities/_ElementUtilities","../_LegacyAppBar/_Constants","../Flyout/_Overlay"],function(exports,_Global,_Base,_ErrorFromName,_Resources,Promise,_Control,_ElementUtilities,_Constants,_Overlay){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{MenuCommand:_Base.Namespace._lazy(function(){var strings={get ariaLabel(){return _Resources._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},MenuCommand=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.MenuCommand.DuplicateConstruction",strings.duplicateConstruction);if(this._disposed=!1,options||(options={}),options.type||(this._type=_Constants.typeButton),this._element=element,options.type===_Constants.typeSeparator?this._createSeparator():this._createButton(),_ElementUtilities.addClass(this._element,"win-disposable"),this._element.winControl=this,_ElementUtilities.addClass(this._element,_Constants.menuCommandClass),options.selected||options.type!==_Constants.typeToggle||(this.selected=!1),options.onclick&&(this.onclick=options.onclick),options.onclick=this._handleClick.bind(this),_Control.setOptions(this,options),this._type!==_Constants.typeSeparator){var role=this._element.getAttribute("role");(null===role||""===role||void 0===role)&&(role="menuitem",this._type===_Constants.typeToggle&&(role="checkbox"),this._element.setAttribute("role",role),this._type===_Constants.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var label=this._element.getAttribute("aria-label");(null===label||""===label||void 0===label)&&this._element.setAttribute("aria-label",strings.ariaLabel)}},{id:{get:function(){return this._element.id},set:function(value){this._element.id||(this._element.id=value)}},type:{get:function(){return this._type},set:function(value){this._type||(value!==_Constants.typeButton&&value!==_Constants.typeFlyout&&value!==_Constants.typeToggle&&value!==_Constants.typeSeparator&&(value=_Constants.typeButton),this._type=value,value===_Constants.typeButton?_ElementUtilities.addClass(this.element,_Constants.menuCommandButtonClass):value===_Constants.typeFlyout?(_ElementUtilities.addClass(this.element,_Constants.menuCommandFlyoutClass),this.element.addEventListener("keydown",this._handleKeyDown.bind(this),!1)):value===_Constants.typeSeparator?_ElementUtilities.addClass(this.element,_Constants.menuCommandSeparatorClass):value===_Constants.typeToggle&&_ElementUtilities.addClass(this.element,_Constants.menuCommandToggleClass))}},label:{get:function(){return this._label},set:function(value){this._label=value||"",this._labelSpan&&(this._labelSpan.textContent=this.label),this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(value){if(value&&"function"!=typeof value)throw new _ErrorFromName("WinJS.UI.MenuCommand.BadClick",_Resources._formatString(strings.badClick,"MenuCommand"));this._onclick=value}},flyout:{get:function(){var flyout=this._flyout;return"string"==typeof flyout&&(flyout=_Global.document.getElementById(flyout)),flyout&&!flyout.element&&(flyout=flyout.winControl),flyout},set:function(value){var id=value;id&&"string"!=typeof id&&(id.element&&(id=id.element),id&&(id.id?id=id.id:(id.id=_ElementUtilities._uniqueID(id),id=id.id))),"string"==typeof id&&this._element.setAttribute("aria-owns",id),this._flyout!==value&&MenuCommand._deactivateFlyoutCommand(this),this._flyout=value}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(value){this._element.setAttribute("aria-checked",!!value)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(value){value=!!value,value&&this.type===_Constants.typeFlyout&&MenuCommand._deactivateFlyoutCommand(this),this._element.disabled=value}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(value){var menuControl=_Overlay._Overlay._getParentControlUsingClassName(this._element,_Constants.menuClass);if(menuControl&&!menuControl.hidden)throw new _ErrorFromName("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",_Resources._formatString(_Overlay._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));var style=this._element.style;value?(this.type===_Constants.typeFlyout&&MenuCommand._deactivateFlyoutCommand(this),style.visibility="hidden",style.display="none"):(style.visibility="",style.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(value){this._extraClass&&_ElementUtilities.removeClass(this._element,this._extraClass),this._extraClass=value,_ElementUtilities.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0)},addEventListener:function(type,listener,useCapture){return this._element.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){return this._element.removeEventListener(type,listener,useCapture)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.MenuCommand.BadHrElement",strings.badHrElement)}else this._element=_Global.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.MenuCommand.BadButtonElement",strings.badButtonElement)}else this._element=_Global.document.createElement("button");this._element.innerHTML='<div class="win-menucommand-liner"><span class="win-toggleicon" aria-hidden="true"></span><span class="win-label" aria-hidden="true"></span><span class="win-flyouticon" aria-hidden="true"></span></div>',this._element.type="button",this._menuCommandLiner=this._element.firstElementChild,this._toggleSpan=this._menuCommandLiner.firstElementChild,this._labelSpan=this._toggleSpan.nextElementSibling,this._flyoutSpan=this._labelSpan.nextElementSibling},_sendEvent:function(eventName,detail){if(!this._disposed){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(eventName,!0,!0,detail||{}),this._element.dispatchEvent(event)}},_invoke:function(event){this.hidden||this.disabled||this._disposed||(this._type===_Constants.typeToggle?this.selected=!this.selected:this._type===_Constants.typeFlyout&&MenuCommand._activateFlyoutCommand(this),event&&"click"===event.type&&this.onclick&&this.onclick(event),this._sendEvent(_Constants._menuCommandInvokedEvent,{command:this}))},_handleClick:function(event){this._invoke(event)},_handleKeyDown:function(event){var Key=_ElementUtilities.Key,rtl="rtl"===_ElementUtilities._getComputedStyle(this.element).direction,rightKey=rtl?Key.leftArrow:Key.rightArrow;event.keyCode===rightKey&&this.type===_Constants.typeFlyout&&(this._invoke(event),event.preventDefault())}},{_activateFlyoutCommand:function(menuCommand){return new Promise(function(c,e){menuCommand=menuCommand.winControl||menuCommand;var subFlyout=menuCommand.flyout;subFlyout&&subFlyout.hidden&&subFlyout.show?(_ElementUtilities.addClass(menuCommand.element,_Constants.menuCommandFlyoutActivatedClass),subFlyout.element.setAttribute("aria-expanded","true"),subFlyout.addEventListener("beforehide",function beforeHide(){subFlyout.removeEventListener("beforehide",beforeHide,!1),_ElementUtilities.removeClass(menuCommand.element,_Constants.menuCommandFlyoutActivatedClass),subFlyout.element.removeAttribute("aria-expanded")},!1),subFlyout.addEventListener("aftershow",function afterShow(){subFlyout.removeEventListener("aftershow",afterShow,!1),c()},!1),subFlyout.show(menuCommand,"_cascade")):e()})},_deactivateFlyoutCommand:function(menuCommand){return new Promise(function(c){menuCommand=menuCommand.winControl||menuCommand,_ElementUtilities.removeClass(menuCommand.element,_Constants.menuCommandFlyoutActivatedClass);var subFlyout=menuCommand.flyout;subFlyout&&!subFlyout.hidden&&subFlyout.hide?(subFlyout.addEventListener("afterhide",function afterHide(){subFlyout.removeEventListener("afterhide",afterHide,!1),c()},!1),subFlyout.hide()):c()})}});return MenuCommand})})});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};return define("WinJS/Controls/CommandingSurface/_MenuCommand",["require","exports","../Menu/_Command"],function(require,exports,_MenuCommandBase){var _MenuCommand=function(_super){function _MenuCommand(element,options){options&&options.beforeInvoke&&(this._beforeInvoke=options.beforeInvoke),_super.call(this,element,options)}return __extends(_MenuCommand,_super),_MenuCommand.prototype._invoke=function(event){this._beforeInvoke&&this._beforeInvoke(event),_super.prototype._invoke.call(this,event)},_MenuCommand}(_MenuCommandBase.MenuCommand);exports._MenuCommand=_MenuCommand}),define("WinJS/Utilities/_OpenCloseMachine",["require","exports","../Core/_Global","../Promise","../_Signal"],function(require,exports,_Global,Promise,_Signal){"use strict";function cancelablePromise(animationPromise){return Promise._cancelBlocker(animationPromise,function(){animationPromise.cancel()})}function _(){}function interruptible(object,workFn){object._interruptibleWorkPromises=object._interruptibleWorkPromises||[];var workStoredSignal=new _Signal;object._interruptibleWorkPromises.push(workFn(workStoredSignal.promise)),workStoredSignal.complete()}function cancelInterruptibles(){(this._interruptibleWorkPromises||[]).forEach(function(workPromise){workPromise.cancel()})}var EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",_openCloseStateSettled:"_openCloseStateSettled"},OpenCloseMachine=function(){function OpenCloseMachine(args){this._control=args,this._initializedSignal=new _Signal,this._disposed=!1,this._setState(States.Init)}return OpenCloseMachine.prototype.exitInit=function(){this._initializedSignal.complete()},OpenCloseMachine.prototype.updateDom=function(){this._state.updateDom()},OpenCloseMachine.prototype.open=function(){this._state.open()},OpenCloseMachine.prototype.close=function(){this._state.close()},Object.defineProperty(OpenCloseMachine.prototype,"opened",{get:function(){return this._state.opened},set:function(value){value?this.open():this.close()},enumerable:!0,configurable:!0}),OpenCloseMachine.prototype.dispose=function(){this._setState(States.Disposed),this._disposed=!0,this._control=null},OpenCloseMachine.prototype._setState=function(NewState,arg0){this._disposed||(this._state&&this._state.exit(),this._state=new NewState,this._state.machine=this,this._state.enter(arg0))},OpenCloseMachine.prototype._fireEvent=function(eventName,options){options=options||{};var detail=options.detail||null,cancelable=!!options.cancelable,eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventName,!0,cancelable,detail),this._control.eventElement.dispatchEvent(eventObject)},OpenCloseMachine.prototype._fireBeforeOpen=function(){return this._fireEvent(EventNames.beforeOpen,{cancelable:!0})},OpenCloseMachine.prototype._fireBeforeClose=function(){return this._fireEvent(EventNames.beforeClose,{cancelable:!0})},OpenCloseMachine}();exports.OpenCloseMachine=OpenCloseMachine;var States;!function(States){function updateDomImpl(){this.machine._control.onUpdateDom()}var Init=function(){function Init(){this.name="Init",this.exit=cancelInterruptibles,this.updateDom=_}return Init.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this.machine._initializedSignal.promise}).then(function(){_this.machine._control.onUpdateDomWithIsOpened(_this._opened),_this.machine._setState(_this._opened?Opened:Closed)})})},Object.defineProperty(Init.prototype,"opened",{get:function(){return this._opened},enumerable:!0,configurable:!0}),Init.prototype.open=function(){this._opened=!0},Init.prototype.close=function(){this._opened=!1},Init}();States.Init=Init;var Closed=function(){function Closed(){this.name="Closed",this.exit=_,this.opened=!1,this.close=_,this.updateDom=updateDomImpl}return Closed.prototype.enter=function(args){args=args||{},args.openIsPending&&this.open(),this.machine._fireEvent(EventNames._openCloseStateSettled)},Closed.prototype.open=function(){this.machine._setState(BeforeOpen)},Closed}(),BeforeOpen=function(){function BeforeOpen(){this.name="BeforeOpen",this.exit=cancelInterruptibles,this.opened=!1,this.open=_,this.close=_,this.updateDom=updateDomImpl}return BeforeOpen.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this.machine._fireBeforeOpen()}).then(function(shouldOpen){shouldOpen?_this.machine._setState(Opening):_this.machine._setState(Closed)})})},BeforeOpen}(),Opening=function(){function Opening(){this.name="Opening",this.exit=cancelInterruptibles,this.updateDom=_}return Opening.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this._closeIsPending=!1,cancelablePromise(_this.machine._control.onOpen())}).then(function(){_this.machine._fireEvent(EventNames.afterOpen)}).then(function(){_this.machine._control.onUpdateDom(),_this.machine._setState(Opened,{closeIsPending:_this._closeIsPending})})})},Object.defineProperty(Opening.prototype,"opened",{get:function(){return!this._closeIsPending},enumerable:!0,configurable:!0}),Opening.prototype.open=function(){this._closeIsPending=!1},Opening.prototype.close=function(){this._closeIsPending=!0},Opening}(),Opened=function(){function Opened(){this.name="Opened",this.exit=_,this.opened=!0,this.open=_,this.updateDom=updateDomImpl}return Opened.prototype.enter=function(args){args=args||{},args.closeIsPending&&this.close(),this.machine._fireEvent(EventNames._openCloseStateSettled)},Opened.prototype.close=function(){this.machine._setState(BeforeClose)},Opened}(),BeforeClose=function(){function BeforeClose(){this.name="BeforeClose",this.exit=cancelInterruptibles,this.opened=!0,this.open=_,this.close=_,this.updateDom=updateDomImpl}return BeforeClose.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this.machine._fireBeforeClose()}).then(function(shouldClose){shouldClose?_this.machine._setState(Closing):_this.machine._setState(Opened)})})},BeforeClose}(),Closing=function(){function Closing(){this.name="Closing",this.exit=cancelInterruptibles,this.updateDom=_}return Closing.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this._openIsPending=!1,cancelablePromise(_this.machine._control.onClose())}).then(function(){_this.machine._fireEvent(EventNames.afterClose)}).then(function(){_this.machine._control.onUpdateDom(),_this.machine._setState(Closed,{openIsPending:_this._openIsPending})})})},Object.defineProperty(Closing.prototype,"opened",{get:function(){return this._openIsPending},enumerable:!0,configurable:!0}),Closing.prototype.open=function(){this._openIsPending=!0},Closing.prototype.close=function(){this._openIsPending=!1},Closing}(),Disposed=function(){function Disposed(){this.name="Disposed",this.enter=_,this.exit=_,this.opened=!1,this.open=_,this.close=_,this.updateDom=_}return Disposed}();States.Disposed=Disposed}(States||(States={}))}),define("require-style!less/styles-commandingsurface",[],function(){}),define("require-style!less/colors-commandingsurface",[],function(){}),define("WinJS/Controls/CommandingSurface/_CommandingSurface",["require","exports","../../Animations","../../Core/_Base","../../Core/_BaseUtils","../../BindingList","../../ControlProcessor","../CommandingSurface/_Constants","../AppBar/_Command","../CommandingSurface/_MenuCommand","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Controls/Flyout","../../Core/_Global","../../Utilities/_Hoverable","../../Utilities/_KeyboardBehavior","../../Core/_Log","../../Promise","../../Core/_Resources","../../Scheduler","../../Utilities/_OpenCloseMachine","../../_Signal","../../Core/_WriteProfilerMark"],function(require,exports,Animations,_Base,_BaseUtils,BindingList,ControlProcessor,_Constants,_Command,_CommandingSurfaceMenuCommand,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Flyout,_Global,_Hoverable,_KeyboardBehavior,_Log,Promise,_Resources,Scheduler,_OpenCloseMachine,_Signal,_WriteProfilerMark){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}function diffElements(lhs,rhs){return lhs.filter(function(commandElement){return rhs.indexOf(commandElement)<0})}function intersectElements(arr1,arr2){return arr1.filter(function(x){return-1!==arr2.indexOf(x)})}require(["require-style!less/styles-commandingsurface"]),require(["require-style!less/colors-commandingsurface"]);var strings={get overflowButtonAriaLabel(){return _Resources._getWinJSString("ui/commandingSurfaceOverflowButtonAriaLabel").value},get badData(){return"Invalid argument: The data property must an instance of a WinJS.Binding.List"},get mustContainCommands(){return"The commandingSurface can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},OverflowDirection={bottom:"bottom",top:"top"},overflowDirectionClassMap={};overflowDirectionClassMap[OverflowDirection.top]=_Constants.ClassNames.overflowTopClass,overflowDirectionClassMap[OverflowDirection.bottom]=_Constants.ClassNames.overflowBottomClass;var ClosedDisplayMode={none:"none",minimal:"minimal",compact:"compact",full:"full"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.none]=_Constants.ClassNames.noneClass,closedDisplayModeClassMap[ClosedDisplayMode.minimal]=_Constants.ClassNames.minimalClass,closedDisplayModeClassMap[ClosedDisplayMode.compact]=_Constants.ClassNames.compactClass,closedDisplayModeClassMap[ClosedDisplayMode.full]=_Constants.ClassNames.fullClass;var _CommandingSurface=function(){function _CommandingSurface(element,options){var _this=this;if(void 0===options&&(options={}),this._hoverable=_Hoverable.isHoverable,this._dataChangedEvents=["itemchanged","iteminserted","itemmoved","itemremoved","reload"],this._updateDomImpl=function(){var _renderedState={closedDisplayMode:void 0,isOpenedMode:void 0,overflowDirection:void 0,overflowAlignmentOffset:void 0},_renderDisplayMode=function(){var rendered=_renderedState,dom=_this._dom;if(rendered.isOpenedMode!==_this._isOpenedMode&&(_this._isOpenedMode?(removeClass(dom.root,_Constants.ClassNames.closedClass),addClass(dom.root,_Constants.ClassNames.openedClass),dom.overflowButton.setAttribute("aria-expanded","true"),dom.firstTabStop.tabIndex=0,dom.finalTabStop.tabIndex=0,dom.firstTabStop.setAttribute("x-ms-aria-flowfrom",dom.finalTabStop.id),dom.finalTabStop.setAttribute("aria-flowto",dom.firstTabStop.id)):(removeClass(dom.root,_Constants.ClassNames.openedClass),addClass(dom.root,_Constants.ClassNames.closedClass),dom.overflowButton.setAttribute("aria-expanded","false"),dom.firstTabStop.tabIndex=-1,dom.finalTabStop.tabIndex=-1,dom.firstTabStop.removeAttribute("x-ms-aria-flowfrom"),dom.finalTabStop.removeAttribute("aria-flowto")),rendered.isOpenedMode=_this._isOpenedMode),rendered.closedDisplayMode!==_this.closedDisplayMode&&(removeClass(dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(dom.root,closedDisplayModeClassMap[_this.closedDisplayMode]),rendered.closedDisplayMode=_this.closedDisplayMode),rendered.overflowDirection!==_this.overflowDirection&&(removeClass(dom.root,overflowDirectionClassMap[rendered.overflowDirection]),addClass(dom.root,overflowDirectionClassMap[_this.overflowDirection]),rendered.overflowDirection=_this.overflowDirection),_this._overflowAlignmentOffset!==rendered.overflowAlignmentOffset){var offsetProperty=_this._rtl?"left":"right",offsetTextValue=_this._overflowAlignmentOffset+"px";dom.overflowAreaContainer.style[offsetProperty]=offsetTextValue}},CommandLayoutPipeline={newDataStage:3,measuringStage:2,layoutStage:1,idle:0},_currentLayoutStage=CommandLayoutPipeline.idle,_updateCommands=function(){_this._writeProfilerMark("_updateDomImpl_updateCommands,info");for(var currentStage=_currentLayoutStage;currentStage!==CommandLayoutPipeline.idle;){var prevStage=currentStage,okToProceed=!1;switch(currentStage){case CommandLayoutPipeline.newDataStage:currentStage=CommandLayoutPipeline.measuringStage,okToProceed=_this._processNewData();break;case CommandLayoutPipeline.measuringStage:currentStage=CommandLayoutPipeline.layoutStage,okToProceed=_this._measure();break;case CommandLayoutPipeline.layoutStage:currentStage=CommandLayoutPipeline.idle,okToProceed=_this._layoutCommands()}if(!okToProceed){currentStage=prevStage;break}}_currentLayoutStage=currentStage,currentStage===CommandLayoutPipeline.idle?_this._layoutCompleteCallback&&_this._layoutCompleteCallback():_this._minimalLayout()};return{get renderedState(){return{get closedDisplayMode(){return _renderedState.closedDisplayMode},get isOpenedMode(){return _renderedState.isOpenedMode},get overflowDirection(){return _renderedState.overflowDirection},get overflowAlignmentOffset(){return _renderedState.overflowAlignmentOffset}}},update:function(){_renderDisplayMode(),_updateCommands()},dataDirty:function(){_currentLayoutStage=Math.max(CommandLayoutPipeline.newDataStage,_currentLayoutStage)},measurementsDirty:function(){_currentLayoutStage=Math.max(CommandLayoutPipeline.measuringStage,_currentLayoutStage)},layoutDirty:function(){_currentLayoutStage=Math.max(CommandLayoutPipeline.layoutStage,_currentLayoutStage)},get _currentLayoutStage(){return _currentLayoutStage}}}(),this._writeProfilerMark("constructor,StartTM"),element){if(element.winControl)throw new _ErrorFromName("WinJS.UI._CommandingSurface.DuplicateConstruction",strings.duplicateConstruction);options.data||(options=_BaseUtils._shallowCopy(options),options.data=options.data||this._getDataFromDOMElements(element))}this._initializeDom(element||_Global.document.createElement("div")),this._machine=options.openCloseMachine||new _OpenCloseMachine.OpenCloseMachine({eventElement:this._dom.root,onOpen:function(){return _this.synchronousOpen(),Promise.wrap()},onClose:function(){return _this.synchronousClose(),Promise.wrap()},onUpdateDom:function(){_this._updateDomImpl.update()},onUpdateDomWithIsOpened:function(isOpened){isOpened?_this.synchronousOpen():_this.synchronousClose()}}),this._disposed=!1,this._primaryCommands=[],this._secondaryCommands=[],this._refreshBound=this._refresh.bind(this),this._resizeHandlerBound=this._resizeHandler.bind(this),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._dom.root),this._refreshPending=!1,this._rtl=!1,this._initializedSignal=new _Signal,this._isOpenedMode=_Constants.defaultOpened,this._menuCommandProjections=[],this.overflowDirection=_Constants.defaultOverflowDirection,this.closedDisplayMode=_Constants.defaultClosedDisplayMode,this.opened=this._isOpenedMode,_Control.setOptions(this,options),_ElementUtilities._resizeNotifier.subscribe(this._dom.root,this._resizeHandlerBound),this._dom.root.addEventListener("keydown",this._keyDownHandler.bind(this)),_ElementUtilities._addEventListener(this._dom.firstTabStop,"focusin",function(){_this._focusLastFocusableElementOrThis(!1)}),_ElementUtilities._addEventListener(this._dom.finalTabStop,"focusin",function(){_this._focusFirstFocusableElementOrThis(!1)}),_ElementUtilities._inDom(this._dom.root).then(function(){_this._rtl="rtl"===_ElementUtilities._getComputedStyle(_this._dom.root).direction,options.openCloseMachine||_this._machine.exitInit(),_this._initializedSignal.complete(),_this._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(_CommandingSurface.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"data",{get:function(){return this._data},set:function(value){if(this._writeProfilerMark("set_data,info"),value!==this.data){if(!(value instanceof BindingList.List))throw new _ErrorFromName("WinJS.UI._CommandingSurface.BadData",strings.badData);this._data&&this._removeDataListeners(),this._data=value,this._addDataListeners(),this._dataUpdated()}},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"closedDisplayMode",{get:function(){return this._closedDisplayMode},set:function(value){this._writeProfilerMark("set_closedDisplayMode,info");var isChangingState=value!==this._closedDisplayMode;ClosedDisplayMode[value]&&isChangingState&&(this._updateDomImpl.layoutDirty(),this._closedDisplayMode=value,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"overflowDirection",{get:function(){return this._overflowDirection},set:function(value){var isChangingState=value!==this._overflowDirection;OverflowDirection[value]&&isChangingState&&(this._overflowDirection=value,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"opened",{get:function(){return this._machine.opened},set:function(value){this._machine.opened=value},enumerable:!0,configurable:!0}),_CommandingSurface.prototype.open=function(){this._machine.open()},_CommandingSurface.prototype.close=function(){this._machine.close()},_CommandingSurface.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._machine.dispose(),_ElementUtilities._resizeNotifier.unsubscribe(this._dom.root,this._resizeHandlerBound),this._contentFlyout&&(this._contentFlyout.dispose(),this._contentFlyout.element.parentNode.removeChild(this._contentFlyout.element)),_Dispose.disposeSubTree(this._dom.root))},_CommandingSurface.prototype.forceLayout=function(){this._updateDomImpl.measurementsDirty(),this._machine.updateDom()},_CommandingSurface.prototype.getBoundingRects=function(){return{commandingSurface:this._dom.root.getBoundingClientRect(),overflowArea:this._dom.overflowArea.getBoundingClientRect()}},_CommandingSurface.prototype.getCommandById=function(id){if(this._data)for(var i=0,len=this._data.length;len>i;i++){var command=this._data.getAt(i);if(command.id===id)return command}return null},_CommandingSurface.prototype.showOnlyCommands=function(commands){if(this._data){for(var i=0,len=this._data.length;len>i;i++)this._data.getAt(i).hidden=!0;for(var i=0,len=commands.length;len>i;i++){var command="string"==typeof commands[i]?this.getCommandById(commands[i]):commands[i];command&&(command.hidden=!1)}}},_CommandingSurface.prototype.takeFocus=function(useSetActive){this._focusFirstFocusableElementOrThis(useSetActive)},_CommandingSurface.prototype._focusFirstFocusableElementOrThis=function(useSetActive){_ElementUtilities._focusFirstFocusableElement(this._dom.content,useSetActive)||_ElementUtilities._tryFocusOnAnyElement(this.element,useSetActive)},_CommandingSurface.prototype._focusLastFocusableElementOrThis=function(useSetActive){_ElementUtilities._focusLastFocusableElement(this._dom.content,useSetActive)||_ElementUtilities._tryFocusOnAnyElement(this.element,useSetActive)},_CommandingSurface.prototype.deferredDomUpate=function(){this._machine.updateDom()},_CommandingSurface.prototype.createOpenAnimation=function(closedHeight){
_Log.log&&this._updateDomImpl.renderedState.isOpenedMode&&_Log.log("The CommandingSurface should only attempt to create an open animation when it's not already opened");var that=this;return{execute:function(){_ElementUtilities.addClass(that.element,_Constants.ClassNames.openingClass);var boundingRects=that.getBoundingRects();return that._dom.overflowAreaContainer.style.width=boundingRects.overflowArea.width+"px",that._dom.overflowAreaContainer.style.height=boundingRects.overflowArea.height+"px",Animations._commandingSurfaceOpenAnimation({actionAreaClipper:that._dom.actionAreaContainer,actionArea:that._dom.actionArea,overflowAreaClipper:that._dom.overflowAreaContainer,overflowArea:that._dom.overflowArea,oldHeight:closedHeight,newHeight:boundingRects.commandingSurface.height,overflowAreaHeight:boundingRects.overflowArea.height,menuPositionedAbove:that.overflowDirection===OverflowDirection.top}).then(function(){_ElementUtilities.removeClass(that.element,_Constants.ClassNames.openingClass),that._clearAnimation()})}}},_CommandingSurface.prototype.createCloseAnimation=function(closedHeight){_Log.log&&!this._updateDomImpl.renderedState.isOpenedMode&&_Log.log("The CommandingSurface should only attempt to create an closed animation when it's not already closed");var openedHeight=this.getBoundingRects().commandingSurface.height,overflowAreaOpenedHeight=this._dom.overflowArea.offsetHeight,that=(this._dom.overflowArea.offsetTop,this);return{execute:function(){return _ElementUtilities.addClass(that.element,_Constants.ClassNames.closingClass),Animations._commandingSurfaceCloseAnimation({actionAreaClipper:that._dom.actionAreaContainer,actionArea:that._dom.actionArea,overflowAreaClipper:that._dom.overflowAreaContainer,overflowArea:that._dom.overflowArea,oldHeight:openedHeight,newHeight:closedHeight,overflowAreaHeight:overflowAreaOpenedHeight,menuPositionedAbove:that.overflowDirection===OverflowDirection.top}).then(function(){_ElementUtilities.removeClass(that.element,_Constants.ClassNames.closingClass),that._clearAnimation()})}}},Object.defineProperty(_CommandingSurface.prototype,"initialized",{get:function(){return this._initializedSignal.promise},enumerable:!0,configurable:!0}),_CommandingSurface.prototype._writeProfilerMark=function(text){_WriteProfilerMark("WinJS.UI._CommandingSurface:"+this._id+":"+text)},_CommandingSurface.prototype._initializeDom=function(root){var _this=this;this._writeProfilerMark("_intializeDom,info"),root.winControl=this,this._id=root.id||_ElementUtilities._uniqueID(root),root.hasAttribute("tabIndex")||(root.tabIndex=-1),_ElementUtilities.addClass(root,_Constants.ClassNames.controlCssClass),_ElementUtilities.addClass(root,_Constants.ClassNames.disposableCssClass);var content=_Global.document.createElement("div");_ElementUtilities.addClass(content,_Constants.ClassNames.contentClass),root.appendChild(content);var actionArea=_Global.document.createElement("div");_ElementUtilities.addClass(actionArea,_Constants.ClassNames.actionAreaCssClass);var actionAreaInsetOutline=document.createElement("div");_ElementUtilities.addClass(actionAreaInsetOutline,_Constants.ClassNames.insetOutlineClass);var actionAreaContainer=_Global.document.createElement("div");_ElementUtilities.addClass(actionAreaContainer,_Constants.ClassNames.actionAreaContainerCssClass),actionAreaContainer.appendChild(actionArea),actionAreaContainer.appendChild(actionAreaInsetOutline),content.appendChild(actionAreaContainer);var actionAreaSpacer=_Global.document.createElement("div");_ElementUtilities.addClass(actionAreaSpacer,_Constants.ClassNames.spacerCssClass),actionAreaSpacer.tabIndex=-1,actionArea.appendChild(actionAreaSpacer);var overflowButton=_Global.document.createElement("button");overflowButton.tabIndex=0,overflowButton.innerHTML="<span class='"+_Constants.ClassNames.ellipsisCssClass+"'></span>",overflowButton.setAttribute("aria-label",strings.overflowButtonAriaLabel),_ElementUtilities.addClass(overflowButton,_Constants.ClassNames.overflowButtonCssClass),actionArea.appendChild(overflowButton),overflowButton.addEventListener("click",function(){_this.opened=!_this.opened});var overflowArea=_Global.document.createElement("div");_ElementUtilities.addClass(overflowArea,_Constants.ClassNames.overflowAreaCssClass),_ElementUtilities.addClass(overflowArea,_Constants.ClassNames.menuCssClass);var overflowInsetOutline=_Global.document.createElement("DIV");_ElementUtilities.addClass(overflowInsetOutline,_Constants.ClassNames.insetOutlineClass);var overflowAreaContainer=_Global.document.createElement("div");_ElementUtilities.addClass(overflowAreaContainer,_Constants.ClassNames.overflowAreaContainerCssClass),overflowAreaContainer.appendChild(overflowArea),overflowAreaContainer.appendChild(overflowInsetOutline),content.appendChild(overflowAreaContainer);var overflowAreaSpacer=_Global.document.createElement("div");_ElementUtilities.addClass(overflowAreaSpacer,_Constants.ClassNames.spacerCssClass),overflowAreaSpacer.tabIndex=-1,overflowArea.appendChild(overflowAreaSpacer);var firstTabStop=_Global.document.createElement("div");_ElementUtilities.addClass(firstTabStop,_Constants.ClassNames.tabStopClass),_ElementUtilities._ensureId(firstTabStop),root.insertBefore(firstTabStop,root.children[0]);var finalTabStop=_Global.document.createElement("div");_ElementUtilities.addClass(finalTabStop,_Constants.ClassNames.tabStopClass),_ElementUtilities._ensureId(finalTabStop),root.appendChild(finalTabStop),this._dom={root:root,content:content,actionArea:actionArea,actionAreaContainer:actionAreaContainer,actionAreaSpacer:actionAreaSpacer,overflowButton:overflowButton,overflowArea:overflowArea,overflowAreaContainer:overflowAreaContainer,overflowAreaSpacer:overflowAreaSpacer,firstTabStop:firstTabStop,finalTabStop:finalTabStop}},_CommandingSurface.prototype._getFocusableElementsInfo=function(){var _this=this,focusableCommandsInfo={elements:[],focusedIndex:-1},elementsInReach=Array.prototype.slice.call(this._dom.actionArea.children);return this._updateDomImpl.renderedState.isOpenedMode&&(elementsInReach=elementsInReach.concat(Array.prototype.slice.call(this._dom.overflowArea.children))),elementsInReach.forEach(function(element){_this._isElementFocusable(element)&&(focusableCommandsInfo.elements.push(element),element.contains(_Global.document.activeElement)&&(focusableCommandsInfo.focusedIndex=focusableCommandsInfo.elements.length-1))}),focusableCommandsInfo},_CommandingSurface.prototype._dataUpdated=function(){var _this=this;this._primaryCommands=[],this._secondaryCommands=[],this.data.length>0&&this.data.forEach(function(command){"secondary"===command.section?_this._secondaryCommands.push(command):_this._primaryCommands.push(command)}),this._updateDomImpl.dataDirty(),this._machine.updateDom()},_CommandingSurface.prototype._refresh=function(){var _this=this;this._refreshPending||(this._refreshPending=!0,this._batchDataUpdates(function(){_this._refreshPending&&!_this._disposed&&(_this._refreshPending=!1,_this._dataUpdated())}))},_CommandingSurface.prototype._batchDataUpdates=function(updateFn){Scheduler.schedule(function(){updateFn()},Scheduler.Priority.high,null,"WinJS.UI._CommandingSurface._refresh")},_CommandingSurface.prototype._addDataListeners=function(){var _this=this;this._dataChangedEvents.forEach(function(eventName){_this._data.addEventListener(eventName,_this._refreshBound,!1)})},_CommandingSurface.prototype._removeDataListeners=function(){var _this=this;this._dataChangedEvents.forEach(function(eventName){_this._data.removeEventListener(eventName,_this._refreshBound,!1)})},_CommandingSurface.prototype._isElementFocusable=function(element){var focusable=!1;if(element){var command=element.winControl;focusable=command?!this._hasAnyHiddenClasses(command)&&command.type!==_Constants.typeSeparator&&!command.hidden&&!command.disabled&&(!command.firstElementFocus||command.firstElementFocus.tabIndex>=0||command.lastElementFocus.tabIndex>=0):"none"!==element.style.display&&"hidden"!==_ElementUtilities._getComputedStyle(element).visibility&&element.tabIndex>=0}return focusable},_CommandingSurface.prototype._clearHiddenPolicyClasses=function(command){_ElementUtilities.removeClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass),_ElementUtilities.removeClass(command.element,_Constants.ClassNames.commandSecondaryOverflownPolicyClass),_ElementUtilities.removeClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass)},_CommandingSurface.prototype._hasHiddenPolicyClasses=function(command){return _ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass)||_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandSecondaryOverflownPolicyClass)||_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass)},_CommandingSurface.prototype._hasAnyHiddenClasses=function(command){return _ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandHiddenClass)||this._hasHiddenPolicyClasses(command)},_CommandingSurface.prototype._isCommandInActionArea=function(element){return element&&element.winControl&&element.parentElement===this._dom.actionArea},_CommandingSurface.prototype._getLastElementFocus=function(element){return this._isCommandInActionArea(element)?element.winControl.lastElementFocus:element},_CommandingSurface.prototype._getFirstElementFocus=function(element){return this._isCommandInActionArea(element)?element.winControl.firstElementFocus:element},_CommandingSurface.prototype._keyDownHandler=function(ev){if(!ev.altKey){if(_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *"))return;var targetCommand,Key=_ElementUtilities.Key,focusableElementsInfo=this._getFocusableElementsInfo();if(focusableElementsInfo.elements.length)switch(ev.keyCode){case this._rtl?Key.rightArrow:Key.leftArrow:case Key.upArrow:var index=Math.max(0,focusableElementsInfo.focusedIndex-1);targetCommand=this._getLastElementFocus(focusableElementsInfo.elements[index%focusableElementsInfo.elements.length]);break;case this._rtl?Key.leftArrow:Key.rightArrow:case Key.downArrow:var index=Math.min(focusableElementsInfo.focusedIndex+1,focusableElementsInfo.elements.length-1);targetCommand=this._getFirstElementFocus(focusableElementsInfo.elements[index]);break;case Key.home:var index=0;targetCommand=this._getFirstElementFocus(focusableElementsInfo.elements[index]);break;case Key.end:var index=focusableElementsInfo.elements.length-1;targetCommand=this._getLastElementFocus(focusableElementsInfo.elements[index])}targetCommand&&targetCommand!==_Global.document.activeElement&&(targetCommand.focus(),ev.preventDefault())}},_CommandingSurface.prototype._getDataFromDOMElements=function(root){this._writeProfilerMark("_getDataFromDOMElements,info"),ControlProcessor.processAll(root,!0);for(var child,commands=[],childrenLength=root.children.length,i=0;childrenLength>i;i++){if(child=root.children[i],!(child.winControl&&child.winControl instanceof _Command.AppBarCommand))throw new _ErrorFromName("WinJS.UI._CommandingSurface.MustContainCommands",strings.mustContainCommands);commands.push(child.winControl)}return new BindingList.List(commands)},_CommandingSurface.prototype._canMeasure=function(){return(this._updateDomImpl.renderedState.isOpenedMode||this._updateDomImpl.renderedState.closedDisplayMode===ClosedDisplayMode.compact||this._updateDomImpl.renderedState.closedDisplayMode===ClosedDisplayMode.full)&&_Global.document.body.contains(this._dom.root)&&this._dom.actionArea.offsetWidth>0},_CommandingSurface.prototype._resizeHandler=function(){if(this._canMeasure()){var currentActionAreaWidth=_ElementUtilities._getPreciseContentWidth(this._dom.actionArea);this._cachedMeasurements&&this._cachedMeasurements.actionAreaContentBoxWidth!==currentActionAreaWidth&&(this._cachedMeasurements.actionAreaContentBoxWidth=currentActionAreaWidth,this._updateDomImpl.layoutDirty(),this._machine.updateDom())}else this._updateDomImpl.measurementsDirty()},_CommandingSurface.prototype.synchronousOpen=function(){this._overflowAlignmentOffset=0,this._isOpenedMode=!0,this._updateDomImpl.update(),this._overflowAlignmentOffset=this._computeAdjustedOverflowAreaOffset(),this._updateDomImpl.update()},_CommandingSurface.prototype._computeAdjustedOverflowAreaOffset=function(){_Log.log&&(!this._updateDomImpl.renderedState.isOpenedMode&&_Log.log("The CommandingSurface should only attempt to compute adjusted overflowArea offset  when it has been rendered opened"),0!==this._updateDomImpl.renderedState.overflowAlignmentOffset&&_Log.log("The CommandingSurface should only attempt to compute adjusted overflowArea offset  when it has been rendered with an overflowAlignementOffset of 0"));var boundingClientRects=(this._dom.overflowArea,this.getBoundingRects()),adjustedOffset=0;if(this._rtl){var viewportRight=window.innerWidth,rightOffsetFromViewport=boundingClientRects.overflowArea.right;adjustedOffset=Math.min(viewportRight-rightOffsetFromViewport,0)}else{var leftOffsetFromViewport=boundingClientRects.overflowArea.left;adjustedOffset=Math.min(0,leftOffsetFromViewport)}return adjustedOffset},_CommandingSurface.prototype.synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl.update()},_CommandingSurface.prototype.updateDom=function(){this._updateDomImpl.update()},_CommandingSurface.prototype._getDataChangeInfo=function(){var _this=this,added=[],deleted=[],unchanged=[],prevVisible=[],prevElements=[],nextVisible=[],nextElements=[],nextOverflown=[],nextHiding=[],nextShowing=[];return Array.prototype.forEach.call(this._dom.actionArea.querySelectorAll(_Constants.commandSelector),function(commandElement){_this._hasAnyHiddenClasses(commandElement.winControl)||prevVisible.push(commandElement),prevElements.push(commandElement)}),this.data.forEach(function(command){var hidden=command.hidden,hiding=hidden&&!_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandHiddenClass),showing=!hidden&&_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandHiddenClass),overflown=_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass);_this._hasAnyHiddenClasses(command.element.winControl)||nextVisible.push(command.element),overflown?nextOverflown.push(command.element):hiding?nextHiding.push(command.element):showing&&nextShowing.push(command.element),nextElements.push(command.element)}),deleted=diffElements(prevElements,nextElements),unchanged=intersectElements(prevVisible,nextVisible),added=diffElements(nextElements,prevElements),{nextElements:nextElements,prevElements:prevElements,added:added,deleted:deleted,unchanged:unchanged,hiding:nextHiding,showing:nextShowing,overflown:nextOverflown}},_CommandingSurface.prototype._processNewData=function(){var _this=this;this._writeProfilerMark("_processNewData,info");var changeInfo=this._getDataChangeInfo(),updateCommandAnimation=Animations._createUpdateListAnimation(changeInfo.added.concat(changeInfo.showing).concat(changeInfo.overflown),changeInfo.deleted.concat(changeInfo.hiding),changeInfo.unchanged);return changeInfo.deleted.forEach(function(deletedElement){var command=deletedElement.winControl;command&&command._propertyMutations&&command._propertyMutations.unbind(_this._refreshBound)}),changeInfo.added.forEach(function(addedElement){var command=addedElement.winControl;command&&command._propertyMutations&&command._propertyMutations.bind(_this._refreshBound)}),changeInfo.prevElements.forEach(function(element){element.parentElement&&element.parentElement.removeChild(element)}),changeInfo.nextElements.forEach(function(element){_this._dom.actionArea.appendChild(element)}),changeInfo.hiding.forEach(function(element){_ElementUtilities.addClass(element,_Constants.ClassNames.commandHiddenClass)}),changeInfo.showing.forEach(function(element){_ElementUtilities.removeClass(element,_Constants.ClassNames.commandHiddenClass)}),this._dom.actionArea.appendChild(this._dom.overflowButton),updateCommandAnimation.execute(),!0},_CommandingSurface.prototype._measure=function(){var _this=this;if(this._writeProfilerMark("_measure,info"),this._canMeasure()){var originalDisplayStyle=this._dom.overflowButton.style.display;this._dom.overflowButton.style.display="";var overflowButtonWidth=_ElementUtilities._getPreciseTotalWidth(this._dom.overflowButton);this._dom.overflowButton.style.display=originalDisplayStyle;var actionAreaContentBoxWidth=_ElementUtilities._getPreciseContentWidth(this._dom.actionArea),separatorWidth=0,standardCommandWidth=0,contentCommandWidths={};return this._primaryCommands.forEach(function(command){var originalDisplayStyle=command.element.style.display;command.element.style.display="inline-block",command.type===_Constants.typeContent?contentCommandWidths[_this._commandUniqueId(command)]=_ElementUtilities._getPreciseTotalWidth(command.element):command.type===_Constants.typeSeparator?separatorWidth||(separatorWidth=_ElementUtilities._getPreciseTotalWidth(command.element)):standardCommandWidth||(standardCommandWidth=_ElementUtilities._getPreciseTotalWidth(command.element)),command.element.style.display=originalDisplayStyle}),this._cachedMeasurements={contentCommandWidths:contentCommandWidths,separatorWidth:separatorWidth,standardCommandWidth:standardCommandWidth,overflowButtonWidth:overflowButtonWidth,actionAreaContentBoxWidth:actionAreaContentBoxWidth},!0}return!1},_CommandingSurface.prototype._layoutCommands=function(){var _this=this;this._writeProfilerMark("_layoutCommands,StartTM");var visibleSecondaryCommands=[],visiblePrimaryCommands=[],visiblePrimaryCommandsForActionArea=[],visiblePrimaryCommandsForOverflowArea=[];this.data.forEach(function(command){_this._clearHiddenPolicyClasses(command),command.hidden||(command.section===_Constants.secondaryCommandSection?visibleSecondaryCommands.push(command):visiblePrimaryCommands.push(command))});var hasVisibleSecondaryCommand=visibleSecondaryCommands.length>0,primaryCommandsLocation=this._getVisiblePrimaryCommandsLocation(visiblePrimaryCommands,hasVisibleSecondaryCommand);visiblePrimaryCommandsForActionArea=primaryCommandsLocation.commandsForActionArea,visiblePrimaryCommandsForOverflowArea=primaryCommandsLocation.commandsForOverflowArea,visiblePrimaryCommandsForOverflowArea.forEach(function(command){return _ElementUtilities.addClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass)}),visibleSecondaryCommands.forEach(function(command){return _ElementUtilities.addClass(command.element,_Constants.ClassNames.commandSecondaryOverflownPolicyClass)}),this._hideSeparatorsIfNeeded(visiblePrimaryCommandsForActionArea),_ElementUtilities.empty(this._dom.overflowArea),this._menuCommandProjections.map(function(menuCommand){menuCommand.dispose()});var isCustomContent=function(command){return command.type===_Constants.typeContent},hasCustomContent=visiblePrimaryCommandsForOverflowArea.some(isCustomContent)||visibleSecondaryCommands.some(isCustomContent);hasCustomContent&&!this._contentFlyout&&(this._contentFlyoutInterior=_Global.document.createElement("div"),_ElementUtilities.addClass(this._contentFlyoutInterior,_Constants.ClassNames.contentFlyoutCssClass),this._contentFlyout=new _Flyout.Flyout,this._contentFlyout.element.appendChild(this._contentFlyoutInterior),_Global.document.body.appendChild(this._contentFlyout.element),this._contentFlyout.onbeforeshow=function(){_ElementUtilities.empty(_this._contentFlyoutInterior),_ElementUtilities._reparentChildren(_this._chosenCommand.element,_this._contentFlyoutInterior)},this._contentFlyout.onafterhide=function(){_ElementUtilities._reparentChildren(_this._contentFlyoutInterior,_this._chosenCommand.element)});var hasToggleCommands=!1,menuCommandProjections=[];if(visiblePrimaryCommandsForOverflowArea.forEach(function(command){command.type===_Constants.typeToggle&&(hasToggleCommands=!0),menuCommandProjections.push(_this._projectAsMenuCommand(command))}),visiblePrimaryCommandsForOverflowArea.length>0&&visibleSecondaryCommands.length>0){var separator=new _CommandingSurfaceMenuCommand._MenuCommand(null,{type:_Constants.typeSeparator});menuCommandProjections.push(separator)}visibleSecondaryCommands.forEach(function(command){command.type===_Constants.typeToggle&&(hasToggleCommands=!0),menuCommandProjections.push(_this._projectAsMenuCommand(command))}),this._hideSeparatorsIfNeeded(menuCommandProjections),menuCommandProjections.forEach(function(command){_this._dom.overflowArea.appendChild(command.element)}),this._menuCommandProjections=menuCommandProjections,_ElementUtilities[hasToggleCommands?"addClass":"removeClass"](this._dom.overflowArea,_Constants.ClassNames.menuContainsToggleCommandClass),menuCommandProjections.length>0&&this._dom.overflowArea.appendChild(this._dom.overflowAreaSpacer);var needsOverflowButton=this._needsOverflowButton(visiblePrimaryCommandsForActionArea.length>0,menuCommandProjections.length>0);return this._dom.overflowButton.style.display=needsOverflowButton?"":"none",this._writeProfilerMark("_layoutCommands,StopTM"),!0},_CommandingSurface.prototype._getVisiblePrimaryCommandsInfo=function(visibleCommands){for(var width=0,visibleCommandsInfo=[],priority=0,currentAssignedPriority=0,i=visibleCommands.length-1;i>=0;i--){var command=visibleCommands[i];priority=void 0===command.priority?currentAssignedPriority--:command.priority,width=this._getCommandWidth(command),visibleCommandsInfo.unshift({command:command,width:width,priority:priority})}return visibleCommandsInfo},_CommandingSurface.prototype._getVisiblePrimaryCommandsLocation=function(visiblePrimaryCommands,isThereAVisibleSecondaryCommand){for(var commandsForActionArea=[],commandsForOverflowArea=[],visibleCommandsInfo=this._getVisiblePrimaryCommandsInfo(visiblePrimaryCommands),sortedCommandsInfo=visibleCommandsInfo.slice(0).sort(function(commandInfo1,commandInfo2){return commandInfo1.priority-commandInfo2.priority}),maxPriority=Number.MAX_VALUE,currentAvailableWidth=this._cachedMeasurements.actionAreaContentBoxWidth,overflowButtonAlreadyNeeded=this._needsOverflowButton(visiblePrimaryCommands.length>0,isThereAVisibleSecondaryCommand),i=0,len=sortedCommandsInfo.length;len>i;i++){currentAvailableWidth-=sortedCommandsInfo[i].width;var additionalSpaceNeeded=overflowButtonAlreadyNeeded||i!==len-1?this._cachedMeasurements.overflowButtonWidth:0;if(additionalSpaceNeeded>currentAvailableWidth){maxPriority=sortedCommandsInfo[i].priority-1;break}}return visibleCommandsInfo.forEach(function(commandInfo){commandInfo.priority<=maxPriority?commandsForActionArea.push(commandInfo.command):commandsForOverflowArea.push(commandInfo.command)}),{commandsForActionArea:commandsForActionArea,commandsForOverflowArea:commandsForOverflowArea}},_CommandingSurface.prototype._needsOverflowButton=function(hasVisibleCommandsInActionArea,hasVisibleCommandsInOverflowArea){return hasVisibleCommandsInOverflowArea?!0:this._hasExpandableActionArea()&&hasVisibleCommandsInActionArea?!0:!1},_CommandingSurface.prototype._minimalLayout=function(){if(this.closedDisplayMode===ClosedDisplayMode.minimal){var isCommandVisible=function(command){return!command.hidden},hasVisibleCommand=this.data.some(isCommandVisible);this._dom.overflowButton.style.display=hasVisibleCommand?"":"none"}},_CommandingSurface.prototype._commandUniqueId=function(command){return _ElementUtilities._uniqueID(command.element)},_CommandingSurface.prototype._getCommandWidth=function(command){return command.type===_Constants.typeContent?this._cachedMeasurements.contentCommandWidths[this._commandUniqueId(command)]:command.type===_Constants.typeSeparator?this._cachedMeasurements.separatorWidth:this._cachedMeasurements.standardCommandWidth},_CommandingSurface.prototype._projectAsMenuCommand=function(originalCommand){var _this=this,menuCommand=new _CommandingSurfaceMenuCommand._MenuCommand(null,{label:originalCommand.label,type:(originalCommand.type===_Constants.typeContent?_Constants.typeFlyout:originalCommand.type)||_Constants.typeButton,disabled:originalCommand.disabled,flyout:originalCommand.flyout,beforeInvoke:function(){_this._chosenCommand=menuCommand._originalICommand,_this._chosenCommand.type===_Constants.typeToggle&&(_this._chosenCommand.selected=!_this._chosenCommand.selected)}});return originalCommand.selected&&(menuCommand.selected=!0),originalCommand.extraClass&&(menuCommand.extraClass=originalCommand.extraClass),originalCommand.type===_Constants.typeContent?(menuCommand.label||(menuCommand.label=_Constants.contentMenuCommandDefaultLabel),menuCommand.flyout=this._contentFlyout):menuCommand.onclick=originalCommand.onclick,menuCommand._originalICommand=originalCommand,menuCommand},_CommandingSurface.prototype._hideSeparatorsIfNeeded=function(commands){var command,prevType=_Constants.typeSeparator,commandsLength=commands.length;commands.forEach(function(command){command.type===_Constants.typeSeparator&&prevType===_Constants.typeSeparator&&_ElementUtilities.addClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass),prevType=command.type});for(var i=commandsLength-1;i>=0&&(command=commands[i],command.type===_Constants.typeSeparator);i--)_ElementUtilities.addClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass)},_CommandingSurface.prototype._hasExpandableActionArea=function(){switch(this.closedDisplayMode){case ClosedDisplayMode.none:case ClosedDisplayMode.minimal:case ClosedDisplayMode.compact:return!0;case ClosedDisplayMode.full:default:return!1}},_CommandingSurface.prototype._clearAnimation=function(){var transformScriptName=_BaseUtils._browserStyleEquivalents.transform.scriptName;this._dom.actionAreaContainer.style[transformScriptName]="",this._dom.actionArea.style[transformScriptName]="",this._dom.overflowAreaContainer.style[transformScriptName]="",this._dom.overflowArea.style[transformScriptName]=""},_CommandingSurface.ClosedDisplayMode=ClosedDisplayMode,_CommandingSurface.OverflowDirection=OverflowDirection,_CommandingSurface.supportedForProcessing=!0,_CommandingSurface}();exports._CommandingSurface=_CommandingSurface,_Base.Class.mix(_CommandingSurface,_Events.createEventProperties(_Constants.EventNames.beforeOpen,_Constants.EventNames.afterOpen,_Constants.EventNames.beforeClose,_Constants.EventNames.afterClose)),_Base.Class.mix(_CommandingSurface,_Control.DOMEventMixin)}),define("WinJS/Controls/CommandingSurface",["require","exports"],function(require,exports){function getModule(){return module||require(["./CommandingSurface/_CommandingSurface"],function(m){module=m}),module._CommandingSurface}var module=null,publicMembers=Object.create({},{_CommandingSurface:{get:function(){return getModule()}}});return publicMembers}),define("require-style!less/styles-toolbar",[],function(){}),define("WinJS/Controls/ToolBar/_ToolBar",["require","exports","../../Core/_Base","../ToolBar/_Constants","../CommandingSurface","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../_LightDismissService","../../Core/_Resources","../../Utilities/_OpenCloseMachine","../../Core/_WriteProfilerMark"],function(require,exports,_Base,_Constants,_CommandingSurface,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Global,_LightDismissService,_Resources,_OpenCloseMachine,_WriteProfilerMark){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}require(["require-style!less/styles-toolbar"]);var strings={get ariaLabel(){return _Resources._getWinJSString("ui/toolbarAriaLabel").value},get overflowButtonAriaLabel(){return _Resources._getWinJSString("ui/toolbarOverflowButtonAriaLabel").value},get mustContainCommands(){return"The toolbar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClosedDisplayMode={compact:"compact",full:"full"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.compact]=_Constants.ClassNames.compactClass,closedDisplayModeClassMap[ClosedDisplayMode.full]=_Constants.ClassNames.fullClass;var ToolBar=function(){function ToolBar(element,options){var _this=this;if(void 0===options&&(options={}),this._updateDomImpl_renderedState={isOpenedMode:void 0,closedDisplayMode:void 0,prevInlineWidth:void 0},this._writeProfilerMark("constructor,StartTM"),element&&element.winControl)throw new _ErrorFromName("WinJS.UI.ToolBar.DuplicateConstruction",strings.duplicateConstruction);this._initializeDom(element||_Global.document.createElement("div"));var stateMachine=new _OpenCloseMachine.OpenCloseMachine({eventElement:this.element,onOpen:function(){var openAnimation=_this._commandingSurface.createOpenAnimation(_this._getClosedHeight());return _this._synchronousOpen(),openAnimation.execute()},onClose:function(){var closeAnimation=_this._commandingSurface.createCloseAnimation(_this._getClosedHeight());return closeAnimation.execute().then(function(){_this._synchronousClose()})},onUpdateDom:function(){_this._updateDomImpl()},onUpdateDomWithIsOpened:function(isOpened){_this._isOpenedMode=isOpened,_this._updateDomImpl()}});this._handleShowingKeyboardBound=this._handleShowingKeyboard.bind(this),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),this._disposed=!1,this._cachedClosedHeight=null,this._commandingSurface=new _CommandingSurface._CommandingSurface(this._dom.commandingSurfaceEl,{openCloseMachine:stateMachine}),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-actionarea"),_Constants.ClassNames.actionAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowarea"),_Constants.ClassNames.overflowAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowbutton"),_Constants.ClassNames.overflowButtonCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-ellipsis"),_Constants.ClassNames.ellipsisCssClass),this._isOpenedMode=_Constants.defaultOpened,this._dismissable=new _LightDismissService.LightDismissableElement({element:this._dom.root,tabIndex:this._dom.root.hasAttribute("tabIndex")?this._dom.root.tabIndex:-1,onLightDismiss:function(){_this.close()},onTakeFocus:function(useSetActive){_this._dismissable.restoreFocus()||_this._commandingSurface.takeFocus(useSetActive)}}),this.closedDisplayMode=_Constants.defaultClosedDisplayMode,this.opened=this._isOpenedMode,_Control.setOptions(this,options),_ElementUtilities._inDom(this.element).then(function(){return _this._commandingSurface.initialized}).then(function(){stateMachine.exitInit(),_this._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(ToolBar.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(ToolBar.prototype,"data",{get:function(){return this._commandingSurface.data},set:function(value){this._commandingSurface.data=value},enumerable:!0,configurable:!0}),Object.defineProperty(ToolBar.prototype,"closedDisplayMode",{get:function(){return this._commandingSurface.closedDisplayMode},set:function(value){ClosedDisplayMode[value]&&(this._commandingSurface.closedDisplayMode=value,this._cachedClosedHeight=null)},enumerable:!0,configurable:!0}),Object.defineProperty(ToolBar.prototype,"opened",{get:function(){return this._commandingSurface.opened},set:function(value){this._commandingSurface.opened=value},enumerable:!0,configurable:!0}),ToolBar.prototype.open=function(){this._commandingSurface.open()},ToolBar.prototype.close=function(){this._commandingSurface.close()},ToolBar.prototype.dispose=function(){this._disposed||(this._disposed=!0,_LightDismissService.hidden(this._dismissable),this._commandingSurface.dispose(),this._synchronousClose(),
_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),_Dispose.disposeSubTree(this.element))},ToolBar.prototype.forceLayout=function(){this._commandingSurface.forceLayout()},ToolBar.prototype.getCommandById=function(id){return this._commandingSurface.getCommandById(id)},ToolBar.prototype.showOnlyCommands=function(commands){return this._commandingSurface.showOnlyCommands(commands)},ToolBar.prototype._writeProfilerMark=function(text){_WriteProfilerMark("WinJS.UI.ToolBar:"+this._id+":"+text)},ToolBar.prototype._initializeDom=function(root){this._writeProfilerMark("_intializeDom,info"),root.winControl=this,this._id=root.id||_ElementUtilities._uniqueID(root),_ElementUtilities.addClass(root,_Constants.ClassNames.controlCssClass),_ElementUtilities.addClass(root,_Constants.ClassNames.disposableCssClass);var role=root.getAttribute("role");role||root.setAttribute("role","menubar");var label=root.getAttribute("aria-label");label||root.setAttribute("aria-label",strings.ariaLabel);var commandingSurfaceEl=document.createElement("DIV");_ElementUtilities._reparentChildren(root,commandingSurfaceEl),root.appendChild(commandingSurfaceEl);var placeHolder=_Global.document.createElement("DIV");_ElementUtilities.addClass(placeHolder,_Constants.ClassNames.placeHolderCssClass),_Dispose.markDisposable(placeHolder,this.dispose.bind(this)),this._dom={root:root,commandingSurfaceEl:commandingSurfaceEl,placeHolder:placeHolder}},ToolBar.prototype._handleShowingKeyboard=function(event){this.close()},ToolBar.prototype._synchronousOpen=function(){this._isOpenedMode=!0,this._updateDomImpl()},ToolBar.prototype._synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl()},ToolBar.prototype._updateDomImpl=function(){var rendered=this._updateDomImpl_renderedState;rendered.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?this._updateDomImpl_renderOpened():this._updateDomImpl_renderClosed(),rendered.isOpenedMode=this._isOpenedMode),rendered.closedDisplayMode!==this.closedDisplayMode&&(removeClass(this._dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(this._dom.root,closedDisplayModeClassMap[this.closedDisplayMode]),rendered.closedDisplayMode=this.closedDisplayMode),this._commandingSurface.updateDom()},ToolBar.prototype._getClosedHeight=function(){if(null===this._cachedClosedHeight){var wasOpen=this._isOpenedMode;this._isOpenedMode&&this._synchronousClose(),this._cachedClosedHeight=this._commandingSurface.getBoundingRects().commandingSurface.height,wasOpen&&this._synchronousOpen()}return this._cachedClosedHeight},ToolBar.prototype._updateDomImpl_renderOpened=function(){var _this=this;this._updateDomImpl_renderedState.prevInlineWidth=this._dom.root.style.width;var closedBorderBox=this._dom.root.getBoundingClientRect(),closedContentWidth=_ElementUtilities._getPreciseContentWidth(this._dom.root),closedContentHeight=_ElementUtilities._getPreciseContentHeight(this._dom.root),closedStyle=_ElementUtilities._getComputedStyle(this._dom.root),closedPaddingTop=_ElementUtilities._convertToPrecisePixels(closedStyle.paddingTop),closedBorderTop=_ElementUtilities._convertToPrecisePixels(closedStyle.borderTopWidth),closedMargins=_ElementUtilities._getPreciseMargins(this._dom.root),closedContentBoxTop=closedBorderBox.top+closedBorderTop+closedPaddingTop,closedContentBoxBottom=closedContentBoxTop+closedContentHeight,placeHolder=this._dom.placeHolder,placeHolderStyle=placeHolder.style;placeHolderStyle.width=closedBorderBox.width+"px",placeHolderStyle.height=closedBorderBox.height+"px",placeHolderStyle.marginTop=closedMargins.top+"px",placeHolderStyle.marginRight=closedMargins.right+"px",placeHolderStyle.marginBottom=closedMargins.bottom+"px",placeHolderStyle.marginLeft=closedMargins.left+"px",_ElementUtilities._maintainFocus(function(){_this._dom.root.parentElement.insertBefore(placeHolder,_this._dom.root),_Global.document.body.appendChild(_this._dom.root),_this._dom.root.style.width=closedContentWidth+"px",_this._dom.root.style.left=closedBorderBox.left-closedMargins.left+"px";var topOfViewport=0,bottomOfViewport=_Global.innerHeight,distanceFromTop=closedContentBoxTop-topOfViewport,distanceFromBottom=bottomOfViewport-closedContentBoxBottom;distanceFromTop>distanceFromBottom?(_this._commandingSurface.overflowDirection=_Constants.OverflowDirection.top,_this._dom.root.style.bottom=bottomOfViewport-closedBorderBox.bottom-closedMargins.bottom+"px"):(_this._commandingSurface.overflowDirection=_Constants.OverflowDirection.bottom,_this._dom.root.style.top=topOfViewport+closedBorderBox.top-closedMargins.top+"px"),_ElementUtilities.addClass(_this._dom.root,_Constants.ClassNames.openedClass),_ElementUtilities.removeClass(_this._dom.root,_Constants.ClassNames.closedClass)}),this._commandingSurface.synchronousOpen(),_LightDismissService.shown(this._dismissable)},ToolBar.prototype._updateDomImpl_renderClosed=function(){var _this=this;_ElementUtilities._maintainFocus(function(){if(_this._dom.placeHolder.parentElement){var placeHolder=_this._dom.placeHolder;placeHolder.parentElement.insertBefore(_this._dom.root,placeHolder),placeHolder.parentElement.removeChild(placeHolder)}_this._dom.root.style.top="",_this._dom.root.style.right="",_this._dom.root.style.bottom="",_this._dom.root.style.left="",_this._dom.root.style.width=_this._updateDomImpl_renderedState.prevInlineWidth,_ElementUtilities.addClass(_this._dom.root,_Constants.ClassNames.closedClass),_ElementUtilities.removeClass(_this._dom.root,_Constants.ClassNames.openedClass)}),this._commandingSurface.synchronousClose(),_LightDismissService.hidden(this._dismissable)},ToolBar.ClosedDisplayMode=ClosedDisplayMode,ToolBar.supportedForProcessing=!0,ToolBar}();exports.ToolBar=ToolBar,_Base.Class.mix(ToolBar,_Events.createEventProperties(_Constants.EventNames.beforeOpen,_Constants.EventNames.afterOpen,_Constants.EventNames.beforeClose,_Constants.EventNames.afterClose)),_Base.Class.mix(ToolBar,_Control.DOMEventMixin)}),define("WinJS/Controls/ToolBar",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{ToolBar:{get:function(){return module||require(["./ToolBar/_ToolBar"],function(m){module=m}),module.ToolBar}}})}),define("WinJS/Controls/_LegacyAppBar/_Layouts",["exports","../../Animations/_TransitionAnimation","../../BindingList","../../Core/_BaseUtils","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Controls/ToolBar","../../Controls/ToolBar/_Constants","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../AppBar/_Command","./_Constants"],function(exports,_TransitionAnimation,BindingList,_BaseUtils,_Global,_Base,_ErrorFromName,_Resources,_WriteProfilerMark,ToolBar,_ToolBarConstants,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Command,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_AppBarBaseLayout:_Base.Namespace._lazy(function(){var baseType=_Constants.appBarLayoutCustom,strings={get nullCommand(){return"Invalid argument: command must not be null"}},_AppBarBaseLayout=_Base.Class.define(function(appBarEl,options){this._disposed=!1,options=options||{},_Control.setOptions(this,options),appBarEl&&this.connect(appBarEl)},{className:{get:function(){return this._className}},type:{get:function(){return this._type||baseType}},commandsInOrder:{get:function(){var commandElements=this.appBarEl.querySelectorAll("."+_Constants.appBarCommandClass);return Array.prototype.map.call(commandElements,function(commandElement){return commandElement.winControl})}},connect:function(appBarEl){this.className&&_ElementUtilities.addClass(appBarEl,this.className),this.appBarEl=appBarEl},disconnect:function(){this.className&&_ElementUtilities.removeClass(this.appBarEl,this.className),this.appBarEl=null,this.dispose()},layout:function(commands){for(var len=commands.length,i=0;len>i;i++){var command=this.sanitizeCommand(commands[i]);this.appBarEl.appendChild(command._element)}},showCommands:function(commands){this.appBarEl.winControl._showCommands(commands)},showOnlyCommands:function(commands){this.appBarEl.winControl._showOnlyCommands(commands)},hideCommands:function(commands){this.appBarEl.winControl._hideCommands(commands)},sanitizeCommand:function(command){if(!command)throw new _ErrorFromName("WinJS.UI.AppBar.NullCommand",strings.nullCommand);return command=command.winControl||command,command._element||(command=new _Command.AppBarCommand(null,command)),command._element.parentElement&&command._element.parentElement.removeChild(command._element),command},dispose:function(){this._disposed=!0},disposeChildren:function(){var appBarFirstDiv=this.appBarEl.querySelectorAll("."+_Constants.firstDivClass);appBarFirstDiv=appBarFirstDiv.length>=1?appBarFirstDiv[0]:null;var appBarFinalDiv=this.appBarEl.querySelectorAll("."+_Constants.finalDivClass);appBarFinalDiv=appBarFinalDiv.length>=1?appBarFinalDiv[0]:null;for(var children=this.appBarEl.children,length=children.length,i=0;length>i;i++){var element=children[i];element!==appBarFirstDiv&&element!==appBarFinalDiv&&_Dispose.disposeSubTree(element)}},handleKeyDown:function(){},commandsUpdated:function(){},beginAnimateCommands:function(){},endAnimateCommands:function(){},scale:function(){},resize:function(){},positionChanging:function(fromPosition,toPosition){return Promise.wrap()},setFocusOnShow:function(){this.appBarEl.winControl._setFocusToAppBar()}});return _AppBarBaseLayout})}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_AppBarCommandsLayout:_Base.Namespace._lazy(function(){var layoutClassName=_Constants.commandLayoutClass,layoutType=_Constants.appBarLayoutCommands,_AppBarCommandsLayout=_Base.Class.derive(exports._AppBarBaseLayout,function(appBarEl){exports._AppBarBaseLayout.call(this,appBarEl,{_className:layoutClassName,_type:layoutType}),this._commandLayoutsInit(appBarEl)},{commandsInOrder:{get:function(){return this._originalCommands.filter(function(command){return this.appBarEl.contains(command.element)},this)}},layout:function(commands){_ElementUtilities.empty(this._primaryCommands),_ElementUtilities.empty(this._secondaryCommands),this._originalCommands=[];for(var i=0,len=commands.length;len>i;i++){var command=this.sanitizeCommand(commands[i]);this._originalCommands.push(command),"primary"===command.section||"global"===command.section?this._primaryCommands.appendChild(command._element):this._secondaryCommands.appendChild(command._element)}this.appBarEl.appendChild(this._secondaryCommands),this.appBarEl.appendChild(this._primaryCommands),this._needToMeasureNewCommands=!0,Scheduler.schedule(function(){this._needToMeasureNewCommands&&!this._disposed&&this.scale()}.bind(this),Scheduler.Priority.idle,this,"WinJS._commandLayoutsMixin._scaleNewCommands")},disposeChildren:function(){_Dispose.disposeSubTree(this._primaryCommands),_Dispose.disposeSubTree(this._secondaryCommands)},handleKeyDown:function(event){var Key=_ElementUtilities.Key;if(!_ElementUtilities._matchesSelector(event.target,".win-interactive, .win-interactive *")){var rtl="rtl"===_ElementUtilities._getComputedStyle(this.appBarEl).direction,leftKey=rtl?Key.rightArrow:Key.leftArrow,rightKey=rtl?Key.leftArrow:Key.rightArrow;if(event.keyCode===leftKey||event.keyCode===rightKey||event.keyCode===Key.home||event.keyCode===Key.end){var targetCommand,globalCommandHasFocus=this._primaryCommands.contains(_Global.document.activeElement),focusableCommands=this._getFocusableCommandsInLogicalOrder(globalCommandHasFocus);if(focusableCommands.length)switch(event.keyCode){case leftKey:var index=Math.max(-1,focusableCommands.focusedIndex-1)+focusableCommands.length;targetCommand=focusableCommands[index%focusableCommands.length].winControl.lastElementFocus;break;case rightKey:var index=focusableCommands.focusedIndex+1+focusableCommands.length;targetCommand=focusableCommands[index%focusableCommands.length].winControl.firstElementFocus;break;case Key.home:var index=0;targetCommand=focusableCommands[index].winControl.firstElementFocus;break;case Key.end:var index=focusableCommands.length-1;targetCommand=focusableCommands[index].winControl.lastElementFocus}targetCommand&&targetCommand!==_Global.document.activeElement&&(targetCommand.focus(),event.preventDefault())}}},commandsUpdated:function(newSetOfVisibleCommands){var visibleCommands=newSetOfVisibleCommands?newSetOfVisibleCommands:this.commandsInOrder.filter(function(command){return!command.hidden});this._fullSizeWidthOfLastKnownVisibleCommands=this._getWidthOfFullSizeCommands(visibleCommands)},beginAnimateCommands:function(showCommands,hideCommands,otherVisibleCommands){this._scaleAfterAnimations=!1;var changeInWidth=this._getWidthOfFullSizeCommands(showCommands)-this._getWidthOfFullSizeCommands(hideCommands);if(changeInWidth>0){var visibleCommandsAfterAnimations=otherVisibleCommands.concat(showCommands);this.commandsUpdated(visibleCommandsAfterAnimations),this.scale()}else 0>changeInWidth&&(this._scaleAfterAnimations=!0)},endAnimateCommands:function(){this._scaleAfterAnimations&&(this.commandsUpdated(),this.scale())},resize:function(){this._disposed||(this._appBarTotalKnownWidth=null,this.appBarEl.winControl.opened&&this.scale())},disconnect:function(){exports._AppBarBaseLayout.prototype.disconnect.call(this)},_getWidthOfFullSizeCommands:function(commands){this._needToMeasureNewCommands&&this._measureContentCommands();var accumulatedWidth=0,separatorsCount=0,buttonsCount=0;if(!commands)return this._fullSizeWidthOfLastKnownVisibleCommands;for(var command,i=0,len=commands.length;len>i;i++)command=commands[i].winControl||commands[i],command._type===_Constants.typeSeparator?separatorsCount++:command._type!==_Constants.typeContent?buttonsCount++:accumulatedWidth+=command._fullSizeWidth;return accumulatedWidth+=separatorsCount*_Constants.separatorWidth+buttonsCount*_Constants.buttonWidth},_getFocusableCommandsInLogicalOrder:function(){var secondaryCommands=this._secondaryCommands.children,primaryCommands=this._primaryCommands.children,focusedIndex=-1,getFocusableCommandsHelper=function(commandsInReach){for(var focusableCommands=[],i=0,len=commandsInReach.length;len>i;i++){var element=commandsInReach[i];if(_ElementUtilities.hasClass(element,_Constants.appBarCommandClass)&&element.winControl){var containsFocus=element.contains(_Global.document.activeElement);(element.winControl._isFocusable()||containsFocus)&&(focusableCommands.push(element),containsFocus&&(focusedIndex=focusableCommands.length-1))}}return focusableCommands},commandsInReach=Array.prototype.slice.call(secondaryCommands).concat(Array.prototype.slice.call(primaryCommands)),focusableCommands=getFocusableCommandsHelper(commandsInReach);return focusableCommands.focusedIndex=focusedIndex,focusableCommands},_commandLayoutsInit:function(){this._primaryCommands=_Global.document.createElement("DIV"),this._secondaryCommands=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._primaryCommands,_Constants.primaryCommandsClass),_ElementUtilities.addClass(this._secondaryCommands,_Constants.secondaryCommandsClass)},_scaleHelper:function(){var extraPadding="minimal"===this.appBarEl.winControl.closedDisplayMode?_Constants.appBarInvokeButtonWidth:0;return _Global.document.documentElement.clientWidth-extraPadding},_measureContentCommands:function(){if(_Global.document.body.contains(this.appBarEl)){this._needToMeasureNewCommands=!1;var hadHiddenClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-closed");_ElementUtilities.removeClass(this.appBarEl,"win-navbar-closed");var prevAppBarDisplay=this.appBarEl.style.display;this.appBarEl.style.display="";for(var prevCommandDisplay,element,contentElements=this.appBarEl.querySelectorAll("div."+_Constants.appBarCommandClass),i=0,len=contentElements.length;len>i;i++)element=contentElements[i],element.winControl&&element.winControl._type===_Constants.typeContent&&(prevCommandDisplay=element.style.display,element.style.display="",element.winControl._fullSizeWidth=_ElementUtilities.getTotalWidth(element)||0,element.style.display=prevCommandDisplay);this.appBarEl.style.display=prevAppBarDisplay,hadHiddenClass&&_ElementUtilities.addClass(this.appBarEl,"win-navbar-closed"),this.commandsUpdated()}}});return _AppBarCommandsLayout})}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_AppBarMenuLayout:_Base.Namespace._lazy(function(){function transformWithTransition(element,transition){var duration=transition.duration*_TransitionAnimation._animationFactor,transitionProperty=_BaseUtils._browserStyleEquivalents.transition.scriptName;element.style[transitionProperty]=duration+"ms "+transformNames.cssName+" "+transition.timing,element.style[transformNames.scriptName]=transition.to;var finish;return new Promise(function(c){var onTransitionEnd=function(eventObject){eventObject.target===element&&eventObject.propertyName===transformNames.cssName&&finish()},didFinish=!1;finish=function(){didFinish||(_Global.clearTimeout(timeoutId),element.removeEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd),element.style[transitionProperty]="",didFinish=!0),c()};var timeoutId=_Global.setTimeout(function(){timeoutId=_Global.setTimeout(finish,duration)},50);element.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd)},function(){finish()})}function growTransition(elementClipper,element,args){var diff=args.anchorTrailingEdge?args.to.total-args.from.total:args.from.total-args.to.total,translate="width"===args.dimension?"translateX":"translateY",size=args.dimension,duration=args.duration||367,timing=args.timing||"cubic-bezier(0.1, 0.9, 0.2, 1)";elementClipper.style[size]=args.to.total+"px",elementClipper.style[transformNames.scriptName]=translate+"("+diff+"px)",element.style[size]=args.to.content+"px",element.style[transformNames.scriptName]=translate+"("+-diff+"px)",_ElementUtilities._getComputedStyle(elementClipper).opacity,_ElementUtilities._getComputedStyle(element).opacity;var transition={duration:duration,timing:timing,to:""};return Promise.join([transformWithTransition(elementClipper,transition),transformWithTransition(element,transition)])}function shrinkTransition(elementClipper,element,args){var diff=args.anchorTrailingEdge?args.from.total-args.to.total:args.to.total-args.from.total,translate="width"===args.dimension?"translateX":"translateY",duration=args.duration||367,timing=args.timing||"cubic-bezier(0.1, 0.9, 0.2, 1)";elementClipper.style[transformNames.scriptName]="",element.style[transformNames.scriptName]="",_ElementUtilities._getComputedStyle(elementClipper).opacity,_ElementUtilities._getComputedStyle(element).opacity;var transition={duration:duration,timing:timing},clipperTransition=_BaseUtils._merge(transition,{to:translate+"("+diff+"px)"}),elementTransition=_BaseUtils._merge(transition,{to:translate+"("+-diff+"px)"});return Promise.join([transformWithTransition(elementClipper,clipperTransition),transformWithTransition(element,elementTransition)])}function resizeTransition(elementClipper,element,args){return args.to.total>args.from.total?growTransition(elementClipper,element,args):args.to.total<args.from.total?shrinkTransition(elementClipper,element,args):Promise.as()}var layoutClassName=_Constants.menuLayoutClass,layoutType=_Constants.appBarLayoutMenu,transformNames=_BaseUtils._browserStyleEquivalents.transform,_AppBarMenuLayout=_Base.Class.derive(exports._AppBarBaseLayout,function(appBarEl){exports._AppBarBaseLayout.call(this,appBarEl,{_className:layoutClassName,_type:layoutType}),this._tranformNames=_BaseUtils._browserStyleEquivalents.transform,this._animationCompleteBound=this._animationComplete.bind(this),this._positionToolBarBound=this._positionToolBar.bind(this)},{commandsInOrder:{get:function(){return this._originalCommands}},layout:function(commands){this._writeProfilerMark("layout,info"),commands=commands||[],this._originalCommands=[];var that=this;commands.forEach(function(command){that._originalCommands.push(that.sanitizeCommand(command))}),this._displayedCommands=this._originalCommands.slice(0),this._menu?_ElementUtilities.empty(this._menu):(this._menu=_Global.document.createElement("div"),_ElementUtilities.addClass(this._menu,_Constants.menuContainerClass)),this.appBarEl.appendChild(this._menu),this._toolbarEl=_Global.document.createElement("div"),this._menu.appendChild(this._toolbarEl),this._createToolBar(commands)},showCommands:function(commands){var elements=this._getCommandsElements(commands),data=[],newDisplayedCommands=[],that=this;this._originalCommands.forEach(function(command){(elements.indexOf(command.element)>=0||that._displayedCommands.indexOf(command)>=0)&&(newDisplayedCommands.push(command),data.push(command))}),this._displayedCommands=newDisplayedCommands,this._updateData(data)},showOnlyCommands:function(commands){this._displayedCommands=[],this.showCommands(commands)},hideCommands:function(commands){var elements=this._getCommandsElements(commands),data=[],newDisplayedCommands=[],that=this;this._originalCommands.forEach(function(command){-1===elements.indexOf(command.element)&&that._displayedCommands.indexOf(command)>=0&&(newDisplayedCommands.push(command),data.push(command))}),this._displayedCommands=newDisplayedCommands,this._updateData(data)},connect:function(appBarEl){this._writeProfilerMark("connect,info"),exports._AppBarBaseLayout.prototype.connect.call(this,appBarEl),this._id=_ElementUtilities._uniqueID(appBarEl)},resize:function(){this._writeProfilerMark("resize,info"),this._initialized&&(this._forceLayoutPending=!0)},positionChanging:function(fromPosition,toPosition){return this._writeProfilerMark("positionChanging from:"+fromPosition+" to: "+toPosition+",info"),this._animationPromise=this._animationPromise||Promise.wrap(),this._animating&&this._animationPromise.cancel(),this._animating=!0,"shown"===toPosition||"shown"!==fromPosition&&"compact"===toPosition?(this._positionToolBar(),this._animationPromise=this._animateToolBarEntrance()):"minimal"===fromPosition||"compact"===fromPosition||"hidden"===fromPosition?this._animationPromise=Promise.wrap():this._animationPromise=this._animateToolBarExit(),this._animationPromise.then(this._animationCompleteBound,this._animationCompleteBound),this._animationPromise},disposeChildren:function(){this._writeProfilerMark("disposeChildren,info"),this._toolbar&&_Dispose.disposeSubTree(this._toolbarEl),this._originalCommands=[],this._displayedCommands=[]},setFocusOnShow:function(){this.appBarEl.winControl._setFocusToAppBar(!0,this._menu)},_updateData:function(data){var hadHiddenClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-closed"),hadShownClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-opened");_ElementUtilities.removeClass(this.appBarEl,"win-navbar-closed");var prevAppBarDisplay=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar.data=new BindingList.List(data),hadHiddenClass&&this._positionToolBar(),this.appBarEl.style.display=prevAppBarDisplay,hadHiddenClass&&_ElementUtilities.addClass(this.appBarEl,"win-navbar-closed"),hadShownClass&&(this._positionToolBar(),this._animateToolBarEntrance())},_getCommandsElements:function(commands){if(!commands)return[];"string"!=typeof commands&&commands&&commands.length||(commands=[commands]);for(var elements=[],i=0,len=commands.length;len>i;i++)if(commands[i])if("string"==typeof commands[i]){var element=_Global.document.getElementById(commands[i]);if(element)elements.push(element);else for(var j=0,len2=this._originalCommands.length;len2>j;j++){var element=this._originalCommands[j].element;element.id===commands[i]&&elements.push(element)}}else commands[i].element?elements.push(commands[i].element):elements.push(commands[i]);return elements},_animationComplete:function(){this._disposed||(this._animating=!1)},_createToolBar:function(commands){this._writeProfilerMark("_createToolBar,info");var hadHiddenClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-closed");_ElementUtilities.removeClass(this.appBarEl,"win-navbar-closed");var prevAppBarDisplay=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar=new ToolBar.ToolBar(this._toolbarEl,{data:new BindingList.List(this._originalCommands),shownDisplayMode:"full"});var that=this;this._appbarInvokeButton=this.appBarEl.querySelector("."+_Constants.invokeButtonClass),this._overflowButton=this._toolbarEl.querySelector("."+_ToolBarConstants.overflowButtonCssClass),this._overflowButton.addEventListener("click",function(){that._appbarInvokeButton.click()}),this._positionToolBar(),this.appBarEl.style.display=prevAppBarDisplay,hadHiddenClass&&_ElementUtilities.addClass(this.appBarEl,"win-navbar-closed")},_positionToolBar:function(){this._disposed||(this._writeProfilerMark("_positionToolBar,info"),this._initialized=!0)},_animateToolBarEntrance:function(){this._writeProfilerMark("_animateToolBarEntrance,info"),this._forceLayoutPending&&(this._forceLayoutPending=!1,this._toolbar.forceLayout(),this._positionToolBar());var heightVisible=this._isMinimal()?0:this.appBarEl.offsetHeight;if(this._isBottom()){var offsetTop=this._menu.offsetHeight-heightVisible;return this._executeTranslate(this._menu,"translateY("+-offsetTop+"px)")}return resizeTransition(this._menu,this._toolbarEl,{from:{content:heightVisible,total:heightVisible},to:{content:this._menu.offsetHeight,total:this._menu.offsetHeight},dimension:"height",duration:400,timing:"ease-in"})},_animateToolBarExit:function(){this._writeProfilerMark("_animateToolBarExit,info");var heightVisible=this._isMinimal()?0:this.appBarEl.offsetHeight;return this._isBottom()?this._executeTranslate(this._menu,"none"):resizeTransition(this._menu,this._toolbarEl,{from:{content:this._menu.offsetHeight,total:this._menu.offsetHeight},to:{content:heightVisible,total:heightVisible},dimension:"height",duration:400,timing:"ease-in"})},_executeTranslate:function(element,value){return _TransitionAnimation.executeTransition(element,{property:this._tranformNames.cssName,delay:0,duration:400,timing:"ease-in",to:value})},_isMinimal:function(){return"minimal"===this.appBarEl.winControl.closedDisplayMode},_isBottom:function(){return"bottom"===this.appBarEl.winControl.placement},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI._AppBarMenuLayout:"+this._id+":"+text)}});return _AppBarMenuLayout})})}),define("WinJS/Controls/_LegacyAppBar",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Promise","../Scheduler","../_LightDismissService","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./_LegacyAppBar/_Constants","./_LegacyAppBar/_Layouts","./AppBar/_Command","./AppBar/_Icon","./Flyout/_Overlay","../Application"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,Promise,Scheduler,_LightDismissService,_Control,_Dispose,_ElementUtilities,_Hoverable,_KeyboardBehavior,_Constants,_Layouts,_Command,_Icon,_Overlay,Application){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_LegacyAppBar:_Base.Namespace._lazy(function(){function _allManipulationChanged(event){var elements=_Global.document.querySelectorAll("."+_Constants.appBarClass);if(elements)for(var len=elements.length,i=0;len>i;i++){var element=elements[i],appbar=element.winControl;appbar&&!element.disabled&&appbar._manipulationChanged(event)}}var EVENTS={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},createEvent=_Events._createEventProperty,knownVisibleHeights={none:0,hidden:0,minimal:25,compact:48},displayModeVisiblePositions={none:"hidden",hidden:"hidden",minimal:"minimal",shown:"shown",compact:"compact"},closedDisplayModes={none:"none",minimal:"minimal",compact:"compact"},appbarShownState="shown",appbarHiddenState="hidden",globalEventsInitialized=!1,strings={get ariaLabel(){return _Resources._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get cannotChangePlacementWhenVisible(){return"Invalid argument: The placement property cannot be set when the AppBar is visible, call hide() first"},get cannotChangeLayoutWhenVisible(){return"Invalid argument: The layout property cannot be set when the AppBar is visible, call hide() first"}},_LegacyAppBar=_Base.Class.derive(_Overlay._Overlay,function(element,options){this._initializing=!0,options=options||{},this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),_ElementUtilities.addClass(this._element,_Constants.appBarClass);var that=this;this._dismissable=new _LightDismissService.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){that.close()},onTakeFocus:function(useSetActive){that._dismissable.restoreFocus()||that._layoutImpl.setFocusOnShow()}});var role=this._element.getAttribute("role");role||this._element.setAttribute("role","menubar");var label=this._element.getAttribute("aria-label");label||this._element.setAttribute("aria-label",strings.ariaLabel),this._baseOverlayConstructor(this._element),this._lastPositionVisited=displayModeVisiblePositions.none,_ElementUtilities.addClass(this._element,_Constants.hiddenClass),this._invokeButton=_Global.document.createElement("button"),this._invokeButton.tabIndex=0,this._invokeButton.setAttribute("type","button"),this._invokeButton.innerHTML="<span class='"+_Constants.ellipsisClass+"'></span>",_ElementUtilities.addClass(this._invokeButton,_Constants.invokeButtonClass),this._element.appendChild(this._invokeButton),this._invokeButton.addEventListener("click",function(){that.opened?that._hide():that._show()},!1),this._layout=_Constants.appBarLayoutCustom,delete options._layout,this.placement=options.placement||_Constants.appBarPlacementBottom,this.closedDisplayMode=options.closedDisplayMode||closedDisplayModes.compact,_Control.setOptions(this,options);var commandsUpdatedBound=this._commandsUpdated.bind(this);return this._element.addEventListener(_Constants.commandVisibilityChanged,function(ev){that._disposed||(that.opened&&ev.preventDefault(),commandsUpdatedBound())}),this._initializing=!1,this._setFocusToAppBarBound=this._setFocusToAppBar.bind(this),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),globalEventsInitialized||(_Global.document.addEventListener("MSManipulationStateChanged",_allManipulationChanged,!1),globalEventsInitialized=!0),this.closedDisplayMode===closedDisplayModes.none&&this.layout===_Constants.appBarLayoutCommands&&(this._element.style.display="none"),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._element),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(value){var wasShown=!1;if(_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),wasShown=!0),this.opened)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.CannotChangePlacementWhenVisible",strings.cannotChangePlacementWhenVisible);this._placement=value===_Constants.appBarPlacementTop?_Constants.appBarPlacementTop:_Constants.appBarPlacementBottom,this._placement===_Constants.appBarPlacementTop?(_ElementUtilities.addClass(this._element,_Constants.topClass),_ElementUtilities.removeClass(this._element,_Constants.bottomClass)):this._placement===_Constants.appBarPlacementBottom&&(_ElementUtilities.removeClass(this._element,_Constants.topClass),_ElementUtilities.addClass(this._element,_Constants.bottomClass)),this._ensurePosition(),wasShown&&this._show()}},_layout:{get:function(){return this._layoutImpl.type;
},set:function(layout){layout!==_Constants.appBarLayoutCommands&&layout!==_Constants.appBarLayoutCustom&&layout!==_Constants.appBarLayoutMenu;var wasShown=!1;if(_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),wasShown=!0),this.opened)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.CannotChangeLayoutWhenVisible",strings.cannotChangeLayoutWhenVisible);var commands;this._initializing||(commands=this._layoutImpl.commandsInOrder,this._layoutImpl.disconnect()),layout===_Constants.appBarLayoutCommands?this._layoutImpl=new _Layouts._AppBarCommandsLayout:layout===_Constants.appBarLayoutMenu?this._layoutImpl=new _Layouts._AppBarMenuLayout:this._layoutImpl=new _Layouts._AppBarBaseLayout,this._layoutImpl.connect(this._element),commands&&commands.length&&this._layoutCommands(commands),wasShown&&this._show()},configurable:!0},commands:{set:function(commands){if(this.opened)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.CannotChangeCommandsWhenVisible",_Resources._formatString(_Overlay._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"_LegacyAppBar"));this._initializing||this._disposeChildren(),this._layoutCommands(commands)}},_layoutCommands:function(commands){_ElementUtilities.empty(this._element),this._element.appendChild(this._invokeButton),Array.isArray(commands)||(commands=[commands]),this._layoutImpl.layout(commands)},closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(value){var oldValue=this._closedDisplayMode;if(oldValue!==value){var changeVisiblePosition=_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)||_ElementUtilities.hasClass(this._element,_Constants.hidingClass);value===closedDisplayModes.none?(this._closedDisplayMode=closedDisplayModes.none,changeVisiblePosition&&oldValue||(_ElementUtilities.removeClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass))):value===closedDisplayModes.minimal?(this._closedDisplayMode=closedDisplayModes.minimal,changeVisiblePosition&&oldValue&&oldValue!==closedDisplayModes.none||(_ElementUtilities.addClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass))):(this._closedDisplayMode=closedDisplayModes.compact,_ElementUtilities.addClass(this._element,_Constants.compactClass),_ElementUtilities.removeClass(this._element,_Constants.minimalClass)),this._layoutImpl.resize(),changeVisiblePosition&&this._changeVisiblePosition(displayModeVisiblePositions[this._closedDisplayMode])}}},opened:{get:function(){return!_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)&&!_ElementUtilities.hasClass(this._element,_Constants.hidingClass)&&this._doNext!==displayModeVisiblePositions.minimal&&this._doNext!==displayModeVisiblePositions.compact&&this._doNext!==displayModeVisiblePositions.none},set:function(opened){var currentlyOpen=this.opened;opened&&!currentlyOpen?this._show():!opened&&currentlyOpen&&this._hide()}},onbeforeopen:createEvent(EVENTS.beforeOpen),onafteropen:createEvent(EVENTS.afterOpen),onbeforeclose:createEvent(EVENTS.beforeClose),onafterclose:createEvent(EVENTS.afterClose),getCommandById:function(id){var commands=this._layoutImpl.commandsInOrder.filter(function(command){return command.id===id||command.element.id===id});return 1===commands.length?commands[0]:0===commands.length?null:commands},showCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.RequiresCommands",strings.requiresCommands);this._layoutImpl.showCommands(commands)},hideCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.RequiresCommands",strings.requiresCommands);this._layoutImpl.hideCommands(commands)},showOnlyCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.RequiresCommands",strings.requiresCommands);this._layoutImpl.showOnlyCommands(commands)},open:function(){this._writeProfilerMark("show,StartTM"),this._show()},_show:function(){var toPosition=displayModeVisiblePositions.shown,showing=null;this.disabled||!_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)&&!_ElementUtilities.hasClass(this._element,_Constants.hidingClass)||(showing=appbarShownState),this._changeVisiblePosition(toPosition,showing),showing&&(this._updateFirstAndFinalDiv(),_LightDismissService.shown(this._dismissable))},close:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(toPosition){var toPosition=toPosition||displayModeVisiblePositions[this.closedDisplayMode],hiding=null;_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)||_ElementUtilities.hasClass(this._element,_Constants.hidingClass)||(hiding=appbarHiddenState),this._changeVisiblePosition(toPosition,hiding)},_dispose:function(){_Dispose.disposeSubTree(this.element),_LightDismissService.hidden(this._dismissable),this._layoutImpl.dispose(),this.disabled=!0,this.close()},_disposeChildren:function(){this._layoutImpl.disposeChildren()},_handleKeyDown:function(event){this._invokeButton.contains(_Global.document.activeElement)||this._layoutImpl.handleKeyDown(event)},_visiblePixels:{get:function(){return{hidden:knownVisibleHeights.hidden,minimal:knownVisibleHeights.minimal,compact:Math.max(this._heightWithoutLabels||0,knownVisibleHeights.compact),shown:this._element.offsetHeight}}},_visiblePosition:{get:function(){return this._animating&&displayModeVisiblePositions[this._element.winAnimating]?this._element.winAnimating:this._lastPositionVisited}},_visible:{get:function(){return this._visiblePosition!==displayModeVisiblePositions.none}},_changeVisiblePosition:function(toPosition,newState){if(this._visiblePosition===toPosition&&!this._keyboardObscured||this.disabled&&toPosition!==displayModeVisiblePositions.disabled)this._afterPositionChange(null);else if(this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard)this._doNext=toPosition,this._afterPositionChange(null);else{this._element.winAnimating=toPosition;var performAnimation=this._initializing?!1:!0,fromPosition=this._lastPositionVisited;this._element.style.display="";var hidingCompletely=toPosition===displayModeVisiblePositions.hidden;this._keyboardObscured&&(hidingCompletely?performAnimation=!1:fromPosition=displayModeVisiblePositions.hidden,this._keyboardObscured=!1),newState===appbarShownState?this._beforeShow():newState===appbarHiddenState&&this._beforeHide(),this._ensurePosition(),this._element.style.opacity=1,this._element.style.visibility="visible",this._animationPromise=performAnimation?this._animatePositionChange(fromPosition,toPosition):Promise.wrap(),this._animationPromise.then(function(){this._afterPositionChange(toPosition,newState)}.bind(this),function(){this._afterPositionChange(toPosition,newState)}.bind(this))}},_afterPositionChange:function(newPosition,newState){if(!this._disposed){if(newPosition){newPosition===displayModeVisiblePositions.minimal&&(_ElementUtilities.addClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass)),newPosition===displayModeVisiblePositions.hidden&&this.closedDisplayMode===closedDisplayModes.none&&(_ElementUtilities.removeClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass)),this._element.winAnimating="",this._lastPositionVisited=newPosition,this._doNext===this._lastPositionVisited&&(this._doNext=""),newState===appbarHiddenState&&_LightDismissService.hidden(this._dismissable),newPosition===displayModeVisiblePositions.hidden&&(this._element.style.visibility="hidden",this._element.style.display="none");var transformProperty=_BaseUtils._browserStyleEquivalents.transform.scriptName;this._element.style[transformProperty]="",newState===appbarShownState?this._afterShow():newState===appbarHiddenState&&this._afterHide(),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._LegacyAppBar._checkDoNext")}this._afterPositionChangeCallBack()}},_afterPositionChangeCallBack:function(){},_beforeShow:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._layoutImpl.scale(),this.closedDisplayMode===closedDisplayModes.compact&&(this._heightWithoutLabels=this._element.offsetHeight),_ElementUtilities.removeClass(this._element,_Constants.hiddenClass),_ElementUtilities.addClass(this._element,_Constants.showingClass),this._sendEvent(EVENTS.beforeOpen)},_afterShow:function(){_ElementUtilities.removeClass(this._element,_Constants.showingClass),_ElementUtilities.addClass(this._element,_Constants.shownClass),this._sendEvent(EVENTS.afterOpen),this._writeProfilerMark("show,StopTM")},_beforeHide:function(){_ElementUtilities.removeClass(this._element,_Constants.shownClass),_ElementUtilities.addClass(this._element,_Constants.hidingClass),this._sendEvent(EVENTS.beforeClose)},_afterHide:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),_ElementUtilities.removeClass(this._element,_Constants.hidingClass),_ElementUtilities.addClass(this._element,_Constants.hiddenClass),this._sendEvent(EVENTS.afterClose),this._writeProfilerMark("hide,StopTM")},_animatePositionChange:function(fromPosition,toPosition){var appBarElementAnimationPromise,layoutElementsAnimationPromise=this._layoutImpl.positionChanging(fromPosition,toPosition),beginningVisiblePixelHeight=this._visiblePixels[fromPosition],endingVisiblePixelHeight=this._visiblePixels[toPosition],distance=Math.abs(endingVisiblePixelHeight-beginningVisiblePixelHeight),offsetTop=this._placement===_Constants.appBarPlacementTop?-distance:distance;if(this._placement===_Constants.appBarPlacementTop&&(fromPosition===displayModeVisiblePositions.shown&&toPosition===displayModeVisiblePositions.compact||fromPosition===displayModeVisiblePositions.compact&&toPosition===displayModeVisiblePositions.shown)&&(offsetTop=0),endingVisiblePixelHeight>beginningVisiblePixelHeight){var fromOffset={top:offsetTop+"px",left:"0px"};appBarElementAnimationPromise=Animations.showEdgeUI(this._element,fromOffset,{mechanism:"transition"})}else{var toOffset={top:offsetTop+"px",left:"0px"};appBarElementAnimationPromise=Animations.hideEdgeUI(this._element,toOffset,{mechanism:"transition"})}return Promise.join([layoutElementsAnimationPromise,appBarElementAnimationPromise])},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||(this._doNext===displayModeVisiblePositions.disabled||this._doNext===displayModeVisiblePositions.hidden||this._doNext===displayModeVisiblePositions.minimal||this._doNext===displayModeVisiblePositions.compact?(this._hide(this._doNext),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():this._doNext===displayModeVisiblePositions.shown&&(this._show(),this._doNext=""))},_setFocusToAppBar:function(useSetActive,scroller){this._focusOnFirstFocusableElement(useSetActive,scroller)||_Overlay._Overlay._trySetActive(this._element,scroller)},_commandsUpdated:function(){this._initializing||(this._layoutImpl.commandsUpdated(),this._layoutImpl.scale())},_beginAnimateCommands:function(showCommands,hideCommands,otherVisibleCommands){this._layoutImpl.beginAnimateCommands(showCommands,hideCommands,otherVisibleCommands)},_endAnimateCommands:function(){this._layoutImpl.endAnimateCommands(),this._endAnimateCommandsCallBack()},_endAnimateCommandsCallBack:function(){},_getTopOfVisualViewport:function(){return _Overlay._Overlay._keyboardInfo._visibleDocTop},_getAdjustedBottom:function(){return _Overlay._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(event){if(this._keyboardObscured=!1,this._needToHandleHidingKeyboard=!1,!_Overlay._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._needToHandleShowingKeyboard=!0,this.opened&&this._element.contains(_Global.document.activeElement)&&(event.ensuredFocusedElementInView=!0),this._visible&&this._placement!==_Constants.appBarPlacementTop&&_Overlay._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var that=this;_Global.setTimeout(function(e){that._checkKeyboardTimer(e)},_Overlay._Overlay._keyboardInfo._animationShowLength+_Overlay._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1,this._needToHandleShowingKeyboard=!1,this._needToHandleHidingKeyboard=!0,_Overlay._Overlay._keyboardInfo._isResized||((this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display=""),this._needToHandleHidingKeyboard=!1)},_resize:function(event){this._needToHandleShowingKeyboard?this._visible&&(this._placement===_Constants.appBarPlacementTop||this._keyboardObscured||(this._element.style.display="none")):this._needToHandleHidingKeyboard&&(this._needToHandleHidingKeyboard=!1,(this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display="")),this._initializing||this._layoutImpl.resize(event)},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(event){0===event.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){if(this._needToHandleShowingKeyboard)if(this._needToHandleShowingKeyboard=!1,this._keyboardObscured||this._placement===_Constants.appBarPlacementTop&&0===_Overlay._Overlay._keyboardInfo._visibleDocTop)this._checkDoNext();else{var toPosition=this._visiblePosition;this._lastPositionVisited=displayModeVisiblePositions.hidden,this._changeVisiblePosition(toPosition,!1)}this._scrollHappened=!1},_ensurePosition:function(){var offSet=this._computePositionOffset();this._element.style.bottom=offSet.bottom,this._element.style.top=offSet.top},_computePositionOffset:function(){var positionOffSet={};return this._placement===_Constants.appBarPlacementBottom?(positionOffSet.bottom=this._getAdjustedBottom()+"px",positionOffSet.top=""):this._placement===_Constants.appBarPlacementTop&&(positionOffSet.bottom="",positionOffSet.top=this._getTopOfVisualViewport()+"px"),positionOffSet},_checkScrollPosition:function(){return this._needToHandleShowingKeyboard?void(this._scrollHappened=!0):void((this._visible||this._animating)&&(this._ensurePosition(),this._checkDoNext()))},_alreadyInPlace:function(){var offSet=this._computePositionOffset();return offSet.top===this._element.style.top&&offSet.bottom===this._element.style.bottom},_updateFirstAndFinalDiv:function(){var appBarFirstDiv=this._element.querySelectorAll("."+_Constants.firstDivClass);appBarFirstDiv=appBarFirstDiv.length>=1?appBarFirstDiv[0]:null;var appBarFinalDiv=this._element.querySelectorAll("."+_Constants.finalDivClass);appBarFinalDiv=appBarFinalDiv.length>=1?appBarFinalDiv[0]:null,appBarFirstDiv&&this._element.children[0]!==appBarFirstDiv&&(appBarFirstDiv.parentNode.removeChild(appBarFirstDiv),appBarFirstDiv=null),appBarFinalDiv&&this._element.children[this._element.children.length-1]!==appBarFinalDiv&&(appBarFinalDiv.parentNode.removeChild(appBarFinalDiv),appBarFinalDiv=null),appBarFirstDiv||(appBarFirstDiv=_Global.document.createElement("div"),appBarFirstDiv.style.display="inline",appBarFirstDiv.className=_Constants.firstDivClass,appBarFirstDiv.tabIndex=-1,appBarFirstDiv.setAttribute("aria-hidden","true"),_ElementUtilities._addEventListener(appBarFirstDiv,"focusin",this._focusOnLastFocusableElementOrThis.bind(this),!1),this._element.children[0]?this._element.insertBefore(appBarFirstDiv,this._element.children[0]):this._element.appendChild(appBarFirstDiv)),appBarFinalDiv||(appBarFinalDiv=_Global.document.createElement("div"),appBarFinalDiv.style.display="inline",appBarFinalDiv.className=_Constants.finalDivClass,appBarFinalDiv.tabIndex=-1,appBarFinalDiv.setAttribute("aria-hidden","true"),_ElementUtilities._addEventListener(appBarFinalDiv,"focusin",this._focusOnFirstFocusableElementOrThis.bind(this),!1),this._element.appendChild(appBarFinalDiv)),this._element.children[this._element.children.length-2]!==this._invokeButton&&this._element.insertBefore(this._invokeButton,appBarFinalDiv);var elms=this._element.getElementsByTagName("*"),highestTabIndex=_ElementUtilities._getHighestTabIndexInList(elms);this._invokeButton.tabIndex=highestTabIndex,appBarFirstDiv&&(appBarFirstDiv.tabIndex=_ElementUtilities._getLowestTabIndexInList(elms)),appBarFinalDiv&&(appBarFinalDiv.tabIndex=highestTabIndex)},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI._LegacyAppBar:"+this._id+":"+text)}},{_Events:EVENTS});return _LegacyAppBar})})}),define("WinJS/Controls/Menu",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./_LegacyAppBar/_Constants","./Flyout","./Flyout/_Overlay","./Menu/_Command"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,_WriteProfilerMark,Promise,_ElementUtilities,_Hoverable,_KeyboardBehavior,_Constants,Flyout,_Overlay,_Command){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Menu:_Base.Namespace._lazy(function(){function isCommandInMenu(object){var element=object.element||object;return _ElementUtilities._matchesSelector(element,"."+_Constants.menuClass+" ."+_Constants.menuCommandClass)}var Key=_ElementUtilities.Key,strings={get ariaLabel(){return _Resources._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get nullCommand(){return"Invalid argument: command must not be null"}},Menu=_Base.Class.derive(Flyout.Flyout,function(element,options){options=options||{},this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),!options.commands&&this._element&&(options=_BaseUtils._shallowCopy(options),options.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var role="menu",label=null;this._element&&(role=this._element.getAttribute("role")||role,label=this._element.getAttribute("aria-label")||label),this._baseFlyoutConstructor(this._element,options),this._element.setAttribute("role",role),this._element.setAttribute("aria-label",label),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!0),this._element.addEventListener(_Constants._menuCommandInvokedEvent,this._handleCommandInvoked.bind(this),!1),this._element.addEventListener("mouseover",this._handleMouseOver.bind(this),!1),this._element.addEventListener("mouseout",this._handleMouseOut.bind(this),!1),_ElementUtilities.addClass(this._element,_Constants.menuClass),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._element),this.hide(),this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(value){if(!this.hidden)throw new _ErrorFromName("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",_Resources._formatString(_Overlay._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));_ElementUtilities.empty(this._element),Array.isArray(value)||(value=[value]);for(var len=value.length,i=0;len>i;i++)this._addCommand(value[i])}},getCommandById:function(id){for(var commands=this.element.querySelectorAll("#"+id),newCommands=[],count=0,len=commands.length;len>count;count++)commands[count].winControl&&newCommands.push(commands[count].winControl);return 1===newCommands.length?newCommands[0]:0===newCommands.length?null:newCommands},showCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI.Menu.RequiresCommands",strings.requiresCommands);this._showCommands(commands,!0)},hideCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI.Menu.RequiresCommands",strings.requiresCommands);this._hideCommands(commands,!0)},showOnlyCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI.Menu.RequiresCommands",strings.requiresCommands);this._showOnlyCommands(commands,!0)},_hide:function(){this._hoverPromise&&this._hoverPromise.cancel(),Flyout.Flyout.prototype._hide.call(this)},_afterHide:function(){_ElementUtilities.removeClass(this.element,_Constants.menuMouseSpacingClass),_ElementUtilities.removeClass(this.element,_Constants.menuTouchSpacingClass)},_beforeShow:function(){_ElementUtilities.hasClass(this.element,_Constants.menuMouseSpacingClass)||_ElementUtilities.hasClass(this.element,_Constants.menuTouchSpacingClass)||_ElementUtilities.addClass(this.element,Flyout.Flyout._cascadeManager.inputType===_KeyboardBehavior._InputTypes.mouse||Flyout.Flyout._cascadeManager.inputType===_KeyboardBehavior._InputTypes.keyboard?_Constants.menuMouseSpacingClass:_Constants.menuTouchSpacingClass),this._checkMenuCommands()},_addCommand:function(command){if(!command)throw new _ErrorFromName("WinJS.UI.Menu.NullCommand",strings.nullCommand);command._element||(command=new _Command.MenuCommand(null,command)),command._element.parentElement&&command._element.parentElement.removeChild(command._element),this._element.appendChild(command._element)},_dispose:function(){this._hoverPromise&&this._hoverPromise.cancel(),Flyout.Flyout.prototype._dispose.call(this)},_commandsUpdated:function(){this.hidden||this._checkMenuCommands()},_checkMenuCommands:function(){var menuCommands=this._element.querySelectorAll(".win-command"),hasToggleCommands=!1,hasFlyoutCommands=!1;if(menuCommands)for(var i=0,len=menuCommands.length;len>i;i++){var menuCommand=menuCommands[i].winControl;menuCommand&&!menuCommand.hidden&&(hasToggleCommands||menuCommand.type!==_Constants.typeToggle||(hasToggleCommands=!0),hasFlyoutCommands||menuCommand.type!==_Constants.typeFlyout||(hasFlyoutCommands=!0))}_ElementUtilities[hasToggleCommands?"addClass":"removeClass"](this._element,_Constants.menuContainsToggleCommandClass),_ElementUtilities[hasFlyoutCommands?"addClass":"removeClass"](this._element,_Constants.menuContainsFlyoutCommandClass)},_handleKeyDown:function(event){event.keyCode===Key.upArrow?(Menu._focusOnPreviousElement(this.element),event.preventDefault()):event.keyCode===Key.downArrow?(Menu._focusOnNextElement(this.element),event.preventDefault()):event.keyCode!==Key.space&&event.keyCode!==Key.enter||this.element!==_Global.document.activeElement?event.keyCode===Key.tab&&event.preventDefault():(event.preventDefault(),this.hide())},_handleFocusIn:function(event){var target=event.target;if(isCommandInMenu(target)){var command=target.winControl;if(_ElementUtilities.hasClass(command.element,_Constants.menuCommandFlyoutActivatedClass))command.flyout.element.focus();else{var activatedSiblingCommand=this.element.querySelector("."+_Constants.menuCommandFlyoutActivatedClass);activatedSiblingCommand&&_Command.MenuCommand._deactivateFlyoutCommand(activatedSiblingCommand)}}else target===this.element&&Flyout.Flyout.prototype._handleFocusIn.call(this,event)},_handleCommandInvoked:function(event){this._hoverPromise&&this._hoverPromise.cancel();var command=event.detail.command;command._type!==_Constants.typeFlyout&&command._type!==_Constants.typeSeparator&&this._lightDismiss()},_hoverPromise:null,_handleMouseOver:function(event){var target=event.target;if(isCommandInMenu(target)){var command=target.winControl,that=this;target.focus&&(target.focus(),_ElementUtilities.removeClass(target,"win-keyboard"),command.type===_Constants.typeFlyout&&command.flyout&&command.flyout.hidden&&(this._hoverPromise=this._hoverPromise||Promise.timeout(_Constants.menuCommandHoverDelay).then(function(){that.hidden||that._disposed||command._invoke(event),that._hoverPromise=null},function(){that._hoverPromise=null})))}},_handleMouseOut:function(event){var target=event.target;isCommandInMenu(target)&&!target.contains(event.relatedTarget)&&(target===_Global.document.activeElement&&this.element.focus(),this._hoverPromise&&this._hoverPromise.cancel())},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.Menu:"+this._id+":"+text)}});return Menu._focusOnNextElement=function(menu){var _currentElement=_Global.document.activeElement;do _currentElement=_currentElement===menu?_currentElement.firstElementChild:_currentElement.nextElementSibling,_currentElement?_currentElement.focus():_currentElement=menu;while(_currentElement!==_Global.document.activeElement)},Menu._focusOnPreviousElement=function(menu){var _currentElement=_Global.document.activeElement;do _currentElement=_currentElement===menu?_currentElement.lastElementChild:_currentElement.previousElementSibling,_currentElement?_currentElement.focus():_currentElement=menu;while(_currentElement!==_Global.document.activeElement)},Menu})})}),define("WinJS/Controls/AutoSuggestBox/_SearchSuggestionManagerShim",["exports","../../_Signal","../../Core/_Base","../../Core/_BaseUtils","../../Core/_Events","../../BindingList"],function(exports,_Signal,_Base,_BaseUtils,_Events,BindingList){"use strict";var CollectionChange={reset:0,itemInserted:1,itemRemoved:2,itemChanged:3},SearchSuggestionKind={Query:0,Result:1,Separator:2},SuggestionVectorShim=_Base.Class.derive(Array,function(){},{reset:function(){this.length=0,this.dispatchEvent("vectorchanged",{collectionChange:CollectionChange.reset,index:0})},insert:function(index,data){this.splice(index,0,data),this.dispatchEvent("vectorchanged",{collectionChange:CollectionChange.itemInserted,index:index})},remove:function(index){this.splice(index,1),this.dispatchEvent("vectorchanged",{collectionChange:CollectionChange.itemRemoved,index:index})}});_Base.Class.mix(SuggestionVectorShim,_Events.eventMixin);var SearchSuggestionCollectionShim=_Base.Class.define(function(){this._data=[]},{size:{get:function(){return this._data.length}},appendQuerySuggestion:function(text){this._data.push({kind:SearchSuggestionKind.Query,text:text})},appendQuerySuggestions:function(suggestions){suggestions.forEach(this.appendQuerySuggestion.bind(this))},appendResultSuggestion:function(text,detailText,tag,imageUrl,imageAlternateText){this._data.push({kind:SearchSuggestionKind.Result,text:text,detailText:detailText,tag:tag,imageUrl:imageUrl,imageAlternateText:imageAlternateText,image:null})},appendSearchSeparator:function(label){this._data.push({kind:SearchSuggestionKind.Separator,text:label})}}),SuggestionsRequestedEventArgShim=_Base.Class.define(function(queryText,language,linguisticDetails){this._queryText=queryText,this._language=language,this._linguisticDetails=linguisticDetails,this._searchSuggestionCollection=new SearchSuggestionCollectionShim},{language:{get:function(){return this._language}},linguisticDetails:{get:function(){return this._linguisticDetails}},queryText:{get:function(){return this._queryText}},searchSuggestionCollection:{get:function(){return this._searchSuggestionCollection}},getDeferral:function(){return this._deferralSignal||(this._deferralSignal=new _Signal)},_deferralSignal:null}),SearchSuggestionManagerShim=_Base.Class.define(function(){this._updateVector=this._updateVector.bind(this),this._suggestionVector=new SuggestionVectorShim,this._query="",this._history={"":[]},this._dataSource=[],this.searchHistoryContext="",this.searchHistoryEnabled=!0},{addToHistory:function(queryText){if(queryText&&queryText.trim()){for(var history=this._history[this.searchHistoryContext],dupeIndex=-1,i=0,l=history.length;l>i;i++){var item=history[i];if(item.text.toLowerCase()===queryText.toLowerCase()){dupeIndex=i;break}}dupeIndex>=0&&history.splice(dupeIndex,1),history.splice(0,0,{text:queryText,kind:SearchSuggestionKind.Query}),this._updateVector()}},clearHistory:function(){this._history[this.searchHistoryContext]=[],this._updateVector()},setLocalContentSuggestionSettings:function(settings){},setQuery:function(queryText){function update(arr){that._dataSource=arr,that._updateVector()}var that=this;this._query=queryText;var arg=new SuggestionsRequestedEventArgShim(queryText);this.dispatchEvent("suggestionsrequested",{request:arg}),arg._deferralSignal?arg._deferralSignal.promise.then(update.bind(this,arg.searchSuggestionCollection._data)):update(arg.searchSuggestionCollection._data)},searchHistoryContext:{get:function(){return""+this._searchHistoryContext},set:function(value){value=""+value,this._history[value]||(this._history[value]=[]),this._searchHistoryContext=value}},searchHistoryEnabled:{get:function(){return this._searchHistoryEnabled},set:function(value){this._searchHistoryEnabled=value}},suggestions:{get:function(){return this._suggestionVector}},_updateVector:function(){for(this.suggestions.insert(this.suggestions.length,{text:"",kind:SearchSuggestionKind.Query});this.suggestions.length>1;)this.suggestions.remove(0);var index=0,added={};if(this.searchHistoryEnabled){var q=this._query.toLowerCase();this._history[this.searchHistoryContext].forEach(function(item){var text=item.text.toLowerCase();0===text.indexOf(q)&&(this.suggestions.insert(index,item),added[text]=!0,index++)},this)}this._dataSource.forEach(function(item){item.kind===SearchSuggestionKind.Query?added[item.text.toLowerCase()]||(this.suggestions.insert(index,item),index++):(this.suggestions.insert(index,item),index++)},this),this.suggestions.remove(this.suggestions.length-1)}});_Base.Class.mix(SearchSuggestionManagerShim,_Events.eventMixin),_Base.Namespace._moduleDefine(exports,null,{_CollectionChange:CollectionChange,_SearchSuggestionKind:SearchSuggestionKind,_SearchSuggestionManagerShim:SearchSuggestionManagerShim})}),define("require-style!less/styles-autosuggestbox",[],function(){}),define("require-style!less/colors-autosuggestbox",[],function(){}),define("WinJS/Controls/AutoSuggestBox",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementListUtilities","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../_Accents","../Animations","../BindingList","../Promise","./Repeater","./AutoSuggestBox/_SearchSuggestionManagerShim","require-style!less/styles-autosuggestbox","require-style!less/colors-autosuggestbox"],function(exports,_Global,_WinRT,_Base,_ErrorFromName,_Events,_Resources,_Control,_ElementListUtilities,_ElementUtilities,_Hoverable,_Accents,Animations,BindingList,Promise,Repeater,_SuggestionManagerShim){"use strict";_Accents.createAccentRule("html.win-hoverable .win-autosuggestbox .win-autosuggestbox-suggestion-selected:hover",[{name:"background-color",value:_Accents.ColorTypes.listSelectHover}]),_Accents.createAccentRule(".win-autosuggestbox .win-autosuggestbox-suggestion-selected",[{name:"background-color",value:_Accents.ColorTypes.listSelectRest}]),_Accents.createAccentRule(".win-autosuggestbox .win-autosuggestbox-suggestion-selected.win-autosuggestbox-suggestion-selected:hover:active",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]);var ClassNames={asb:"win-autosuggestbox",asbDisabled:"win-autosuggestbox-disabled",asbFlyout:"win-autosuggestbox-flyout",asbFlyoutAbove:"win-autosuggestbox-flyout-above",asbBoxFlyoutHighlightText:"win-autosuggestbox-flyout-highlighttext",asbHitHighlightSpan:"win-autosuggestbox-hithighlight-span",asbInput:"win-autosuggestbox-input",asbInputFocus:"win-autosuggestbox-input-focus",asbSuggestionQuery:"win-autosuggestbox-suggestion-query",asbSuggestionResult:"win-autosuggestbox-suggestion-result",asbSuggestionResultText:"win-autosuggestbox-suggestion-result-text",asbSuggestionResultDetailedText:"win-autosuggestbox-suggestion-result-detailed-text",asbSuggestionSelected:"win-autosuggestbox-suggestion-selected",asbSuggestionSeparator:"win-autosuggestbox-suggestion-separator"};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{AutoSuggestBox:_Base.Namespace._lazy(function(){function addHitHighlightedText(element,item,text,hitFinder){function addNewSpan(element,textContent,insertBefore){var spanElement=_Global.document.createElement("span");return spanElement.textContent=textContent,spanElement.setAttribute("aria-hidden","true"),spanElement.classList.add(ClassNames.asbHitHighlightSpan),
element.insertBefore(spanElement,insertBefore),spanElement}if(text){_ElementListUtilities.query("."+ClassNames.asbHitHighlightSpan,element).forEach(function(childElement){childElement.parentNode.removeChild(childElement)});var firstChild=element.firstChild,hitsProvided=item.hits;!hitsProvided&&hitFinder&&item.kind!==_SuggestionManagerShim._SearchSuggestionKind.Separator&&(hitsProvided=hitFinder.find(text));for(var hits=AutoSuggestBox._sortAndMergeHits(hitsProvided),lastPosition=0,i=0;i<hits.length;i++){var hit=hits[i];addNewSpan(element,text.substring(lastPosition,hit.startPosition),firstChild),lastPosition=hit.startPosition+hit.length;var spanHitHighlightedText=addNewSpan(element,text.substring(hit.startPosition,lastPosition),firstChild);_ElementUtilities.addClass(spanHitHighlightedText,ClassNames.asbBoxFlyoutHighlightText)}lastPosition<text.length&&addNewSpan(element,text.substring(lastPosition),firstChild)}}function getKeyModifiers(ev){var VirtualKeys={ctrlKey:1,altKey:2,shiftKey:4},keyModifiers=0;return ev.ctrlKey&&(keyModifiers|=VirtualKeys.ctrlKey),ev.altKey&&(keyModifiers|=VirtualKeys.altKey),ev.shiftKey&&(keyModifiers|=VirtualKeys.shiftKey),keyModifiers}function resultSuggestionRenderer(asb,item){function handleInvoke(e){asb._internalFocusMove=!0,asb._inputElement.focus(),asb._processSuggestionChosen(item,e)}var root=_Global.document.createElement("div"),image=new _Global.Image;image.style.opacity=0;var loadImage=function(url){function onload(){image.removeEventListener("load",onload,!1),Animations.fadeIn(image)}image.addEventListener("load",onload,!1),image.src=url};null!==item.image?item.image.openReadAsync().then(function(streamWithContentType){null!==streamWithContentType&&loadImage(_Global.URL.createObjectURL(streamWithContentType,{oneTimeOnly:!0}))}):null!==item.imageUrl&&loadImage(item.imageUrl),image.setAttribute("aria-hidden","true"),root.appendChild(image);var divElement=_Global.document.createElement("div");_ElementUtilities.addClass(divElement,ClassNames.asbSuggestionResultText),addHitHighlightedText(divElement,item,item.text),divElement.title=item.text,divElement.setAttribute("aria-hidden","true"),root.appendChild(divElement);var brElement=_Global.document.createElement("br");divElement.appendChild(brElement);var divDetailElement=_Global.document.createElement("span");_ElementUtilities.addClass(divDetailElement,ClassNames.asbSuggestionResultDetailedText),addHitHighlightedText(divDetailElement,item,item.detailText),divDetailElement.title=item.detailText,divDetailElement.setAttribute("aria-hidden","true"),divElement.appendChild(divDetailElement),_ElementUtilities.addClass(root,ClassNames.asbSuggestionResult),_ElementUtilities._addEventListener(root,"click",function(e){asb._isFlyoutPointerDown||handleInvoke(e)}),_ElementUtilities._addEventListener(root,"pointerup",handleInvoke),root.setAttribute("role","option");var ariaLabel=_Resources._formatString(Strings.ariaLabelResult,item.text,item.detailText);return root.setAttribute("aria-label",ariaLabel),root}function querySuggestionRenderer(asb,item){function handleInvoke(e){asb._internalFocusMove=!0,asb._inputElement.focus(),asb._processSuggestionChosen(item,e)}var root=_Global.document.createElement("div");addHitHighlightedText(root,item,item.text),root.title=item.text,root.classList.add(ClassNames.asbSuggestionQuery),_ElementUtilities._addEventListener(root,"click",function(e){asb._isFlyoutPointerDown||handleInvoke(e)}),_ElementUtilities._addEventListener(root,"pointerup",handleInvoke);var ariaLabel=_Resources._formatString(Strings.ariaLabelQuery,item.text);return root.setAttribute("role","option"),root.setAttribute("aria-label",ariaLabel),root}function separatorSuggestionRenderer(item){var root=_Global.document.createElement("div");if(item.text.length>0){var textElement=_Global.document.createElement("div");textElement.textContent=item.text,textElement.title=item.text,textElement.setAttribute("aria-hidden","true"),root.appendChild(textElement)}root.insertAdjacentHTML("beforeend","<hr/>"),_ElementUtilities.addClass(root,ClassNames.asbSuggestionSeparator),root.setAttribute("role","separator");var ariaLabel=_Resources._formatString(Strings.ariaLabelSeparator,item.text);return root.setAttribute("aria-label",ariaLabel),root}var Key=_ElementUtilities.Key,EventNames={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested"},Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get invalidSuggestionKind(){return"Error: Invalid suggestion kind."},get ariaLabel(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelInputPlaceHolder").value},get ariaLabelQuery(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelQuery").value},get ariaLabelResult(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelResult").value},get ariaLabelSeparator(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelSeparator").value}},AutoSuggestBox=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("div"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.AutoSuggestBox.DuplicateConstruction",Strings.duplicateConstruction);this._suggestionsChangedHandler=this._suggestionsChangedHandler.bind(this),this._suggestionsRequestedHandler=this._suggestionsRequestedHandler.bind(this),this._element=element,element.winControl=this,element.classList.add(ClassNames.asb),element.classList.add("win-disposable"),this._setupDOM(),this._setupSSM(),this._chooseSuggestionOnEnter=!1,this._currentFocusedIndex=-1,this._currentSelectedIndex=-1,this._flyoutOpenPromise=Promise.wrap(),this._lastKeyPressLanguage="",this._prevLinguisticDetails=this._getLinguisticDetails(),this._prevQueryText="",_Control.setOptions(this,options),this._hideFlyout()},{onresultsuggestionchosen:_Events._createEventProperty(EventNames.resultsuggestionchosen),onquerychanged:_Events._createEventProperty(EventNames.querychanged),onquerysubmitted:_Events._createEventProperty(EventNames.querysubmitted),onsuggestionsrequested:_Events._createEventProperty(EventNames.suggestionsrequested),element:{get:function(){return this._element}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(value){this._chooseSuggestionOnEnter=!!value}},disabled:{get:function(){return this._inputElement.disabled},set:function(value){this._inputElement.disabled!==!!value&&(value?this._disableControl():this._enableControl())}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(value){this._inputElement.placeholder=value,this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(value){this._inputElement.value="",this._inputElement.value=value}},searchHistoryDisabled:{get:function(){return!this._suggestionManager.searchHistoryEnabled},set:function(value){this._suggestionManager.searchHistoryEnabled=!value}},searchHistoryContext:{get:function(){return this._suggestionManager.searchHistoryContext},set:function(value){this._suggestionManager.searchHistoryContext=value}},dispose:function(){this._disposed||(this._flyoutOpenPromise.cancel(),this._suggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandler),this._suggestionManager=null,this._suggestions=null,this._hitFinder=null,this._disposed=!0)},setLocalContentSuggestionSettings:function(settings){this._suggestionManager.setLocalContentSuggestionSettings(settings)},_setupDOM:function(){function repeaterTemplate(suggestion){return that._renderSuggestion(suggestion)}var flyoutPointerReleasedHandler=this._flyoutPointerReleasedHandler.bind(this),inputOrImeChangeHandler=this._inputOrImeChangeHandler.bind(this);this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",Strings.ariaLabel),this._element.setAttribute("role","group"),this._inputElement=_Global.document.createElement("input"),this._inputElement.autocorrect="off",this._inputElement.type="search",this._inputElement.classList.add(ClassNames.asbInput),this._inputElement.classList.add("win-textbox"),this._inputElement.setAttribute("role","textbox"),this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this)),this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this)),this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this)),this._inputElement.addEventListener("focus",this._inputFocusHandler.bind(this)),this._inputElement.addEventListener("blur",this._inputBlurHandler.bind(this)),this._inputElement.addEventListener("input",inputOrImeChangeHandler),this._inputElement.addEventListener("compositionstart",inputOrImeChangeHandler),this._inputElement.addEventListener("compositionupdate",inputOrImeChangeHandler),this._inputElement.addEventListener("compositionend",inputOrImeChangeHandler),_ElementUtilities._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this)),this._updateInputElementAriaLabel(),this._element.appendChild(this._inputElement);var context=this._tryGetInputContext();context&&(context.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),context.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this))),this._flyoutElement=_Global.document.createElement("div"),this._flyoutElement.classList.add(ClassNames.asbFlyout),this._flyoutElement.addEventListener("blur",this._flyoutBlurHandler.bind(this)),_ElementUtilities._addEventListener(this._flyoutElement,"pointerup",flyoutPointerReleasedHandler),_ElementUtilities._addEventListener(this._flyoutElement,"pointercancel",flyoutPointerReleasedHandler),_ElementUtilities._addEventListener(this._flyoutElement,"pointerout",flyoutPointerReleasedHandler),_ElementUtilities._addEventListener(this._flyoutElement,"pointerdown",this._flyoutPointerDownHandler.bind(this)),this._element.appendChild(this._flyoutElement);var that=this;this._suggestionsData=new BindingList.List,this._repeaterElement=_Global.document.createElement("div"),this._repeater=new Repeater.Repeater(this._repeaterElement,{data:this._suggestionsData,template:repeaterTemplate}),_ElementUtilities._ensureId(this._repeaterElement),this._repeaterElement.setAttribute("role","listbox"),this._repeaterElement.setAttribute("aria-live","polite"),this._flyoutElement.appendChild(this._repeaterElement)},_setupSSM:function(){this._suggestionManager=new _SuggestionManagerShim._SearchSuggestionManagerShim,this._suggestions=this._suggestionManager.suggestions,this._suggestions.addEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandler)},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutElement.style.display="none")},_showFlyout:function(){var prevNumSuggestions=this._prevNumSuggestions||0;if(this._prevNumSuggestions=this._suggestionsData.length,(!this._isFlyoutShown()||prevNumSuggestions!==this._suggestionsData.length)&&0!==this._suggestionsData.length){this._flyoutElement.style.display="block";var inputRect=this._inputElement.getBoundingClientRect(),flyoutRect=this._flyoutElement.getBoundingClientRect(),documentClientWidth=_Global.document.documentElement.clientWidth,spaceAbove=inputRect.top,spaceBelow=_Global.document.documentElement.clientHeight-inputRect.bottom;this._flyoutBelowInput=spaceBelow>=spaceAbove,this._flyoutBelowInput?(this._flyoutElement.classList.remove(ClassNames.asbFlyoutAbove),this._flyoutElement.scrollTop=0):(this._flyoutElement.classList.add(ClassNames.asbFlyoutAbove),this._flyoutElement.scrollTop=this._flyoutElement.scrollHeight-this._flyoutElement.clientHeight),this._addFlyoutIMEPaddingIfRequired();var alignRight;alignRight="rtl"===_ElementUtilities._getComputedStyle(this._flyoutElement).direction?inputRect.right-flyoutRect.width>=0||inputRect.left+flyoutRect.width>documentClientWidth:inputRect.left+flyoutRect.width>documentClientWidth&&inputRect.right-flyoutRect.width>=0,alignRight?this._flyoutElement.style.left=inputRect.width-flyoutRect.width-this._element.clientLeft+"px":this._flyoutElement.style.left="-"+this._element.clientLeft+"px",this._flyoutElement.style.touchAction=this._flyoutElement.scrollHeight>flyoutRect.height?"pan-y":"none",this._flyoutOpenPromise.cancel();var animationKeyframe=this._flyoutBelowInput?"WinJS-flyoutBelowASB-showPopup":"WinJS-flyoutAboveASB-showPopup";this._flyoutOpenPromise=Animations.showPopup(this._flyoutElement,{top:"0px",left:"0px",keyframe:animationKeyframe})}},_addFlyoutIMEPaddingIfRequired:function(){var context=this._tryGetInputContext();if(context&&this._isFlyoutShown()&&this._flyoutBelowInput){var flyoutRect=this._flyoutElement.getBoundingClientRect(),imeRect=context.getCandidateWindowClientRect(),inputRect=this._inputElement.getBoundingClientRect(),flyoutTop=inputRect.bottom,flyoutBottom=inputRect.bottom+flyoutRect.height;if(!(imeRect.top>flyoutBottom||imeRect.bottom<flyoutTop)){var animation=Animations.createRepositionAnimation(this._flyoutElement);imeRect.width<.45*inputRect.width?this._flyoutElement.style.marginLeft=imeRect.width+"px":this._flyoutElement.style.marginTop=imeRect.bottom-imeRect.top+4+"px",animation.execute()}}},_findNextSuggestionElementIndex:function(curIndex){for(var startIndex=0>curIndex?0:curIndex+1,i=startIndex;i<this._suggestionsData.length;i++)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_findPreviousSuggestionElementIndex:function(curIndex){for(var startIndex=curIndex>=this._suggestionsData.length?this._suggestionsData.length-1:curIndex-1,i=startIndex;i>=0;i--)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_isFlyoutShown:function(){return"none"!==this._flyoutElement.style.display},_isSuggestionSelectable:function(suggestion){return suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Query||suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Result},_processSuggestionChosen:function(item,event){this.queryText=item.text,item.kind===_SuggestionManagerShim._SearchSuggestionKind.Query?this._submitQuery(item.text,!1,event):item.kind===_SuggestionManagerShim._SearchSuggestionKind.Result&&this._fireEvent(EventNames.resultsuggestionchosen,{tag:item.tag,keyModifiers:getKeyModifiers(event),storageFile:null}),this._hideFlyout()},_selectSuggestionAtIndex:function(indexToSelect){function scrollToView(targetElement){var popupHeight=that._flyoutElement.getBoundingClientRect().bottom-that._flyoutElement.getBoundingClientRect().top;if(targetElement.offsetTop+targetElement.offsetHeight>that._flyoutElement.scrollTop+popupHeight){var scrollDifference=targetElement.offsetTop+targetElement.offsetHeight-(that._flyoutElement.scrollTop+popupHeight);_ElementUtilities._zoomTo(that._flyoutElement,{contentX:0,contentY:that._flyoutElement.scrollTop+scrollDifference,viewportX:0,viewportY:0})}else targetElement.offsetTop<that._flyoutElement.scrollTop&&_ElementUtilities._zoomTo(that._flyoutElement,{contentX:0,contentY:targetElement.offsetTop,viewportX:0,viewportY:0})}for(var that=this,curElement=null,i=0;i<this._suggestionsData.length;i++)curElement=this._repeater.elementFromIndex(i),i!==indexToSelect?(curElement.classList.remove(ClassNames.asbSuggestionSelected),curElement.setAttribute("aria-selected","false")):(curElement.classList.add(ClassNames.asbSuggestionSelected),scrollToView(curElement),curElement.setAttribute("aria-selected","true"));this._currentSelectedIndex=indexToSelect,curElement?this._inputElement.setAttribute("aria-activedescendant",this._repeaterElement.id+indexToSelect):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_updateFakeFocus:function(){var firstElementIndex;firstElementIndex=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1,this._selectSuggestionAtIndex(firstElementIndex)},_updateQueryTextWithSuggestionText:function(suggestionIndex){suggestionIndex>=0&&suggestionIndex<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(suggestionIndex).text)},_disableControl:function(){this._isFlyoutShown()&&this._hideFlyout(),this._element.disabled=!0,this._element.classList.add(ClassNames.asbDisabled),this._inputElement.disabled=!0},_enableControl:function(){this._element.disabled=!1,this._element.classList.remove(ClassNames.asbDisabled),this._inputElement.disabled=!1,_Global.document.activeElement===this._element&&_ElementUtilities._setActive(this._inputElement)},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(type,!0,!0,detail),this._element.dispatchEvent(event)},_getLinguisticDetails:function(useCache,createFilled){function createQueryLinguisticDetails(compositionAlternatives,compositionStartOffset,compositionLength,queryTextPrefix,queryTextSuffix){for(var linguisticDetails=null,fullCompositionAlternatives=[],i=0;i<compositionAlternatives.length;i++)fullCompositionAlternatives[i]=queryTextPrefix+compositionAlternatives[i]+queryTextSuffix;if(_WinRT.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails)try{linguisticDetails=new _WinRT.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(fullCompositionAlternatives,compositionStartOffset,compositionLength)}catch(e){}return linguisticDetails||(linguisticDetails={queryTextAlternatives:fullCompositionAlternatives,queryTextCompositionStart:compositionStartOffset,queryTextCompositionLength:compositionLength}),linguisticDetails}var linguisticDetails=null;if(this._inputElement.value===this._prevQueryText&&useCache&&this._prevLinguisticDetails&&createFilled)linguisticDetails=this._prevLinguisticDetails;else{var compositionAlternatives=[],compositionStartOffset=0,compositionLength=0,queryTextPrefix="",queryTextSuffix="";if(createFilled){var context=this._tryGetInputContext();context&&context.getCompositionAlternatives&&(compositionAlternatives=context.getCompositionAlternatives(),compositionStartOffset=context.compositionStartOffset,compositionLength=context.compositionEndOffset-context.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||compositionLength>0?(queryTextPrefix=this._inputElement.value.substring(0,compositionStartOffset),queryTextSuffix=this._inputElement.value.substring(compositionStartOffset+compositionLength)):(queryTextPrefix=this._inputElement.value.substring(0,this._prevCompositionStart),queryTextSuffix=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength)))}linguisticDetails=createQueryLinguisticDetails(compositionAlternatives,compositionStartOffset,compositionLength,queryTextPrefix,queryTextSuffix)}return linguisticDetails},_isElementInSearchControl:function(targetElement){return this.element.contains(targetElement)||this.element===targetElement},_renderSuggestion:function(suggestion){var root=null;if(!suggestion)return root;if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Query)root=querySuggestionRenderer(this,suggestion);else if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Separator)root=separatorSuggestionRenderer(suggestion);else{if(suggestion.kind!==_SuggestionManagerShim._SearchSuggestionKind.Result)throw new _ErrorFromName("WinJS.UI.AutoSuggestBox.invalidSuggestionKind",Strings.invalidSuggestionKind);root=resultSuggestionRenderer(this,suggestion)}return root},_shouldIgnoreInput:function(){var processingIMEFocusLossKey=this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey;return processingIMEFocusLossKey||this._isFlyoutPointerDown},_submitQuery:function(queryText,fillLinguisticDetails,event){this._disposed||(_WinRT.Windows.Globalization.Language&&(this._lastKeyPressLanguage=_WinRT.Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(EventNames.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,fillLinguisticDetails),queryText:queryText,keyModifiers:getKeyModifiers(event)}),this._suggestionManager&&this._suggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_tryGetInputContext:function(){if(this._inputElement.msGetInputContext)try{return this._inputElement.msGetInputContext()}catch(e){return null}return null},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?_Resources._formatString(Strings.ariaLabelInputPlaceHolder,this._inputElement.placeholder):Strings.ariaLabelInputNoPlaceHolder)},_flyoutBlurHandler:function(event){this._isElementInSearchControl(_Global.document.activeElement)?this._internalFocusMove=!0:(this._element.classList.remove(ClassNames.asbInputFocus),this._hideFlyout())},_flyoutPointerDownHandler:function(ev){function findSuggestionElementIndex(){if(srcElement)for(var i=0;i<that._suggestionsData.length;i++)if(that._repeater.elementFromIndex(i)===srcElement)return i;return-1}var that=this,srcElement=ev.target;for(this._isFlyoutPointerDown=!0;srcElement&&srcElement.parentNode!==this._repeaterElement;)srcElement=srcElement.parentNode;var index=findSuggestionElementIndex();index>=0&&index<this._suggestionsData.length&&this._currentFocusedIndex!==index&&this._isSuggestionSelectable(this._suggestionsData.getAt(index))&&(this._currentFocusedIndex=index,this._selectSuggestionAtIndex(index),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)),ev.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var animation=Animations.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",this._flyoutElement.style.marginLeft="",animation.execute()}},_inputBlurHandler:function(event){this._isElementInSearchControl(_Global.document.activeElement)||(this._element.classList.remove(ClassNames.asbInputFocus),this._hideFlyout()),this.queryText=this._prevQueryText,this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1},_inputFocusHandler:function(event){this._inputElement.value!==this._prevQueryText&&_WinRT.Windows.Data.Text.SemanticTextQuery&&(""!==this._inputElement.value?this._hitFinder=new _WinRT.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):this._hitFinder=null),event.target!==this._inputElement||this._internalFocusMove||(this._showFlyout(),-1!==this._currentFocusedIndex?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0))),this._internalFocusMove=!1,this._element.classList.add(ClassNames.asbInputFocus)},_inputOrImeChangeHandler:function(){function hasLinguisticDetailsChanged(newLinguisticDetails){var hasLinguisticDetailsChanged=!1;return(that._prevLinguisticDetails.queryTextCompositionStart!==newLinguisticDetails.queryTextCompositionStart||that._prevLinguisticDetails.queryTextCompositionLength!==newLinguisticDetails.queryTextCompositionLength||that._prevLinguisticDetails.queryTextAlternatives.length!==newLinguisticDetails.queryTextAlternatives.length)&&(hasLinguisticDetailsChanged=!0),that._prevLinguisticDetails=newLinguisticDetails,hasLinguisticDetailsChanged}var that=this;if(!this._shouldIgnoreInput()){var linguisticDetails=this._getLinguisticDetails(!1,!0),hasLinguisticDetailsChanged=hasLinguisticDetailsChanged(linguisticDetails);if((this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||linguisticDetails.queryTextCompositionLength>0)&&(this._prevCompositionStart=linguisticDetails.queryTextCompositionStart,this._prevCompositionLength=linguisticDetails.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!hasLinguisticDetailsChanged)return;this._prevQueryText=this._inputElement.value,_WinRT.Windows.Globalization.Language&&(this._lastKeyPressLanguage=_WinRT.Windows.Globalization.Language.currentInputMethodLanguageTag),_WinRT.Windows.Data.Text.SemanticTextQuery&&(""!==this._inputElement.value?this._hitFinder=new _WinRT.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):this._hitFinder=null),this._fireEvent(EventNames.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:linguisticDetails}),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,linguisticDetails)}},_inputPointerDownHandler:function(){_Global.document.activeElement===this._inputElement&&-1!==this._currentSelectedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_keyDownHandler:function(event){function setSelection(index){that._currentFocusedIndex=index,that._selectSuggestionAtIndex(index),event.preventDefault(),event.stopPropagation()}var that=this;if(this._lastKeyPressLanguage=event.locale,event.keyCode===Key.tab?this._isProcessingTabKey=!0:event.keyCode===Key.upArrow?this._isProcessingUpKey=!0:event.keyCode===Key.downArrow?this._isProcessingDownKey=!0:event.keyCode===Key.enter&&"ko"===event.locale&&(this._isProcessingEnterKey=!0),event.keyCode!==Key.IME)if(event.keyCode===Key.tab){var closeFlyout=!0;event.shiftKey?-1!==this._currentFocusedIndex&&(setSelection(-1),closeFlyout=!1):-1===this._currentFocusedIndex&&(this._currentFocusedIndex=this._flyoutBelowInput?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),-1!==this._currentFocusedIndex&&(setSelection(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),closeFlyout=!1)),closeFlyout&&this._hideFlyout()}else if(event.keyCode===Key.escape)-1!==this._currentFocusedIndex?(this.queryText=this._prevQueryText,setSelection(-1)):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),event.preventDefault(),event.stopPropagation());else if(this._flyoutBelowInput&&event.keyCode===Key.upArrow||!this._flyoutBelowInput&&event.keyCode===Key.downArrow){var prevIndex;-1!==this._currentSelectedIndex?(prevIndex=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),-1===prevIndex&&(this.queryText=this._prevQueryText)):prevIndex=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),setSelection(prevIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else if(this._flyoutBelowInput&&event.keyCode===Key.downArrow||!this._flyoutBelowInput&&event.keyCode===Key.upArrow){var nextIndex=this._findNextSuggestionElementIndex(this._currentSelectedIndex);-1!==this._currentSelectedIndex&&-1===nextIndex&&(this.queryText=this._prevQueryText),setSelection(nextIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else event.keyCode===Key.enter&&(-1===this._currentSelectedIndex?this._submitQuery(this._inputElement.value,!0,event):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),event),this._hideFlyout())},_keyUpHandler:function(event){event.keyCode===Key.tab?this._isProcessingTabKey=!1:event.keyCode===Key.upArrow?this._isProcessingUpKey=!1:event.keyCode===Key.downArrow?this._isProcessingDownKey=!1:event.keyCode===Key.enter&&(this._isProcessingEnterKey=!1)},_keyPressHandler:function(event){this._lastKeyPressLanguage=event.locale},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var animation=Animations.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",this._flyoutElement.style.marginLeft="",animation.execute()}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired(),this._reflowImeOnPointerRelease=!1},_suggestionsChangedHandler:function(event){var collectionChange=event.collectionChange||event.detail.collectionChange,changeIndex=+event.index===event.index?event.index:event.detail.index,ChangeEnum=_SuggestionManagerShim._CollectionChange;if(collectionChange===ChangeEnum.reset)this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length);else if(collectionChange===ChangeEnum.itemInserted){var suggestion=this._suggestions[changeIndex];this._suggestionsData.splice(changeIndex,0,suggestion),this._showFlyout()}else if(collectionChange===ChangeEnum.itemRemoved)1===this._suggestionsData.length&&(_ElementUtilities._setActive(this._inputElement),this._hideFlyout()),this._suggestionsData.splice(changeIndex,1);else if(collectionChange===ChangeEnum.itemChanged){var suggestion=this._suggestions[changeIndex];if(suggestion!==this._suggestionsData.getAt(changeIndex))this._suggestionsData.setAt(changeIndex,suggestion);else{var existingElement=this._repeater.elementFromIndex(changeIndex);if(_ElementUtilities.hasClass(existingElement,ClassNames.asbSuggestionQuery))addHitHighlightedText(existingElement,suggestion,suggestion.text);else{var resultSuggestionDiv=existingElement.querySelector("."+ClassNames.asbSuggestionResultText);if(resultSuggestionDiv){addHitHighlightedText(resultSuggestionDiv,suggestion,suggestion.text);var resultSuggestionDetailDiv=existingElement.querySelector("."+ClassNames.asbSuggestionResultDetailedText);resultSuggestionDetailDiv&&addHitHighlightedText(resultSuggestionDetailDiv,suggestion,suggestion.detailText)}}}}_Global.document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(event){_WinRT.Windows.Globalization.Language&&(this._lastKeyPressLanguage=_WinRT.Windows.Globalization.Language.currentInputMethodLanguageTag);var deferral,request=event.request||event.detail.request;this._fireEvent(EventNames.suggestionsrequested,{setPromise:function(promise){deferral=request.getDeferral(),promise.then(function(){deferral.complete()})},searchSuggestionCollection:request.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})}},{createResultSuggestionImage:function(url){return _WinRT.Windows.Foundation.Uri&&_WinRT.Windows.Storage.Streams.RandomAccessStreamReference?_WinRT.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new _WinRT.Windows.Foundation.Uri(url)):url},_EventNames:EventNames,_sortAndMergeHits:function(hitsProvided){function hitStartPositionAscendingSorter(firstHit,secondHit){var returnValue=0;return firstHit.startPosition<secondHit.startPosition?returnValue=-1:firstHit.startPosition>secondHit.startPosition&&(returnValue=1),returnValue}function hitIntersectionReducer(reducedHits,nextHit,currentIndex){if(0===currentIndex)reducedHits.push(nextHit);else{var curHit=reducedHits[reducedHits.length-1],curHitEndPosition=curHit.startPosition+curHit.length;if(nextHit.startPosition<=curHitEndPosition){var nextHitEndPosition=nextHit.startPosition+nextHit.length;nextHitEndPosition>curHitEndPosition&&(curHit.length=nextHitEndPosition-curHit.startPosition)}else reducedHits.push(nextHit)}return reducedHits}var reducedHits=[];if(hitsProvided){for(var hits=new Array(hitsProvided.length),i=0;i<hitsProvided.length;i++)hits.push({startPosition:hitsProvided[i].startPosition,length:hitsProvided[i].length});hits.sort(hitStartPositionAscendingSorter),hits.reduce(hitIntersectionReducer,reducedHits);
}return reducedHits}});return _Base.Class.mix(AutoSuggestBox,_Control.DOMEventMixin),AutoSuggestBox})}),exports.ClassNames=ClassNames}),define("require-style!less/styles-searchbox",[],function(){}),define("require-style!less/colors-searchbox",[],function(){}),define("WinJS/Controls/SearchBox",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","./AutoSuggestBox","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","./AutoSuggestBox/_SearchSuggestionManagerShim","../Application","require-style!less/styles-searchbox","require-style!less/colors-searchbox"],function(_Global,_WinRT,_Base,_ErrorFromName,_Events,_Resources,AutoSuggestBox,_Accents,_Control,_ElementUtilities,_SuggestionManagerShim,Application){"use strict";_Accents.createAccentRule("html.win-hoverable .win-searchbox-button:not(.win-searchbox-button-disabled):hover",[{name:"color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-searchbox-button.win-searchbox-button:not(.win-searchbox-button-disabled):hover:active",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{SearchBox:_Base.Namespace._lazy(function(){var ClassName={searchBox:"win-searchbox",searchBoxDisabled:"win-searchbox-disabled",searchBoxInput:"win-searchbox-input",searchBoxInputFocus:"win-searchbox-input-focus",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxFlyoutHighlightText:"win-searchbox-flyout-highlighttext",searchBoxHitHighlightSpan:"win-searchbox-hithighlight-span",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionResultText:"win-searchbox-suggestion-result-text",searchBoxSuggestionResultDetailedText:"win-searchbox-suggestion-result-detailed-text",searchBoxSuggestionSelected:"win-searchbox-suggestion-selected",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxButtonInputFocus:"win-searchbox-button-input-focus",searchBoxButtonDisabled:"win-searchbox-button-disabled"},EventName={receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},strings={get invalidSearchBoxSuggestionKind(){return"Error: Invalid search suggestion kind."},get ariaLabel(){return _Resources._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return _Resources._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return _Resources._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value},get searchBoxDeprecated(){return"SearchBox is deprecated and may not be available in future releases. Instead use AutoSuggestBox."}},SearchBox=_Base.Class.derive(AutoSuggestBox.AutoSuggestBox,function(element,options){_ElementUtilities._deprecated(strings.searchBoxDeprecated),this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this),this._buttonElement=_Global.document.createElement("div"),this._focusOnKeyboardInput=!1,AutoSuggestBox.AutoSuggestBox.call(this,element,options),this.element.classList.add(ClassName.searchBox),this._flyoutElement.classList.add(ClassName.searchBoxFlyout),this._inputElement.classList.add(ClassName.searchBoxInput),this._inputElement.addEventListener("blur",this._searchboxInputBlurHandler.bind(this)),this._inputElement.addEventListener("focus",this._searchboxInputFocusHandler.bind(this)),this._buttonElement.tabIndex=-1,this._buttonElement.classList.add(ClassName.searchBoxButton),this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this)),_ElementUtilities._addEventListener(this._buttonElement,"pointerdown",this._buttonPointerDownHandler.bind(this)),this.element.appendChild(this._buttonElement)},{focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(value){this._focusOnKeyboardInput&&!value?Application._applicationListener.removeEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&value&&Application._applicationListener.addEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._focusOnKeyboardInput=!!value}},dispose:function(){this._disposed||(AutoSuggestBox.AutoSuggestBox.prototype.dispose.call(this),this._focusOnKeyboardInput&&Application._applicationListener.removeEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind))},_disableControl:function(){AutoSuggestBox.AutoSuggestBox.prototype._disableControl.call(this),this._buttonElement.disabled=!0,this._buttonElement.classList.add(ClassName.searchBoxButtonDisabled),this.element.classList.add(ClassName.searchBoxDisabled)},_enableControl:function(){AutoSuggestBox.AutoSuggestBox.prototype._enableControl.call(this),this._buttonElement.disabled=!1,this._buttonElement.classList.remove(ClassName.searchBoxButtonDisabled),this.element.classList.remove(ClassName.searchBoxDisabled)},_renderSuggestion:function(suggestion){var render=AutoSuggestBox.AutoSuggestBox.prototype._renderSuggestion.call(this,suggestion);if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Query)render.classList.add(ClassName.searchBoxSuggestionQuery);else if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Separator)render.classList.add(ClassName.searchBoxSuggestionSeparator);else{render.classList.add(ClassName.searchBoxSuggestionResult);var resultText=render.querySelector("."+AutoSuggestBox.ClassNames.asbSuggestionResultText);resultText.classList.add(ClassName.searchBoxSuggestionResultText);var resultDetailText=render.querySelector("."+AutoSuggestBox.ClassNames.asbSuggestionResultDetailedText);resultDetailText.classList.add(ClassName.searchBoxSuggestionResultDetailedText);for(var spans=render.querySelectorAll("."+AutoSuggestBox.ClassNames.asbHitHighlightSpan),i=0,len=spans.length;len>i;i++)spans[i].classList.add(ClassName.searchBoxHitHighlightSpan);for(var highlightTexts=render.querySelectorAll("."+AutoSuggestBox.ClassNames.asbBoxFlyoutHighlightText),i=0,len=highlightTexts.length;len>i;i++)highlightTexts[i].classList.add(ClassName.searchBoxFlyoutHighlightText)}return render},_selectSuggestionAtIndex:function(indexToSelect){AutoSuggestBox.AutoSuggestBox.prototype._selectSuggestionAtIndex.call(this,indexToSelect);var currentSelected=this.element.querySelector("."+ClassName.searchBoxSuggestionSelected);currentSelected&&currentSelected.classList.remove(ClassName.searchBoxSuggestionSelected);var newSelected=this.element.querySelector("."+AutoSuggestBox.ClassNames.asbSuggestionSelected);newSelected&&newSelected.classList.add(ClassName.searchBoxSuggestionSelected)},_shouldIgnoreInput:function(){var shouldIgnore=AutoSuggestBox.AutoSuggestBox.prototype._shouldIgnoreInput(),isButtonDown=_ElementUtilities._matchesSelector(this._buttonElement,":active");return shouldIgnore||isButtonDown},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?_Resources._formatString(strings.ariaLabelInputPlaceHolder,this._inputElement.placeholder):strings.ariaLabelInputNoPlaceHolder)},_buttonPointerDownHandler:function(e){this._inputElement.focus(),e.preventDefault()},_buttonClickHandler:function(event){this._inputElement.focus(),this._submitQuery(this._inputElement.value,!0,event),this._hideFlyout()},_searchboxInputBlurHandler:function(){_ElementUtilities.removeClass(this.element,ClassName.searchBoxInputFocus),_ElementUtilities.removeClass(this._buttonElement,ClassName.searchBoxButtonInputFocus)},_searchboxInputFocusHandler:function(){_ElementUtilities.addClass(this.element,ClassName.searchBoxInputFocus),_ElementUtilities.addClass(this._buttonElement,ClassName.searchBoxButtonInputFocus)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(EventName.receivingfocusonkeyboardinput,null),_Global.document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(e){}}},{createResultSuggestionImage:function(url){return _ElementUtilities._deprecated(strings.searchBoxDeprecated),_WinRT.Windows.Foundation.Uri&&_WinRT.Windows.Storage.Streams.RandomAccessStreamReference?_WinRT.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new _WinRT.Windows.Foundation.Uri(url)):url},_getKeyModifiers:function(ev){var VirtualKeys={ctrlKey:1,altKey:2,shiftKey:4},keyModifiers=0;return ev.ctrlKey&&(keyModifiers|=VirtualKeys.ctrlKey),ev.altKey&&(keyModifiers|=VirtualKeys.altKey),ev.shiftKey&&(keyModifiers|=VirtualKeys.shiftKey),keyModifiers},_isTypeToSearchKey:function(event){return event.shiftKey||event.ctrlKey||event.altKey?!1:!0}});return _Base.Class.mix(SearchBox,_Control.DOMEventMixin),SearchBox})})}),define("WinJS/Controls/SettingsFlyout",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Pages","../Promise","../_LightDismissService","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","./_LegacyAppBar/_Constants","./Flyout/_Overlay"],function(_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,Pages,Promise,_LightDismissService,_Dispose,_ElementUtilities,_ElementListUtilities,_Hoverable,_Constants,_Overlay){"use strict";_Base.Namespace.define("WinJS.UI",{SettingsFlyout:_Base.Namespace._lazy(function(){function _shouldAnimateFromLeft(){if(_WinRT.Windows.UI.ApplicationSettings.SettingsEdgeLocation){var appSettings=_WinRT.Windows.UI.ApplicationSettings;return appSettings.SettingsPane.edge===appSettings.SettingsEdgeLocation.left}return!1}function _getChildSettingsControl(parentElement,id){for(var retValue,control,settingElements=parentElement.querySelectorAll("."+_Constants.settingsFlyoutClass),i=0;i<settingElements.length;i++)if(control=settingElements[i].winControl){if(control.settingsCommandId===id){retValue=control;break}settingElements[i].id===id&&(retValue=retValue||control)}return retValue}var settingsPageIsFocusedOnce,Key=_ElementUtilities.Key,createEvent=_Events._createEventProperty,settingsNarrow="narrow",settingsWide="wide",SettingsFlyout=_Base.Class.derive(_Overlay._Overlay,function(element,options){_ElementUtilities._deprecated(strings.settingsFlyoutIsDeprecated),this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseOverlayConstructor(this._element,options),this._addFirstDiv(),this._addFinalDiv(),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._element.style.visibilty="hidden",this._element.style.display="none",_ElementUtilities.addClass(this._element,_Constants.settingsFlyoutClass);var that=this;this._dismissable=new _LightDismissService.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){that.hide()},onTakeFocus:function(useSetActive){if(!that._dismissable.restoreFocus()){var firstDiv=that.element.querySelector("."+_Constants.firstDivClass);firstDiv&&(firstDiv.msSettingsFlyoutFocusOut||(_ElementUtilities._addEventListener(firstDiv,"focusout",function(){settingsPageIsFocusedOnce=1},!1),firstDiv.msSettingsFlyoutFocusOut=!0),settingsPageIsFocusedOnce=0,_ElementUtilities._tryFocus(firstDiv,useSetActive))}}}),_ElementListUtilities.query("div.win-content",this._element).forEach(function(e){_ElementUtilities._matchesSelector(e,".win-ui-dark, .win-ui-dark *")||_ElementUtilities.addClass(e,_Constants.flyoutLightClass)});var role=this._element.getAttribute("role");(null===role||""===role||void 0===role)&&this._element.setAttribute("role","dialog");var label=this._element.getAttribute("aria-label");(null===label||""===label||void 0===label)&&this._element.setAttribute("aria-label",strings.ariaLabel),this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut,this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(value){_ElementUtilities._deprecated(strings.widthDeprecationMessage),value!==this._width&&(this._width===settingsNarrow?_ElementUtilities.removeClass(this._element,_Constants.narrowClass):this._width===settingsWide&&_ElementUtilities.removeClass(this._element,_Constants.wideClass),this._width=value,this._width===settingsNarrow?_ElementUtilities.addClass(this._element,_Constants.narrowClass):this._width===settingsWide&&_ElementUtilities.addClass(this._element,_Constants.wideClass))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(value){this._settingsCommandId=value}},disabled:{get:function(){return!!this._element.disabled},set:function(value){value=!!value;var oldValue=!!this._element.disabled;oldValue!==value&&(this._element.disabled=value,!this.hidden&&this._element.disabled&&this._dismiss())}},onbeforeshow:createEvent(_Overlay._Overlay.beforeShow),onaftershow:createEvent(_Overlay._Overlay.afterShow),onbeforehide:createEvent(_Overlay._Overlay.beforeHide),onafterhide:createEvent(_Overlay._Overlay.afterHide),show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){_LightDismissService.hidden(this._dismissable),_Dispose.disposeSubTree(this.element),this._dismiss()},_show:function(){if(this._baseShow()){if(!_ElementUtilities.hasClass(this.element.children[0],_Constants.firstDivClass)){var firstDiv=this.element.querySelectorAll("."+_Constants.firstDivClass);firstDiv&&firstDiv.length>0&&firstDiv.item(0).parentNode.removeChild(firstDiv.item(0)),this._addFirstDiv()}if(!_ElementUtilities.hasClass(this.element.children[this.element.children.length-1],_Constants.finalDivClass)){var finalDiv=this.element.querySelectorAll("."+_Constants.finalDivClass);finalDiv&&finalDiv.length>0&&finalDiv.item(0).parentNode.removeChild(finalDiv.item(0)),this._addFinalDiv()}this._setBackButtonsAriaLabel(),_LightDismissService.shown(this._dismissable)}},_setBackButtonsAriaLabel:function(){for(var label,backbuttons=this.element.querySelectorAll(".win-backbutton"),i=0;i<backbuttons.length;i++)label=backbuttons[i].getAttribute("aria-label"),(null===label||""===label||void 0===label)&&backbuttons[i].setAttribute("aria-label",strings.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._baseHide()},_beforeEndHide:function(){_LightDismissService.hidden(this._dismissable)},_animateSlideIn:function(){var animateFromLeft=_shouldAnimateFromLeft(),offset=animateFromLeft?"-100px":"100px";_ElementListUtilities.query("div.win-content",this._element).forEach(function(e){Animations.enterPage(e,{left:offset})});var where,width=this._element.offsetWidth;return animateFromLeft?(where={top:"0px",left:"-"+width+"px"},this._element.style.right="auto",this._element.style.left="0px"):(where={top:"0px",left:width+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",Animations.showPanel(this._element,where)},_animateSlideOut:function(){var where,width=this._element.offsetWidth;return _shouldAnimateFromLeft()?(where={top:"0px",left:width+"px"},this._element.style.right="auto",this._element.style.left="-"+width+"px"):(where={top:"0px",left:"-"+width+"px"},this._element.style.right="-"+width+"px",this._element.style.left="auto"),Animations.showPanel(this._element,where)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(value){this._fragDiv=value}},_unloadPage:function(event){var settingsControl=event.currentTarget.winControl;settingsControl.removeEventListener(_Overlay._Overlay.afterHide,this._unloadPage,!1),Promise.as().then(function(){settingsControl._fragmentDiv&&(_Global.document.body.removeChild(settingsControl._fragmentDiv),settingsControl._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(_Overlay._Overlay.afterHide,this._unloadPage,!1),this._hide()},_handleKeyDown:function(event){if(event.keyCode!==Key.space&&event.keyCode!==Key.enter||this.children[0]!==_Global.document.activeElement){if(event.shiftKey&&event.keyCode===Key.tab&&this.children[0]===_Global.document.activeElement){event.preventDefault(),event.stopPropagation();for(var _elms=this.getElementsByTagName("*"),i=_elms.length-2;i>=0&&(_elms[i].focus(),_elms[i]!==_Global.document.activeElement);i--);}}else event.preventDefault(),event.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var active=_Global.document.activeElement;if(settingsPageIsFocusedOnce&&active&&_ElementUtilities.hasClass(active,_Constants.firstDivClass)){var _elms=this.parentElement.getElementsByTagName("*");if(!(_elms.length<=2)){var i,_highestTabIndex=_elms[_elms.length-1].tabIndex;if(_highestTabIndex){for(i=_elms.length-2;i>0;i--)if(_elms[i].tabIndex===_highestTabIndex){_elms[i].focus();break}}else for(i=_elms.length-2;i>0&&("DIV"===_elms[i].tagName&&null===_elms[i].getAttribute("tabIndex")||(_elms[i].focus(),_elms[i]!==_Global.document.activeElement));i--);}}},_focusOnFirstFocusableElementFromParent:function(){var active=_Global.document.activeElement;if(active&&_ElementUtilities.hasClass(active,_Constants.finalDivClass)){var _elms=this.parentElement.getElementsByTagName("*");if(!(_elms.length<=2)){var i,_lowestTabIndex=_elms[0].tabIndex;if(_lowestTabIndex){for(i=1;i<_elms.length-1;i++)if(_elms[i].tabIndex===_lowestTabIndex){_elms[i].focus();break}}else for(i=1;i<_elms.length-1&&("DIV"===_elms[i].tagName&&null===_elms[i].getAttribute("tabIndex")||(_elms[i].focus(),_elms[i]!==_Global.document.activeElement));i++);}}},_addFirstDiv:function(){for(var _elms=this._element.getElementsByTagName("*"),_minTab=0,i=0;i<_elms.length;i++)0<_elms[i].tabIndex&&(0===_minTab||_elms[i].tabIndex<_minTab)&&(_minTab=_elms[i].tabIndex);var firstDiv=_Global.document.createElement("div");firstDiv.className=_Constants.firstDivClass,firstDiv.style.display="inline",firstDiv.setAttribute("role","menuitem"),firstDiv.setAttribute("aria-hidden","true"),firstDiv.tabIndex=_minTab,_ElementUtilities._addEventListener(firstDiv,"focusin",this._focusOnLastFocusableElementFromParent,!1),this._element.children[0]?this._element.insertBefore(firstDiv,this._element.children[0]):this._element.appendChild(firstDiv)},_addFinalDiv:function(){for(var _elms=this._element.getElementsByTagName("*"),_maxTab=0,i=0;i<_elms.length;i++)_elms[i].tabIndex>_maxTab&&(_maxTab=_elms[i].tabIndex);var finalDiv=_Global.document.createElement("div");finalDiv.className=_Constants.finalDivClass,finalDiv.style.display="inline",finalDiv.setAttribute("role","menuitem"),finalDiv.setAttribute("aria-hidden","true"),finalDiv.tabIndex=_maxTab,_ElementUtilities._addEventListener(finalDiv,"focusin",this._focusOnFirstFocusableElementFromParent,!1),this._element.appendChild(finalDiv)},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.SettingsFlyout:"+this._id+":"+text)}});SettingsFlyout.show=function(){_WinRT.Windows.UI.ApplicationSettings.SettingsPane&&_WinRT.Windows.UI.ApplicationSettings.SettingsPane.show();for(var elements=_Global.document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),len=elements.length,i=0;len>i;i++){var settingsFlyout=elements[i].winControl;settingsFlyout&&settingsFlyout._dismiss()}};var _settingsEvent={event:void 0};SettingsFlyout.populateSettings=function(e){if(_settingsEvent.event=e.detail,_settingsEvent.event.applicationcommands){var n=_WinRT.Windows.UI.ApplicationSettings;Object.keys(_settingsEvent.event.applicationcommands).forEach(function(name){var setting=_settingsEvent.event.applicationcommands[name];setting.title||(setting.title=name);var command=new n.SettingsCommand(name,setting.title,SettingsFlyout._onSettingsCommand);_settingsEvent.event.e.request.applicationCommands.append(command)})}},SettingsFlyout._onSettingsCommand=function(command){var id=command.id;_settingsEvent.event.applicationcommands&&_settingsEvent.event.applicationcommands[id]&&SettingsFlyout.showSettings(id,_settingsEvent.event.applicationcommands[id].href)},SettingsFlyout.showSettings=function(id,path){var control=_getChildSettingsControl(_Global.document,id);if(control)control.show();else{if(!path)throw new _ErrorFromName("WinJS.UI.SettingsFlyout.BadReference",strings.badReference);var divElement=_Global.document.createElement("div");divElement=_Global.document.body.appendChild(divElement),Pages.render(path,divElement).then(function(){control=_getChildSettingsControl(divElement,id),control?(control._fragmentDiv=divElement,control.show()):_Global.document.body.removeChild(divElement)})}};var strings={get ariaLabel(){return _Resources._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return"Invalid argument: Invalid href to settings flyout fragment"},get backbuttonAriaLabel(){return _Resources._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return"SettingsFlyout.width may be altered or unavailable in future versions. Instead, style the CSS width property on elements with the .win-settingsflyout class."},get settingsFlyoutIsDeprecated(){return"SettingsFlyout is deprecated and may not be available in future releases. Instead, put settings on their own page within the app."}};return SettingsFlyout})})}),define("require-style!less/styles-splitviewcommand",[],function(){}),define("require-style!less/colors-splitviewcommand",[],function(){}),define("WinJS/Controls/SplitView/Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Events","../../ControlProcessor","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../AppBar/_Icon","require-style!less/styles-splitviewcommand","require-style!less/colors-splitviewcommand"],function(exports,_Global,_Base,_ErrorFromName,_Events,ControlProcessor,_Control,_ElementUtilities,_KeyboardBehavior,_Icon){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_WinPressed:_Base.Namespace._lazy(function(){var WinPressed=_Base.Class.define(function(element){this._element=element,_ElementUtilities._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(ev){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this)),ev.isPrimary&&(this._pointerId&&this._resetPointer(),_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *")||(this._pointerId=ev.pointerId,_ElementUtilities._addEventListener(_Global,"pointerup",this._pointerUpBound,!0),_ElementUtilities._addEventListener(_Global,"pointercancel",this._pointerCancelBound),!0,_ElementUtilities._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),_ElementUtilities._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),_ElementUtilities.addClass(this._element,WinPressed.winPressed)))},_MSPointerOverHandler:function(ev){this._pointerId===ev.pointerId&&_ElementUtilities.addClass(this._element,WinPressed.winPressed)},_MSPointerOutHandler:function(ev){this._pointerId===ev.pointerId&&_ElementUtilities.removeClass(this._element,WinPressed.winPressed)},_MSPointerCancelHandler:function(ev){this._pointerId===ev.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(ev){this._pointerId===ev.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null,_ElementUtilities._removeEventListener(_Global,"pointerup",this._pointerUpBound,!0),_ElementUtilities._removeEventListener(_Global,"pointercancel",this._pointerCancelBound,!0),_ElementUtilities._removeEventListener(this._element,"pointerover",this._pointerOverBound,!0),_ElementUtilities._removeEventListener(this._element,"pointerout",this._pointerOutBound,!0),_ElementUtilities.removeClass(this._element,WinPressed.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"});return WinPressed}),SplitViewCommand:_Base.Namespace._lazy(function(){var Key=_ElementUtilities.Key,strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClassNames={command:"win-splitviewcommand",commandButton:"win-splitviewcommand-button",commandButtonContent:"win-splitviewcommand-button-content",commandSplitButton:"win-splitviewcommand-splitbutton",commandSplitButtonOpened:"win-splitviewcommand-splitbutton-opened",commandIcon:"win-splitviewcommand-icon",commandLabel:"win-splitviewcommand-label"},EventNames={invoked:"invoked",_splitToggle:"_splittoggle"},createEvent=_Events._createEventProperty,SplitViewCommand=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.SplitViewCommand.DuplicateConstruction",strings.duplicateConstruction);this._winKeyboard=new _KeyboardBehavior._WinKeyboard(element),this._baseConstructor(element,options)},{_baseConstructor:function(element,options,classNames){this._classNames=classNames||ClassNames,element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,this._classNames.command),_ElementUtilities.addClass(this.element,"win-disposable"),this._tooltip=null,this._splitOpened=!1,this._buildDom(),element.addEventListener("keydown",this._keydownHandler.bind(this)),_Control.setOptions(this,options)},element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(value){this._label=value,this._labelEl.textContent=value}},tooltip:{get:function(){return this._tooltip},set:function(value){this._tooltip=value,this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")}},icon:{get:function(){return this._icon},set:function(value){this._icon=_Icon[value]||value,this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},oninvoked:createEvent(EventNames.invoked),_toggleSplit:function(){this._splitOpened=!this._splitOpened,this._splitOpened?(_ElementUtilities.addClass(this._splitButtonEl,this._classNames.commandSplitButtonOpened),this._splitButtonEl.setAttribute("aria-expanded","true")):(_ElementUtilities.removeClass(this._splitButtonEl,this._classNames.commandSplitButtonOpened),this._splitButtonEl.setAttribute("aria-expanded","false")),this._fireEvent(SplitViewCommand._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===_ElementUtilities._getComputedStyle(this.element).direction}},_keydownHandler:function(ev){if(!_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *")){var leftStr=this._rtl?Key.rightArrow:Key.leftArrow,rightStr=this._rtl?Key.leftArrow:Key.rightArrow;ev.altKey||ev.keyCode!==leftStr&&ev.keyCode!==Key.home&&ev.keyCode!==Key.end||ev.target!==this._splitButtonEl?ev.altKey||ev.keyCode!==rightStr||!this.splitButton||ev.target!==this._buttonEl&&!this._buttonEl.contains(ev.target)?ev.keyCode!==Key.space&&ev.keyCode!==Key.enter||ev.target!==this._buttonEl&&!this._buttonEl.contains(ev.target)?ev.keyCode!==Key.space&&ev.keyCode!==Key.enter||ev.target!==this._splitButtonEl||this._toggleSplit():this._invoke():(_ElementUtilities._setActive(this._splitButtonEl),ev.keyCode===rightStr&&ev.stopPropagation(),ev.preventDefault()):(_ElementUtilities._setActive(this._buttonEl),ev.keyCode===leftStr&&ev.stopPropagation(),ev.preventDefault())}},_getFocusInto:function(keyCode){var leftStr=this._rtl?Key.rightArrow:Key.leftArrow;return keyCode===leftStr&&this.splitButton?this._splitButtonEl:this._buttonEl},_buildDom:function(){var markup='<div tabindex="0" role="button" class="'+this._classNames.commandButton+'"><div class="'+this._classNames.commandButtonContent+'"><div class="'+this._classNames.commandIcon+'"></div><div class="'+this._classNames.commandLabel+'"></div></div></div><div tabindex="-1" aria-expanded="false" class="'+this._classNames.commandSplitButton+'"></div>';this.element.insertAdjacentHTML("afterBegin",markup),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new exports._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new exports._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",_ElementUtilities._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this));var mutationObserver=new _ElementUtilities._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this));mutationObserver.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this));for(var tempEl=this._splitButtonEl.nextSibling;tempEl;)this._buttonEl.insertBefore(tempEl,this._contentEl),"#text"!==tempEl.nodeName&&ControlProcessor.processAll(tempEl),tempEl=this._splitButtonEl.nextSibling},_handleButtonClick:function(ev){var srcElement=ev.target;_ElementUtilities._matchesSelector(srcElement,".win-interactive, .win-interactive *")||this._invoke()},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_invoke:function(){this._fireEvent(SplitViewCommand._EventName.invoked)},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(type,!0,!1,detail),this.element.dispatchEvent(event)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:ClassNames,_EventName:EventNames});return _Base.Class.mix(SplitViewCommand,_Control.DOMEventMixin),SplitViewCommand})})}),define("WinJS/Controls/NavBar/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Navigation","../../Utilities/_ElementUtilities","../SplitView/Command"],function(exports,_Global,_Base,_ErrorFromName,Navigation,_ElementUtilities,SplitViewCommand){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{NavBarCommand:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarCommandDeprecated(){return"NavBarCommand is deprecated and may not be available in future releases. If you were using a NavBarCommand inside of a SplitView, use SplitViewCommand instead."}},ClassNames={command:"win-navbarcommand",commandButton:"win-navbarcommand-button",commandButtonContent:"win-navbarcommand-button-content",commandSplitButton:"win-navbarcommand-splitbutton",commandSplitButtonOpened:"win-navbarcommand-splitbutton-opened",commandIcon:"win-navbarcommand-icon",
commandLabel:"win-navbarcommand-label"},superClass=SplitViewCommand.SplitViewCommand.prototype,NavBarCommand=_Base.Class.derive(SplitViewCommand.SplitViewCommand,function(element,options){if(_ElementUtilities._deprecated(strings.navBarCommandDeprecated),element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.NavBarCommand.DuplicateConstruction",strings.duplicateConstruction);this._baseConstructor(element,options,ClassNames)},{element:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"element").get.call(this)}},label:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"label").get.call(this)},set:function(value){return Object.getOwnPropertyDescriptor(superClass,"label").set.call(this,value)}},tooltip:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"tooltip").get.call(this)},set:function(value){return Object.getOwnPropertyDescriptor(superClass,"tooltip").set.call(this,value)}},icon:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"icon").get.call(this)},set:function(value){return Object.getOwnPropertyDescriptor(superClass,"icon").set.call(this,value)}},location:{get:function(){return this._location},set:function(value){this._location=value}},oninvoked:{get:function(){},enumerable:!1},state:{get:function(){return this._state},set:function(value){this._state=value}},splitButton:{get:function(){return this._split},set:function(value){this._split=value,this._split?this._splitButtonEl.style.display="":this._splitButtonEl.style.display="none"}},splitOpened:{get:function(){return this._splitOpened},set:function(value){this._splitOpened!==!!value&&this._toggleSplit()}},dispose:function(){superClass.dispose.call(this)},_invoke:function(){this.location&&Navigation.navigate(this.location,this.state),this._fireEvent(NavBarCommand._EventName._invoked)}},{_ClassName:ClassNames,_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return NavBarCommand})})}),define("WinJS/Controls/NavBar/_Container",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../BindingList","../../ControlProcessor","../../Navigation","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UI","../_LegacyAppBar/_Constants","../Repeater","./_Command"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Animations,_TransitionAnimation,BindingList,ControlProcessor,Navigation,Promise,Scheduler,_Control,_ElementUtilities,_KeyboardBehavior,_UI,_Constants,Repeater,NavBarCommand){"use strict";function nobodyHasFocus(){return null===_Global.document.activeElement||_Global.document.activeElement===_Global.document.body}_Base.Namespace._moduleDefine(exports,"WinJS.UI",{NavBarContainer:_Base.Namespace._lazy(function(){var Key=_ElementUtilities.Key,buttonFadeDelay=3e3,PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",MS_MANIPULATION_STATE_STOPPED=0,createEvent=_Events._createEventProperty,eventNames={invoked:"invoked",splittoggle:"splittoggle"},strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarContainerViewportAriaLabel(){return _Resources._getWinJSString("ui/navBarContainerViewportAriaLabel").value},get navBarContainerIsDeprecated(){return"NavBarContainer is deprecated and may not be available in future releases. Instead, use a WinJS SplitView to display navigation targets within the app."}},NavBarContainer=_Base.Class.define(function(element,options){if(_ElementUtilities._deprecated(strings.navBarContainerIsDeprecated),element=element||_Global.document.createElement("DIV"),this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.NavBarContainer.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,NavBarContainer._ClassName.navbarcontainer),_ElementUtilities.addClass(this.element,"win-disposable"),element.getAttribute("tabIndex")||(element.tabIndex=-1),this._focusCurrentItemPassivelyBound=this._focusCurrentItemPassively.bind(this),this._closeSplitAndResetBound=this._closeSplitAndReset.bind(this),this._currentManipulationState=MS_MANIPULATION_STATE_STOPPED,this._panningDisabled=!_ElementUtilities._supportsSnapPoints,this._fixedSize=!1,this._maxRows=1,this._sizes={},this._setupTree(),this._duringConstructor=!0,this._dataChangingBound=this._dataChanging.bind(this),this._dataChangedBound=this._dataChanged.bind(this),Navigation.addEventListener("navigated",this._closeSplitAndResetBound),this.layout=options.layout||_UI.Orientation.horizontal,options.maxRows&&(this.maxRows=options.maxRows),options.template&&(this.template=options.template),options.data&&(this.data=options.data),options.fixedSize&&(this.fixedSize=options.fixedSize),_Control._setOptions(this,options,!0),this._duringConstructor=!1,options.currentIndex&&(this.currentIndex=options.currentIndex),this._updatePageUI(),Scheduler.schedule(function(){this._updateAppBarReference()},Scheduler.Priority.normal,this,"WinJS.UI.NavBarContainer_async_initialize"),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(value){if(this._template=value,this._repeater){var hadFocus=this.element.contains(_Global.document.activeElement);this._duringConstructor||this._closeSplitIfOpen(),this._repeater.template=this._repeater.template,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),hadFocus&&this._keyboardBehavior._focus(0))}}},_render:function(item){var navbarCommandEl=_Global.document.createElement("div"),template=this._template;template&&(template.render?template.render(item,navbarCommandEl):template.winControl&&template.winControl.render?template.winControl.render(item,navbarCommandEl):navbarCommandEl.appendChild(template(item)));var navbarCommand=new NavBarCommand.NavBarCommand(navbarCommandEl,item);return navbarCommand._element},data:{get:function(){return this._repeater&&this._repeater.data},set:function(value){value||(value=new BindingList.List),this._duringConstructor||this._closeSplitIfOpen(),this._removeDataChangingEvents(),this._removeDataChangedEvents();var hadFocus=this.element.contains(_Global.document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new Repeater.Repeater(this._surfaceEl,{template:this._render.bind(this)})),this._addDataChangingEvents(value),this._repeater.data=value,this._addDataChangedEvents(value),this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),hadFocus&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(value){value=+value===value?value:1,this._maxRows=Math.max(1,value),this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(value){value===_UI.Orientation.vertical?(this._layout=_UI.Orientation.vertical,_ElementUtilities.removeClass(this.element,NavBarContainer._ClassName.horizontal),_ElementUtilities.addClass(this.element,NavBarContainer._ClassName.vertical)):(this._layout=_UI.Orientation.horizontal,_ElementUtilities.removeClass(this.element,NavBarContainer._ClassName.vertical),_ElementUtilities.addClass(this.element,NavBarContainer._ClassName.horizontal)),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(value){if(value===+value){var hadFocus=this.element.contains(_Global.document.activeElement);this._keyboardBehavior.currentIndex=value,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),hadFocus&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(value){this._fixedSize=!!value,this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:createEvent(eventNames.invoked),onsplittoggle:createEvent(eventNames.splittoggle),forceLayout:function(){this._resizeHandler(),this._measured&&(this._scrollPosition=_ElementUtilities.getScrollPosition(this._viewportEl)[this.layout===_UI.Orientation.horizontal?"scrollLeft":"scrollTop"]),this._duringForceLayout=!0,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._duringForceLayout=!1},_updateAppBarReference:function(){if(!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&(this._appBarEl.removeEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound),this._appBarEl.removeEventListener("afteropen",this._focusCurrentItemPassivelyBound));for(var appBarEl=this.element.parentNode;appBarEl&&!_ElementUtilities.hasClass(appBarEl,_Constants.appBarClass);)appBarEl=appBarEl.parentNode;this._appBarEl=appBarEl,this._appBarEl&&(this._appBarEl.addEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.addEventListener("afteropen",this._focusCurrentItemPassivelyBound))}},_closeSplitAndReset:function(){this._closeSplitIfOpen(),this._reset()},_dataChanging:function(ev){this._elementHadFocus=_Global.document.activeElement,this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===ev.type?this._surfaceEl.children[ev.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===ev.type?this._surfaceEl.children[ev.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===ev.type?this._surfaceEl.children[ev.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===ev.type&&this._closeSplitIfOpen())},_dataChanged:function(ev){this._measured=!1,"itemremoved"===ev.type?ev.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:ev.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===ev.type?ev.detail.index===this._keyboardBehavior.currentIndex&&nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===ev.type?ev.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===ev.type?ev.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=ev.detail.newIndex,nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===ev.type&&(this._keyboardBehavior.currentIndex=0,nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus()),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI()},_focusCurrentItemPassively:function(){this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus()},_reset:function(){this._keyboardBehavior.currentIndex=0,this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus(0),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._ensureVisible(0,!0),this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(bindingList){bindingList.addEventListener("itemchanged",this._dataChangingBound),bindingList.addEventListener("iteminserted",this._dataChangingBound),bindingList.addEventListener("itemmoved",this._dataChangingBound),bindingList.addEventListener("itemremoved",this._dataChangingBound),bindingList.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(ev){ev.pointerType===PT_TOUCH&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(ev){ev.pointerType!==PT_TOUCH&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=Promise.wrap(),this._element.addEventListener("mouseleave",this._mouseleave.bind(this)),_ElementUtilities._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this)),_ElementUtilities._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this)),_ElementUtilities._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1),this._pageindicatorsEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._pageindicatorsEl,NavBarContainer._ClassName.pageindicators),this._element.appendChild(this._pageindicatorsEl),this._ariaStartMarker=_Global.document.createElement("div"),this._element.appendChild(this._ariaStartMarker),this._viewportEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._viewportEl,NavBarContainer._ClassName.viewport),this._element.appendChild(this._viewportEl),this._viewportEl.setAttribute("role","group"),this._viewportEl.setAttribute("aria-label",strings.navBarContainerViewportAriaLabel),this._boundResizeHandler=this._resizeHandler.bind(this),_ElementUtilities._resizeNotifier.subscribe(this._element,this._boundResizeHandler),this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),this._ariaEndMarker=_Global.document.createElement("div"),this._element.appendChild(this._ariaEndMarker),this._surfaceEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._surfaceEl,NavBarContainer._ClassName.surface),this._viewportEl.appendChild(this._surfaceEl),this._surfaceEl.addEventListener(NavBarCommand.NavBarCommand._EventName._invoked,this._navbarCommandInvokedHandler.bind(this)),this._surfaceEl.addEventListener(NavBarCommand.NavBarCommand._EventName._splitToggle,this._navbarCommandSplitToggleHandler.bind(this)),_ElementUtilities._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1),this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var tempEl=this.element.firstElementChild;tempEl!==this._pageindicatorsEl;)this._surfaceEl.appendChild(tempEl),ControlProcessor.process(tempEl),tempEl=this.element.firstElementChild;this._leftArrowEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._leftArrowEl,NavBarContainer._ClassName.navleftarrow),_ElementUtilities.addClass(this._leftArrowEl,NavBarContainer._ClassName.navarrow),this._element.appendChild(this._leftArrowEl),this._leftArrowEl.addEventListener("click",this._goLeft.bind(this)),this._leftArrowEl.style.opacity=0,this._leftArrowEl.style.visibility="hidden",this._leftArrowFadeOut=Promise.wrap(),this._rightArrowEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._rightArrowEl,NavBarContainer._ClassName.navrightarrow),_ElementUtilities.addClass(this._rightArrowEl,NavBarContainer._ClassName.navarrow),this._element.appendChild(this._rightArrowEl),this._rightArrowEl.addEventListener("click",this._goRight.bind(this)),this._rightArrowEl.style.opacity=0,this._rightArrowEl.style.visibility="hidden",this._rightArrowFadeOut=Promise.wrap(),this._keyboardBehavior=new _KeyboardBehavior._KeyboardBehavior(this._surfaceEl,{scroller:this._viewportEl}),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var itemsPerPage=this._sizes.rowsPerPage*this._sizes.columnsPerPage,targetPage=Math.min(Math.floor(this._keyboardBehavior.currentIndex/itemsPerPage)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(itemsPerPage*targetPage,this._surfaceEl.children.length),this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var itemsPerPage=this._sizes.rowsPerPage*this._sizes.columnsPerPage,targetPage=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/itemsPerPage)-1);this._keyboardBehavior.currentIndex=Math.max(itemsPerPage*targetPage,0),this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===_UI.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured){var viewportResized=this.layout===_UI.Orientation.horizontal?this._sizes.viewportOffsetWidth!==parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).width):this._sizes.viewportOffsetHeight!==parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).height);viewportResized&&(this._measured=!1,this._pendingResize||(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),this._updateAppBarReference(),this._appBarEl&&this._appBarEl.winControl&&!this._appBarEl.winControl.opened?(Scheduler.schedule(this._resizeImplBound,Scheduler.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeopen",this._resizeImplBound)):this._resizeImpl()))}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(ev){var keyCode=ev.keyCode;if(!ev.altKey&&(keyCode===Key.pageUp||keyCode===Key.pageDown)){var srcElement=ev.target;if(_ElementUtilities._matchesSelector(srcElement,".win-interactive, .win-interactive *"))return;var index=this._keyboardBehavior.currentIndex;this._measure();var sizes=this._sizes,page=Math.floor(index/(sizes.columnsPerPage*sizes.rowsPerPage)),scrollPositionTarget=null;if(keyCode===Key.pageUp){if(this.layout===_UI.Orientation.horizontal){var indexOfFirstItemOnPage=page*sizes.columnsPerPage*sizes.rowsPerPage;index===indexOfFirstItemOnPage&&this._surfaceEl.children[index].winControl._buttonEl===_Global.document.activeElement?index-=sizes.columnsPerPage*sizes.rowsPerPage:index=indexOfFirstItemOnPage}else{var currentItem=this._surfaceEl.children[index],top=currentItem.offsetTop,bottom=top+currentItem.offsetHeight,scrollPosition=this._zooming?this._zoomPosition:this._scrollPosition;if(top>=scrollPosition&&bottom<scrollPosition+sizes.viewportOffsetHeight)for(;index>0&&this._surfaceEl.children[index-1].offsetTop>scrollPosition;)index--;if(this._keyboardBehavior.currentIndex===index){var scrollPositionForOnePageAboveItem=bottom-sizes.viewportOffsetHeight;for(index=Math.max(0,index-1);index>0&&this._surfaceEl.children[index-1].offsetTop>scrollPositionForOnePageAboveItem;)index--;scrollPositionTarget=index>0?this._surfaceEl.children[index].offsetTop-this._sizes.itemMarginTop:0}}index=Math.max(index,0),this._keyboardBehavior.currentIndex=index;var element=this._surfaceEl.children[index].winControl._buttonEl;null!==scrollPositionTarget&&this._scrollTo(scrollPositionTarget),_ElementUtilities._setActive(element,this._viewportEl)}else{if(this.layout===_UI.Orientation.horizontal){var indexOfLastItemOnPage=(page+1)*sizes.columnsPerPage*sizes.rowsPerPage-1;index===indexOfLastItemOnPage?index+=sizes.columnsPerPage*sizes.rowsPerPage:index=indexOfLastItemOnPage}else{var currentItem=this._surfaceEl.children[this._keyboardBehavior.currentIndex],top=currentItem.offsetTop,bottom=top+currentItem.offsetHeight,scrollPosition=this._zooming?this._zoomPosition:this._scrollPosition;if(top>=scrollPosition&&bottom<scrollPosition+sizes.viewportOffsetHeight)for(;index<this._surfaceEl.children.length-1&&this._surfaceEl.children[index+1].offsetTop+this._surfaceEl.children[index+1].offsetHeight<scrollPosition+sizes.viewportOffsetHeight;)index++;if(index===this._keyboardBehavior.currentIndex){var scrollPositionForOnePageBelowItem=top+sizes.viewportOffsetHeight;for(index=Math.min(this._surfaceEl.children.length-1,index+1);index<this._surfaceEl.children.length-1&&this._surfaceEl.children[index+1].offsetTop+this._surfaceEl.children[index+1].offsetHeight<scrollPositionForOnePageBelowItem;)index++;scrollPositionTarget=index<this._surfaceEl.children.length-1?this._surfaceEl.children[index+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}index=Math.min(index,this._surfaceEl.children.length-1),this._keyboardBehavior.currentIndex=index;var element=this._surfaceEl.children[index].winControl._buttonEl;null!==scrollPositionTarget&&this._scrollTo(scrollPositionTarget);try{_ElementUtilities._setActive(element,this._viewportEl)}catch(e){}}}},_focusHandler:function(ev){var srcElement=ev.target;this._surfaceEl.contains(srcElement)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(ev){var srcElement=ev.target;if(srcElement!==this._surfaceEl){for(;srcElement.parentNode!==this._surfaceEl;)srcElement=srcElement.parentNode;for(var index=-1;srcElement;)index++,srcElement=srcElement.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(index)}},_ensureVisible:function(index,withoutAnimation){if(this._measure(),this.layout===_UI.Orientation.horizontal){var page=Math.floor(index/(this._sizes.rowsPerPage*this._sizes.columnsPerPage));this._scrollTo(page*this._sizes.viewportOffsetWidth,withoutAnimation)}else{var maxScrollPosition,element=this._surfaceEl.children[index];maxScrollPosition=index>0?element.offsetTop-this._sizes.itemMarginTop:0;var minScrollPosition;minScrollPosition=index<this._surfaceEl.children.length-1?this._surfaceEl.children[index+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight;var newScrollPosition=this._zooming?this._zoomPosition:this._scrollPosition;newScrollPosition=Math.max(newScrollPosition,minScrollPosition),newScrollPosition=Math.min(newScrollPosition,maxScrollPosition),this._scrollTo(newScrollPosition,withoutAnimation)}},_scrollTo:function(targetScrollPosition,withoutAnimation){if(this._measure(),targetScrollPosition=this.layout===_UI.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,targetScrollPosition)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,targetScrollPosition)),withoutAnimation){if(Math.abs(this._scrollPosition-targetScrollPosition)>1){this._zooming=!1,this._scrollPosition=targetScrollPosition,this._updatePageUI(),this._duringForceLayout||this._closeSplitIfOpen();var newScrollPos={};newScrollPos[this.layout===_UI.Orientation.horizontal?"scrollLeft":"scrollTop"]=targetScrollPosition,_ElementUtilities.setScrollPosition(this._viewportEl,newScrollPos)}}else(!this._zooming&&Math.abs(this._scrollPosition-targetScrollPosition)>1||this._zooming&&Math.abs(this._zoomPosition-targetScrollPosition)>1)&&(this._zoomPosition=targetScrollPosition,this._zooming=!0,this.layout===_UI.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",_ElementUtilities._zoomTo(this._viewportEl,{contentX:targetScrollPosition,contentY:0,viewportX:0,viewportY:0})):_ElementUtilities._zoomTo(this._viewportEl,{contentX:0,contentY:targetScrollPosition,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(e){this._currentManipulationState=e.currentState,e.currentState===e.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1),_Global.clearTimeout(this._manipulationStateTimeoutId),e.currentState===e.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=_Global.setTimeout(function(){this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(!this._disposed&&(this._measured=!1,!this._checkingScroll)){var that=this;this._checkingScroll=_BaseUtils._requestAnimationFrame(function(){if(!that._disposed){that._checkingScroll=null;var newScrollPosition=_ElementUtilities.getScrollPosition(that._viewportEl)[that.layout===_UI.Orientation.horizontal?"scrollLeft":"scrollTop"];newScrollPosition!==that._scrollPosition&&(that._scrollPosition=newScrollPosition,that._closeSplitIfOpen()),that._updatePageUI(),that._zooming||that._currentManipulationState!==MS_MANIPULATION_STATE_STOPPED||that._updateCurrentIndexIfPageChanged()}})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===_UI.Orientation.horizontal){this._measure();var currentPage=this._currentPage,firstIndexOnPage=currentPage*this._sizes.rowsPerPage*this._sizes.columnsPerPage,lastIndexOnPage=(currentPage+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<firstIndexOnPage||this._keyboardBehavior.currentIndex>lastIndexOnPage)&&(this._keyboardBehavior.currentIndex=firstIndexOnPage,this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){if(!this._measured){this._resizeImpl(),this._writeProfilerMark("measure,StartTM");var sizes=this._sizes;sizes.rtl="rtl"===_ElementUtilities._getComputedStyle(this._element).direction;var itemCount=this._surfaceEl.children.length;if(itemCount>0){if(!this._sizes.itemMeasured){this._writeProfilerMark("measureItem,StartTM");var elementToMeasure=this._surfaceEl.firstElementChild;elementToMeasure.style.margin="",elementToMeasure.style.width="";var elementComputedStyle=_ElementUtilities._getComputedStyle(elementToMeasure);sizes.itemOffsetWidth=parseFloat(_ElementUtilities._getComputedStyle(elementToMeasure).width),0===elementToMeasure.offsetWidth&&(sizes.itemOffsetWidth=0),sizes.itemMarginLeft=parseFloat(elementComputedStyle.marginLeft),sizes.itemMarginRight=parseFloat(elementComputedStyle.marginRight),sizes.itemWidth=sizes.itemOffsetWidth+sizes.itemMarginLeft+sizes.itemMarginRight,sizes.itemOffsetHeight=parseFloat(_ElementUtilities._getComputedStyle(elementToMeasure).height),0===elementToMeasure.offsetHeight&&(sizes.itemOffsetHeight=0),sizes.itemMarginTop=parseFloat(elementComputedStyle.marginTop),sizes.itemMarginBottom=parseFloat(elementComputedStyle.marginBottom),sizes.itemHeight=sizes.itemOffsetHeight+sizes.itemMarginTop+sizes.itemMarginBottom,sizes.itemOffsetWidth>0&&sizes.itemOffsetHeight>0&&(sizes.itemMeasured=!0),this._writeProfilerMark("measureItem,StopTM")}if(sizes.viewportOffsetWidth=parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(sizes.viewportOffsetWidth=0),sizes.viewportOffsetHeight=parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(sizes.viewportOffsetHeight=0),0===sizes.viewportOffsetWidth||0===sizes.itemOffsetHeight?this._measured=!1:this._measured=!0,this.layout===_UI.Orientation.horizontal){this._scrollPosition=_ElementUtilities.getScrollPosition(this._viewportEl).scrollLeft,sizes.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(_ElementUtilities._getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(_ElementUtilities._getComputedStyle(this._leftArrowEl).marginRight);var usableSpace=sizes.viewportOffsetWidth-2*sizes.leadingEdge;sizes.maxColumns=sizes.itemWidth?Math.max(1,Math.floor(usableSpace/sizes.itemWidth)):1,sizes.rowsPerPage=Math.min(this.maxRows,Math.ceil(itemCount/sizes.maxColumns)),sizes.columnsPerPage=Math.min(sizes.maxColumns,itemCount),sizes.pages=Math.ceil(itemCount/(sizes.columnsPerPage*sizes.rowsPerPage)),sizes.trailingEdge=sizes.leadingEdge,sizes.extraSpace=usableSpace-sizes.columnsPerPage*sizes.itemWidth,this._scrollLength=sizes.viewportOffsetWidth*sizes.pages,this._keyboardBehavior.fixedSize=sizes.rowsPerPage,this._keyboardBehavior.fixedDirection=_KeyboardBehavior._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=sizes.itemHeight*sizes.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"}else this._scrollPosition=this._viewportEl.scrollTop,sizes.leadingEdge=0,sizes.rowsPerPage=itemCount,sizes.columnsPerPage=1,sizes.pages=1,sizes.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=sizes.columnsPerPage,this._keyboardBehavior.fixedDirection=_KeyboardBehavior._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._updateGridStyles()}else sizes.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._writeProfilerMark("measure,StopTM")}},_updateGridStyles:function(){for(var sizes=this._sizes,itemCount=this._surfaceEl.children.length,index=0;itemCount>index;index++){var marginRight,marginLeft,itemEl=this._surfaceEl.children[index],width="";if(this.layout===_UI.Orientation.horizontal){var column=Math.floor(index/sizes.rowsPerPage),isFirstColumnOnPage=column%sizes.columnsPerPage===0,isLastColumnOnPage=column%sizes.columnsPerPage===sizes.columnsPerPage-1,extraTrailingMargin=sizes.trailingEdge;if(this.fixedSize)extraTrailingMargin+=sizes.extraSpace;else{var spaceToDistribute=sizes.extraSpace-(sizes.maxColumns-sizes.columnsPerPage)*sizes.itemWidth;width=sizes.itemOffsetWidth+spaceToDistribute/sizes.maxColumns+"px"}var extraMarginRight,extraMarginLeft;sizes.rtl?(extraMarginRight=isFirstColumnOnPage?sizes.leadingEdge:0,extraMarginLeft=isLastColumnOnPage?extraTrailingMargin:0):(extraMarginRight=isLastColumnOnPage?extraTrailingMargin:0,extraMarginLeft=isFirstColumnOnPage?sizes.leadingEdge:0),marginRight=extraMarginRight+sizes.itemMarginRight+"px",marginLeft=extraMarginLeft+sizes.itemMarginLeft+"px"}else marginRight="",marginLeft="";itemEl.style.marginRight!==marginRight&&(itemEl.style.marginRight=marginRight),itemEl.style.marginLeft!==marginLeft&&(itemEl.style.marginLeft=marginLeft),
itemEl.style.width!==width&&(itemEl.style.width=width)}},_updatePageUI:function(){this._measure();var currentPage=this._currentPage;this._hasPreviousContent=0!==currentPage,this._hasNextContent=currentPage<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+NavBarContainer._ClassName.indicator+'"></span>'));for(var i=0;i<this._pageindicatorsEl.children.length;i++)i===currentPage?_ElementUtilities.addClass(this._pageindicatorsEl.children[i],NavBarContainer._ClassName.currentindicator):_ElementUtilities.removeClass(this._pageindicatorsEl.children[i],NavBarContainer._ClassName.currentindicator);if(this._sizes.pages>1?(this._viewportEl.style.overflowX=this._panningDisabled?"hidden":"",this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==_UI.Orientation.horizontal)this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom");else{var firstIndexOnCurrentPage=currentPage*this._sizes.rowsPerPage*this._sizes.columnsPerPage,firstItem=this._surfaceEl.children[firstIndexOnCurrentPage].winControl._buttonEl;_ElementUtilities._ensureId(firstItem),this._ariaStartMarker.setAttribute("aria-flowto",firstItem.id);var lastIndexOnCurrentPage=Math.min(this._surfaceEl.children.length-1,(currentPage+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),lastItem=this._surfaceEl.children[lastIndexOnCurrentPage].winControl._buttonEl;_ElementUtilities._ensureId(lastItem),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",lastItem.id)}},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var hasLeftContent=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,hasRightContent=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,that=this;(this._mouseInViewport||this._panningDisabled)&&hasLeftContent?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||Animations.fadeIn(this._leftArrowEl)):(hasLeftContent?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||Promise.timeout(_TransitionAnimation._animationTimeAdjustment(buttonFadeDelay)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=Promise.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._leftArrowFadeIn=null,this._leftArrowFadeOut=this._leftArrowFadeOut||Animations.fadeOut(this._leftArrowEl).then(function(){that._leftArrowEl.style.visibility="hidden"})}.bind(this))),(this._mouseInViewport||this._panningDisabled)&&hasRightContent?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||Animations.fadeIn(this._rightArrowEl)):(hasRightContent?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||Promise.timeout(_TransitionAnimation._animationTimeAdjustment(buttonFadeDelay)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=Promise.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),this._rightArrowFadeIn=null,this._rightArrowFadeOut=this._rightArrowFadeOut||Animations.fadeOut(this._rightArrowEl).then(function(){that._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(ev){for(var srcElement=ev.target,index=-1;srcElement;)index++,srcElement=srcElement.previousSibling;this._fireEvent(NavBarContainer._EventName.invoked,{index:index,navbarCommand:ev.target.winControl,data:this._repeater?this._repeater.data.getAt(index):null})},_navbarCommandSplitToggleHandler:function(ev){for(var srcElement=ev.target,index=-1;srcElement;)index++,srcElement=srcElement.previousSibling;var navbarCommand=ev.target.winControl;this._closeSplitIfOpen(),navbarCommand.splitOpened&&(this._currentSplitNavItem=navbarCommand),this._fireEvent(NavBarContainer._EventName.splitToggle,{opened:navbarCommand.splitOpened,index:index,navbarCommand:navbarCommand,data:this._repeater?this._repeater.data.getAt(index):null})},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(type,!0,!1,detail),this.element.dispatchEvent(event)},_writeProfilerMark:function(text){var message="WinJS.UI.NavBarContainer:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&(this._appBarEl.removeEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound)),Navigation.removeEventListener("navigated",this._closeSplitAndResetBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),_ElementUtilities._resizeNotifier.unsubscribe(this._element,this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:eventNames.invoked,splitToggle:eventNames.splittoggle}});return _Base.Class.mix(NavBarContainer,_Control.DOMEventMixin),NavBarContainer})})}),define("require-style!less/styles-navbar",[],function(){}),define("require-style!less/colors-navbar",[],function(){}),define("WinJS/Controls/NavBar",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../_Accents","./_LegacyAppBar","./NavBar/_Command","./NavBar/_Container","require-style!less/styles-navbar","require-style!less/colors-navbar"],function(_Global,_WinRT,_Base,_BaseUtils,_Events,_WriteProfilerMark,Promise,Scheduler,_ElementUtilities,_Hoverable,_Accents,_LegacyAppBar,_Command,_Container){"use strict";_Accents.createAccentRule("html.win-hoverable .win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened:hover",[{name:"background-color",value:_Accents.ColorTypes.listSelectHover}]),_Accents.createAccentRule("html.win-hoverable .win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened:hover.win-pressed",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]),_Accents.createAccentRule(".win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened",[{name:"background-color",value:_Accents.ColorTypes.listSelectRest}]),_Accents.createAccentRule(".win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened.win-pressed",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]);var customLayout="custom";_Base.Namespace.define("WinJS.UI",{NavBar:_Base.Namespace._lazy(function(){var childrenProcessedEventName="childrenprocessed",createEvent=_Events._createEventProperty,NavBar=_Base.Class.derive(_LegacyAppBar._LegacyAppBar,function(element,options){_ElementUtilities._deprecated(strings.navBarIsDeprecated),options=options||{},options=_BaseUtils._shallowCopy(options),options.placement=options.placement||"top",options.layout=customLayout,options.closedDisplayMode=options.closedDisplayMode||"minimal",_LegacyAppBar._LegacyAppBar.call(this,element,options),this._element.addEventListener("beforeopen",this._handleBeforeShow.bind(this)),_ElementUtilities.addClass(this.element,NavBar._ClassName.navbar),_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():Scheduler.schedule(this._processChildren.bind(this),Scheduler.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(value){var newValue="none"===value?"none":"minimal";Object.getOwnPropertyDescriptor(_LegacyAppBar._LegacyAppBar.prototype,"closedDisplayMode").set.call(this,newValue),this._closedDisplayMode=newValue}},onchildrenprocessed:createEvent(childrenProcessedEventName),_processChildren:function(){if(!this._processed){this._processed=!0,this._writeProfilerMark("processChildren,StartTM");var that=this,processed=Promise.as();return this._processors&&this._processors.forEach(function(processAll){for(var i=0,len=that.element.children.length;len>i;i++)!function(child){processed=processed.then(function(){processAll(child)})}(that.element.children[i])}),processed.then(function(){that._writeProfilerMark("processChildren,StopTM"),that._fireEvent(NavBar._EventName.childrenProcessed)},function(){that._writeProfilerMark("processChildren,StopTM"),that._fireEvent(NavBar._EventName.childrenProcessed)})}return Promise.wrap()},_show:function(){if(!this.disabled){var that=this;this._processChildren().then(function(){_LegacyAppBar._LegacyAppBar.prototype._show.call(that)})}},_handleBeforeShow:function(){if(!this._disposed)for(var navbarcontainerEls=this.element.querySelectorAll(".win-navbarcontainer"),i=0;i<navbarcontainerEls.length;i++)navbarcontainerEls[i].winControl.forceLayout()},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(type,!0,!1,detail||{}),this.element.dispatchEvent(event)},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.NavBar:"+this._id+":"+text)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:childrenProcessedEventName},isDeclarativeControlContainer:_BaseUtils.markSupportedForProcessing(function(navbar,callback){if(navbar._processed)for(var i=0,len=navbar.element.children.length;len>i;i++)callback(navbar.element.children[i]);else navbar._processors=navbar._processors||[],navbar._processors.push(callback)})}),strings={get navBarIsDeprecated(){return"NavBar is deprecated and may not be available in future releases. Instead, use a WinJS SplitView to display navigation targets within the app."}};return NavBar})})}),define("require-style!less/styles-viewbox",[],function(){}),define("WinJS/Controls/ViewBox",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-viewbox"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,Scheduler,_Control,_Dispose,_ElementUtilities,_Hoverable){"use strict";_Base.Namespace.define("WinJS.UI",{ViewBox:_Base.Namespace._lazy(function(){function onresize(control){if(control&&!control._resizing){control._resizing=control._resizing||0,control._resizing++;try{control._updateLayout()}finally{control._resizing--}}}function onresizeBox(ev){ev.target&&onresize(ev.target.winControl)}function onresizeSizer(ev){ev.target&&onresize(ev.target.parentElement.winControl)}var strings={get invalidViewBoxChildren(){return"ViewBox expects to only have one child element"}},ViewBox=_Base.Class.define(function(element){this._disposed=!1,this._element=element||_Global.document.createElement("div");var box=this.element;box.winControl=this,_ElementUtilities.addClass(box,"win-disposable"),_ElementUtilities.addClass(box,"win-viewbox"),this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===_ElementUtilities._getComputedStyle(this.element).direction}},_initialize:function(){var box=this.element;if(box.firstElementChild!==this._sizer){if(_BaseUtils.validation&&1!==box.childElementCount)throw new _ErrorFromName("WinJS.UI.ViewBox.InvalidChildren",strings.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);var sizer=box.firstElementChild;if(this._sizer=sizer,sizer&&(_ElementUtilities._resizeNotifier.subscribe(box,onresizeBox),box.addEventListener("mselementresize",onresizeBox),_ElementUtilities._resizeNotifier.subscribe(sizer,onresizeSizer),sizer.addEventListener("mselementresize",onresizeSizer)),0===box.clientWidth&&0===box.clientHeight){var that=this;Scheduler.schedule(function(){that._updateLayout()},Scheduler.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout")}}},_updateLayout:function(){var sizer=this._sizer;if(sizer){var box=this.element,w=sizer.clientWidth,h=sizer.clientHeight,bw=box.clientWidth,bh=box.clientHeight,wRatio=bw/w,hRatio=bh/h,mRatio=Math.min(wRatio,hRatio),transX=Math.abs(bw-w*mRatio)/2,transY=Math.abs(bh-h*mRatio)/2,rtl=this._rtl;this._sizer.style[_BaseUtils._browserStyleEquivalents.transform.scriptName]="translate("+(rtl?"-":"")+transX+"px,"+transY+"px) scale("+mRatio+")",this._sizer.style[_BaseUtils._browserStyleEquivalents["transform-origin"].scriptName]=rtl?"top right":"top left"}},dispose:function(){this._disposed||(this.element&&_ElementUtilities._resizeNotifier.unsubscribe(this.element,onresizeBox),this._sizer&&_ElementUtilities._resizeNotifier.unsubscribe(this._sizer,onresizeSizer),this._disposed=!0,_Dispose.disposeSubTree(this._element))},forceLayout:function(){this._initialize(),this._updateLayout()}});return _Base.Class.mix(ViewBox,_Control.DOMEventMixin),ViewBox})})}),define("require-style!less/styles-contentdialog",[],function(){}),define("require-style!less/colors-contentdialog",[],function(){}),define("WinJS/Controls/ContentDialog",["../Application","../Utilities/_Dispose","../_Accents","../Promise","../_Signal","../_LightDismissService","../Core/_BaseUtils","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_Events","../Core/_ErrorFromName","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_KeyboardInfo","../Utilities/_Hoverable","../Animations","require-style!less/styles-contentdialog","require-style!less/colors-contentdialog"],function(Application,_Dispose,_Accents,Promise,_Signal,_LightDismissService,_BaseUtils,_Global,_WinRT,_Base,_Events,_ErrorFromName,_Resources,_Control,_ElementUtilities,_KeyboardInfo,_Hoverable,_Animations){"use strict";_Accents.createAccentRule(".win-contentdialog-dialog",[{name:"outline-color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{ContentDialog:_Base.Namespace._lazy(function(){function supportsMsDevicedFixed(dialogRoot){if("undefined"==typeof _supportsMsDeviceFixedCached){var element=_Global.document.createElement("div");element.style.position="-ms-device-fixed",_supportsMsDeviceFixedCached="-ms-device-fixed"===_ElementUtilities._getComputedStyle(element).position}return _supportsMsDeviceFixedCached}function cancelablePromise(animationPromise){return Promise._cancelBlocker(animationPromise,function(){animationPromise.cancel()})}function onInputPaneShown(eventObject){eventObject.ensuredFocusedElementInView=!0,this.dialog._renderForInputPane(eventObject.occludedRect.height)}function onInputPaneHidden(){this.dialog._clearInputPaneRendering()}function _(){}function interruptible(object,workFn){object._interruptibleWorkPromises=object._interruptibleWorkPromises||[];var workStoredSignal=new _Signal;object._interruptibleWorkPromises.push(workFn(object,workStoredSignal.promise)),workStoredSignal.complete()}function cancelInterruptibles(){(this._interruptibleWorkPromises||[]).forEach(function(workPromise){workPromise.cancel()})}var _supportsMsDeviceFixedCached,Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get controlDisposed(){return"Cannot interact with the control after it has been disposed"},get contentDialogAlreadyShowing(){return"Cannot show a ContentDialog if there is already a ContentDialog that is showing"}},DismissalResult={none:"none",primary:"primary",secondary:"secondary"},ClassNames={contentDialog:"win-contentdialog",backgroundOverlay:"win-contentdialog-backgroundoverlay",dialog:"win-contentdialog-dialog",title:"win-contentdialog-title",content:"win-contentdialog-content",commands:"win-contentdialog-commands",primaryCommand:"win-contentdialog-primarycommand",secondaryCommand:"win-contentdialog-secondarycommand",_verticalAlignment:"win-contentdialog-verticalalignment",_scroller:"win-contentdialog-scroller",_column0or1:"win-contentdialog-column0or1",_visible:"win-contentdialog-visible",_tabStop:"win-contentdialog-tabstop",_commandSpacer:"win-contentdialog-commandspacer",_deviceFixedSupported:"win-contentdialog-devicefixedsupported"},EventNames={beforeShow:"beforeshow",afterShow:"aftershow",beforeHide:"beforehide",afterHide:"afterhide"},States={Init:_Base.Class.define(null,{name:"Init",hidden:!0,enter:function(){var dialog=this.dialog;dialog._dismissable=new _LightDismissService.ModalElement({element:dialog._dom.root,tabIndex:dialog._dom.root.hasAttribute("tabIndex")?dialog._dom.root.tabIndex:-1,onLightDismiss:function(){dialog.hide(DismissalResult.none)},onTakeFocus:function(useSetActive){dialog._dismissable.restoreFocus()||_ElementUtilities._tryFocusOnAnyElement(dialog._dom.dialog,useSetActive)}}),this.dialog._dismissedSignal=null,this.dialog._setState(States.Hidden,!1)},exit:_,show:function(){throw"It's illegal to call show on the Init state"},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),Hidden:_Base.Class.define(null,{name:"Hidden",hidden:!0,enter:function(showIsPending){showIsPending&&this.show()},exit:_,show:function(){var dismissedSignal=this.dialog._dismissedSignal=new _Signal;return this.dialog._setState(States.BeforeShow),dismissedSignal.promise},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),BeforeShow:_Base.Class.define(null,{name:"BeforeShow",hidden:!0,enter:function(){interruptible(this,function(that,ready){return ready.then(function(){return that.dialog._fireBeforeShow()}).then(function(shouldShow){return shouldShow||that.dialog._cancelDismissalPromise(null),shouldShow}).then(function(shouldShow){shouldShow?that.dialog._setState(States.Showing):that.dialog._setState(States.Hidden,!1)})})},exit:cancelInterruptibles,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),Showing:_Base.Class.define(null,{name:"Showing",hidden:{get:function(){return!!this._pendingHide}},enter:function(){interruptible(this,function(that,ready){return ready.then(function(){return that._pendingHide=null,_ElementUtilities.addClass(that.dialog._dom.root,ClassNames._visible),that.dialog._addExternalListeners(),_KeyboardInfo._KeyboardInfo._visible&&that.dialog._renderForInputPane(),_LightDismissService.shown(that.dialog._dismissable),that.dialog._playEntranceAnimation()}).then(function(){that.dialog._fireEvent(EventNames.afterShow)}).then(function(){that.dialog._setState(States.Shown,that._pendingHide)})})},exit:cancelInterruptibles,show:function(){if(this._pendingHide){var dismissalResult=this._pendingHide.dismissalResult;return this._pendingHide=null,this.dialog._resetDismissalPromise(dismissalResult,new _Signal).promise}return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:function(dismissalResult){this._pendingHide={dismissalResult:dismissalResult}},onCommandClicked:_,onInputPaneShown:onInputPaneShown,onInputPaneHidden:onInputPaneHidden}),Shown:_Base.Class.define(null,{name:"Shown",hidden:!1,enter:function(pendingHide){pendingHide&&this.hide(pendingHide.dismissalResult)},exit:_,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:function(dismissalResult){this.dialog._setState(States.BeforeHide,dismissalResult)},onCommandClicked:function(dismissalResult){this.hide(dismissalResult)},onInputPaneShown:onInputPaneShown,onInputPaneHidden:onInputPaneHidden}),BeforeHide:_Base.Class.define(null,{name:"BeforeHide",hidden:!1,enter:function(dismissalResult){interruptible(this,function(that,ready){return ready.then(function(){return that.dialog._fireBeforeHide(dismissalResult)}).then(function(shouldHide){shouldHide?that.dialog._setState(States.Hiding,dismissalResult):that.dialog._setState(States.Shown,null)})})},exit:cancelInterruptibles,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:_,onCommandClicked:_,onInputPaneShown:onInputPaneShown,onInputPaneHidden:onInputPaneHidden}),Hiding:_Base.Class.define(null,{name:"Hiding",hidden:{get:function(){return!this._showIsPending}},enter:function(dismissalResult){interruptible(this,function(that,ready){return ready.then(function(){that._showIsPending=!1,that.dialog._resetDismissalPromise(dismissalResult,null)}).then(function(){return that.dialog._playExitAnimation()}).then(function(){that.dialog._removeExternalListeners(),_LightDismissService.hidden(that.dialog._dismissable),_ElementUtilities.removeClass(that.dialog._dom.root,ClassNames._visible),that.dialog._clearInputPaneRendering(),that.dialog._fireAfterHide(dismissalResult)}).then(function(){that.dialog._setState(States.Hidden,that._showIsPending)})})},exit:cancelInterruptibles,show:function(){return this._showIsPending?Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing)):(this._showIsPending=!0,this.dialog._dismissedSignal=new _Signal,this.dialog._dismissedSignal.promise)},hide:function(dismissalResult){this._showIsPending&&(this._showIsPending=!1,this.dialog._resetDismissalPromise(dismissalResult,null))},onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),Disposed:_Base.Class.define(null,{name:"Disposed",hidden:!0,enter:function(){_LightDismissService.hidden(this.dialog._dismissable),this.dialog._removeExternalListeners(),this.dialog._dismissedSignal&&this.dialog._dismissedSignal.error(new _ErrorFromName("WinJS.UI.ContentDialog.ControlDisposed",Strings.controlDisposed))},exit:_,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ControlDisposed",Strings.controlDisposed))},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_})},ContentDialog=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.ContentDialog.DuplicateConstruction",Strings.duplicateConstruction);options=options||{},this._onInputPaneShownBound=this._onInputPaneShown.bind(this),this._onInputPaneHiddenBound=this._onInputPaneHidden.bind(this),this._onUpdateInputPaneRenderingBound=this._onUpdateInputPaneRendering.bind(this),this._disposed=!1,this._currentFocus=null,this._rendered={registeredForResize:!1,resizedForInputPane:!1,top:"",bottom:""},this._initializeDom(element||_Global.document.createElement("div")),this._setState(States.Init),this.title="",this.primaryCommandText="",this.primaryCommandDisabled=!1,this.secondaryCommandText="",this.secondaryCommandDisabled=!1,_Control.setOptions(this,options)},{element:{get:function(){return this._dom.root}},title:{get:function(){return this._title},set:function(value){value=value||"",this._title!==value&&(this._title=value,this._dom.title.textContent=value,this._dom.title.style.display=value?"":"none")}},primaryCommandText:{get:function(){return this._primaryCommandText},set:function(value){value=value||"",this._primaryCommandText!==value&&(this._primaryCommandText=value,this._dom.commands[0].textContent=value,this._updateCommandsUI())}},secondaryCommandText:{get:function(){return this._secondaryCommandText},set:function(value){value=value||"",this._secondaryCommandText!==value&&(this._secondaryCommandText=value,this._dom.commands[1].textContent=value,this._updateCommandsUI())}},primaryCommandDisabled:{get:function(){return this._primaryCommandDisabled},set:function(value){value=!!value,this._primaryCommandDisabled!==value&&(this._primaryCommandDisabled=value,this._dom.commands[0].disabled=value)}},secondaryCommandDisabled:{get:function(){return this._secondaryCommandDisabled},set:function(value){value=!!value,this._secondaryCommandDisabled!==value&&(this._secondaryCommandDisabled=value,this._dom.commands[1].disabled=value)}},hidden:{get:function(){return this._state.hidden},set:function(hidden){if(!hidden&&this._state.hidden){var nop=function(){};this.show().done(nop,nop)}else hidden&&!this._state.hidden&&this.hide(DismissalResult.none)}},dispose:function(){this._disposed||(this._setState(States.Disposed),this._disposed=!0,_ElementUtilities._resizeNotifier.unsubscribe(this._dom.root,this._onUpdateInputPaneRenderingBound),_Dispose._disposeElement(this._dom.content))},show:function(){return this._state.show()},hide:function(result){this._state.hide(void 0===result?DismissalResult.none:result)},_initializeDom:function(root){var contentEl=_Global.document.createElement("div");contentEl.className=ClassNames.content,_ElementUtilities._reparentChildren(root,contentEl),root.winControl=this,_ElementUtilities.addClass(root,ClassNames.contentDialog),_ElementUtilities.addClass(root,ClassNames._verticalAlignment),_ElementUtilities.addClass(root,"win-disposable"),root.innerHTML='<div class="'+ClassNames.backgroundOverlay+'"></div><div class="'+ClassNames._tabStop+'"></div><div tabindex="-1" role="dialog" class="'+ClassNames.dialog+'"><h2 class="'+ClassNames.title+'" role="heading"></h2><div class="'+ClassNames._scroller+'"></div><div class="'+ClassNames.commands+'"><button type="button" class="'+ClassNames._commandSpacer+' win-button"></button><button type="button" class="'+ClassNames.primaryCommand+' win-button"></button><button type="button" class="'+ClassNames.secondaryCommand+' win-button"></button></div></div><div class="'+ClassNames._tabStop+'"></div><div class="'+ClassNames._column0or1+'"></div>';var dom={};dom.root=root,dom.backgroundOverlay=dom.root.firstElementChild,dom.startBodyTab=dom.backgroundOverlay.nextElementSibling,dom.dialog=dom.startBodyTab.nextElementSibling,dom.title=dom.dialog.firstElementChild,dom.scroller=dom.title.nextElementSibling,dom.commandContainer=dom.scroller.nextElementSibling,dom.commandSpacer=dom.commandContainer.firstElementChild,dom.commands=[],dom.commands.push(dom.commandSpacer.nextElementSibling),dom.commands.push(dom.commands[0].nextElementSibling),dom.endBodyTab=dom.dialog.nextElementSibling,dom.content=contentEl,this._dom=dom,dom.scroller.appendChild(dom.content),_ElementUtilities._ensureId(dom.title),_ElementUtilities._ensureId(dom.startBodyTab),_ElementUtilities._ensureId(dom.endBodyTab),dom.dialog.setAttribute("aria-labelledby",dom.title.id),dom.startBodyTab.setAttribute("x-ms-aria-flowfrom",dom.endBodyTab.id),dom.endBodyTab.setAttribute("aria-flowto",dom.startBodyTab.id),this._updateTabIndices(),dom.root.addEventListener("keydown",this._onKeyDownEnteringElement.bind(this),!0),_ElementUtilities._addEventListener(dom.root,"pointerdown",this._onPointerDown.bind(this)),_ElementUtilities._addEventListener(dom.root,"pointerup",this._onPointerUp.bind(this)),dom.root.addEventListener("click",this._onClick.bind(this)),_ElementUtilities._addEventListener(dom.startBodyTab,"focusin",this._onStartBodyTabFocusIn.bind(this)),_ElementUtilities._addEventListener(dom.endBodyTab,"focusin",this._onEndBodyTabFocusIn.bind(this)),dom.commands[0].addEventListener("click",this._onCommandClicked.bind(this,DismissalResult.primary)),dom.commands[1].addEventListener("click",this._onCommandClicked.bind(this,DismissalResult.secondary)),supportsMsDevicedFixed()&&_ElementUtilities.addClass(dom.root,ClassNames._deviceFixedSupported)},_updateCommandsUI:function(){this._dom.commands[0].style.display=this.primaryCommandText?"":"none",this._dom.commands[1].style.display=this.secondaryCommandText?"":"none",this._dom.commandSpacer.style.display=this.primaryCommandText&&!this.secondaryCommandText||!this.primaryCommandText&&this.secondaryCommandText?"":"none"},_updateTabIndices:function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=_BaseUtils._throttledFunction(100,this._updateTabIndicesImpl.bind(this))),this._updateTabIndicesThrottled()},_updateTabIndicesImpl:function(){var tabIndex=_ElementUtilities._getHighAndLowTabIndices(this._dom.content);this._dom.startBodyTab.tabIndex=tabIndex.lowest,this._dom.commands[0].tabIndex=tabIndex.highest,this._dom.commands[1].tabIndex=tabIndex.highest,this._dom.endBodyTab.tabIndex=tabIndex.highest},_elementInDialog:function(element){return this._dom.dialog.contains(element)||element===this._dom.startBodyTab||element===this._dom.endBodyTab},_onCommandClicked:function(dismissalResult){this._state.onCommandClicked(dismissalResult)},_onPointerDown:function(eventObject){eventObject.stopPropagation(),this._elementInDialog(eventObject.target)||eventObject.preventDefault()},_onPointerUp:function(eventObject){eventObject.stopPropagation(),this._elementInDialog(eventObject.target)||eventObject.preventDefault()},_onClick:function(eventObject){eventObject.stopPropagation(),this._elementInDialog(eventObject.target)||eventObject.preventDefault()},_onKeyDownEnteringElement:function(eventObject){eventObject.keyCode===_ElementUtilities.Key.tab&&this._updateTabIndices()},_onStartBodyTabFocusIn:function(){_ElementUtilities._focusLastFocusableElement(this._dom.dialog)},_onEndBodyTabFocusIn:function(){_ElementUtilities._focusFirstFocusableElement(this._dom.dialog)},_onInputPaneShown:function(eventObject){this._state.onInputPaneShown(eventObject.detail.originalEvent)},_onInputPaneHidden:function(){this._state.onInputPaneHidden()},_onUpdateInputPaneRendering:function(){this._renderForInputPane()},_setState:function(NewState,arg0){this._disposed||(this._state&&this._state.exit(),this._state=new NewState,this._state.dialog=this,this._state.enter(arg0))},_resetDismissalPromise:function(dismissalResult,newSignal){var dismissedSignal=this._dismissedSignal,newDismissedSignal=this._dismissedSignal=newSignal;return dismissedSignal.complete({result:dismissalResult}),newDismissedSignal},_cancelDismissalPromise:function(newSignal){var dismissedSignal=this._dismissedSignal,newDismissedSignal=this._dismissedSignal=newSignal;return dismissedSignal.cancel(),newDismissedSignal},_fireEvent:function(eventName,options){options=options||{};var detail=options.detail||null,cancelable=!!options.cancelable,eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventName,!0,cancelable,detail),this._dom.root.dispatchEvent(eventObject)},_fireBeforeShow:function(){return this._fireEvent(EventNames.beforeShow,{cancelable:!0})},_fireBeforeHide:function(dismissalResult){return this._fireEvent(EventNames.beforeHide,{detail:{result:dismissalResult},cancelable:!0})},_fireAfterHide:function(dismissalResult){this._fireEvent(EventNames.afterHide,{detail:{result:dismissalResult}})},_playEntranceAnimation:function(){
return cancelablePromise(_Animations.fadeIn(this._dom.root))},_playExitAnimation:function(){return cancelablePromise(_Animations.fadeOut(this._dom.root))},_addExternalListeners:function(){_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"showing",this._onInputPaneShownBound),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"hiding",this._onInputPaneHiddenBound)},_removeExternalListeners:function(){_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"showing",this._onInputPaneShownBound),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._onInputPaneHiddenBound)},_shouldResizeForInputPane:function(){if(this._rendered.resizedForInputPane)return!0;var dialogRect=this._dom.dialog.getBoundingClientRect(),willInputPaneOccludeDialog=_KeyboardInfo._KeyboardInfo._visibleDocTop>dialogRect.top||_KeyboardInfo._KeyboardInfo._visibleDocBottom<dialogRect.bottom;return willInputPaneOccludeDialog},_renderForInputPane:function(){var rendered=this._rendered;if(rendered.registeredForResize||(_ElementUtilities._resizeNotifier.subscribe(this._dom.root,this._onUpdateInputPaneRenderingBound),rendered.registeredForResize=!0),this._shouldResizeForInputPane()){var top=_KeyboardInfo._KeyboardInfo._visibleDocTop+"px",bottom=_KeyboardInfo._KeyboardInfo._visibleDocBottomOffset+"px";if(rendered.top!==top&&(this._dom.root.style.top=top,rendered.top=top),rendered.bottom!==bottom&&(this._dom.root.style.bottom=bottom,rendered.bottom=bottom),!rendered.resizedForInputPane){this._dom.scroller.insertBefore(this._dom.title,this._dom.content),this._dom.root.style.height="auto";var activeElement=_Global.document.activeElement;activeElement&&this._dom.scroller.contains(activeElement)&&activeElement.scrollIntoView(),rendered.resizedForInputPane=!0}}},_clearInputPaneRendering:function(){var rendered=this._rendered;rendered.registeredForResize&&(_ElementUtilities._resizeNotifier.unsubscribe(this._dom.root,this._onUpdateInputPaneRenderingBound),rendered.registeredForResize=!1),""!==rendered.top&&(this._dom.root.style.top="",rendered.top=""),""!==rendered.bottom&&(this._dom.root.style.bottom="",rendered.bottom=""),rendered.resizedForInputPane&&(this._dom.dialog.insertBefore(this._dom.title,this._dom.scroller),this._dom.root.style.height="",rendered.resizedForInputPane=!1)}},{DismissalResult:DismissalResult,_ClassNames:ClassNames});return _Base.Class.mix(ContentDialog,_Events.createEventProperties("beforeshow","aftershow","beforehide","afterhide")),_Base.Class.mix(ContentDialog,_Control.DOMEventMixin),ContentDialog})})}),define("require-style!less/styles-splitview",[],function(){}),define("require-style!less/colors-splitview",[],function(){}),define("WinJS/Controls/SplitView/_SplitView",["require","exports","../../Animations","../../Core/_Base","../../Core/_BaseUtils","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../_LightDismissService","../../Utilities/_OpenCloseMachine"],function(require,exports,Animations,_Base,_BaseUtils,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Global,_LightDismissService,_OpenCloseMachine){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}function rectToThickness(rect,dimension){return dimension===Dimension.width?{content:rect.contentWidth,total:rect.totalWidth}:{content:rect.contentHeight,total:rect.totalHeight}}require(["require-style!less/styles-splitview"]),require(["require-style!less/colors-splitview"]);var transformNames=_BaseUtils._browserStyleEquivalents.transform,Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClassNames={splitView:"win-splitview",pane:"win-splitview-pane",content:"win-splitview-content",paneClosed:"win-splitview-pane-closed",paneOpened:"win-splitview-pane-opened",_panePlaceholder:"win-splitview-paneplaceholder",_paneOutline:"win-splitview-paneoutline",_tabStop:"win-splitview-tabstop",_paneWrapper:"win-splitview-panewrapper",_contentWrapper:"win-splitview-contentwrapper",_animating:"win-splitview-animating",_placementLeft:"win-splitview-placementleft",_placementRight:"win-splitview-placementright",_placementTop:"win-splitview-placementtop",_placementBottom:"win-splitview-placementbottom",_closedDisplayNone:"win-splitview-closeddisplaynone",_closedDisplayInline:"win-splitview-closeddisplayinline",_openedDisplayInline:"win-splitview-openeddisplayinline",_openedDisplayOverlay:"win-splitview-openeddisplayoverlay"},EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},Dimension={width:"width",height:"height"},ClosedDisplayMode={none:"none",inline:"inline"},OpenedDisplayMode={inline:"inline",overlay:"overlay"},PanePlacement={left:"left",right:"right",top:"top",bottom:"bottom"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.none]=ClassNames._closedDisplayNone,closedDisplayModeClassMap[ClosedDisplayMode.inline]=ClassNames._closedDisplayInline;var openedDisplayModeClassMap={};openedDisplayModeClassMap[OpenedDisplayMode.overlay]=ClassNames._openedDisplayOverlay,openedDisplayModeClassMap[OpenedDisplayMode.inline]=ClassNames._openedDisplayInline;var panePlacementClassMap={};panePlacementClassMap[PanePlacement.left]=ClassNames._placementLeft,panePlacementClassMap[PanePlacement.right]=ClassNames._placementRight,panePlacementClassMap[PanePlacement.top]=ClassNames._placementTop,panePlacementClassMap[PanePlacement.bottom]=ClassNames._placementBottom;var SplitView=function(){function SplitView(element,options){var _this=this;if(void 0===options&&(options={}),this._updateDomImpl_rendered={paneIsFirst:void 0,isOpenedMode:void 0,closedDisplayMode:void 0,openedDisplayMode:void 0,panePlacement:void 0,panePlaceholderWidth:void 0,panePlaceholderHeight:void 0,isOverlayShown:void 0,startPaneTabIndex:void 0,endPaneTabIndex:void 0},element&&element.winControl)throw new _ErrorFromName("WinJS.UI.SplitView.DuplicateConstruction",Strings.duplicateConstruction);this._initializeDom(element||_Global.document.createElement("div")),this._machine=new _OpenCloseMachine.OpenCloseMachine({eventElement:this._dom.root,onOpen:function(){_this._cachedHiddenPaneThickness=null;var hiddenPaneThickness=_this._getHiddenPaneThickness();return _this._isOpenedMode=!0,_this._updateDomImpl(),_ElementUtilities.addClass(_this._dom.root,ClassNames._animating),_this._playShowAnimation(hiddenPaneThickness).then(function(){_ElementUtilities.removeClass(_this._dom.root,ClassNames._animating)})},onClose:function(){return _ElementUtilities.addClass(_this._dom.root,ClassNames._animating),_this._playHideAnimation(_this._getHiddenPaneThickness()).then(function(){_ElementUtilities.removeClass(_this._dom.root,ClassNames._animating),_this._isOpenedMode=!1,_this._updateDomImpl()})},onUpdateDom:function(){_this._updateDomImpl()},onUpdateDomWithIsOpened:function(isOpened){_this._isOpenedMode=isOpened,_this._updateDomImpl()}}),this._disposed=!1,this._dismissable=new _LightDismissService.LightDismissableElement({element:this._dom.paneWrapper,tabIndex:-1,onLightDismiss:function(){_this.closePane()},onTakeFocus:function(useSetActive){_this._dismissable.restoreFocus()||_ElementUtilities._tryFocusOnAnyElement(_this._dom.pane,useSetActive)}}),this._cachedHiddenPaneThickness=null,this.paneOpened=!1,this.closedDisplayMode=ClosedDisplayMode.inline,this.openedDisplayMode=OpenedDisplayMode.overlay,this.panePlacement=PanePlacement.left,_Control.setOptions(this,options),_ElementUtilities._inDom(this._dom.root).then(function(){_this._rtl="rtl"===_ElementUtilities._getComputedStyle(_this._dom.root).direction,_this._updateTabIndices(),_this._machine.exitInit()})}return Object.defineProperty(SplitView.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"paneElement",{get:function(){return this._dom.pane},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"contentElement",{get:function(){return this._dom.content},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"closedDisplayMode",{get:function(){return this._closedDisplayMode},set:function(value){ClosedDisplayMode[value]&&this._closedDisplayMode!==value&&(this._closedDisplayMode=value,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"openedDisplayMode",{get:function(){return this._openedDisplayMode},set:function(value){OpenedDisplayMode[value]&&this._openedDisplayMode!==value&&(this._openedDisplayMode=value,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"panePlacement",{get:function(){return this._panePlacement},set:function(value){PanePlacement[value]&&this._panePlacement!==value&&(this._panePlacement=value,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"paneOpened",{get:function(){return this._machine.opened},set:function(value){this._machine.opened=value},enumerable:!0,configurable:!0}),SplitView.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._machine.dispose(),_LightDismissService.hidden(this._dismissable),_Dispose._disposeElement(this._dom.pane),_Dispose._disposeElement(this._dom.content))},SplitView.prototype.openPane=function(){this._machine.open()},SplitView.prototype.closePane=function(){this._machine.close()},SplitView.prototype._initializeDom=function(root){var paneEl=root.firstElementChild||_Global.document.createElement("div");_ElementUtilities.addClass(paneEl,ClassNames.pane),paneEl.hasAttribute("tabIndex")||(paneEl.tabIndex=-1);var contentEl=_Global.document.createElement("div");_ElementUtilities.addClass(contentEl,ClassNames.content);for(var child=paneEl.nextSibling;child;){var sibling=child.nextSibling;contentEl.appendChild(child),child=sibling}var startPaneTabEl=_Global.document.createElement("div");startPaneTabEl.className=ClassNames._tabStop,_ElementUtilities._ensureId(startPaneTabEl);var endPaneTabEl=_Global.document.createElement("div");endPaneTabEl.className=ClassNames._tabStop,_ElementUtilities._ensureId(endPaneTabEl);var paneOutlineEl=_Global.document.createElement("div");paneOutlineEl.className=ClassNames._paneOutline;var paneWrapperEl=_Global.document.createElement("div");paneWrapperEl.className=ClassNames._paneWrapper,paneWrapperEl.appendChild(startPaneTabEl),paneWrapperEl.appendChild(paneEl),paneWrapperEl.appendChild(paneOutlineEl),paneWrapperEl.appendChild(endPaneTabEl);var panePlaceholderEl=_Global.document.createElement("div");panePlaceholderEl.className=ClassNames._panePlaceholder;var contentWrapperEl=_Global.document.createElement("div");contentWrapperEl.className=ClassNames._contentWrapper,contentWrapperEl.appendChild(contentEl),root.winControl=this,_ElementUtilities.addClass(root,ClassNames.splitView),_ElementUtilities.addClass(root,"win-disposable"),this._dom={root:root,pane:paneEl,startPaneTab:startPaneTabEl,endPaneTab:endPaneTabEl,paneOutline:paneOutlineEl,paneWrapper:paneWrapperEl,panePlaceholder:panePlaceholderEl,content:contentEl,contentWrapper:contentWrapperEl},_ElementUtilities._addEventListener(paneEl,"keydown",this._onKeyDown.bind(this)),_ElementUtilities._addEventListener(startPaneTabEl,"focusin",this._onStartPaneTabFocusIn.bind(this)),_ElementUtilities._addEventListener(endPaneTabEl,"focusin",this._onEndPaneTabFocusIn.bind(this))},SplitView.prototype._onKeyDown=function(eventObject){eventObject.keyCode===_ElementUtilities.Key.tab&&this._updateTabIndices()},SplitView.prototype._onStartPaneTabFocusIn=function(eventObject){_ElementUtilities._focusLastFocusableElement(this._dom.pane)},SplitView.prototype._onEndPaneTabFocusIn=function(eventObject){_ElementUtilities._focusFirstFocusableElement(this._dom.pane)},SplitView.prototype._measureElement=function(element){var style=_ElementUtilities._getComputedStyle(element),position=_ElementUtilities._getPositionRelativeTo(element,this._dom.root),marginLeft=parseInt(style.marginLeft,10),marginTop=parseInt(style.marginTop,10);return{left:position.left-marginLeft,top:position.top-marginTop,contentWidth:_ElementUtilities.getContentWidth(element),contentHeight:_ElementUtilities.getContentHeight(element),totalWidth:_ElementUtilities.getTotalWidth(element),totalHeight:_ElementUtilities.getTotalHeight(element)}},SplitView.prototype._setContentRect=function(contentRect){var contentWrapperStyle=this._dom.contentWrapper.style;contentWrapperStyle.left=contentRect.left+"px",contentWrapperStyle.top=contentRect.top+"px",contentWrapperStyle.height=contentRect.contentHeight+"px",contentWrapperStyle.width=contentRect.contentWidth+"px"},SplitView.prototype._prepareAnimation=function(paneRect,contentRect){var paneWrapperStyle=this._dom.paneWrapper.style;paneWrapperStyle.position="absolute",paneWrapperStyle.left=paneRect.left+"px",paneWrapperStyle.top=paneRect.top+"px",paneWrapperStyle.height=paneRect.totalHeight+"px",paneWrapperStyle.width=paneRect.totalWidth+"px";var contentWrapperStyle=this._dom.contentWrapper.style;contentWrapperStyle.position="absolute",this._setContentRect(contentRect)},SplitView.prototype._clearAnimation=function(){var paneWrapperStyle=this._dom.paneWrapper.style;paneWrapperStyle.position="",paneWrapperStyle.left="",paneWrapperStyle.top="",paneWrapperStyle.height="",paneWrapperStyle.width="",paneWrapperStyle[transformNames.scriptName]="";var contentWrapperStyle=this._dom.contentWrapper.style;contentWrapperStyle.position="",contentWrapperStyle.left="",contentWrapperStyle.top="",contentWrapperStyle.height="",contentWrapperStyle.width="",contentWrapperStyle[transformNames.scriptName]="";var paneStyle=this._dom.pane.style;paneStyle.height="",paneStyle.width="",paneStyle[transformNames.scriptName]=""},SplitView.prototype._getHiddenContentRect=function(shownContentRect,hiddenPaneThickness,shownPaneThickness){if(this.openedDisplayMode===OpenedDisplayMode.overlay)return shownContentRect;var placementRight=this._rtl?PanePlacement.left:PanePlacement.right,multiplier=this.panePlacement===placementRight||this.panePlacement===PanePlacement.bottom?0:1,paneDiff={content:shownPaneThickness.content-hiddenPaneThickness.content,total:shownPaneThickness.total-hiddenPaneThickness.total};return this._horizontal?{left:shownContentRect.left-multiplier*paneDiff.total,top:shownContentRect.top,contentWidth:shownContentRect.contentWidth+paneDiff.content,contentHeight:shownContentRect.contentHeight,totalWidth:shownContentRect.totalWidth+paneDiff.total,totalHeight:shownContentRect.totalHeight}:{left:shownContentRect.left,top:shownContentRect.top-multiplier*paneDiff.total,contentWidth:shownContentRect.contentWidth,contentHeight:shownContentRect.contentHeight+paneDiff.content,totalWidth:shownContentRect.totalWidth,totalHeight:shownContentRect.totalHeight+paneDiff.total}},Object.defineProperty(SplitView.prototype,"_horizontal",{get:function(){return this.panePlacement===PanePlacement.left||this.panePlacement===PanePlacement.right},enumerable:!0,configurable:!0}),SplitView.prototype._getHiddenPaneThickness=function(){if(null===this._cachedHiddenPaneThickness)if(this._closedDisplayMode===ClosedDisplayMode.none)this._cachedHiddenPaneThickness={content:0,total:0};else{this._isOpenedMode&&(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneOpened),_ElementUtilities.addClass(this._dom.root,ClassNames.paneClosed));var size=this._measureElement(this._dom.pane);this._cachedHiddenPaneThickness=rectToThickness(size,this._horizontal?Dimension.width:Dimension.height),this._isOpenedMode&&(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneClosed),_ElementUtilities.addClass(this._dom.root,ClassNames.paneOpened))}return this._cachedHiddenPaneThickness},SplitView.prototype._playShowAnimation=function(hiddenPaneThickness){var _this=this,dim=this._horizontal?Dimension.width:Dimension.height,shownPaneRect=this._measureElement(this._dom.pane),shownContentRect=this._measureElement(this._dom.content),shownPaneThickness=rectToThickness(shownPaneRect,dim),hiddenContentRect=this._getHiddenContentRect(shownContentRect,hiddenPaneThickness,shownPaneThickness);this._prepareAnimation(shownPaneRect,hiddenContentRect);var playPaneAnimation=function(){var placementRight=_this._rtl?PanePlacement.left:PanePlacement.right,animationOffsetFactor=.3,from=hiddenPaneThickness.total+animationOffsetFactor*(shownPaneThickness.total-hiddenPaneThickness.total);return Animations._resizeTransition(_this._dom.paneWrapper,_this._dom.pane,{from:from,to:shownPaneThickness.total,actualSize:shownPaneThickness.total,dimension:dim,anchorTrailingEdge:_this.panePlacement===placementRight||_this.panePlacement===PanePlacement.bottom})},playShowAnimation=function(){return _this.openedDisplayMode===OpenedDisplayMode.inline&&_this._setContentRect(shownContentRect),playPaneAnimation()};return playShowAnimation().then(function(){_this._clearAnimation()})},SplitView.prototype._playHideAnimation=function(hiddenPaneThickness){var _this=this,dim=this._horizontal?Dimension.width:Dimension.height,shownPaneRect=this._measureElement(this._dom.pane),shownContentRect=this._measureElement(this._dom.content),shownPaneThickness=rectToThickness(shownPaneRect,dim),hiddenContentRect=this._getHiddenContentRect(shownContentRect,hiddenPaneThickness,shownPaneThickness);this._prepareAnimation(shownPaneRect,shownContentRect);var playPaneAnimation=function(){var placementRight=_this._rtl?PanePlacement.left:PanePlacement.right,animationOffsetFactor=.3,from=shownPaneThickness.total-animationOffsetFactor*(shownPaneThickness.total-hiddenPaneThickness.total);return Animations._resizeTransition(_this._dom.paneWrapper,_this._dom.pane,{from:from,to:hiddenPaneThickness.total,actualSize:shownPaneThickness.total,dimension:dim,anchorTrailingEdge:_this.panePlacement===placementRight||_this.panePlacement===PanePlacement.bottom})},playHideAnimation=function(){return _this.openedDisplayMode===OpenedDisplayMode.inline&&_this._setContentRect(hiddenContentRect),playPaneAnimation()};return playHideAnimation().then(function(){_this._clearAnimation()})},SplitView.prototype._updateTabIndices=function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=_BaseUtils._throttledFunction(100,this._updateTabIndicesImpl.bind(this))),this._updateTabIndicesThrottled()},SplitView.prototype._updateTabIndicesImpl=function(){var tabIndex=_ElementUtilities._getHighAndLowTabIndices(this._dom.pane);this._highestPaneTabIndex=tabIndex.highest,this._lowestPaneTabIndex=tabIndex.lowest,this._machine.updateDom()},SplitView.prototype._updateDomImpl=function(){var rendered=this._updateDomImpl_rendered,paneShouldBeFirst=this.panePlacement===PanePlacement.left||this.panePlacement===PanePlacement.top;paneShouldBeFirst!==rendered.paneIsFirst&&(paneShouldBeFirst?(this._dom.root.appendChild(this._dom.panePlaceholder),this._dom.root.appendChild(this._dom.paneWrapper),this._dom.root.appendChild(this._dom.contentWrapper)):(this._dom.root.appendChild(this._dom.contentWrapper),this._dom.root.appendChild(this._dom.paneWrapper),this._dom.root.appendChild(this._dom.panePlaceholder))),rendered.paneIsFirst=paneShouldBeFirst,rendered.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneClosed),_ElementUtilities.addClass(this._dom.root,ClassNames.paneOpened)):(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneOpened),_ElementUtilities.addClass(this._dom.root,ClassNames.paneClosed))),rendered.isOpenedMode=this._isOpenedMode,rendered.panePlacement!==this.panePlacement&&(removeClass(this._dom.root,panePlacementClassMap[rendered.panePlacement]),addClass(this._dom.root,panePlacementClassMap[this.panePlacement]),rendered.panePlacement=this.panePlacement),rendered.closedDisplayMode!==this.closedDisplayMode&&(removeClass(this._dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(this._dom.root,closedDisplayModeClassMap[this.closedDisplayMode]),rendered.closedDisplayMode=this.closedDisplayMode),rendered.openedDisplayMode!==this.openedDisplayMode&&(removeClass(this._dom.root,openedDisplayModeClassMap[rendered.openedDisplayMode]),addClass(this._dom.root,openedDisplayModeClassMap[this.openedDisplayMode]),rendered.openedDisplayMode=this.openedDisplayMode);var isOverlayShown=this._isOpenedMode&&this.openedDisplayMode===OpenedDisplayMode.overlay,startPaneTabIndex=isOverlayShown?this._lowestPaneTabIndex:-1,endPaneTabIndex=isOverlayShown?this._highestPaneTabIndex:-1;rendered.startPaneTabIndex!==startPaneTabIndex&&(this._dom.startPaneTab.tabIndex=startPaneTabIndex,-1===startPaneTabIndex?this._dom.startPaneTab.removeAttribute("x-ms-aria-flowfrom"):this._dom.startPaneTab.setAttribute("x-ms-aria-flowfrom",this._dom.endPaneTab.id),rendered.startPaneTabIndex=startPaneTabIndex),rendered.endPaneTabIndex!==endPaneTabIndex&&(this._dom.endPaneTab.tabIndex=endPaneTabIndex,-1===endPaneTabIndex?this._dom.endPaneTab.removeAttribute("aria-flowto"):this._dom.endPaneTab.setAttribute("aria-flowto",this._dom.startPaneTab.id),rendered.endPaneTabIndex=endPaneTabIndex);var width,height;if(isOverlayShown){var hiddenPaneThickness=this._getHiddenPaneThickness();this._horizontal?(width=hiddenPaneThickness.total+"px",height=""):(width="",height=hiddenPaneThickness.total+"px")}else width="",height="";if(rendered.panePlaceholderWidth!==width||rendered.panePlaceholderHeight!==height){var style=this._dom.panePlaceholder.style;style.width=width,style.height=height,rendered.panePlaceholderWidth=width,rendered.panePlaceholderHeight=height}rendered.isOverlayShown!==isOverlayShown&&(isOverlayShown?_LightDismissService.shown(this._dismissable):_LightDismissService.hidden(this._dismissable),rendered.isOverlayShown=isOverlayShown)},SplitView.ClosedDisplayMode=ClosedDisplayMode,SplitView.OpenedDisplayMode=OpenedDisplayMode,SplitView.PanePlacement=PanePlacement,SplitView.supportedForProcessing=!0,SplitView._ClassNames=ClassNames,SplitView}();exports.SplitView=SplitView,_Base.Class.mix(SplitView,_Events.createEventProperties(EventNames.beforeOpen,EventNames.afterOpen,EventNames.beforeClose,EventNames.afterClose)),_Base.Class.mix(SplitView,_Control.DOMEventMixin)}),define("WinJS/Controls/SplitView",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{SplitView:{get:function(){return module||require(["./SplitView/_SplitView"],function(m){module=m}),module.SplitView}}})}),define("require-style!less/styles-splitviewpanetoggle",[],function(){}),define("require-style!less/colors-splitviewpanetoggle",[],function(){}),define("WinJS/Controls/SplitViewPaneToggle/_SplitViewPaneToggle",["require","exports","../../Core/_Base","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../Utilities/_KeyboardBehavior","../../Utilities/_Hoverable"],function(require,exports,_Base,_Control,_ElementUtilities,_ErrorFromName,_Events,_Global,_KeyboardBehavior,_Hoverable){function getSplitViewControl(splitViewElement){return splitViewElement&&splitViewElement.winControl}function getPaneOpened(splitViewElement){var splitViewControl=getSplitViewControl(splitViewElement);return splitViewControl?splitViewControl.paneOpened:!1}_Hoverable.isHoverable,require(["require-style!less/styles-splitviewpanetoggle"]),require(["require-style!less/colors-splitviewpanetoggle"]);var ClassNames={splitViewPaneToggle:"win-splitviewpanetoggle"},EventNames={invoked:"invoked"},Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: The SplitViewPaneToggle's element must be a button element"}},SplitViewPaneToggle=function(){function SplitViewPaneToggle(element,options){if(void 0===options&&(options={}),this._updateDom_rendered={splitView:void 0},element&&element.winControl)throw new _ErrorFromName("WinJS.UI.SplitViewPaneToggle.DuplicateConstruction",Strings.duplicateConstruction);this._onPaneStateSettledBound=this._onPaneStateSettled.bind(this),this._ariaExpandedMutationObserver=new _ElementUtilities._MutationObserver(this._onAriaExpandedPropertyChanged.bind(this)),this._initializeDom(element||_Global.document.createElement("button")),this._disposed=!1,this.splitView=null,_Control.setOptions(this,options),this._initialized=!0,this._updateDom()}return Object.defineProperty(SplitViewPaneToggle.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(SplitViewPaneToggle.prototype,"splitView",{get:function(){return this._splitView},set:function(splitView){this._splitView=splitView,splitView&&(this._opened=getPaneOpened(splitView)),this._updateDom()},enumerable:!0,configurable:!0}),SplitViewPaneToggle.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._splitView&&this._removeListeners(this._splitView))},SplitViewPaneToggle.prototype._initializeDom=function(root){if("BUTTON"!==root.tagName)throw new _ErrorFromName("WinJS.UI.SplitViewPaneToggle.BadButtonElement",Strings.badButtonElement);root.winControl=this,_ElementUtilities.addClass(root,ClassNames.splitViewPaneToggle),_ElementUtilities.addClass(root,"win-disposable"),root.hasAttribute("type")||(root.type="button"),new _KeyboardBehavior._WinKeyboard(root),root.addEventListener("click",this._onClick.bind(this)),this._dom={root:root}},SplitViewPaneToggle.prototype._updateDom=function(){if(this._initialized&&!this._disposed){var rendered=this._updateDom_rendered;if(this._splitView!==rendered.splitView&&(rendered.splitView&&(this._dom.root.removeAttribute("aria-controls"),this._removeListeners(rendered.splitView)),this._splitView&&(_ElementUtilities._ensureId(this._splitView),this._dom.root.setAttribute("aria-controls",this._splitView.id),this._addListeners(this._splitView)),rendered.splitView=this._splitView),this._splitView){var expanded=this._opened?"true":"false";_ElementUtilities._setAttribute(this._dom.root,"aria-expanded",expanded);var splitViewControl=getSplitViewControl(this._splitView);splitViewControl&&(splitViewControl.paneOpened=this._opened)}}},SplitViewPaneToggle.prototype._addListeners=function(splitViewElement){splitViewElement.addEventListener("_openCloseStateSettled",this._onPaneStateSettledBound),this._ariaExpandedMutationObserver.observe(this._dom.root,{attributes:!0,attributeFilter:["aria-expanded"]})},SplitViewPaneToggle.prototype._removeListeners=function(splitViewElement){splitViewElement.removeEventListener("_openCloseStateSettled",this._onPaneStateSettledBound),this._ariaExpandedMutationObserver.disconnect()},SplitViewPaneToggle.prototype._fireEvent=function(eventName){var eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventName,!0,!1,null),this._dom.root.dispatchEvent(eventObject)},SplitViewPaneToggle.prototype._onPaneStateSettled=function(eventObject){eventObject.target===this._splitView&&(this._opened=getPaneOpened(this._splitView),this._updateDom())},SplitViewPaneToggle.prototype._onAriaExpandedPropertyChanged=function(mutations){var ariaExpanded="true"===this._dom.root.getAttribute("aria-expanded");this._opened=ariaExpanded,this._updateDom()},SplitViewPaneToggle.prototype._onClick=function(eventObject){this._invoked()},SplitViewPaneToggle.prototype._invoked=function(){this._disposed||(this._splitView&&(this._opened=!this._opened,this._updateDom()),this._fireEvent(EventNames.invoked))},SplitViewPaneToggle._ClassNames=ClassNames,SplitViewPaneToggle.supportedForProcessing=!0,SplitViewPaneToggle}();exports.SplitViewPaneToggle=SplitViewPaneToggle,_Base.Class.mix(SplitViewPaneToggle,_Events.createEventProperties(EventNames.invoked)),_Base.Class.mix(SplitViewPaneToggle,_Control.DOMEventMixin)}),define("WinJS/Controls/SplitViewPaneToggle",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{SplitViewPaneToggle:{get:function(){return module||require(["./SplitViewPaneToggle/_SplitViewPaneToggle"],function(m){module=m}),module.SplitViewPaneToggle}}})}),define("WinJS/Controls/AppBar/_Constants",["require","exports","../CommandingSurface/_Constants"],function(require,exports,_CommandingSurfaceConstants){exports.ClassNames={controlCssClass:"win-appbar",disposableCssClass:"win-disposable",actionAreaCssClass:"win-appbar-actionarea",overflowButtonCssClass:"win-appbar-overflowbutton",spacerCssClass:"win-appbar-spacer",ellipsisCssClass:"win-appbar-ellipsis",overflowAreaCssClass:"win-appbar-overflowarea",contentFlyoutCssClass:"win-appbar-contentflyout",emptyappbarCssClass:"win-appbar-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",openedClass:"win-appbar-opened",closedClass:"win-appbar-closed",noneClass:"win-appbar-closeddisplaynone",minimalClass:"win-appbar-closeddisplayminimal",compactClass:"win-appbar-closeddisplaycompact",fullClass:"win-appbar-closeddisplayfull",placementTopClass:"win-appbar-top",placementBottomClass:"win-appbar-bottom"},exports.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",commandPropertyMutated:"_commandpropertymutated"},exports.controlMinWidth=_CommandingSurfaceConstants.controlMinWidth,exports.defaultClosedDisplayMode="compact",exports.defaultOpened=!1,exports.defaultPlacement="bottom",exports.typeSeparator="separator",exports.typeContent="content",exports.typeButton="button",exports.typeToggle="toggle",exports.typeFlyout="flyout",exports.commandSelector=".win-command",exports.primaryCommandSection="primary",exports.secondaryCommandSection="secondary"}),define("require-style!less/styles-appbar",[],function(){}),define("WinJS/Controls/AppBar/_AppBar",["require","exports","../../Core/_Base","../AppBar/_Constants","../CommandingSurface","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../Utilities/_KeyboardInfo","../../_LightDismissService","../../Promise","../../Core/_Resources","../../Utilities/_OpenCloseMachine","../../Core/_WriteProfilerMark"],function(require,exports,_Base,_Constants,_CommandingSurface,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Global,_KeyboardInfo,_LightDismissService,Promise,_Resources,_OpenCloseMachine,_WriteProfilerMark){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}require(["require-style!less/styles-appbar"]);var keyboardInfo=_KeyboardInfo._KeyboardInfo,strings={get ariaLabel(){return _Resources._getWinJSString("ui/appBarAriaLabel").value},get overflowButtonAriaLabel(){return _Resources._getWinJSString("ui/appBarOverflowButtonAriaLabel").value},get mustContainCommands(){return"The AppBar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClosedDisplayMode={none:"none",minimal:"minimal",compact:"compact",full:"full"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.none]=_Constants.ClassNames.noneClass,closedDisplayModeClassMap[ClosedDisplayMode.minimal]=_Constants.ClassNames.minimalClass,closedDisplayModeClassMap[ClosedDisplayMode.compact]=_Constants.ClassNames.compactClass,closedDisplayModeClassMap[ClosedDisplayMode.full]=_Constants.ClassNames.fullClass;var Placement={
top:"top",bottom:"bottom"},placementClassMap={};placementClassMap[Placement.top]=_Constants.ClassNames.placementTopClass,placementClassMap[Placement.bottom]=_Constants.ClassNames.placementBottomClass;var AppBar=function(){function AppBar(element,options){var _this=this;if(void 0===options&&(options={}),this._updateDomImpl_renderedState={isOpenedMode:void 0,placement:void 0,closedDisplayMode:void 0,adjustedOffsets:{top:void 0,bottom:void 0}},this._writeProfilerMark("constructor,StartTM"),element&&element.winControl)throw new _ErrorFromName("WinJS.UI.AppBar.DuplicateConstruction",strings.duplicateConstruction);this._initializeDom(element||_Global.document.createElement("div"));var stateMachine=new _OpenCloseMachine.OpenCloseMachine({eventElement:this.element,onOpen:function(){var openAnimation=_this._commandingSurface.createOpenAnimation(_this._getClosedHeight());return _this.element.style.position="fixed",_this._placement===AppBar.Placement.top?_this.element.style.top=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocTop+"px":_this.element.style.bottom=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocBottom+"px",_this._synchronousOpen(),openAnimation.execute().then(function(){_this.element.style.position="",_this.element.style.top=_this._adjustedOffsets.top,_this.element.style.bottom=_this._adjustedOffsets.bottom})},onClose:function(){var closeAnimation=_this._commandingSurface.createCloseAnimation(_this._getClosedHeight());return _this.element.style.position="fixed",_this._placement===AppBar.Placement.top?_this.element.style.top=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocTop+"px":_this.element.style.bottom=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocBottom+"px",closeAnimation.execute().then(function(){_this._synchronousClose(),_this.element.style.position="",_this.element.style.top=_this._adjustedOffsets.top,_this.element.style.bottom=_this._adjustedOffsets.bottom})},onUpdateDom:function(){_this._updateDomImpl()},onUpdateDomWithIsOpened:function(isOpened){_this._isOpenedMode=isOpened,_this._updateDomImpl()}});this._handleShowingKeyboardBound=this._handleShowingKeyboard.bind(this),this._handleHidingKeyboardBound=this._handleHidingKeyboard.bind(this),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"hiding",this._handleHidingKeyboardBound),this._disposed=!1,this._cachedClosedHeight=null,this._commandingSurface=new _CommandingSurface._CommandingSurface(this._dom.commandingSurfaceEl,{openCloseMachine:stateMachine}),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-actionarea"),_Constants.ClassNames.actionAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowarea"),_Constants.ClassNames.overflowAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowbutton"),_Constants.ClassNames.overflowButtonCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-ellipsis"),_Constants.ClassNames.ellipsisCssClass),this._isOpenedMode=_Constants.defaultOpened,this._dismissable=new _LightDismissService.LightDismissableElement({element:this._dom.root,tabIndex:this._dom.root.hasAttribute("tabIndex")?this._dom.root.tabIndex:-1,onLightDismiss:function(){_this.close()},onTakeFocus:function(useSetActive){_this._dismissable.restoreFocus()||_this._commandingSurface.takeFocus(useSetActive)}}),this.closedDisplayMode=_Constants.defaultClosedDisplayMode,this.placement=_Constants.defaultPlacement,this.opened=this._isOpenedMode,_Control.setOptions(this,options),_ElementUtilities._inDom(this.element).then(function(){return _this._commandingSurface.initialized}).then(function(){stateMachine.exitInit(),_this._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(AppBar.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"data",{get:function(){return this._commandingSurface.data},set:function(value){this._commandingSurface.data=value},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"closedDisplayMode",{get:function(){return this._commandingSurface.closedDisplayMode},set:function(value){ClosedDisplayMode[value]&&(this._commandingSurface.closedDisplayMode=value,this._cachedClosedHeight=null)},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"placement",{get:function(){return this._placement},set:function(value){if(Placement[value]&&this._placement!==value){switch(this._placement=value,value){case Placement.top:this._commandingSurface.overflowDirection="bottom";break;case Placement.bottom:this._commandingSurface.overflowDirection="top"}this._adjustedOffsets=this._computeAdjustedOffsets(),this._commandingSurface.deferredDomUpate()}},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"opened",{get:function(){return this._commandingSurface.opened},set:function(value){this._commandingSurface.opened=value},enumerable:!0,configurable:!0}),AppBar.prototype.open=function(){this._commandingSurface.open()},AppBar.prototype.close=function(){this._commandingSurface.close()},AppBar.prototype.dispose=function(){this._disposed||(this._disposed=!0,_LightDismissService.hidden(this._dismissable),this._commandingSurface.dispose(),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._handleHidingKeyboardBound),_Dispose.disposeSubTree(this.element))},AppBar.prototype.forceLayout=function(){this._commandingSurface.forceLayout()},AppBar.prototype.getCommandById=function(id){return this._commandingSurface.getCommandById(id)},AppBar.prototype.showOnlyCommands=function(commands){return this._commandingSurface.showOnlyCommands(commands)},AppBar.prototype._writeProfilerMark=function(text){_WriteProfilerMark("WinJS.UI.AppBar:"+this._id+":"+text)},AppBar.prototype._initializeDom=function(root){this._writeProfilerMark("_intializeDom,info"),root.winControl=this,this._id=root.id||_ElementUtilities._uniqueID(root),_ElementUtilities.addClass(root,_Constants.ClassNames.controlCssClass),_ElementUtilities.addClass(root,_Constants.ClassNames.disposableCssClass);var role=root.getAttribute("role");role||root.setAttribute("role","menubar");var label=root.getAttribute("aria-label");label||root.setAttribute("aria-label",strings.ariaLabel);var commandingSurfaceEl=document.createElement("DIV");_ElementUtilities._reparentChildren(root,commandingSurfaceEl),root.appendChild(commandingSurfaceEl),this._dom={root:root,commandingSurfaceEl:commandingSurfaceEl}},AppBar.prototype._handleShowingKeyboard=function(event){var _this=this;if(this._dom.root.contains(_Global.document.activeElement)){var inputPaneEvent=event.detail.originalEvent;inputPaneEvent.ensuredFocusedElementInView=!0}var duration=keyboardInfo._animationShowLength+keyboardInfo._scrollTimeout;return Promise.timeout(duration).then(function(){_this._shouldAdjustForShowingKeyboard()&&!_this._disposed&&(_this._adjustedOffsets=_this._computeAdjustedOffsets(),_this._commandingSurface.deferredDomUpate())})},AppBar.prototype._shouldAdjustForShowingKeyboard=function(){return keyboardInfo._visible&&!keyboardInfo._isResized},AppBar.prototype._handleHidingKeyboard=function(){this._adjustedOffsets=this._computeAdjustedOffsets(),this._commandingSurface.deferredDomUpate()},AppBar.prototype._computeAdjustedOffsets=function(){var offsets={top:"",bottom:""};return this._placement===Placement.bottom?offsets.bottom=keyboardInfo._visibleDocBottomOffset+"px":this._placement===Placement.top&&(offsets.top=keyboardInfo._visibleDocTop+"px"),offsets},AppBar.prototype._synchronousOpen=function(){this._isOpenedMode=!0,this._updateDomImpl()},AppBar.prototype._synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl()},AppBar.prototype._updateDomImpl=function(){var rendered=this._updateDomImpl_renderedState;rendered.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?this._updateDomImpl_renderOpened():this._updateDomImpl_renderClosed(),rendered.isOpenedMode=this._isOpenedMode),rendered.placement!==this.placement&&(removeClass(this._dom.root,placementClassMap[rendered.placement]),addClass(this._dom.root,placementClassMap[this.placement]),rendered.placement=this.placement),rendered.closedDisplayMode!==this.closedDisplayMode&&(removeClass(this._dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(this._dom.root,closedDisplayModeClassMap[this.closedDisplayMode]),rendered.closedDisplayMode=this.closedDisplayMode),rendered.adjustedOffsets.top!==this._adjustedOffsets.top&&(this._dom.root.style.top=this._adjustedOffsets.top,rendered.adjustedOffsets.top=this._adjustedOffsets.top),rendered.adjustedOffsets.bottom!==this._adjustedOffsets.bottom&&(this._dom.root.style.bottom=this._adjustedOffsets.bottom,rendered.adjustedOffsets.bottom=this._adjustedOffsets.bottom),this._commandingSurface.updateDom()},AppBar.prototype._getClosedHeight=function(){if(null===this._cachedClosedHeight){var wasOpen=this._isOpenedMode;this._isOpenedMode&&this._synchronousClose(),this._cachedClosedHeight=this._commandingSurface.getBoundingRects().commandingSurface.height,wasOpen&&this._synchronousOpen()}return this._cachedClosedHeight},AppBar.prototype._updateDomImpl_renderOpened=function(){addClass(this._dom.root,_Constants.ClassNames.openedClass),removeClass(this._dom.root,_Constants.ClassNames.closedClass),this._commandingSurface.synchronousOpen(),_LightDismissService.shown(this._dismissable)},AppBar.prototype._updateDomImpl_renderClosed=function(){addClass(this._dom.root,_Constants.ClassNames.closedClass),removeClass(this._dom.root,_Constants.ClassNames.openedClass),this._commandingSurface.synchronousClose(),_LightDismissService.hidden(this._dismissable)},AppBar.ClosedDisplayMode=ClosedDisplayMode,AppBar.Placement=Placement,AppBar.supportedForProcessing=!0,AppBar}();exports.AppBar=AppBar,_Base.Class.mix(AppBar,_Events.createEventProperties(_Constants.EventNames.beforeOpen,_Constants.EventNames.afterOpen,_Constants.EventNames.beforeClose,_Constants.EventNames.afterClose)),_Base.Class.mix(AppBar,_Control.DOMEventMixin)}),define("WinJS/Controls/AppBar",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{AppBar:{get:function(){return module||require(["./AppBar/_AppBar"],function(m){module=m}),module.AppBar}}})}),define("ui",["WinJS/Core/_WinJS","WinJS/VirtualizedDataSource","WinJS/Vui","WinJS/Controls/IntrinsicControls","WinJS/Controls/ListView","WinJS/Controls/FlipView","WinJS/Controls/ItemContainer","WinJS/Controls/Repeater","WinJS/Controls/DatePicker","WinJS/Controls/TimePicker","WinJS/Controls/BackButton","WinJS/Controls/Rating","WinJS/Controls/ToggleSwitch","WinJS/Controls/SemanticZoom","WinJS/Controls/Pivot","WinJS/Controls/Hub","WinJS/Controls/Flyout","WinJS/Controls/_LegacyAppBar","WinJS/Controls/Menu","WinJS/Controls/SearchBox","WinJS/Controls/SettingsFlyout","WinJS/Controls/NavBar","WinJS/Controls/Tooltip","WinJS/Controls/ViewBox","WinJS/Controls/ContentDialog","WinJS/Controls/SplitView","WinJS/Controls/SplitViewPaneToggle","WinJS/Controls/SplitView/Command","WinJS/Controls/ToolBar","WinJS/Controls/AppBar"],function(_WinJS){"use strict";return _WinJS}),require(["WinJS/Core/_WinJS","ui"],function(_WinJS){globalObject.WinJS=_WinJS,"undefined"!=typeof module&&(module.exports=_WinJS)}),globalObject.WinJS})}(),function(){"use strict";var nav=WinJS.Navigation;WinJS.Namespace.define("Application",{PageControlNavigator:WinJS.Class.define(function(element,options){function addRemovableEventListener(e,eventName,handler,capture){e.addEventListener(eventName,handler,capture),that._eventHandlerRemover.push(function(){e.removeEventListener(eventName,handler)})}this._element=element||document.createElement("div"),this._element.appendChild(this._createPageElement()),this.home=options.home,this._eventHandlerRemover=[];var that=this;addRemovableEventListener(nav,"navigating",this._navigating.bind(this),!1),addRemovableEventListener(nav,"navigated",this._navigated.bind(this),!1),window.onresize=this._resized.bind(this),Application.navigator=this},{home:"",_element:null,_lastNavigationPromise:WinJS.Promise.as(),_lastViewstate:0,pageControl:{get:function(){return this.pageElement&&this.pageElement.winControl}},pageElement:{get:function(){return this._element.firstElementChild}},dispose:function(){if(!this._disposed){this._disposed=!0,WinJS.Utilities.disposeSubTree(this._element);for(var i=0;i<this._eventHandlerRemover.length;i++)this._eventHandlerRemover[i]();this._eventHandlerRemover=null}},_createPageElement:function(){var element=document.createElement("div");return element.setAttribute("dir",window.getComputedStyle(this._element,null).direction),element.style.position="absolute",element.style.visibility="hidden",element.style.width="100%",element.style.height="100%",element},_getAnimationElements:function(){return this.pageControl&&this.pageControl.getAnimationElements?this.pageControl.getAnimationElements():this.pageElement},_navigated:function(){this.pageElement.style.visibility="",WinJS.UI.Animation.enterPage(this._getAnimationElements()).done()},_navigating:function(args){function cleanup(){if(that._element.childElementCount>1){var oldElement=that._element.firstElementChild;oldElement.winControl&&(oldElement.winControl.unload&&oldElement.winControl.unload(),oldElement.winControl.dispose()),oldElement.parentNode.removeChild(oldElement),oldElement.innerText=""}}var newElement=this._createPageElement();this._element.appendChild(newElement),this._lastNavigationPromise.cancel();var that=this;this._lastNavigationPromise=WinJS.Promise.as().then(function(){return WinJS.UI.Pages.render(args.detail.location,newElement,args.detail.state)}).then(cleanup,cleanup),args.detail.setPromise(this._lastNavigationPromise)},_resized:function(args){this.pageControl&&this.pageControl.updateLayout&&this.pageControl.updateLayout.call(this.pageControl,this.pageElement)}})})}(),function(){!function(p){var y=this||(0,eval)("this"),w=y.document,M=y.navigator,u=y.jQuery,E=y.JSON;!function(p){"function"==typeof define&&define.amd?define(["exports","require"],p):p("function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports||exports:y.ko={})}(function(N,O){function J(a,d){return null===a||typeof a in Q?a===d:!1}function R(a,d){var c;return function(){c||(c=setTimeout(function(){c=p,a()},d))}}function S(a,d){var c;return function(){clearTimeout(c),c=setTimeout(a,d)}}function K(b,d,c,e){a.d[b]={init:function(b,k,h,l,g){var m,x;return a.w(function(){var q=a.a.c(k()),n=!c!=!q,r=!x;(r||d||n!==m)&&(r&&a.Z.oa()&&(x=a.a.la(a.e.childNodes(b),!0)),n?(r||a.e.T(b,a.a.la(x)),a.Ja(e?e(g,q):g,b)):a.e.ma(b),m=n)},null,{q:b}),{controlsDescendantBindings:!0}}},a.h.ka[b]=!1,a.e.R[b]=!0}var a="undefined"!=typeof N?N:{};a.b=function(b,d){for(var c=b.split("."),e=a,f=0;f<c.length-1;f++)e=e[c[f]];e[c[c.length-1]]=d},a.D=function(a,d,c){a[d]=c},a.version="3.3.0",a.b("version",a.version),a.a=function(){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function d(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a,b){return a.__proto__=b,a}function e(b,c,g,d){var e=b[c].match(m)||[];a.a.o(g.match(m),function(b){a.a.ga(e,b,d)}),b[c]=e.join(" ")}var f={__proto__:[]}instanceof Array,k={},h={};k[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],k.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),b(k,function(a,b){if(b.length)for(var c=0,g=b.length;g>c;c++)h[b[c]]=a});var l={propertychange:!0},g=w&&function(){for(var a=3,b=w.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:p}(),m=/\S+/g;return{Bb:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(a,b){for(var c=0,g=a.length;g>c;c++)b(a[c],c)},m:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,g=a.length;g>c;c++)if(a[c]===b)return c;return-1},vb:function(a,b,c){for(var g=0,d=a.length;d>g;g++)if(b.call(c,a[g],g))return a[g];return null},ya:function(b,c){var g=a.a.m(b,c);g>0?b.splice(g,1):0===g&&b.shift()},wb:function(b){b=b||[];for(var c=[],g=0,d=b.length;d>g;g++)0>a.a.m(c,b[g])&&c.push(b[g]);return c},Ka:function(a,b){a=a||[];for(var c=[],g=0,d=a.length;d>g;g++)c.push(b(a[g],g));return c},xa:function(a,b){a=a||[];for(var c=[],g=0,d=a.length;d>g;g++)b(a[g],g)&&c.push(a[g]);return c},ia:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,g=b.length;g>c;c++)a.push(b[c]);return a},ga:function(b,c,g){var d=a.a.m(a.a.cb(b),c);0>d?g&&b.push(c):g||b.splice(d,1)},za:f,extend:d,Fa:c,Ga:f?c:d,A:b,pa:function(a,b){if(!a)return a;var g,c={};for(g in a)a.hasOwnProperty(g)&&(c[g]=b(a[g],g,a));return c},Ra:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},Jb:function(b){b=a.a.O(b);for(var c=(b[0]&&b[0].ownerDocument||w).createElement("div"),g=0,d=b.length;d>g;g++)c.appendChild(a.S(b[g]));return c},la:function(b,c){for(var g=0,d=b.length,e=[];d>g;g++){var m=b[g].cloneNode(!0);e.push(c?a.S(m):m)}return e},T:function(b,c){if(a.a.Ra(b),c)for(var g=0,d=c.length;d>g;g++)b.appendChild(c[g])},Qb:function(b,c){var g=b.nodeType?[b]:b;if(0<g.length){for(var d=g[0],e=d.parentNode,m=0,f=c.length;f>m;m++)e.insertBefore(c[m],d);for(m=0,f=g.length;f>m;m++)a.removeNode(g[m])}},na:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);if(1<a.length){var c=a[0],g=a[a.length-1];for(a.length=0;c!==g;)if(a.push(c),c=c.nextSibling,!c)return;a.push(g)}}return a},Sb:function(a,b){7>g?a.setAttribute("selected",b):a.selected=b},ib:function(a){return null===a||a===p?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Dc:function(a,b){return a=a||"",b.length>a.length?!1:a.substring(0,b.length)===b},jc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(16&b.compareDocumentPosition(a));for(;a&&a!=b;)a=a.parentNode;return!!a},Qa:function(b){return a.a.jc(b,b.ownerDocument.documentElement)},tb:function(b){return!!a.a.vb(b,a.a.Qa)},v:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},n:function(b,c,d){var m=g&&l[c];if(!m&&u)u(b).bind(c,d);else if(m||"function"!=typeof b.addEventListener){if("undefined"==typeof b.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var e=function(a){d.call(b,a)},f="on"+c;b.attachEvent(f,e),a.a.C.fa(b,function(){b.detachEvent(f,e)})}else b.addEventListener(c,d,!1)},qa:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var g;if("input"===a.a.v(b)&&b.type&&"click"==c.toLowerCase()?(g=b.type,g="checkbox"==g||"radio"==g):g=!1,u&&!g)u(b).trigger(c);else if("function"==typeof w.createEvent){if("function"!=typeof b.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");g=w.createEvent(h[c]||"HTMLEvents"),g.initEvent(c,!0,!0,y,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(g)}else if(g&&b.click)b.click();else{if("undefined"==typeof b.fireEvent)throw Error("Browser doesn't support triggering events");b.fireEvent("on"+c)}},c:function(b){return a.F(b)?b():b},cb:function(b){return a.F(b)?b.B():b},Ia:function(b,c,g){var d;c&&("object"==typeof b.classList?(d=b.classList[g?"add":"remove"],a.a.o(c.match(m),function(a){d.call(b.classList,a)})):"string"==typeof b.className.baseVal?e(b.className,"baseVal",c,g):e(b,"className",c,g))},Ha:function(b,c){var g=a.a.c(c);(null===g||g===p)&&(g="");var d=a.e.firstChild(b);!d||3!=d.nodeType||a.e.nextSibling(d)?a.e.T(b,[b.ownerDocument.createTextNode(g)]):d.data=g,a.a.mc(b)},Rb:function(a,b){if(a.name=b,7>=g)try{a.mergeAttributes(w.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}},mc:function(a){g>=9&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},kc:function(a){if(g){var b=a.style.width;a.style.width=0,a.style.width=b}},Bc:function(b,c){b=a.a.c(b),c=a.a.c(c);for(var g=[],d=b;c>=d;d++)g.push(d);return g},O:function(a){for(var b=[],c=0,g=a.length;g>c;c++)b.push(a[c]);return b},Hc:6===g,Ic:7===g,M:g,Db:function(b,c){for(var g=a.a.O(b.getElementsByTagName("input")).concat(a.a.O(b.getElementsByTagName("textarea"))),d="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)},m=[],e=g.length-1;e>=0;e--)d(g[e])&&m.push(g[e]);return m},yc:function(b){return"string"==typeof b&&(b=a.a.ib(b))?E&&E.parse?E.parse(b):new Function("return "+b)():null},jb:function(b,c,g){if(!E||!E.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return E.stringify(a.a.c(b),c,g)},zc:function(c,g,d){d=d||{};var m=d.params||{},e=d.includeFields||this.Bb,f=c;if("object"==typeof c&&"form"===a.a.v(c))for(var f=c.action,l=e.length-1;l>=0;l--)for(var k=a.a.Db(c,e[l]),h=k.length-1;h>=0;h--)m[k[h].name]=k[h].value;g=a.a.c(g);var s=w.createElement("form");s.style.display="none",s.action=f,s.method="post";for(var p in g)c=w.createElement("input"),c.type="hidden",c.name=p,c.value=a.a.jb(a.a.c(g[p])),s.appendChild(c);b(m,function(a,b){var c=w.createElement("input");c.type="hidden",c.name=a,c.value=b,s.appendChild(c)}),w.body.appendChild(s),d.submitter?d.submitter(s):s.submit(),setTimeout(function(){s.parentNode.removeChild(s)},0)}}}(),a.b("utils",a.a),a.b("utils.arrayForEach",a.a.o),a.b("utils.arrayFirst",a.a.vb),a.b("utils.arrayFilter",a.a.xa),a.b("utils.arrayGetDistinctValues",a.a.wb),a.b("utils.arrayIndexOf",a.a.m),a.b("utils.arrayMap",a.a.Ka),a.b("utils.arrayPushAll",a.a.ia),a.b("utils.arrayRemoveItem",a.a.ya),a.b("utils.extend",a.a.extend),a.b("utils.fieldsIncludedWithJsonPost",a.a.Bb),a.b("utils.getFormFields",a.a.Db),a.b("utils.peekObservable",a.a.cb),a.b("utils.postJson",a.a.zc),a.b("utils.parseJson",a.a.yc),a.b("utils.registerEventHandler",a.a.n),a.b("utils.stringifyJson",a.a.jb),a.b("utils.range",a.a.Bc),a.b("utils.toggleDomNodeCssClass",a.a.Ia),a.b("utils.triggerEvent",a.a.qa),a.b("utils.unwrapObservable",a.a.c),a.b("utils.objectForEach",a.a.A),a.b("utils.addOrRemoveItem",a.a.ga),a.b("utils.setTextContent",a.a.Ha),a.b("unwrap",a.a.c),Function.prototype.bind||(Function.prototype.bind=function(a){var d=this;if(1===arguments.length)return function(){return d.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){var e=c.slice(0);return e.push.apply(e,arguments),d.apply(a,e)}}),a.a.f=new function(){function a(b,k){var h=b[c];if(!h||"null"===h||!e[h]){if(!k)return p;h=b[c]="ko"+d++,e[h]={}}return e[h]}var d=0,c="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===p?p:e[d]},set:function(c,d,e){(e!==p||a(c,!1)!==p)&&(a(c,!0)[d]=e)},clear:function(a){var b=a[c];return b?(delete e[b],a[c]=null,!0):!1},I:function(){return d++ +c}}},a.b("utils.domData",a.a.f),a.b("utils.domData.clear",a.a.f.clear),a.a.C=new function(){function b(b,d){var e=a.a.f.get(b,c);return e===p&&d&&(e=[],a.a.f.set(b,c,e)),e}function d(c){var e=b(c,!1);if(e)for(var e=e.slice(0),l=0;l<e.length;l++)e[l](c);if(a.a.f.clear(c),a.a.C.cleanExternalData(c),f[c.nodeType])for(e=c.firstChild;c=e;)e=c.nextSibling,8===c.nodeType&&d(c)}var c=a.a.f.I(),e={1:!0,8:!0,9:!0},f={1:!0,9:!0};return{fa:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},Pb:function(d,e){var f=b(d,!1);f&&(a.a.ya(f,e),0==f.length&&a.a.f.set(d,c,p))},S:function(b){if(e[b.nodeType]&&(d(b),f[b.nodeType])){var c=[];a.a.ia(c,b.getElementsByTagName("*"));for(var l=0,g=c.length;g>l;l++)d(c[l])}return b},removeNode:function(b){a.S(b),b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){u&&"function"==typeof u.cleanData&&u.cleanData([a])}}},a.S=a.a.C.S,a.removeNode=a.a.C.removeNode,a.b("cleanNode",a.S),a.b("removeNode",a.removeNode),a.b("utils.domNodeDisposal",a.a.C),a.b("utils.domNodeDisposal.addDisposeCallback",a.a.C.fa),a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.C.Pb),function(){a.a.ca=function(b,d){var c;if(u){if(u.parseHTML)c=u.parseHTML(b,d)||[];else if((c=u.clean([b],d))&&c[0]){for(var e=c[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{(e=d)||(e=w),c=e.parentWindow||e.defaultView||y;var f=a.a.ib(b).toLowerCase(),e=e.createElement("div"),f=f.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!f.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!f.indexOf("<td")||!f.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],k="ignored<div>"+f[1]+b+f[2]+"</div>";for("function"==typeof c.innerShiv?e.appendChild(c.innerShiv(k)):e.innerHTML=k;f[0]--;)e=e.lastChild;c=a.a.O(e.lastChild.childNodes)}return c},a.a.gb=function(b,d){if(a.a.Ra(b),d=a.a.c(d),null!==d&&d!==p)if("string"!=typeof d&&(d=d.toString()),u)u(b).html(d);else for(var c=a.a.ca(d,b.ownerDocument),e=0;e<c.length;e++)b.appendChild(c[e])}}(),a.b("utils.parseHtmlFragment",a.a.ca),a.b("utils.setHtml",a.a.gb),a.H=function(){function b(c,d){if(c)if(8==c.nodeType){var f=a.H.Lb(c.nodeValue);null!=f&&d.push({ic:c,wc:f})}else if(1==c.nodeType)for(var f=0,k=c.childNodes,h=k.length;h>f;f++)b(k[f],d)}var d={};return{$a:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return d[b]=a,"<!--[ko_memo:"+b+"]-->"},Wb:function(a,b){var f=d[a];if(f===p)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return f.apply(null,b||[]),!0}finally{delete d[a]}},Xb:function(c,d){var f=[];b(c,f);for(var k=0,h=f.length;h>k;k++){var l=f[k].ic,g=[l];d&&a.a.ia(g,d),a.H.Wb(f[k].wc,g),l.nodeValue="",l.parentNode&&l.parentNode.removeChild(l)}},Lb:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}(),a.b("memoization",a.H),a.b("memoization.memoize",a.H.$a),a.b("memoization.unmemoize",a.H.Wb),a.b("memoization.parseMemoText",a.H.Lb),a.b("memoization.unmemoizeDomNodeAndDescendants",a.H.Xb),a.Sa={throttle:function(b,d){b.throttleEvaluation=d;var c=null;return a.j({read:b,write:function(a){clearTimeout(c),c=setTimeout(function(){b(a)},d)}})},rateLimit:function(a,d){var c,e,f;"number"==typeof d?c=d:(c=d.timeout,e=d.method),f="notifyWhenChangesStop"==e?S:R,a.Za(function(a){return f(a,c)})},notify:function(a,d){a.equalityComparer="always"==d?null:J}};var Q={undefined:1,"boolean":1,number:1,string:1};a.b("extenders",a.Sa),a.Ub=function(b,d,c){this.da=b,this.La=d,this.hc=c,this.Gb=!1,a.D(this,"dispose",this.p)},a.Ub.prototype.p=function(){this.Gb=!0,this.hc()},a.Q=function(){a.a.Ga(this,a.Q.fn),this.G={},this.rb=1};var z={U:function(b,d,c){var e=this;c=c||"change";var f=new a.Ub(e,d?b.bind(d):b,function(){a.a.ya(e.G[c],f),e.ua&&e.ua(c)});return e.ja&&e.ja(c),e.G[c]||(e.G[c]=[]),e.G[c].push(f),f},notifySubscribers:function(b,d){if(d=d||"change","change"===d&&this.Yb(),this.Ba(d))try{a.k.xb();for(var f,c=this.G[d].slice(0),e=0;f=c[e];++e)f.Gb||f.La(b)}finally{a.k.end()}},Aa:function(){return this.rb},pc:function(a){return this.Aa()!==a},Yb:function(){++this.rb},Za:function(b){var e,f,k,d=this,c=a.F(d);d.ta||(d.ta=d.notifySubscribers,d.notifySubscribers=function(a,b){b&&"change"!==b?"beforeChange"===b?d.pb(a):d.ta(a,b):d.qb(a)});var h=b(function(){c&&k===d&&(k=d()),e=!1,d.Wa(f,k)&&d.ta(f=k)});d.qb=function(a){e=!0,k=a,h()},d.pb=function(a){e||(f=a,d.ta(a,"beforeChange"))}},Ba:function(a){return this.G[a]&&this.G[a].length},nc:function(b){if(b)return this.G[b]&&this.G[b].length||0;var d=0;return a.a.A(this.G,function(a,b){d+=b.length}),d},Wa:function(a,d){return!this.equalityComparer||!this.equalityComparer(a,d)},extend:function(b){var d=this;return b&&a.a.A(b,function(b,e){var f=a.Sa[b];"function"==typeof f&&(d=f(d,e)||d)}),d}};a.D(z,"subscribe",z.U),a.D(z,"extend",z.extend),a.D(z,"getSubscriptionsCount",z.nc),a.a.za&&a.a.Fa(z,Function.prototype),a.Q.fn=z,a.Hb=function(a){return null!=a&&"function"==typeof a.U&&"function"==typeof a.notifySubscribers},a.b("subscribable",a.Q),a.b("isSubscribable",a.Hb),a.Z=a.k=function(){function b(a){c.push(e),e=a}function d(){e=c.pop()}var e,c=[],f=0;return{xb:b,end:d,Ob:function(b){if(e){if(!a.Hb(b))throw Error("Only subscribable things can act as dependencies");e.La(b,b.ac||(b.ac=++f))}},u:function(a,c,e){try{return b(),a.apply(c,e||[])}finally{d()}},oa:function(){return e?e.w.oa():void 0},Ca:function(){return e?e.Ca:void 0}}}(),a.b("computedContext",a.Z),a.b("computedContext.getDependenciesCount",a.Z.oa),a.b("computedContext.isInitial",a.Z.Ca),a.b("computedContext.isSleeping",a.Z.Jc),a.b("ignoreDependencies",a.Gc=a.k.u),a.r=function(b){function d(){return 0<arguments.length?(d.Wa(c,arguments[0])&&(d.X(),c=arguments[0],d.W()),this):(a.k.Ob(d),c)}var c=b;return a.Q.call(d),a.a.Ga(d,a.r.fn),d.B=function(){return c},d.W=function(){d.notifySubscribers(c)},d.X=function(){d.notifySubscribers(c,"beforeChange")},a.D(d,"peek",d.B),a.D(d,"valueHasMutated",d.W),a.D(d,"valueWillMutate",d.X),d},a.r.fn={equalityComparer:J};var H=a.r.Ac="__ko_proto__";a.r.fn[H]=a.r,a.a.za&&a.a.Fa(a.r.fn,a.Q.fn),a.Ta=function(b,d){return null===b||b===p||b[H]===p?!1:b[H]===d?!0:a.Ta(b[H],d)},a.F=function(b){return a.Ta(b,a.r)},a.Da=function(b){return"function"==typeof b&&b[H]===a.r||"function"==typeof b&&b[H]===a.j&&b.qc?!0:!1},a.b("observable",a.r),a.b("isObservable",a.F),a.b("isWriteableObservable",a.Da),a.b("isWritableObservable",a.Da),a.ba=function(b){if(b=b||[],"object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return b=a.r(b),a.a.Ga(b,a.ba.fn),b.extend({trackArrayChanges:!0})},a.ba.fn={remove:function(b){for(var d=this.B(),c=[],e="function"!=typeof b||a.F(b)?function(a){return a===b}:b,f=0;f<d.length;f++){var k=d[f];e(k)&&(0===c.length&&this.X(),c.push(k),d.splice(f,1),f--)}return c.length&&this.W(),c},removeAll:function(b){if(b===p){var d=this.B(),c=d.slice(0);return this.X(),d.splice(0,d.length),this.W(),c}return b?this.remove(function(c){return 0<=a.a.m(b,c)}):[]},destroy:function(b){var d=this.B(),c="function"!=typeof b||a.F(b)?function(a){return a===b}:b;this.X();for(var e=d.length-1;e>=0;e--)c(d[e])&&(d[e]._destroy=!0);this.W()},destroyAll:function(b){return b===p?this.destroy(function(){return!0}):b?this.destroy(function(d){return 0<=a.a.m(b,d)}):[]},indexOf:function(b){var d=this();return a.a.m(d,b)},replace:function(a,d){var c=this.indexOf(a);c>=0&&(this.X(),this.B()[c]=d,this.W())}},a.a.o("pop push reverse shift sort splice unshift".split(" "),function(b){a.ba.fn[b]=function(){var a=this.B();return this.X(),this.yb(a,b,arguments),a=a[b].apply(a,arguments),this.W(),a}}),a.a.o(["slice"],function(b){a.ba.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}}),a.a.za&&a.a.Fa(a.ba.fn,a.r.fn),a.b("observableArray",a.ba),a.Sa.trackArrayChanges=function(b){function d(){if(!c){c=!0;var g=b.notifySubscribers;b.notifySubscribers=function(a,b){return b&&"change"!==b||++k,g.apply(this,arguments)};var d=[].concat(b.B()||[]);e=null,f=b.U(function(c){if(c=[].concat(c||[]),b.Ba("arrayChange")){var g;(!e||k>1)&&(e=a.a.Ma(d,c,{sparse:!0})),g=e}d=c,e=null,k=0,g&&g.length&&b.notifySubscribers(g,"arrayChange")})}}if(!b.yb){var f,c=!1,e=null,k=0,h=b.ja,l=b.ua;b.ja=function(a){h&&h.call(b,a),"arrayChange"===a&&d()},b.ua=function(a){l&&l.call(b,a),
"arrayChange"!==a||b.Ba("arrayChange")||(f.p(),c=!1)},b.yb=function(b,d,f){function l(a,b,c){return h[h.length]={status:a,value:b,index:c}}if(c&&!k){var h=[],r=b.length,v=f.length,t=0;switch(d){case"push":t=r;case"unshift":for(d=0;v>d;d++)l("added",f[d],t+d);break;case"pop":t=r-1;case"shift":r&&l("deleted",b[t],t);break;case"splice":d=Math.min(Math.max(0,0>f[0]?r+f[0]:f[0]),r);for(var r=1===v?r:Math.min(d+(f[1]||0),r),v=d+v-2,t=Math.max(r,v),G=[],A=[],p=2;t>d;++d,++p)r>d&&A.push(l("deleted",b[d],d)),v>d&&G.push(l("added",f[p],d));a.a.Cb(A,G);break;default:return}e=h}}}},a.w=a.j=function(b,d,c){function e(a,b,c){if(I&&b===g)throw Error("A 'pure' computed must not be called recursively");B[a]=c,c.sa=F++,c.ea=b.Aa()}function f(){var a,b;for(a in B)if(B.hasOwnProperty(a)&&(b=B[a],b.da.pc(b.ea)))return!0}function k(){!s&&B&&a.a.A(B,function(a,b){b.p&&b.p()}),B=null,F=0,G=!0,s=r=!1}function h(){var a=g.throttleEvaluation;a&&a>=0?(clearTimeout(z),z=setTimeout(function(){l(!0)},a)):g.nb?g.nb():l(!0)}function l(b){if(!v&&!G){if(y&&y()){if(!t)return void w()}else t=!1;v=!0;try{var c=B,m=F,f=I?p:!F;a.k.xb({La:function(a,b){G||(m&&c[b]?(e(b,a,c[b]),delete c[b],--m):B[b]||e(b,a,s?{da:a}:a.U(h)))},w:g,Ca:f}),B={},F=0;try{var l=d?A.call(d):A()}finally{a.k.end(),m&&!s&&a.a.A(c,function(a,b){b.p&&b.p()}),r=!1}g.Wa(n,l)&&(s||q(n,"beforeChange"),n=l,s?g.Yb():b&&q(n)),f&&q(n,"awake")}finally{v=!1}F||w()}}function g(){if(0<arguments.length){if("function"!=typeof C)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return C.apply(d,arguments),this}return a.k.Ob(g),(r||s&&f())&&l(),n}function m(){return(r&&!F||s&&f())&&l(),n}function x(){return r||F>0}function q(a,b){g.notifySubscribers(a,b)}var n,r=!0,v=!1,t=!1,G=!1,A=b,I=!1,s=!1;if(A&&"object"==typeof A?(c=A,A=c.read):(c=c||{},A||(A=c.read)),"function"!=typeof A)throw Error("Pass a function that returns the value of the ko.computed");var C=c.write,D=c.disposeWhenNodeIsRemoved||c.q||null,u=c.disposeWhen||c.Pa,y=u,w=k,B={},F=0,z=null;d||(d=c.owner),a.Q.call(g),a.a.Ga(g,a.j.fn),g.B=m,g.oa=function(){return F},g.qc="function"==typeof C,g.p=function(){w()},g.$=x;var T=g.Za;return g.Za=function(a){T.call(g,a),g.nb=function(){g.pb(n),r=!0,g.qb(g)}},c.pure?(s=I=!0,g.ja=function(b){if(!G&&s&&"change"==b){if(s=!1,r||f())B=null,F=0,r=!0,l();else{var c=[];a.a.A(B,function(a,b){c[b.sa]=a}),a.a.o(c,function(a,b){var c=B[a],g=c.da.U(h);g.sa=b,g.ea=c.ea,B[a]=g})}G||q(n,"awake")}},g.ua=function(b){G||"change"!=b||g.Ba("change")||(a.a.A(B,function(a,b){b.p&&(B[a]={da:b.da,sa:b.sa,ea:b.ea},b.p())}),s=!0,q(p,"asleep"))},g.bc=g.Aa,g.Aa=function(){return s&&(r||f())&&l(),g.bc()}):c.deferEvaluation&&(g.ja=function(a){"change"!=a&&"beforeChange"!=a||m()}),a.D(g,"peek",g.B),a.D(g,"dispose",g.p),a.D(g,"isActive",g.$),a.D(g,"getDependenciesCount",g.oa),D&&(t=!0,D.nodeType&&(y=function(){return!a.a.Qa(D)||u&&u()})),s||c.deferEvaluation||l(),D&&x()&&D.nodeType&&(w=function(){a.a.C.Pb(D,w),k()},a.a.C.fa(D,w)),g},a.sc=function(b){return a.Ta(b,a.j)},z=a.r.Ac,a.j[z]=a.r,a.j.fn={equalityComparer:J},a.j.fn[z]=a.j,a.a.za&&a.a.Fa(a.j.fn,a.Q.fn),a.b("dependentObservable",a.j),a.b("computed",a.j),a.b("isComputed",a.sc),a.Nb=function(b,d){return"function"==typeof b?a.w(b,d,{pure:!0}):(b=a.a.extend({},b),b.pure=!0,a.w(b,d))},a.b("pureComputed",a.Nb),function(){function b(a,f,k){if(k=k||new c,a=f(a),"object"!=typeof a||null===a||a===p||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean)return a;var h=a instanceof Array?[]:{};return k.save(a,h),d(a,function(c){var g=f(a[c]);switch(typeof g){case"boolean":case"number":case"string":case"function":h[c]=g;break;case"object":case"undefined":var d=k.get(g);h[c]=d!==p?d:b(g,f,k)}}),h}function d(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function c(){this.keys=[],this.mb=[]}a.Vb=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var c=0;a.F(b)&&10>c;c++)b=b();return b})},a.toJSON=function(b,c,d){return b=a.Vb(b),a.a.jb(b,c,d)},c.prototype={save:function(b,c){var d=a.a.m(this.keys,b);d>=0?this.mb[d]=c:(this.keys.push(b),this.mb.push(c))},get:function(b){return b=a.a.m(this.keys,b),b>=0?this.mb[b]:p}}}(),a.b("toJS",a.Vb),a.b("toJSON",a.toJSON),function(){a.i={s:function(b){switch(a.a.v(b)){case"option":return!0===b.__ko__hasDomDataOptionValue__?a.a.f.get(b,a.d.options.ab):7>=a.a.M?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return 0<=b.selectedIndex?a.i.s(b.options[b.selectedIndex]):p;default:return b.value}},Y:function(b,d,c){switch(a.a.v(b)){case"option":switch(typeof d){case"string":a.a.f.set(b,a.d.options.ab,p),"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__,b.value=d;break;default:a.a.f.set(b,a.d.options.ab,d),b.__ko__hasDomDataOptionValue__=!0,b.value="number"==typeof d?d:""}break;case"select":(""===d||null===d)&&(d=p);for(var h,e=-1,f=0,k=b.options.length;k>f;++f)if(h=a.i.s(b.options[f]),h==d||""==h&&d===p){e=f;break}(c||e>=0||d===p&&1<b.size)&&(b.selectedIndex=e);break;default:(null===d||d===p)&&(d=""),b.value=d}}}}(),a.b("selectExtensions",a.i),a.b("selectExtensions.readValue",a.i.s),a.b("selectExtensions.writeValue",a.i.Y),a.h=function(){function b(b){b=a.a.ib(b),123===b.charCodeAt(0)&&(b=b.slice(1,-1));var x,c=[],d=b.match(e),h=[],n=0;if(d){d.push(",");for(var v,r=0;v=d[r];++r){var t=v.charCodeAt(0);if(44===t){if(0>=n){c.push(x&&h.length?{key:x,value:h.join("")}:{unknown:x||h.join("")}),x=n=0,h=[];continue}}else if(58===t){if(!n&&!x&&1===h.length){x=h.pop();continue}}else 47===t&&r&&1<v.length?(t=d[r-1].match(f))&&!k[t[0]]&&(b=b.substr(b.indexOf(v)+1),d=b.match(e),d.push(","),r=-1,v="/"):40===t||123===t||91===t?++n:41===t||125===t||93===t?--n:x||h.length||34!==t&&39!==t||(v=v.slice(1,-1));h.push(v)}}return c}var d=["true","false","null","undefined"],c=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,e=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,k={"in":1,"return":1,"typeof":1},h={};return{ka:[],V:h,bb:b,Ea:function(e,g){function m(b,g){var e;if(!r){var l=a.getBindingHandler(b);if(l&&l.preprocess&&!(g=l.preprocess(g,b,m)))return;(l=h[b])&&(e=g,0<=a.a.m(d,e)?e=!1:(l=e.match(c),e=null===l?!1:l[1]?"Object("+l[1]+")"+l[2]:e),l=e),l&&k.push("'"+b+"':function(_z){"+e+"=_z}")}n&&(g="function(){return "+g+" }"),f.push("'"+b+"':"+g)}g=g||{};var f=[],k=[],n=g.valueAccessors,r=g.bindingParams,v="string"==typeof e?b(e):e;return a.a.o(v,function(a){m(a.key||a.unknown,a.value)}),k.length&&m("_ko_property_writers","{"+k.join(",")+" }"),f.join(",")},vc:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},ra:function(b,c,d,e,f){b&&a.F(b)?!a.Da(b)||f&&b.B()===e||b(e):(b=c.get("_ko_property_writers"))&&b[d]&&b[d](e)}}}(),a.b("expressionRewriting",a.h),a.b("expressionRewriting.bindingRewriteValidators",a.h.ka),a.b("expressionRewriting.parseObjectLiteral",a.h.bb),a.b("expressionRewriting.preProcessBindings",a.h.Ea),a.b("expressionRewriting._twoWayBindings",a.h.V),a.b("jsonExpressionRewriting",a.h),a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.Ea),function(){function b(a){return 8==a.nodeType&&k.test(f?a.text:a.nodeValue)}function d(a){return 8==a.nodeType&&h.test(f?a.text:a.nodeValue)}function c(a,c){for(var e=a,f=1,l=[];e=e.nextSibling;){if(d(e)&&(f--,0===f))return l;l.push(e),b(e)&&f++}if(!c)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function e(a,b){var d=c(a,b);return d?0<d.length?d[d.length-1].nextSibling:a.nextSibling:null}var f=w&&"<!--test-->"===w.createComment("test").text,k=f?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,h=f?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0};a.e={R:{},childNodes:function(a){return b(a)?c(a):a.childNodes},ma:function(c){if(b(c)){c=a.e.childNodes(c);for(var d=0,e=c.length;e>d;d++)a.removeNode(c[d])}else a.a.Ra(c)},T:function(c,d){if(b(c)){a.e.ma(c);for(var e=c.nextSibling,f=0,l=d.length;l>f;f++)e.parentNode.insertBefore(d[f],e)}else a.a.T(c,d)},Mb:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},Fb:function(c,d,e){e?b(c)?c.parentNode.insertBefore(d,e.nextSibling):e.nextSibling?c.insertBefore(d,e.nextSibling):c.appendChild(d):a.e.Mb(c,d)},firstChild:function(a){return b(a)?!a.nextSibling||d(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){return b(a)&&(a=e(a)),a.nextSibling&&d(a.nextSibling)?null:a.nextSibling},oc:b,Fc:function(a){return(a=(f?a.text:a.nodeValue).match(k))?a[1]:null},Kb:function(c){if(l[a.a.v(c)]){var m=c.firstChild;if(m)do if(1===m.nodeType){var f;f=m.firstChild;var h=null;if(f)do if(h)h.push(f);else if(b(f)){var k=e(f,!0);k?f=k:h=[f]}else d(f)&&(h=[f]);while(f=f.nextSibling);if(f=h)for(h=m.nextSibling,k=0;k<f.length;k++)h?c.insertBefore(f[k],h):c.appendChild(f[k])}while(m=m.nextSibling)}}}}(),a.b("virtualElements",a.e),a.b("virtualElements.allowedBindings",a.e.R),a.b("virtualElements.emptyNode",a.e.ma),a.b("virtualElements.insertAfter",a.e.Fb),a.b("virtualElements.prepend",a.e.Mb),a.b("virtualElements.setDomNodeChildren",a.e.T),function(){a.L=function(){this.ec={}},a.a.extend(a.L.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);case 8:return a.e.oc(b);default:return!1}},getBindings:function(b,d){var c=this.getBindingsString(b,d),c=c?this.parseBindingsString(c,d,b):null;return a.g.sb(c,b,d,!1)},getBindingAccessors:function(b,d){var c=this.getBindingsString(b,d),c=c?this.parseBindingsString(c,d,b,{valueAccessors:!0}):null;return a.g.sb(c,b,d,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.e.Fc(b);default:return null}},parseBindingsString:function(b,d,c,e){try{var h,f=this.ec,k=b+(e&&e.valueAccessors||"");if(!(h=f[k])){var l,g="with($context){with($data||{}){return{"+a.h.Ea(b,e)+"}}}";l=new Function("$context","$element",g),h=f[k]=l}return h(d,c)}catch(m){throw m.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+m.message,m}}}),a.L.instance=new a.L}(),a.b("bindingProvider",a.L),function(){function b(a){return function(){return a}}function d(a){return a()}function c(b){return a.a.pa(a.k.u(b),function(a,c){return function(){return b()[c]}})}function e(d,g,e){return"function"==typeof d?c(d.bind(null,g,e)):a.a.pa(d,b)}function f(a,b){return c(this.getBindings.bind(this,a,b))}function k(b,c,d){var g,e=a.e.firstChild(c),f=a.L.instance,m=f.preprocessNode;if(m){for(;g=e;)e=a.e.nextSibling(g),m.call(f,g);e=a.e.firstChild(c)}for(;g=e;)e=a.e.nextSibling(g),h(b,g,d)}function h(b,c,d){var e=!0,f=1===c.nodeType;f&&a.e.Kb(c),(f&&d||a.L.instance.nodeHasBindings(c))&&(e=g(c,null,b,d).shouldBindDescendants),e&&!x[a.a.v(c)]&&k(b,c,!f)}function l(b){var c=[],d={},g=[];return a.a.A(b,function I(e){if(!d[e]){var f=a.getBindingHandler(e);f&&(f.after&&(g.push(e),a.a.o(f.after,function(c){if(b[c]){if(-1!==a.a.m(g,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+g.join(", "));I(c)}}),g.length--),c.push({key:e,Eb:f})),d[e]=!0}}),c}function g(b,c,g,e){var m=a.a.f.get(b,q);if(!c){if(m)throw Error("You cannot apply bindings multiple times to the same element.");a.a.f.set(b,q,!0)}!m&&e&&a.Tb(b,g);var h;if(c&&"function"!=typeof c)h=c;else{var k=a.L.instance,x=k.getBindingAccessors||f,n=a.j(function(){return(h=c?c(g,b):x.call(k,b,g))&&g.K&&g.K(),h},null,{q:b});h&&n.$()||(n=null)}var u;if(h){var w=n?function(a){return function(){return d(n()[a])}}:function(a){return h[a]},y=function(){return a.a.pa(n?n():h,d)};y.get=function(a){return h[a]&&d(w(a))},y.has=function(a){return a in h},e=l(h),a.a.o(e,function(c){var d=c.Eb.init,e=c.Eb.update,f=c.key;if(8===b.nodeType&&!a.e.R[f])throw Error("The binding '"+f+"' cannot be used with virtual elements");try{"function"==typeof d&&a.k.u(function(){var a=d(b,w(f),y,g.$data,g);if(a&&a.controlsDescendantBindings){if(u!==p)throw Error("Multiple bindings ("+u+" and "+f+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");u=f}}),"function"==typeof e&&a.j(function(){e(b,w(f),y,g.$data,g)},null,{q:b})}catch(m){throw m.message='Unable to process binding "'+f+": "+h[f]+'"\nMessage: '+m.message,m}})}return{shouldBindDescendants:u===p}}function m(b){return b&&b instanceof a.N?b:new a.N(b)}a.d={};var x={script:!0,textarea:!0};a.getBindingHandler=function(b){return a.d[b]},a.N=function(b,c,d,g){var m,e=this,f="function"==typeof b&&!a.F(b),l=a.j(function(){var m=f?b():b,h=a.a.c(m);return c?(c.K&&c.K(),a.a.extend(e,c),l&&(e.K=l)):(e.$parents=[],e.$root=h,e.ko=a),e.$rawData=m,e.$data=h,d&&(e[d]=h),g&&g(e,c,h),e.$data},null,{Pa:function(){return m&&!a.a.tb(m)},q:!0});l.$()&&(e.K=l,l.equalityComparer=null,m=[],l.Zb=function(b){m.push(b),a.a.C.fa(b,function(b){a.a.ya(m,b),m.length||(l.p(),e.K=l=p)})})},a.N.prototype.createChildContext=function(b,c,d){return new a.N(b,this,c,function(a,b){a.$parentContext=b,a.$parent=b.$data,a.$parents=(b.$parents||[]).slice(0),a.$parents.unshift(a.$parent),d&&d(a)})},a.N.prototype.extend=function(b){return new a.N(this.K||this.$data,this,null,function(c,d){c.$rawData=d.$rawData,a.a.extend(c,"function"==typeof b?b():b)})};var q=a.a.f.I(),n=a.a.f.I();a.Tb=function(b,c){return 2!=arguments.length?a.a.f.get(b,n):(a.a.f.set(b,n,c),void(c.K&&c.K.Zb(b)))},a.va=function(b,c,d){return 1===b.nodeType&&a.e.Kb(b),g(b,c,m(d),!0)},a.cc=function(b,c,d){return d=m(d),a.va(b,e(c,d,b),d)},a.Ja=function(a,b){1!==b.nodeType&&8!==b.nodeType||k(m(a),b,!0)},a.ub=function(a,b){if(!u&&y.jQuery&&(u=y.jQuery),b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||y.document.body,h(m(a),b,!0)},a.Oa=function(b){switch(b.nodeType){case 1:case 8:var c=a.Tb(b);if(c)return c;if(b.parentNode)return a.Oa(b.parentNode)}return p},a.gc=function(b){return(b=a.Oa(b))?b.$data:p},a.b("bindingHandlers",a.d),a.b("applyBindings",a.ub),a.b("applyBindingsToDescendants",a.Ja),a.b("applyBindingAccessorsToNode",a.va),a.b("applyBindingsToNode",a.cc),a.b("contextFor",a.Oa),a.b("dataFor",a.gc)}(),function(b){function d(d,e){var m,g=f.hasOwnProperty(d)?f[d]:b;g?g.U(e):(g=f[d]=new a.Q,g.U(e),c(d,function(a,b){var c=!(!b||!b.synchronous);k[d]={definition:a,tc:c},delete f[d],m||c?g.notifySubscribers(a):setTimeout(function(){g.notifySubscribers(a)},0)}),m=!0)}function c(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a,c)}):b(null,null)})}function e(c,d,g,f){f||(f=a.g.loaders.slice(0));var k=f.shift();if(k){var q=k[c];if(q){var n=!1;if(q.apply(k,d.concat(function(a){n?g(null):null!==a?g(a):e(c,d,g,f)}))!==b&&(n=!0,!k.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else e(c,d,g,f)}else g(null)}var f={},k={};a.g={get:function(c,e){var g=k.hasOwnProperty(c)?k[c]:b;g?g.tc?a.k.u(function(){e(g.definition)}):setTimeout(function(){e(g.definition)},0):d(c,e)},zb:function(a){delete k[a]},ob:e},a.g.loaders=[],a.b("components",a.g),a.b("components.get",a.g.get),a.b("components.clearCachedDefinition",a.g.zb)}(),function(){function b(b,c,d,e){function k(){0===--v&&e(h)}var h={},v=2,t=d.template;d=d.viewModel,t?f(c,t,function(c){a.g.ob("loadTemplate",[b,c],function(a){h.template=a,k()})}):k(),d?f(c,d,function(c){a.g.ob("loadViewModel",[b,c],function(a){h[l]=a,k()})}):k()}function d(a,b,c){if("function"==typeof b)c(function(a){return new b(a)});else if("function"==typeof b[l])c(b[l]);else if("instance"in b){var e=b.instance;c(function(){return e})}else"viewModel"in b?d(a,b.viewModel,c):a("Unknown viewModel value: "+b)}function c(b){switch(a.a.v(b)){case"script":return a.a.ca(b.text);case"textarea":return a.a.ca(b.value);case"template":if(e(b.content))return a.a.la(b.content.childNodes)}return a.a.la(b.childNodes)}function e(a){return y.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function f(a,b,c){"string"==typeof b.require?O||y.require?(O||y.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function k(a){return function(b){throw Error("Component '"+a+"': "+b)}}var h={};a.g.register=function(b,c){if(!c)throw Error("Invalid configuration for "+b);if(a.g.Xa(b))throw Error("Component "+b+" is already registered");h[b]=c},a.g.Xa=function(a){return a in h},a.g.Ec=function(b){delete h[b],a.g.zb(b)},a.g.Ab={getConfig:function(a,b){b(h.hasOwnProperty(a)?h[a]:null)},loadComponent:function(a,c,d){var e=k(a);f(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,d,f){if(b=k(b),"string"==typeof d)f(a.a.ca(d));else if(d instanceof Array)f(d);else if(e(d))f(a.a.O(d.childNodes));else if(d.element)if(d=d.element,y.HTMLElement?d instanceof HTMLElement:d&&d.tagName&&1===d.nodeType)f(c(d));else if("string"==typeof d){var l=w.getElementById(d);l?f(c(l)):b("Cannot find element with ID "+d)}else b("Unknown element type: "+d);else b("Unknown template value: "+d)},loadViewModel:function(a,b,c){d(k(a),b,c)}};var l="createViewModel";a.b("components.register",a.g.register),a.b("components.isRegistered",a.g.Xa),a.b("components.unregister",a.g.Ec),a.b("components.defaultLoader",a.g.Ab),a.g.loaders.push(a.g.Ab),a.g.$b=h}(),function(){function b(b,e){var f=b.getAttribute("params");if(f){var f=d.parseBindingsString(f,e,b,{valueAccessors:!0,bindingParams:!0}),f=a.a.pa(f,function(d){return a.w(d,null,{q:b})}),k=a.a.pa(f,function(d){var e=d.B();return d.$()?a.w({read:function(){return a.a.c(d())},write:a.Da(e)&&function(a){d()(a)},q:b}):e});return k.hasOwnProperty("$raw")||(k.$raw=f),k}return{$raw:{}}}a.g.getComponentNameForNode=function(b){return b=a.a.v(b),a.g.Xa(b)&&b},a.g.sb=function(c,d,f,k){if(1===d.nodeType){var h=a.g.getComponentNameForNode(d);if(h){if(c=c||{},c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var l={name:h,params:b(d,f)};c.component=k?function(){return l}:l}}return c};var d=new a.L;9>a.a.M&&(a.g.register=function(a){return function(b){return w.createElement(b),a.apply(this,arguments)}}(a.g.register),w.createDocumentFragment=function(b){return function(){var k,d=b(),f=a.g.$b;for(k in f)f.hasOwnProperty(k)&&d.createElement(k);return d}}(w.createDocumentFragment))}(),function(b){function d(b,c,d){if(c=c.template,!c)throw Error("Component '"+b+"' has no template");b=a.a.la(c),a.e.T(d,b)}function c(a,b,c,d){var e=a.createViewModel;return e?e.call(a,d,{element:b,templateNodes:c}):d}var e=0;a.d.component={init:function(f,k,h,l,g){function m(){var a=x&&x.dispose;"function"==typeof a&&a.call(x),q=null}var x,q,n=a.a.O(a.e.childNodes(f));return a.a.C.fa(f,m),a.w(function(){var h,t,l=a.a.c(k());if("string"==typeof l?h=l:(h=a.a.c(l.name),t=a.a.c(l.params)),!h)throw Error("No component name specified");var p=q=++e;a.g.get(h,function(e){if(q===p){if(m(),!e)throw Error("Unknown component '"+h+"'");d(h,e,f);var l=c(e,f,n,t);e=g.createChildContext(l,b,function(a){a.$component=l,a.$componentTemplateNodes=n}),x=l,a.Ja(e,f)}})},null,{q:f}),{controlsDescendantBindings:!0}}},a.e.R.component=!0}();var P={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,d){var c=a.a.c(d())||{};a.a.A(c,function(c,d){d=a.a.c(d);var k=!1===d||null===d||d===p;k&&b.removeAttribute(c),8>=a.a.M&&c in P?(c=P[c],k?b.removeAttribute(c):b[c]=d):k||b.setAttribute(c,d.toString()),"name"===c&&a.a.Rb(b,k?"":d.toString())})}},function(){a.d.checked={after:["value","attr"],init:function(b,d,c){function e(){var e=b.checked,f=x?k():e;if(!a.Z.Ca()&&(!l||e)){var h=a.k.u(d);g?m!==f?(e&&(a.a.ga(h,f,!0),a.a.ga(h,m,!1)),m=f):a.a.ga(h,f,e):a.h.ra(h,c,"checked",f,!0)}}function f(){var c=a.a.c(d());b.checked=g?0<=a.a.m(c,k()):h?c:k()===c}var k=a.Nb(function(){return c.has("checkedValue")?a.a.c(c.get("checkedValue")):c.has("value")?a.a.c(c.get("value")):b.value}),h="checkbox"==b.type,l="radio"==b.type;if(h||l){var g=h&&a.a.c(d())instanceof Array,m=g?k():p,x=l||g;l&&!b.name&&a.d.uniqueName.init(b,function(){return!0}),a.w(e,null,{q:b}),a.a.n(b,"click",e),a.w(f,null,{q:b})}}},a.h.V.checked=!0,a.d.checkedValue={update:function(b,d){b.value=a.a.c(d())}}}(),a.d.css={update:function(b,d){var c=a.a.c(d());null!==c&&"object"==typeof c?a.a.A(c,function(c,d){d=a.a.c(d),a.a.Ia(b,c,d)}):(c=String(c||""),a.a.Ia(b,b.__ko__cssValue,!1),b.__ko__cssValue=c,a.a.Ia(b,c,!0))}},a.d.enable={update:function(b,d){var c=a.a.c(d());c&&b.disabled?b.removeAttribute("disabled"):c||b.disabled||(b.disabled=!0)}},a.d.disable={update:function(b,d){a.d.enable.update(b,function(){return!a.a.c(d())})}},a.d.event={init:function(b,d,c,e,f){var k=d()||{};a.a.A(k,function(h){"string"==typeof h&&a.a.n(b,h,function(b){var g,m=d()[h];if(m){try{var k=a.a.O(arguments);e=f.$data,k.unshift(e),g=m.apply(e,k)}finally{!0!==g&&(b.preventDefault?b.preventDefault():b.returnValue=!1)}!1===c.get(h+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}},a.d.foreach={Ib:function(b){return function(){var d=b(),c=a.a.cb(d);return c&&"number"!=typeof c.length?(a.a.c(d),{foreach:c.data,as:c.as,includeDestroyed:c.includeDestroyed,afterAdd:c.afterAdd,beforeRemove:c.beforeRemove,afterRender:c.afterRender,beforeMove:c.beforeMove,afterMove:c.afterMove,templateEngine:a.P.Va}):{foreach:d,templateEngine:a.P.Va}}},init:function(b,d){return a.d.template.init(b,a.d.foreach.Ib(d))},update:function(b,d,c,e,f){return a.d.template.update(b,a.d.foreach.Ib(d),c,e,f)}},a.h.ka.foreach=!1,a.e.R.foreach=!0,a.d.hasfocus={init:function(b,d,c){function e(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(m){g=f.body}e=g===b}f=d(),a.h.ra(f,c,"hasfocus",e,!0),b.__ko_hasfocusLastValue=e,b.__ko_hasfocusUpdating=!1}var f=e.bind(null,!0),k=e.bind(null,!1);a.a.n(b,"focus",f),a.a.n(b,"focusin",f),a.a.n(b,"blur",k),a.a.n(b,"focusout",k)},update:function(b,d){var c=!!a.a.c(d());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===c||(c?b.focus():b.blur(),a.k.u(a.a.qa,null,[b,c?"focusin":"focusout"]))}},a.h.V.hasfocus=!0,a.d.hasFocus=a.d.hasfocus,a.h.V.hasFocus=!0,a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,d){a.a.gb(b,d())}},K("if"),K("ifnot",!1,!0),K("with",!0,!1,function(a,d){return a.createChildContext(d)});var L={};a.d.options={init:function(b){if("select"!==a.a.v(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,d,c){function e(){return a.a.xa(b.options,function(a){return a.selected})}function f(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function k(d,e){if(r&&m)a.i.Y(b,a.a.c(c.get("value")),!0);else if(n.length){var g=0<=a.a.m(n,a.i.s(e[0]));a.a.Sb(e[0],g),r&&!g&&a.k.u(a.a.qa,null,[b,"change"])}}var h=b.multiple,l=0!=b.length&&h?b.scrollTop:null,g=a.a.c(d()),m=c.get("valueAllowUnset")&&c.has("value"),x=c.get("optionsIncludeDestroyed");d={};var q,n=[];m||(h?n=a.a.Ka(e(),a.i.s):0<=b.selectedIndex&&n.push(a.i.s(b.options[b.selectedIndex]))),g&&("undefined"==typeof g.length&&(g=[g]),q=a.a.xa(g,function(b){return x||b===p||null===b||!a.a.c(b._destroy)}),c.has("optionsCaption")&&(g=a.a.c(c.get("optionsCaption")),null!==g&&g!==p&&q.unshift(L)));var r=!1;d.beforeRemove=function(a){b.removeChild(a)},g=k,c.has("optionsAfterRender")&&"function"==typeof c.get("optionsAfterRender")&&(g=function(b,d){k(0,d),a.k.u(c.get("optionsAfterRender"),null,[d[0],b!==L?b:p])}),a.a.fb(b,q,function(d,e,g){return g.length&&(n=!m&&g[0].selected?[a.i.s(g[0])]:[],r=!0),e=b.ownerDocument.createElement("option"),d===L?(a.a.Ha(e,c.get("optionsCaption")),a.i.Y(e,p)):(g=f(d,c.get("optionsValue"),d),a.i.Y(e,a.a.c(g)),d=f(d,c.get("optionsText"),g),a.a.Ha(e,d)),[e]},d,g),a.k.u(function(){m?a.i.Y(b,a.a.c(c.get("value")),!0):(h?n.length&&e().length<n.length:n.length&&0<=b.selectedIndex?a.i.s(b.options[b.selectedIndex])!==n[0]:n.length||0<=b.selectedIndex)&&a.a.qa(b,"change")}),a.a.kc(b),l&&20<Math.abs(l-b.scrollTop)&&(b.scrollTop=l)}},a.d.options.ab=a.a.f.I(),a.d.selectedOptions={after:["options","foreach"],init:function(b,d,c){a.a.n(b,"change",function(){var e=d(),f=[];a.a.o(b.getElementsByTagName("option"),function(b){b.selected&&f.push(a.i.s(b))}),a.h.ra(e,c,"selectedOptions",f)})},update:function(b,d){if("select"!=a.a.v(b))throw Error("values binding applies only to SELECT elements");var c=a.a.c(d());c&&"number"==typeof c.length&&a.a.o(b.getElementsByTagName("option"),function(b){var d=0<=a.a.m(c,a.i.s(b));a.a.Sb(b,d)})}},a.h.V.selectedOptions=!0,a.d.style={update:function(b,d){var c=a.a.c(d()||{});a.a.A(c,function(c,d){d=a.a.c(d),(null===d||d===p||!1===d)&&(d=""),b.style[c]=d})}},a.d.submit={init:function(b,d,c,e,f){if("function"!=typeof d())throw Error("The value for a submit binding must be a function");a.a.n(b,"submit",function(a){var c,e=d();try{c=e.call(f.$data,b)}finally{!0!==c&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}},a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,d){a.a.Ha(b,d())}},a.e.R.text=!0,function(){if(y&&y.navigator)var b=function(a){return a?parseFloat(a[1]):void 0},d=y.opera&&y.opera.version&&parseInt(y.opera.version()),c=y.navigator.userAgent,e=b(c.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),f=b(c.match(/Firefox\/([^ ]*)/));if(10>a.a.M)var k=a.a.f.I(),h=a.a.f.I(),l=function(b){var c=this.activeElement;(c=c&&a.a.f.get(c,h))&&c(b)},g=function(b,c){var d=b.ownerDocument;a.a.f.get(d,k)||(a.a.f.set(d,k,!0),a.a.n(d,"selectionchange",l)),a.a.f.set(b,h,c)};a.d.textInput={init:function(b,c,l){function h(c,d){a.a.n(b,c,d)}function k(){var d=a.a.c(c());(null===d||d===p)&&(d=""),w!==p&&d===w?setTimeout(k,4):b.value!==d&&(u=d,b.value=d)}function v(){A||(w=b.value,A=setTimeout(t,4))}function t(){clearTimeout(A),w=A=p;var d=b.value;u!==d&&(u=d,a.h.ra(c(),l,"textInput",d))}var A,w,u=b.value;10>a.a.M?(h("propertychange",function(a){"value"===a.propertyName&&t()}),8==a.a.M&&(h("keyup",t),h("keydown",t)),8<=a.a.M&&(g(b,t),h("dragend",v))):(h("input",t),5>e&&"textarea"===a.a.v(b)?(h("keydown",v),h("paste",v),h("cut",v)):11>d?h("keydown",v):4>f&&(h("DOMAutoComplete",t),h("dragdrop",t),h("drop",t))),h("change",t),a.w(k,null,{q:b})}},a.h.V.textInput=!0,a.d.textinput={preprocess:function(a,b,c){c("textInput",a)}}}(),a.d.uniqueName={init:function(b,d){if(d()){var c="ko_unique_"+ ++a.d.uniqueName.fc;a.a.Rb(b,c)}}},a.d.uniqueName.fc=0,a.d.value={after:["options","foreach"],init:function(b,d,c){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e=["change"],f=c.get("valueUpdate"),k=!1,h=null;f&&("string"==typeof f&&(f=[f]),a.a.ia(e,f),e=a.a.wb(e));var l=function(){h=null,k=!1;var e=d(),g=a.i.s(b);a.h.ra(e,c,"value",g)};!a.a.M||"input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.m(e,"propertychange")||(a.a.n(b,"propertychange",function(){k=!0}),a.a.n(b,"focus",function(){k=!1}),a.a.n(b,"blur",function(){k&&l()})),a.a.o(e,function(c){var d=l;a.a.Dc(c,"after")&&(d=function(){h=a.i.s(b),setTimeout(l,0)},c=c.substring(5)),a.a.n(b,c,d)});var g=function(){var e=a.a.c(d()),f=a.i.s(b);if(null!==h&&e===h)setTimeout(g,0);else if(e!==f)if("select"===a.a.v(b)){var l=c.get("valueAllowUnset"),f=function(){a.i.Y(b,e,l)};f(),l||e===a.i.s(b)?setTimeout(f,0):a.k.u(a.a.qa,null,[b,"change"])}else a.i.Y(b,e)};a.w(g,null,{q:b})}else a.va(b,{checkedValue:d})},update:function(){}},a.h.V.value=!0,a.d.visible={update:function(b,d){var c=a.a.c(d()),e="none"!=b.style.display;c&&!e?b.style.display="":!c&&e&&(b.style.display="none")}},function(b){a.d[b]={init:function(d,c,e,f,k){return a.d.event.init.call(this,d,function(){var a={};return a[b]=c(),a},e,f,k)}}}("click"),a.J=function(){},a.J.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},a.J.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},a.J.prototype.makeTemplateSource=function(b,d){if("string"==typeof b){d=d||w;var c=d.getElementById(b);if(!c)throw Error("Cannot find template with ID "+b);return new a.t.l(c)}if(1==b.nodeType||8==b.nodeType)return new a.t.ha(b);throw Error("Unknown template type: "+b)},a.J.prototype.renderTemplate=function(a,d,c,e){return a=this.makeTemplateSource(a,e),this.renderTemplateSource(a,d,c,e)},a.J.prototype.isTemplateRewritten=function(a,d){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,d).data("isRewritten")},a.J.prototype.rewriteTemplate=function(a,d,c){a=this.makeTemplateSource(a,c),d=d(a.text()),a.text(d),a.data("isRewritten",!0)},a.b("templateEngine",a.J),a.kb=function(){function b(b,c,d,h){b=a.h.bb(b);for(var l=a.h.ka,g=0;g<b.length;g++){var m=b[g].key;if(l.hasOwnProperty(m)){var x=l[m];if("function"==typeof x){if(m=x(b[g].value))throw Error(m)}else if(!x)throw Error("This template engine does not support the '"+m+"' binding within its templates")}}return d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.Ea(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')",h.createJavaScriptEvaluatorBlock(d)+c}var d=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,c=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{lc:function(b,c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.kb.xc(b,c)},d)},xc:function(a,f){return a.replace(d,function(a,c,d,e,m){return b(m,c,d,f)}).replace(c,function(a,c){return b(c,"<!-- ko -->","#comment",f)})},dc:function(b,c){return a.H.$a(function(d,h){var l=d.nextSibling;l&&l.nodeName.toLowerCase()===c&&a.va(l,b,h)})}}}(),a.b("__tr_ambtns",a.kb.dc),function(){a.t={},a.t.l=function(a){this.l=a},a.t.l.prototype.text=function(){var b=a.a.v(this.l),b="script"===b?"text":"textarea"===b?"value":"innerHTML";if(0==arguments.length)return this.l[b];var d=arguments[0];"innerHTML"===b?a.a.gb(this.l,d):this.l[b]=d};var b=a.a.f.I()+"_";a.t.l.prototype.data=function(c){return 1===arguments.length?a.a.f.get(this.l,b+c):void a.a.f.set(this.l,b+c,arguments[1])};var d=a.a.f.I();a.t.ha=function(a){this.l=a},a.t.ha.prototype=new a.t.l,a.t.ha.prototype.text=function(){if(0==arguments.length){var b=a.a.f.get(this.l,d)||{};return b.lb===p&&b.Na&&(b.lb=b.Na.innerHTML),b.lb}a.a.f.set(this.l,d,{lb:arguments[0]})},a.t.l.prototype.nodes=function(){return 0==arguments.length?(a.a.f.get(this.l,d)||{}).Na:void a.a.f.set(this.l,d,{Na:arguments[0]})},a.b("templateSources",a.t),a.b("templateSources.domElement",a.t.l),a.b("templateSources.anonymousTemplate",a.t.ha)}(),function(){function b(b,c,d){var e;for(c=a.e.nextSibling(c);b&&(e=b)!==c;)b=a.e.nextSibling(e),d(e,b)}function d(c,d){if(c.length){var e=c[0],f=c[c.length-1],h=e.parentNode,k=a.L.instance,r=k.preprocessNode;if(r){if(b(e,f,function(a,b){var c=a.previousSibling,d=r.call(k,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))}),c.length=0,!e)return;e===f?c.push(e):(c.push(e,f),a.a.na(c,h))}b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.ub(d,b)}),b(e,f,function(b){1!==b.nodeType&&8!==b.nodeType||a.H.Xb(b,[d])}),a.a.na(c,h)}}function c(a){return a.nodeType?a:0<a.length?a[0]:null}function e(b,e,f,h,q){q=q||{};var n=(b&&c(b)||f||{}).ownerDocument,r=q.templateEngine||k;if(a.kb.lc(f,r,n),f=r.renderTemplate(f,h,q,n),"number"!=typeof f.length||0<f.length&&"number"!=typeof f[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(n=!1,e){case"replaceChildren":a.e.T(b,f),n=!0;break;
case"replaceNode":a.a.Qb(b,f),n=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e)}return n&&(d(f,h),q.afterRender&&a.k.u(q.afterRender,null,[f,h.$data])),f}function f(b,c,d){return a.F(b)?b():"function"==typeof b?b(c,d):b}var k;a.hb=function(b){if(b!=p&&!(b instanceof a.J))throw Error("templateEngine must inherit from ko.templateEngine");k=b},a.eb=function(b,d,h,x,q){if(h=h||{},(h.templateEngine||k)==p)throw Error("Set a template engine before calling renderTemplate");if(q=q||"replaceChildren",x){var n=c(x);return a.j(function(){var k=d&&d instanceof a.N?d:new a.N(a.a.c(d)),p=f(b,k.$data,k),k=e(x,q,p,k,h);"replaceNode"==q&&(x=k,n=c(x))},null,{Pa:function(){return!n||!a.a.Qa(n)},q:n&&"replaceNode"==q?n.parentNode:n})}return a.H.$a(function(c){a.eb(b,d,h,c,"replaceNode")})},a.Cc=function(b,c,h,k,q){function n(a,b){d(b,v),h.afterRender&&h.afterRender(b,a),v=null}function r(a,c){v=q.createChildContext(a,h.as,function(a){a.$index=c});var d=f(b,a,v);return e(null,"ignoreTargetNode",d,v,h)}var v;return a.j(function(){var b=a.a.c(c)||[];"undefined"==typeof b.length&&(b=[b]),b=a.a.xa(b,function(b){return h.includeDestroyed||b===p||null===b||!a.a.c(b._destroy)}),a.k.u(a.a.fb,null,[k,b,r,h,n])},null,{q:k})};var h=a.a.f.I();a.d.template={init:function(b,c){var d=a.a.c(c());if("string"==typeof d||d.name)a.e.ma(b);else{if("nodes"in d){if(d=d.nodes||[],a.F(d))throw Error('The "nodes" option must be a plain, non-observable array.')}else d=a.e.childNodes(b);d=a.a.Jb(d),new a.t.ha(b).nodes(d)}return{controlsDescendantBindings:!0}},update:function(b,c,d,e,f){var r,k=c();c=a.a.c(k),d=!0,e=null,"string"==typeof c?c={}:(k=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in c&&(d=!a.a.c(c.ifnot)),r=a.a.c(c.data)),"foreach"in c?e=a.Cc(k||b,d&&c.foreach||[],c,b,f):d?(f="data"in c?f.createChildContext(r,c.as):f,e=a.eb(k||b,f,c,b)):a.e.ma(b),f=e,(r=a.a.f.get(b,h))&&"function"==typeof r.p&&r.p(),a.a.f.set(b,h,f&&f.$()?f:p)}},a.h.ka.template=function(b){return b=a.h.bb(b),1==b.length&&b[0].unknown||a.h.vc(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"},a.e.R.template=!0}(),a.b("setTemplateEngine",a.hb),a.b("renderTemplate",a.eb),a.a.Cb=function(a,d,c){if(a.length&&d.length){var e,f,k,h,l;for(e=f=0;(!c||c>e)&&(h=a[f]);++f){for(k=0;l=d[k];++k)if(h.value===l.value){h.moved=l.index,l.moved=h.index,d.splice(k,1),e=k=0;break}e+=k}}},a.a.Ma=function(){function b(b,c,e,f,k){var m,q,t,u,w,h=Math.min,l=Math.max,g=[],p=b.length,n=c.length,r=n-p||1,v=p+n+1;for(m=0;p>=m;m++)for(u=t,g.push(t=[]),w=h(n,m+r),q=l(0,m-1);w>=q;q++)t[q]=q?m?b[m-1]===c[q-1]?u[q-1]:h(u[q]||v,t[q-1]||v)+1:q+1:m+1;for(h=[],l=[],r=[],m=p,q=n;m||q;)n=g[m][q]-1,q&&n===g[m][q-1]?l.push(h[h.length]={status:e,value:c[--q],index:q}):m&&n===g[m-1][q]?r.push(h[h.length]={status:f,value:b[--m],index:m}):(--q,--m,k.sparse||h.push({status:"retained",value:c[q]}));return a.a.Cb(l,r,10*p),h.reverse()}return function(a,c,e){return e="boolean"==typeof e?{dontLimitMoves:e}:e||{},a=a||[],c=c||[],a.length<=c.length?b(a,c,"added","deleted",e):b(c,a,"deleted","added",e)}}(),a.b("utils.compareArrays",a.a.Ma),function(){function b(b,d,f,k,h){var l=[],g=a.j(function(){var g=d(f,h,a.a.na(l,b))||[];0<l.length&&(a.a.Qb(l,g),k&&a.k.u(k,null,[f,g,h])),l.length=0,a.a.ia(l,g)},null,{q:b,Pa:function(){return!a.a.tb(l)}});return{aa:l,j:g.$()?g:p}}var d=a.a.f.I();a.a.fb=function(c,e,f,k,h){function l(b,d){s=u[d],t!==d&&(z[b]=s),s.Ua(t++),a.a.na(s.aa,c),r.push(s),y.push(s)}function g(b,c){if(b)for(var d=0,e=c.length;e>d;d++)c[d]&&a.a.o(c[d].aa,function(a){b(a,d,c[d].wa)})}e=e||[],k=k||{};var m=a.a.f.get(c,d)===p,u=a.a.f.get(c,d)||[],q=a.a.Ka(u,function(a){return a.wa}),n=a.a.Ma(q,e,k.dontLimitMoves),r=[],v=0,t=0,w=[],y=[];e=[];for(var s,D,E,z=[],q=[],C=0;D=n[C];C++)switch(E=D.moved,D.status){case"deleted":E===p&&(s=u[v],s.j&&s.j.p(),w.push.apply(w,a.a.na(s.aa,c)),k.beforeRemove&&(e[C]=s,y.push(s))),v++;break;case"retained":l(C,v++);break;case"added":E!==p?l(C,E):(s={wa:D.value,Ua:a.r(t++)},r.push(s),y.push(s),m||(q[C]=s))}g(k.beforeMove,z),a.a.o(w,k.beforeRemove?a.S:a.removeNode);for(var H,C=0,m=a.e.firstChild(c);s=y[C];C++){for(s.aa||a.a.extend(s,b(c,f,s.wa,h,s.Ua)),v=0;n=s.aa[v];m=n.nextSibling,H=n,v++)n!==m&&a.e.Fb(c,n,H);!s.rc&&h&&(h(s.wa,s.aa,s.Ua),s.rc=!0)}g(k.beforeRemove,e),g(k.afterMove,z),g(k.afterAdd,q),a.a.f.set(c,d,r)}}(),a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.fb),a.P=function(){this.allowTemplateRewriting=!1},a.P.prototype=new a.J,a.P.prototype.renderTemplateSource=function(b,d,c,e){return(d=(9>a.a.M?0:b.nodes)?b.nodes():null)?a.a.O(d.cloneNode(!0).childNodes):(b=b.text(),a.a.ca(b,e))},a.P.Va=new a.P,a.hb(a.P.Va),a.b("nativeTemplateEngine",a.P),function(){a.Ya=function(){var a=this.uc=function(){if(!u||!u.tmpl)return 0;try{if(0<=u.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,f,k){if(k=k||w,f=f||{},2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var h=b.data("precompiled");return h||(h=b.text()||"",h=u.template(null,"{{ko_with $item.koBindingContext}}"+h+"{{/ko_with}}"),b.data("precompiled",h)),b=[e.$data],e=u.extend({koBindingContext:e},f.templateOptions),e=u.tmpl(h,b,e),e.appendTo(k.createElement("div")),u.fragments={},e},this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"},this.addTemplate=function(a,b){w.write("<script type='text/html' id='"+a+"'>"+b+"</script>")},a>0&&(u.tmpl.tag.ko_code={open:"__.push($1 || '');"},u.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},a.Ya.prototype=new a.J;var b=new a.Ya;0<b.uc&&a.hb(b),a.b("jqueryTmplTemplateEngine",a.Ya)}()})}()}(),function(){"use strict";function isPropertyEventHandler(propertyName){return"o"===propertyName[0]&&"n"===propertyName[1]}function isSameLayout(layout1,layout2){return layout1&&layout2&&layout1.type&&layout2.type?objectShallowEquals(layout1,layout2):layout1===layout2}function arrayShallowEquals(array1,array2){if(array1===array2)return!0;if(!array1||!array2||array1.length!==array2.length)return!1;for(var i in array1)if(array2[i]!==array1[i])return!1;return!0}function objectShallowEquals(object1,object2){if(object1===object2)return!0;for(var prop in object1)if(object1[prop]!==object2[prop])return!1;for(var prop in object2)if(object1[prop]!==object2[prop])return!1;return!0}function addBindings(controls,eventConfig){Object.keys(controls).forEach(function(name){var controlConfiguration=controls[name],ctor=(eventConfig[name],WinJS.Utilities.getMember("WinJS.UI."+name)),propertyProcessor=controlConfiguration.propertyProcessor||{},delayedPropertyProcessor=controlConfiguration.postCtorPropertyProcessor||{},bindDescendantsBeforeParent=controlConfiguration.bindDescendantsBeforeParent||!1,bindingName="win"+name;ko.bindingHandlers[bindingName]={init:function(element,valueAccessor,allBindings,viewModel,bindingContext){var value=valueAccessor(),options={};element.children.length>0&&bindDescendantsBeforeParent&&ko.applyBindingsToDescendants(bindingContext,element);for(var property in value)if(value.hasOwnProperty(property)&&!isPropertyEventHandler(property)&&!delayedPropertyProcessor[property])if(propertyProcessor[property]){var propertyResult=propertyProcessor[property](value[property],function(){return element});propertyResult!==doNotSetOptionOnControl&&(options[property]=propertyResult)}else options[property]=ko.unwrap(value[property]);var control=new ctor(element,options);if(eventConfig[name]){var events=eventConfig[name];for(var event in events)ko.utils.registerEventHandler(element,event,function(e){for(var propertyIndex in eventConfig[name][event]){var property=eventConfig[name][event][propertyIndex];value&&value.hasOwnProperty(property)&&ko.isWriteableObservable(value[property])&&value[property]()!==control[property]&&value[property](control[property])}})}return ko.utils.domNodeDisposal.addDisposeCallback(element,function(e){element.winControl&&element.winControl.dispose()}),{controlsDescendantBindings:bindDescendantsBeforeParent}},update:function(element,valueAccessor,allBindings,viewModel,bindingContext){var control=element.winControl,value=valueAccessor();for(var property in value)if(value.hasOwnProperty(property)){var unwrappedValue=ko.unwrap(value[property]);if(control[property]!==unwrappedValue)if(propertyProcessor&&propertyProcessor[property]){var returnValue=propertyProcessor[property](value[property],function(){return element},control[property]);returnValue!==doNotSetOptionOnControl&&(control[property]=returnValue)}else if(delayedPropertyProcessor&&delayedPropertyProcessor[property]){var returnValue=delayedPropertyProcessor[property](value[property],function(){return element},control[property]);returnValue!==doNotSetOptionOnControl&&(control[property]=returnValue)}else control[property]=unwrappedValue}}}})}function bindingListWatch(value,oldValue,sourceElement){var unpacked=ko.unwrap(value),retVal=doNotSetOptionOnControl;if(Array.isArray(unpacked)&&ko.isWriteableObservable(value)){if(!value._winKoChangesSubscription){if(value._rateLimitedChange)throw new Error("Knockout-WinJS does not support rate limited observable arrays currently");var bindingList=new WinJS.Binding.List(unpacked);value._winKoChangesSubscriptionDisabled=!1,value._winKoBindingList=bindingList,value._winKoChangesSubscription=value.subscribe(function(newValue){if(!value._winKoChangesSubscriptionDisabled){bindingList._winKoChangesSubscriptionDisabled=!0;var offset=0,deletes=newValue.filter(function(item){return"deleted"===item.status}),adds=newValue.filter(function(item){return"added"===item.status});for(var deletedItem in deletes){var item=deletes[deletedItem];bindingList.splice(item.index-offset,1),offset++}for(var arrayLength=bindingList.length,i=0;i<adds.length;i++){var item=adds[i];item.index===arrayLength?bindingList.push(item.value):0===item.index?bindingList.unshift(item.value):(bindingList.push(item.value),bindingList.move(arrayLength,item.index)),arrayLength++}bindingList._winKoChangesSubscriptionDisabled=!1}},this,"arrayChange");var bindingListMutationEvents=["itemchanged","itemmoved","itemmutated","itemremoved","reload"],updateOriginalArray=function(){if(!bindingList._winKoChangesSubscriptionDisabled){value._winKoChangesSubscriptionDisabled=!0,value.removeAll();for(var i=0,len=bindingList.length;len>i;i++)value.push(bindingList.getAt(i));value._winKoChangesSubscriptionDisabled=!1}};bindingListMutationEvents.forEach(function(event){bindingList.addEventListener(event,updateOriginalArray)}),ko.utils.domNodeDisposal.addDisposeCallback(sourceElement(),function(){value._winKoChangesSubscription.dispose()})}sourceElement()._winKoDataSourceBound||(sourceElement()._winKoDataSourceBound=!0,retVal=value._winKoBindingList.dataSource)}else retVal=unpacked;return retVal}function itemTemplateWatch(value,oldValue,sourceElement,property){var retVal=doNotSetOptionOnControl;value=ko.unwrap(value);var renderer,template=value;sourceElement=sourceElement(),renderer="string"==typeof value?WinJS.UI.simpleItemRenderer(function(item){var element=document.createElement("div");return ko.renderTemplate(template,item.data,{},element),element}):value;var templateProp="win"+property+"Old";return oldValue&&template===sourceElement[templateProp]||(sourceElement[templateProp]=template,retVal=renderer),retVal}var doNotSetOptionOnControl={},controls={AppBar:{bindDescendantsBeforeParent:!0},AppBarCommand:{propertyProcessor:{type:function(value,appBarCommandElement,update){return appBarCommandElement._winTypeInitialized?void console.warn("Cannot change AppBarCommand type after initializing the control"):(appBarCommandElement._winTypeInitialized=!0,value)}}},AutoSuggestBox:{},BackButton:{},Command:{propertyProcessor:{type:function(value,commandElement,update){return commandElement._winTypeInitialized?void console.warn("Cannot change Command type after initializing the control"):(commandElement._winTypeInitialized=!0,value)}}},ContentDialog:{},DatePicker:{},FlipView:{propertyProcessor:{itemTemplate:function(value,flipViewElement,current){return itemTemplateWatch(value,current,flipViewElement,"ItemTemplate")},itemDataSource:function(value,flipViewElement,current){return bindingListWatch(value,current,flipViewElement)}},bindDescendantsBeforeParent:!0},Flyout:{},Hub:{bindDescendantsBeforeParent:!0},HubSection:{},ItemContainer:{},ListView:{propertyProcessor:{groupHeaderTemplate:function(value,listViewElement,current){return itemTemplateWatch(value,current,listViewElement,"GroupHeaderTemplate")},groupDataSource:function(value,listViewElement,current){return bindingListWatch(value,current,listViewElement)},itemTemplate:function(value,listViewElement,current){return itemTemplateWatch(value,current,listViewElement,"ItemTemplate")},itemDataSource:function(value,listViewElement,current){return bindingListWatch(value,current,listViewElement)},layout:function(value,listViewElement,current){var retVal=doNotSetOptionOnControl,unpacked=ko.unwrap(value),listViewElement=listViewElement();return current&&isSameLayout(unpacked,listViewElement._winCachedLayout)||(retVal=unpacked&&unpacked.type?new unpacked.type(unpacked):unpacked,listViewElement._winCachedLayout=unpacked),retVal}},postCtorPropertyProcessor:{selection:function(value,listViewElement,current){var unpacked=ko.unwrap(value);return listViewElement=listViewElement(),Array.isArray(unpacked)&&ko.isWriteableObservable(value)&&(listViewElement._winKoSelectionChangedHandlerSet||(listViewElement.winControl.addEventListener("selectionchanged",function(){var currSelectionArray=listViewElement.winControl.selection.getIndices(),oldSelection=ko.unwrap(value);arrayShallowEquals(oldSelection,currSelectionArray)||value(listViewElement.winControl.selection.getIndices())}),listViewElement._winKoSelectionChangedHandlerSet=!0)),listViewElement.winControl.selection.set(unpacked),doNotSetOptionOnControl}},bindDescendantsBeforeParent:!0},Menu:{bindDescendantsBeforeParent:!0},MenuCommand:{},Pivot:{bindDescendantsBeforeParent:!0,propertyProcessor:{selectedIndex:function(value,pivotElement,current){return pivotElement._winKoSelectedIndexHandlerSet||(pivotElement().addEventListener("selectionchanged",function(e){ko.isWriteableObservable(value)&&value(e.detail.index)}),pivotElement()._winKoSelectedIndexHandlerSet=!0),ko.unwrap(value)},selectedItem:function(value,pivotElement,current){return pivotElement._winKoSelectedItemHandlerSet||(pivotElement().addEventListener("selectionchanged",function(e){ko.isWriteableObservable(value)&&value(pivotElement().winControl.items.getAt(e.detail.index))}),pivotElement()._winKoSelectedItemHandlerSet=!0),ko.unwrap(value)}}},PivotItem:{},Rating:{},SemanticZoom:{bindDescendantsBeforeParent:!0},SplitView:{},SplitViewCommand:{},SplitViewPaneToggle:{},TimePicker:{},ToggleSwitch:{},ToolBar:{bindDescendantsBeforeParent:!0},Tooltip:{propertyProcessor:{contentElement:function(value,toolTipElement,current){var value=ko.unwrap(value),element=document.querySelector(value);return element}}},ViewBox:{}},eventConfig={AppBar:{afterclose:["opened"],afteropen:["opened"]},AutoSuggestBox:{querychanged:["queryText"]},ContentDialog:{afterhide:["hidden"],aftershow:["hidden"]},DatePicker:{change:["current"]},FlipView:{pageselected:["currentPage"]},Flyout:{afterhide:["hidden"],aftershow:["hidden"]},Hub:{loadingstatechanged:["loadingState"]},ItemContainer:{selectionchanged:["selected"]},ListView:{loadingstatechanged:["loadingState"]},Menu:{afterhide:["hidden"],aftershow:["hidden"]},NavBar:{afterclose:["opened"],afteropen:["opened"]},Pivot:null,Rating:{change:["userRating"]},SemanticZoom:{zoomchanged:["zoomedOut"]},SplitView:{afterclose:["paneOpened"],afteropen:["paneOpened"]},TimePicker:{change:["current"]},ToggleSwitch:{change:["checked"]},ToolBar:{afterclose:["opened"],afteropen:["opened"]}};addBindings(controls,eventConfig)}(),ko.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},ko.virtualElements.allowedBindings.stopBinding=!0;var App;!function(App){var Utils;!function(Utils){function ShowDialog(title,message){alert(message)}var LocalStorage;!function(LocalStorage){function Save(key,value){localStorage.setItem(key,value)}function Retrieve(key){return localStorage.getItem(key)}function Delete(key){localStorage.removeItem(key)}LocalStorage.Save=Save,LocalStorage.Retrieve=Retrieve,LocalStorage.Delete=Delete}(LocalStorage=Utils.LocalStorage||(Utils.LocalStorage={}));var SessionStorage;!function(SessionStorage){function Save(key,value){sessionStorage.setItem(key,value)}function Retrieve(key){return sessionStorage.getItem(key)}function Delete(key){sessionStorage.removeItem(key)}SessionStorage.Save=Save,SessionStorage.Retrieve=Retrieve,SessionStorage.Delete=Delete}(SessionStorage=Utils.SessionStorage||(Utils.SessionStorage={})),Utils.ShowDialog=ShowDialog}(Utils=App.Utils||(App.Utils={}))}(App||(App={}));
//# sourceMappingURL=libs.min.js.map